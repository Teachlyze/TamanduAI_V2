import{a as et,u as st,r as f,l as y,s as r,j as t,p as at}from"./main-Bl3iyOV8.js";import{S as w}from"./StatCard-DjR-Gwtc.js";import{A as it}from"./ActivityCard-CmgyLe5_.js";import{E as rt}from"./EventCard-4saBstvH.js";import{C as _}from"./card-SNqEFOp2.js";import{E as G}from"./EmptyState-DGamXeZ0.js";import{m as M,B as b}from"./button-DpOjBXor.js";import"./dialog-C-DIWS3k.js";import{e as nt}from"./endOfDay-mJ-5sjFp.js";import{C as ot}from"./circle-alert-LHMm3kat.js";import{B}from"./chevron-right-DU2dW0WM.js";import{F as R}from"./index-CYK-_QUl.js";import{S as P}from"./star-C4iDH66r.js";import{T as dt}from"./target-BPzK6WhW.js";import{C as ct}from"./circle-check-rNi8LCKx.js";import{T as lt}from"./trending-up-8L-hnT0i.js";import{Q as V,V as mt,W as z,X as O,Y as F,U as $,Z as pt}from"./LineChart-hpbl_4X3.js";import{B as ut,d as gt}from"./BarChart-Ih-X2DWc.js";import{C as N}from"./index-Bb4h7Ki9.js";import{s as ht,f as vt}from"./format-BcFT9btV.js";import{p as xt}from"./pt-BR-CuGSKEGQ.js";import"./SidebarPremium-PssxZ1ou.js";import"./bell-BfdEdLeq.js";import"./user-DM7mQE01.js";import"./settings-BAxhic8T.js";import"./house--MZ6Jz5W.js";import"./users-CoDMpyo4.js";import"./graduation-cap-D52WS1is.js";import"./chart-column-C0EgfbtL.js";import"./x-f7wZy2q2.js";import"./differenceInHours-DzWJNcba.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-B6HbAA6N.js";import"./formatDistanceToNow-CMbiJYtj.js";import"./constructNow-re94FRT2.js";import"./differenceInCalendarMonths-FFYroMBa.js";import"./endOfMonth-BD-g1yyK.js";import"./clock-BJ9uIF0n.js";import"./video-9oLsbzTZ.js";import"./map-pin-DioqZzjM.js";import"./index-DZVOjynP.js";import"./index-BqR0KVNw.js";const ne=()=>{const{user:d}=et(),x=st(),[K,S]=f.useState(!0),[p,k]=f.useState({totalClasses:0,pendingActivities:0,completedActivities:0,avgGrade:0,completionRate:0,gradeTrend:0}),[C,A]=f.useState([]),[E,L]=f.useState([]),[D,W]=f.useState([]),[T,I]=f.useState([]),[q,U]=f.useState([]);f.useEffect(()=>{d?.id&&X()},[d]);const X=async()=>{try{S(!0),await Promise.all([Y(),H(),Q(),Z(),J(),tt()])}catch(e){y.error("Erro ao carregar dashboard:",e)}finally{S(!1)}},Y=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(m=>m.class_id)||[],o=a.length;if(a.length===0){k({totalClasses:0,pendingActivities:0,completedActivities:0,avgGrade:0,completionRate:0,gradeTrend:0});return}const{data:u}=await r.from("activity_class_assignments").select("activity_id, activity:activities(id, title, due_date, max_score)").in("class_id",a),n=u?.map(m=>m.activity_id).filter(Boolean)||[],{data:l}=await r.from("submissions").select("activity_id, status, grade, submitted_at").eq("student_id",d.id).in("activity_id",n),c=new Set(l?.map(m=>m.activity_id)||[]),g=n.length-c.size,i=c.size,v=l?.filter(m=>m.grade!==null)||[],h=v.length>0?v.reduce((m,j)=>m+parseFloat(j.grade),0)/v.length:0,s=n.length>0?Math.round(i/n.length*100):0;k({totalClasses:o,pendingActivities:g,completedActivities:i,avgGrade:h,completionRate:s,gradeTrend:5})}catch(e){y.error("Erro ao carregar stats:",e)}},H=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(s=>s.class_id)||[];if(a.length===0){A([]);return}const{data:o}=await r.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",a),u=o?.map(s=>s.activity_id).filter(Boolean)||[],{data:n}=await r.from("activities").select("id, title, description, type, due_date, max_score").in("id",u),{data:l}=await r.from("classes").select("id, name, subject").in("id",a),c={};n?.forEach(s=>{c[s.id]=s});const g={};l?.forEach(s=>{g[s.id]=s});const{data:i}=await r.from("submissions").select("activity_id, status, grade").eq("student_id",d.id).in("activity_id",u),v=new Set(i?.map(s=>s.activity_id)||[]),h=(o||[]).filter(s=>c[s.activity_id]&&!v.has(s.activity_id)).map(s=>{const m=c[s.activity_id],j=g[s.class_id];return{...m,class_name:j?.name,class_subject:j?.subject,status:new Date(m.due_date)<new Date?"late":"pending"}}).slice(0,5);A(h)}catch(e){y.error("Erro ao carregar atividades pendentes:",e)}},Q=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(s=>s.class_id)||[],o=new Date,u=ht(o),n=nt(o),{data:l}=await r.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, class_id").in("class_id",a).gte("start_time",u.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0}),{data:c}=await r.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, attendees, class_id").contains("attendees",[d.id]).gte("start_time",u.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0}),{data:g}=await r.from("classes").select("id, name").in("id",a),i={};g?.forEach(s=>{i[s.id]=s.name});const v=new Set,h=[...l||[],...c||[]].filter(s=>v.has(s.id)?!1:(v.add(s.id),!0)).map(s=>({...s,class_name:i[s.class_id]}));L(h)}catch(e){y.error("Erro ao carregar eventos de hoje:",e)}},Z=async()=>{try{const{data:e}=await r.from("submissions").select(`
          id, grade, submitted_at,
          activity:activities(title, max_score)
        `).eq("student_id",d.id).not("grade","is",null).order("submitted_at",{ascending:!0}).limit(10),a=(e||[]).map(o=>({date:vt(new Date(o.submitted_at),"dd/MM",{locale:xt}),avgGrade:parseFloat(o.grade)||0,activity:o.activity?.title}));W(a)}catch(e){y.error("Erro ao carregar dados de desempenho:",e)}},J=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(n=>n.class_id)||[];if(a.length===0){I([]);return}const{data:o}=await r.from("classes").select("id, name, subject").in("id",a),u=await Promise.all((o||[]).map(async n=>{const{data:l}=await r.from("activity_class_assignments").select("activity_id").eq("class_id",n.id),c=l?.map(h=>h.activity_id)||[],{data:g}=await r.from("submissions").select("grade").eq("student_id",d.id).in("activity_id",c).not("grade","is",null),i=g?.map(h=>parseFloat(h.grade))||[],v=i.length>0?i.reduce((h,s)=>h+s,0)/i.length:0;return{name:n.name,value:v}}));I(u.sort((n,l)=>l.value-n.value).slice(0,5))}catch(e){y.error("Erro ao carregar top turmas:",e)}},tt=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(i=>i.class_id)||[],{data:o}=await r.from("activity_class_assignments").select(`
          activity_id,
          activity:activities(id, title, due_date)
        `).in("class_id",a),u=o?.map(i=>i.activity_id).filter(Boolean)||[],{data:n}=await r.from("submissions").select("activity_id").eq("student_id",d.id).in("activity_id",u),l=new Set(n?.map(i=>i.activity_id)||[]),c=(o||[]).filter(i=>i.activity&&!l.has(i.activity.id)&&new Date(i.activity.due_date)<new Date),g=[];c.length>0&&g.push({type:"warning",message:`VocÃª tem ${c.length} atividade${c.length>1?"s":""} atrasada${c.length>1?"s":""}!`}),U(g)}catch(e){y.error("Erro ao carregar alertas:",e)}};return K?t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx(at,{size:"lg"})}):t.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[t.jsxs(M.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-600 to-cyan-500 rounded-2xl p-8 mb-8 text-white shadow-xl",children:[t.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["ðŸ‘‹ OlÃ¡, ",d?.user_metadata?.name||d?.email?.split("@")[0]||"Estudante","!"]}),t.jsxs("p",{className:"text-blue-100 text-lg",children:[p.avgGrade>=8?"ðŸŽ‰ Seu desempenho estÃ¡ Ã³timo! Continue assim!":p.avgGrade>=6?"ðŸ‘ VocÃª estÃ¡ indo bem! Mantenha o foco!":p.avgGrade>0?"ðŸ’ª Vamos melhorar juntos! VocÃª consegue!":"ðŸ“š Comece suas atividades e acompanhe seu progresso!",p.avgGrade>0&&` MÃ©dia atual: ${p.avgGrade.toFixed(1)}`]})]}),q.length>0&&t.jsx(M.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8",children:q.map((e,a)=>t.jsx(_,{className:"p-4 bg-orange-50 dark:bg-orange-950/20 border-orange-300 dark:border-orange-800",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ot,{className:"w-5 h-5 text-orange-600"}),t.jsx("p",{className:"text-orange-900 dark:text-orange-200 font-medium",children:e.message}),t.jsx(b,{variant:"outline",size:"sm",onClick:()=>x("/students/activities"),className:"ml-auto",children:"Ver Atividades"})]})},a))}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsx(w,{icon:B,value:p.totalClasses,label:"Turmas Ativas",gradient:"blue"}),t.jsx(w,{icon:R,value:p.pendingActivities,label:"Atividades Pendentes",gradient:"orange"}),t.jsx(w,{icon:P,value:p.avgGrade>0?p.avgGrade.toFixed(1):"--",label:"MÃ©dia Geral",gradient:"yellow",trend:p.gradeTrend}),t.jsx(w,{icon:dt,value:`${p.completionRate}%`,label:"Taxa de ConclusÃ£o",gradient:"green"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[t.jsxs(_,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"ðŸŽ¯ PrÃ³ximas Atividades"}),t.jsx(b,{variant:"ghost",onClick:()=>x("/students/activities"),className:"text-blue-600 hover:text-blue-700",children:"Ver todas â†’"})]}),C.length>0?t.jsx("div",{className:"space-y-4",children:C.map((e,a)=>t.jsx(it,{activity:e,onStart:()=>x(`/students/activities/${e.id}`),onView:()=>x(`/students/activities/${e.id}`),index:a},e.id))}):t.jsx(G,{icon:ct,title:"Tudo em dia!",description:"VocÃª nÃ£o tem atividades pendentes no momento. ParabÃ©ns!",variant:"success"})]}),D.length>0&&t.jsxs(_,{className:"p-6",children:[t.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[t.jsx(lt,{className:"w-6 h-6 text-blue-600"}),"Sua EvoluÃ§Ã£o"]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(V,{width:"100%",height:300,className:"min-w-[400px]",children:t.jsxs(mt,{data:D,margin:{top:5,right:20,left:0,bottom:5},children:[t.jsx(z,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),t.jsx(O,{dataKey:"date",stroke:"#64748b",tick:{fontSize:12}}),t.jsx(F,{stroke:"#64748b",domain:[0,10],tick:{fontSize:12}}),t.jsx($,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px"}}),t.jsx(pt,{type:"monotone",dataKey:"avgGrade",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:6},activeDot:{r:8},name:"MÃ©dia"})]})})})]}),T.length>0&&t.jsxs(_,{className:"p-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:"â­ Melhores Turmas"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(V,{width:"100%",height:250,className:"min-w-[350px]",children:t.jsxs(ut,{data:T,margin:{top:5,right:20,left:0,bottom:5},children:[t.jsx(z,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),t.jsx(O,{dataKey:"name",stroke:"#64748b",tick:{fontSize:11},angle:-15,textAnchor:"end",height:60}),t.jsx(F,{stroke:"#64748b",domain:[0,10],tick:{fontSize:12}}),t.jsx($,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px"}}),t.jsx(gt,{dataKey:"value",fill:"#10b981",radius:[8,8,0,0],name:"MÃ©dia"})]})})})]})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs(_,{className:"p-6",children:[t.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[t.jsx(N,{className:"w-5 h-5 text-blue-600"}),"Hoje"]}),E.length>0?t.jsx("div",{className:"space-y-3",children:E.map((e,a)=>t.jsx(rt,{event:e,onClick:()=>x("/students/calendar"),index:a},e.id))}):t.jsx(G,{icon:N,title:"Nenhum evento",description:"Sua agenda estÃ¡ livre hoje!",variant:"info"})]}),t.jsxs(_,{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"ðŸš€ Atalhos RÃ¡pidos"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>x("/students/activities"),children:[t.jsx(R,{className:"w-4 h-4 mr-2"}),"Minhas Atividades"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>x("/students/classes"),children:[t.jsx(B,{className:"w-4 h-4 mr-2"}),"Minhas Turmas"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>x("/students/calendar"),children:[t.jsx(N,{className:"w-4 h-4 mr-2"}),"Agenda"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>x("/students/performance"),children:[t.jsx(P,{className:"w-4 h-4 mr-2"}),"Minhas Notas"]})]})]})]})]})]})};export{ne as default};
