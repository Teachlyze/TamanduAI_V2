import{c as C,r as n,s as y,j as e,k as $,u as K,m as te,a as le,n as re}from"./main-PnoWv5mu.js";import{m as q,B as l}from"./button-B1az96ai.js";import{C as b}from"./card-DNyDBtwZ.js";import{B as T}from"./SidebarPremium-DbDmcmQG.js";import{t as v}from"./use-toast-VMwxor12.js";import{r as M}from"./redisCache-Vh2O3gTE.js";import{U as z}from"./users-CZvcSbj_.js";import{T as ie}from"./trending-up-BnoBnv7_.js";import{C as R}from"./circle-check-big-DeprgibN.js";import{C as oe}from"./clock-Dkzb1QSl.js";import{C as D}from"./index-DvZMkTcl.js";import{P as k}from"./plus-DIEHEl2o.js";import{F as L}from"./file-text-WNEYLkuB.js";import{C as ne}from"./circle-alert-BGRUIVYu.js";import{X as Q}from"./x-7WqOwCJm.js";import{V as ce}from"./video-L5h3jJ84.js";import{L as X}from"./link-C6n_5Pxs.js";import{U as Y}from"./upload-gFrWu7pY.js";import{B as Z}from"./book-open-BN8GTFXN.js";import{S as O}from"./search-CcwmVUyB.js";import{U as I}from"./user-plus-Dglr_hjb.js";import{C as G}from"./copy-B3LPT1my.js";import{D as de}from"./download-Dw41jWXn.js";import{B as me}from"./bot-DKN4m6U9.js";import{M as J}from"./message-square-CZ7vl3Ib.js";import{A as xe}from"./arrow-left-Be4Q5mrA.js";import{S as ue}from"./settings-BAc4VZJo.js";import{S as he}from"./square-pen-CGfQTttM.js";import"./bell-jlu-i0nu.js";import"./user-IPdw0V9z.js";import"./graduation-cap-BTPeK0uK.js";import"./chart-column-Ba9dXnEb.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],W=C("chart-no-axes-column",be);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ee=C("clipboard-list",ge);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],fe=C("ellipsis-vertical",pe);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],H=C("folder",je);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ne=C("image",ve);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],we=C("layout-dashboard",ye);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],V=C("megaphone",ke);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ae=C("square-check-big",Ce),_e=({classId:t,classData:u})=>{const[c,d]=n.useState(!0),[r,p]=n.useState({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0});n.useEffect(()=>{x()},[t]);const x=async()=>{try{d(!0);const s=await M.getClassStats(t,async()=>{const[j,N,i]=await Promise.all([y.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",t).eq("role","student"),y.from("activity_class_assignments").select("*",{count:"exact",head:!0}).eq("class_id",t),y.from("submissions").select("grade, submitted_at",{count:"exact"}).not("grade","is",null).limit(1e3)]),h=i.data?.filter(w=>w.grade)||[],A=h.length>0?h.reduce((w,g)=>w+parseFloat(g.grade),0)/h.length:0,_=i.data?.filter(w=>w.submitted_at)||[],S=i.count>0?_.length/i.count*100:0;return{totalStudents:j.count||0,avgGrade:Number(A.toFixed(1)),onTimeRate:Math.round(S),openActivities:N.count||0,timestamp:new Date().toISOString()}});p(s)}catch(s){console.error("Erro ao carregar estatísticas:",s),p({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0})}finally{d(!1)}};if(c)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{})});const a=[{title:"Total de Alunos",value:r.totalStudents,icon:z,color:"blue",change:"+2 esta semana"},{title:"Nota Média da Turma",value:r.avgGrade.toFixed(1),icon:ie,color:r.avgGrade>=7?"green":r.avgGrade>=5?"yellow":"red",change:"+0.3 vs mês anterior"},{title:"Taxa de Entrega no Prazo",value:`${r.onTimeRate}%`,icon:R,color:r.onTimeRate>=80?"green":r.onTimeRate>=60?"yellow":"red",change:"+5% vs período anterior"},{title:"Atividades em Aberto",value:r.openActivities,icon:oe,color:r.openActivities>10?"red":r.openActivities>5?"yellow":"blue",change:"3 aguardando correção"}],o={blue:"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800",green:"bg-green-50 dark:bg-green-950 text-green-600 dark:text-green-400 border-green-200 dark:border-green-800",yellow:"bg-yellow-50 dark:bg-yellow-950 text-yellow-600 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",red:"bg-red-50 dark:bg-red-950 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800"};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:a.map((s,j)=>{const N=s.icon;return e.jsx(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:j*.1},children:e.jsxs(b,{className:`p-6 border-2 ${o[s.color]}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:`p-3 rounded-lg ${o[s.color]}`,children:e.jsx(N,{className:"w-6 h-6"})})}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:s.value}),e.jsx("div",{className:"text-sm font-medium mb-2",children:s.title}),e.jsx("div",{className:"text-xs opacity-75",children:s.change})]})},s.title)})}),e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-blue-600"}),"Agenda de Aulas"]}),e.jsx(l,{variant:"outline",size:"sm",children:"Ver Completa"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Nenhuma aula agendada nos próximos dias"}),e.jsxs(l,{variant:"outline",size:"sm",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Agendar Aula"]})]})]}),e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600"}),"Últimas Atividades Postadas"]}),e.jsx(l,{variant:"link",size:"sm",children:"Ver todas"})]}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx(L,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhuma atividade postada"})]})]}),e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-yellow-600"}),"Alunos que Precisam de Atenção"]}),e.jsx(l,{variant:"link",size:"sm",children:"Ver todos"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 text-green-300 dark:text-green-700 mx-auto mb-3"}),e.jsx("p",{className:"text-green-600 dark:text-green-400 font-medium mb-2",children:"Nenhum aluno em situação de alerta"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Parabéns! Todos estão acompanhando bem."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Ações Rápidas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[{icon:k,label:"Criar Atividade",color:"blue"},{icon:z,label:"Adicionar Aluno",color:"green"},{icon:L,label:"Novo Material",color:"purple"},{icon:D,label:"Agendar Aula",color:"orange"},{icon:V,label:"Postar Comunicado",color:"yellow"},{icon:Ae,label:"Corrigir Trabalhos",color:"red"}].map(s=>{const j=s.icon;return e.jsx(b,{className:"p-4 hover:shadow-lg transition-shadow cursor-pointer group",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 group-hover:scale-110 transition-transform",children:e.jsx(j,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]})},s.label)})})]})]})},Se=({isOpen:t,onClose:u,classId:c,onSuccess:d})=>{const[r,p]=n.useState(!1),[x,a]=n.useState("text"),[o,s]=n.useState({title:"",content:"",link:"",file:null}),j=[{id:"text",label:"Texto",icon:L,desc:"Compartilhe um texto ou aviso"},{id:"video",label:"Vídeo",icon:ce,desc:"Adicione um vídeo do YouTube ou Vimeo"},{id:"link",label:"Link",icon:X,desc:"Compartilhe um link externo"},{id:"image",label:"Imagem",icon:Ne,desc:"Adicione fotos ou imagens"}],N=async i=>{if(i.preventDefault(),!o.title.trim()||!o.content.trim()){v({title:"Campos obrigatórios",description:"Preencha título e conteúdo",variant:"destructive"});return}try{p(!0),await M.invalidateClass(c),v({title:"Post criado!",description:"Seu post foi publicado no mural"}),d?.(),u()}catch(h){console.error("Erro ao criar post:",h),v({title:"Erro ao criar post",description:h.message,variant:"destructive"})}finally{p(!1)}};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(b,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Nova Postagem"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Compartilhe conteúdo com seus alunos"})]}),e.jsx("button",{onClick:u,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Tipo de Conteúdo"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:j.map(i=>{const h=i.icon;return e.jsx("button",{type:"button",onClick:()=>a(i.id),className:`p-4 rounded-lg border-2 text-left transition-all ${x===i.id?"border-blue-600 bg-blue-50 dark:bg-blue-950":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:`w-5 h-5 ${x===i.id?"text-blue-600":"text-slate-600"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:i.label}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:i.desc})]})]})},i.id)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Título ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o.title,onChange:i=>s({...o,title:i.target.value}),placeholder:"Ex: Material sobre Funções Quadráticas",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:200,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[o.title.length,"/200"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Conteúdo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:o.content,onChange:i=>s({...o,content:i.target.value}),placeholder:"Escreva o conteúdo da postagem...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:2e3,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[o.content.length,"/2000"]})]}),x==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Link do Vídeo"}),e.jsx("input",{type:"url",value:o.link,onChange:i=>s({...o,link:i.target.value}),placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),x==="link"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"URL do Link"}),e.jsx("input",{type:"url",value:o.link,onChange:i=>s({...o,link:i.target.value}),placeholder:"https://exemplo.com/artigo",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),x==="image"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Upload de Imagem"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Arraste uma imagem ou clique para selecionar"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"image-upload",onChange:i=>s({...o,file:i.target.files[0]})}),e.jsx(l,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>document.getElementById("image-upload").click(),children:"Selecionar Arquivo"}),o.file&&e.jsx("p",{className:"text-sm text-green-600 mt-2",children:o.file.name})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(l,{type:"button",variant:"outline",onClick:u,className:"flex-1",disabled:r,children:"Cancelar"}),e.jsx(l,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600",disabled:r,children:r?"Publicando...":"Publicar"})]})]})]})}):null},Ee=({classId:t})=>{const[u,c]=n.useState(!1),d=()=>{c(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Mural de Conteúdo"}),e.jsxs(l,{className:"bg-gradient-to-r from-blue-600 to-cyan-600",onClick:()=>c(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Nova Postagem"]})]}),e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(L,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum conteúdo postado ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Compartilhe materiais, vídeos e links com seus alunos"}),e.jsxs(l,{onClick:()=>c(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Criar Primeira Postagem"]})]}),e.jsx(Se,{isOpen:u,onClose:()=>c(!1),classId:t,onSuccess:d})]})},Te=({classId:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Comunicados"}),e.jsxs(l,{className:"bg-gradient-to-r from-orange-600 to-red-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Novo Comunicado"]})]}),e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(V,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum comunicado publicado ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Avisos importantes aparecerão aqui e notificarão todos os alunos"}),e.jsxs(l,{className:"bg-gradient-to-r from-orange-600 to-red-600",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Criar Primeiro Comunicado"]})]})]}),Le=({classId:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Biblioteca de Materiais"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Novo Módulo"]}),e.jsxs(l,{className:"bg-gradient-to-r from-blue-600 to-cyan-600",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Adicionar Material"]})]})]}),e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(Z,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Biblioteca Vazia"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Comece organizando seus materiais em módulos e tópicos"}),e.jsxs(l,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Criar Primeiro Módulo"]})]})]}),Me=({classId:t})=>{const u=K(),[c,d]=n.useState(!0),[r,p]=n.useState([]);n.useEffect(()=>{x()},[t]);const x=async()=>{try{d(!0);const a=await M.getClassActivities(t,async()=>{const{data:o,error:s}=await y.from("activity_class_assignments").select(`
            id,
            assigned_at,
            activity:activities(
              id,
              title,
              description,
              type,
              due_date,
              max_score,
              status
            )
          `).eq("class_id",t).order("assigned_at",{ascending:!1}).limit(50);if(s)throw s;return o||[]});p(a)}catch(a){console.error("Erro ao carregar atividades:",a),p([])}finally{d(!1)}};return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atividades da Turma"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Postar Atividade Existente"]}),e.jsxs(l,{className:"bg-gradient-to-r from-blue-600 to-cyan-600",onClick:()=>u(`/dashboard/activities/create?classId=${t}`),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Nova Atividade"]})]})]}),r.length>0?e.jsx("div",{className:"space-y-4",children:r.map(a=>e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:a.activity?.title||"Sem título"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{children:a.activity?.type||"assignment"}),a.activity?.due_date&&e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Prazo: ",new Date(a.activity.due_date).toLocaleDateString("pt-BR")]})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:a.activity?.description||"Sem descrição"})]}),e.jsx(l,{variant:"outline",size:"sm",children:"Ver Submissões"})]})},a.id))}):e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(ee,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma atividade postada ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Crie ou poste uma atividade para começar"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(l,{onClick:()=>u(`/dashboard/activities/create?classId=${t}`),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Criar Nova Atividade"]}),e.jsx(l,{variant:"outline",children:"Postar Atividade Existente"})]})]})]})},Pe=({isOpen:t,onClose:u,classId:c,classData:d,onSuccess:r})=>{const[p,x]=n.useState(!1),[a,o]=n.useState("email"),[s,j]=n.useState(""),[N,i]=n.useState(""),[h,A]=n.useState(null),_=d?.invite_code?`${window.location.origin}/join/${d.invite_code}`:"",S=async()=>{if(!s.trim()){v({title:"Email obrigatório",description:"Digite um email para buscar",variant:"destructive"});return}try{x(!0);const{data:m,error:f}=await y.from("profiles").select("id, full_name, email, avatar_url").eq("email",s.toLowerCase()).eq("role","student").single();if(f||!m){A({found:!1}),v({title:"Aluno não encontrado",description:"Email não cadastrado no sistema",variant:"destructive"});return}A({found:!0,user:m})}catch(m){console.error("Erro ao buscar email:",m)}finally{x(!1)}},w=async()=>{if(h?.user)try{x(!0);const{data:m}=await y.from("class_members").select("id").eq("class_id",c).eq("user_id",h.user.id).single();if(m){v({title:"Aluno já está na turma",variant:"destructive"});return}const{error:f}=await y.from("class_members").insert({class_id:c,user_id:h.user.id,role:"student",joined_at:new Date().toISOString()});if(f)throw f;await M.invalidateClass(c),v({title:"Aluno adicionado!",description:`${h.user.full_name} foi adicionado à turma`}),j(""),A(null),r?.()}catch(m){console.error("Erro ao adicionar aluno:",m),v({title:"Erro ao adicionar aluno",description:m.message,variant:"destructive"})}finally{x(!1)}},g=async()=>{const m=N.split(`
`).map(f=>f.trim()).filter(f=>f&&f.includes("@"));if(m.length===0){v({title:"Nenhum email válido",variant:"destructive"});return}try{x(!0);let f=0,F=0,U=0;for(const se of m){const{data:B}=await y.from("profiles").select("id").eq("email",se.toLowerCase()).eq("role","student").single();if(!B){F++;continue}const{data:ae}=await y.from("class_members").select("id").eq("class_id",c).eq("user_id",B.id).single();if(ae){U++;continue}await y.from("class_members").insert({class_id:c,user_id:B.id,role:"student",joined_at:new Date().toISOString()}),f++}await M.invalidateClass(c),v({title:"Importação concluída",description:`${f} alunos adicionados, ${F} não encontrados, ${U} já eram membros`}),i(""),r?.()}catch(f){console.error("Erro na importação:",f),v({title:"Erro na importação",description:f.message,variant:"destructive"})}finally{x(!1)}},E=()=>{navigator.clipboard.writeText(_),v({title:"Link copiado!",description:"Link de convite copiado para área de transferência"})},P=()=>{navigator.clipboard.writeText(d.invite_code),v({title:"Código copiado!",description:"Código de convite copiado"})};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(b,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Aluno"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha um método para adicionar alunos"})]}),e.jsx("button",{onClick:u,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex gap-2",children:[{id:"email",label:"Buscar por Email",icon:O},{id:"invite_link",label:"Link de Convite",icon:X},{id:"bulk",label:"Importar Lista",icon:I}].map(m=>{const f=m.icon;return e.jsxs("button",{onClick:()=>o(m.id),className:`flex-1 px-4 py-2 rounded-lg font-medium text-sm transition-all ${a===m.id?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200"}`,children:[e.jsx(f,{className:"w-4 h-4 inline mr-2"}),m.label]},m.id)})}),a==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email do Aluno"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:s,onChange:m=>j(m.target.value),placeholder:"aluno@exemplo.com",className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",onKeyPress:m=>m.key==="Enter"&&S()}),e.jsxs(l,{onClick:S,disabled:p,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Buscar"]})]})]}),h?.found&&h.user&&e.jsx(b,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:h.user.full_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:h.user.full_name}),e.jsx("div",{className:"text-sm text-slate-600",children:h.user.email})]})]}),e.jsx(l,{onClick:w,disabled:p,children:"Adicionar à Turma"})]})})]}),a==="invite_link"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(b,{className:"p-4 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Código de Convite"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-lg font-mono",children:d?.invite_code||"N/A"}),e.jsx(l,{variant:"outline",size:"sm",onClick:P,children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Link de Convite"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:_,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-sm"}),e.jsx(l,{variant:"outline",size:"sm",onClick:E,children:e.jsx(G,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Compartilhe o código ou link com os alunos. Eles poderão entrar automaticamente na turma."})]}),a==="bulk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Lista de Emails"}),e.jsx("textarea",{value:N,onChange:m=>i(m.target.value),placeholder:`aluno1@exemplo.com
aluno2@exemplo.com
aluno3@exemplo.com`,rows:8,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Cole uma lista de emails (um por linha)"})]}),e.jsx(l,{onClick:g,disabled:p,className:"w-full",children:p?"Importando...":"Importar Alunos"})]})]})]})}):null},qe=({classId:t,classData:u})=>{const[c,d]=n.useState(!0),[r,p]=n.useState([]),[x,a]=n.useState(!1);n.useEffect(()=>{o()},[t]);const o=async()=>{try{d(!0);const s=await M.getClassStudents(t,async()=>{const{data:j,error:N}=await y.from("class_members").select(`
            *,
            user:profiles(id, full_name, email, avatar_url)
          `).eq("class_id",t).eq("role","student").order("joined_at",{ascending:!1});if(N)throw N;return j||[]});p(s)}catch(s){console.error("Erro ao carregar alunos:",s),p([])}finally{d(!1)}};return c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Alunos da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[r.length," ",r.length===1?"aluno":"alunos"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Importar Lista"]}),e.jsxs(l,{variant:"outline",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Exportar Lista"]}),e.jsxs(l,{className:"bg-gradient-to-r from-blue-600 to-cyan-600",onClick:()=>a(!0),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Adicionar Aluno"]})]})]}),r.length>0?e.jsx("div",{className:"grid gap-4",children:r.map(s=>e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-lg",children:s.user?.full_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.user?.full_name||"Nome não disponível"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.user?.email||"Email não disponível"}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Entrou em ",new Date(s.joined_at).toLocaleDateString("pt-BR")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"bg-green-100 text-green-700",children:"Ativo"}),e.jsx(l,{variant:"outline",size:"sm",children:"Ver Detalhes"})]})]})},s.id))}):e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(z,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum aluno na turma ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Adicione alunos ou compartilhe o link de convite"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(l,{onClick:()=>a(!0),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Adicionar Primeiro Aluno"]}),e.jsx(l,{variant:"outline",onClick:()=>a(!0),children:"Gerar Link de Convite"})]})]}),e.jsx(Pe,{isOpen:x,onClose:()=>a(!1),classId:t,classData:u,onSuccess:()=>{a(!1),o()}})]})},ze=({classId:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Métricas da Turma"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[{label:"Nota Média",value:"7.8",color:"green"},{label:"Taxa de Entrega",value:"82%",color:"blue"},{label:"Engajamento",value:"75%",color:"purple"}].map(u=>e.jsxs(b,{className:"p-6",children:[e.jsx("div",{className:"text-3xl font-bold mb-2",children:u.value}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:u.label})]},u.label))}),e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(W,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Análises Detalhadas"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Gráficos e análises detalhadas estarão disponíveis em breve"})]})]}),Ve=({classId:t,classData:u})=>{const[c,d]=n.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Assistente Virtual (Chatbot)"}),e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950 rounded-lg",children:e.jsx(me,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Ative o Chatbot para esta Turma"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Um assistente virtual responderá dúvidas dos alunos automaticamente"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:r=>d(r.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c&&e.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"ℹ️ Você poderá treinar e configurar o chatbot posteriormente na página específica de Chatbot."})})]}),!c&&e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(J,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Chatbot Desativado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Ative o chatbot para permitir que alunos tirem dúvidas automaticamente"}),e.jsx(l,{onClick:()=>d(!0),children:"Ativar Chatbot"})]})]})},bs=()=>{const{classId:t}=te(),u=K(),{user:c}=le(),[d,r]=re(),[p,x]=n.useState(!0),[a,o]=n.useState(null),[s,j]=n.useState(d.get("tab")||"overview"),[N,i]=n.useState(0);n.useEffect(()=>{t&&h()},[t]),n.useEffect(()=>{const g=d.get("tab");g&&j(g)},[d]);const h=async()=>{try{x(!0);const{data:g,error:E}=await y.from("classes").select("*").eq("id",t).single();if(E)throw E;o(g);const{count:P}=await y.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",t).eq("role","student");i(P||0)}catch(g){console.error("Erro ao carregar turma:",g),v({title:"Erro ao carregar turma",description:"Não foi possível carregar os dados da turma.",variant:"destructive"})}finally{x(!1)}},A=g=>{j(g),r({tab:g})},_=()=>{a?.invite_code&&(navigator.clipboard.writeText(a.invite_code),v({title:"Código copiado!",description:"O código de convite foi copiado para a área de transferência."}))},S=[{id:"overview",label:"Visão Geral",icon:we},{id:"content",label:"Mural de Conteúdo",icon:L},{id:"announcements",label:"Comunicados",icon:V},{id:"library",label:"Biblioteca",icon:Z},{id:"activities",label:"Atividades",icon:ee},{id:"students",label:"Alunos",icon:z},{id:"metrics",label:"Métricas",icon:W},{id:"chatbot",label:"Chatbot",icon:J}];if(p)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx($,{size:"lg"})});const w=a?.color||"from-blue-600 to-cyan-500";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsxs("div",{className:`relative h-64 bg-gradient-to-r ${w} overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute top-4 left-6",children:e.jsxs(l,{variant:"ghost",onClick:()=>u("/dashboard/classes"),className:"text-white hover:bg-white/20",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs("div",{className:"absolute top-4 right-6 flex items-center gap-2",children:[e.jsx(l,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx(l,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(l,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-center px-6 max-w-7xl mx-auto",children:[e.jsx(q.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-4xl font-bold text-white mb-2",children:a?.name}),e.jsx(q.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-lg text-white/90 mb-4",children:a?.subject}),a?.description&&e.jsx(q.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-white/80 max-w-2xl line-clamp-2",children:a.description}),e.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex items-center gap-3 mt-4",children:[e.jsxs(T,{className:"bg-white/20 text-white border-white/30",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),N," alunos"]}),a?.is_active!==!1?e.jsxs(T,{className:"bg-green-500/20 text-green-100 border-green-400/30",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Ativa"]}):e.jsx(T,{className:"bg-gray-500/20 text-gray-100 border-gray-400/30",children:"Arquivada"}),a?.invite_code&&e.jsxs(T,{className:"bg-white/20 text-white border-white/30 cursor-pointer hover:bg-white/30",onClick:_,children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),"Código: ",a.invite_code]})]})]}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 h-16 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsx("div",{className:"sticky top-0 z-40 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide py-1",children:S.map(g=>{const E=g.icon,P=s===g.id;return e.jsxs("button",{onClick:()=>A(g.id),className:`
                    flex items-center gap-2 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all
                    ${P?"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}
                  `,children:[e.jsx(E,{className:"w-4 h-4"}),g.label]},g.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[s==="overview"&&e.jsx(_e,{classId:t,classData:a}),s==="content"&&e.jsx(Ee,{classId:t}),s==="announcements"&&e.jsx(Te,{classId:t}),s==="library"&&e.jsx(Le,{classId:t}),s==="activities"&&e.jsx(Me,{classId:t}),s==="students"&&e.jsx(qe,{classId:t,classData:a}),s==="metrics"&&e.jsx(ze,{classId:t}),s==="chatbot"&&e.jsx(Ve,{classId:t,classData:a})]})]})};export{bs as default};
