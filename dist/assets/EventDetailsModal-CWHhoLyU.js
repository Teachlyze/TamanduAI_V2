import{c as R,r as i,s as d,l as k,j as e,p as z}from"./main-Bl3iyOV8.js";import{B as l}from"./button-DpOjBXor.js";import{e as c}from"./SidebarPremium-PssxZ1ou.js";import{t as h}from"./use-toast-CkGKCyMO.js";import{X as B}from"./x-f7wZy2q2.js";import{C as H}from"./clock-BJ9uIF0n.js";import{f as u}from"./format-BcFT9btV.js";import{p as I}from"./pt-BR-CuGSKEGQ.js";import{M as U}from"./map-pin-DioqZzjM.js";import{U as w}from"./users-CoDMpyo4.js";import{B as V}from"./chevron-right-DU2dW0WM.js";import{U as $}from"./user-DM7mQE01.js";import{V as F}from"./video-9oLsbzTZ.js";import{S as G}from"./square-pen-Bd7wAOal.js";import{C as O}from"./copy-BgySpDi_.js";import{T as K}from"./trash-2-MKta588f.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],J=R("external-link",X),he=({isOpen:n,onClose:p,event:s,onEdit:y,onDelete:_})=>{const[m,f]=i.useState(!1),[E,g]=i.useState(!1),[x,D]=i.useState([]),[r,C]=i.useState(null),[o,M]=i.useState(null),[Q,b]=i.useState(!1);i.useEffect(()=>{n&&s&&S()},[n,s]);const S=async()=>{try{if(b(!0),s.type==="meeting"||s.type==="reunião"){const{data:t,error:a}=await d.from("event_attendees").select(`
            user_id,
            status,
            profiles:profiles!event_attendees_user_id_fkey(id, full_name, email)
          `).eq("event_id",s.id);if(a)throw a;D(t||[])}if(s.activity_id){const{data:t,error:a}=await d.from("activities").select("id, title, type, description, max_score").eq("id",s.activity_id).single();if(a&&a.code!=="PGRST116")throw a;C(t)}if(s.class_id){const{data:t,error:a}=await d.from("classes").select("id, name, subject").eq("id",s.class_id).single();if(a&&a.code!=="PGRST116")throw a;M(t)}}catch(t){k.error("Erro ao carregar detalhes do evento:",t)}finally{b(!1)}},q=async()=>{try{f(!0);const{error:t}=await d.from("calendar_events").delete().eq("id",s.id);if(t)throw t;h({title:"Evento excluído!",description:"O evento foi removido com sucesso."}),_(),p()}catch(t){k.error("Erro ao excluir evento:",t),h({title:"Erro ao excluir",description:"Não foi possível excluir o evento.",variant:"destructive"})}finally{f(!1)}},L=()=>{h({title:"Em desenvolvimento",description:"Funcionalidade em breve."})},P=t=>({event:"Aula",activity:"Atividade",meeting:"Reunião",deadline:"Prazo"})[t]||"Evento",T=t=>({event:"bg-blue-100 text-blue-700",activity:"bg-orange-100 text-orange-700",meeting:"bg-purple-100 text-purple-700",deadline:"bg-red-100 text-red-700"})[t]||"bg-gray-100 text-gray-700",A=()=>{const t=new Date(s.start_time),j=new Date(s.end_time)-t,N=Math.floor(j/(1e3*60*60)),v=Math.floor(j%(1e3*60*60)/(1e3*60));return N>0?`${N}h ${v}min`:`${v}min`};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:s.title}),e.jsx(c,{className:T(s.type),children:P(s.type)})]}),e.jsx("button",{onClick:p,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(B,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-slate-300",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:u(new Date(s.start_time),"EEEE, d 'de' MMMM",{locale:I})}),e.jsxs("div",{className:"text-sm text-slate-500",children:[u(new Date(s.start_time),"HH:mm")," - ",u(new Date(s.end_time),"HH:mm")," • ",A()]})]})]}),s.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:"Descrição"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:s.description})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:s.modality==="online"?"Online":"Presencial"}),s.modality==="online"&&s.meeting_link&&e.jsxs("a",{href:s.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-1",children:["Abrir link da reunião",e.jsx(J,{className:"w-3 h-3"})]}),s.modality==="presential"&&s.location&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:s.location})]})]}),(o||s.class)&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/30 rounded-lg border-l-4 border-green-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-green-600"}),"Turma"]}),e.jsx("div",{className:"font-medium",children:o?.name||s.class?.name}),(o?.subject||s.class?.subject)&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:o?.subject||s.class?.subject})]}),r&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border-l-4 border-blue-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600"}),"Atividade Linkada"]}),e.jsx("div",{className:"font-medium mb-1",children:r.title}),r.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:r.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",children:r.type}),r.max_score&&e.jsxs(c,{variant:"outline",children:[r.max_score," pontos"]})]})]}),x.length>0&&e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/30 rounded-lg border-l-4 border-purple-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-purple-600"}),"Participantes (",x.length,")"]}),e.jsx("div",{className:"space-y-2",children:x.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:t.profiles?.full_name}),e.jsx("div",{className:"text-xs text-slate-500",children:t.profiles?.email})]})]}),e.jsx(c,{variant:t.status==="accepted"?"success":"secondary",className:"text-xs",children:t.status==="accepted"?"Confirmado":t.status==="declined"?"Recusado":"Pendente"})]},t.user_id))})]}),s.meeting_url&&e.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-950/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-700 dark:text-indigo-400",children:"LINK DA REUNIÃO:"})]}),e.jsx("a",{href:s.meeting_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline break-all",children:s.meeting_url})]}),E&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 mb-3",children:"Tem certeza que deseja excluir este evento? Esta ação não pode ser desfeita."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>g(!1),disabled:m,children:"Cancelar"}),e.jsx(l,{size:"sm",onClick:q,disabled:m,className:"bg-red-600 hover:bg-red-700",children:m?e.jsxs(e.Fragment,{children:[e.jsx(z,{size:"sm",className:"mr-2"}),"Excluindo..."]}):"Confirmar Exclusão"})]})]})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(l,{variant:"outline",onClick:y,className:"flex-1",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(l,{variant:"outline",onClick:L,className:"flex-1",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(l,{variant:"outline",onClick:()=>g(!0),className:"flex-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})})]})}):null};export{he as E};
