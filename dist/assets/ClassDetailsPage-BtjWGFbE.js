import{c as Oe,u as Je,r as i,s as M,j as e,k as te,h as Xe,e as Ye,m as Cs,a as _s,n as Ss}from"./main-XRKQFEIr.js";import{m as H,B as E}from"./button-D4bIZ4Ty.js";import{C as m}from"./card-BEk2G2Us.js";import{B as V,A as is,c as As}from"./SidebarPremium-BnsbfpCV.js";import{t as v}from"./use-toast-Cv69gxoh.js";import{r as Pe}from"./redisCache-Vh2O3gTE.js";import{U as se}from"./users-DP4-CTtE.js";import{T as Ne}from"./trending-up-eowzUgXK.js";import{C as Y}from"./circle-check-big-CiCoaZWN.js";import{C as qe}from"./clock-BXvepPh_.js";import{C as ee}from"./index-e3XtT_BD.js";import{P as re}from"./plus-DVhNLwZX.js";import{F as I}from"./file-text-tq0U235S.js";import{C as ie}from"./circle-alert-CmSW_OAP.js";import{M as ue,I as Re,P as xs}from"./pin-BzWTKHuO.js";import{S as Es}from"./square-check-big-DO1dpip8.js";import{c as Ms,P as es}from"./index-ysAnX8Hi.js";import{a as Ts,b as Qe}from"./Combination-TYhCc4jv.js";import{r as Ds}from"./index-BdXTtqAV.js";import{D as we,a as ke,b as Ce,c as B,d as _e}from"./dropdown-menu-DyRCHyY4.js";import{S as W,a as Z,b as K,c as J,d as S}from"./select-BDOb0ZK1.js";import{X as fe}from"./x-BPPDjH10.js";import{V as Fe}from"./video-BkVf65nQ.js";import{L as Le}from"./link-3REYFCNj.js";import{U as us}from"./upload-D5cMxgen.js";import{T as $e}from"./triangle-alert-Bz2ASMAl.js";import{E as je}from"./ellipsis-vertical-ByxKyld5.js";import{E as oe}from"./eye-DrCLqRJv.js";import{D as ye}from"./download-DAXH3RrD.js";import{S as Se}from"./square-pen-DxgcZK8Y.js";import{T as Be}from"./trash-2-BFBmoqwg.js";import{M as ss}from"./message-square-Q5LnU50P.js";import{f as ge}from"./formatDistanceToNow-D7eyLJlI.js";import{p as ne}from"./pt-BR-CXWZr0Zs.js";import{I as ze}from"./info-DB2hCK8Q.js";import{B as ns}from"./bell-v36tl0On.js";import{I as Ve}from"./input-BrWaMOrb.js";import{B as He}from"./book-open-CAn3t7Hm.js";import{S as ve}from"./search-bwbDgZQN.js";import{P as xe}from"./progress-DG81sUzt.js";import{f as he}from"./format-CxHpq9RK.js";import{t as hs}from"./en-US-azV9x4mt.js";import{C as We}from"./clipboard-list-zqwBk92M.js";import{A as Ps}from"./archive-BOEsudUe.js";import{a as qs}from"./addDays-TIrBYM62.js";import{c as Rs}from"./constructNow-C8CNs5uJ.js";import{i as Fs}from"./isSameDay-7UPP47mY.js";import{i as me}from"./isToday-DbOgdeJ3.js";import{C as Ze}from"./copy-M4T8qqHL.js";import{U as ds}from"./user-plus-BXgt3Odg.js";import{M as Ls}from"./mail-CxF3Tzce.js";import{T as os}from"./target--MqGdgEh.js";import{B as Me}from"./bot-Bgah8qmE.js";import{Z as $s}from"./zap-BsAyxcrO.js";import{B as cs}from"./brain-CV7jVDIa.js";import{S as gs}from"./settings-pQ42cErW.js";import{A as zs}from"./arrow-left-faOheEeC.js";import"./user-CCHLYTsx.js";import"./graduation-cap-CRbvieNe.js";import"./chart-column-CBFsA3dh.js";import"./index-B_kCUa_t.js";import"./chevron-right-C-DpTlMS.js";import"./check-Cifhij8e.js";import"./chevron-down--5IVxs-k.js";import"./chevron-up-Bc2ZkTy5.js";import"./differenceInCalendarMonths-Cr16ZqgI.js";import"./endOfMonth-BvBmjNQ6.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],Ke=Oe("chart-no-axes-column",Os);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Te=Oe("folder",Bs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Gs=Oe("layout-dashboard",Vs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Is=Oe("user-x",Us);function Qs(r){return+hs(r)>Date.now()}function De(r){return+hs(r)<Date.now()}function Ie(r,h){return Fs(r,qs(Rs(r),1),h)}const Hs=({classId:r,classData:h,onTabChange:g})=>{const x=Je(),[w,d]=i.useState(!0),[t,o]=i.useState({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0}),u=l=>{switch(l){case"Criar Atividade":x(`/dashboard/activities/create?classId=${r}`);break;case"Adicionar Aluno":g?.("students");break;case"Novo Material":g?.("library");break;case"Agendar Aula":v({title:"Em desenvolvimento",description:"Fun√ß√£o de agendar aulas ser√° implementada em breve"});break;case"Postar Comunicado":g?.("announcements");break;case"Corrigir Trabalhos":g?.("activities");break}};i.useEffect(()=>{y()},[r]);const y=async()=>{try{d(!0);const l=await Pe.getClassStats(r,async()=>{const[b,T,f]=await Promise.all([M.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",r).eq("role","student"),M.from("activity_class_assignments").select("*",{count:"exact",head:!0}).eq("class_id",r),M.from("submissions").select("grade, submitted_at",{count:"exact"}).not("grade","is",null).limit(1e3)]),A=f.data?.filter(R=>R.grade)||[],D=A.length>0?A.reduce((R,j)=>R+parseFloat(j.grade),0)/A.length:0,P=f.data?.filter(R=>R.submitted_at)||[],q=f.count>0?P.length/f.count*100:0;return{totalStudents:b.count||0,avgGrade:Number(D.toFixed(1)),onTimeRate:Math.round(q),openActivities:T.count||0,timestamp:new Date().toISOString()}});o(l)}catch(l){console.error("Erro ao carregar estat√≠sticas:",l),o({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0})}finally{d(!1)}};if(w)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})});const c=[{title:"Total de Alunos",value:t.totalStudents,icon:se,color:"blue",change:"+2 esta semana"},{title:"Nota M√©dia da Turma",value:t.avgGrade.toFixed(1),icon:Ne,color:t.avgGrade>=7?"green":t.avgGrade>=5?"yellow":"red",change:"+0.3 vs m√™s anterior"},{title:"Taxa de Entrega no Prazo",value:`${t.onTimeRate}%`,icon:Y,color:t.onTimeRate>=80?"green":t.onTimeRate>=60?"yellow":"red",change:"+5% vs per√≠odo anterior"},{title:"Atividades em Aberto",value:t.openActivities,icon:qe,color:t.openActivities>10?"red":t.openActivities>5?"yellow":"blue",change:"3 aguardando corre√ß√£o"}],p={blue:"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800",green:"bg-green-50 dark:bg-green-950 text-green-600 dark:text-green-400 border-green-200 dark:border-green-800",yellow:"bg-yellow-50 dark:bg-yellow-950 text-yellow-600 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",red:"bg-red-50 dark:bg-red-950 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800"};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:c.map((l,b)=>{const T=l.icon;return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:b*.1},children:e.jsxs(m,{className:`p-6 border-2 ${p[l.color]}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:`p-3 rounded-lg ${p[l.color]}`,children:e.jsx(T,{className:"w-6 h-6"})})}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:l.value}),e.jsx("div",{className:"text-sm font-medium mb-2",children:l.title}),e.jsx("div",{className:"text-xs opacity-75",children:l.change})]})},l.title)})}),e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-600"}),"Agenda de Aulas"]}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>v({title:"Em desenvolvimento",description:"Calend√°rio completo ser√° implementado em breve"}),children:"Ver Completa"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Nenhuma aula agendada nos pr√≥ximos dias"}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>u("Agendar Aula"),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Agendar Aula"]})]})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),"√öltimas Atividades Postadas"]}),e.jsx(E,{variant:"link",size:"sm",onClick:()=>g?.("activities"),children:"Ver todas"})]}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx(I,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhuma atividade postada"})]})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-yellow-600"}),"Alunos que Precisam de Aten√ß√£o"]}),e.jsx(E,{variant:"link",size:"sm",onClick:()=>g?.("students"),children:"Ver todos"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-green-300 dark:text-green-700 mx-auto mb-3"}),e.jsx("p",{className:"text-green-600 dark:text-green-400 font-medium mb-2",children:"Nenhum aluno em situa√ß√£o de alerta"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Parab√©ns! Todos est√£o acompanhando bem."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"A√ß√µes R√°pidas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[{icon:re,label:"Criar Atividade",color:"blue"},{icon:se,label:"Adicionar Aluno",color:"green"},{icon:I,label:"Novo Material",color:"purple"},{icon:ee,label:"Agendar Aula",color:"orange"},{icon:ue,label:"Postar Comunicado",color:"yellow"},{icon:Es,label:"Corrigir Trabalhos",color:"red"}].map(l=>{const b=l.icon;return e.jsx(m,{className:"p-4 hover:shadow-lg transition-shadow cursor-pointer group",onClick:()=>u(l.label),children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 group-hover:scale-110 transition-transform",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:l.label})]})},l.label)})})]})]})};var Ws=Ds();function Zs(){return Ws.useSyncExternalStore(Ks,()=>!0,()=>!1)}function Ks(){return()=>{}}var ts="Avatar",[Js]=Ms(ts),[Xs,vs]=Js(ts),fs=i.forwardRef((r,h)=>{const{__scopeAvatar:g,...x}=r,[w,d]=i.useState("idle");return e.jsx(Xs,{scope:g,imageLoadingStatus:w,onImageLoadingStatusChange:d,children:e.jsx(es.span,{...x,ref:h})})});fs.displayName=ts;var js="AvatarImage",ps=i.forwardRef((r,h)=>{const{__scopeAvatar:g,src:x,onLoadingStatusChange:w=()=>{},...d}=r,t=vs(js,g),o=Ys(x,d),u=Ts(y=>{w(y),t.onImageLoadingStatusChange(y)});return Qe(()=>{o!=="idle"&&u(o)},[o,u]),o==="loaded"?e.jsx(es.img,{...d,ref:h,src:x}):null});ps.displayName=js;var bs="AvatarFallback",Ns=i.forwardRef((r,h)=>{const{__scopeAvatar:g,delayMs:x,...w}=r,d=vs(bs,g),[t,o]=i.useState(x===void 0);return i.useEffect(()=>{if(x!==void 0){const u=window.setTimeout(()=>o(!0),x);return()=>window.clearTimeout(u)}},[x]),t&&d.imageLoadingStatus!=="loaded"?e.jsx(es.span,{...w,ref:h}):null});Ns.displayName=bs;function ms(r,h){return r?h?(r.src!==h&&(r.src=h),r.complete&&r.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ys(r,{referrerPolicy:h,crossOrigin:g}){const x=Zs(),w=i.useRef(null),d=x?(w.current||(w.current=new window.Image),w.current):null,[t,o]=i.useState(()=>ms(d,r));return Qe(()=>{o(ms(d,r))},[d,r]),Qe(()=>{const u=p=>()=>{o(p)};if(!d)return;const y=u("loaded"),c=u("error");return d.addEventListener("load",y),d.addEventListener("error",c),h&&(d.referrerPolicy=h),typeof g=="string"&&(d.crossOrigin=g),()=>{d.removeEventListener("load",y),d.removeEventListener("error",c)}},[d,g,h]),t}var ys=fs,ws=ps,ks=Ns;const as=Xe.forwardRef(({className:r,...h},g)=>e.jsx(ys,{ref:g,className:Ye("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...h})),rs=Xe.forwardRef(({className:r,...h},g)=>e.jsx(ws,{ref:g,className:Ye("aspect-square h-full w-full",r),...h})),ls=Xe.forwardRef(({className:r,...h},g)=>e.jsx(ks,{ref:g,className:Ye("flex h-full w-full items-center justify-center rounded-full bg-slate-100 text-slate-600 font-medium",r),...h}));as.displayName=ys.displayName;rs.displayName=ws.displayName;ls.displayName=ks.displayName;const et=({isOpen:r,onClose:h,classId:g,onSuccess:x})=>{const[w,d]=i.useState(!1),[t,o]=i.useState("text"),[u,y]=i.useState({title:"",content:"",link:"",file:null}),c=[{id:"text",label:"Texto",icon:I,desc:"Compartilhe um texto ou aviso"},{id:"video",label:"V√≠deo",icon:Fe,desc:"Adicione um v√≠deo do YouTube ou Vimeo"},{id:"link",label:"Link",icon:Le,desc:"Compartilhe um link externo"},{id:"image",label:"Imagem",icon:Re,desc:"Adicione fotos ou imagens"}],p=async l=>{if(l.preventDefault(),!u.title.trim()||!u.content.trim()){v({title:"Campos obrigat√≥rios",description:"Preencha t√≠tulo e conte√∫do",variant:"destructive"});return}try{d(!0);const{data:{user:b}}=await M.auth.getUser();if(!b)throw new Error("Usu√°rio n√£o autenticado");const{error:T}=await M.from("class_materials").insert({class_id:g,title:u.title,description:u.content,file_url:u.link||null,file_type:t==="video"?"video/url":t==="link"?"link":"text",category:"post",created_by:b.id,is_public:!1});if(T)throw T;await Pe.invalidateClass(g),v({title:"Post criado!",description:"Seu post foi publicado no mural"}),y({title:"",content:"",link:"",file:null}),o("text"),x?.(),h()}catch(b){console.error("Erro ao criar post:",b),v({title:"Erro ao criar post",description:b.message,variant:"destructive"})}finally{d(!1)}};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(m,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Nova Postagem"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Compartilhe conte√∫do com seus alunos"})]}),e.jsx("button",{onClick:h,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Tipo de Conte√∫do"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:c.map(l=>{const b=l.icon;return e.jsx("button",{type:"button",onClick:()=>o(l.id),className:`p-4 rounded-lg border-2 text-left transition-all ${t===l.id?"border-blue-600 bg-blue-50 dark:bg-blue-950":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:`w-5 h-5 ${t===l.id?"text-blue-600":"text-slate-600"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:l.label}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:l.desc})]})]})},l.id)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["T√≠tulo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:u.title,onChange:l=>y({...u,title:l.target.value}),placeholder:"Ex: Material sobre Fun√ß√µes Quadr√°ticas",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:200,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[u.title.length,"/200"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Conte√∫do ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:u.content,onChange:l=>y({...u,content:l.target.value}),placeholder:"Escreva o conte√∫do da postagem...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:2e3,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[u.content.length,"/2000"]})]}),t==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Link do V√≠deo"}),e.jsx("input",{type:"url",value:u.link,onChange:l=>y({...u,link:l.target.value}),placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),t==="link"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"URL do Link"}),e.jsx("input",{type:"url",value:u.link,onChange:l=>y({...u,link:l.target.value}),placeholder:"https://exemplo.com/artigo",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),t==="image"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Upload de Imagem"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(us,{className:"w-12 h-12 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Arraste uma imagem ou clique para selecionar"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"image-upload",onChange:l=>y({...u,file:l.target.files[0]})}),e.jsx(E,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>document.getElementById("image-upload").click(),children:"Selecionar Arquivo"}),u.file&&e.jsx("p",{className:"text-sm text-green-600 mt-2",children:u.file.name})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(E,{type:"button",variant:"outline",onClick:h,className:"flex-1",disabled:w,children:"Cancelar"}),e.jsx(E,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600",disabled:w,children:w?"Publicando...":"Publicar"})]})]})]})}):null},Ae=({isOpen:r,onClose:h,onConfirm:g,title:x,message:w,confirmText:d="Confirmar",cancelText:t="Cancelar",variant:o="danger"})=>{if(!r)return null;const u=()=>{g(),h()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(m,{className:"w-full max-w-md bg-white dark:bg-slate-900 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${o==="danger"?"bg-red-100 dark:bg-red-900/20":"bg-yellow-100 dark:bg-yellow-900/20"}`,children:e.jsx($e,{className:`w-6 h-6 ${o==="danger"?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`})}),e.jsx("h2",{className:"text-xl font-bold",children:x})]}),e.jsx("button",{onClick:h,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:w}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(E,{variant:"outline",onClick:h,children:t}),e.jsx(E,{onClick:u,className:o==="danger"?"bg-red-600 hover:bg-red-700 text-white":"bg-yellow-600 hover:bg-yellow-700 text-white",children:d})]})]})})},st=({classId:r})=>{const[h,g]=i.useState(!1),[x,w]=i.useState(!0),[d,t]=i.useState([]),[o,u]=i.useState("all"),[y,c]=i.useState({isOpen:!1,id:null,title:""});i.useEffect(()=>{p()},[r]);const p=async()=>{try{w(!0);const{data:a,error:F}=await M.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",r).order("created_at",{ascending:!1});if(F)throw F;t(a||[])}catch(a){console.error("Erro ao carregar posts:",a),v({title:"Erro ao carregar posts",description:a.message,variant:"destructive"})}finally{w(!1)}},l=()=>{g(!1),p()},b=a=>{a.file_url?window.open(a.file_url,"_blank"):v({title:"Conte√∫do n√£o dispon√≠vel",description:"Este post n√£o possui arquivo ou link associado"})},T=a=>{v({title:"Em desenvolvimento",description:"Fun√ß√£o de edi√ß√£o ser√° implementada em breve"})},f=a=>{v({title:"Em desenvolvimento",description:"Fun√ß√£o de fixar ser√° implementada em breve"})},A=a=>{a.file_url?window.open(a.file_url,"_blank"):v({title:"Arquivo n√£o dispon√≠vel",variant:"destructive"})},D=(a,F)=>{c({isOpen:!0,id:a,title:F})},P=async()=>{const{id:a,title:F}=y;try{const{error:_}=await M.from("class_materials").delete().eq("id",a);if(_)throw _;v({title:"‚úÖ Post deletado",description:`"${F}" foi removido com sucesso.`}),p()}catch(_){console.error("Erro ao deletar post:",_),v({title:"‚ùå Erro ao deletar post",description:_.message,variant:"destructive"})}},q=a=>a?a.includes("video")?Fe:a.includes("image")?Re:a.includes("pdf")?I:Le:I,R=a=>a?a.includes("video")?"bg-purple-100 text-purple-700":a.includes("image")?"bg-pink-100 text-pink-700":a.includes("pdf")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700",j=()=>o==="all"?d:d.filter(a=>{if(!a.file_type)return!1;switch(o){case"video":return a.file_type.includes("video");case"image":return a.file_type.includes("image");case"pdf":return a.file_type.includes("pdf");case"link":return a.file_type==="link";default:return!0}});if(x)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})});const C=j();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Mural de Conte√∫do"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[C.length," de ",d.length," posts"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{value:o,onValueChange:u,children:[e.jsx(Z,{className:"w-[180px]",children:e.jsx(K,{placeholder:"Filtrar por tipo"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todos os Tipos"}),e.jsx(S,{value:"video",children:"üìπ V√≠deos"}),e.jsx(S,{value:"pdf",children:"üìÑ PDFs"}),e.jsx(S,{value:"image",children:"üñºÔ∏è Imagens"}),e.jsx(S,{value:"link",children:"üîó Links"})]})]}),e.jsxs(E,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>g(!0),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Nova Postagem"]})]})]}),C.length===0?e.jsxs(m,{className:"p-12 text-center",children:[e.jsx(I,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:d.length===0?"Nenhum conte√∫do postado ainda":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:d.length===0?"Compartilhe materiais, v√≠deos e links com seus alunos":"Ajuste o filtro para ver mais resultados."}),d.length===0&&e.jsxs(E,{onClick:()=>g(!0),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Criar Primeira Postagem"]})]}):e.jsx("div",{className:"space-y-4",children:C.map((a,F)=>{const _=q(a.file_type);return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:F*.05},children:e.jsxs(m,{className:"p-6 hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsxs(as,{className:"w-10 h-10",children:[e.jsx(rs,{src:a.creator?.avatar_url}),e.jsx(ls,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white",children:a.creator?.full_name?.[0]||"P"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold",children:a.creator?.full_name||"Professor"}),e.jsx("span",{className:"text-sm text-slate-500",children:"‚Ä¢"}),e.jsx("span",{className:"text-sm text-slate-500",children:ge(new Date(a.created_at),{locale:ne,addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{className:R(a.file_type),children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),a.file_type?.split("/")[0]||"Arquivo"]}),a.category&&e.jsx(V,{variant:"outline",className:"text-xs",children:a.category})]})]})]}),e.jsxs(we,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsxs(B,{onClick:()=>b(a),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(B,{onClick:()=>A(a),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Baixar Arquivo"]}),e.jsxs(B,{onClick:()=>T(),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Editar Post"]}),e.jsxs(B,{onClick:()=>f(),children:[e.jsx(xs,{className:"w-4 h-4 mr-2"}),"Fixar no Topo"]}),e.jsx(_e,{}),e.jsxs(B,{className:"text-red-600 dark:text-red-400",onClick:()=>D(a.id,a.title),children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Deletar Post"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:a.title}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 line-clamp-3",children:a.description||"Sem descri√ß√£o"})]}),a.file_type?.includes("image")&&a.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:a.file_url,alt:a.title,className:"w-full max-h-96 object-contain cursor-pointer",onClick:()=>window.open(a.file_url,"_blank")})}),a.file_type?.includes("video")&&a.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:a.file_url.includes("youtube")||a.file_url.includes("youtu.be")?e.jsx("div",{className:"aspect-video",children:e.jsx("iframe",{src:a.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allowFullScreen:!0,title:a.title})}):e.jsx("video",{controls:!0,className:"w-full max-h-96",children:e.jsx("source",{src:a.file_url})})}),a.file_type==="link"&&a.file_url&&e.jsx("a",{href:a.file_url,target:"_blank",rel:"noopener noreferrer",className:"mb-4 block p-4 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-950/40 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-blue-600 hover:underline truncate",children:a.file_url})]})}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:a.tags.map((z,Q)=>e.jsxs(V,{variant:"secondary",className:"text-xs",children:["#",z]},Q))}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),a.views||0," visualiza√ß√µes"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ss,{className:"w-4 h-4"}),"0 coment√°rios"]})]}),a.file_url&&e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>window.open(a.file_url,"_blank"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Baixar"]})]})]})},a.id)})}),e.jsx(et,{isOpen:h,onClose:()=>g(!1),classId:r,onSuccess:l}),e.jsx(Ae,{isOpen:y.isOpen,onClose:()=>c({isOpen:!1,id:null,title:""}),onConfirm:P,title:"Deletar Post",message:`Tem certeza que deseja deletar "${y.title}"? Esta a√ß√£o n√£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},tt=({isOpen:r,onClose:h,classId:g,onSuccess:x})=>{const[w,d]=i.useState(!1),[t,o]=i.useState({title:"",description:"",urgency:"info"}),u=[{value:"info",label:"üìò Informa√ß√£o",color:"blue",icon:ze},{value:"warning",label:"‚ö†Ô∏è Aviso",color:"yellow",icon:$e},{value:"urgent",label:"üîî Urgente",color:"orange",icon:ue},{value:"critical",label:"üö® Cr√≠tico",color:"red",icon:ie}],y=async l=>{if(l.preventDefault(),!t.title.trim()||!t.description.trim()){v({title:"Campos obrigat√≥rios",description:"Preencha t√≠tulo e descri√ß√£o",variant:"destructive"});return}try{d(!0);const{data:{user:b}}=await M.auth.getUser();if(!b)throw new Error("Usu√°rio n√£o autenticado");const{error:T}=await M.from("class_materials").insert({class_id:g,title:t.title,description:t.description,category:"announcement",tags:[t.urgency],created_by:b.id,is_public:!1,file_type:"announcement"});if(T)throw T;v({title:"Comunicado criado!",description:"Todos os alunos ser√£o notificados"}),o({title:"",description:"",urgency:"info"}),x?.(),h()}catch(b){console.error("Erro ao criar comunicado:",b),v({title:"Erro ao criar comunicado",description:b.message,variant:"destructive"})}finally{d(!1)}};if(!r)return null;const c=u.find(l=>l.value===t.urgency),p=c?.icon||ze;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(m,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Novo Comunicado"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Envie avisos importantes para todos os alunos"})]}),e.jsx("button",{onClick:h,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"N√≠vel de Urg√™ncia"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:u.map(l=>{const b=l.icon;return e.jsx("button",{type:"button",onClick:()=>o({...t,urgency:l.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${t.urgency===l.value?`border-${l.color}-600 bg-${l.color}-50 dark:bg-${l.color}-950/20`:"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:l.label})]})},l.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"T√≠tulo do Comunicado"}),e.jsx("input",{type:"text",value:t.title,onChange:l=>o({...t,title:l.target.value}),placeholder:"Ex: Altera√ß√£o de hor√°rio da prova",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Mensagem"}),e.jsx("textarea",{value:t.description,onChange:l=>o({...t,description:l.target.value}),placeholder:"Descreva o comunicado em detalhes...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 border-${c?.color}-200 bg-${c?.color}-50 dark:bg-${c?.color}-950/20`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${c?.color}-100`,children:e.jsx(p,{className:`w-5 h-5 text-${c?.color}-600`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:t.title||"T√≠tulo do comunicado"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:t.description||"Mensagem do comunicado aparecer√° aqui..."})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:h,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:w,className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",children:w?"Publicando...":"Publicar Comunicado"})]})]})]})})},at=({classId:r})=>{const[h,g]=i.useState(!0),[x,w]=i.useState([]),[d,t]=i.useState("all"),[o,u]=i.useState(!1),[y,c]=i.useState({isOpen:!1,id:null,title:""}),[p,l]=i.useState({total:0,info:0,warning:0,urgent:0,critical:0});i.useEffect(()=>{b()},[r]);const b=async()=>{try{g(!0);const{data:j,error:C}=await M.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",r).eq("category","announcement").order("created_at",{ascending:!1});if(C)throw C;const a=j||[];l({total:a.length,info:a.filter(F=>(F.tags?.[0]||"info")==="info").length,warning:a.filter(F=>(F.tags?.[0]||"info")==="warning").length,urgent:a.filter(F=>(F.tags?.[0]||"info")==="urgent").length,critical:a.filter(F=>(F.tags?.[0]||"info")==="critical").length}),w(a)}catch(j){console.error("Erro ao carregar comunicados:",j),v({title:"Erro ao carregar comunicados",description:j.message,variant:"destructive"})}finally{g(!1)}},T=j=>{switch(j){case"critical":return{icon:$e,color:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",borderColor:"border-red-200 dark:border-red-800",label:"Cr√≠tico"};case"urgent":return{icon:ns,color:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",borderColor:"border-orange-200 dark:border-orange-800",label:"Urgente"};case"warning":return{icon:ie,color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",borderColor:"border-yellow-200 dark:border-yellow-800",label:"Aviso"};default:return{icon:ze,color:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",borderColor:"border-blue-200 dark:border-blue-800",label:"Informa√ß√£o"}}},f=j=>{v({title:"Em desenvolvimento",description:"Visualiza√ß√£o de leituras ser√° implementada em breve"})},A=j=>{v({title:"Em desenvolvimento",description:"Edi√ß√£o de comunicados ser√° implementada em breve"})},D=j=>{v({title:"Em desenvolvimento",description:"Fixar comunicados ser√° implementado em breve"})},P=(j,C)=>{c({isOpen:!0,id:j,title:C})},q=async()=>{const{id:j,title:C}=y;try{const{error:a}=await M.from("class_materials").delete().eq("id",j);if(a)throw a;v({title:"‚úÖ Comunicado deletado",description:`"${C}" foi removido com sucesso.`}),b()}catch(a){console.error("Erro ao deletar comunicado:",a),v({title:"‚ùå Erro ao deletar comunicado",description:a.message,variant:"destructive"})}},R=d==="all"?x:x.filter(j=>(j.tags?.[0]||"info")===d);return h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(m,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(ue,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(ze,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.info}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Info"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(ie,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.warning}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Avisos"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900",children:e.jsx(ns,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.urgent}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Urgentes"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx($e,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Cr√≠ticos"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Comunicados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[R.length," de ",p.total," comunicados"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{value:d,onValueChange:t,children:[e.jsx(Z,{className:"w-[180px]",children:e.jsx(K,{placeholder:"Filtrar urg√™ncia"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todos"}),e.jsx(S,{value:"info",children:"üìò Informa√ß√£o"}),e.jsx(S,{value:"warning",children:"‚ö†Ô∏è Aviso"}),e.jsx(S,{value:"urgent",children:"üîî Urgente"}),e.jsx(S,{value:"critical",children:"üö® Cr√≠tico"})]})]}),e.jsxs(E,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",onClick:()=>u(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Novo Comunicado"]})]})]}),R.length===0?e.jsx(m,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:x.length===0?"Nenhum comunicado publicado":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:x.length===0?"Avisos importantes aparecer√£o aqui e notificar√£o todos os alunos":"Ajuste o filtro para ver mais resultados."}),x.length===0&&e.jsxs(E,{className:"bg-gradient-to-r from-orange-600 to-red-600",onClick:()=>u(!0),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Criar Primeiro Comunicado"]})]})}):e.jsx("div",{className:"space-y-4",children:R.map((j,C)=>{const a=j.tags?.[0]||"info",F=T(a),_=F.icon;return e.jsx(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:C*.05},children:e.jsx(m,{className:`p-6 border-2 ${F.borderColor} hover:shadow-lg transition-all`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${F.color}`,children:e.jsx(_,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:j.title}),e.jsx(V,{className:F.color,children:F.label})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(ee,{className:"w-3 h-3"}),ge(new Date(j.created_at),{locale:ne,addSuffix:!0})]})]}),e.jsxs(we,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsxs(B,{onClick:()=>f(),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Ver Leituras"]}),e.jsxs(B,{onClick:()=>A(),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(B,{onClick:()=>D(),children:[e.jsx(xs,{className:"w-4 h-4 mr-2"}),"Fixar no Topo"]}),e.jsx(_e,{}),e.jsxs(B,{className:"text-red-600",onClick:()=>P(j.id,j.title),children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 mb-3",children:j.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),"Todos os alunos"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),"0 leituras"]})]})]})]})})},j.id)})}),e.jsx(tt,{isOpen:o,onClose:()=>u(!1),classId:r,onSuccess:b}),e.jsx(Ae,{isOpen:y.isOpen,onClose:()=>c({isOpen:!1,id:null,title:""}),onConfirm:q,title:"Deletar Comunicado",message:`Tem certeza que deseja deletar "${y.title}"? Esta a√ß√£o n√£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},rt=({isOpen:r,onClose:h,classId:g,onSuccess:x})=>{const[w,d]=i.useState(!1),[t,o]=i.useState({title:"",description:"",category:"aulas",file:null,fileUrl:""}),u=[{value:"aulas",label:"üìö Aulas e Slides"},{value:"exercicios",label:"üìù Exerc√≠cios"},{value:"referencias",label:"üìñ Refer√™ncias"},{value:"complementar",label:"‚ûï Material Complementar"}],y=p=>{const l=p.target.files[0];l&&o({...t,file:l,title:t.title||l.name})},c=async p=>{if(p.preventDefault(),!t.title.trim()){v({title:"T√≠tulo obrigat√≥rio",description:"Digite um t√≠tulo para o material",variant:"destructive"});return}if(!t.file&&!t.fileUrl.trim()){v({title:"Arquivo ou link obrigat√≥rio",description:"Fa√ßa upload de um arquivo ou cole um link",variant:"destructive"});return}try{d(!0);const{data:{user:l}}=await M.auth.getUser();if(!l)throw new Error("Usu√°rio n√£o autenticado");let b=t.fileUrl,T="link",f=null;if(t.file){const D=`${Date.now()}_${t.file.name}`,P=`${g}/${D}`,{error:q}=await M.storage.from("class-materials").upload(P,t.file);if(q)throw q;const{data:{publicUrl:R}}=M.storage.from("class-materials").getPublicUrl(P);b=R,T=t.file.type,f=t.file.size}const{error:A}=await M.from("class_materials").insert({class_id:g,title:t.title,description:t.description||null,file_url:b,file_type:T,file_size:f,category:t.category,created_by:l.id,is_public:!1});if(A)throw A;v({title:"Material adicionado!",description:"O material est√° dispon√≠vel na biblioteca"}),o({title:"",description:"",category:"aulas",file:null,fileUrl:""}),x?.(),h()}catch(l){console.error("Erro ao adicionar material:",l),v({title:"Erro ao adicionar material",description:l.message,variant:"destructive"})}finally{d(!1)}};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(m,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Material"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Compartilhe arquivos e recursos com seus alunos"})]}),e.jsx("button",{onClick:h,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"T√≠tulo do Material"}),e.jsx("input",{type:"text",value:t.title,onChange:p=>o({...t,title:p.target.value}),placeholder:"Ex: Slides da Aula 1 - Introdu√ß√£o",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Categoria"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:u.map(p=>e.jsx("button",{type:"button",onClick:()=>o({...t,category:p.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${t.category===p.value?"border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsx("span",{className:"font-medium text-sm",children:p.label})},p.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Arquivo ou Link"}),e.jsx("div",{children:e.jsx("label",{className:"block",children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${t.file?"border-green-500 bg-green-50 dark:bg-green-950/20":"border-slate-300 dark:border-slate-700 hover:border-blue-600"}`,children:[t.file?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"text-sm font-medium mb-1 text-green-700 dark:text-green-300",children:["‚úì ",t.file.name]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[(t.file.size/1024/1024).toFixed(2)," MB"]}),e.jsx("button",{type:"button",onClick:p=>{p.preventDefault(),o({...t,file:null,title:""})},className:"mt-2 text-xs text-red-600 hover:underline",children:"Remover arquivo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),e.jsx("div",{className:"text-sm font-medium mb-1",children:"Clique para fazer upload"}),e.jsx("div",{className:"text-xs text-slate-500",children:"PDF, DOC, PPT, Imagens, V√≠deos (m√°x 50MB)"})]}),e.jsx("input",{type:"file",onChange:y,className:"hidden",accept:".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.mp4,.avi"})]})})}),e.jsx("div",{className:"text-center text-sm text-slate-500",children:"OU"}),e.jsx("div",{children:e.jsx("input",{type:"url",value:t.fileUrl,onChange:p=>o({...t,fileUrl:p.target.value}),placeholder:"Cole um link (Google Drive, YouTube, etc)",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Descri√ß√£o (opcional)"}),e.jsx("textarea",{value:t.description,onChange:p=>o({...t,description:p.target.value}),placeholder:"Adicione informa√ß√µes sobre o material...",rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:h,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:w,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:w?"Adicionando...":"Adicionar Material"})]})]})]})}):null},lt=({classId:r})=>{const[h,g]=i.useState(!0),[x,w]=i.useState([]),[d,t]=i.useState(""),[o,u]=i.useState("all"),[y,c]=i.useState("all"),[p,l]=i.useState(!1),[b,T]=i.useState(!1),[f,A]=i.useState({total:0,pdfs:0,videos:0,images:0,others:0}),[D,P]=i.useState({isOpen:!1,id:null,title:""});i.useEffect(()=>{q()},[r]);const q=async()=>{try{g(!0);const{data:k,error:L}=await M.from("class_materials").select(`
          *,
          uploader:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",r).neq("category","announcement").order("created_at",{ascending:!1});if(L)throw L;const s=k||[];A({total:s.length,pdfs:s.filter(n=>n.file_type?.includes("pdf")).length,videos:s.filter(n=>n.file_type?.includes("video")).length,images:s.filter(n=>n.file_type?.includes("image")).length,others:s.filter(n=>!n.file_type?.includes("pdf")&&!n.file_type?.includes("video")&&!n.file_type?.includes("image")).length}),w(s)}catch(k){console.error("Erro ao carregar materiais:",k),v({title:"Erro ao carregar materiais",description:k.message,variant:"destructive"})}finally{g(!1)}},R=k=>{k.file_url?window.open(k.file_url,"_blank"):v({title:"Arquivo n√£o dispon√≠vel",description:"Este material n√£o possui arquivo associado",variant:"destructive"})},j=k=>{v({title:"Em desenvolvimento",description:"Fun√ß√£o de edi√ß√£o ser√° implementada em breve"})},C=(k,L)=>{P({isOpen:!0,id:k,title:L})},a=async()=>{const{id:k,title:L}=D;try{const{error:s}=await M.from("class_materials").delete().eq("id",k);if(s)throw s;v({title:"‚úÖ Material deletado",description:`"${L}" foi removido com sucesso.`}),q()}catch(s){console.error("Erro ao deletar material:",s),v({title:"‚ùå Erro ao deletar material",description:s.message,variant:"destructive"})}},F=k=>k?k.includes("video")?Fe:k.includes("image")?Re:k.includes("pdf")?I:I:I,_=k=>k?k.includes("video")?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":k.includes("image")?"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300":k.includes("pdf")?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"bg-slate-100 text-slate-700",z=k=>{if(!k)return"N/A";const L=k/(1024*1024);return L<1?`${(k/1024).toFixed(0)} KB`:`${L.toFixed(1)} MB`},Q=x.filter(k=>{if(d){const L=d.toLowerCase();if(!k.title?.toLowerCase().includes(L)&&!k.description?.toLowerCase().includes(L))return!1}return!(o!=="all"&&k.category!==o||y!=="all"&&(y==="pdf"&&!k.file_type?.includes("pdf")||y==="video"&&!k.file_type?.includes("video")||y==="image"&&!k.file_type?.includes("image")))}),ae=Q.reduce((k,L)=>{const s=L.category||"Sem Categoria";return k[s]||(k[s]=[]),k[s].push(L),k},{});return h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(m,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(He,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(I,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.pdfs}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"PDFs"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(Fe,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.videos}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"V√≠deos"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-pink-200 dark:border-pink-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-pink-100 dark:bg-pink-900",children:e.jsx(Re,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.images}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Imagens"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(Te,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.others}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Outros"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Biblioteca de Materiais"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[Q.length," de ",f.total," materiais"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{v({title:"Em desenvolvimento",description:"Fun√ß√£o de m√≥dulos ser√° implementada em breve"})},children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Novo M√≥dulo"]}),e.jsxs(E,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>T(!0),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Adicionar Material"]})]})]}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ve,{placeholder:"Buscar material...",value:d,onChange:k=>t(k.target.value),className:"pl-10"})]})}),e.jsxs(W,{value:y,onValueChange:c,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Tipo"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todos os Tipos"}),e.jsx(S,{value:"pdf",children:"üìÑ PDFs"}),e.jsx(S,{value:"video",children:"üìπ V√≠deos"}),e.jsx(S,{value:"image",children:"üñºÔ∏è Imagens"})]})]}),e.jsxs(W,{value:o,onValueChange:u,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Categoria"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todas Categorias"}),e.jsx(S,{value:"aulas",children:"Aulas"}),e.jsx(S,{value:"exercicios",children:"Exerc√≠cios"}),e.jsx(S,{value:"referencias",children:"Refer√™ncias"}),e.jsx(S,{value:"complementar",children:"Material Complementar"})]})]})]})}),Q.length===0?e.jsx(m,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(He,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:x.length===0?"Biblioteca Vazia":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:x.length===0?"Comece organizando seus materiais em m√≥dulos e t√≥picos":"Ajuste os filtros para ver mais resultados."}),x.length===0&&e.jsxs(E,{children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Criar Primeiro M√≥dulo"]})]})}):e.jsx("div",{className:"space-y-6",children:Object.entries(ae).map(([k,L])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Te,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:k}),e.jsx(V,{variant:"secondary",children:L.length})]}),e.jsx("div",{className:"space-y-3 ml-6",children:L.map((s,n)=>{const N=F(s.file_type),$=_(s.file_type);return e.jsx(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:n*.05},children:e.jsxs(m,{className:"p-4 hover:shadow-md transition-shadow",children:[s.file_url&&s.file_type?.includes("image")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:s.file_url,alt:s.title,className:"w-full max-h-64 object-contain cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(s.file_url,"_blank")})}),s.file_url&&s.file_type?.includes("video")&&!s.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsxs("video",{controls:!0,className:"w-full max-h-64",children:[e.jsx("source",{src:s.file_url}),"Seu navegador n√£o suporta v√≠deos."]})}),s.file_url&&s.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800 aspect-video",children:e.jsx("iframe",{src:s.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${$}`,children:e.jsx(N,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-1",children:s.description||"Sem descri√ß√£o"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsx("span",{children:z(s.file_size)}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),ge(new Date(s.created_at),{locale:ne,addSuffix:!0})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex gap-1",children:s.tags.slice(0,2).map((G,pe)=>e.jsx(V,{variant:"outline",className:"text-xs",children:G},pe))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.file_url&&e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>window.open(s.file_url,"_blank"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Baixar"]}),e.jsxs(we,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsxs(B,{onClick:()=>R(s),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Visualizar"]}),e.jsxs(B,{onClick:()=>j(),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsx(_e,{}),e.jsxs(B,{className:"text-red-600",onClick:()=>C(s.id,s.title),children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})]})},s.id)})})]},k))}),e.jsx(rt,{isOpen:b,onClose:()=>T(!1),classId:r,onSuccess:q}),e.jsx(Ae,{isOpen:D.isOpen,onClose:()=>P({isOpen:!1,id:null,title:""}),onConfirm:a,title:"Deletar Material",message:`Tem certeza que deseja deletar "${D.title}"? Esta a√ß√£o n√£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},it=({isOpen:r,onClose:h,classId:g,onSuccess:x})=>{const[w,d]=i.useState(!1),[t,o]=i.useState([]),[u,y]=i.useState(""),[c,p]=i.useState(null);i.useEffect(()=>{r&&l()},[r]);const l=async()=>{try{d(!0);const{data:{user:f}}=await M.auth.getUser();if(!f)return;const{data:A,error:D}=await M.from("activities").select("*").eq("created_by",f.id).order("created_at",{ascending:!1});if(D)throw D;const{data:P,error:q}=await M.from("activity_class_assignments").select("activity_id").eq("class_id",g);if(q)throw q;const R=P.map(C=>C.activity_id),j=A.filter(C=>!R.includes(C.id));o(j)}catch(f){console.error("Erro ao carregar atividades:",f),v({title:"Erro ao carregar",description:f.message,variant:"destructive"})}finally{d(!1)}},b=async()=>{if(!c){v({title:"Selecione uma atividade",description:"Escolha uma atividade para postar na turma",variant:"destructive"});return}try{d(!0);const{error:f}=await M.from("activity_class_assignments").insert({activity_id:c.id,class_id:g,assigned_at:new Date().toISOString()});if(f)throw f;v({title:"‚úÖ Atividade postada!",description:`"${c.title}" foi adicionada √† turma`}),x?.(),h()}catch(f){console.error("Erro ao postar atividade:",f),v({title:"Erro ao postar",description:f.message,variant:"destructive"})}finally{d(!1)}};if(!r)return null;const T=t.filter(f=>f.title?.toLowerCase().includes(u.toLowerCase())||f.description?.toLowerCase().includes(u.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(m,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Postar Atividade Existente"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha uma atividade criada anteriormente"})]}),e.jsx("button",{onClick:h,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ve,{placeholder:"Buscar atividades...",value:u,onChange:f=>y(f.target.value),className:"pl-10"})]}),w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):T.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:t.length===0?"Nenhuma atividade dispon√≠vel":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:t.length===0?"Crie atividades primeiro para poder post√°-las aqui":"Tente buscar por outro termo"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:T.map(f=>e.jsx(m,{className:`p-4 cursor-pointer transition-all hover:shadow-md ${c?.id===f.id?"border-2 border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border hover:border-blue-300"}`,onClick:()=>p(f),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:f.title}),e.jsx(V,{variant:f.status==="active"?"default":"secondary",children:f.status==="active"?"Publicada":"Rascunho"})]}),f.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:f.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[f.due_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),"Prazo: ",he(new Date(f.due_date),"dd/MM/yyyy '√†s' HH:mm",{locale:ne})]}),f.max_grade&&e.jsxs("span",{children:["Nota: ",f.max_grade," pts"]})]})]}),c?.id===f.id&&e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"w-4 h-4 text-white"})})})]})},f.id))}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t dark:border-slate-700",children:[e.jsx(E,{type:"button",variant:"outline",onClick:h,children:"Cancelar"}),e.jsx(E,{onClick:b,disabled:w||!c,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:w?"Postando...":"Postar Atividade"})]})]})]})})},nt=({classId:r})=>{const h=Je(),[g,x]=i.useState(!0),[w,d]=i.useState([]),[t,o]=i.useState({isOpen:!1,id:null,title:""}),[u,y]=i.useState(""),[c,p]=i.useState("all"),[l,b]=i.useState("all"),[T,f]=i.useState("all"),[A,D]=i.useState("recent"),[P,q]=i.useState(!1),[R,j]=i.useState({total:0,published:0,draft:0,overdue:0,pendingCorrections:0});i.useEffect(()=>{C()},[r]);const C=async()=>{try{x(!0);const{data:s,error:n}=await M.from("activity_class_assignments").select(`
          id,
          assigned_at,
          activity:activities(
            id,
            title,
            description,
            type,
            due_date,
            max_score,
            status,
            created_at
          )
        `).eq("class_id",r).order("assigned_at",{ascending:!1});if(n)throw n;const{count:N}=await M.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",r).eq("role","student"),$=await Promise.all((s||[]).map(async O=>{const X=O.activity?.id;if(!X)return{...O,submissionsCount:0,totalStudents:N||0,pendingCorrections:0,avgGrade:null,submissionRate:0};const{data:de}=await M.from("submissions").select("id, status, grade").eq("activity_id",X),le=de?.length||0,Ee=de?.filter(U=>U.status==="submitted").length||0,ce=de?.filter(U=>U.grade!==null).map(U=>parseFloat(U.grade))||[],be=ce.length>0?ce.reduce((U,Ue)=>U+Ue,0)/ce.length:null,Ge=N>0?le/N*100:0;return{...O,submissionsCount:le,totalStudents:N||0,pendingCorrections:Ee,avgGrade:be,submissionRate:Ge}})),G=new Date,pe={total:$.length,published:$.filter(O=>O.activity?.is_published).length,draft:$.filter(O=>!O.activity?.is_published).length,overdue:$.filter(O=>O.activity?.due_date&&De(new Date(O.activity.due_date))&&!me(new Date(O.activity.due_date))).length,pendingCorrections:$.reduce((O,X)=>O+(X.pendingCorrections||0),0)};d($),j(pe)}catch(s){console.error("Erro ao carregar atividades:",s),v({title:"Erro ao carregar atividades",description:s.message,variant:"destructive"}),d([])}finally{x(!1)}},a=()=>{let s=w;if(u){const n=u.toLowerCase();s=s.filter(N=>N.activity?.title?.toLowerCase().includes(n)||N.activity?.description?.toLowerCase().includes(n))}if(c!=="all"&&(s=s.filter(n=>c==="published"?n.activity?.status==="active":c==="draft"?n.activity?.status==="draft":c==="pending_correction"?n.pendingCorrections>0:!0)),l!=="all"&&(s=s.filter(n=>n.activity?.type===l)),T!=="all"){const n=new Date;s=s.filter(N=>{if(!N.activity?.due_date)return T==="no_deadline";const $=new Date(N.activity.due_date);switch(T){case"overdue":return De($)&&!me($);case"today":return me($);case"tomorrow":return Ie($);case"week":return Qs($)&&$<=new Date(n.getTime()+10080*60*1e3);default:return!0}})}return s.sort((n,N)=>{switch(A){case"recent":return new Date(N.assigned_at)-new Date(n.assigned_at);case"deadline":return n.activity?.due_date?N.activity?.due_date?new Date(n.activity.due_date)-new Date(N.activity.due_date):-1:1;case"submissions":return N.submissionsCount-n.submissionsCount;case"corrections":return N.pendingCorrections-n.pendingCorrections;case"title":return(n.activity?.title||"").localeCompare(N.activity?.title||"");default:return 0}}),s},F=s=>{if(!s)return"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300";const n=new Date(s);return De(n)&&!me(n)?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":me(n)||Ie(n)?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"},_=s=>{if(!s)return"Sem prazo";const n=new Date(s);return me(n)?`Hoje √†s ${he(n,"HH:mm")}`:Ie(n)?`Amanh√£ √†s ${he(n,"HH:mm")}`:De(n)?`Atrasado - ${he(n,"dd/MM/yyyy")}`:ge(n,{locale:ne,addSuffix:!0})},z=s=>{v({title:"üìä Exportar Notas",description:"Fun√ß√£o de exporta√ß√£o ser√° implementada em breve"})},Q=s=>{v({title:"üì¶ Arquivar Atividade",description:"Fun√ß√£o de arquivar ser√° implementada em breve"})},ae=(s,n)=>{o({isOpen:!0,id:s,title:n})},k=async()=>{const{id:s,title:n}=t;try{const{error:N}=await M.from("activity_class_assignments").delete().eq("activity_id",s).eq("class_id",r);if(N)throw N;v({title:"‚úÖ Atividade removida",description:`"${n}" foi removida da turma com sucesso.`}),C()}catch(N){console.error("Erro ao deletar atividade:",N),v({title:"‚ùå Erro ao deletar atividade",description:N.message,variant:"destructive"})}};if(g)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})});const L=a();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(m,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(We,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(Y,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.published}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Publicadas"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(I,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.draft}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Rascunhos"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(qe,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.overdue}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Atrasadas"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(ie,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"P/ Corrigir"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atividades da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[L.length," de ",R.total," atividades"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>q(!0),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Postar Existente"]}),e.jsxs(E,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>h(`/atividades/criar?classId=${r}`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Nova Atividade"]})]})]}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ve,{placeholder:"Buscar atividade...",value:u,onChange:s=>y(s.target.value),className:"pl-10"})]})}),e.jsxs(W,{value:c,onValueChange:p,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Status"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todos os Status"}),e.jsx(S,{value:"published",children:"Publicadas"}),e.jsx(S,{value:"draft",children:"Rascunhos"}),e.jsx(S,{value:"pending_correction",children:"Pendentes"})]})]}),e.jsxs(W,{value:T,onValueChange:f,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Prazo"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todos os Prazos"}),e.jsx(S,{value:"overdue",children:"Atrasadas"}),e.jsx(S,{value:"today",children:"Hoje"}),e.jsx(S,{value:"tomorrow",children:"Amanh√£"}),e.jsx(S,{value:"week",children:"Esta Semana"}),e.jsx(S,{value:"no_deadline",children:"Sem Prazo"})]})]}),e.jsxs(W,{value:A,onValueChange:D,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Ordenar"})}),e.jsxs(J,{children:[e.jsx(S,{value:"recent",children:"Mais Recentes"}),e.jsx(S,{value:"deadline",children:"Prazo (pr√≥ximo)"}),e.jsx(S,{value:"submissions",children:"Submiss√µes"}),e.jsx(S,{value:"corrections",children:"Corre√ß√µes"}),e.jsx(S,{value:"title",children:"T√≠tulo (A-Z)"})]})]})]})}),L.length===0?e.jsx(m,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(We,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:w.length===0?"Nenhuma atividade postada":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:w.length===0?"Crie ou poste uma atividade para come√ßar.":"Ajuste os filtros para ver mais resultados."}),w.length===0&&e.jsxs(E,{onClick:()=>h(`/dashboard/activities/create?classId=${r}`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Criar Primeira Atividade"]})]})}):e.jsx("div",{className:"space-y-3",children:L.map((s,n)=>{const N=s.activity,$=s.submissionRate>=80?"text-green-600":s.submissionRate>=50?"text-yellow-600":"text-red-600";return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.05},children:e.jsx(m,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500",children:e.jsx(I,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:N?.title||"Sem t√≠tulo"}),!N?.is_published&&e.jsx(V,{variant:"secondary",className:"text-xs",children:"Rascunho"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:N?.description||"Sem descri√ß√£o"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(V,{variant:"outline",className:"text-xs",children:N?.type==="assignment"?"Trabalho":N?.type==="quiz"?"Quiz":N?.type==="exam"?"Prova":N?.type||"Atividade"}),e.jsxs(V,{className:`text-xs ${F(N?.due_date)}`,children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),_(N?.due_date)]}),e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),"Postado ",ge(new Date(s.assigned_at),{locale:ne,addSuffix:!0})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(se,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:`text-sm font-semibold ${$}`,children:[s.submissionRate.toFixed(0),"%"]})]}),e.jsx(xe,{value:s.submissionRate,className:"h-2 mb-1"}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.submissionsCount,"/",s.totalStudents," submiss√µes"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${s.pendingCorrections>0?"text-yellow-600":"text-green-600"}`,children:s.pendingCorrections}),e.jsx("div",{className:"text-xs text-slate-500",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.avgGrade?.toFixed(1)||"‚Äî"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota M√©dia"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>h(`/dashboard/activities/${N?.id}/submissions`),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Ver Submiss√µes"]}),e.jsxs(we,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsxs(B,{onClick:()=>h(`/dashboard/activities/${N?.activity?.id}/edit`),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Editar Atividade"]}),e.jsxs(B,{onClick:()=>z(),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Exportar Notas"]}),e.jsx(_e,{}),e.jsxs(B,{onClick:()=>Q(),children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),"Arquivar"]}),e.jsxs(B,{className:"text-red-600 dark:text-red-400",onClick:()=>ae(N?.activity?.id,N?.activity?.title),children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})})},s.id)})}),e.jsx(it,{isOpen:P,onClose:()=>q(!1),classId:r,onSuccess:C}),e.jsx(Ae,{isOpen:t.isOpen,onClose:()=>o({isOpen:!1,id:null,title:""}),onConfirm:k,title:"Remover Atividade da Turma",message:`Tem certeza que deseja remover "${t.title}" desta turma? Esta a√ß√£o n√£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},dt=({isOpen:r,onClose:h,classId:g,classData:x,onSuccess:w})=>{const[d,t]=i.useState(!1),[o,u]=i.useState("email"),[y,c]=i.useState(""),[p,l]=i.useState(""),[b,T]=i.useState(null),f=x?.invite_code?`${window.location.origin}/join/${x.invite_code}`:"",A=async()=>{if(!y.trim()){v({title:"Email obrigat√≥rio",description:"Digite um email para buscar",variant:"destructive"});return}try{t(!0);const{data:j,error:C}=await M.from("profiles").select("id, full_name, email, avatar_url").eq("email",y.toLowerCase()).eq("role","student").single();if(C||!j){T({found:!1,searched:!0}),v({title:"Aluno n√£o encontrado",description:"Email n√£o cadastrado no sistema como aluno",variant:"destructive"});return}T({found:!0,user:j})}catch(j){console.error("Erro ao buscar email:",j)}finally{t(!1)}},D=async()=>{if(b?.user)try{t(!0);const{data:j}=await M.from("class_members").select("id").eq("class_id",g).eq("user_id",b.user.id).single();if(j){v({title:"Aluno j√° est√° na turma",variant:"destructive"});return}const{data:C,error:a}=await M.from("class_members").insert({class_id:g,user_id:b.user.id,role:"student",joined_at:new Date().toISOString()}).select();if(a)throw a;if(!C||C.length===0)throw new Error("Falha ao adicionar aluno - nenhum registro criado");console.log("‚úÖ Aluno adicionado com sucesso:",C[0]);try{await Pe.invalidateClass(g)}catch(F){console.warn("Aviso: Erro ao invalidar cache, mas aluno foi adicionado:",F)}v({title:"‚úÖ Aluno adicionado com sucesso!",description:`${b.user.full_name} agora faz parte da turma. Pe√ßa para ele fazer logout e login novamente.`}),c(""),T(null),w?.()}catch(j){console.error("Erro ao adicionar aluno:",j),v({title:"Erro ao adicionar aluno",description:j.message,variant:"destructive"})}finally{t(!1)}},P=async()=>{const j=p.split(`
`).map(C=>C.trim()).filter(C=>C&&C.includes("@"));if(j.length===0){v({title:"Nenhum email v√°lido",variant:"destructive"});return}try{t(!0);let C=0,a=0,F=0;for(const _ of j){const{data:z}=await M.from("profiles").select("id").eq("email",_.toLowerCase()).eq("role","student").single();if(!z){a++;continue}const{data:Q}=await M.from("class_members").select("id").eq("class_id",g).eq("user_id",z.id).single();if(Q){F++;continue}await M.from("class_members").insert({class_id:g,user_id:z.id,role:"student",joined_at:new Date().toISOString()}),C++}await Pe.invalidateClass(g),v({title:"Importa√ß√£o conclu√≠da",description:`${C} alunos adicionados, ${a} n√£o encontrados, ${F} j√° eram membros`}),l(""),w?.()}catch(C){console.error("Erro na importa√ß√£o:",C),v({title:"Erro na importa√ß√£o",description:C.message,variant:"destructive"})}finally{t(!1)}},q=()=>{navigator.clipboard.writeText(f),v({title:"Link copiado!",description:"Link de convite copiado para √°rea de transfer√™ncia"})},R=()=>{navigator.clipboard.writeText(x.invite_code),v({title:"C√≥digo copiado!",description:"C√≥digo de convite copiado"})};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(m,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Aluno"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha um m√©todo para adicionar alunos"})]}),e.jsx("button",{onClick:h,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex gap-2",children:[{id:"email",label:"Buscar por Email",icon:ve},{id:"invite_link",label:"Link de Convite",icon:Le}].map(j=>{const C=j.icon;return e.jsxs("button",{onClick:()=>u(j.id),className:`flex-1 px-4 py-2 rounded-lg font-medium text-sm transition-all ${o===j.id?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200"}`,children:[e.jsx(C,{className:"w-4 h-4 inline mr-2"}),j.label]},j.id)})}),o==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email do Aluno"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:y,onChange:j=>c(j.target.value),placeholder:"aluno@exemplo.com",className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",onKeyPress:j=>j.key==="Enter"&&A()}),e.jsxs(E,{onClick:A,disabled:d,children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),d?"Buscando...":"Buscar"]})]})]}),b?.found&&b.user&&e.jsx(m,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:b.user.full_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:b.user.full_name}),e.jsx("div",{className:"text-sm text-slate-600",children:b.user.email})]})]}),e.jsx(E,{onClick:D,disabled:d,children:d?"Adicionando...":"Adicionar √† Turma"})]})}),b?.searched&&!b?.found&&e.jsx(m,{className:"p-4 bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-1",children:"‚ùå Email n√£o encontrado"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Verifique se o email est√° correto ou se o aluno j√° est√° cadastrado no sistema."})]})})]}),o==="invite_link"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(m,{className:"p-4 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"C√≥digo de Convite"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-lg font-mono",children:x?.invite_code||"N/A"}),e.jsx(E,{variant:"outline",size:"sm",onClick:R,children:e.jsx(Ze,{className:"w-4 h-4"})})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Link de Convite"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:f,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-sm"}),e.jsx(E,{variant:"outline",size:"sm",onClick:q,children:e.jsx(Ze,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Compartilhe o c√≥digo ou link com os alunos. Eles poder√£o entrar automaticamente na turma."})]}),o==="bulk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Lista de Emails"}),e.jsx("textarea",{value:p,onChange:j=>l(j.target.value),placeholder:`aluno1@exemplo.com
aluno2@exemplo.com
aluno3@exemplo.com`,rows:8,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Cole uma lista de emails (um por linha)"})]}),e.jsx(E,{onClick:P,disabled:d,className:"w-full",children:d?"Importando...":"Importar Alunos"})]})]})]})}):null},ot=({classId:r,classData:h})=>{const[g,x]=i.useState(!0),[w,d]=i.useState([]),[t,o]=i.useState(""),[u,y]=i.useState({isOpen:!1,id:null,name:""}),[c,p]=i.useState("all"),[l,b]=i.useState("all"),[T,f]=i.useState("all"),[A,D]=i.useState("name"),[P,q]=i.useState(!1),[R,j]=i.useState({total:0,active:0,alert:0,critical:0});i.useEffect(()=>{C()},[r]);const C=async()=>{try{x(!0);const{data:s,error:n}=await M.from("class_members").select(`
          *,
          profile:profiles!inner(id, full_name, email, avatar_url)
        `).eq("class_id",r).eq("role","student").order("joined_at",{ascending:!1});if(n)throw n;const{data:N}=await M.from("activity_class_assignments").select("activity_id").eq("class_id",r),$=N?.map(O=>O.activity_id)||[],G=await Promise.all((s||[]).map(async O=>{if(!O.user_id||$.length===0)return{...O,avgGrade:null,deliveryRate:0,submissionsCount:0,totalActivities:$.length,status:"active",lastActivity:null};const{data:X}=await M.from("submissions").select("grade, status, submitted_at").eq("student_id",O.user_id).in("activity_id",$),de=X?.map(U=>parseFloat(U.grade)).filter(U=>!isNaN(U))||[],le=de.length>0?de.reduce((U,Ue)=>U+Ue,0)/de.length:null,Ee=X?.filter(U=>U.status==="submitted"||U.status==="graded").length||0,ce=$.length>0?Ee/$.length*100:0;let be="active";le!==null&&le<5?be="critical":(le!==null&&le<6||ce<60)&&(be="alert");const Ge=X&&X.length>0?new Date(Math.max(...X.map(U=>new Date(U.submitted_at||0)))):null;return{...O,avgGrade:le,deliveryRate:ce,submissionsCount:Ee,totalActivities:$.length,status:be,lastActivity:Ge}})),pe={total:G.length,active:G.filter(O=>O.status==="active").length,alert:G.filter(O=>O.status==="alert").length,critical:G.filter(O=>O.status==="critical").length};d(G),j(pe)}catch(s){console.error("Erro ao carregar alunos:",s),v({title:"Erro ao carregar alunos",description:s.message,variant:"destructive"}),d([])}finally{x(!1)}},a=()=>{let s=w;if(t){const n=t.toLowerCase();s=s.filter(N=>N.profile?.full_name?.toLowerCase().includes(n)||N.profile?.email?.toLowerCase().includes(n))}return c!=="all"&&(s=s.filter(n=>n.status===c)),l!=="all"&&(s=s.filter(n=>{if(!n.avgGrade)return l==="none";switch(l){case"excellent":return n.avgGrade>=9;case"good":return n.avgGrade>=7&&n.avgGrade<9;case"regular":return n.avgGrade>=5&&n.avgGrade<7;case"low":return n.avgGrade<5;default:return!0}})),T!=="all"&&(s=s.filter(n=>{switch(T){case"high":return n.deliveryRate>=80;case"medium":return n.deliveryRate>=50&&n.deliveryRate<80;case"low":return n.deliveryRate<50;default:return!0}})),s.sort((n,N)=>{switch(A){case"name":return(n.profile?.full_name||"").localeCompare(N.profile?.full_name||"");case"grade":return(N.avgGrade||0)-(n.avgGrade||0);case"delivery":return N.deliveryRate-n.deliveryRate;case"recent":return new Date(N.joined_at)-new Date(n.joined_at);default:return 0}}),s},F=s=>{v({title:"Em desenvolvimento",description:"P√°gina de detalhes do aluno ser√° implementada em breve"})},_=s=>{v({title:"Em desenvolvimento",description:"Visualiza√ß√£o de atividades do aluno ser√° implementada em breve"})},z=s=>{v({title:"Em desenvolvimento",description:"Sistema de mensagens ser√° implementado em breve"})},Q=(s,n)=>{y({isOpen:!0,id:s,name:n})},ae=async()=>{const{id:s,name:n}=u;try{const{error:N}=await M.from("class_members").delete().eq("user_id",s).eq("class_id",r);if(N)throw N;v({title:"‚úÖ Aluno removido",description:`${n} foi removido da turma com sucesso.`}),C()}catch(N){console.error("Erro ao remover aluno:",N),v({title:"‚ùå Erro ao remover aluno",description:N.message,variant:"destructive"})}},k=()=>{const s=a(),n=[["Nome","Email","Nota M√©dia","Taxa de Entrega","Status","Data de Entrada"],...s.map(G=>[G.profile?.full_name||"",G.profile?.email||"",G.avgGrade?.toFixed(1)||"N/A",`${G.deliveryRate.toFixed(0)}%`,G.status==="active"?"Ativo":G.status==="alert"?"Alerta":"Cr√≠tico",he(new Date(G.joined_at),"dd/MM/yyyy",{locale:ne})])].map(G=>G.join(",")).join(`
`),N=new Blob([n],{type:"text/csv;charset=utf-8;"}),$=document.createElement("a");$.href=URL.createObjectURL(N),$.download=`alunos_${h?.name||"turma"}_${he(new Date,"yyyy-MM-dd")}.csv`,$.click(),v({title:"Lista exportada",description:"Arquivo CSV baixado com sucesso."})};if(g)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})});const L=a();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(m,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(se,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(Y,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.active}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Ativos"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(ie,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.alert}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Em Alerta"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(ie,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Cr√≠tico"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Alunos da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[L.length," de ",R.total," alunos"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:k,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(E,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>q(!0),children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Adicionar Aluno"]})]})]}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ve,{placeholder:"Buscar por nome ou email...",value:t,onChange:s=>o(s.target.value),className:"pl-10"})]})}),e.jsxs(W,{value:c,onValueChange:p,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Status"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todos os Status"}),e.jsx(S,{value:"active",children:"Ativo"}),e.jsx(S,{value:"alert",children:"Em Alerta"}),e.jsx(S,{value:"critical",children:"Cr√≠tico"})]})]}),e.jsxs(W,{value:l,onValueChange:b,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Nota"})}),e.jsxs(J,{children:[e.jsx(S,{value:"all",children:"Todas as Notas"}),e.jsx(S,{value:"excellent",children:"Excelente (‚â•9.0)"}),e.jsx(S,{value:"good",children:"Bom (7.0-8.9)"}),e.jsx(S,{value:"regular",children:"Regular (5.0-6.9)"}),e.jsx(S,{value:"low",children:"Baixo (<5.0)"}),e.jsx(S,{value:"none",children:"Sem Nota"})]})]}),e.jsxs(W,{value:A,onValueChange:D,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Ordenar"})}),e.jsxs(J,{children:[e.jsx(S,{value:"name",children:"Nome (A-Z)"}),e.jsx(S,{value:"grade",children:"Nota (maior)"}),e.jsx(S,{value:"delivery",children:"Taxa Entrega"}),e.jsx(S,{value:"recent",children:"Mais Recentes"})]})]})]})}),L.length===0?e.jsx(m,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:w.length===0?"Nenhum aluno na turma":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:w.length===0?"Adicione alunos ou compartilhe o c√≥digo de convite da turma.":"Ajuste os filtros para ver mais resultados."}),w.length===0&&e.jsxs(E,{onClick:()=>q(!0),children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Adicionar Primeiro Aluno"]})]})}):e.jsx("div",{className:"space-y-3",children:L.map((s,n)=>{const N=s.avgGrade>=7?"text-green-600":s.avgGrade>=5?"text-yellow-600":"text-red-600",$=s.deliveryRate>=80?"text-green-600":s.deliveryRate>=60?"text-yellow-600":"text-red-600";return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.05},children:e.jsx(m,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs(as,{className:"w-12 h-12",children:[e.jsx(rs,{src:s.profile?.avatar_url}),e.jsx(ls,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white font-bold",children:s.profile?.full_name?.[0]||"A"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg",children:s.profile?.full_name||"Nome n√£o dispon√≠vel"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.profile?.email||"Email n√£o dispon√≠vel"}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2 mt-1",children:[e.jsx(ee,{className:"w-3 h-3"}),"Entrou ",ge(new Date(s.joined_at),{locale:ne,addSuffix:!0})]})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${N}`,children:s.avgGrade?.toFixed(1)||"‚Äî"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota M√©dia"})]}),e.jsxs("div",{className:"text-center min-w-[120px]",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("span",{className:`text-sm font-semibold ${$}`,children:[s.deliveryRate.toFixed(0),"%"]})}),e.jsx(xe,{value:s.deliveryRate,className:"h-2"}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[s.submissionsCount,"/",s.totalActivities," entregas"]})]}),e.jsx(V,{className:s.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":s.status==="alert"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",children:s.status==="active"?"Ativo":s.status==="alert"?"Alerta":"Cr√≠tico"})]}),e.jsxs(we,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsxs(B,{onClick:()=>F(),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(B,{onClick:()=>_(),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Ver Atividades"]}),e.jsxs(B,{onClick:()=>z(),children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Enviar Mensagem"]}),e.jsx(_e,{}),e.jsxs(B,{className:"text-red-600 dark:text-red-400",onClick:()=>Q(s.id,s.profile?.full_name),children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Remover da Turma"]})]})]})]})})},s.id)})}),e.jsx(dt,{isOpen:P,onClose:()=>q(!1),classId:r,classData:h,onSuccess:()=>{q(!1),C()}}),e.jsx(Ae,{isOpen:u.isOpen,onClose:()=>y({isOpen:!1,id:null,name:""}),onConfirm:ae,title:"Remover Aluno da Turma",message:`Tem certeza que deseja remover ${u.name} desta turma? Esta a√ß√£o n√£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},ct=({classId:r})=>{const[h,g]=i.useState(!0),[x,w]=i.useState({avgGrade:0,deliveryRate:0,engagement:0,totalStudents:0,activeStudents:0,totalActivities:0,completedActivities:0,pendingCorrections:0}),[d,t]=i.useState([]),[o,u]=i.useState([]);i.useEffect(()=>{y()},[r]);const y=async()=>{try{g(!0);const{count:c}=await M.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",r).eq("role","student"),{data:p}=await M.from("activity_class_assignments").select("activity_id").eq("class_id",r),l=p?.map(_=>_.activity_id)||[];let b=[];if(l.length>0){const{data:_}=await M.from("submissions").select("student_id, activity_id, grade, status").in("activity_id",l);b=_||[]}const T=b.filter(_=>_.grade!==null).map(_=>parseFloat(_.grade)),f=T.length>0?T.reduce((_,z)=>_+z,0)/T.length:0,A=c*l.length,D=A>0?b.length/A*100:0,P=b.filter(_=>_.status==="submitted").length,q={};b.forEach(_=>{q[_.student_id]||(q[_.student_id]={grades:[],submissions:0}),q[_.student_id].submissions++,_.grade!==null&&q[_.student_id].grades.push(parseFloat(_.grade))});const{data:R}=await M.from("profiles").select("id, full_name").in("id",Object.keys(q)),j=Object.entries(q).map(([_,z])=>{const Q=R?.find(k=>k.id===_),ae=z.grades.length>0?z.grades.reduce((k,L)=>k+L,0)/z.grades.length:0;return{id:_,name:Q?.full_name||"Desconhecido",avgGrade:ae,submissions:z.submissions,deliveryRate:z.submissions/l.length*100}}).sort((_,z)=>z.avgGrade-_.avgGrade).slice(0,5);t(j);const C={};b.forEach(_=>{C[_.activity_id]||(C[_.activity_id]={count:0,grades:[]}),C[_.activity_id].count++,_.grade!==null&&C[_.activity_id].grades.push(parseFloat(_.grade))});const{data:a}=await M.from("activities").select("id, title").in("id",Object.keys(C)),F=Object.entries(C).map(([_,z])=>{const Q=a?.find(k=>k.id===_),ae=z.grades.length>0?z.grades.reduce((k,L)=>k+L,0)/z.grades.length:0;return{title:Q?.title||"Sem t√≠tulo",submissions:z.count,avgGrade:ae,rate:z.count/c*100}}).sort((_,z)=>z.submissions-_.submissions).slice(0,5);u(F),w({avgGrade:f,deliveryRate:D,engagement:D,totalStudents:c||0,activeStudents:Object.keys(q).length,totalActivities:l.length,completedActivities:l.length,pendingCorrections:P})}catch(c){console.error("Erro ao carregar m√©tricas:",c),v({title:"Erro ao carregar m√©tricas",description:c.message,variant:"destructive"})}finally{g(!1)}};return h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"M√©tricas da Turma"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"An√°lise de desempenho e engajamento"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(m,{className:"p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(is,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx(Ne,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:x.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Nota M√©dia Geral"}),e.jsx("div",{className:"mt-2",children:e.jsx(xe,{value:x.avgGrade/10*100,className:"h-2"})})]}),e.jsxs(m,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Y,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx(Ne,{className:"w-5 h-5 text-blue-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[x.deliveryRate.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Taxa de Entrega"}),e.jsx("div",{className:"mt-2",children:e.jsx(xe,{value:x.deliveryRate,className:"h-2"})})]}),e.jsxs(m,{className:"p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(os,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx(Ne,{className:"w-5 h-5 text-purple-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:[x.engagement.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Engajamento"}),e.jsx("div",{className:"mt-2",children:e.jsx(xe,{value:x.engagement,className:"h-2"})})]}),e.jsxs(m,{className:"p-6 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(qe,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),x.pendingCorrections>0?e.jsx(ie,{className:"w-5 h-5 text-yellow-600"}):e.jsx(Y,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-1",children:x.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Corre√ß√µes Pendentes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total de Alunos"})]})]})}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.activeStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Alunos Ativos"})]})]})}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Atividades"})]})]})}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(os,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.completedActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Conclu√≠das"})]})]})})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(is,{className:"w-5 h-5 text-yellow-600"}),"Top 5 Alunos por Desempenho"]}),d.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhum dado dispon√≠vel ainda"}):e.jsx("div",{className:"space-y-3",children:d.map((c,p)=>e.jsxs(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:p*.1},className:"flex items-center justify-between p-4 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`
                    w-8 h-8 rounded-full flex items-center justify-center font-bold
                    ${p===0?"bg-yellow-100 text-yellow-700":p===1?"bg-slate-200 text-slate-700":p===2?"bg-orange-100 text-orange-700":"bg-slate-100 text-slate-600"}
                  `,children:p+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:c.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[c.submissions," submiss√µes ‚Ä¢ ",c.deliveryRate.toFixed(0),"% entrega"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota M√©dia"})]})]},c.id))})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-600"}),"Top 5 Atividades por Engajamento"]}),o.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhuma atividade com submiss√µes ainda"}):e.jsx("div",{className:"space-y-4",children:o.map((c,p)=>e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:p*.1},children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:c.title}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[c.submissions," submiss√µes ‚Ä¢ M√©dia: ",c.avgGrade.toFixed(1)]})]}),e.jsxs(V,{className:c.rate>=80?"bg-green-100 text-green-700":c.rate>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700",children:[c.rate.toFixed(0),"%"]})]}),e.jsx(xe,{value:c.rate,className:"h-2"})]})},p))})]}),e.jsxs(m,{className:"p-12 text-center border-2 border-dashed",children:[e.jsx(Ke,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Gr√°ficos Detalhados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:["Gr√°ficos de evolu√ß√£o temporal, distribui√ß√£o de notas e comparativos",e.jsx("br",{}),"podem ser adicionados aqui usando Recharts ou Chart.js"]}),e.jsx(V,{variant:"secondary",children:"Em Breve"})]})]})},mt=({classId:r,classData:h})=>{const[g,x]=i.useState(!0),[w,d]=i.useState(!1),[t,o]=i.useState([]),[u,y]=i.useState([]),[c,p]=i.useState("friendly"),[l,b]=i.useState({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0});i.useRef(!1),i.useEffect(()=>{T();const A=localStorage.getItem(`chatbot_enabled_${r}`);if(A!==null){const D=JSON.parse(A);d(D),console.log("ü§ñ Estado inicial do chatbot (localStorage):",D)}},[r]);const T=async()=>{try{x(!0);const{data:A}=await M.from("class_materials").select("id, title, file_type, category").eq("class_id",r);o(A||[]);const{data:D}=await M.from("rag_training_sources").select("*").eq("class_id",r);y(D||[]),b({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0})}catch(A){console.error("Erro ao carregar dados do chatbot:",A),v({title:"Erro ao carregar chatbot",description:A.message,variant:"destructive"})}finally{x(!1)}},f=async A=>{d(A);try{localStorage.setItem(`chatbot_enabled_${r}`,JSON.stringify(A)),v({title:A?"‚úÖ Chatbot Ativado":"‚è∏Ô∏è Chatbot Desativado",description:A?"O assistente virtual est√° agora dispon√≠vel para os alunos.":"O assistente virtual foi desativado."});try{const{error:D}=await M.from("classes").update({settings:{chatbot_enabled:A}}).eq("id",r);D&&!D.message.includes("settings")&&console.warn("Erro ao salvar no banco (usando localStorage):",D)}catch(D){console.warn("Banco n√£o suporta settings ainda, usando localStorage:",D)}}catch(D){console.error("Erro ao salvar configura√ß√£o:",D),d(!A),v({title:"Erro ao salvar",description:"N√£o foi poss√≠vel salvar a configura√ß√£o",variant:"destructive"})}};return g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Assistente Virtual (Chatbot)"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Configure um assistente com IA para responder d√∫vidas dos alunos"})]}),e.jsx(m,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg",children:e.jsx(Me,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Status do Chatbot"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:w?"‚úÖ Assistente virtual ativo e respondendo alunos":"‚ö†Ô∏è Assistente virtual desativado"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:A=>f(A.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(m,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(As,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.totalQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Perguntas"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.answeredQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Respondidas"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($s,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.avgResponseTime}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Tempo M√©dio"})]})]})}),e.jsx(m,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.satisfactionRate,"%"]}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Satisfa√ß√£o"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-blue-600"}),"Personalidade do Bot"]}),e.jsxs(W,{value:c,onValueChange:p,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Escolha a personalidade"})}),e.jsxs(J,{children:[e.jsx(S,{value:"friendly",children:"üòä Amig√°vel e Casual"}),e.jsx(S,{value:"formal",children:"üëî Formal e Profissional"}),e.jsx(S,{value:"motivational",children:"üöÄ Motivador e Energ√©tico"}),e.jsx(S,{value:"patient",children:"üßò Paciente e Did√°tico"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[c==="friendly"&&"üí¨ O bot usar√° linguagem casual e amig√°vel",c==="formal"&&"üìù O bot manter√° tom profissional e formal",c==="motivational"&&"‚ú® O bot ser√° motivador e entusiasta",c==="patient"&&"üéØ O bot explicar√° com paci√™ncia e detalhes"]})})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5 text-purple-600"}),"Modelo de IA"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Claude 3.5 Sonnet"}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Modelo avan√ßado da Anthropic"})]}),e.jsx(V,{className:"bg-green-100 text-green-700",children:"Ativo"})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["‚úÖ Respostas contextualizadas",e.jsx("br",{}),"‚úÖ Compreens√£o avan√ßada de linguagem",e.jsx("br",{}),"‚úÖ Seguran√ßa e modera√ß√£o autom√°tica"]})]})]})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),"Materiais para Treinamento (RAG)"]}),e.jsxs(V,{variant:"secondary",children:[u.length," fontes ativas"]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Selecione materiais da turma para treinar o chatbot. Ele usar√° esses conte√∫dos para responder perguntas."}),t.length===0?e.jsxs("div",{className:"text-center py-8 bg-slate-50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx(I,{className:"w-12 h-12 mx-auto mb-2 text-slate-300"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Nenhum material dispon√≠vel.",e.jsx("br",{}),"Adicione materiais na tab Biblioteca primeiro."]})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.slice(0,5).map((A,D)=>e.jsxs(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:D*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",defaultChecked:u.some(P=>P.material_id===A.id)}),e.jsx(I,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:A.title}),e.jsx("div",{className:"text-xs text-slate-500",children:A.category})]}),e.jsx(V,{variant:"outline",className:"text-xs",children:A.file_type?.split("/")[1]||"arquivo"})]},A.id))}),e.jsxs(E,{className:"w-full mt-4",variant:"outline",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Treinar Chatbot com Materiais Selecionados"]})]}),e.jsxs(m,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5 text-blue-600"}),"Preview do Chatbot"]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center",children:e.jsx(Me,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm",children:["Ol√°! üëã Sou o assistente virtual da turma ",e.jsx("strong",{children:h?.name}),". Como posso ajudar voc√™ hoje?"]})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Agora mesmo"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsxs("div",{className:"flex-1 max-w-md",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-lg p-3",children:e.jsx("p",{className:"text-sm",children:"Quando √© a prova de matem√°tica?"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1 text-right",children:"Visualiza√ß√£o"})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-300 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(se,{className:"w-4 h-4"})})]})]})]})]}),!w&&e.jsxs(m,{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-flex p-6 rounded-full bg-slate-100 dark:bg-slate-800 mb-4",children:e.jsx(Me,{className:"w-16 h-16 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Chatbot Desativado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6 max-w-md mx-auto",children:"Ative o assistente virtual para permitir que alunos tirem d√∫vidas automaticamente 24/7 com respostas contextualizadas baseadas nos materiais da turma."}),e.jsx("div",{className:"flex justify-center gap-4",children:e.jsxs(E,{onClick:()=>f(!0),size:"lg",children:[e.jsx(Me,{className:"w-5 h-5 mr-2"}),"Ativar Chatbot"]})})]})]})},Ca=()=>{const{classId:r}=Cs(),h=Je(),{user:g}=_s(),[x,w]=Ss(),[d,t]=i.useState(!0),[o,u]=i.useState(null),[y,c]=i.useState(x.get("tab")||"overview"),[p,l]=i.useState(0);i.useEffect(()=>{r&&b()},[r]),i.useEffect(()=>{const P=x.get("tab");P&&c(P)},[x]);const b=async()=>{try{t(!0);const{data:P,error:q}=await M.from("classes").select("*").eq("id",r).single();if(q)throw q;u(P);const{count:R}=await M.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",r).eq("role","student");l(R||0)}catch(P){console.error("Erro ao carregar turma:",P),v({title:"Erro ao carregar turma",description:"N√£o foi poss√≠vel carregar os dados da turma.",variant:"destructive"})}finally{t(!1)}},T=P=>{c(P),w({tab:P})},f=()=>{o?.invite_code&&(navigator.clipboard.writeText(o.invite_code),v({title:"C√≥digo copiado!",description:"O c√≥digo de convite foi copiado para a √°rea de transfer√™ncia."}))},A=[{id:"overview",label:"Vis√£o Geral",icon:Gs},{id:"content",label:"Mural de Conte√∫do",icon:I},{id:"announcements",label:"Comunicados",icon:ue},{id:"library",label:"Biblioteca",icon:He},{id:"activities",label:"Atividades",icon:We},{id:"students",label:"Alunos",icon:se},{id:"metrics",label:"M√©tricas",icon:Ke},{id:"chatbot",label:"Chatbot",icon:ss}];if(d)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(te,{size:"lg"})});const D=o?.color||"from-blue-600 to-cyan-500";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsxs("div",{className:`relative h-64 bg-gradient-to-r ${D} overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute top-4 left-6",children:e.jsxs(E,{variant:"ghost",onClick:()=>h("/dashboard/classes"),className:"text-white hover:bg-white/20",children:[e.jsx(zs,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs("div",{className:"absolute top-4 right-6 flex items-center gap-2",children:[e.jsx(E,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(gs,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-center px-6 max-w-7xl mx-auto",children:[e.jsx(H.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-4xl font-bold text-white mb-2",children:o?.name}),e.jsx(H.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-lg text-white/90 mb-4",children:o?.subject}),o?.description&&e.jsx(H.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-white/80 max-w-2xl line-clamp-2",children:o.description}),e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex items-center gap-3 mt-4",children:[e.jsxs(V,{className:"bg-white/20 text-white border-white/30",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),p," alunos"]}),o?.is_active!==!1?e.jsxs(V,{className:"bg-green-500/20 text-green-100 border-green-400/30",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Ativa"]}):e.jsx(V,{className:"bg-gray-500/20 text-gray-100 border-gray-400/30",children:"Arquivada"}),o?.invite_code&&e.jsxs(V,{className:"bg-white/20 text-white border-white/30 cursor-pointer hover:bg-white/30",onClick:f,children:[e.jsx(Ze,{className:"w-3 h-3 mr-1"}),"C√≥digo: ",o.invite_code]})]})]}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 h-16 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsx("div",{className:"sticky top-0 z-40 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide py-1",children:A.map(P=>{const q=P.icon,R=y===P.id;return e.jsxs("button",{onClick:()=>T(P.id),className:`
                    flex items-center gap-2 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all
                    ${R?"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}
                  `,children:[e.jsx(q,{className:"w-4 h-4"}),P.label]},P.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[y==="overview"&&e.jsx(Hs,{classId:r,classData:o}),y==="content"&&e.jsx(st,{classId:r}),y==="announcements"&&e.jsx(at,{classId:r}),y==="library"&&e.jsx(lt,{classId:r}),y==="activities"&&e.jsx(nt,{classId:r}),y==="students"&&e.jsx(ot,{classId:r,classData:o}),y==="metrics"&&e.jsx(ct,{classId:r}),y==="chatbot"&&e.jsx(mt,{classId:r,classData:o})]})]})};export{Ca as default};
