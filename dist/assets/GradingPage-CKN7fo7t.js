import{r as n,j as e,m as E,u as I,s as y,k as A}from"./main-PnoWv5mu.js";import{B as g}from"./button-B1az96ai.js";import{C as p}from"./card-DNyDBtwZ.js";import{B as D}from"./SidebarPremium-DbDmcmQG.js";import{D as L}from"./DashboardHeader-CjwFRF49.js";import{I as B}from"./input-BGWMq9XA.js";import"./dropdown-menu-BDAIvG1Q.js";import{L as C}from"./label-DSOeyQ5r.js";import{c as F}from"./tokens-BPdvztvj.js";import{S as q}from"./save-C6-ScC0D.js";import{X as O}from"./x-7WqOwCJm.js";import{A as P}from"./arrow-left-Be4Q5mrA.js";import{U as R}from"./user-IPdw0V9z.js";import{F as z}from"./file-text-WNEYLkuB.js";import{C as T}from"./chevron-left-C6PCN3_3.js";import{C as U}from"./chevron-right-5LVKKztM.js";import"./bell-jlu-i0nu.js";import"./book-open-BN8GTFXN.js";import"./trending-up-BnoBnv7_.js";import"./settings-BAc4VZJo.js";import"./users-CZvcSbj_.js";import"./graduation-cap-BTPeK0uK.js";import"./index-DvZMkTcl.js";import"./chart-column-Ba9dXnEb.js";import"./index-CWQpaRb1.js";import"./check-8UqrO2_7.js";const H=({maxGrade:a=10,initialGrade:u=null,initialFeedback:v="",onSave:h,onCancel:b,loading:m=!1})=>{const[s,j]=n.useState(u?.toString()||""),[o,N]=n.useState(v),[r,f]=n.useState({}),l=()=>{const t={};if(!s||s.trim()==="")t.grade="Nota é obrigatória";else{const i=parseFloat(s);isNaN(i)?t.grade="Nota deve ser um número":i<0?t.grade="Nota não pode ser negativa":i>a&&(t.grade=`Nota não pode ser maior que ${a}`)}return f(t),Object.keys(t).length===0},k=t=>{if(t.preventDefault(),!l())return;const i=parseFloat(s);h({grade:i,feedback:o})},w=t=>{const i=t.target.value;(i===""||/^\d*\.?\d*$/.test(i))&&(j(i),r.grade&&f({...r,grade:null}))};return e.jsx(p,{className:"p-6 bg-white dark:bg-slate-900",children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"grade",className:"text-sm font-semibold mb-2 block",children:["Nota (0 - ",a,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"grade",type:"text",value:s,onChange:w,placeholder:`Ex: ${(a/2).toFixed(1)}`,className:`text-lg font-semibold ${r.grade?"border-red-500 focus:ring-red-500":""}`,disabled:m}),e.jsxs("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-slate-500",children:["/ ",a]})]}),r.grade&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:r.grade}),s&&!isNaN(parseFloat(s))&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${parseFloat(s)>=a*.7?"bg-green-500":parseFloat(s)>=a*.5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(parseFloat(s)/a*100,100)}%`}})})})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"feedback",className:"text-sm font-semibold mb-2 block",children:"Feedback (opcional)"}),e.jsx("textarea",{id:"feedback",value:o,onChange:t=>N(t.target.value),placeholder:"Escreva um feedback para o aluno...",rows:6,disabled:m,className:`
              w-full px-3 py-2 rounded-lg border ${F.border.default}
              bg-white dark:bg-slate-900 ${F.text.primary}
              focus:ring-2 focus:ring-blue-500 focus:border-blue-500
              resize-none transition-all
            `}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-500",children:[o.length," caracteres"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{type:"submit",disabled:m,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Salvar Nota"]})}),b&&e.jsxs(g,{type:"button",variant:"outline",onClick:b,disabled:m,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Cancelar"]})]})]})})},be=()=>{const{submissionId:a}=E(),u=I(),[v,h]=n.useState(!0),[b,m]=n.useState(!1),[s,j]=n.useState(null),[o,N]=n.useState(null),[r,f]=n.useState([]),[l,k]=n.useState(0);n.useEffect(()=>{w()},[a]);const w=async()=>{try{h(!0);const{data:d,error:x}=await y.from("submissions").select(`
          *,
          student:profiles!submissions_user_id_fkey(id, name, email, avatar_url),
          activity:activities(id, title, max_score, due_date)
        `).eq("id",a).single();if(x)throw x;j(d),N(d.activity);const{data:c,error:S}=await y.from("submissions").select("id, user_id, status").eq("activity_id",d.activity_id).order("submitted_at",{ascending:!0});if(!S){f(c||[]);const _=c?.findIndex($=>$.id===a)??0;k(_)}}catch(d){console.error("Erro ao carregar submissão:",d)}finally{h(!1)}},t=async({grade:d,feedback:x})=>{try{m(!0);const{error:c}=await y.from("submissions").update({grade:d,feedback:x,status:"graded",graded_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",a);if(c)throw c;if(alert("Nota salva com sucesso!"),l<r.length-1){const S=r[l+1];u(`/teacher/grading/${S.id}`)}else u(`/teacher/activities/${o?.id}/submissions`)}catch(c){console.error("Erro ao salvar nota:",c),alert("Erro ao salvar nota. Tente novamente.")}finally{m(!1)}},i=d=>{const x=d==="prev"?l-1:l+1;if(x>=0&&x<r.length){const c=r[x];u(`/teacher/grading/${c.id}`)}};return v?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(A,{size:"lg",text:"Carregando submissão..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(g,{variant:"ghost",onClick:()=>u(`/teacher/activities/${o?.id}/submissions`),className:"mb-4",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Voltar para Submissões"]}),e.jsx(L,{title:"Corrigir Submissão",subtitle:`${o?.title||"Atividade"} • ${l+1} de ${r.length}`,role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Informações do Aluno"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[s?.student?.avatar_url?e.jsx("img",{src:s.student.avatar_url,alt:s.student.name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white text-2xl font-bold",children:s?.student?.name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white text-lg",children:s?.student?.name||"Aluno"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s?.student?.email||"Sem email"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Data de Envio:"}),e.jsx("p",{className:"font-semibold text-slate-900 dark:text-white",children:s?.submitted_at?new Date(s.submitted_at).toLocaleString("pt-BR"):"Não enviada"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Status:"}),e.jsx("div",{className:"mt-1",children:e.jsx(D,{className:s?.status==="graded"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",children:s?.status==="graded"?"Corrigida":"Pendente"})})]})]})]}),e.jsxs(p,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Conteúdo da Submissão"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:s?.content?e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-950 rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2)})}):e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhum conteúdo enviado."})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{maxGrade:o?.max_score||10,initialGrade:s?.grade,initialFeedback:s?.feedback||"",onSave:t,onCancel:()=>u(`/teacher/activities/${o?.id}/submissions`),loading:b}),e.jsx(p,{className:"p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{variant:"outline",onClick:()=>i("prev"),disabled:l===0,children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:[l+1," de ",r.length]}),e.jsxs(g,{variant:"outline",onClick:()=>i("next"),disabled:l>=r.length-1,children:["Próxima",e.jsx(U,{className:"w-4 h-4 ml-2"})]})]})})]})]})]})};export{be as default};
