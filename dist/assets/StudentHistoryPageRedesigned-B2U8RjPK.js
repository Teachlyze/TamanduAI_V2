import{a as ae,u as se,r,s as h,l as L,j as e,q as le}from"./main-xLo6udtn.js";import{C as v}from"./card-Dx7Jgzpa.js";import{m as V,B as q}from"./button-kJAiAr98.js";import{E as ie}from"./EmptyState-DOLtZDMh.js";import{G as re}from"./GradeCard-DoNiO3Rb.js";import"./dialog-BnGei6k7.js";import{I as de}from"./input-DgX5viI9.js";import{S as _,a as N,b as w,c as S,d}from"./select-3dEQnqpZ.js";import{H as B}from"./history-U_1G2gXW.js";import{D as ce}from"./download-Nm2BlV1O.js";import{S as I}from"./search-CpLWwhYe.js";import{f as k}from"./format-BcFT9btV.js";import{p as H}from"./pt-BR-CuGSKEGQ.js";import"./SidebarPremium-DR7y_WVE.js";import"./bell-BOqEGMh0.js";import"./chevron-right-DPHp2bZu.js";import"./trending-up-C7AKYn4D.js";import"./user-CPO161me.js";import"./index-B011I92U.js";import"./settings-DOhJboSP.js";import"./house-J__Uznqs.js";import"./users-DCtnf_zM.js";import"./graduation-cap-2hF78yH2.js";import"./index-CQo-NcO2.js";import"./chart-column-bkS3L9w7.js";import"./x-TovB2v9O.js";import"./star-ChkSBp_0.js";import"./target-CTIoGzi1.js";import"./message-square-CPMw8aMh.js";import"./index-DGEpRYgg.js";import"./index-CSUB1fH-.js";import"./index-C_3Lq57v.js";import"./index-BOXlNAp7.js";import"./chevron-down-BADIEq5f.js";import"./check-mlCLJg9E.js";import"./chevron-up-BloFXwR0.js";import"./en-US-B6HbAA6N.js";const Qe=()=>{const{user:j}=ae(),C=se(),[P,M]=r.useState(!0),[D,R]=r.useState([]),[y,F]=r.useState([]),[n,O]=r.useState(""),[m,$]=r.useState("all"),[x,z]=r.useState("all"),[c,Q]=r.useState("all"),[U,W]=r.useState([]),[p,J]=r.useState({total:0,completed:0,avgGrade:0,highestGrade:0});r.useEffect(()=>{j?.id&&(X(),K())},[j]),r.useEffect(()=>{Y()},[D,n,m,x,c]);const K=async()=>{try{const{data:t}=await h.from("class_members").select("class_id").eq("user_id",j.id).eq("role","student"),s=t?.map(o=>o.class_id)||[],{data:l}=await h.from("classes").select("id, name, subject").in("id",s);W(l||[])}catch(t){L.error("Erro ao carregar turmas:",t)}},X=async()=>{try{M(!0);const{data:t}=await h.from("submissions").select("id, activity_id, status, grade, feedback, submitted_at, created_at").eq("student_id",j.id).order("submitted_at",{ascending:!1}),s=t?.map(a=>a.activity_id)||[],{data:l}=await h.from("activities").select("id, title, type, max_score").in("id",s),o={};l?.forEach(a=>{o[a.id]=a});const{data:u}=await h.from("activity_class_assignments").select("activity_id, class_id").in("activity_id",s),i=u?.map(a=>a.class_id).filter(Boolean)||[],{data:ee}=await h.from("classes").select("id, name").in("id",i),E={};ee?.forEach(a=>{E[a.id]=a});const G={};u?.forEach(a=>{G[a.activity_id]={class_id:a.class_id,class_name:E[a.class_id]?.name}});const b=(t||[]).map(a=>{const g=o[a.activity_id],A=G[a.activity_id];return{...a,activity_title:g?.title,activity_type:g?.type,max_score:g?.max_score,class_id:A?.class_id,class_name:A?.class_name}}),T=b.filter(a=>a.grade!==null),f=T.map(a=>parseFloat(a.grade)).filter(a=>!isNaN(a)),te={total:b.length,completed:T.length,avgGrade:f.length>0?f.reduce((a,g)=>a+g,0)/f.length:0,highestGrade:f.length>0?Math.max(...f):0};J(te),R(b)}catch(t){L.error("Erro ao carregar histÃ³rico:",t)}finally{M(!1)}},Y=()=>{let t=[...D];if(n){const s=n.toLowerCase();t=t.filter(l=>l.activity_title?.toLowerCase().includes(s)||l.class_name?.toLowerCase().includes(s))}if(m!=="all"&&(t=t.filter(s=>s.class_id===m)),x!=="all"&&(t=t.filter(s=>s.status===x)),c!=="all"){const s=new Date;let l=new Date;c==="week"?l.setDate(s.getDate()-7):c==="month"?l.setMonth(s.getMonth()-1):c==="semester"&&l.setMonth(s.getMonth()-6),t=t.filter(o=>new Date(o.submitted_at)>=l)}F(t)},Z=()=>{const t=y.map(i=>({Data:k(new Date(i.submitted_at),"dd/MM/yyyy",{locale:H}),Atividade:i.activity_title,Turma:i.class_name,Nota:i.grade||"-","Nota MÃ¡xima":i.max_score,Status:i.status==="graded"?"Avaliada":i.status==="pending"?"Pendente":"Submetida"})),s=[Object.keys(t[0]).join(","),...t.map(i=>Object.values(i).join(","))].join(`
`),l=new Blob([s],{type:"text/csv"}),o=URL.createObjectURL(l),u=document.createElement("a");u.href=o,u.download=`historico-${k(new Date,"yyyy-MM-dd")}.csv`,u.click()};return P?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(le,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsx(V.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(B,{className:"w-8 h-8 text-purple-600"}),"HistÃ³rico de Atividades"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Acompanhe todo o seu histÃ³rico acadÃªmico"})]}),e.jsxs(q,{onClick:Z,disabled:y.length===0,children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(v,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Total de SubmissÃµes"}),e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:p.total})]}),e.jsxs(v,{className:"p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Avaliadas"}),e.jsx("div",{className:"text-3xl font-bold text-green-600",children:p.completed})]}),e.jsxs(v,{className:"p-6 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"MÃ©dia Geral"}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:p.avgGrade>0?p.avgGrade.toFixed(1):"--"})]}),e.jsxs(v,{className:"p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Maior Nota"}),e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:p.highestGrade>0?p.highestGrade.toFixed(1):"--"})]})]}),e.jsx(v,{className:"p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(de,{placeholder:"Buscar por atividade ou turma...",value:n,onChange:t=>O(t.target.value),className:"pl-10"})]})}),e.jsxs(_,{value:m,onValueChange:$,children:[e.jsx(N,{className:"w-full md:w-48",children:e.jsx(w,{placeholder:"Todas as turmas"})}),e.jsxs(S,{children:[e.jsx(d,{value:"all",children:"Todas as turmas"}),U.map(t=>e.jsx(d,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(_,{value:x,onValueChange:z,children:[e.jsx(N,{className:"w-full md:w-48",children:e.jsx(w,{placeholder:"Todos os status"})}),e.jsxs(S,{children:[e.jsx(d,{value:"all",children:"Todos os status"}),e.jsx(d,{value:"graded",children:"âœ… Avaliadas"}),e.jsx(d,{value:"submitted",children:"ğŸ“¤ Submetidas"}),e.jsx(d,{value:"pending",children:"â³ Pendentes"})]})]}),e.jsxs(_,{value:c,onValueChange:Q,children:[e.jsx(N,{className:"w-full md:w-48",children:e.jsx(w,{placeholder:"Todo o perÃ­odo"})}),e.jsxs(S,{children:[e.jsx(d,{value:"all",children:"Todo o perÃ­odo"}),e.jsx(d,{value:"week",children:"Ãšltima semana"}),e.jsx(d,{value:"month",children:"Ãšltimo mÃªs"}),e.jsx(d,{value:"semester",children:"Ãšltimo semestre"})]})]})]})}),y.length>0?e.jsx("div",{className:"space-y-4",children:y.map((t,s)=>{const l={id:t.id,activity_title:t.activity_title,class_name:t.class_name,grade:t.grade,max_score:t.max_score,feedback:t.feedback,submitted_at:t.submitted_at,activity_id:t.activity_id};return t.grade?e.jsx(re,{grade:l,onViewDetails:()=>C(`/students/activities/${t.activity_id}`),index:s},t.id):e.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},children:e.jsx(v,{className:"p-6 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:t.activity_title||"Atividade"}),t.class_name&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:t.class_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsxs("span",{children:["Submetido em ",k(new Date(t.submitted_at),"dd 'de' MMMM",{locale:H})]}),e.jsx("span",{className:"px-2 py-1 rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:t.status==="pending"?"â³ Aguardando correÃ§Ã£o":"ğŸ“¤ Submetida"})]})]}),e.jsx(q,{onClick:()=>C(`/students/activities/${t.activity_id}`),variant:"outline",size:"sm",children:"Ver Detalhes"})]})})},t.id)})}):e.jsx(ie,{icon:n||m!=="all"||x!=="all"||c!=="all"?I:B,title:n||m!=="all"||x!=="all"||c!=="all"?"Nenhum resultado encontrado":"Nenhuma submissÃ£o ainda",description:n||m!=="all"||x!=="all"||c!=="all"?"Tente ajustar os filtros de busca para encontrar o que procura.":"VocÃª ainda nÃ£o submeteu nenhuma atividade. Comece a responder suas atividades!",variant:"default"})]})};export{Qe as default};
