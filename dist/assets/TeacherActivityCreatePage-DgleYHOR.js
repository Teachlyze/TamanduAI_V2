import{c as Ge,j as e,r as b,l as F,u as We,h as He,b as Ke,s as R,q as Ue}from"./main-BSajwT7t.js";import{B as C}from"./button-49_9eRW2.js";import{C as E}from"./card-Bocxgg1Q.js";import{I as T}from"./input-xqPBO_Zl.js";import{L as u}from"./label-Dd1EhhTc.js";import{T as ee}from"./textarea-C5Z8yeqo.js";import{B as k}from"./badge-CfC7p-Az.js";import{T as Je,a as Xe,b as pe}from"./tabs-CKq6b4w6.js";import{D as Ye,a as Ze,b as Le,c as qe,d as ea,e as aa}from"./dialog-CToh4lty.js";import{S as te,a as ie,b as re,c as le,d as _}from"./select-7trEcF9g.js";import{u as sa}from"./use-toast-CI7Qu0JR.js";import{c as U}from"./utils-3IzWRrVe.js";import{F as De}from"./file-text-Bwu_iaa-.js";import{S as de}from"./square-check-big-u9moDHka.js";import{G as Te}from"./grid-3x3-DVZyccT3.js";import{m as ne}from"./proxy-Bb-A2TUD.js";import{C as ve}from"./chevron-right-DUVlURpD.js";import"./checkbox-Doc_5V3r.js";import{P as O}from"./plus-DBp3h9bh.js";import{T as ce}from"./trash-2-BUy2_VOi.js";import"./radio-group-BM2XqfaW.js";import{S as H}from"./switch-C4y_cydU.js";import{S as ta}from"./slider-BEycOMb0.js";import{A as ia}from"./ActivityPreview-CBWWOgkB.js";import{C as ge}from"./circle-check-CZIrgVO6.js";import{C as je}from"./circle-x-BxcNQ7l5.js";import{C as oe}from"./circle-alert-DnNDG1se.js";import{u as ra}from"./useActivityFiles-t5OMiK2E.js";import{m as la,a as ue,i as na}from"./activityTypes-BHmNQbdG.js";import{A as da}from"./arrow-left-CkMJQCbx.js";import{E as ca}from"./eye-Ba2vQNiI.js";import{S as oa}from"./save-DigPTmhI.js";import{B as ma}from"./book-open-BqVBcqQl.js";import{S as xa}from"./settings-Blsx5C_z.js";import"./index-BSMAqeIB.js";import"./index-C1usw-Qd.js";import"./index-DmwWW5NH.js";import"./index-D0BS1fLY.js";import"./index-qH7N8Pcj.js";import"./SidebarPremium-C1f4icTt.js";import"./house-BkBGIUz8.js";import"./users-De1bkoUV.js";import"./graduation-cap-pwvok64K.js";import"./calendar-DetO6w5d.js";import"./chart-column-BmPD_DCR.js";import"./message-circle-DVaucFfj.js";import"./brain-BPIciAtW.js";import"./index-DV-1B3c4.js";import"./x-Wvu9FBm3.js";import"./Combination-DKLEa6f3.js";import"./index-4Tq-pSUS.js";import"./chevron-down-DWk6v4aT.js";import"./check-BLcdb3Nz.js";import"./chevron-up-C-64FT3m.js";import"./clock-DUfJelbJ.js";import"./trending-up-hgXaA--6.js";const ha=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Ee=Ge("grip-vertical",ha),pa=({selectedType:t,onSelectType:c})=>{const p=[{id:"open",name:"Atividade Aberta",subtitle:"Dissertativa",icon:De,color:"from-green-500 to-emerald-600",description:"Quest√µes dissertativas com respostas textuais",features:["Respostas escritas pelos alunos","Corre√ß√£o manual com rubricas","An√°lise de antipl√°gio dispon√≠vel"],idealFor:"An√°lises, reda√ß√µes, explica√ß√µes detalhadas"},{id:"closed",name:"Atividade Fechada",subtitle:"Objetiva",icon:de,color:"from-blue-500 to-cyan-600",description:"Quest√µes de m√∫ltipla escolha",features:["Alternativas pr√©-definidas","Corre√ß√£o autom√°tica instant√¢nea","Feedback imediato para alunos"],idealFor:"Testes, quizzes, avalia√ß√µes r√°pidas"},{id:"mixed",name:"Atividade Mista",subtitle:"H√≠brida",icon:Te,color:"from-purple-500 to-pink-600",description:"Combina quest√µes abertas e fechadas",features:["Flexibilidade m√°xima","Parte autom√°tica + parte manual","Avalia√ß√£o completa e vers√°til"],idealFor:"Provas completas, avalia√ß√µes abrangentes"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Escolha o Tipo de Atividade"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Selecione o formato que melhor se adequa √† sua avalia√ß√£o. Voc√™ n√£o poder√° mudar ap√≥s salvar."})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:p.map((l,a)=>{const d=l.icon,w=t===l.id;return e.jsx(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},children:e.jsx(E,{className:U("p-6 cursor-pointer transition-all duration-200 hover:shadow-xl",w&&"ring-2 ring-blue-500 shadow-xl"),onClick:()=>c(l.id),children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:U("p-4 rounded-xl bg-gradient-to-br",l.color,"flex-shrink-0"),children:e.jsx(d,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:l.name}),e.jsx(k,{variant:"outline",children:l.subtitle})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:l.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Caracter√≠sticas:"}),e.jsx("ul",{className:"space-y-1",children:l.features.map((S,y)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(ve,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-green-500"}),e.jsx("span",{children:S})]},y))})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:"Ideal para:"}),e.jsx("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:l.idealFor})]})]}),w&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-white"})})})]})})},l.id)})}),t&&e.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx(k,{className:"bg-green-100 text-green-700 px-4 py-2",children:"‚úì Tipo selecionado! Continue preenchendo as informa√ß√µes b√°sicas."})})]})},ke=({questions:t,setQuestions:c,maxScore:p,onAddClosed:l,isLocked:a})=>{const[d,w]=b.useState(null),S=()=>{a||c([...t,{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,image:null,attachments:[],rubric:[],expectedAnswer:""}])},y=(n,r,i)=>{a||c(t.map(m=>m.id===n?{...m,[r]:i}:m))},I=n=>{a||c(t.filter(r=>r.id!==n))},B=n=>{a||c(t.map(r=>r.id===n?{...r,rubric:[...r.rubric||[],{id:Date.now(),name:"",description:"",maxPoints:0}]}:r))},A=(n,r,i,m)=>{a||c(t.map(o=>o.id===n?{...o,rubric:o.rubric.map(D=>D.id===r?{...D,[i]:m}:D)}:o))},j=(n,r)=>{a||c(t.map(i=>i.id===n?{...i,rubric:i.rubric.filter(m=>m.id!==r)}:i))},g=n=>{a||w(n)},Z=(n,r)=>{if(n.preventDefault(),a||d===null||d===r)return;const i=[...t],m=i[d];i.splice(d,1),i.splice(r,0,m),c(i),w(r)},v=()=>{w(null)},G=t.reduce((n,r)=>n+(parseFloat(r.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Abertas (Dissertativas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[t.length," quest√£o(√µes) ‚Ä¢ Total: ",G.toFixed(1)," pontos",p&&Math.abs(G-p)>.1&&e.jsxs(k,{variant:"destructive",className:"ml-2",children:["Meta: ",p," pontos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:S,className:"bg-green-600 hover:bg-green-700",disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Quest√£o Dissertativa"]}),l&&e.jsxs(C,{onClick:()=>{a||l()},variant:"outline",className:"border-blue-600 text-blue-600 hover:bg-blue-50",disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Quest√£o Objetiva"]})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(C,{onClick:S,variant:"outline",disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:t.map((n,r)=>e.jsx(E,{className:`p-6 border-l-4 border-l-green-500 transition-opacity ${d===r?"opacity-50":"opacity-100"}`,draggable:!a,onDragStart:()=>g(r),onDragOver:i=>Z(i,r),onDragEnd:v,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 cursor-move",title:"Arraste para reordenar"}),e.jsxs(k,{className:"bg-green-100 text-green-700",children:["Q",r+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Enunciado da Quest√£o *"}),e.jsx(ee,{placeholder:"Digite o enunciado da quest√£o...",value:n.text,onChange:i=>y(n.id,"text",i.target.value),disabled:a,className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Pontua√ß√£o *"}),e.jsx(T,{type:"number",step:"0.1",min:"0",value:n.points,onChange:i=>y(n.id,"points",parseFloat(i.target.value)),disabled:a,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"M√°x. Linhas"}),e.jsx(T,{type:"number",placeholder:"Ilimitado",value:n.maxLines||"",onChange:i=>y(n.id,"maxLines",i.target.value?parseInt(i.target.value):null),disabled:a,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"M√°x. Caracteres"}),e.jsx(T,{type:"number",placeholder:"Ilimitado",value:n.maxCharacters||"",onChange:i=>y(n.id,"maxCharacters",i.target.value?parseInt(i.target.value):null),disabled:a,className:"mt-1"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(u,{children:"Rubrica de Avalia√ß√£o (Opcional)"}),e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>B(n.id),disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Adicionar Crit√©rio"]})]}),n.rubric&&n.rubric.length>0&&e.jsx("div",{className:"space-y-3",children:n.rubric.map(i=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(T,{placeholder:"Nome do crit√©rio",value:i.name,onChange:m=>A(n.id,i.id,"name",m.target.value),disabled:a}),e.jsx(T,{placeholder:"Descri√ß√£o",value:i.description,onChange:m=>A(n.id,i.id,"description",m.target.value),disabled:a}),e.jsx(T,{type:"number",step:"0.1",placeholder:"Pontos m√°ximos",value:i.maxPoints,onChange:m=>A(n.id,i.id,"maxPoints",parseFloat(m.target.value)),disabled:a})]}),e.jsx(C,{size:"sm",variant:"ghost",onClick:()=>j(n.id,i.id),disabled:a,children:e.jsx(ce,{className:"w-4 h-4 text-red-500"})})]},i.id))})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Resposta Esperada (Gabarito - Opcional)"}),e.jsx(ee,{placeholder:"Digite uma resposta de refer√™ncia para consulta durante corre√ß√£o...",value:n.expectedAnswer,onChange:i=>y(n.id,"expectedAnswer",i.target.value),disabled:a,className:"mt-1 min-h-[80px]"})]})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>I(n.id),disabled:a,children:e.jsx(ce,{className:"w-5 h-5 text-red-500"})})]})},n.id))})]})})},Pe=({questions:t,setQuestions:c,maxScore:p,onAddOpen:l,isLocked:a})=>{const[d,w]=b.useState(null),S=()=>{a||c([...t,{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:"",hint:""}])},y=(r,i,m)=>{a||c(t.map(o=>o.id===r?{...o,[i]:m}:o))},I=r=>{a||c(t.filter(i=>i.id!==r))},B=r=>{a||c(t.map(i=>{if(i.id===r){const m=String.fromCharCode(65+i.alternatives.length);return{...i,alternatives:[...i.alternatives,{id:Date.now(),letter:m,text:"",isCorrect:!1}]}}return i}))},A=(r,i,m,o)=>{a||c(t.map(D=>D.id===r?{...D,alternatives:D.alternatives.map(P=>P.id===i?{...P,[m]:o}:P)}:D))},j=(r,i)=>{a||c(t.map(m=>{if(m.id===r&&m.alternatives.length>2){const o=m.alternatives.filter(D=>D.id!==i);return{...m,alternatives:o.map((D,P)=>({...D,letter:String.fromCharCode(65+P)}))}}return m}))},g=(r,i)=>{a||(F.debug("[ClosedQuestions] ‚úÖ Marcando alternativa como correta:",{questionId:r,altId:i}),c(t.map(m=>{if(m.id===r){const o={...m,alternatives:m.alternatives.map(D=>({...D,isCorrect:D.id===i}))};return F.debug("[ClosedQuestions] Quest√£o atualizada:",o),o}return m})))},Z=r=>{a||w(r)},v=(r,i)=>{if(r.preventDefault(),a||d===null||d===i)return;const m=[...t],o=m[d];m.splice(d,1),m.splice(i,0,o),c(m),w(i)},G=()=>{w(null)},n=t.reduce((r,i)=>r+(parseFloat(i.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Fechadas (Objetivas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:[t.length," quest√£o(√µes) ‚Ä¢ Total: ",n.toFixed(1)," pontos"]}),p&&Math.abs(n-p)>.1&&e.jsxs(k,{variant:"destructive",className:"ml-2",children:["Meta: ",p," pontos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:S,className:"bg-blue-600 hover:bg-blue-700",disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Quest√£o Objetiva"]}),l&&e.jsxs(C,{onClick:()=>{a||l()},variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-50",disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Quest√£o Dissertativa"]})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(C,{onClick:S,variant:"outline",disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:t.map((r,i)=>{const m=r.alternatives?.some(o=>o.isCorrect);return e.jsx(E,{className:`p-6 border-l-4 border-l-blue-500 transition-opacity ${d===i?"opacity-50":"opacity-100"}`,draggable:!a,onDragStart:()=>Z(i),onDragOver:o=>v(o,i),onDragEnd:G,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 cursor-move",title:"Arraste para reordenar"}),e.jsxs(k,{className:"bg-blue-100 text-blue-700",children:["Q",i+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Enunciado da Quest√£o *"}),e.jsx(ee,{placeholder:"Digite o enunciado da quest√£o...",value:r.text,onChange:o=>y(r.id,"text",o.target.value),disabled:a,className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Pontua√ß√£o *"}),e.jsx(T,{type:"number",step:"0.1",min:"0",value:r.points,onChange:o=>y(r.id,"points",parseFloat(o.target.value)),disabled:a,className:"mt-1 w-32"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(u,{children:["Alternativas *",!m&&e.jsx(k,{variant:"destructive",className:"ml-2",children:"Marque a correta"})]}),e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>B(r.id),disabled:a,children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Adicionar Alternativa"]})]}),e.jsx("div",{className:"space-y-3",children:r.alternatives?.map(o=>e.jsxs("div",{className:"flex gap-3 items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-${r.id}`,checked:o.isCorrect,onChange:()=>g(r.id,o.id),className:"w-5 h-5 cursor-pointer",title:"Marcar como correta",disabled:a}),e.jsx(k,{variant:"outline",className:"w-8 justify-center",children:o.letter})]}),e.jsx(T,{placeholder:"Texto da alternativa",value:o.text,onChange:D=>A(r.id,o.id,"text",D.target.value),disabled:a,className:"flex-1"}),r.alternatives.length>2&&e.jsx(C,{size:"sm",variant:"ghost",onClick:()=>j(r.id,o.id),disabled:a,children:e.jsx(ce,{className:"w-4 h-4 text-red-500"})})]},o.id))})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Explica√ß√£o da Resposta Correta (Opcional)"}),e.jsx(ee,{placeholder:"Explique por que a alternativa est√° correta...",value:r.explanation,onChange:o=>y(r.id,"explanation",o.target.value),disabled:a,className:"mt-1 min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Dica para Alunos (Opcional)"}),e.jsx(T,{placeholder:"Uma dica que pode ajudar...",value:r.hint,onChange:o=>y(r.id,"hint",o.target.value),disabled:a,className:"mt-1"})]})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>I(r.id),disabled:a,children:e.jsx(ce,{className:"w-5 h-5 text-red-500"})})]})},r.id)})})]})})},ua=({questions:t,setQuestions:c,maxScore:p,isLocked:l})=>{const[a,d]=b.useState("open"),w=t.filter(j=>j.type==="open"),S=t.filter(j=>j.type==="closed"),y=j=>{if(l)return;const g=j==="open"?{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,rubric:[],expectedAnswer:""}:{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:""};c([...t,g])},I=t.reduce((j,g)=>j+(parseFloat(g.points)||0),0),B=w.length>0?(w.reduce((j,g)=>j+g.points,0)/I*100).toFixed(0):0,A=S.length>0?(S.reduce((j,g)=>j+g.points,0)/I*100).toFixed(0):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Mistas"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:[t.length," quest√£o(√µes) total"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[w.length," Abertas - Dissertativas (",B,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[S.length," Fechadas - Objetivas (",A,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:["Total: ",I.toFixed(1)," pontos"]}),p&&Math.abs(I-p)>.1&&e.jsxs(k,{variant:"destructive",className:"ml-2",children:["Meta: ",p," pontos"]})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsx("p",{className:"mb-6",children:"Comece adicionando quest√µes abertas ou fechadas."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(C,{onClick:()=>y("open"),variant:"outline",disabled:l,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Aberta"]}),e.jsxs(C,{onClick:()=>y("closed"),variant:"outline",disabled:l,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Fechada"]})]})]}):e.jsxs(Je,{defaultValue:"all",className:"w-full",children:[e.jsxs(Xe,{className:"grid w-full grid-cols-3",children:[e.jsxs(pe,{value:"all",children:["Todas (",t.length,")"]}),e.jsxs(pe,{value:"open",children:["Abertas - Dissertativas (",w.length,")"]}),e.jsxs(pe,{value:"closed",children:["Fechadas - Objetivas (",S.length,")"]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:t.map((j,g)=>e.jsxs(E,{className:`p-4 border-l-4 ${j.type==="open"?"border-l-green-500":"border-l-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(k,{className:j.type==="open"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700",children:["Q",g+1," - ",j.type==="open"?"Aberta":"Fechada"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[j.points," pontos"]})]}),e.jsx("p",{className:"text-sm text-gray-700 truncate",children:j.text||"Sem enunciado"})]},j.id))})})]})]}),w.length>0&&e.jsx(ke,{questions:w,setQuestions:j=>{c([...j,...S])},maxScore:p*(B/100),onAddClosed:()=>y("closed"),isLocked:l}),S.length>0&&e.jsx(Pe,{questions:S,setQuestions:j=>{c([...w,...j])},maxScore:p*(A/100),onAddOpen:()=>y("open"),isLocked:l})]})},va=({settings:t,setSettings:c,activityType:p,isLocked:l})=>{const a=(d,w)=>{l||c({...t,[d]:w})};return e.jsxs(E,{className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Configura√ß√µes Avan√ßadas"}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Envio Atrasado"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Permitir Envio Atrasado"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos poder√£o submeter ap√≥s o prazo"})]}),e.jsx(H,{checked:t.allowLateSubmission,onCheckedChange:d=>a("allowLateSubmission",d),disabled:l})]}),t.allowLateSubmission&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Tipo de Penalidade"}),e.jsxs(te,{value:t.latePenaltyType,onValueChange:d=>a("latePenaltyType",d),disabled:l,children:[e.jsx(ie,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(le,{children:[e.jsx(_,{value:"percentage",children:"Percentual"}),e.jsx(_,{value:"points",children:"Pontos Fixos"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Valor da Penalidade"}),e.jsx(T,{type:"number",value:t.latePenaltyValue,onChange:d=>a("latePenaltyValue",parseFloat(d.target.value)),disabled:l,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"M√°ximo de Dias Atrasados"}),e.jsx(T,{type:"number",value:t.maxLateDays,onChange:d=>a("maxLateDays",parseInt(d.target.value)),disabled:l,className:"mt-1"})]})]})]}),(p==="closed"||p==="quiz"||p==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"M√∫ltiplas Tentativas"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Permitir M√∫ltiplas Tentativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos podem refazer a atividade"})]}),e.jsx(H,{checked:t.allowMultipleAttempts,onCheckedChange:d=>a("allowMultipleAttempts",d),disabled:l})]}),t.allowMultipleAttempts&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(u,{children:"M√°ximo de Tentativas"}),e.jsx(T,{type:"number",min:"1",value:t.maxAttempts,onChange:d=>a("maxAttempts",parseInt(d.target.value)),disabled:l,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Considerar"}),e.jsxs(te,{value:t.attemptScoring,onValueChange:d=>a("attemptScoring",d),disabled:l,children:[e.jsx(ie,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(le,{children:[e.jsx(_,{value:"best",children:"Melhor Nota"}),e.jsx(_,{value:"last",children:"√öltima Nota"}),e.jsx(_,{value:"average",children:"M√©dia"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Tempo Limite"}),e.jsxs("div",{children:[e.jsx(u,{children:"Tempo M√°ximo (minutos)"}),e.jsx(T,{type:"number",placeholder:"Ilimitado",value:t.timeLimit||"",onChange:d=>a("timeLimit",d.target.value?parseInt(d.target.value):null),disabled:l,className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Deixe vazio para sem limite"})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Feedback e Gabarito"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Mostrar nota imediatamente"}),e.jsx(H,{checked:t.showScoreImmediately,onCheckedChange:d=>a("showScoreImmediately",d),disabled:l})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Mostrar gabarito ap√≥s submiss√£o"}),e.jsx(H,{checked:t.showAnswerKey,onCheckedChange:d=>a("showAnswerKey",d),disabled:l})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Liberar gabarito ap√≥s prazo"}),e.jsx(H,{checked:t.releaseAnswerAfterDeadline,onCheckedChange:d=>a("releaseAnswerAfterDeadline",d),disabled:l})]})]})]}),(p==="open"||p==="assignment"||p==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Antipl√°gio"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Ativar Detec√ß√£o de Antipl√°gio"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verificar originalidade das respostas dissertativas"})]}),e.jsx(H,{checked:t.plagiarismEnabled,onCheckedChange:d=>a("plagiarismEnabled",d),disabled:l})]}),t.plagiarismEnabled&&e.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Sensibilidade"}),e.jsxs(te,{value:t.plagiarismSensitivity,onValueChange:d=>a("plagiarismSensitivity",d),disabled:l,children:[e.jsx(ie,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(le,{children:[e.jsx(_,{value:"low",children:"Baixa"}),e.jsx(_,{value:"medium",children:"M√©dia"}),e.jsx(_,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{children:[e.jsxs(u,{children:["Originalidade M√≠nima: ",t.plagiarismMinOriginality,"%"]}),e.jsx(ta,{value:[t.plagiarismMinOriginality],onValueChange:d=>a("plagiarismMinOriginality",d[0]),disabled:l,min:0,max:100,step:5,className:"mt-2"})]})]})]}),(p==="closed"||p==="quiz"||p==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Randomiza√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Embaralhar Quest√µes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cada aluno v√™ ordem diferente"})]}),e.jsx(H,{checked:t.shuffleQuestions,onCheckedChange:d=>a("shuffleQuestions",d),disabled:l})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Embaralhar Alternativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ordem aleat√≥ria das op√ß√µes"})]}),e.jsx(H,{checked:t.shuffleAlternatives,onCheckedChange:d=>a("shuffleAlternatives",d),disabled:l})]})]})]})]})},ga=({errors:t,warnings:c,onValidate:p,onNavigateToError:l})=>e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Valida√ß√£o da Atividade"}),e.jsx("p",{className:"text-gray-600",children:"Verifique se sua atividade est√° pronta para ser publicada"})]}),e.jsx(C,{onClick:p,className:"w-full",children:"Executar Valida√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(E,{className:"p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ge,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"V√°lido"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.length===0?"‚úì":"‚Äî"})]}),e.jsxs(E,{className:"p-4 bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(je,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Erros"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.length})]}),e.jsxs(E,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(oe,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Avisos"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.length})]})]}),t.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(je,{className:"w-5 h-5 text-red-600"}),e.jsxs("h3",{className:"font-semibold text-red-600",children:["Erros Cr√≠ticos (",t.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:t.map((a,d)=>e.jsx(E,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-l-red-500 cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>l(a.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(k,{variant:"destructive",className:"mb-2",children:a.field}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:a.message})]}),e.jsx(ve,{className:"w-5 h-5 text-red-600 flex-shrink-0"})]})},d))}),e.jsx("p",{className:"text-sm text-red-600 mt-3",children:"‚ùå Corrija todos os erros antes de publicar a atividade."})]}),c.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(oe,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("h3",{className:"font-semibold text-yellow-600",children:["Avisos (",c.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:c.map((a,d)=>e.jsx(E,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-l-yellow-500 cursor-pointer hover:bg-yellow-100 transition-colors",onClick:()=>l(a.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(k,{variant:"outline",className:"mb-2 border-yellow-600 text-yellow-700",children:a.field}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:a.message})]}),e.jsx(ve,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"})]})},d))}),e.jsx("p",{className:"text-sm text-yellow-600 mt-3",children:"‚ö†Ô∏è Avisos n√£o impedem a publica√ß√£o, mas √© recomendado corrigi-los."})]}),t.length===0&&c.length===0&&e.jsx(E,{className:"p-6 bg-green-50 dark:bg-green-900/20 border-2 border-green-500",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800 dark:text-green-200",children:"Atividade Pronta!"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Sua atividade est√° v√°lida e pronta para ser publicada."})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Checklist Geral"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{checked:t.filter(a=>a.field==="title").length===0,label:"T√≠tulo v√°lido"}),e.jsx(Y,{checked:t.filter(a=>a.field==="description").length===0,label:"Descri√ß√£o v√°lida"}),e.jsx(Y,{checked:t.filter(a=>a.field==="questions").length===0,label:"Pelo menos uma quest√£o"}),e.jsx(Y,{checked:t.filter(a=>a.field.startsWith("question")).length===0,label:"Todas as quest√µes v√°lidas"}),e.jsx(Y,{checked:c.filter(a=>a.field==="tags").length===0,label:"Tags adicionadas",warning:!0}),e.jsx(Y,{checked:c.filter(a=>a.field==="score").length===0,label:"Pontua√ß√£o consistente",warning:!0})]})]})]})}),Y=({checked:t,label:c,warning:p=!1})=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800",children:[t?e.jsx(ge,{className:`w-5 h-5 ${p?"text-yellow-600":"text-green-600"}`}):e.jsx(je,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:`text-sm ${t?"text-gray-900 dark:text-gray-100":"text-gray-500"}`,children:c})]}),fs=()=>{const t=We(),{id:c}=He(),{user:p}=Ke(),{toast:l}=sa(),a=!!c,[d,w]=b.useState(a),[S,y]=b.useState(!1),[I,B]=b.useState(null),[A,j]=b.useState(!1),[g,Z]=b.useState(null),[v,G]=b.useState(null),[n,r]=b.useState(""),[i,m]=b.useState(""),[o,D]=b.useState(""),[P,me]=b.useState([]),[L,be]=b.useState("medium"),[J,fe]=b.useState(""),[z,ye]=b.useState(10),[Q,X]=b.useState([]),[xe,Ne]=b.useState([]),[W,we]=b.useState({allowLateSubmission:!1,latePenaltyType:"percentage",latePenaltyValue:10,maxLateDays:7,allowMultipleAttempts:!1,maxAttempts:1,attemptScoring:"best",timeLimit:null,showScoreImmediately:!0,showAnswerKey:!1,releaseAnswerAfterDeadline:!0,plagiarismEnabled:!1,plagiarismSensitivity:"medium",plagiarismMinOriginality:70,shuffleQuestions:!1,shuffleAlternatives:!1}),[V,$]=b.useState(a?"basics":"type"),[Me,Ce]=b.useState(!1),[he,Fe]=b.useState([]),[ae,Qe]=b.useState([]),[_e,se]=b.useState(!1),{publishActivityFiles:Ie}=ra(c||"temp",p?.id,!a);b.useEffect(()=>{if(!v)return;const s=setInterval(()=>{$e()},6e4);return()=>clearInterval(s)},[v,n,i,Q,W]),b.useEffect(()=>{a?ze():Ve()},[c]);const Ve=()=>{try{const s=sessionStorage.getItem("importedActivity");if(s){const x=JSON.parse(s);let f=x.activityType||null;if(!f&&Array.isArray(x.questions)&&x.questions.length>0){const h=x.questions.some(M=>M.type==="closed"),N=x.questions.some(M=>M.type==="open");h&&N?f="mixed":h?f="quiz":N&&(f="open")}G(f||"mixed"),r(x.title||""),m(x.description||""),Array.isArray(x.questions)&&x.questions.length>0?X(x.questions):x.content&&X([{id:Date.now().toString(),type:"open",text:x.content,points:10,maxLines:null,maxCharacters:null,image:null,attachments:[],rubric:[],expectedAnswer:""}]),l({title:"üì• Atividade importada",description:`Conte√∫do de "${x.importedFrom}" carregado. Revise e edite conforme necess√°rio.`}),sessionStorage.removeItem("importedActivity"),$("questions")}}catch(s){F.error("Erro ao carregar dados importados:",s)}},Oe=async()=>{if(c)try{y(!0);const{data:s,error:x}=await R.from("activities").select("*").eq("id",c).single();if(x)throw x;const h=(s.content?.advanced_settings?.version||s.content?.advanced_settings?.activityVersion||1)+1,N={...s.content||{},advanced_settings:{...s.content?.advanced_settings||{},version:h,previousActivityId:s.id}},{data:M,error:K}=await R.from("activities").insert({title:`${s.title} - Vers√£o ${h}`,description:s.description,type:s.type,max_score:s.max_score,status:"draft",is_published:!1,content:N,created_by:p.id}).select().single();if(K)throw K;l({title:"Nova vers√£o criada",description:`A Vers√£o ${h} foi criada como rascunho.`}),t(`/dashboard/activities/${M.id}/edit`)}catch(s){F.error("Erro ao criar nova vers√£o de atividade:",s),l({title:"Erro ao criar nova vers√£o",description:"N√£o foi poss√≠vel criar uma nova vers√£o da atividade.",variant:"destructive"})}finally{y(!1)}},ze=async()=>{try{w(!0);const{data:s,error:x}=await R.from("activities").select("*").eq("id",c).single();if(x)throw x;const f=la(s.type);F.debug("[Activity Load] Convertendo tipo:",{databaseType:s.type,frontendType:f}),G(f),r(s.title),m(s.description||""),D(s.content?.subject||""),me(s.content?.tags||[]),be(s.content?.difficulty||"medium"),fe(s.content?.estimated_time||""),ye(s.max_score||10),X(s.content?.questions||[]),Ne(s.content?.attachments||[]),s.content?.advanced_settings&&we(s.content.advanced_settings);try{const{data:h,error:N}=await R.from("submissions").select("id").eq("activity_id",c).limit(1);N&&F.warn("Erro ao verificar submiss√µes da atividade:",N);const M=(h||[]).length>0;j(M),M&&Z({databaseType:s.type,maxScore:s.max_score||10,questions:s.content?.questions||[],advancedSettings:s.content?.advanced_settings||W})}catch(h){F.warn("Falha inesperada ao verificar submiss√µes da atividade:",h)}l({title:"Atividade carregada",description:"Voc√™ pode editar e salvar as altera√ß√µes."})}catch(s){F.error("Erro ao carregar atividade:",s),l({title:"Erro",description:"N√£o foi poss√≠vel carregar a atividade.",variant:"destructive"}),t("/dashboard/activities")}finally{w(!1)}},$e=async()=>{if(!(!n||!v))try{const s=a&&A&&g,x=s?g.databaseType:ue(v),f={title:n,description:i,type:x,max_score:s?g.maxScore:z,status:"draft",content:{subject:o,tags:P,difficulty:L,estimated_time:J,questions:s?g.questions:Q,attachments:xe,advanced_settings:s?g.advancedSettings:W},created_by:p.id,updated_at:new Date().toISOString()};if(a){const{error:h}=await R.from("activities").update(f).eq("id",c);if(h)throw h}B(new Date)}catch(s){F.error("Erro no auto-save:",s)}},Ae=()=>{const s=[],x=[];(!n||n.trim().length<3)&&s.push({field:"title",message:"T√≠tulo deve ter pelo menos 3 caracteres"}),(!i||i.trim().length<10)&&s.push({field:"description",message:"Descri√ß√£o deve ter pelo menos 10 caracteres"}),Q.length===0&&s.push({field:"questions",message:"Adicione pelo menos uma quest√£o"}),Q.forEach((h,N)=>{(!h.text||h.text.trim().length<5)&&s.push({field:`question-${N}`,message:`Quest√£o ${N+1}: enunciado muito curto`}),(!h.points||h.points<=0)&&s.push({field:`question-${N}`,message:`Quest√£o ${N+1}: pontua√ß√£o inv√°lida`}),(v==="closed"||v==="quiz")&&h.type==="closed"&&((!h.alternatives||h.alternatives.length<2)&&s.push({field:`question-${N}`,message:`Quest√£o ${N+1}: deve ter pelo menos 2 alternativas`}),(h.alternatives?.filter(K=>K.isCorrect)||[]).length===0&&s.push({field:`question-${N}`,message:`Quest√£o ${N+1}: marque pelo menos uma alternativa correta`}))}),P.length===0&&x.push({field:"tags",message:"Considere adicionar tags para facilitar a organiza√ß√£o"}),J||x.push({field:"time",message:"Tempo estimado n√£o definido"});const f=Q.reduce((h,N)=>h+(N.points||0),0);return Math.abs(f-z)>.1&&x.push({field:"score",message:`Soma das quest√µes (${f}) difere da pontua√ß√£o m√°xima (${z})`}),Fe(s),Qe(x),s.length===0},Re=async()=>{if(!n||n.trim().length<3){l({title:"T√≠tulo obrigat√≥rio",description:"Defina um t√≠tulo para salvar o rascunho.",variant:"destructive"});return}if(!v){l({title:"Tipo obrigat√≥rio",description:"Selecione o tipo de atividade.",variant:"destructive"});return}try{y(!0);const s=a&&A&&g,x=s?g.databaseType:ue(v);F.debug("[Activity Draft] Mapeando tipo:",{frontendType:v,databaseType:x});const f={title:n.trim(),description:i?.trim()||"",type:x,max_score:s?g.maxScore:z,status:"draft",content:{subject:o,tags:P,difficulty:L,estimated_time:J,questions:s?g.questions:Q,attachments:xe,advanced_settings:s?g.advancedSettings:W},created_by:p.id,updated_at:new Date().toISOString()};if(F.debug("[TeacherActivityCreatePage] üíæ Salvando atividade:",{title:n,type:v,questionsCount:Q.length,advancedSettings:W}),a){const{error:h}=await R.from("activities").update(f).eq("id",c);if(h)throw h;l({title:"Rascunho salvo",description:"Suas altera√ß√µes foram salvas."})}else{const{data:h,error:N}=await R.from("activities").insert(f).select().single();if(N)throw N;l({title:"‚úÖ Rascunho salvo!",description:"Atividade salva como rascunho. Aparecer√° na sua lista de atividades."}),t(`/dashboard/activities/${h.id}/edit`,{replace:!0})}B(new Date)}catch(s){F.error("Erro ao salvar rascunho:",s),l({title:"Erro",description:"N√£o foi poss√≠vel salvar o rascunho.",variant:"destructive"})}finally{y(!1)}},Be=async()=>{if(!Ae()){l({title:"Valida√ß√£o falhou",description:"Corrija os erros antes de publicar.",variant:"destructive"});return}if(ae.length>0){se(!0);return}await Se()},Se=async()=>{se(!1);try{y(!0);const s=a&&A&&g,x=s?g.databaseType:ue(v);F.debug("[Activity Create] Mapeando tipo:",{frontendType:v,databaseType:x,isValid:na(x)});let f={title:n,description:i,type:x,max_score:s?g.maxScore:z,status:"published",is_published:!0,content:{subject:o,tags:P,difficulty:L,estimated_time:J,questions:s?g.questions:Q,attachments:xe,advanced_settings:s?g.advancedSettings:W},created_by:p.id,updated_at:new Date().toISOString()};if(a){const{error:h}=await R.from("activities").update(f).eq("id",c);if(h)throw h}else{const{data:h,error:N}=await R.from("activities").insert(f).select().single();if(N)throw N;try{const M=await Ie(h.id);if(M&&M.length>0){const K=M.map(q=>({name:q.name,url:q.url,path:q.newPath,size:q.size,type:q.type}));f={...f,content:{...f.content,attachments:K}},await R.from("activities").update(f).eq("id",h.id),Ne(K)}}catch(M){F.warn("Falha ao mover anexos de rascunho ao publicar:",M)}}l({title:"Atividade publicada!",description:"Agora voc√™ pode postar em suas turmas."}),t("/dashboard/activities")}catch(s){F.error("Erro ao publicar:",s),l({title:"Erro",description:"N√£o foi poss√≠vel publicar a atividade.",variant:"destructive"})}finally{y(!1)}};return d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ue,{size:"lg",text:"Carregando atividade..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>t("/dashboard/activities"),children:e.jsx(da,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:a?`Editar: ${n||"Atividade"}`:"Criar Nova Atividade"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(k,{variant:v?"default":"secondary",children:v||"Tipo n√£o definido"}),e.jsx(k,{variant:"outline",children:a?"Editando":"Nova"}),A&&e.jsx(k,{variant:"outline",className:"border-orange-500 text-orange-600",children:"Estrutura bloqueada (h√° submiss√µes)"}),I&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Salvo ",Math.floor((new Date-I)/1e3),"s atr√°s"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(C,{variant:"outline",onClick:()=>Ce(!0),disabled:!v,children:[e.jsx(ca,{className:"w-5 h-5 mr-2"}),"Pr√©via"]}),a&&A&&e.jsxs(C,{variant:"outline",onClick:Oe,disabled:S,children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Criar nova vers√£o"]}),e.jsxs(C,{variant:"outline",onClick:Re,disabled:S||!v||!n||n.trim().length<3,children:[e.jsx(oa,{className:"w-5 h-5 mr-2"}),S?"Salvando...":"Salvar"]}),e.jsxs(C,{onClick:Be,disabled:S||!v,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(de,{className:"w-5 h-5 mr-2"}),a?"Publicar Altera√ß√µes":"Publicar Atividade"]})]})]})}),a&&A&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg border border-orange-200 bg-orange-50 text-sm text-orange-800 flex items-start gap-2",children:[e.jsx(oe,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Atividade com entregas"}),e.jsxs("p",{children:["Quest√µes, pontua√ß√£o m√°xima e configura√ß√µes de corre√ß√£o est√£o bloqueadas para preservar as notas j√° registradas."," ","Para alterar o gabarito ou a estrutura da atividade, crie uma nova vers√£o."]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(E,{className:"p-4 sticky top-6",children:e.jsxs("nav",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>$("type"),className:U("w-full text-left px-4 py-2 rounded-lg transition-colors",V==="type"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:a,children:[e.jsx(Te,{className:"w-4 h-4 inline mr-2"}),"Tipo de Atividade"]}),e.jsxs("button",{onClick:()=>$("basics"),className:U("w-full text-left px-4 py-2 rounded-lg transition-colors",V==="basics"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(ma,{className:"w-4 h-4 inline mr-2"}),"Informa√ß√µes B√°sicas"]}),e.jsxs("button",{onClick:()=>$("questions"),className:U("w-full text-left px-4 py-2 rounded-lg transition-colors",V==="questions"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:!v,children:[e.jsx(De,{className:"w-4 h-4 inline mr-2"}),"Quest√µes (",Q.length,")"]}),e.jsxs("button",{onClick:()=>$("advanced"),className:U("w-full text-left px-4 py-2 rounded-lg transition-colors",V==="advanced"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(xa,{className:"w-4 h-4 inline mr-2"}),"Configura√ß√µes"]}),e.jsxs("button",{onClick:()=>$("validation"),className:U("w-full text-left px-4 py-2 rounded-lg transition-colors",V==="validation"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(de,{className:"w-4 h-4 inline mr-2"}),"Valida√ß√£o",he.length>0&&e.jsx(k,{variant:"destructive",className:"ml-2",children:he.length})]})]})})}),e.jsx("div",{className:"col-span-9",children:e.jsxs(ne.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[V==="type"&&!a&&e.jsx(pa,{selectedType:v,onSelectType:s=>{G(s),$("basics")}}),V==="basics"&&e.jsxs(E,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Informa√ß√µes B√°sicas"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"title",children:"T√≠tulo da Atividade *"}),e.jsx(T,{id:"title",placeholder:"Ex: Avalia√ß√£o de √Ålgebra Linear - Unidade 2",value:n,onChange:s=>r(s.target.value),className:"mt-1",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[n.length,"/200 caracteres"]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"description",children:"Descri√ß√£o *"}),e.jsx(ee,{id:"description",placeholder:"Descreva o objetivo e instru√ß√µes gerais da atividade...",value:i,onChange:s=>m(s.target.value),className:"mt-1 min-h-[120px]",maxLength:2e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.length,"/2000 caracteres"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"subject",children:"Disciplina/Mat√©ria *"}),e.jsx(T,{id:"subject",placeholder:"Ex: Matem√°tica",value:o,onChange:s=>D(s.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"difficulty",children:"Dificuldade"}),e.jsxs(te,{value:L,onValueChange:be,children:[e.jsx(ie,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(le,{children:[e.jsx(_,{value:"easy",children:"F√°cil"}),e.jsx(_,{value:"medium",children:"M√©dia"}),e.jsx(_,{value:"hard",children:"Dif√≠cil"}),e.jsx(_,{value:"very_hard",children:"Muito Dif√≠cil"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"time",children:"Tempo Estimado (minutos)"}),e.jsx(T,{id:"time",type:"number",placeholder:"45",value:J,onChange:s=>fe(s.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"maxScore",children:"Pontua√ß√£o M√°xima Total *"}),e.jsx(T,{id:"maxScore",type:"number",step:"0.1",min:"0.1",max:"100",value:z,onChange:s=>ye(parseFloat(s.target.value)),className:"mt-1",disabled:A}),A&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Pontua√ß√£o m√°xima bloqueada porque esta atividade j√° possui submiss√µes."})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"tags",children:"T√≥picos/Tags"}),e.jsx(T,{id:"tags",placeholder:"Pressione Enter para adicionar (Ex: √Ålgebra, Matrizes)",onKeyDown:s=>{s.key==="Enter"&&s.target.value.trim()&&(s.preventDefault(),P.includes(s.target.value.trim())||(me([...P,s.target.value.trim()]),s.target.value=""))},className:"mt-1"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:P.map((s,x)=>e.jsxs(k,{variant:"secondary",className:"cursor-pointer hover:bg-red-100",onClick:()=>me(P.filter((f,h)=>h!==x)),children:["#",s," √ó"]},x))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(C,{onClick:()=>$("questions"),disabled:!n||!i||!o,children:"Pr√≥ximo: Adicionar Quest√µes"})})]})]}),V==="questions"&&v&&e.jsxs(e.Fragment,{children:[(v==="open"||v==="assignment")&&e.jsx(ke,{questions:Q,setQuestions:X,maxScore:z,onAddClosed:void 0,isLocked:A}),(v==="closed"||v==="quiz")&&e.jsx(Pe,{questions:Q,setQuestions:X,maxScore:z,onAddOpen:void 0,isLocked:A}),(v==="mixed"||v==="project")&&e.jsx(ua,{questions:Q,setQuestions:X,maxScore:z,isLocked:A})]}),V==="advanced"&&e.jsx(va,{settings:W,setSettings:we,activityType:v,isLocked:A}),V==="validation"&&e.jsx(ga,{errors:he,warnings:ae,onValidate:Ae,onNavigateToError:s=>{s.startsWith("question")?$("questions"):["title","description","subject"].includes(s)&&$("basics")}})]},V)})]}),Me&&e.jsx(ia,{activity:{title:n,description:i,type:v,subject:o,tags:P,difficulty:L,estimatedTime:J,maxScore:z,questions:Q,advancedSettings:W},onClose:()=>Ce(!1)}),e.jsx(Ye,{open:_e,onOpenChange:se,children:e.jsxs(Ze,{children:[e.jsxs(Le,{children:[e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-6 h-6 text-orange-600"}),"Avisos Detectados"]}),e.jsxs(ea,{children:["H√° ",ae.length," aviso(s) na atividade. Deseja publicar mesmo assim?"]})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"space-y-2",children:ae.map((s,x)=>e.jsx("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:["‚ö†Ô∏è ",s.message]})},x))})}),e.jsxs(aa,{children:[e.jsx(C,{variant:"outline",onClick:()=>se(!1),children:"Cancelar"}),e.jsx(C,{onClick:Se,className:"bg-orange-600 hover:bg-orange-700",children:"Publicar Mesmo Assim"})]})]})})]})};export{fs as default};
