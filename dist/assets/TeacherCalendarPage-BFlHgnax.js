import{c as re,r as i,s as z,l as D,j as e,m as F,a as ie,g as oe}from"./main-KTzSHcut.js";import{C as B}from"./card-D1C_XPb6.js";import{B as p,m as R}from"./button-Ch10pVNC.js";import{t as E}from"./use-toast-Dl4X8ZMv.js";import{r as Q}from"./redisCache-C5lAJ-QK.js";import{X as G}from"./x-ZCLeMxGr.js";import{B as ne}from"./book-open-dxp_3U19.js";import{F as de}from"./file-text-DYnGBvGu.js";import{U}from"./users-BaZp6eLM.js";import{C as ee,A as ce}from"./index-Bp0dZcFm.js";import{S as me}from"./save-DLCLAimN.js";import{f as h}from"./format-CxHpq9RK.js";import{B as J}from"./SidebarPremium-Bjey2152.js";import{C as xe}from"./clock-Ca1Xubpl.js";import{M as ue}from"./map-pin-KbO-QUQM.js";import{S as he}from"./square-pen-B2UAy1WY.js";import{C as be}from"./copy-DXaMUfbW.js";import{T as pe}from"./trash-2-CFeWlj6l.js";import{p as A}from"./pt-BR-CXWZr0Zs.js";import{F as ge}from"./funnel-C9FjUyPr.js";import{s as W,a as ve,i as fe}from"./isSameMonth-BQUH752I.js";import{e as Y}from"./endOfMonth-BvBmjNQ6.js";import{s as ye,e as je}from"./subMonths-DHcpZmnJ.js";import{P as Z}from"./plus-DCFQf4Ef.js";import{C as ke}from"./chevron-left-CSV34vXX.js";import{C as Ne}from"./chevron-right-DlLEuI3N.js";import{i as we}from"./isToday-DbOgdeJ3.js";import"./en-US-azV9x4mt.js";import"./bell-B4NUN7bW.js";import"./trending-up-BsXLUj7W.js";import"./user-CWyOXzMq.js";import"./settings-BYjJE2lM.js";import"./graduation-cap-ArnOenSA.js";import"./chart-column-BJvjjOHx.js";import"./constructNow-C8CNs5uJ.js";import"./isSameDay-7UPP47mY.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ce=re("external-link",_e),Ee=({isOpen:n,onClose:d,onSuccess:l,selectedDate:j,teacherId:g})=>{const[v,x]=i.useState(!1),[_,C]=i.useState([]),[f,k]=i.useState([]),[o,y]=i.useState(!1),[t,r]=i.useState({title:"",description:"",type:"event",start_date:j?h(j,"yyyy-MM-dd"):h(new Date,"yyyy-MM-dd"),start_time:"08:00",end_time:"09:00",modality:"online",meeting_link:"",location:"",selected_classes:[],selected_students:[],invite_type:"all",color:"#3B82F6"});i.useEffect(()=>{N()},[g]),i.useEffect(()=>{t.selected_classes.length>0&&t.invite_type==="individuals"?S():k([])},[t.selected_classes,t.invite_type]);const N=async()=>{try{const{data:s}=await z.from("classes").select("id, name").eq("created_by",g).eq("is_active",!0).order("name");C(s||[])}catch(s){D.error("Erro ao carregar turmas:",s)}},S=async()=>{try{y(!0);const{data:s,error:c}=await z.from("class_members").select(`
          user_id,
          class_id,
          profile:profiles!class_members_user_id_fkey(
            id,
            full_name,
            email,
            avatar_url
          )
        `).in("class_id",t.selected_classes).eq("role","student");if(c)throw c;const m=(s||[]).map(u=>({id:u.profile.id,name:u.profile.full_name||u.profile.email,email:u.profile.email,avatar:u.profile.avatar_url,classId:u.class_id})),w=Array.from(new Map(m.map(u=>[u.id,u])).values());k(w)}catch(s){D.error("Erro ao carregar alunos:",s),E({title:"Erro ao carregar alunos",description:s.message,variant:"destructive"})}finally{y(!1)}},M=async s=>{if(s.preventDefault(),!t.title.trim()){E({title:"Erro de validaÃ§Ã£o",description:"O tÃ­tulo Ã© obrigatÃ³rio.",variant:"destructive"});return}if(t.modality==="online"&&!t.meeting_link.trim()){E({title:"Erro de validaÃ§Ã£o",description:"Link da reuniÃ£o Ã© obrigatÃ³rio para eventos online.",variant:"destructive"});return}try{x(!0);const c=new Date(`${t.start_date}T${t.start_time}`),m=new Date(`${t.start_date}T${t.end_time}`);let w=null;t.type==="meeting"&&t.invite_type==="individuals"&&(w=t.selected_students);const u=t.selected_classes.length>0?t.selected_classes.map(O=>({title:t.title,description:t.description,type:t.type,start_time:c.toISOString(),end_time:m.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,class_id:O,attendees:w,color:t.color})):[{title:t.title,description:t.description,type:t.type,start_time:c.toISOString(),end_time:m.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,attendees:w,color:t.color}],{error:T}=await z.from("calendar_events").insert(u);if(T)throw D.error("Erro ao criar evento:",T),new Error(T.message||"Erro ao criar evento no banco de dados");const K=h(c,"yyyy-MM");await Q.deletePattern(`calendar:${g}:*`);const q=u.length;E({title:"âœ… Evento criado com sucesso!",description:q>1?`${q} eventos criados para diferentes turmas`:`${t.title} foi adicionado ao calendÃ¡rio`}),l&&l(),d()}catch(c){D.error("Erro ao criar evento:",c),E({title:"âŒ Erro ao criar evento",description:c.message||"NÃ£o foi possÃ­vel criar o evento. Tente novamente.",variant:"destructive"})}finally{x(!1)}},$=[{value:"event",label:"Aula",icon:ne,color:"blue"},{value:"activity",label:"Atividade",icon:de,color:"orange"},{value:"meeting",label:"ReuniÃ£o",icon:U,color:"purple"},{value:"deadline",label:"Prazo",icon:ee,color:"red"}];return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Novo Evento"}),e.jsx("button",{onClick:d,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:M,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Tipo de Evento"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:$.map(s=>{const c=s.icon,m=t.type===s.value;return e.jsxs("button",{type:"button",onClick:()=>r({...t,type:s.value}),className:`p-4 rounded-lg border-2 transition-all ${m?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:[e.jsx(c,{className:`w-6 h-6 mx-auto mb-2 ${m?"text-blue-600":"text-slate-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"TÃ­tulo *"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>r({...t,title:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Aula de MatemÃ¡tica",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:t.description,onChange:s=>r({...t,description:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Detalhes do evento..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Data *"}),e.jsx("input",{type:"date",value:t.start_date,onChange:s=>r({...t,start_date:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"InÃ­cio *"}),e.jsx("input",{type:"time",value:t.start_time,onChange:s=>r({...t,start_time:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Fim *"}),e.jsx("input",{type:"time",value:t.end_time,onChange:s=>r({...t,end_time:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]})]}),t.type==="meeting"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Convidar"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>r({...t,invite_type:"all",selected_classes:[],selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="all"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸ“¢ Todos"}),e.jsx("button",{type:"button",onClick:()=>r({...t,invite_type:"classes",selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="classes"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸŽ“ Por Turma"}),e.jsx("button",{type:"button",onClick:()=>r({...t,invite_type:"individuals"}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="individuals"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸ‘¤ Individual"})]})]}),(t.type==="event"||t.type==="activity"||t.type==="meeting"&&(t.invite_type==="classes"||t.invite_type==="individuals"))&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Turmas ",t.invite_type==="individuals"&&"(selecione para filtrar alunos)"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:_.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhuma turma encontrada"}):_.map(s=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_classes.includes(s.id),onChange:c=>{const m=c.target.checked?[...t.selected_classes,s.id]:t.selected_classes.filter(w=>w!==s.id);r({...t,selected_classes:m})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))})]}),t.type==="meeting"&&t.invite_type==="individuals"&&t.selected_classes.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Selecionar Alunos (",t.selected_students.length," selecionados)"]}),o?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(F,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-slate-500",children:"Carregando alunos..."})]}):e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:f.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhum aluno encontrado nas turmas selecionadas"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-slate-900 pb-2 border-b border-slate-200 dark:border-slate-700",children:e.jsx("button",{type:"button",onClick:()=>{const s=f.every(c=>t.selected_students.includes(c.id));r({...t,selected_students:s?[]:f.map(c=>c.id)})},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:f.every(s=>t.selected_students.includes(s.id))?"Desmarcar todos":"Selecionar todos"})}),f.map(s=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_students.includes(s.id),onChange:c=>{const m=c.target.checked?[...t.selected_students,s.id]:t.selected_students.filter(w=>w!==s.id);r({...t,selected_students:m})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.email})]})]})]},s.id))]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Modalidade"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"online",checked:t.modality==="online",onChange:s=>r({...t,modality:s.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Online"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"presential",checked:t.modality==="presential",onChange:s=>r({...t,modality:s.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Presencial"})]})]})]}),t.modality==="online"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Link da ReuniÃ£o *"}),e.jsx("input",{type:"url",value:t.meeting_link,onChange:s=>r({...t,meeting_link:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"https://meet.google.com/...",required:!0})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Local"}),e.jsx("textarea",{value:t.location,onChange:s=>r({...t,location:s.target.value}),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Sala 203, Bloco B"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(p,{type:"button",variant:"outline",onClick:d,disabled:v,className:"flex-1",children:"Cancelar"}),e.jsx(p,{type:"submit",disabled:v,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:v?e.jsxs(e.Fragment,{children:[e.jsx(F,{size:"sm",className:"mr-2"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Criar Evento"]})})]})]})]})}):null},Se=({isOpen:n,onClose:d,event:l,onEdit:j,onDelete:g})=>{const[v,x]=i.useState(!1),[_,C]=i.useState(!1),f=async()=>{try{x(!0);const{error:r}=await z.from("calendar_events").delete().eq("id",l.id);if(r)throw r;E({title:"Evento excluÃ­do!",description:"O evento foi removido com sucesso."}),g(),d()}catch(r){D.error("Erro ao excluir evento:",r),E({title:"Erro ao excluir",description:"NÃ£o foi possÃ­vel excluir o evento.",variant:"destructive"})}finally{x(!1)}},k=()=>{E({title:"Em desenvolvimento",description:"Funcionalidade em breve."})},o=r=>({event:"Aula",activity:"Atividade",meeting:"ReuniÃ£o",deadline:"Prazo"})[r]||"Evento",y=r=>({event:"bg-blue-100 text-blue-700",activity:"bg-orange-100 text-orange-700",meeting:"bg-purple-100 text-purple-700",deadline:"bg-red-100 text-red-700"})[r]||"bg-gray-100 text-gray-700",t=()=>{const r=new Date(l.start_time),S=new Date(l.end_time)-r,M=Math.floor(S/(1e3*60*60)),$=Math.floor(S%(1e3*60*60)/(1e3*60));return M>0?`${M}h ${$}min`:`${$}min`};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:l.title}),e.jsx(J,{className:y(l.type),children:o(l.type)})]}),e.jsx("button",{onClick:d,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-slate-300",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:h(new Date(l.start_time),"EEEE, d 'de' MMMM",{locale:A})}),e.jsxs("div",{className:"text-sm text-slate-500",children:[h(new Date(l.start_time),"HH:mm")," - ",h(new Date(l.end_time),"HH:mm")," â€¢ ",t()]})]})]}),l.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:"DescriÃ§Ã£o"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:l.description})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:l.modality==="online"?"Online":"Presencial"}),l.modality==="online"&&l.meeting_link&&e.jsxs("a",{href:l.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-1",children:["Abrir link da reuniÃ£o",e.jsx(Ce,{className:"w-3 h-3"})]}),l.modality==="presential"&&l.location&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:l.location})]})]}),l.class&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),"Turma"]}),e.jsx(J,{variant:"outline",children:l.class.name})]}),l.participants&&Array.isArray(l.participants)&&l.participants.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),"Participantes"]}),e.jsx("div",{className:"space-y-2",children:l.participants.map((r,N)=>e.jsx("div",{className:"text-sm text-slate-700 dark:text-slate-300",children:r.name||r.email||"Participante"},N))})]}),_&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 mb-3",children:"Tem certeza que deseja excluir este evento? Esta aÃ§Ã£o nÃ£o pode ser desfeita."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>C(!1),disabled:v,children:"Cancelar"}),e.jsx(p,{size:"sm",onClick:f,disabled:v,className:"bg-red-600 hover:bg-red-700",children:v?e.jsxs(e.Fragment,{children:[e.jsx(F,{size:"sm",className:"mr-2"}),"Excluindo..."]}):"Confirmar ExclusÃ£o"})]})]})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(p,{variant:"outline",onClick:j,className:"flex-1",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(p,{variant:"outline",onClick:k,className:"flex-1",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(p,{variant:"outline",onClick:()=>C(!0),className:"flex-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})})]})}):null},Me=({filters:n,setFilters:d,teacherId:l})=>{const[j,g]=i.useState([]);i.useEffect(()=>{v()},[l]);const v=async()=>{try{const{data:o}=await z.from("classes").select("id, name").eq("created_by",l).eq("is_active",!0).order("name");g(o||[])}catch(o){D.error("Erro ao carregar turmas:",o)}},x=[{value:"class",label:"Aulas",color:"blue"},{value:"exam",label:"Provas",color:"red"},{value:"meeting",label:"ReuniÃµes",color:"purple"},{value:"personal",label:"Pessoal",color:"gray"}],_=o=>{const y=n.types.includes(o)?n.types.filter(t=>t!==o):[...n.types,o];d({...n,types:y})},C=o=>{const y=n.classes.includes(o)?n.classes.filter(t=>t!==o):[...n.classes,o];d({...n,classes:y})},f=()=>{d({types:[],classes:[],modality:"all"})},k=n.types.length>0||n.classes.length>0||n.modality!=="all";return e.jsxs(B,{className:"p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Filtros"]}),k&&e.jsx(p,{variant:"ghost",size:"sm",onClick:f,children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Tipo de Evento"}),e.jsx("div",{className:"space-y-2",children:x.map(o=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:n.types.includes(o.value),onChange:()=>_(o.value),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:o.label})]},o.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Turmas"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:j.map(o=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:n.classes.includes(o.id),onChange:()=>C(o.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:o.name})]},o.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Modalidade"}),e.jsxs("select",{value:n.modality,onChange:o=>d({...n,modality:o.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 text-sm",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"presential",children:"Presencial"})]})]})]})},te=oe.memo(({day:n,dayEvents:d,isCurrentDay:l,isSameMonthDay:j,onClick:g,onEventClick:v})=>e.jsxs(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},onClick:g,className:`
        min-h-[120px] p-3 border rounded-xl cursor-pointer transition-all hover:shadow-lg group relative
        ${l?"border-2 border-blue-600 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 shadow-md":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}
        ${!j&&"opacity-40"}
        hover:bg-gradient-to-br hover:from-slate-50 hover:to-blue-50 dark:hover:from-slate-800 dark:hover:to-blue-950/30
      `,children:[e.jsxs("div",{className:`
        text-sm font-bold mb-2 flex items-center justify-between
        ${l?"text-blue-600":"text-slate-900 dark:text-white"}
      `,children:[e.jsx("span",{children:h(n,"d")}),d.length>0&&e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-600 text-white text-xs flex items-center justify-center",children:d.length})]}),e.jsxs("div",{className:"space-y-1.5",children:[d.slice(0,2).map(x=>e.jsx("div",{onClick:_=>{_.stopPropagation(),v(x)},className:`
              text-xs px-2 py-1.5 rounded-lg truncate font-medium shadow-sm transition-all
              ${x.type==="event"&&"bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 dark:from-blue-900 dark:to-blue-800 dark:text-blue-200 hover:shadow-md"}
              ${x.type==="activity"&&"bg-gradient-to-r from-orange-100 to-orange-200 text-orange-800 dark:from-orange-900 dark:to-orange-800 dark:text-orange-200 hover:shadow-md"}
              ${x.type==="meeting"&&"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 dark:from-purple-900 dark:to-purple-800 dark:text-purple-200 hover:shadow-md"}
              ${x.type==="deadline"&&"bg-gradient-to-r from-red-100 to-red-200 text-red-800 dark:from-red-900 dark:to-red-800 dark:text-red-200 hover:shadow-md"}
              hover:scale-105
            `,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:h(new Date(x.start_time),"HH:mm")}),e.jsx("span",{className:"truncate",children:x.title})]})},x.id)),d.length>2&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 px-2 py-1 bg-blue-50 dark:bg-blue-950/30 rounded-lg font-medium",children:["+",d.length-2," evento",d.length-2>1?"s":""]})]})]}));te.displayName="CalendarDay";const xt=()=>{const{user:n}=ie(),[d,l]=i.useState(new Date),[j,g]=i.useState([]),[v,x]=i.useState([]),[_,C]=i.useState(!0),[f,k]=i.useState(!1),[o,y]=i.useState(!1),[t,r]=i.useState(null),[N,S]=i.useState(null),[M,$]=i.useState([]),[s,c]=i.useState(!1),[m,w]=i.useState({types:[],classes:[],modality:"all"}),u=i.useCallback(async()=>{try{C(!0);const a=W(d),b=Y(d),P=Q.generateKey("calendar",n.id,h(d,"yyyy-MM")),H=await Q.cacheQuery(P,async()=>{const{data:L,error:I}=await z.from("calendar_events").select(`
              *,
              class:classes(id, name)
            `).eq("created_by",n.id).gte("start_time",a.toISOString()).lte("start_time",b.toISOString()).order("start_time");if(I)throw I;return L||[]},300);g(H)}catch(a){D.error("Erro ao carregar eventos:",a),E({title:"Erro ao carregar eventos",description:"NÃ£o foi possÃ­vel carregar seus eventos.",variant:"destructive"})}finally{C(!1)}},[d,n?.id]),T=i.useCallback(()=>{let a=[...j];m.types.length>0&&(a=a.filter(b=>m.types.includes(b.type))),m.classes.length>0&&(a=a.filter(b=>b.class_id&&m.classes.includes(b.class_id))),m.modality!=="all"&&(a=a.filter(b=>b.modality===m.modality)),x(a)},[j,m]);i.useEffect(()=>{n?.id&&u()},[n?.id,u]),i.useEffect(()=>{T()},[T]);const K=i.useCallback(()=>{l(a=>ye(a)),c(!1)},[]),q=i.useCallback(()=>{l(a=>ve(a,1)),c(!1)},[]),O=i.useCallback(()=>{l(new Date),c(!1)},[]),se=a=>{S(a);const b=X(a);$(b),c(!0)},V=a=>{r(a),y(!0)},X=a=>v.filter(b=>{const P=new Date(b.start_time);return h(P,"yyyy-MM-dd")===h(a,"yyyy-MM-dd")}),ae=i.useMemo(()=>{const a=W(d),b=Y(d);return je({start:a,end:b})},[d]),le=i.useMemo(()=>["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"],[]);return _?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(F,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Minha Agenda"}),e.jsx("p",{className:"text-cyan-100",children:"Gerencie aulas, reuniÃµes e eventos"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{onClick:O,variant:"outline",className:"bg-white/10 hover:bg-white/20 border-white/20 text-white",children:"Hoje"}),e.jsxs(p,{onClick:()=>{S(new Date),k(!0)},className:"bg-white text-blue-600 hover:bg-white/90",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Novo Evento"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:s?"lg:col-span-8 transition-all duration-300":"lg:col-span-9 transition-all duration-300",children:e.jsxs(B,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:K,children:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white capitalize",children:h(d,"MMMM yyyy",{locale:A})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:q,children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[le.map(a=>e.jsx("div",{className:"text-center text-sm font-semibold text-slate-600 dark:text-slate-400 py-2",children:a},a)),e.jsx(ce,{children:ae.map((a,b)=>{const P=X(a),H=we(a),L=fe(a,d);return e.jsx(te,{day:a,dayEvents:P,isCurrentDay:H,isSameMonthDay:L,onClick:()=>se(a),onEventClick:V},`${h(a,"yyyy-MM-dd")}-${b}`)})})]})]})}),!s&&e.jsx("div",{className:"lg:col-span-3 space-y-4",children:e.jsx(Me,{filters:m,setFilters:w,teacherId:n?.id})}),s&&N&&e.jsx("div",{className:"lg:col-span-4",children:e.jsxs(B,{className:"p-6 bg-white dark:bg-slate-900 border-2 border-blue-200 dark:border-blue-800 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:h(N,"d 'de' MMMM",{locale:A})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:h(N,"EEEE",{locale:A})})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>c(!1),className:"text-slate-500 hover:text-slate-700",children:"âœ•"})]}),e.jsxs(p,{onClick:()=>k(!0),className:"w-full mb-4 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white shadow-lg",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Novo Evento"]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-24rem)] overflow-y-auto",children:M.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto text-slate-300 dark:text-slate-700 mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nenhum evento neste dia"}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:'Clique em "Novo Evento" para adicionar'})]}):M.map(a=>e.jsx(R.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onClick:()=>V(a),className:`
                        p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md group
                        ${a.type==="event"?"border-blue-300 bg-blue-50 dark:bg-blue-950/30":""}
                        ${a.type==="activity"?"border-orange-300 bg-orange-50 dark:bg-orange-950/30":""}
                        ${a.type==="meeting"?"border-purple-300 bg-purple-50 dark:bg-purple-950/30":""}
                        ${a.type==="deadline"?"border-red-300 bg-red-50 dark:bg-red-950/30":""}
                      `,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:`
                              text-xs font-semibold px-2 py-1 rounded-full
                              ${a.type==="event"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":""}
                              ${a.type==="activity"?"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300":""}
                              ${a.type==="meeting"?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":""}
                              ${a.type==="deadline"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":""}
                            `,children:a.type==="event"?"ðŸ“š Aula":a.type==="activity"?"ðŸ“ Atividade":a.type==="meeting"?"ðŸ‘¥ ReuniÃ£o":"ðŸ“… Prazo"})}),e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white mb-1 group-hover:text-blue-600",children:a.title}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:[h(new Date(a.start_time),"HH:mm")," - ",h(new Date(a.end_time),"HH:mm")]}),a.class?.name&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸŽ“ ",a.class.name]}),a.location&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸ“ ",a.location]})]})})},a.id))})]})})]}),f&&e.jsx(Ee,{isOpen:f,onClose:()=>{k(!1),S(null)},onSuccess:u,selectedDate:N,teacherId:n?.id}),o&&t&&e.jsx(Se,{isOpen:o,onClose:()=>{y(!1),r(null)},event:t,onEdit:()=>{y(!1),k(!0)},onDelete:u})]})};export{xt as default};
