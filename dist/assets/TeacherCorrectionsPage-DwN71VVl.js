import{l as F,s as z,j as n,r as m,e as ht,a as pt,g as b,p as ps,m as gs}from"./main-KTzSHcut.js";import{B as Y,u as ve,d as xs,m as vs}from"./button-Ch10pVNC.js";import{C as U}from"./card-D1C_XPb6.js";import{I as Xe}from"./input-CKizEs14.js";import{e as ys,S as bs,a as ws,b as Ns,c as js,d as $e}from"./select-CopAKCqT.js";import{T as Ss,a as Cs,b as Le}from"./tabs-C5gSEJB4.js";import{D as ks,g as ot}from"./DashboardHeader-CqV_snk3.js";import{S as ze}from"./StatsCard-yPiQuGWm.js";import{E as _s}from"./EmptyState-CFbYm1Jb.js";import{D as Bt,a as Yt,b as $t,d as Ds,c as dt}from"./dropdown-menu-CFKsTZzS.js";import{L as H}from"./label-BhBBP-Nu.js";import{u as gt}from"./use-toast-Dl4X8ZMv.js";import{D as Ue,a as qe,b as Lt,c as zt}from"./dialog-BPUI-tpC.js";import{T as xt}from"./textarea-Bz6OAfsP.js";import{N as Ms,a as Os}from"./notificationOrchestrator-Cci3Z37O.js";import{F as vt}from"./file-text-DYnGBvGu.js";import{S as ut,R as Ht,a as Ce}from"./slider-Cw6rWIj2.js";import{B as xe}from"./SidebarPremium-Bjey2152.js";import{u as Es,a as oe,P as Te,d as Ts,D as Ps,b as Se,e as As}from"./index-BpWMJgsg.js";import{c as Ut,P as De}from"./index-sBzZX1-K.js";import{d as Ws,h as Is,R as Rs,a as Fs,F as Bs,u as Ys}from"./Combination-CGrYuS6N.js";import{c as qt,R as $s,A as Vt,C as Ls,a as zs}from"./index-BMHZaHkZ.js";import{M as He}from"./message-square-DQuEZT1L.js";import{T as Ot}from"./thumbs-up-BTQ4CF83.js";import{C as Ve}from"./circle-alert-Czyt50tS.js";import{L as Et}from"./lightbulb-ChND6e8V.js";import{X as yt}from"./x-ZCLeMxGr.js";import{C as Hs}from"./chevron-left-CSV34vXX.js";import{C as Us}from"./chevron-right-DlLEuI3N.js";import{S as qs}from"./save-DLCLAimN.js";import{C as ft}from"./checkbox-CilrKHh-.js";import{c as Me}from"./utils-D4V5WNQ_.js";import{C as Gt}from"./index-Bp0dZcFm.js";import{S as Vs}from"./shield-D_-CU40R.js";import{E as Gs}from"./ellipsis-vertical-DgIylDmA.js";import{U as Zs}from"./user-CWyOXzMq.js";import{f as We,d as Xs,g as Ks,a as Js,i as Qs,s as en,b as tn,c as rn,e as sn}from"./format-CxHpq9RK.js";import{p as Pe}from"./pt-BR-CXWZr0Zs.js";import{c as pe,t as re,g as nn,n as on,e as Zt}from"./en-US-azV9x4mt.js";import{a as Xt}from"./addDays-TIrBYM62.js";import{a as Kt,n as Jt,i as an,s as ln}from"./isSameMonth-BQUH752I.js";import{d as cn}from"./differenceInCalendarMonths-Cr16ZqgI.js";import{i as dn}from"./isSameDay-7UPP47mY.js";import{e as un}from"./endOfMonth-BvBmjNQ6.js";import{U as fn}from"./users-BaZp6eLM.js";import{T as mn}from"./triangle-alert-CVkDYYk3.js";import{C as hn}from"./clock-Ca1Xubpl.js";import{C as pn}from"./circle-check-big-7fo8IdEE.js";import{T as gn}from"./trending-up-BsXLUj7W.js";import{F as xn}from"./funnel-C9FjUyPr.js";import{D as vn}from"./download-DmhiuLGw.js";import"./index-DiimN8vU.js";import"./chevron-down-reY69kiz.js";import"./check-GWOQjZuW.js";import"./chevron-up-Bj9q73lY.js";import"./bell-B4NUN7bW.js";import"./book-open-dxp_3U19.js";import"./settings-BYjJE2lM.js";import"./graduation-cap-ArnOenSA.js";import"./chart-column-BJvjjOHx.js";function yn(e,t,r){return Xt(e,t*7,r)}function bn(e,t,r){return Kt(e,t*12,r)}function wn(e,t){let r,s=t?.in;return e.forEach(o=>{!s&&typeof o=="object"&&(s=pe.bind(null,o));const a=re(o,s);(!r||r<a||isNaN(+a))&&(r=a)}),pe(s,r||NaN)}function Nn(e,t){let r,s=t?.in;return e.forEach(o=>{!s&&typeof o=="object"&&(s=pe.bind(null,o));const a=re(o,s);(!r||r>a||isNaN(+a))&&(r=a)}),pe(s,r||NaN)}function jn(e,t){const{start:r,end:s}=Jt(t?.in,e);let o=+r>+s;const a=o?+r:+s,l=o?s:r;l.setHours(0,0,0,0),l.setDate(1);let i=1;const c=[];for(;+l<=a;)c.push(pe(r,l)),l.setMonth(l.getMonth()+i);return o?c.reverse():c}function Sn(e,t){const r=re(e,t?.in),s=r.getFullYear();return r.setFullYear(s+1,0,0),r.setHours(23,59,59,999),r}function Cn(e,t){const{start:r,end:s}=Jt(t?.in,e);let o=+r>+s;const a=o?+r:+s,l=o?s:r;l.setHours(0,0,0,0),l.setMonth(0,1);let i=1;const c=[];for(;+l<=a;)c.push(pe(r,l)),l.setFullYear(l.getFullYear()+i);return o?c.reverse():c}function Qt(e,t){const r=nn(),s=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,o=re(e,t?.in),a=o.getDay(),l=(a<s?-7:0)+6-(a-s);return o.setDate(o.getDate()+l),o.setHours(23,59,59,999),o}function kn(e,t){return Qt(e,{...t,weekStartsOn:1})}function _n(e,t){const r=re(e,t?.in),s=r.getFullYear(),o=r.getMonth(),a=pe(r,0);return a.setFullYear(s,o+1,0),a.setHours(0,0,0,0),a.getDate()}function Dn(e,t){return re(e,t?.in).getMonth()}function Mn(e,t){return re(e,t?.in).getFullYear()}function On(e,t){return+re(e)>+re(t)}function En(e,t){return+re(e)<+re(t)}function Tn(e,t,r){const[s,o]=on(r?.in,e,t);return s.getFullYear()===o.getFullYear()}function Pn(e,t,r){const s=re(e,r?.in),o=s.getFullYear(),a=s.getDate(),l=pe(e,0);l.setFullYear(o,t,15),l.setHours(0,0,0,0);const i=_n(l);return s.setMonth(t,Math.min(a,i)),s}function An(e,t,r){const s=re(e,r?.in);return isNaN(+s)?pe(e,NaN):(s.setFullYear(t),s)}const Ie={"0-10":{min:0,max:10,type:"numeric",decimals:2},"0-100":{min:0,max:100,type:"numeric",decimals:0},"A-F":{type:"letter",scale:[{letter:"A",min:9,max:10},{letter:"B",min:7,max:8.9},{letter:"C",min:5,max:6.9},{letter:"D",min:3,max:4.9},{letter:"F",min:0,max:2.9}]},"pass-fail":{type:"binary",scale:[{label:"Aprovado",min:6,max:10},{label:"Reprovado",min:0,max:5.9}]},"excellent-poor":{type:"concept",scale:[{label:"Excelente",min:9,max:10},{label:"Ã“timo",min:7.5,max:8.9},{label:"Bom",min:6,max:7.4},{label:"Regular",min:4,max:5.9},{label:"Insuficiente",min:0,max:3.9}]}};function Wn(e,t="0-10"){const r=Ie[t];if(!r)return F.warn(`Sistema de notas desconhecido: ${t}, usando 0-10`),parseFloat(e);if(t==="0-10")return parseFloat(e);if(r.type==="numeric")return parseFloat(e)/r.max*10;if(r.type==="letter"){const o=r.scale.find(a=>a.letter===e.toUpperCase());if(o)return(o.min+o.max)/2}if(r.type==="binary"||r.type==="concept"){const o=r.scale.find(a=>a.label===e);if(o)return(o.min+o.max)/2}const s=parseFloat(e);return isNaN(s)?0:s}function In(e,t="0-10"){const r=Ie[t],s=parseFloat(e);if(isNaN(s))return"";if(!r)return s;if(t==="0-10")return s.toFixed(r.decimals);if(r.type==="numeric"){const o=s/10*r.max;return Math.round(o)}if(r.type==="letter"){const o=r.scale.find(a=>s>=a.min&&s<=a.max);return o?o.letter:"F"}if(r.type==="binary"||r.type==="concept"){const o=r.scale.find(a=>s>=a.min&&s<=a.max);return o?o.label:r.scale[r.scale.length-1].label}return s}function Rn(e="0-10"){const t=Ie[e];return!t||t.type==="numeric"?null:t.type==="letter"?t.scale.map(r=>r.letter):t.type==="binary"||t.type==="concept"?t.scale.map(r=>r.label):null}function Fn(e,t="0-10"){const r=Ie[t];if(!r)return!0;if(r.type==="numeric"){const s=parseFloat(e);return!isNaN(s)&&s>=r.min&&s<=r.max}return r.type==="letter"?r.scale.some(s=>s.letter===e.toUpperCase()):r.type==="binary"||r.type==="concept"?r.scale.some(s=>s.label===e):!1}const Bn=async(e={})=>{try{let t=z.from("submissions").select(`
        *,
        activity:activities(
          id,
          title,
          type,
          max_score,
          content,
          plagiarism_enabled,
          created_by,
          activity_class_assignments(
            class:classes(
              grading_system
            )
          )
        ),
        student:profiles!student_id(
          id,
          full_name,
          avatar_url,
          email
        ),
        answers(
          id,
          question_id,
          answer_json,
          points_earned
        )
      `).in("status",["submitted","graded","needs_revision"]);switch(e.classId&&(t=t.eq("activity.activity_class_assignments.class_id",e.classId)),e.activityId&&(t=t.eq("activity_id",e.activityId)),e.status&&(t=t.eq("status",e.status)),e.studentId&&(t=t.eq("student_id",e.studentId)),e.flagged&&(t=t.eq("flagged_for_review",!0)),e.plagiarism&&e.plagiarism<100&&(t=t.lt("plagiarism_score",e.plagiarism)),e.sortBy||"oldest"){case"newest":t=t.order("submitted_at",{ascending:!1});break;case"student":t=t.order("student.full_name",{ascending:!0});break;case"grade":t=t.order("grade",{ascending:!1});break;default:t=t.order("submitted_at",{ascending:!0})}const{data:s,error:o}=await t;if(o)throw o;return{data:s,error:null}}catch(t){return F.error("Erro ao buscar submissÃµes:",t),{data:null,error:t}}},Yn=async e=>{try{const{data:t,error:r}=await z.from("submissions").select(`
        *,
        activity:activities(
          id,
          title,
          description,
          type,
          max_score,
          content,
          plagiarism_enabled,
          due_date,
          created_by,
          activity_class_assignments(
            class:classes(
              grading_system
            )
          )
        ),
        student:profiles!student_id(
          id,
          full_name,
          avatar_url,
          email
        ),
        answers(*)
      `).eq("id",e).single();if(r)throw r;if(t.activity.plagiarism_enabled){const{data:s}=await z.from("plagiarism_checks").select("*").eq("submission_id",e).order("checked_at",{ascending:!1}).limit(1).single();t.plagiarism_check=s}return{data:t,error:null}}catch(t){return F.error("Erro ao buscar detalhes da submissÃ£o:",t),{data:null,error:t}}},er=async(e,t)=>{try{const{grade:r,feedback:s,rubricScores:o=[],status:a="graded",teacherId:l}=t;console.log("ðŸ“ Salvando correÃ§Ã£o:",{submissionId:e,grade:r,gradeType:typeof r,feedback:s?.substring(0,50),status:a});const{data:i}=await z.from("submissions").select(`
        activity:activities(
          max_score,
          activity_class_assignments(
            class:classes(grading_system)
          )
        )
      `).eq("id",e).single(),c=i?.activity?.max_score||10,d=i?.activity?.activity_class_assignments?.[0]?.class?.grading_system||"0-10";console.log("ðŸ“Š Convertendo nota:",{gradeInput:r,gradingSystem:d,maxScore:c});let f;const u=r;try{f=Wn(r,d),F.debug(`âœ… ConversÃ£o: "${r}" (${d}) â†’ ${f.toFixed(2)}/10`)}catch(j){throw F.error("âŒ Erro na conversÃ£o:",j),new Error(`Nota invÃ¡lida para o sistema ${d}: ${r}`)}if(f>10)throw new Error(`Nota ${r} resultou em ${f.toFixed(2)}/10, excedendo o limite.`);if(f<0)throw new Error("Nota nÃ£o pode ser negativa.");if(isNaN(f))throw new Error(`Nota invÃ¡lida: ${r}`);const h={grade:f,feedback:s||"",status:a,graded_at:new Date().toISOString()};F.debug("ðŸ“¤ Update payload:",h);const{data:p,error:y}=await z.from("submissions").update(h).eq("id",e).select().single();if(y)throw F.error("âŒ Erro no update:",y),y;if(F.debug("âœ… CorreÃ§Ã£o salva com sucesso"),o.length>0){const j=o.map(g=>({submission_id:e,rubric_id:g.rubricId,score:g.score,comment:g.comment||null})),{error:S}=await z.from("submission_rubric_scores").upsert(j);if(S)throw S}return await z.from("correction_history").insert({submission_id:e,teacher_id:l,action:"corrected",new_grade:f,notes:d!=="0-10"?`CorreÃ§Ã£o realizada: "${u}" (${d}) = ${f.toFixed(2)}/10`:`CorreÃ§Ã£o realizada: ${f} pontos`}),{data:p,error:null,converted:d!=="0-10",gradingSystem:d,originalGrade:u,normalizedGrade:f,maxScore:c}}catch(r){return F.error("Erro ao salvar correÃ§Ã£o:",r),{data:null,error:r}}},$n=async(e,t,r)=>{try{const{data:s,error:o}=await z.from("correction_drafts").upsert({submission_id:e,teacher_id:t,draft_data:r,last_saved_at:new Date().toISOString()},{onConflict:"submission_id,teacher_id"});if(o)throw o;return{data:s,error:null}}catch(s){return F.error("Erro ao salvar rascunho:",s),{data:null,error:s}}},Ln=async(e,t)=>{try{const{data:r,error:s}=await z.from("correction_drafts").select("*").eq("submission_id",e).eq("teacher_id",t).single();if(s&&s.code!=="PGRST116")throw s;return{data:r,error:null}}catch(r){return F.error("Erro ao recuperar rascunho:",r),{data:null,error:r}}},zn=async(e,t,r)=>{try{const s=[],o=[];for(const a of e){const l=await er(a,{...t,teacherId:r});l.error?o.push({submissionId:a,error:l.error}):s.push(l.data)}return{data:{success:s,failed:o,successCount:s.length,failedCount:o.length},error:null}}catch(s){return F.error("Erro na correÃ§Ã£o em lote:",s),{data:null,error:s}}},Hn=async(e,t="week")=>{try{const r=new Date,s=new Date;switch(t){case"day":s.setDate(r.getDate()-1);break;case"week":s.setDate(r.getDate()-7);break;case"month":s.setMonth(r.getMonth()-1);break;default:s.setDate(r.getDate()-7)}const{data:o,error:a}=await z.from("correction_metrics").select("*").eq("teacher_id",e).gte("date",s.toISOString().split("T")[0]).order("date",{ascending:!1});if(a)throw a;const l=o?.reduce((f,u)=>({corrections_count:f.corrections_count+(u.corrections_count||0),total_time_seconds:f.total_time_seconds+(u.total_time_seconds||0),avg_grade_given:[...f.grades,u.avg_grade_given||0],feedback_avg_length:[...f.lengths,u.feedback_avg_length||0]}),{corrections_count:0,total_time_seconds:0,grades:[],lengths:[]}),i=l.grades.length>0?l.grades.reduce((f,u)=>f+u,0)/l.grades.length:0,c=l.lengths.length>0?l.lengths.reduce((f,u)=>f+u,0)/l.lengths.length:0,d=l.corrections_count>0?l.total_time_seconds/l.corrections_count:0;return{data:{...l,avg_grade:i,avg_feedback_length:c,avg_time_per_correction:d,daily_metrics:o},error:null}}catch(r){return F.error("Erro ao buscar mÃ©tricas:",r),{data:null,error:r}}},Un=async(e,t,r,s)=>{try{const o=new Date().toISOString().split("T")[0],{data:a}=await z.from("correction_metrics").select("*").eq("teacher_id",e).eq("date",o).single(),l=(a?.corrections_count||0)+1,i=(a?.total_time_seconds||0)+t,c=a?(a.avg_grade_given*a.corrections_count+r)/l:r,d=a?(a.feedback_avg_length*a.corrections_count+s)/l:s,{data:f,error:u}=await z.from("correction_metrics").upsert({teacher_id:e,date:o,corrections_count:l,total_time_seconds:i,avg_time_per_correction:Math.round(i/l),avg_grade_given:c,feedback_avg_length:d},{onConflict:"teacher_id,date"});if(u)throw u;return{data:f,error:null}}catch(o){return F.error("Erro ao atualizar mÃ©tricas:",o),{data:null,error:o}}},qn=async e=>{try{const{data:t,error:r}=await z.from("feedback_templates").select("*").eq("teacher_id",e).order("usage_count",{ascending:!1});if(r)throw r;return{data:t,error:null}}catch(t){return F.error("Erro ao buscar templates:",t),{data:null,error:t}}},Vn=async e=>{try{const s=await fetch("https://wapbwaimkurbuihatmix.supabase.co/functions/v1/generate-feedback",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhcGJ3YWlta3VyYnVpaGF0bWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyODY3MjksImV4cCI6MjA3NDg2MjcyOX0.x-NQQ2TtRgaUjjBZCf6j49eWOW4XSqjTFKC_KB1L56A","Content-Type":"application/json"},body:JSON.stringify({submissionData:e.content,grade:e.grade,activityType:e.activityType||"assignment"})});if(!s.ok)throw new Error("Erro ao gerar feedback com IA");const o=await s.json();return{data:{suggestion:o.feedback,isAI:!0,warning:o.warning||"Esta Ã© uma sugestÃ£o gerada por IA. Revise e personalize antes de usar."},error:null}}catch(t){F.error("Erro ao gerar sugestÃ£o com IA:",t);const{grade:r,maxScore:s=10}=e,o=r/s*100;let a="";return o>=90?a="Excelente trabalho! Sua resposta demonstra compreensÃ£o profunda do tema. Continue assim!":o>=70?a="Bom trabalho! VocÃª demonstrou entendimento do tema, mas alguns pontos podem ser aprimorados.":o>=50?a="Seu trabalho mostra algum entendimento, mas hÃ¡ aspectos importantes que precisam ser revisados.":a="Recomendo revisar o material e buscar apoio para compreender melhor os conceitos.",{data:{suggestion:a,isAI:!1,warning:"Falha ao conectar com IA. Usando feedback genÃ©rico."},error:null}}},at="ivlbXbVUS4o8L8ZZpNBvPr2n5a9HZwCneMsplP6d74cf40cf",Gn="https://api.winston.ai/v1",ke={LOW:20,MEDIUM:35,HIGH:50,CRITICAL:75},Zn=e=>e>=ke.CRITICAL?"critical":e>=ke.HIGH?"high":e>=ke.MEDIUM?"medium":e>=ke.LOW?"low":"none",Xn=async(e,t={})=>{try{const r=await fetch(`${Gn}/detect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${at}`,"X-API-Key":at},body:JSON.stringify({text:e,language:t.language||"pt",threshold:t.threshold||.1,...t})});if(!r.ok){const o=await r.json().catch(()=>({message:"Unknown error"}));throw new Error(o.message||`Winston AI error: ${r.status}`)}const s=await r.json();return{score:s.score||0,severity:Zn(s.score||0),aiDetected:s.ai_generated||!1,sources:s.sources||[],rawResponse:s,confidence:s.confidence||0}}catch(r){throw F.error("Error checking for plagiarism with Winston AI:",r),r}},Kn=async(e,t,r={})=>{try{const{data:s,error:o}=await z.from("submissions").select(`
        id,
        activity_id,
        user_id,
        activities (
          id,
          class_id,
          plagiarism_enabled
        )
      `).eq("id",e).single();if(o)throw o;if(!s?.activities?.plagiarism_enabled)return{message:"Plagiarism check disabled for this activity"};const{data:a}=await z.from("plagiarism_checks_v2").select("*").eq("submission_id",e).gte("checked_at",new Date(Date.now()-3600*1e3).toISOString()).order("checked_at",{ascending:!1}).limit(1).single();if(a)return a;const l=await Xn(t,r),{data:i}=await z.from("activity_class_assignments").select("class_id").eq("activity_id",s.activity_id).limit(1).single(),{data:c,error:d}=await z.from("plagiarism_checks_v2").insert([{submission_id:e,activity_id:s.activity_id,class_id:null,plag_percent:l.score,unique_percent:l.rawResponse?.unique_percent||100-l.score,rephrased_percent:l.rawResponse?.rephrased_percent||0,exact_matched_percent:l.rawResponse?.exact_matched_percent||0,severity:l.severity,sources_detected:l.sources,winston_api_response:l.rawResponse,status:"completed"}]).select().single();if(d||(await z.from("submissions").update({plagiarism_check_status:"completed",plagiarism_checked_at:new Date().toISOString()}).eq("id",e),d))throw d;return l.severity!=="none"&&await Qn(s,l),c}catch(s){throw F.error("Error in checkSubmissionForPlagiarism:",s),s}},Jn=async e=>{try{const{data:t,error:r}=await z.from("plagiarism_notification_settings").select("*").eq("class_id",e).single();if(r&&r.code!=="PGRST116")throw r;return t||null}catch(t){return F.error("Error getting plagiarism notification settings:",t),null}},Qn=async(e,t)=>{try{const{activities:r,user_id:s}=e;if(!r?.id)return;const{data:o}=await z.from("activity_class_assignments").select(`
        class_id,
        classes (
          id,
          name,
          created_by,
          professor_id
        )
      `).eq("activity_id",r.id);if(!o?.length)return;const{data:a}=await z.from("profiles").select("full_name").eq("id",s).single();for(const l of o){const i=l.classes;if(!i?.created_by)continue;const c=await Jn(l.class_id);c&&!eo(t.severity,c)||await Ms.send("plagiarismDetected",{userId:i.created_by,variables:{studentName:a?.full_name||"Aluno",activityName:r.title||"Atividade",severity:t.severity,score:Math.round(t.score)},channelOverride:c?.notify_push!==!1?"push":void 0,email:c?.notify_email!==!1?!0:void 0,metadata:{submissionId:e.id,activityId:r.id,classId:l.class_id,severity:t.severity,score:t.score}})}}catch(r){F.error("Error notifying teacher of plagiarism:",r)}},eo=(e,t)=>{if(!t?.notify_immediately)return!1;switch(e){case"critical":return!0;case"high":return t.threshold_high<=ke.HIGH;case"medium":return t.threshold_medium<=ke.MEDIUM;case"low":return t.threshold_low<=ke.LOW;default:return!1}},to=async(e,t)=>{try{const o=await fetch("https://wapbwaimkurbuihatmix.supabase.co/functions/v1/check-plagiarism",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhcGJ3YWlta3VyYnVpaGF0bWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyODY3MjksImV4cCI6MjA3NDg2MjcyOX0.x-NQQ2TtRgaUjjBZCf6j49eWOW4XSqjTFKC_KB1L56A","Content-Type":"application/json"},body:JSON.stringify({submissionId:e,text:t})});if(!o.ok){const l=await o.json();throw new Error(l.error||"Erro ao verificar plÃ¡gio")}return{data:await o.json(),error:null}}catch(r){F.error("Erro ao verificar plÃ¡gio com edge function:",r);try{return{data:await Kn(e,t),error:null}}catch(s){return{data:null,error:s}}}},ro=({templates:e,onSelect:t})=>{if(!e||e.length===0)return null;const r=e.reduce((o,a)=>{const l=a.category||"general";return o[l]||(o[l]=[]),o[l].push(a),o},{}),s={positive:"Positivos",constructive:"Construtivos",critical:"CrÃ­ticos",general:"Gerais"};return n.jsxs(Bt,{children:[n.jsx(Yt,{asChild:!0,children:n.jsxs(Y,{variant:"outline",size:"sm",children:[n.jsx(vt,{className:"w-4 h-4 mr-2"}),"Templates"]})}),n.jsx($t,{align:"end",className:"w-80",children:Object.entries(r).map(([o,a],l)=>n.jsxs("div",{children:[l>0&&n.jsx(Ds,{}),n.jsx("div",{className:"px-2 py-1.5 text-sm font-semibold text-gray-500",children:s[o]||o}),a.map(i=>n.jsx(dt,{onClick:()=>t(i),className:"cursor-pointer",children:n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-sm line-clamp-2",children:i.template_text}),n.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Usado ",i.usage_count||0,"x"]})]})},i.id))]},o))})]})},so=({rubric:e,scores:t,onChange:r,onTotalChange:s})=>{const[o,a]=m.useState({});m.useEffect(()=>{const c={};e?.criteria?.forEach(d=>{const f=t.find(u=>u.rubricId===d.id);c[d.id]=f?.score||0}),a(c)},[e,t]),m.useEffect(()=>{const c=Object.values(o).reduce((d,f)=>d+(parseFloat(f)||0),0);s(c)},[o,s]);const l=(c,d)=>{a(u=>({...u,[c]:d}));const f=e.criteria.map(u=>({rubricId:u.id,score:u.id===c?parseFloat(d)||0:o[u.id]||0}));r(f)};if(!e||!e.criteria)return n.jsx("div",{className:"text-gray-600 text-sm",children:"Esta atividade nÃ£o possui rubrica configurada."});const i=Object.values(o).reduce((c,d)=>c+(parseFloat(d)||0),0);return n.jsxs("div",{className:"space-y-4",children:[e.criteria.map(c=>n.jsx(U,{className:"p-4",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-semibold",children:c.name}),c.description&&n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c.description})]}),n.jsxs("div",{className:"text-right ml-4",children:[n.jsx("div",{className:"text-sm text-gray-500",children:"MÃ¡ximo"}),n.jsx("div",{className:"font-semibold",children:c.maxScore})]})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx(ut,{value:[o[c.id]||0],onValueChange:([d])=>l(c.id,d),max:c.maxScore,step:.1,className:"flex-1"}),n.jsx(Xe,{type:"number",min:"0",max:c.maxScore,step:"0.1",value:o[c.id]||0,onChange:d=>l(c.id,d.target.value),className:"w-20 text-center"})]}),c.levels&&n.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:c.levels.map((d,f)=>n.jsxs("div",{className:"p-2 rounded bg-gray-50 cursor-pointer hover:bg-gray-100",onClick:()=>l(c.id,d.percentage/100*c.maxScore),children:[n.jsx("div",{className:"font-semibold",children:d.level}),n.jsxs("div",{className:"text-gray-600",children:[d.percentage,"% - ",d.description]})]},f))})]})},c.id)),n.jsx(U,{className:"p-4 bg-blue-50 dark:bg-blue-950/30",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("div",{className:"font-semibold text-lg",children:"Nota Total"}),n.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[i.toFixed(1)," / ",e.criteria.reduce((c,d)=>c+d.maxScore,0)]})]})})]})},no=({submission:e})=>{const t=e.content,r=e.activity?.content?.questions||[],s=e.answers||[];if(console.log("ðŸ” SubmissionView Debug:",{activityType:e.activity?.type,hasQuestions:r.length>0,questionsCount:r.length,answersCount:s.length,content:t,questions:r,answers:s}),r.length>0&&s.length>0)return n.jsx("div",{className:"space-y-4",children:r.map((a,l)=>{const i=s.find(u=>u.question_id===a.id||u.question_id===`question_${l}`||u.question_id===l.toString()),c=i?.answer_json?.answer||i?.answer_json?.selected||(typeof i?.answer_json=="string"?i.answer_json:null),d=(i?.points_earned||0)>0,f=a.correctAnswer||a.correct_answer||a.answer;return n.jsxs(U,{className:"p-4",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("h4",{className:"font-semibold",children:["QuestÃ£o ",l+1]}),n.jsxs(xe,{variant:d?"success":"destructive",children:[d?"âœ“ Correta":"âœ— Incorreta",i?.points_earned!==void 0&&` (${i.points_earned} pts)`]})]}),n.jsx("p",{className:"text-sm mb-3 font-medium",children:a.text||a.question||a.prompt}),n.jsxs("div",{className:"space-y-2 mb-3",children:[n.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 rounded",children:[n.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Resposta do aluno:"}),n.jsx("p",{className:"text-sm font-medium",children:c||"NÃ£o respondeu"})]}),n.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-950/20 rounded",children:[n.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Resposta correta:"}),n.jsx("p",{className:"text-sm font-medium text-green-700 dark:text-green-400",children:f||"NÃ£o especificada"})]})]}),a.options&&a.options.length>0&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"OpÃ§Ãµes:"}),a.options.map((u,h)=>n.jsx("div",{className:`p-2 rounded text-sm ${u===f?"bg-green-100 dark:bg-green-950/30 border border-green-500":u===c?"bg-red-100 dark:bg-red-950/30 border border-red-500":"bg-gray-50 dark:bg-gray-800"}`,children:u},h))]}),a.explanation&&n.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-950/20 rounded text-sm",children:[n.jsx("strong",{children:"ExplicaÃ§Ã£o:"})," ",a.explanation]})]},l)})});const o=()=>{if(!t)return"Sem conteÃºdo";if(typeof t=="string")return t;if(t.text)return t.text;if(t.answer)return t.answer;const a=Object.keys(t);return a.length>0&&a.every(l=>/^\d+$/.test(l))?n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Respostas do aluno:"}),a.map(l=>n.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 rounded border",children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Resposta:"}),n.jsx("p",{className:"font-mono text-sm font-medium",children:t[l]})]},l))]}):n.jsx("pre",{className:"text-xs overflow-auto bg-gray-100 dark:bg-gray-800 p-3 rounded",children:JSON.stringify(t,null,2)})};if(e.activity?.type==="assignment")return n.jsxs("div",{className:"prose max-w-none",children:[n.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg whitespace-pre-wrap",children:o()}),t?.attachments&&t.attachments.length>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("h4",{className:"font-semibold mb-2",children:"Anexos:"}),n.jsx("ul",{className:"space-y-2",children:t.attachments.map((a,l)=>n.jsx("li",{children:n.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:a.name})},l))})]})]});if(e.activity?.type==="quiz"){const a=e.activity?.content?.questions||[],l=e.answers||[];return n.jsx("div",{className:"space-y-4",children:a.map((i,c)=>{const d=l.find(p=>p.question_id===i.id||p.question_id===`question_${c}`||p.question_id===c.toString()),f=d?.answer_json?.answer||d?.answer_json?.selected||(typeof d?.answer_json=="string"?d.answer_json:null),u=(d?.points_earned||0)>0,h=i.correctAnswer||i.correct_answer||i.answer;return n.jsxs(U,{className:"p-4",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("h4",{className:"font-semibold",children:["QuestÃ£o ",c+1]}),n.jsxs(xe,{variant:u?"success":"destructive",children:[u?"âœ“ Correta":"âœ— Incorreta",d?.points_earned!==void 0&&` (${d.points_earned} pts)`]})]}),n.jsx("p",{className:"text-sm mb-3 font-medium",children:i.text||i.question||i.prompt}),n.jsxs("div",{className:"space-y-2 mb-3",children:[n.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 rounded",children:[n.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Resposta do aluno:"}),n.jsx("p",{className:"text-sm font-medium",children:f||"NÃ£o respondeu"})]}),n.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-950/20 rounded",children:[n.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Resposta correta:"}),n.jsx("p",{className:"text-sm font-medium text-green-700 dark:text-green-400",children:h||"NÃ£o especificada"})]})]}),i.options&&i.options.length>0&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"OpÃ§Ãµes:"}),i.options.map((p,y)=>n.jsx("div",{className:`p-2 rounded text-sm ${p===h?"bg-green-100 dark:bg-green-950/30 border border-green-500":p===f?"bg-red-100 dark:bg-red-950/30 border border-red-500":"bg-gray-50 dark:bg-gray-800"}`,children:p},y))]}),i.explanation&&n.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-950/20 rounded text-sm",children:[n.jsx("strong",{children:"ExplicaÃ§Ã£o:"})," ",i.explanation]})]},c)})})}return n.jsx("div",{className:"text-gray-600",children:"Tipo de atividade nÃ£o suportado para visualizaÃ§Ã£o"})};var Ke="Popover",[tr]=Ut(Ke,[qt]),Re=qt(),[oo,ye]=tr(Ke),rr=e=>{const{__scopePopover:t,children:r,open:s,defaultOpen:o,onOpenChange:a,modal:l=!1}=e,i=Re(t),c=m.useRef(null),[d,f]=m.useState(!1),[u,h]=Es({prop:s,defaultProp:o??!1,onChange:a,caller:Ke});return n.jsx($s,{...i,children:n.jsx(oo,{scope:t,contentId:Ws(),triggerRef:c,open:u,onOpenChange:h,onOpenToggle:m.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:d,onCustomAnchorAdd:m.useCallback(()=>f(!0),[]),onCustomAnchorRemove:m.useCallback(()=>f(!1),[]),modal:l,children:r})})};rr.displayName=Ke;var sr="PopoverAnchor",ao=m.forwardRef((e,t)=>{const{__scopePopover:r,...s}=e,o=ye(sr,r),a=Re(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:i}=o;return m.useEffect(()=>(l(),()=>i()),[l,i]),n.jsx(Vt,{...a,...s,ref:t})});ao.displayName=sr;var nr="PopoverTrigger",or=m.forwardRef((e,t)=>{const{__scopePopover:r,...s}=e,o=ye(nr,r),a=Re(r),l=ve(t,o.triggerRef),i=n.jsx(De.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":dr(o.open),...s,ref:l,onClick:oe(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?i:n.jsx(Vt,{asChild:!0,...a,children:i})});or.displayName=nr;var bt="PopoverPortal",[io,lo]=tr(bt,{forceMount:void 0}),ar=e=>{const{__scopePopover:t,forceMount:r,children:s,container:o}=e,a=ye(bt,t);return n.jsx(io,{scope:t,forceMount:r,children:n.jsx(Te,{present:r||a.open,children:n.jsx(Ts,{asChild:!0,container:o,children:s})})})};ar.displayName=bt;var Oe="PopoverContent",ir=m.forwardRef((e,t)=>{const r=lo(Oe,e.__scopePopover),{forceMount:s=r.forceMount,...o}=e,a=ye(Oe,e.__scopePopover);return n.jsx(Te,{present:s||a.open,children:a.modal?n.jsx(uo,{...o,ref:t}):n.jsx(fo,{...o,ref:t})})});ir.displayName=Oe;var co=xs("PopoverContent.RemoveScroll"),uo=m.forwardRef((e,t)=>{const r=ye(Oe,e.__scopePopover),s=m.useRef(null),o=ve(t,s),a=m.useRef(!1);return m.useEffect(()=>{const l=s.current;if(l)return Is(l)},[]),n.jsx(Rs,{as:co,allowPinchZoom:!0,children:n.jsx(lr,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:oe(e.onCloseAutoFocus,l=>{l.preventDefault(),a.current||r.triggerRef.current?.focus()}),onPointerDownOutside:oe(e.onPointerDownOutside,l=>{const i=l.detail.originalEvent,c=i.button===0&&i.ctrlKey===!0,d=i.button===2||c;a.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:oe(e.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),fo=m.forwardRef((e,t)=>{const r=ye(Oe,e.__scopePopover),s=m.useRef(!1),o=m.useRef(!1);return n.jsx(lr,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{e.onCloseAutoFocus?.(a),a.defaultPrevented||(s.current||r.triggerRef.current?.focus(),a.preventDefault()),s.current=!1,o.current=!1},onInteractOutside:a=>{e.onInteractOutside?.(a),a.defaultPrevented||(s.current=!0,a.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const l=a.target;r.triggerRef.current?.contains(l)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&o.current&&a.preventDefault()}})}),lr=m.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:a,disableOutsidePointerEvents:l,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:f,...u}=e,h=ye(Oe,r),p=Re(r);return Fs(),n.jsx(Bs,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:o,onUnmountAutoFocus:a,children:n.jsx(Ps,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:f,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:n.jsx(Ls,{"data-state":dr(h.open),role:"dialog",id:h.contentId,...p,...u,ref:t,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),cr="PopoverClose",mo=m.forwardRef((e,t)=>{const{__scopePopover:r,...s}=e,o=ye(cr,r);return n.jsx(De.button,{type:"button",...s,ref:t,onClick:oe(e.onClick,()=>o.onOpenChange(!1))})});mo.displayName=cr;var ho="PopoverArrow",po=m.forwardRef((e,t)=>{const{__scopePopover:r,...s}=e,o=Re(r);return n.jsx(zs,{...o,...s,ref:t})});po.displayName=ho;function dr(e){return e?"open":"closed"}var go=rr,xo=or,vo=ar,ur=ir;const fr=go,mr=xo,wt=m.forwardRef(({className:e,align:t="center",sideOffset:r=4,...s},o)=>n.jsx(vo,{children:n.jsx(ur,{ref:o,align:t,sideOffset:r,className:ht("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));wt.displayName=ur.displayName;const yo=({text:e,comments:t=[],onAddComment:r,onDeleteComment:s})=>{const[o,a]=m.useState(null),[l,i]=m.useState(!1),[c,d]=m.useState(""),[f,u]=m.useState("correction"),h=()=>{const g=window.getSelection(),N=g.toString().trim();if(N.length>0){const x=g.getRangeAt(0),D=x.getBoundingClientRect();a({text:N,start:x.startOffset,end:x.endOffset,rect:{top:D.top+window.scrollY,left:D.left+window.scrollX}}),i(!0)}},p=()=>{if(!o||!c)return;const g={id:Date.now().toString(),text:c,type:f,selection:{text:o.text,start:o.start,end:o.end},createdAt:new Date().toISOString()};r(g),d(""),u("correction"),i(!1),a(null)},y=g=>{switch(g){case"praise":return n.jsx(Ot,{className:"w-4 h-4 text-green-600"});case"correction":return n.jsx(Ve,{className:"w-4 h-4 text-red-600"});case"question":return n.jsx(He,{className:"w-4 h-4 text-blue-600"});case"suggestion":return n.jsx(Et,{className:"w-4 h-4 text-yellow-600"});default:return n.jsx(He,{className:"w-4 h-4"})}},j=g=>{switch(g){case"praise":return"bg-green-100 border-green-300";case"correction":return"bg-red-100 border-red-300";case"question":return"bg-blue-100 border-blue-300";case"suggestion":return"bg-yellow-100 border-yellow-300";default:return"bg-gray-100 border-gray-300"}},S=()=>!e||t.length===0?n.jsx("p",{className:"whitespace-pre-wrap",children:e}):n.jsxs("div",{className:"relative",onMouseUp:h,children:[n.jsx("p",{className:"whitespace-pre-wrap",children:e}),t.map((g,N)=>n.jsx("span",{className:"absolute bg-yellow-200 opacity-30 pointer-events-none",style:{top:`${N*2}rem`,left:0}},g.id))]});return n.jsxs("div",{className:"space-y-4",children:[n.jsxs(U,{className:"p-4 bg-gray-50",children:[n.jsx("div",{className:"prose max-w-none",children:S()}),l&&o&&n.jsxs(fr,{open:l,onOpenChange:i,children:[n.jsx(mr,{asChild:!0,children:n.jsx("div",{className:"absolute bg-blue-600 text-white rounded-full p-2 shadow-lg cursor-pointer",style:{top:o.rect?.top-40,left:o.rect?.left},children:n.jsx(He,{className:"w-4 h-4"})})}),n.jsx(wt,{className:"w-80",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx(H,{className:"text-sm font-semibold",children:"Texto selecionado:"}),n.jsxs("p",{className:"text-sm italic text-gray-600 mt-1",children:['"',o.text,'"']})]}),n.jsxs("div",{children:[n.jsx(H,{children:"Tipo de ComentÃ¡rio"}),n.jsxs(Ht,{value:f,onValueChange:u,className:"mt-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ce,{value:"praise",id:"praise"}),n.jsxs(H,{htmlFor:"praise",className:"cursor-pointer flex items-center gap-2",children:[n.jsx(Ot,{className:"w-4 h-4 text-green-600"}),"Elogio"]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ce,{value:"correction",id:"correction"}),n.jsxs(H,{htmlFor:"correction",className:"cursor-pointer flex items-center gap-2",children:[n.jsx(Ve,{className:"w-4 h-4 text-red-600"}),"CorreÃ§Ã£o"]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ce,{value:"question",id:"question"}),n.jsxs(H,{htmlFor:"question",className:"cursor-pointer flex items-center gap-2",children:[n.jsx(He,{className:"w-4 h-4 text-blue-600"}),"DÃºvida"]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ce,{value:"suggestion",id:"suggestion"}),n.jsxs(H,{htmlFor:"suggestion",className:"cursor-pointer flex items-center gap-2",children:[n.jsx(Et,{className:"w-4 h-4 text-yellow-600"}),"SugestÃ£o"]})]})]})]}),n.jsxs("div",{children:[n.jsx(H,{children:"ComentÃ¡rio"}),n.jsx(xt,{value:c,onChange:g=>d(g.target.value),placeholder:"Digite seu comentÃ¡rio...",className:"mt-1",rows:3})]}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Y,{variant:"outline",size:"sm",onClick:()=>i(!1),children:"Cancelar"}),n.jsx(Y,{size:"sm",onClick:p,disabled:!c,children:"Adicionar"})]})]})})]})]}),t.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsxs("h4",{className:"font-semibold text-sm",children:["ComentÃ¡rios (",t.length,")"]}),t.map((g,N)=>n.jsx(U,{className:`p-3 ${j(g.type)} border-l-4`,children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[y(g.type),n.jsxs(xe,{variant:"outline",className:"text-xs",children:["#",N+1]}),n.jsxs("span",{className:"text-xs text-gray-500 italic",children:['"',g.selection.text,'"']})]}),n.jsx("p",{className:"text-sm",children:g.text})]}),n.jsx(Y,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>s(g.id),children:n.jsx(yt,{className:"w-4 h-4"})})]})},g.id))]}),t.length===0&&n.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Selecione um trecho do texto acima para adicionar um comentÃ¡rio"})]})},bo=({submission:e,submissions:t=[],currentIndex:r=0,onClose:s,onSaved:o,onNavigate:a})=>{const{user:l}=pt(),{toast:i}=gt(),c=e.activity?.activity_class_assignments?.[0]?.class?.grading_system||"0-10",d=Rn(c),f=Ie[c],[u,h]=m.useState(!1),[p,y]=m.useState(!1),[j,S]=m.useState(!1),g=e.grade?In(e.grade,c):"",[N,x]=m.useState(g),[D,v]=m.useState(e.feedback||""),[_,C]=m.useState([]),[T,E]=m.useState([]),[W,R]=m.useState([]),[V]=m.useState(Date.now()),J=r>0,ie=r<t.length-1,Z=e.activity?.max_score||10,ne=N!==""&&Fn(N,c),be=D.length>=20;m.useEffect(()=>{X(),K();const w=setInterval(()=>{(N||D)&&Q()},3e4);return()=>clearInterval(w)},[]);const X=async()=>{const{data:w}=await qn(l.id);w&&E(w)},K=async()=>{const{data:w}=await Ln(e.id,l.id);w?.draft_data&&(x(w.draft_data.grade||""),v(w.draft_data.feedback||""),C(w.draft_data.rubricScores||[]))},Q=async()=>{await $n(e.id,l.id,{grade:N,feedback:D,rubricScores:_})},we=async()=>{if(!ne){i({title:"Erro",description:`A nota deve estar entre 0 e ${Z}`,variant:"destructive"});return}if(!be){i({title:"Aviso",description:"Recomendamos um feedback com pelo menos 20 caracteres",variant:"destructive"});return}h(!0);try{const w=Math.round((Date.now()-V)/1e3),A=await er(e.id,{grade:N,feedback:D,rubricScores:_,teacherId:l.id});if(A.error)throw A.error;if(A.converted){const q={"0-10":"0-10","0-100":"0-100","A-F":"A-F","pass-fail":"Aprovado/Reprovado","excellent-poor":"Conceitos"}[A.gradingSystem]||A.gradingSystem;i({title:"â„¹ï¸ Nota Convertida",description:`Nota "${A.originalGrade}" (${q}) foi salva como ${A.normalizedGrade.toFixed(2)}/10 no sistema`,duration:4e3})}await Un(l.id,w,parseFloat(N),D.length);try{await Os.sendCorrectionNotification({submissionId:e.id,studentId:e.student_id,activityTitle:e.activity?.title,grade:parseFloat(N),maxScore:Z})}catch(q){F.error("Erro ao enviar notificaÃ§Ã£o:",q)}o()}catch(w){F.error("Erro ao salvar correÃ§Ã£o:",w),i({title:"Erro",description:"NÃ£o foi possÃ­vel salvar a correÃ§Ã£o",variant:"destructive"})}finally{h(!1)}},Ne=w=>{v(A=>A?`${A}

${w.template_text}`:w.template_text)},je=async()=>{if(!N){i({title:"Erro",description:"Atribua uma nota antes de gerar feedback com IA",variant:"destructive"});return}y(!0);try{const{data:w,error:A}=await Vn({content:e.content,grade:parseFloat(N),maxScore:Z,activityType:e.activity?.type});if(A)throw A;w.suggestion&&(v(q=>q?`${q}

${w.suggestion}`:w.suggestion),i({title:"Feedback gerado",description:w.warning||"Revise e personalize antes de salvar"}))}catch{i({title:"Erro",description:"NÃ£o foi possÃ­vel gerar feedback com IA",variant:"destructive"})}finally{y(!1)}},M=async()=>{const w=typeof e.content=="string"?e.content:e.content?.text||"";if(!w){i({title:"Erro",description:"Sem texto para verificar",variant:"destructive"});return}S(!0);try{const{data:A,error:q}=await to(e.id,w);if(q)throw q;i({title:"VerificaÃ§Ã£o concluÃ­da",description:`Originalidade: ${A.plagiarismScore}% - ${A.message}`,variant:A.severity==="high"?"destructive":"default"})}catch{i({title:"Erro",description:"NÃ£o foi possÃ­vel verificar plÃ¡gio",variant:"destructive"})}finally{S(!1)}};return n.jsx(Ue,{open:!0,onOpenChange:()=>{},children:n.jsxs(qe,{className:"max-w-7xl h-[90vh] p-0 overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-white dark:bg-slate-900",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Y,{variant:"outline",size:"icon",onClick:()=>a&&a("prev"),disabled:!J,children:n.jsx(Hs,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.student?.full_name}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:e.activity?.title}),t.length>0&&n.jsxs("p",{className:"text-sm text-gray-500",children:[r+1," de ",t.length]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Y,{variant:"outline",size:"icon",onClick:()=>a&&a("next"),disabled:!ie,children:n.jsx(Us,{className:"w-5 h-5"})}),n.jsx(Y,{variant:"ghost",size:"icon",onClick:s,title:"Fechar e voltar",children:n.jsx(yt,{className:"w-5 h-5"})})]})]}),n.jsx("div",{className:"flex-1 overflow-hidden",children:n.jsxs("div",{className:"h-full grid grid-cols-2 gap-6 p-6",children:[n.jsxs("div",{className:"overflow-y-auto space-y-4",children:[n.jsxs(U,{className:"p-6",children:[n.jsx("h3",{className:"font-semibold text-lg mb-4",children:"SubmissÃ£o do Aluno"}),n.jsx(no,{submission:e})]}),e.activity?.plagiarism_enabled&&n.jsxs(U,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"font-semibold text-lg",children:"VerificaÃ§Ã£o de PlÃ¡gio"}),n.jsx(Y,{variant:"outline",size:"sm",onClick:M,disabled:j,children:j?"Verificando...":"ðŸ” Verificar"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ve,{className:"w-5 h-5 text-yellow-600"}),n.jsxs("span",{children:["Originalidade: ",e.plagiarism_score||"NÃ£o verificado","%"]})]})]}),e.activity?.type==="assignment"&&n.jsxs(U,{className:"p-6",children:[n.jsx("h3",{className:"font-semibold text-lg mb-4",children:"ComentÃ¡rios no Texto"}),n.jsx(yo,{text:typeof e.content=="string"?e.content:e.content?.text,comments:W,onAddComment:w=>R(A=>[...A,w]),onDeleteComment:w=>R(A=>A.filter(q=>q.id!==w))})]})]}),n.jsxs("div",{className:"overflow-y-auto space-y-4",children:[e.activity?.content?.rubric&&n.jsxs(U,{className:"p-6",children:[n.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Rubrica de AvaliaÃ§Ã£o"}),n.jsx(so,{rubric:e.activity.content.rubric,scores:_,onChange:C,onTotalChange:w=>x(w.toString())})]}),n.jsxs(U,{className:"p-6",children:[n.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Nota Final"}),n.jsxs("div",{className:"space-y-2",children:[d?n.jsxs("select",{value:N,onChange:w=>x(w.target.value),className:"w-full px-4 py-3 text-2xl font-bold text-center border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",children:[n.jsx("option",{value:"",children:"Selecione..."}),d.map(w=>n.jsx("option",{value:w,children:w},w))]}):n.jsx(Xe,{type:"number",min:f?.min||0,max:f?.max||Z,step:f?.type==="numeric"&&f.max===100?"1":"0.1",value:N,onChange:w=>x(w.target.value),className:"text-2xl font-bold text-center",placeholder:"0"}),n.jsx("p",{className:"text-sm text-center text-gray-600 dark:text-gray-400",children:f?.type==="numeric"?`Escala: ${f.min}-${f.max}`:`Sistema: ${c}`}),!ne&&N!==""&&n.jsxs("p",{className:"text-sm text-red-600 text-center",children:["Nota invÃ¡lida para o sistema ",c]})]})]}),n.jsxs(U,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"font-semibold text-lg",children:"Feedback"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Y,{variant:"outline",size:"sm",onClick:je,disabled:p||!N,children:p?"Gerando...":"âœ¨ IA"}),n.jsx(ro,{templates:T,onSelect:Ne})]})]}),n.jsx(xt,{value:D,onChange:w=>v(w.target.value),placeholder:"Escreva um feedback detalhado para o aluno...",className:"min-h-[200px]"}),n.jsx("div",{className:"flex justify-between mt-2 text-sm",children:n.jsxs("span",{className:D.length<20?"text-red-600":"text-gray-600",children:[D.length," caracteres ",D.length<20&&"(mÃ­nimo recomendado: 20)"]})})]})]})]})}),n.jsxs("div",{className:"flex items-center justify-between p-6 border-t bg-white dark:bg-slate-900",children:[n.jsx(Y,{variant:"outline",onClick:s,children:"Cancelar"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Y,{variant:"outline",onClick:Q,disabled:u,children:"Salvar Rascunho"}),n.jsxs(Y,{onClick:we,disabled:u||!ne,className:"bg-green-600 hover:bg-green-700",children:[n.jsx(qs,{className:"w-4 h-4 mr-2"}),u?"Salvando...":"Salvar e Fechar"]})]})]})]})})},wo=({submission:e,onCorrect:t,isSelected:r,onSelect:s})=>{const o=d=>{const f={submitted:{label:"Aguardando",color:"bg-yellow-500 text-white"},graded:{label:"Corrigida",color:"bg-green-500 text-white"},needs_revision:{label:"RevisÃ£o",color:"bg-orange-500 text-white"}};return f[d]||f.submitted},a=d=>{const f={assignment:{label:"Aberta",color:"bg-green-100 text-green-700"},quiz:{label:"Fechada",color:"bg-blue-100 text-blue-700"},project:{label:"Mista",color:"bg-purple-100 text-purple-700"}};return f[d]||f.assignment},l=e.submitted_at&&e.activity?.due_date&&new Date(e.submitted_at)>new Date(e.activity.due_date),i=o(e.status),c=a(e.activity?.type);return n.jsx(U,{className:Me("p-4 hover:shadow-md transition-all duration-200",e.flagged_for_review&&"border-l-4 border-l-red-500",r&&"ring-2 ring-blue-500 bg-blue-50"),children:n.jsxs("div",{className:"flex items-center gap-4",children:[s&&n.jsx(ft,{checked:r,onCheckedChange:s}),n.jsx("div",{className:"flex-shrink-0",children:e.student?.avatar_url?n.jsx("img",{src:e.student.avatar_url,alt:e.student.full_name,className:"w-12 h-12 rounded-full"}):n.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:e.student?.full_name?.[0]||"A"})}),n.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.student?.full_name||"Aluno Desconhecido"}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:e.activity?.title||"Atividade"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(xe,{className:Me("text-xs",c.color),children:c.label}),n.jsx(xe,{className:Me("text-xs",i.color),children:i.label})]})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Gt,{className:"w-4 h-4"}),n.jsx("span",{children:e.submitted_at?We(new Date(e.submitted_at),"dd/MM/yyyy 'Ã s' HH:mm",{locale:Pe}):"NÃ£o submetida"})]}),l&&n.jsx(xe,{variant:"destructive",className:"text-xs",children:"Atrasada"}),e.activity?.plagiarism_enabled&&e.plagiarism_score!==null&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Vs,{className:Me("w-4 h-4",e.plagiarism_score>=90?"text-green-600":e.plagiarism_score>=70?"text-yellow-600":"text-red-600")}),n.jsxs("span",{children:[e.plagiarism_score,"% original"]})]}),e.grade!==null&&n.jsxs("div",{className:"font-semibold",children:["Nota: ",e.grade,"/",e.activity?.max_score||10]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Y,{onClick:t,className:Me(e.status==="graded"?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700"),children:e.status==="graded"?"Revisar":"Corrigir"}),n.jsxs(Bt,{children:[n.jsx(Yt,{asChild:!0,children:n.jsx(Y,{variant:"ghost",size:"icon",children:n.jsx(Gs,{className:"w-5 h-5"})})}),n.jsxs($t,{align:"end",children:[n.jsxs(dt,{children:[n.jsx(vt,{className:"w-4 h-4 mr-2"}),"Ver Atividade"]}),n.jsxs(dt,{children:[n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Ver Perfil do Aluno"]})]})]})]})]})})},No=({submissions:e,onClose:t,onCompleted:r})=>{const{user:s}=pt(),{toast:o}=gt(),[a,l]=m.useState(!1),[i,c]=m.useState("same_grade"),[d,f]=m.useState(""),[u,h]=m.useState(""),[p,y]=m.useState(""),[j,S]=m.useState("add"),g=e[0]?.activity?.max_score||10,N=async()=>{l(!0);try{let x={feedback:u};if(i==="same_grade"){if(!d||parseFloat(d)<0||parseFloat(d)>g){o({title:"Erro",description:`Nota deve estar entre 0 e ${g}`,variant:"destructive"}),l(!1);return}x.grade=parseFloat(d)}const D=e.map(C=>C.id),{data:v,error:_}=await zn(D,x,s.id);if(_)throw _;o({title:"Sucesso",description:`${v.successCount} submissÃµes corrigidas. ${v.failedCount} falharam.`}),r(),t()}catch(x){F.error("Erro na correÃ§Ã£o em lote:",x),o({title:"Erro",description:"NÃ£o foi possÃ­vel completar a correÃ§Ã£o em lote",variant:"destructive"})}finally{l(!1)}};return n.jsx(Ue,{open:!0,onOpenChange:t,children:n.jsxs(qe,{className:"max-w-3xl",children:[n.jsxs(Lt,{children:[n.jsx(zt,{children:"CorreÃ§Ã£o em Lote"}),n.jsxs("p",{className:"text-sm text-gray-600",children:[e.length," submissÃµes selecionadas"]})]}),n.jsxs("div",{className:"space-y-6 py-4",children:[n.jsxs(U,{className:"p-4 max-h-40 overflow-y-auto",children:[n.jsx("h4",{className:"font-semibold mb-2",children:"SubmissÃµes:"}),n.jsx("ul",{className:"space-y-1 text-sm",children:e.map(x=>n.jsxs("li",{className:"flex justify-between",children:[n.jsx("span",{children:x.student?.full_name}),n.jsx("span",{className:"text-gray-500",children:x.activity?.title})]},x.id))})]}),n.jsxs("div",{children:[n.jsx(H,{className:"text-base font-semibold mb-3 block",children:"MÃ©todo de CorreÃ§Ã£o"}),n.jsx(Ht,{value:i,onValueChange:c,children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ce,{value:"same_grade",id:"same_grade"}),n.jsx(H,{htmlFor:"same_grade",className:"cursor-pointer",children:"Mesma nota para todas"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ce,{value:"by_criteria",id:"by_criteria"}),n.jsx(H,{htmlFor:"by_criteria",className:"cursor-pointer",children:"Nota baseada em critÃ©rio (em breve)"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ce,{value:"adjust",id:"adjust"}),n.jsx(H,{htmlFor:"adjust",className:"cursor-pointer",children:"Ajuste proporcional (em breve)"})]})]})})]}),i==="same_grade"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs(H,{children:["Nota (0 - ",g,")"]}),n.jsx(Xe,{type:"number",min:"0",max:g,step:"0.1",value:d,onChange:x=>f(x.target.value),className:"mt-1"})]}),n.jsxs("div",{children:[n.jsx(H,{children:"Feedback PadrÃ£o"}),n.jsx(xt,{value:u,onChange:x=>h(x.target.value),placeholder:"Digite um feedback que serÃ¡ aplicado a todas as submissÃµes...",className:"mt-1",rows:4})]})]}),n.jsxs(U,{className:"p-4 bg-blue-50 dark:bg-blue-950/30",children:[n.jsx("h4",{className:"font-semibold mb-2",children:"Preview do Resultado"}),n.jsxs("div",{className:"text-sm space-y-1",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"SubmissÃµes afetadas:"})," ",e.length]}),i==="same_grade"&&d&&n.jsxs("p",{children:[n.jsx("strong",{children:"Nota a ser atribuÃ­da:"})," ",d,"/",g]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Feedback:"})," ",u?`${u.substring(0,50)}...`:"Nenhum"]})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Y,{variant:"outline",onClick:t,disabled:a,children:"Cancelar"}),n.jsx(Y,{onClick:N,disabled:a||!d,className:"bg-green-600 hover:bg-green-700",children:a?"Aplicando...":"Aplicar CorreÃ§Ãµes"})]})]})})};function jo(e,t,r="long"){return new Intl.DateTimeFormat("en-US",{hour:"numeric",timeZone:e,timeZoneName:r}).format(t).split(/\s/g).slice(2).join(" ")}const So={},Ae={};function _e(e,t){try{const s=(So[e]||=new Intl.DateTimeFormat("en-US",{timeZone:e,timeZoneName:"longOffset"}).format)(t).split("GMT")[1];return s in Ae?Ae[s]:Tt(s,s.split(":"))}catch{if(e in Ae)return Ae[e];const r=e?.match(Co);return r?Tt(e,r.slice(1)):NaN}}const Co=/([+-]\d\d):?(\d\d)?/;function Tt(e,t){const r=+(t[0]||0),s=+(t[1]||0),o=+(t[2]||0)/60;return Ae[e]=r*60+s>0?r*60+s+o:r*60-s-o}class de extends Date{constructor(...t){super(),t.length>1&&typeof t[t.length-1]=="string"&&(this.timeZone=t.pop()),this.internal=new Date,isNaN(_e(this.timeZone,this))?this.setTime(NaN):t.length?typeof t[0]=="number"&&(t.length===1||t.length===2&&typeof t[1]!="number")?this.setTime(t[0]):typeof t[0]=="string"?this.setTime(+new Date(t[0])):t[0]instanceof Date?this.setTime(+t[0]):(this.setTime(+new Date(...t)),hr(this),mt(this)):this.setTime(Date.now())}static tz(t,...r){return r.length?new de(...r,t):new de(Date.now(),t)}withTimeZone(t){return new de(+this,t)}getTimezoneOffset(){const t=-_e(this.timeZone,this);return t>0?Math.floor(t):Math.ceil(t)}setTime(t){return Date.prototype.setTime.apply(this,arguments),mt(this),+this}[Symbol.for("constructDateFrom")](t){return new de(+new Date(t),this.timeZone)}}const Pt=/^(get|set)(?!UTC)/;Object.getOwnPropertyNames(Date.prototype).forEach(e=>{if(!Pt.test(e))return;const t=e.replace(Pt,"$1UTC");de.prototype[t]&&(e.startsWith("get")?de.prototype[e]=function(){return this.internal[t]()}:(de.prototype[e]=function(){return Date.prototype[t].apply(this.internal,arguments),ko(this),+this},de.prototype[t]=function(){return Date.prototype[t].apply(this,arguments),mt(this),+this}))});function mt(e){e.internal.setTime(+e),e.internal.setUTCSeconds(e.internal.getUTCSeconds()-Math.round(-_e(e.timeZone,e)*60))}function ko(e){Date.prototype.setFullYear.call(e,e.internal.getUTCFullYear(),e.internal.getUTCMonth(),e.internal.getUTCDate()),Date.prototype.setHours.call(e,e.internal.getUTCHours(),e.internal.getUTCMinutes(),e.internal.getUTCSeconds(),e.internal.getUTCMilliseconds()),hr(e)}function hr(e){const t=_e(e.timeZone,e),r=t>0?Math.floor(t):Math.ceil(t),s=new Date(+e);s.setUTCHours(s.getUTCHours()-1);const o=-new Date(+e).getTimezoneOffset(),a=-new Date(+s).getTimezoneOffset(),l=o-a,i=Date.prototype.getHours.apply(e)!==e.internal.getUTCHours();l&&i&&e.internal.setUTCMinutes(e.internal.getUTCMinutes()+l);const c=o-r;c&&Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+c);const d=new Date(+e);d.setUTCSeconds(0);const f=o>0?d.getSeconds():(d.getSeconds()-60)%60,u=Math.round(-(_e(e.timeZone,e)*60))%60;(u||f)&&(e.internal.setUTCSeconds(e.internal.getUTCSeconds()+u),Date.prototype.setUTCSeconds.call(e,Date.prototype.getUTCSeconds.call(e)+u+f));const h=_e(e.timeZone,e),p=h>0?Math.floor(h):Math.ceil(h),j=-new Date(+e).getTimezoneOffset()-p,S=p!==r,g=j-c;if(S&&g){Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+g);const N=_e(e.timeZone,e),x=N>0?Math.floor(N):Math.ceil(N),D=p-x;D&&(e.internal.setUTCMinutes(e.internal.getUTCMinutes()+D),Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+D))}}class G extends de{static tz(t,...r){return r.length?new G(...r,t):new G(Date.now(),t)}toISOString(){const[t,r,s]=this.tzComponents(),o=`${t}${r}:${s}`;return this.internal.toISOString().slice(0,-1)+o}toString(){return`${this.toDateString()} ${this.toTimeString()}`}toDateString(){const[t,r,s,o]=this.internal.toUTCString().split(" ");return`${t?.slice(0,-1)} ${s} ${r} ${o}`}toTimeString(){const t=this.internal.toUTCString().split(" ")[4],[r,s,o]=this.tzComponents();return`${t} GMT${r}${s}${o} (${jo(this.timeZone,this)})`}toLocaleString(t,r){return Date.prototype.toLocaleString.call(this,t,{...r,timeZone:r?.timeZone||this.timeZone})}toLocaleDateString(t,r){return Date.prototype.toLocaleDateString.call(this,t,{...r,timeZone:r?.timeZone||this.timeZone})}toLocaleTimeString(t,r){return Date.prototype.toLocaleTimeString.call(this,t,{...r,timeZone:r?.timeZone||this.timeZone})}tzComponents(){const t=this.getTimezoneOffset(),r=t>0?"-":"+",s=String(Math.floor(Math.abs(t)/60)).padStart(2,"0"),o=String(Math.abs(t)%60).padStart(2,"0");return[r,s,o]}withTimeZone(t){return new G(+this,t)}[Symbol.for("constructDateFrom")](t){return new G(+new Date(t),this.timeZone)}}const At=5,_o=4;function Do(e,t){const r=t.startOfMonth(e),s=r.getDay()>0?r.getDay():7,o=t.addDays(e,-s+1),a=t.addDays(o,At*7-1);return t.getMonth(e)===t.getMonth(a)?At:_o}function pr(e,t){const r=t.startOfMonth(e),s=r.getDay();return s===1?r:s===0?t.addDays(r,-6):t.addDays(r,-1*(s-1))}function Mo(e,t){const r=pr(e,t),s=Do(e,t);return t.addDays(r,s*7-1)}class se{constructor(t,r){this.Date=Date,this.today=()=>this.overrides?.today?this.overrides.today():this.options.timeZone?G.tz(this.options.timeZone):new this.Date,this.newDate=(s,o,a)=>this.overrides?.newDate?this.overrides.newDate(s,o,a):this.options.timeZone?new G(s,o,a,this.options.timeZone):new Date(s,o,a),this.addDays=(s,o)=>this.overrides?.addDays?this.overrides.addDays(s,o):Xt(s,o),this.addMonths=(s,o)=>this.overrides?.addMonths?this.overrides.addMonths(s,o):Kt(s,o),this.addWeeks=(s,o)=>this.overrides?.addWeeks?this.overrides.addWeeks(s,o):yn(s,o),this.addYears=(s,o)=>this.overrides?.addYears?this.overrides.addYears(s,o):bn(s,o),this.differenceInCalendarDays=(s,o)=>this.overrides?.differenceInCalendarDays?this.overrides.differenceInCalendarDays(s,o):Xs(s,o),this.differenceInCalendarMonths=(s,o)=>this.overrides?.differenceInCalendarMonths?this.overrides.differenceInCalendarMonths(s,o):cn(s,o),this.eachMonthOfInterval=s=>this.overrides?.eachMonthOfInterval?this.overrides.eachMonthOfInterval(s):jn(s),this.eachYearOfInterval=s=>{const o=this.overrides?.eachYearOfInterval?this.overrides.eachYearOfInterval(s):Cn(s),a=new Set(o.map(i=>this.getYear(i)));if(a.size===o.length)return o;const l=[];return a.forEach(i=>{l.push(new Date(i,0,1))}),l},this.endOfBroadcastWeek=s=>this.overrides?.endOfBroadcastWeek?this.overrides.endOfBroadcastWeek(s):Mo(s,this),this.endOfISOWeek=s=>this.overrides?.endOfISOWeek?this.overrides.endOfISOWeek(s):kn(s),this.endOfMonth=s=>this.overrides?.endOfMonth?this.overrides.endOfMonth(s):un(s),this.endOfWeek=(s,o)=>this.overrides?.endOfWeek?this.overrides.endOfWeek(s,o):Qt(s,this.options),this.endOfYear=s=>this.overrides?.endOfYear?this.overrides.endOfYear(s):Sn(s),this.format=(s,o,a)=>{const l=this.overrides?.format?this.overrides.format(s,o,this.options):We(s,o,this.options);return this.options.numerals&&this.options.numerals!=="latn"?this.replaceDigits(l):l},this.getISOWeek=s=>this.overrides?.getISOWeek?this.overrides.getISOWeek(s):Ks(s),this.getMonth=(s,o)=>this.overrides?.getMonth?this.overrides.getMonth(s,this.options):Dn(s,this.options),this.getYear=(s,o)=>this.overrides?.getYear?this.overrides.getYear(s,this.options):Mn(s,this.options),this.getWeek=(s,o)=>this.overrides?.getWeek?this.overrides.getWeek(s,this.options):Js(s,this.options),this.isAfter=(s,o)=>this.overrides?.isAfter?this.overrides.isAfter(s,o):On(s,o),this.isBefore=(s,o)=>this.overrides?.isBefore?this.overrides.isBefore(s,o):En(s,o),this.isDate=s=>this.overrides?.isDate?this.overrides.isDate(s):Qs(s),this.isSameDay=(s,o)=>this.overrides?.isSameDay?this.overrides.isSameDay(s,o):dn(s,o),this.isSameMonth=(s,o)=>this.overrides?.isSameMonth?this.overrides.isSameMonth(s,o):an(s,o),this.isSameYear=(s,o)=>this.overrides?.isSameYear?this.overrides.isSameYear(s,o):Tn(s,o),this.max=s=>this.overrides?.max?this.overrides.max(s):wn(s),this.min=s=>this.overrides?.min?this.overrides.min(s):Nn(s),this.setMonth=(s,o)=>this.overrides?.setMonth?this.overrides.setMonth(s,o):Pn(s,o),this.setYear=(s,o)=>this.overrides?.setYear?this.overrides.setYear(s,o):An(s,o),this.startOfBroadcastWeek=(s,o)=>this.overrides?.startOfBroadcastWeek?this.overrides.startOfBroadcastWeek(s,this):pr(s,this),this.startOfDay=s=>this.overrides?.startOfDay?this.overrides.startOfDay(s):en(s),this.startOfISOWeek=s=>this.overrides?.startOfISOWeek?this.overrides.startOfISOWeek(s):tn(s),this.startOfMonth=s=>this.overrides?.startOfMonth?this.overrides.startOfMonth(s):ln(s),this.startOfWeek=(s,o)=>this.overrides?.startOfWeek?this.overrides.startOfWeek(s,this.options):rn(s,this.options),this.startOfYear=s=>this.overrides?.startOfYear?this.overrides.startOfYear(s):sn(s),this.options={locale:Zt,...t},this.overrides=r}getDigitMap(){const{numerals:t="latn"}=this.options,r=new Intl.NumberFormat("en-US",{numberingSystem:t}),s={};for(let o=0;o<10;o++)s[o.toString()]=r.format(o);return s}replaceDigits(t){const r=this.getDigitMap();return t.replace(/\d/g,s=>r[s]||s)}formatNumber(t){return this.replaceDigits(t.toString())}getMonthYearOrder(){const t=this.options.locale?.code;return t&&se.yearFirstLocales.has(t)?"year-first":"month-first"}formatMonthYear(t){const{locale:r,timeZone:s,numerals:o}=this.options,a=r?.code;if(a&&se.yearFirstLocales.has(a))try{return new Intl.DateTimeFormat(a,{month:"long",year:"numeric",timeZone:s,numberingSystem:o}).format(t)}catch{}const l=this.getMonthYearOrder()==="year-first"?"y LLLL":"LLLL y";return this.format(t,l)}}se.yearFirstLocales=new Set(["eu","hu","ja","ja-Hira","ja-JP","ko","ko-KR","lt","lt-LT","lv","lv-LV","mn","mn-MN","zh","zh-CN","zh-HK","zh-TW"]);const ue=new se;class gr{constructor(t,r,s=ue){this.date=t,this.displayMonth=r,this.outside=!!(r&&!s.isSameMonth(t,r)),this.dateLib=s}isEqualTo(t){return this.dateLib.isSameDay(t.date,this.date)&&this.dateLib.isSameMonth(t.displayMonth,this.displayMonth)}}class Oo{constructor(t,r){this.date=t,this.weeks=r}}class Eo{constructor(t,r){this.days=r,this.weekNumber=t}}function To(e){return b.createElement("button",{...e})}function Po(e){return b.createElement("span",{...e})}function Ao(e){const{size:t=24,orientation:r="left",className:s}=e;return b.createElement("svg",{className:s,width:t,height:t,viewBox:"0 0 24 24"},r==="up"&&b.createElement("polygon",{points:"6.77 17 12.5 11.43 18.24 17 20 15.28 12.5 8 5 15.28"}),r==="down"&&b.createElement("polygon",{points:"6.77 8 12.5 13.57 18.24 8 20 9.72 12.5 17 5 9.72"}),r==="left"&&b.createElement("polygon",{points:"16 18.112 9.81111111 12 16 5.87733333 14.0888889 4 6 12 14.0888889 20"}),r==="right"&&b.createElement("polygon",{points:"8 18.112 14.18888889 12 8 5.87733333 9.91111111 4 18 12 9.91111111 20"}))}function Wo(e){const{day:t,modifiers:r,...s}=e;return b.createElement("td",{...s})}function Io(e){const{day:t,modifiers:r,...s}=e,o=b.useRef(null);return b.useEffect(()=>{r.focused&&o.current?.focus()},[r.focused]),b.createElement("button",{ref:o,...s})}var k;(function(e){e.Root="root",e.Chevron="chevron",e.Day="day",e.DayButton="day_button",e.CaptionLabel="caption_label",e.Dropdowns="dropdowns",e.Dropdown="dropdown",e.DropdownRoot="dropdown_root",e.Footer="footer",e.MonthGrid="month_grid",e.MonthCaption="month_caption",e.MonthsDropdown="months_dropdown",e.Month="month",e.Months="months",e.Nav="nav",e.NextMonthButton="button_next",e.PreviousMonthButton="button_previous",e.Week="week",e.Weeks="weeks",e.Weekday="weekday",e.Weekdays="weekdays",e.WeekNumber="week_number",e.WeekNumberHeader="week_number_header",e.YearsDropdown="years_dropdown"})(k||(k={}));var L;(function(e){e.disabled="disabled",e.hidden="hidden",e.outside="outside",e.focused="focused",e.today="today"})(L||(L={}));var le;(function(e){e.range_end="range_end",e.range_middle="range_middle",e.range_start="range_start",e.selected="selected"})(le||(le={}));var te;(function(e){e.weeks_before_enter="weeks_before_enter",e.weeks_before_exit="weeks_before_exit",e.weeks_after_enter="weeks_after_enter",e.weeks_after_exit="weeks_after_exit",e.caption_after_enter="caption_after_enter",e.caption_after_exit="caption_after_exit",e.caption_before_enter="caption_before_enter",e.caption_before_exit="caption_before_exit"})(te||(te={}));function Ro(e){const{options:t,className:r,components:s,classNames:o,...a}=e,l=[o[k.Dropdown],r].join(" "),i=t?.find(({value:c})=>c===a.value);return b.createElement("span",{"data-disabled":a.disabled,className:o[k.DropdownRoot]},b.createElement(s.Select,{className:l,...a},t?.map(({value:c,label:d,disabled:f})=>b.createElement(s.Option,{key:c,value:c,disabled:f},d))),b.createElement("span",{className:o[k.CaptionLabel],"aria-hidden":!0},i?.label,b.createElement(s.Chevron,{orientation:"down",size:18,className:o[k.Chevron]})))}function Fo(e){return b.createElement("div",{...e})}function Bo(e){return b.createElement("div",{...e})}function Yo(e){const{calendarMonth:t,displayIndex:r,...s}=e;return b.createElement("div",{...s},e.children)}function $o(e){const{calendarMonth:t,displayIndex:r,...s}=e;return b.createElement("div",{...s})}function Lo(e){return b.createElement("table",{...e})}function zo(e){return b.createElement("div",{...e})}const xr=m.createContext(void 0);function Fe(){const e=m.useContext(xr);if(e===void 0)throw new Error("useDayPicker() must be used within a custom component.");return e}function Ho(e){const{components:t}=Fe();return b.createElement(t.Dropdown,{...e})}function Uo(e){const{onPreviousClick:t,onNextClick:r,previousMonth:s,nextMonth:o,...a}=e,{components:l,classNames:i,labels:{labelPrevious:c,labelNext:d}}=Fe(),f=m.useCallback(h=>{o&&r?.(h)},[o,r]),u=m.useCallback(h=>{s&&t?.(h)},[s,t]);return b.createElement("nav",{...a},b.createElement(l.PreviousMonthButton,{type:"button",className:i[k.PreviousMonthButton],tabIndex:s?void 0:-1,"aria-disabled":s?void 0:!0,"aria-label":c(s),onClick:u},b.createElement(l.Chevron,{disabled:s?void 0:!0,className:i[k.Chevron],orientation:"left"})),b.createElement(l.NextMonthButton,{type:"button",className:i[k.NextMonthButton],tabIndex:o?void 0:-1,"aria-disabled":o?void 0:!0,"aria-label":d(o),onClick:f},b.createElement(l.Chevron,{disabled:o?void 0:!0,orientation:"right",className:i[k.Chevron]})))}function qo(e){const{components:t}=Fe();return b.createElement(t.Button,{...e})}function Vo(e){return b.createElement("option",{...e})}function Go(e){const{components:t}=Fe();return b.createElement(t.Button,{...e})}function Zo(e){const{rootRef:t,...r}=e;return b.createElement("div",{...r,ref:t})}function Xo(e){return b.createElement("select",{...e})}function Ko(e){const{week:t,...r}=e;return b.createElement("tr",{...r})}function Jo(e){return b.createElement("th",{...e})}function Qo(e){return b.createElement("thead",{"aria-hidden":!0},b.createElement("tr",{...e}))}function ea(e){const{week:t,...r}=e;return b.createElement("th",{...r})}function ta(e){return b.createElement("th",{...e})}function ra(e){return b.createElement("tbody",{...e})}function sa(e){const{components:t}=Fe();return b.createElement(t.Dropdown,{...e})}const na=Object.freeze(Object.defineProperty({__proto__:null,Button:To,CaptionLabel:Po,Chevron:Ao,Day:Wo,DayButton:Io,Dropdown:Ro,DropdownNav:Fo,Footer:Bo,Month:Yo,MonthCaption:$o,MonthGrid:Lo,Months:zo,MonthsDropdown:Ho,Nav:Uo,NextMonthButton:qo,Option:Vo,PreviousMonthButton:Go,Root:Zo,Select:Xo,Week:Ko,WeekNumber:ea,WeekNumberHeader:ta,Weekday:Jo,Weekdays:Qo,Weeks:ra,YearsDropdown:sa},Symbol.toStringTag,{value:"Module"}));function me(e,t,r=!1,s=ue){let{from:o,to:a}=e;const{differenceInCalendarDays:l,isSameDay:i}=s;return o&&a?(l(a,o)<0&&([o,a]=[a,o]),l(t,o)>=(r?1:0)&&l(a,t)>=(r?1:0)):!r&&a?i(a,t):!r&&o?i(o,t):!1}function vr(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function Nt(e){return!!(e&&typeof e=="object"&&"from"in e)}function yr(e){return!!(e&&typeof e=="object"&&"after"in e)}function br(e){return!!(e&&typeof e=="object"&&"before"in e)}function wr(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function Nr(e,t){return Array.isArray(e)&&e.every(t.isDate)}function he(e,t,r=ue){const s=Array.isArray(t)?t:[t],{isSameDay:o,differenceInCalendarDays:a,isAfter:l}=r;return s.some(i=>{if(typeof i=="boolean")return i;if(r.isDate(i))return o(e,i);if(Nr(i,r))return i.includes(e);if(Nt(i))return me(i,e,!1,r);if(wr(i))return Array.isArray(i.dayOfWeek)?i.dayOfWeek.includes(e.getDay()):i.dayOfWeek===e.getDay();if(vr(i)){const c=a(i.before,e),d=a(i.after,e),f=c>0,u=d<0;return l(i.before,i.after)?u&&f:f||u}return yr(i)?a(e,i.after)>0:br(i)?a(i.before,e)>0:typeof i=="function"?i(e):!1})}function oa(e,t,r,s,o){const{disabled:a,hidden:l,modifiers:i,showOutsideDays:c,broadcastCalendar:d,today:f}=t,{isSameDay:u,isSameMonth:h,startOfMonth:p,isBefore:y,endOfMonth:j,isAfter:S}=o,g=r&&p(r),N=s&&j(s),x={[L.focused]:[],[L.outside]:[],[L.disabled]:[],[L.hidden]:[],[L.today]:[]},D={};for(const v of e){const{date:_,displayMonth:C}=v,T=!!(C&&!h(_,C)),E=!!(g&&y(_,g)),W=!!(N&&S(_,N)),R=!!(a&&he(_,a,o)),V=!!(l&&he(_,l,o))||E||W||!d&&!c&&T||d&&c===!1&&T,J=u(_,f??o.today());T&&x.outside.push(v),R&&x.disabled.push(v),V&&x.hidden.push(v),J&&x.today.push(v),i&&Object.keys(i).forEach(ie=>{const Z=i?.[ie];Z&&he(_,Z,o)&&(D[ie]?D[ie].push(v):D[ie]=[v])})}return v=>{const _={[L.focused]:!1,[L.disabled]:!1,[L.hidden]:!1,[L.outside]:!1,[L.today]:!1},C={};for(const T in x){const E=x[T];_[T]=E.some(W=>W===v)}for(const T in D)C[T]=D[T].some(E=>E===v);return{..._,...C}}}function aa(e,t,r={}){return Object.entries(e).filter(([,o])=>o===!0).reduce((o,[a])=>(r[a]?o.push(r[a]):t[L[a]]?o.push(t[L[a]]):t[le[a]]&&o.push(t[le[a]]),o),[t[k.Day]])}function ia(e){return{...na,...e}}function la(e){const t={"data-mode":e.mode??void 0,"data-required":"required"in e?e.required:void 0,"data-multiple-months":e.numberOfMonths&&e.numberOfMonths>1||void 0,"data-week-numbers":e.showWeekNumber||void 0,"data-broadcast-calendar":e.broadcastCalendar||void 0,"data-nav-layout":e.navLayout||void 0};return Object.entries(e).forEach(([r,s])=>{r.startsWith("data-")&&(t[r]=s)}),t}function ca(){const e={};for(const t in k)e[k[t]]=`rdp-${k[t]}`;for(const t in L)e[L[t]]=`rdp-${L[t]}`;for(const t in le)e[le[t]]=`rdp-${le[t]}`;for(const t in te)e[te[t]]=`rdp-${te[t]}`;return e}function jr(e,t,r){return(r??new se(t)).formatMonthYear(e)}const da=jr;function ua(e,t,r){return(r??new se(t)).format(e,"d")}function fa(e,t=ue){return t.format(e,"LLLL")}function ma(e,t,r){return(r??new se(t)).format(e,"cccccc")}function ha(e,t=ue){return e<10?t.formatNumber(`0${e.toLocaleString()}`):t.formatNumber(`${e.toLocaleString()}`)}function pa(){return""}function Sr(e,t=ue){return t.format(e,"yyyy")}const ga=Sr,xa=Object.freeze(Object.defineProperty({__proto__:null,formatCaption:jr,formatDay:ua,formatMonthCaption:da,formatMonthDropdown:fa,formatWeekNumber:ha,formatWeekNumberHeader:pa,formatWeekdayName:ma,formatYearCaption:ga,formatYearDropdown:Sr},Symbol.toStringTag,{value:"Module"}));function va(e){return e?.formatMonthCaption&&!e.formatCaption&&(e.formatCaption=e.formatMonthCaption),e?.formatYearCaption&&!e.formatYearDropdown&&(e.formatYearDropdown=e.formatYearCaption),{...xa,...e}}function ya(e,t,r,s,o){const{startOfMonth:a,startOfYear:l,endOfYear:i,eachMonthOfInterval:c,getMonth:d}=o;return c({start:l(e),end:i(e)}).map(h=>{const p=s.formatMonthDropdown(h,o),y=d(h),j=t&&h<a(t)||r&&h>a(r)||!1;return{value:y,label:p,disabled:j}})}function ba(e,t={},r={}){let s={...t?.[k.Day]};return Object.entries(e).filter(([,o])=>o===!0).forEach(([o])=>{s={...s,...r?.[o]}}),s}function wa(e,t,r){const s=e.today(),o=t?e.startOfISOWeek(s):e.startOfWeek(s),a=[];for(let l=0;l<7;l++){const i=e.addDays(o,l);a.push(i)}return a}function Na(e,t,r,s,o=!1){if(!e||!t)return;const{startOfYear:a,endOfYear:l,eachYearOfInterval:i,getYear:c}=s,d=a(e),f=l(t),u=i({start:d,end:f});return o&&u.reverse(),u.map(h=>{const p=r.formatYearDropdown(h,s);return{value:c(h),label:p,disabled:!1}})}function Cr(e,t,r,s){let o=(s??new se(r)).format(e,"PPPP");return t.today&&(o=`Today, ${o}`),t.selected&&(o=`${o}, selected`),o}const ja=Cr;function kr(e,t,r){return(r??new se(t)).formatMonthYear(e)}const Sa=kr;function Ca(e,t,r,s){let o=(s??new se(r)).format(e,"PPPP");return t?.today&&(o=`Today, ${o}`),o}function ka(e){return"Choose the Month"}function _a(){return""}function Da(e){return"Go to the Next Month"}function Ma(e){return"Go to the Previous Month"}function Oa(e,t,r){return(r??new se(t)).format(e,"cccc")}function Ea(e,t){return`Week ${e}`}function Ta(e){return"Week Number"}function Pa(e){return"Choose the Year"}const Aa=Object.freeze(Object.defineProperty({__proto__:null,labelCaption:Sa,labelDay:ja,labelDayButton:Cr,labelGrid:kr,labelGridcell:Ca,labelMonthDropdown:ka,labelNav:_a,labelNext:Da,labelPrevious:Ma,labelWeekNumber:Ea,labelWeekNumberHeader:Ta,labelWeekday:Oa,labelYearDropdown:Pa},Symbol.toStringTag,{value:"Module"})),Be=e=>e instanceof HTMLElement?e:null,it=e=>[...e.querySelectorAll("[data-animated-month]")??[]],Wa=e=>Be(e.querySelector("[data-animated-month]")),lt=e=>Be(e.querySelector("[data-animated-caption]")),ct=e=>Be(e.querySelector("[data-animated-weeks]")),Ia=e=>Be(e.querySelector("[data-animated-nav]")),Ra=e=>Be(e.querySelector("[data-animated-weekdays]"));function Fa(e,t,{classNames:r,months:s,focused:o,dateLib:a}){const l=m.useRef(null),i=m.useRef(s),c=m.useRef(!1);m.useLayoutEffect(()=>{const d=i.current;if(i.current=s,!t||!e.current||!(e.current instanceof HTMLElement)||s.length===0||d.length===0||s.length!==d.length)return;const f=a.isSameMonth(s[0].date,d[0].date),u=a.isAfter(s[0].date,d[0].date),h=u?r[te.caption_after_enter]:r[te.caption_before_enter],p=u?r[te.weeks_after_enter]:r[te.weeks_before_enter],y=l.current,j=e.current.cloneNode(!0);if(j instanceof HTMLElement?(it(j).forEach(x=>{if(!(x instanceof HTMLElement))return;const D=Wa(x);D&&x.contains(D)&&x.removeChild(D);const v=lt(x);v&&v.classList.remove(h);const _=ct(x);_&&_.classList.remove(p)}),l.current=j):l.current=null,c.current||f||o)return;const S=y instanceof HTMLElement?it(y):[],g=it(e.current);if(g?.every(N=>N instanceof HTMLElement)&&S&&S.every(N=>N instanceof HTMLElement)){c.current=!0,e.current.style.isolation="isolate";const N=Ia(e.current);N&&(N.style.zIndex="1"),g.forEach((x,D)=>{const v=S[D];if(!v)return;x.style.position="relative",x.style.overflow="hidden";const _=lt(x);_&&_.classList.add(h);const C=ct(x);C&&C.classList.add(p);const T=()=>{c.current=!1,e.current&&(e.current.style.isolation=""),N&&(N.style.zIndex=""),_&&_.classList.remove(h),C&&C.classList.remove(p),x.style.position="",x.style.overflow="",x.contains(v)&&x.removeChild(v)};v.style.pointerEvents="none",v.style.position="absolute",v.style.overflow="hidden",v.setAttribute("aria-hidden","true");const E=Ra(v);E&&(E.style.opacity="0");const W=lt(v);W&&(W.classList.add(u?r[te.caption_before_exit]:r[te.caption_after_exit]),W.addEventListener("animationend",T));const R=ct(v);R&&R.classList.add(u?r[te.weeks_before_exit]:r[te.weeks_after_exit]),x.insertBefore(v,x.firstChild)})}})}function Ba(e,t,r,s){const o=e[0],a=e[e.length-1],{ISOWeek:l,fixedWeeks:i,broadcastCalendar:c}=r??{},{addDays:d,differenceInCalendarDays:f,differenceInCalendarMonths:u,endOfBroadcastWeek:h,endOfISOWeek:p,endOfMonth:y,endOfWeek:j,isAfter:S,startOfBroadcastWeek:g,startOfISOWeek:N,startOfWeek:x}=s,D=c?g(o,s):l?N(o):x(o),v=c?h(a):l?p(y(a)):j(y(a)),_=f(v,D),C=u(a,o)+1,T=[];for(let R=0;R<=_;R++){const V=d(D,R);if(t&&S(V,t))break;T.push(V)}const W=(c?35:42)*C;if(i&&T.length<W){const R=W-T.length;for(let V=0;V<R;V++){const J=d(T[T.length-1],1);T.push(J)}}return T}function Ya(e){const t=[];return e.reduce((r,s)=>{const o=s.weeks.reduce((a,l)=>a.concat(l.days.slice()),t.slice());return r.concat(o.slice())},t.slice())}function $a(e,t,r,s){const{numberOfMonths:o=1}=r,a=[];for(let l=0;l<o;l++){const i=s.addMonths(e,l);if(t&&i>t)break;a.push(i)}return a}function Wt(e,t,r,s){const{month:o,defaultMonth:a,today:l=s.today(),numberOfMonths:i=1}=e;let c=o||a||l;const{differenceInCalendarMonths:d,addMonths:f,startOfMonth:u}=s;if(r&&d(r,c)<i-1){const h=-1*(i-1);c=f(r,h)}return t&&d(c,t)<0&&(c=t),u(c)}function La(e,t,r,s){const{addDays:o,endOfBroadcastWeek:a,endOfISOWeek:l,endOfMonth:i,endOfWeek:c,getISOWeek:d,getWeek:f,startOfBroadcastWeek:u,startOfISOWeek:h,startOfWeek:p}=s,y=e.reduce((j,S)=>{const g=r.broadcastCalendar?u(S,s):r.ISOWeek?h(S):p(S),N=r.broadcastCalendar?a(S):r.ISOWeek?l(i(S)):c(i(S)),x=t.filter(C=>C>=g&&C<=N),D=r.broadcastCalendar?35:42;if(r.fixedWeeks&&x.length<D){const C=t.filter(T=>{const E=D-x.length;return T>N&&T<=o(N,E)});x.push(...C)}const v=x.reduce((C,T)=>{const E=r.ISOWeek?d(T):f(T),W=C.find(V=>V.weekNumber===E),R=new gr(T,S,s);return W?W.days.push(R):C.push(new Eo(E,[R])),C},[]),_=new Oo(S,v);return j.push(_),j},[]);return r.reverseMonths?y.reverse():y}function za(e,t){let{startMonth:r,endMonth:s}=e;const{startOfYear:o,startOfDay:a,startOfMonth:l,endOfMonth:i,addYears:c,endOfYear:d,newDate:f,today:u}=t,{fromYear:h,toYear:p,fromMonth:y,toMonth:j}=e;!r&&y&&(r=y),!r&&h&&(r=t.newDate(h,0,1)),!s&&j&&(s=j),!s&&p&&(s=f(p,11,31));const S=e.captionLayout==="dropdown"||e.captionLayout==="dropdown-years";return r?r=l(r):h?r=f(h,0,1):!r&&S&&(r=o(c(e.today??u(),-100))),s?s=i(s):p?s=f(p,11,31):!s&&S&&(s=d(e.today??u())),[r&&a(r),s&&a(s)]}function Ha(e,t,r,s){if(r.disableNavigation)return;const{pagedNavigation:o,numberOfMonths:a=1}=r,{startOfMonth:l,addMonths:i,differenceInCalendarMonths:c}=s,d=o?a:1,f=l(e);if(!t)return i(f,d);if(!(c(t,e)<a))return i(f,d)}function Ua(e,t,r,s){if(r.disableNavigation)return;const{pagedNavigation:o,numberOfMonths:a}=r,{startOfMonth:l,addMonths:i,differenceInCalendarMonths:c}=s,d=o?a??1:1,f=l(e);if(!t)return i(f,-d);if(!(c(f,t)<=0))return i(f,-d)}function qa(e){const t=[];return e.reduce((r,s)=>r.concat(s.weeks.slice()),t.slice())}function Je(e,t){const[r,s]=m.useState(e);return[t===void 0?r:t,s]}function Va(e,t){const[r,s]=za(e,t),{startOfMonth:o,endOfMonth:a}=t,l=Wt(e,r,s,t),[i,c]=Je(l,e.month?l:void 0);m.useEffect(()=>{const _=Wt(e,r,s,t);c(_)},[e.timeZone]);const d=$a(i,s,e,t),f=Ba(d,e.endMonth?a(e.endMonth):void 0,e,t),u=La(d,f,e,t),h=qa(u),p=Ya(u),y=Ua(i,r,e,t),j=Ha(i,s,e,t),{disableNavigation:S,onMonthChange:g}=e,N=_=>h.some(C=>C.days.some(T=>T.isEqualTo(_))),x=_=>{if(S)return;let C=o(_);r&&C<o(r)&&(C=o(r)),s&&C>o(s)&&(C=o(s)),c(C),g?.(C)};return{months:u,weeks:h,days:p,navStart:r,navEnd:s,previousMonth:y,nextMonth:j,goToMonth:x,goToDay:_=>{N(_)||x(_.date)}}}var ce;(function(e){e[e.Today=0]="Today",e[e.Selected=1]="Selected",e[e.LastFocused=2]="LastFocused",e[e.FocusedModifier=3]="FocusedModifier"})(ce||(ce={}));function It(e){return!e[L.disabled]&&!e[L.hidden]&&!e[L.outside]}function Ga(e,t,r,s){let o,a=-1;for(const l of e){const i=t(l);It(i)&&(i[L.focused]&&a<ce.FocusedModifier?(o=l,a=ce.FocusedModifier):s?.isEqualTo(l)&&a<ce.LastFocused?(o=l,a=ce.LastFocused):r(l.date)&&a<ce.Selected?(o=l,a=ce.Selected):i[L.today]&&a<ce.Today&&(o=l,a=ce.Today))}return o||(o=e.find(l=>It(t(l)))),o}function Za(e,t,r,s,o,a,l){const{ISOWeek:i,broadcastCalendar:c}=a,{addDays:d,addMonths:f,addWeeks:u,addYears:h,endOfBroadcastWeek:p,endOfISOWeek:y,endOfWeek:j,max:S,min:g,startOfBroadcastWeek:N,startOfISOWeek:x,startOfWeek:D}=l;let _={day:d,week:u,month:f,year:h,startOfWeek:C=>c?N(C,l):i?x(C):D(C),endOfWeek:C=>c?p(C):i?y(C):j(C)}[e](r,t==="after"?1:-1);return t==="before"&&s?_=S([s,_]):t==="after"&&o&&(_=g([o,_])),_}function _r(e,t,r,s,o,a,l,i=0){if(i>365)return;const c=Za(e,t,r.date,s,o,a,l),d=!!(a.disabled&&he(c,a.disabled,l)),f=!!(a.hidden&&he(c,a.hidden,l)),u=c,h=new gr(c,u,l);return!d&&!f?h:_r(e,t,h,s,o,a,l,i+1)}function Xa(e,t,r,s,o){const{autoFocus:a}=e,[l,i]=m.useState(),c=Ga(t.days,r,s||(()=>!1),l),[d,f]=m.useState(a?c:void 0);return{isFocusTarget:j=>!!c?.isEqualTo(j),setFocused:f,focused:d,blur:()=>{i(d),f(void 0)},moveFocus:(j,S)=>{if(!d)return;const g=_r(j,S,d,t.navStart,t.navEnd,e,o);g&&(e.disableNavigation&&!t.days.some(x=>x.isEqualTo(g))||(t.goToDay(g),f(g)))}}}function Ka(e,t){const{selected:r,required:s,onSelect:o}=e,[a,l]=Je(r,o?r:void 0),i=o?r:a,{isSameDay:c}=t,d=p=>i?.some(y=>c(y,p))??!1,{min:f,max:u}=e;return{selected:i,select:(p,y,j)=>{let S=[...i??[]];if(d(p)){if(i?.length===f||s&&i?.length===1)return;S=i?.filter(g=>!c(g,p))}else i?.length===u?S=[p]:S=[...S,p];return o||l(S),o?.(S,p,y,j),S},isSelected:d}}function Ja(e,t,r=0,s=0,o=!1,a=ue){const{from:l,to:i}=t||{},{isSameDay:c,isAfter:d,isBefore:f}=a;let u;if(!l&&!i)u={from:e,to:r>0?void 0:e};else if(l&&!i)c(l,e)?r===0?u={from:l,to:e}:o?u={from:l,to:void 0}:u=void 0:f(e,l)?u={from:e,to:l}:u={from:l,to:e};else if(l&&i)if(c(l,e)&&c(i,e))o?u={from:l,to:i}:u=void 0;else if(c(l,e))u={from:l,to:r>0?void 0:e};else if(c(i,e))u={from:e,to:r>0?void 0:e};else if(f(e,l))u={from:e,to:i};else if(d(e,l))u={from:l,to:e};else if(d(e,i))u={from:l,to:e};else throw new Error("Invalid range");if(u?.from&&u?.to){const h=a.differenceInCalendarDays(u.to,u.from);s>0&&h>s?u={from:e,to:void 0}:r>1&&h<r&&(u={from:e,to:void 0})}return u}function Qa(e,t,r=ue){const s=Array.isArray(t)?t:[t];let o=e.from;const a=r.differenceInCalendarDays(e.to,e.from),l=Math.min(a,6);for(let i=0;i<=l;i++){if(s.includes(o.getDay()))return!0;o=r.addDays(o,1)}return!1}function Rt(e,t,r=ue){return me(e,t.from,!1,r)||me(e,t.to,!1,r)||me(t,e.from,!1,r)||me(t,e.to,!1,r)}function ei(e,t,r=ue){const s=Array.isArray(t)?t:[t];if(s.filter(i=>typeof i!="function").some(i=>typeof i=="boolean"?i:r.isDate(i)?me(e,i,!1,r):Nr(i,r)?i.some(c=>me(e,c,!1,r)):Nt(i)?i.from&&i.to?Rt(e,{from:i.from,to:i.to},r):!1:wr(i)?Qa(e,i.dayOfWeek,r):vr(i)?r.isAfter(i.before,i.after)?Rt(e,{from:r.addDays(i.after,1),to:r.addDays(i.before,-1)},r):he(e.from,i,r)||he(e.to,i,r):yr(i)||br(i)?he(e.from,i,r)||he(e.to,i,r):!1))return!0;const l=s.filter(i=>typeof i=="function");if(l.length){let i=e.from;const c=r.differenceInCalendarDays(e.to,e.from);for(let d=0;d<=c;d++){if(l.some(f=>f(i)))return!0;i=r.addDays(i,1)}}return!1}function ti(e,t){const{disabled:r,excludeDisabled:s,selected:o,required:a,onSelect:l}=e,[i,c]=Je(o,l?o:void 0),d=l?o:i;return{selected:d,select:(h,p,y)=>{const{min:j,max:S}=e,g=h?Ja(h,d,j,S,a,t):void 0;return s&&r&&g?.from&&g.to&&ei({from:g.from,to:g.to},r,t)&&(g.from=h,g.to=void 0),l||c(g),l?.(g,h,p,y),g},isSelected:h=>d&&me(d,h,!1,t)}}function ri(e,t){const{selected:r,required:s,onSelect:o}=e,[a,l]=Je(r,o?r:void 0),i=o?r:a,{isSameDay:c}=t;return{selected:i,select:(u,h,p)=>{let y=u;return!s&&i&&i&&c(u,i)&&(y=void 0),o||l(y),o?.(y,u,h,p),y},isSelected:u=>i?c(i,u):!1}}function si(e,t){const r=ri(e,t),s=Ka(e,t),o=ti(e,t);switch(e.mode){case"single":return r;case"multiple":return s;case"range":return o;default:return}}function ni(e){let t=e;t.timeZone&&(t={...e},t.today&&(t.today=new G(t.today,t.timeZone)),t.month&&(t.month=new G(t.month,t.timeZone)),t.defaultMonth&&(t.defaultMonth=new G(t.defaultMonth,t.timeZone)),t.startMonth&&(t.startMonth=new G(t.startMonth,t.timeZone)),t.endMonth&&(t.endMonth=new G(t.endMonth,t.timeZone)),t.mode==="single"&&t.selected?t.selected=new G(t.selected,t.timeZone):t.mode==="multiple"&&t.selected?t.selected=t.selected?.map(P=>new G(P,t.timeZone)):t.mode==="range"&&t.selected&&(t.selected={from:t.selected.from?new G(t.selected.from,t.timeZone):void 0,to:t.selected.to?new G(t.selected.to,t.timeZone):void 0}));const{components:r,formatters:s,labels:o,dateLib:a,locale:l,classNames:i}=m.useMemo(()=>{const P={...Zt,...t.locale};return{dateLib:new se({locale:P,weekStartsOn:t.broadcastCalendar?1:t.weekStartsOn,firstWeekContainsDate:t.firstWeekContainsDate,useAdditionalWeekYearTokens:t.useAdditionalWeekYearTokens,useAdditionalDayOfYearTokens:t.useAdditionalDayOfYearTokens,timeZone:t.timeZone,numerals:t.numerals},t.dateLib),components:ia(t.components),formatters:va(t.formatters),labels:{...Aa,...t.labels},locale:P,classNames:{...ca(),...t.classNames}}},[t.locale,t.broadcastCalendar,t.weekStartsOn,t.firstWeekContainsDate,t.useAdditionalWeekYearTokens,t.useAdditionalDayOfYearTokens,t.timeZone,t.numerals,t.dateLib,t.components,t.formatters,t.labels,t.classNames]),{captionLayout:c,mode:d,navLayout:f,numberOfMonths:u=1,onDayBlur:h,onDayClick:p,onDayFocus:y,onDayKeyDown:j,onDayMouseEnter:S,onDayMouseLeave:g,onNextClick:N,onPrevClick:x,showWeekNumber:D,styles:v}=t,{formatCaption:_,formatDay:C,formatMonthDropdown:T,formatWeekNumber:E,formatWeekNumberHeader:W,formatWeekdayName:R,formatYearDropdown:V}=s,J=Va(t,a),{days:ie,months:Z,navStart:ne,navEnd:be,previousMonth:X,nextMonth:K,goToMonth:Q}=J,we=oa(ie,t,ne,be,a),{isSelected:Ne,select:je,selected:M}=si(t,a)??{},{blur:w,focused:A,isFocusTarget:q,moveFocus:ge,setFocused:Ye}=Xa(t,J,we,Ne??(()=>!1),a),{labelDayButton:zr,labelGridcell:Hr,labelGrid:Ur,labelMonthDropdown:qr,labelNav:_t,labelPrevious:Vr,labelNext:Gr,labelWeekday:Zr,labelWeekNumber:Xr,labelWeekNumberHeader:Kr,labelYearDropdown:Jr}=o,Qr=m.useMemo(()=>wa(a,t.ISOWeek),[a,t.ISOWeek]),Dt=d!==void 0||p!==void 0,tt=m.useCallback(()=>{X&&(Q(X),x?.(X))},[X,Q,x]),rt=m.useCallback(()=>{K&&(Q(K),N?.(K))},[Q,K,N]),es=m.useCallback((P,$)=>O=>{O.preventDefault(),O.stopPropagation(),Ye(P),je?.(P.date,$,O),p?.(P.date,$,O)},[je,p,Ye]),ts=m.useCallback((P,$)=>O=>{Ye(P),y?.(P.date,$,O)},[y,Ye]),rs=m.useCallback((P,$)=>O=>{w(),h?.(P.date,$,O)},[w,h]),ss=m.useCallback((P,$)=>O=>{const B={ArrowLeft:[O.shiftKey?"month":"day",t.dir==="rtl"?"after":"before"],ArrowRight:[O.shiftKey?"month":"day",t.dir==="rtl"?"before":"after"],ArrowDown:[O.shiftKey?"year":"week","after"],ArrowUp:[O.shiftKey?"year":"week","before"],PageUp:[O.shiftKey?"year":"month","before"],PageDown:[O.shiftKey?"year":"month","after"],Home:["startOfWeek","before"],End:["endOfWeek","after"]};if(B[O.key]){O.preventDefault(),O.stopPropagation();const[ee,I]=B[O.key];ge(ee,I)}j?.(P.date,$,O)},[ge,j,t.dir]),ns=m.useCallback((P,$)=>O=>{S?.(P.date,$,O)},[S]),os=m.useCallback((P,$)=>O=>{g?.(P.date,$,O)},[g]),as=m.useCallback(P=>$=>{const O=Number($.target.value),B=a.setMonth(a.startOfMonth(P),O);Q(B)},[a,Q]),is=m.useCallback(P=>$=>{const O=Number($.target.value),B=a.setYear(a.startOfMonth(P),O);Q(B)},[a,Q]),{className:ls,style:cs}=m.useMemo(()=>({className:[i[k.Root],t.className].filter(Boolean).join(" "),style:{...v?.[k.Root],...t.style}}),[i,t.className,t.style,v]),ds=la(t),Mt=m.useRef(null);Fa(Mt,!!t.animate,{classNames:i,months:Z,focused:A,dateLib:a});const us={dayPickerProps:t,selected:M,select:je,isSelected:Ne,months:Z,nextMonth:K,previousMonth:X,goToMonth:Q,getModifiers:we,components:r,classNames:i,styles:v,labels:o,formatters:s};return b.createElement(xr.Provider,{value:us},b.createElement(r.Root,{rootRef:t.animate?Mt:void 0,className:ls,style:cs,dir:t.dir,id:t.id,lang:t.lang,nonce:t.nonce,title:t.title,role:t.role,"aria-label":t["aria-label"],"aria-labelledby":t["aria-labelledby"],...ds},b.createElement(r.Months,{className:i[k.Months],style:v?.[k.Months]},!t.hideNavigation&&!f&&b.createElement(r.Nav,{"data-animated-nav":t.animate?"true":void 0,className:i[k.Nav],style:v?.[k.Nav],"aria-label":_t(),onPreviousClick:tt,onNextClick:rt,previousMonth:X,nextMonth:K}),Z.map((P,$)=>b.createElement(r.Month,{"data-animated-month":t.animate?"true":void 0,className:i[k.Month],style:v?.[k.Month],key:$,displayIndex:$,calendarMonth:P},f==="around"&&!t.hideNavigation&&$===0&&b.createElement(r.PreviousMonthButton,{type:"button",className:i[k.PreviousMonthButton],tabIndex:X?void 0:-1,"aria-disabled":X?void 0:!0,"aria-label":Vr(X),onClick:tt,"data-animated-button":t.animate?"true":void 0},b.createElement(r.Chevron,{disabled:X?void 0:!0,className:i[k.Chevron],orientation:t.dir==="rtl"?"right":"left"})),b.createElement(r.MonthCaption,{"data-animated-caption":t.animate?"true":void 0,className:i[k.MonthCaption],style:v?.[k.MonthCaption],calendarMonth:P,displayIndex:$},c?.startsWith("dropdown")?b.createElement(r.DropdownNav,{className:i[k.Dropdowns],style:v?.[k.Dropdowns]},(()=>{const O=c==="dropdown"||c==="dropdown-months"?b.createElement(r.MonthsDropdown,{key:"month",className:i[k.MonthsDropdown],"aria-label":qr(),classNames:i,components:r,disabled:!!t.disableNavigation,onChange:as(P.date),options:ya(P.date,ne,be,s,a),style:v?.[k.Dropdown],value:a.getMonth(P.date)}):b.createElement("span",{key:"month"},T(P.date,a)),B=c==="dropdown"||c==="dropdown-years"?b.createElement(r.YearsDropdown,{key:"year",className:i[k.YearsDropdown],"aria-label":Jr(a.options),classNames:i,components:r,disabled:!!t.disableNavigation,onChange:is(P.date),options:Na(ne,be,s,a,!!t.reverseYears),style:v?.[k.Dropdown],value:a.getYear(P.date)}):b.createElement("span",{key:"year"},V(P.date,a));return a.getMonthYearOrder()==="year-first"?[B,O]:[O,B]})(),b.createElement("span",{role:"status","aria-live":"polite",style:{border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap",wordWrap:"normal"}},_(P.date,a.options,a))):b.createElement(r.CaptionLabel,{className:i[k.CaptionLabel],role:"status","aria-live":"polite"},_(P.date,a.options,a))),f==="around"&&!t.hideNavigation&&$===u-1&&b.createElement(r.NextMonthButton,{type:"button",className:i[k.NextMonthButton],tabIndex:K?void 0:-1,"aria-disabled":K?void 0:!0,"aria-label":Gr(K),onClick:rt,"data-animated-button":t.animate?"true":void 0},b.createElement(r.Chevron,{disabled:K?void 0:!0,className:i[k.Chevron],orientation:t.dir==="rtl"?"left":"right"})),$===u-1&&f==="after"&&!t.hideNavigation&&b.createElement(r.Nav,{"data-animated-nav":t.animate?"true":void 0,className:i[k.Nav],style:v?.[k.Nav],"aria-label":_t(),onPreviousClick:tt,onNextClick:rt,previousMonth:X,nextMonth:K}),b.createElement(r.MonthGrid,{role:"grid","aria-multiselectable":d==="multiple"||d==="range","aria-label":Ur(P.date,a.options,a)||void 0,className:i[k.MonthGrid],style:v?.[k.MonthGrid]},!t.hideWeekdays&&b.createElement(r.Weekdays,{"data-animated-weekdays":t.animate?"true":void 0,className:i[k.Weekdays],style:v?.[k.Weekdays]},D&&b.createElement(r.WeekNumberHeader,{"aria-label":Kr(a.options),className:i[k.WeekNumberHeader],style:v?.[k.WeekNumberHeader],scope:"col"},W()),Qr.map(O=>b.createElement(r.Weekday,{"aria-label":Zr(O,a.options,a),className:i[k.Weekday],key:String(O),style:v?.[k.Weekday],scope:"col"},R(O,a.options,a)))),b.createElement(r.Weeks,{"data-animated-weeks":t.animate?"true":void 0,className:i[k.Weeks],style:v?.[k.Weeks]},P.weeks.map(O=>b.createElement(r.Week,{className:i[k.Week],key:O.weekNumber,style:v?.[k.Week],week:O},D&&b.createElement(r.WeekNumber,{week:O,style:v?.[k.WeekNumber],"aria-label":Xr(O.weekNumber,{locale:l}),className:i[k.WeekNumber],scope:"row",role:"rowheader"},E(O.weekNumber,a)),O.days.map(B=>{const{date:ee}=B,I=we(B);if(I[L.focused]=!I.hidden&&!!A?.isEqualTo(B),I[le.selected]=Ne?.(ee)||I.selected,Nt(M)){const{from:st,to:nt}=M;I[le.range_start]=!!(st&&nt&&a.isSameDay(ee,st)),I[le.range_end]=!!(st&&nt&&a.isSameDay(ee,nt)),I[le.range_middle]=me(M,ee,!0,a)}const fs=ba(I,v,t.modifiersStyles),ms=aa(I,i,t.modifiersClassNames),hs=!Dt&&!I.hidden?Hr(ee,I,a.options,a):void 0;return b.createElement(r.Day,{key:`${a.format(ee,"yyyy-MM-dd")}_${a.format(B.displayMonth,"yyyy-MM")}`,day:B,modifiers:I,className:ms.join(" "),style:fs,role:"gridcell","aria-selected":I.selected||void 0,"aria-label":hs,"data-day":a.format(ee,"yyyy-MM-dd"),"data-month":B.outside?a.format(ee,"yyyy-MM"):void 0,"data-selected":I.selected||void 0,"data-disabled":I.disabled||void 0,"data-hidden":I.hidden||void 0,"data-outside":B.outside||void 0,"data-focused":I.focused||void 0,"data-today":I.today||void 0},!I.hidden&&Dt?b.createElement(r.DayButton,{className:i[k.DayButton],style:v?.[k.DayButton],type:"button",day:B,modifiers:I,disabled:I.disabled||void 0,tabIndex:q(B)?0:-1,"aria-label":zr(ee,I,a.options,a),onClick:es(B,I),onBlur:rs(B,I),onFocus:ts(B,I),onKeyDown:ss(B,I),onMouseEnter:ns(B,I),onMouseLeave:os(B,I)},C(ee,a.options,a)):!I.hidden&&C(B.date,a.options,a))})))))))),t.footer&&b.createElement(r.Footer,{className:i[k.Footer],style:v?.[k.Footer],role:"status","aria-live":"polite"},t.footer)))}const oi=({mode:e="single",selected:t,onSelect:r,numberOfMonths:s=1,locale:o,initialFocus:a,...l})=>n.jsx(ni,{mode:e,selected:t,onSelect:r,numberOfMonths:s,locale:o,initialFocus:a,...l}),ai=({onApply:e,onClear:t})=>{const[r,s]=m.useState({classes:[],activities:[],statuses:[],gradeRange:[0,10],dateRange:{from:null,to:null},plagiarismThreshold:70,onlyFlagged:!1}),o=()=>{e(r)},a=()=>{s({classes:[],activities:[],statuses:[],gradeRange:[0,10],dateRange:{from:null,to:null},plagiarismThreshold:70,onlyFlagged:!1}),t()};return n.jsxs(U,{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Filtros AvanÃ§ados"}),n.jsxs(Y,{variant:"ghost",size:"sm",onClick:a,children:[n.jsx(yt,{className:"w-4 h-4 mr-2"}),"Limpar Todos"]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(H,{className:"font-semibold",children:"Status da CorreÃ§Ã£o"}),n.jsx("div",{className:"space-y-2",children:["submitted","graded","needs_revision"].map(l=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(ft,{id:`status-${l}`,checked:r.statuses.includes(l),onCheckedChange:i=>{s(c=>({...c,statuses:i?[...c.statuses,l]:c.statuses.filter(d=>d!==l)}))}}),n.jsx(H,{htmlFor:`status-${l}`,className:"cursor-pointer text-sm",children:l==="submitted"?"NÃ£o Corrigidas":l==="graded"?"Corrigidas":"Necessitam RevisÃ£o"})]},l))})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx(H,{className:"font-semibold",children:"Faixa de Nota (apenas corrigidas)"}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ut,{value:r.gradeRange,onValueChange:l=>s(i=>({...i,gradeRange:l})),min:0,max:10,step:.5,className:"w-full"}),n.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[n.jsx("span",{children:r.gradeRange[0]}),n.jsx("span",{children:r.gradeRange[1]})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(H,{className:"font-semibold",children:"Data de SubmissÃ£o"}),n.jsxs(fr,{children:[n.jsx(mr,{asChild:!0,children:n.jsxs(Y,{variant:"outline",className:Me("w-full justify-start text-left font-normal",!r.dateRange.from&&"text-muted-foreground"),children:[n.jsx(Gt,{className:"mr-2 h-4 w-4"}),r.dateRange.from?r.dateRange.to?n.jsxs(n.Fragment,{children:[We(r.dateRange.from,"dd/MM/yyyy",{locale:Pe})," -"," ",We(r.dateRange.to,"dd/MM/yyyy",{locale:Pe})]}):We(r.dateRange.from,"dd/MM/yyyy",{locale:Pe}):n.jsx("span",{children:"Selecione perÃ­odo"})]})}),n.jsx(wt,{className:"w-auto p-0",align:"start",children:n.jsx(oi,{initialFocus:!0,mode:"range",selected:r.dateRange,onSelect:l=>s(i=>({...i,dateRange:l||{from:null,to:null}})),numberOfMonths:2,locale:Pe})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx(H,{className:"font-semibold",children:"Originalidade MÃ­nima (%)"}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ut,{value:[r.plagiarismThreshold],onValueChange:([l])=>s(i=>({...i,plagiarismThreshold:l})),min:0,max:100,step:5,className:"w-full"}),n.jsxs("div",{className:"text-sm text-center text-gray-600",children:["Mostrar apenas com originalidade < ",r.plagiarismThreshold,"%"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(H,{className:"font-semibold",children:"Outros Filtros"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(ft,{id:"flagged",checked:r.onlyFlagged,onCheckedChange:l=>s(i=>({...i,onlyFlagged:l}))}),n.jsx(H,{htmlFor:"flagged",className:"cursor-pointer text-sm",children:"Apenas marcadas para revisÃ£o"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[n.jsx(Y,{variant:"outline",onClick:a,children:"Limpar"}),n.jsx(Y,{onClick:o,className:"bg-blue-600 hover:bg-blue-700",children:"Aplicar Filtros"})]})]})};function ii(e,t){return m.useReducer((r,s)=>t[r][s]??r,e)}var jt="ScrollArea",[Dr]=Ut(jt),[li,ae]=Dr(jt),Mr=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:s="hover",dir:o,scrollHideDelay:a=600,...l}=e,[i,c]=m.useState(null),[d,f]=m.useState(null),[u,h]=m.useState(null),[p,y]=m.useState(null),[j,S]=m.useState(null),[g,N]=m.useState(0),[x,D]=m.useState(0),[v,_]=m.useState(!1),[C,T]=m.useState(!1),E=ve(t,R=>c(R)),W=Ys(o);return n.jsx(li,{scope:r,type:s,dir:W,scrollHideDelay:a,scrollArea:i,viewport:d,onViewportChange:f,content:u,onContentChange:h,scrollbarX:p,onScrollbarXChange:y,scrollbarXEnabled:v,onScrollbarXEnabledChange:_,scrollbarY:j,onScrollbarYChange:S,scrollbarYEnabled:C,onScrollbarYEnabledChange:T,onCornerWidthChange:N,onCornerHeightChange:D,children:n.jsx(De.div,{dir:W,...l,ref:E,style:{position:"relative","--radix-scroll-area-corner-width":g+"px","--radix-scroll-area-corner-height":x+"px",...e.style}})})});Mr.displayName=jt;var Or="ScrollAreaViewport",Er=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:s,nonce:o,...a}=e,l=ae(Or,r),i=m.useRef(null),c=ve(t,i,l.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),n.jsx(De.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:n.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});Er.displayName=Or;var fe="ScrollAreaScrollbar",St=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,o=ae(fe,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:l}=o,i=e.orientation==="horizontal";return m.useEffect(()=>(i?a(!0):l(!0),()=>{i?a(!1):l(!1)}),[i,a,l]),o.type==="hover"?n.jsx(ci,{...s,ref:t,forceMount:r}):o.type==="scroll"?n.jsx(di,{...s,ref:t,forceMount:r}):o.type==="auto"?n.jsx(Tr,{...s,ref:t,forceMount:r}):o.type==="always"?n.jsx(Ct,{...s,ref:t}):null});St.displayName=fe;var ci=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,o=ae(fe,e.__scopeScrollArea),[a,l]=m.useState(!1);return m.useEffect(()=>{const i=o.scrollArea;let c=0;if(i){const d=()=>{window.clearTimeout(c),l(!0)},f=()=>{c=window.setTimeout(()=>l(!1),o.scrollHideDelay)};return i.addEventListener("pointerenter",d),i.addEventListener("pointerleave",f),()=>{window.clearTimeout(c),i.removeEventListener("pointerenter",d),i.removeEventListener("pointerleave",f)}}},[o.scrollArea,o.scrollHideDelay]),n.jsx(Te,{present:r||a,children:n.jsx(Tr,{"data-state":a?"visible":"hidden",...s,ref:t})})}),di=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,o=ae(fe,e.__scopeScrollArea),a=e.orientation==="horizontal",l=et(()=>c("SCROLL_END"),100),[i,c]=ii("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return m.useEffect(()=>{if(i==="idle"){const d=window.setTimeout(()=>c("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(d)}},[i,o.scrollHideDelay,c]),m.useEffect(()=>{const d=o.viewport,f=a?"scrollLeft":"scrollTop";if(d){let u=d[f];const h=()=>{const p=d[f];u!==p&&(c("SCROLL"),l()),u=p};return d.addEventListener("scroll",h),()=>d.removeEventListener("scroll",h)}},[o.viewport,a,c,l]),n.jsx(Te,{present:r||i!=="hidden",children:n.jsx(Ct,{"data-state":i==="hidden"?"hidden":"visible",...s,ref:t,onPointerEnter:oe(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:oe(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Tr=m.forwardRef((e,t)=>{const r=ae(fe,e.__scopeScrollArea),{forceMount:s,...o}=e,[a,l]=m.useState(!1),i=e.orientation==="horizontal",c=et(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,f=r.viewport.offsetHeight<r.viewport.scrollHeight;l(i?d:f)}},10);return Ee(r.viewport,c),Ee(r.content,c),n.jsx(Te,{present:s||a,children:n.jsx(Ct,{"data-state":a?"visible":"hidden",...o,ref:t})})}),Ct=m.forwardRef((e,t)=>{const{orientation:r="vertical",...s}=e,o=ae(fe,e.__scopeScrollArea),a=m.useRef(null),l=m.useRef(0),[i,c]=m.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=Rr(i.viewport,i.content),f={...s,sizes:i,onSizesChange:c,hasThumb:d>0&&d<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:h=>l.current=h};function u(h,p){return gi(h,l.current,i,p)}return r==="horizontal"?n.jsx(ui,{...f,ref:t,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollLeft,p=Ft(h,i,o.dir);a.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollLeft=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollLeft=u(h,o.dir))}}):r==="vertical"?n.jsx(fi,{...f,ref:t,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollTop,p=Ft(h,i);a.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollTop=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollTop=u(h))}}):null}),ui=m.forwardRef((e,t)=>{const{sizes:r,onSizesChange:s,...o}=e,a=ae(fe,e.__scopeScrollArea),[l,i]=m.useState(),c=m.useRef(null),d=ve(t,c,a.onScrollbarXChange);return m.useEffect(()=>{c.current&&i(getComputedStyle(c.current))},[c]),n.jsx(Ar,{"data-orientation":"horizontal",...o,ref:d,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Qe(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.x),onDragScroll:f=>e.onDragScroll(f.x),onWheelScroll:(f,u)=>{if(a.viewport){const h=a.viewport.scrollLeft+f.deltaX;e.onWheelScroll(h),Br(h,u)&&f.preventDefault()}},onResize:()=>{c.current&&a.viewport&&l&&s({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:Ze(l.paddingLeft),paddingEnd:Ze(l.paddingRight)}})}})}),fi=m.forwardRef((e,t)=>{const{sizes:r,onSizesChange:s,...o}=e,a=ae(fe,e.__scopeScrollArea),[l,i]=m.useState(),c=m.useRef(null),d=ve(t,c,a.onScrollbarYChange);return m.useEffect(()=>{c.current&&i(getComputedStyle(c.current))},[c]),n.jsx(Ar,{"data-orientation":"vertical",...o,ref:d,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Qe(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.y),onDragScroll:f=>e.onDragScroll(f.y),onWheelScroll:(f,u)=>{if(a.viewport){const h=a.viewport.scrollTop+f.deltaY;e.onWheelScroll(h),Br(h,u)&&f.preventDefault()}},onResize:()=>{c.current&&a.viewport&&l&&s({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:Ze(l.paddingTop),paddingEnd:Ze(l.paddingBottom)}})}})}),[mi,Pr]=Dr(fe),Ar=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:s,hasThumb:o,onThumbChange:a,onThumbPointerUp:l,onThumbPointerDown:i,onThumbPositionChange:c,onDragScroll:d,onWheelScroll:f,onResize:u,...h}=e,p=ae(fe,r),[y,j]=m.useState(null),S=ve(t,E=>j(E)),g=m.useRef(null),N=m.useRef(""),x=p.viewport,D=s.content-s.viewport,v=Se(f),_=Se(c),C=et(u,10);function T(E){if(g.current){const W=E.clientX-g.current.left,R=E.clientY-g.current.top;d({x:W,y:R})}}return m.useEffect(()=>{const E=W=>{const R=W.target;y?.contains(R)&&v(W,D)};return document.addEventListener("wheel",E,{passive:!1}),()=>document.removeEventListener("wheel",E,{passive:!1})},[x,y,D,v]),m.useEffect(_,[s,_]),Ee(y,C),Ee(p.content,C),n.jsx(mi,{scope:r,scrollbar:y,hasThumb:o,onThumbChange:Se(a),onThumbPointerUp:Se(l),onThumbPositionChange:_,onThumbPointerDown:Se(i),children:n.jsx(De.div,{...h,ref:S,style:{position:"absolute",...h.style},onPointerDown:oe(e.onPointerDown,E=>{E.button===0&&(E.target.setPointerCapture(E.pointerId),g.current=y.getBoundingClientRect(),N.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),T(E))}),onPointerMove:oe(e.onPointerMove,T),onPointerUp:oe(e.onPointerUp,E=>{const W=E.target;W.hasPointerCapture(E.pointerId)&&W.releasePointerCapture(E.pointerId),document.body.style.webkitUserSelect=N.current,p.viewport&&(p.viewport.style.scrollBehavior=""),g.current=null})})})}),Ge="ScrollAreaThumb",Wr=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,o=Pr(Ge,e.__scopeScrollArea);return n.jsx(Te,{present:r||o.hasThumb,children:n.jsx(hi,{ref:t,...s})})}),hi=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:s,...o}=e,a=ae(Ge,r),l=Pr(Ge,r),{onThumbPositionChange:i}=l,c=ve(t,u=>l.onThumbChange(u)),d=m.useRef(void 0),f=et(()=>{d.current&&(d.current(),d.current=void 0)},100);return m.useEffect(()=>{const u=a.viewport;if(u){const h=()=>{if(f(),!d.current){const p=xi(u,i);d.current=p,i()}};return i(),u.addEventListener("scroll",h),()=>u.removeEventListener("scroll",h)}},[a.viewport,f,i]),n.jsx(De.div,{"data-state":l.hasThumb?"visible":"hidden",...o,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:oe(e.onPointerDownCapture,u=>{const p=u.target.getBoundingClientRect(),y=u.clientX-p.left,j=u.clientY-p.top;l.onThumbPointerDown({x:y,y:j})}),onPointerUp:oe(e.onPointerUp,l.onThumbPointerUp)})});Wr.displayName=Ge;var kt="ScrollAreaCorner",Ir=m.forwardRef((e,t)=>{const r=ae(kt,e.__scopeScrollArea),s=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&s?n.jsx(pi,{...e,ref:t}):null});Ir.displayName=kt;var pi=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,...s}=e,o=ae(kt,r),[a,l]=m.useState(0),[i,c]=m.useState(0),d=!!(a&&i);return Ee(o.scrollbarX,()=>{const f=o.scrollbarX?.offsetHeight||0;o.onCornerHeightChange(f),c(f)}),Ee(o.scrollbarY,()=>{const f=o.scrollbarY?.offsetWidth||0;o.onCornerWidthChange(f),l(f)}),d?n.jsx(De.div,{...s,ref:t,style:{width:a,height:i,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Ze(e){return e?parseInt(e,10):0}function Rr(e,t){const r=e/t;return isNaN(r)?0:r}function Qe(e){const t=Rr(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-r)*t;return Math.max(s,18)}function gi(e,t,r,s="ltr"){const o=Qe(r),a=o/2,l=t||a,i=o-l,c=r.scrollbar.paddingStart+l,d=r.scrollbar.size-r.scrollbar.paddingEnd-i,f=r.content-r.viewport,u=s==="ltr"?[0,f]:[f*-1,0];return Fr([c,d],u)(e)}function Ft(e,t,r="ltr"){const s=Qe(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-o,l=t.content-t.viewport,i=a-s,c=r==="ltr"?[0,l]:[l*-1,0],d=ys(e,c);return Fr([0,l],[0,i])(d)}function Fr(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(e[1]-e[0]);return t[0]+s*(r-e[0])}}function Br(e,t){return e>0&&e<t}var xi=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},s=0;return(function o(){const a={left:e.scrollLeft,top:e.scrollTop},l=r.left!==a.left,i=r.top!==a.top;(l||i)&&t(),r=a,s=window.requestAnimationFrame(o)})(),()=>window.cancelAnimationFrame(s)};function et(e,t){const r=Se(e),s=m.useRef(0);return m.useEffect(()=>()=>window.clearTimeout(s.current),[]),m.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(r,t)},[r,t])}function Ee(e,t){const r=Se(t);As(()=>{let s=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(r)});return o.observe(e),()=>{window.cancelAnimationFrame(s),o.unobserve(e)}}},[e,r])}var Yr=Mr,vi=Er,yi=Ir;const $r=m.forwardRef(({className:e,children:t,...r},s)=>n.jsxs(Yr,{ref:s,className:ht("relative overflow-hidden",e),...r,children:[n.jsx(vi,{className:"h-full w-full rounded-[inherit]",children:t}),n.jsx(Lr,{}),n.jsx(yi,{})]}));$r.displayName=Yr.displayName;const Lr=m.forwardRef(({className:e,orientation:t="vertical",...r},s)=>n.jsx(St,{ref:s,orientation:t,className:ht("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 border-t border-t-transparent p-[1px]",e),...r,children:n.jsx(Wr,{className:"relative flex-1 rounded-full bg-border"})}));Lr.displayName=St.displayName;const bi=({submissionIds:e,onClose:t})=>{const[r,s]=m.useState([]),[o,a]=m.useState(!0),[l,i]=m.useState(null);m.useEffect(()=>{c()},[e]);const c=async()=>{a(!0);try{const u=e.map(y=>Yn(y)),p=(await Promise.all(u)).map(y=>y.data).filter(Boolean);if(s(p),p.length===2){const y=d(p[0].content,p[1].content);i(y)}}catch(u){F.error("Erro ao carregar submissÃµes:",u)}finally{a(!1)}},d=(u,h)=>{const p=typeof u=="string"?u:u?.text||"",y=typeof h=="string"?h:h?.text||"",j=p.toLowerCase().split(/\s+/),S=y.toLowerCase().split(/\s+/),N=j.filter(x=>S.includes(x)).length/Math.max(j.length,S.length)*100;return Math.round(N)},f=u=>u>=80?"text-red-600 bg-red-100":u>=60?"text-yellow-600 bg-yellow-100":"text-green-600 bg-green-100";return o?n.jsx(Ue,{open:!0,onOpenChange:t,children:n.jsx(qe,{className:"max-w-6xl h-[80vh]",children:n.jsx("div",{className:"flex items-center justify-center h-full",children:n.jsx("p",{children:"Carregando comparaÃ§Ã£o..."})})})}):n.jsx(Ue,{open:!0,onOpenChange:t,children:n.jsxs(qe,{className:"max-w-7xl h-[90vh]",children:[n.jsx(Lt,{children:n.jsxs(zt,{className:"flex items-center gap-2",children:[n.jsx(fn,{className:"w-5 h-5"}),"ComparaÃ§Ã£o de SubmissÃµes"]})}),l!==null&&n.jsxs(U,{className:`p-4 ${f(l)}`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(mn,{className:"w-5 h-5"}),n.jsx("span",{className:"font-semibold",children:"Similaridade Detectada:"})]}),n.jsxs("div",{className:"text-2xl font-bold",children:[l,"%"]})]}),l>=60&&n.jsx("p",{className:"text-sm mt-2",children:"Alta similaridade detectada entre as submissÃµes. Recomenda-se revisÃ£o manual detalhada."})]}),n.jsx("div",{className:"grid grid-cols-2 gap-4 flex-1 overflow-hidden",children:r.map((u,h)=>n.jsxs(U,{className:"p-4 flex flex-col",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("h3",{className:"font-semibold text-lg",children:u.student?.full_name}),n.jsx("p",{className:"text-sm text-gray-600",children:u.activity?.title}),n.jsxs("div",{className:"flex gap-2 mt-2",children:[u.grade!==null&&n.jsxs(xe,{children:["Nota: ",u.grade]}),n.jsx(xe,{variant:"outline",children:u.status==="graded"?"Corrigida":"Pendente"})]})]}),n.jsx($r,{className:"flex-1",children:n.jsxs("div",{className:"pr-4",children:[n.jsx("h4",{className:"font-semibold mb-2",children:"SubmissÃ£o:"}),n.jsx("div",{className:"bg-gray-50 p-3 rounded whitespace-pre-wrap text-sm",children:typeof u.content=="string"?u.content:u.content?.text||"Sem conteÃºdo"}),u.feedback&&n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-semibold mt-4 mb-2",children:"Feedback:"}),n.jsx("div",{className:"bg-blue-50 p-3 rounded text-sm",children:u.feedback})]})]})})]},u.id))}),n.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:["Comparando ",r.length," submissÃµes"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Y,{variant:"outline",onClick:t,children:"Fechar"}),n.jsx(Y,{variant:"destructive",disabled:l<60,onClick:()=>{alert("Funcionalidade de marcar plÃ¡gio serÃ¡ implementada")},children:"Marcar como Suspeita"})]})]})]})})},_l=()=>{const{user:e}=pt(),{toast:t}=gt(),[r]=ps(),[s,o]=m.useState(!0),[a,l]=m.useState([]),[i,c]=m.useState([]),[d,f]=m.useState(null),[u,h]=m.useState(0),[p,y]=m.useState(!1),[j,S]=m.useState([]),[g,N]=m.useState(!1),[x,D]=m.useState(!1),[v,_]=m.useState("pending"),[C,T]=m.useState(""),[E,W]=m.useState("oldest"),[R,V]=m.useState(!1),[J,ie]=m.useState({totalPending:0,correctedToday:0,avgGrade:0,avgTime:0});m.useEffect(()=>{Z(),ne()},[e]),m.useEffect(()=>{be()},[a,v,C,E]);const Z=async()=>{if(e)try{o(!0);const M={classId:r.get("classId"),activityId:r.get("activityId"),sortBy:E},{data:w,error:A}=await Bn(M);if(A)throw A;l(w||[]);const q=w?.filter(ge=>ge.status==="submitted").length||0;ie(ge=>({...ge,totalPending:q}))}catch(M){F.error("Erro ao carregar submissÃµes:",M),t({title:"Erro",description:"NÃ£o foi possÃ­vel carregar as submissÃµes.",variant:"destructive"})}finally{o(!1)}},ne=async()=>{if(e)try{const{data:M}=await Hn(e.id,"day");M&&ie(w=>({...w,correctedToday:M.corrections_count||0,avgGrade:M.avg_grade?.toFixed(1)||0,avgTime:Math.round(M.avg_time_per_correction/60)||0}))}catch(M){F.error("Erro ao carregar mÃ©tricas:",M)}},be=()=>{let M=[...a];if(v==="pending"?M=M.filter(w=>w.status==="submitted"):v==="graded"?M=M.filter(w=>w.status==="graded"):v==="flagged"&&(M=M.filter(w=>w.flagged_for_review)),C){const w=C.toLowerCase();M=M.filter(A=>A.student?.full_name?.toLowerCase().includes(w)||A.activity?.title?.toLowerCase().includes(w))}c(M)},X=(M,w=0)=>{f(M),h(w),y(!0)},K=M=>{const w=M==="next"?u+1:u-1;w>=0&&w<i.length&&(h(w),f(i[w]))},Q=()=>{if(j.length===0){t({title:"Erro",description:"Selecione pelo menos uma submissÃ£o",variant:"destructive"});return}N(!0)},we=()=>{if(j.length!==2){t({title:"Erro",description:"Selecione exatamente 2 submissÃµes para comparar",variant:"destructive"});return}D(!0)},Ne=()=>{y(!1),f(null),Z(),ne(),t({title:"Sucesso",description:"CorreÃ§Ã£o salva com sucesso!"})},je=()=>{t({title:"Em breve",description:"FunÃ§Ã£o de exportaÃ§Ã£o serÃ¡ implementada em breve."})};return s?n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx(gs,{size:"lg",text:"Carregando correÃ§Ãµes..."})}):n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[n.jsx(ks,{title:"CorreÃ§Ãµes Pendentes",subtitle:`${J.totalPending} submissÃµes aguardando correÃ§Ã£o`,role:"teacher"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[n.jsx(ze,{title:"Pendentes",value:J.totalPending,icon:hn,gradient:ot.warning,bgColor:"bg-yellow-50 dark:bg-yellow-950/30"}),n.jsx(ze,{title:"Corrigidas Hoje",value:J.correctedToday,icon:pn,gradient:ot.success,bgColor:"bg-green-50 dark:bg-green-950/30"}),n.jsx(ze,{title:"MÃ©dia de Notas",value:J.avgGrade,icon:gn,gradient:ot.info,bgColor:"bg-blue-50 dark:bg-blue-950/30"}),n.jsx(ze,{title:"Tempo MÃ©dio",value:`${J.avgTime}min`,icon:Ve,gradient:"from-purple-500 to-pink-500",bgColor:"bg-purple-50 dark:bg-purple-950/30"})]}),n.jsx(U,{className:"p-6 mb-6",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsx(Ss,{value:v,onValueChange:_,className:"flex-1",children:n.jsxs(Cs,{children:[n.jsx(Le,{value:"all",children:"Todas"}),n.jsx(Le,{value:"pending",children:"Pendentes"}),n.jsx(Le,{value:"graded",children:"Corrigidas"}),n.jsx(Le,{value:"flagged",children:"Marcadas"})]})}),n.jsx(Xe,{placeholder:"Buscar por aluno ou atividade...",value:C,onChange:M=>T(M.target.value),className:"md:w-64"})]}),n.jsxs("div",{className:"flex flex-wrap gap-3",children:[n.jsxs(bs,{value:E,onValueChange:W,children:[n.jsx(ws,{className:"w-48",children:n.jsx(Ns,{})}),n.jsxs(js,{children:[n.jsx($e,{value:"oldest",children:"Mais Antigas Primeiro"}),n.jsx($e,{value:"newest",children:"Mais Recentes Primeiro"}),n.jsx($e,{value:"student",children:"Por Aluno (A-Z)"}),n.jsx($e,{value:"grade",children:"Por Nota"})]})]}),n.jsxs(Y,{variant:"outline",onClick:()=>V(!R),children:[n.jsx(xn,{className:"w-4 h-4 mr-2"}),"Filtros AvanÃ§ados"]}),n.jsxs(Y,{variant:"outline",onClick:je,children:[n.jsx(vn,{className:"w-4 h-4 mr-2"}),"Exportar"]}),j.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs(Y,{variant:"outline",onClick:Q,children:["CorreÃ§Ã£o em Lote (",j.length,")"]}),j.length===2&&n.jsx(Y,{variant:"outline",onClick:we,children:"Comparar SubmissÃµes"})]})]})]})}),R&&n.jsx("div",{className:"mb-6",children:n.jsx(ai,{onApply:M=>{F.debug("Aplicar filtros avanÃ§ados:",M),t({title:"Filtros aplicados"})},onClear:()=>{V(!1)}})}),i.length>0?n.jsx("div",{className:"space-y-3",children:i.map((M,w)=>n.jsx(vs.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:w*.05},children:n.jsx(wo,{submission:M,onCorrect:()=>X(M,w),isSelected:j.includes(M.id),onSelect:A=>{S(q=>A?[...q,M.id]:q.filter(ge=>ge!==M.id))}})},M.id))}):n.jsx(_s,{icon:vt,title:"Nenhuma submissÃ£o encontrada",description:"NÃ£o hÃ¡ submissÃµes pendentes de correÃ§Ã£o no momento."}),p&&d&&n.jsx(bo,{submission:d,submissions:i,currentIndex:u,onClose:()=>{y(!1),f(null)},onSaved:Ne,onNavigate:K}),g&&n.jsx(No,{submissions:a.filter(M=>j.includes(M.id)),onClose:()=>N(!1),onCompleted:()=>{N(!1),S([]),Z(),ne()}}),x&&n.jsx(bi,{submissionIds:j,onClose:()=>D(!1)})]})};export{_l as default};
