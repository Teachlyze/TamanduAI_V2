import{c as Ke,j as e,r as v,l as E,s as T,u as He,h as Xe,b as Je,q as Ze}from"./main-DuZ82yZp.js";import{B as C}from"./button-Bb_PT1Zw.js";import{C as F}from"./card-Y5GuAOBh.js";import{I as P}from"./input-CNTeUzfK.js";import{L as g}from"./label-CSZx0yin.js";import{T as te}from"./textarea-DkB270aq.js";import{B as $}from"./badge-CYDBAKPn.js";import{T as qe,a as ea,b as ue}from"./tabs-BA3_pwd4.js";import{D as aa,a as sa,b as ta,c as ra,d as ia,e as la}from"./dialog-COr0e4MO.js";import{S as le,a as ne,b as oe,c as ce,d as U}from"./select-rgGo9LRH.js";import{u as na}from"./use-toast--Kt9lPdf.js";import{c as Z}from"./utils-_Gnp3AN4.js";import{F as Me}from"./file-text-Ds7d3BVP.js";import{S as me}from"./square-check-big-BPQfHfJW.js";import{G as Ie}from"./grid-3x3-DVSy5Oj-.js";import{m as de}from"./proxy-CHWBjvZ-.js";import{C as be}from"./chevron-right-CEvqiGs0.js";import"./checkbox-gCidZiUP.js";import{P as B}from"./plus-wGXSZqqe.js";import{T as he}from"./trash-2-BFdlYEpP.js";import"./radio-group-6DmsgViJ.js";import{S as W}from"./switch-BBskMvRS.js";import{S as oa}from"./slider-vhlrmm3n.js";import{A as ca}from"./ActivityPreview-CXGtH8z2.js";import{C as ye}from"./circle-check-DLG0x1EF.js";import{C as Ne}from"./circle-x-D9gCMg34.js";import{C as we}from"./circle-alert-Cj7Ec-TF.js";import{A as da}from"./arrow-left-DsSoZ4ff.js";import{E as ma}from"./eye-_NQjWQ1g.js";import{S as ha}from"./save-RZiqvH4S.js";import{B as xa}from"./book-open-eUF-sl3F.js";import{S as pa}from"./settings-CD03lnZ4.js";import"./index-D_uLVLL-.js";import"./index-DyWjD93x.js";import"./index-CKfYXJSH.js";import"./index-BxUCIcQa.js";import"./index-BDaM9qEV.js";import"./SidebarPremium-DYZaD6CT.js";import"./house-CFiJxlWl.js";import"./users-BE0uReGI.js";import"./graduation-cap-CgmDIIy4.js";import"./calendar-D_hx0NAw.js";import"./chart-column-sFA7nJXK.js";import"./message-circle-EiX5rzcs.js";import"./brain-DGA-WCwF.js";import"./index-Uqsq8EqP.js";import"./x-BmzKUBis.js";import"./Combination-C8JUOhgz.js";import"./index-DNOfYIhm.js";import"./chevron-down-ByeRBLi0.js";import"./check-RJxRYmjs.js";import"./chevron-up-EWxS_QCp.js";import"./clock-BK9prlxy.js";import"./trending-up-B4Wk1Elj.js";const ua=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Fe=Ke("grip-vertical",ua),ga=({selectedType:a,onSelectType:t})=>{const m=[{id:"open",name:"Atividade Aberta",subtitle:"Dissertativa",icon:Me,color:"from-green-500 to-emerald-600",description:"Quest√µes dissertativas com respostas textuais",features:["Respostas escritas pelos alunos","Corre√ß√£o manual com rubricas","An√°lise de antipl√°gio dispon√≠vel"],idealFor:"An√°lises, reda√ß√µes, explica√ß√µes detalhadas"},{id:"closed",name:"Atividade Fechada",subtitle:"Objetiva",icon:me,color:"from-blue-500 to-cyan-600",description:"Quest√µes de m√∫ltipla escolha",features:["Alternativas pr√©-definidas","Corre√ß√£o autom√°tica instant√¢nea","Feedback imediato para alunos"],idealFor:"Testes, quizzes, avalia√ß√µes r√°pidas"},{id:"mixed",name:"Atividade Mista",subtitle:"H√≠brida",icon:Ie,color:"from-purple-500 to-pink-600",description:"Combina quest√µes abertas e fechadas",features:["Flexibilidade m√°xima","Parte autom√°tica + parte manual","Avalia√ß√£o completa e vers√°til"],idealFor:"Provas completas, avalia√ß√µes abrangentes"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Escolha o Tipo de Atividade"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Selecione o formato que melhor se adequa √† sua avalia√ß√£o. Voc√™ n√£o poder√° mudar ap√≥s salvar."})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:m.map((n,s)=>{const u=n.icon,b=a===n.id;return e.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},children:e.jsx(F,{className:Z("p-6 cursor-pointer transition-all duration-200 hover:shadow-xl",b&&"ring-2 ring-blue-500 shadow-xl"),onClick:()=>t(n.id),children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:Z("p-4 rounded-xl bg-gradient-to-br",n.color,"flex-shrink-0"),children:e.jsx(u,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:n.name}),e.jsx($,{variant:"outline",children:n.subtitle})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:n.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Caracter√≠sticas:"}),e.jsx("ul",{className:"space-y-1",children:n.features.map((j,N)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(be,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-green-500"}),e.jsx("span",{children:j})]},N))})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:"Ideal para:"}),e.jsx("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:n.idealFor})]})]}),b&&e.jsx(de.div,{initial:{scale:0},animate:{scale:1},className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-white"})})})]})})},n.id)})}),a&&e.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx($,{className:"bg-green-100 text-green-700 px-4 py-2",children:"‚úì Tipo selecionado! Continue preenchendo as informa√ß√µes b√°sicas."})})]})},Oe=({questions:a,setQuestions:t,maxScore:m,onAddClosed:n})=>{const[s,u]=v.useState(null),b=()=>{t([...a,{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,image:null,attachments:[],rubric:[],expectedAnswer:""}])},j=(o,r,i)=>{t(a.map(d=>d.id===o?{...d,[r]:i}:d))},N=o=>{t(a.filter(r=>r.id!==o))},Q=o=>{t(a.map(r=>r.id===o?{...r,rubric:[...r.rubric||[],{id:Date.now(),name:"",description:"",maxPoints:0}]}:r))},V=(o,r,i,d)=>{t(a.map(h=>h.id===o?{...h,rubric:h.rubric.map(f=>f.id===r?{...f,[i]:d}:f)}:h))},c=(o,r)=>{t(a.map(i=>i.id===o?{...i,rubric:i.rubric.filter(d=>d.id!==r)}:i))},k=o=>{u(o)},w=(o,r)=>{if(o.preventDefault(),s===null||s===r)return;const i=[...a],d=i[s];i.splice(s,1),i.splice(r,0,d),t(i),u(r)},G=()=>{u(null)},x=a.reduce((o,r)=>o+(parseFloat(r.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Abertas (Dissertativas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[a.length," quest√£o(√µes) ‚Ä¢ Total: ",x.toFixed(1)," pontos",m&&Math.abs(x-m)>.1&&e.jsxs($,{variant:"destructive",className:"ml-2",children:["Meta: ",m," pontos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:b,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Quest√£o Dissertativa"]}),n&&e.jsxs(C,{onClick:n,variant:"outline",className:"border-blue-600 text-blue-600 hover:bg-blue-50",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Quest√£o Objetiva"]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(C,{onClick:b,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((o,r)=>e.jsx(F,{className:`p-6 border-l-4 border-l-green-500 transition-opacity ${s===r?"opacity-50":"opacity-100"}`,draggable:!0,onDragStart:()=>k(r),onDragOver:i=>w(i,r),onDragEnd:G,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-gray-400 cursor-move",title:"Arraste para reordenar"}),e.jsxs($,{className:"bg-green-100 text-green-700",children:["Q",r+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Enunciado da Quest√£o *"}),e.jsx(te,{placeholder:"Digite o enunciado da quest√£o...",value:o.text,onChange:i=>j(o.id,"text",i.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Pontua√ß√£o *"}),e.jsx(P,{type:"number",step:"0.1",min:"0",value:o.points,onChange:i=>j(o.id,"points",parseFloat(i.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"M√°x. Linhas"}),e.jsx(P,{type:"number",placeholder:"Ilimitado",value:o.maxLines||"",onChange:i=>j(o.id,"maxLines",i.target.value?parseInt(i.target.value):null),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"M√°x. Caracteres"}),e.jsx(P,{type:"number",placeholder:"Ilimitado",value:o.maxCharacters||"",onChange:i=>j(o.id,"maxCharacters",i.target.value?parseInt(i.target.value):null),className:"mt-1"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(g,{children:"Rubrica de Avalia√ß√£o (Opcional)"}),e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>Q(o.id),children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Adicionar Crit√©rio"]})]}),o.rubric&&o.rubric.length>0&&e.jsx("div",{className:"space-y-3",children:o.rubric.map(i=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(P,{placeholder:"Nome do crit√©rio",value:i.name,onChange:d=>V(o.id,i.id,"name",d.target.value)}),e.jsx(P,{placeholder:"Descri√ß√£o",value:i.description,onChange:d=>V(o.id,i.id,"description",d.target.value)}),e.jsx(P,{type:"number",step:"0.1",placeholder:"Pontos m√°ximos",value:i.maxPoints,onChange:d=>V(o.id,i.id,"maxPoints",parseFloat(d.target.value))})]}),e.jsx(C,{size:"sm",variant:"ghost",onClick:()=>c(o.id,i.id),children:e.jsx(he,{className:"w-4 h-4 text-red-500"})})]},i.id))})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Resposta Esperada (Gabarito - Opcional)"}),e.jsx(te,{placeholder:"Digite uma resposta de refer√™ncia para consulta durante corre√ß√£o...",value:o.expectedAnswer,onChange:i=>j(o.id,"expectedAnswer",i.target.value),className:"mt-1 min-h-[80px]"})]})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>N(o.id),children:e.jsx(he,{className:"w-5 h-5 text-red-500"})})]})},o.id))})]})})},$e=({questions:a,setQuestions:t,maxScore:m,onAddOpen:n})=>{const[s,u]=v.useState(null),b=()=>{t([...a,{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:"",hint:""}])},j=(r,i,d)=>{t(a.map(h=>h.id===r?{...h,[i]:d}:h))},N=r=>{t(a.filter(i=>i.id!==r))},Q=r=>{t(a.map(i=>{if(i.id===r){const d=String.fromCharCode(65+i.alternatives.length);return{...i,alternatives:[...i.alternatives,{id:Date.now(),letter:d,text:"",isCorrect:!1}]}}return i}))},V=(r,i,d,h)=>{t(a.map(f=>f.id===r?{...f,alternatives:f.alternatives.map(M=>M.id===i?{...M,[d]:h}:M)}:f))},c=(r,i)=>{t(a.map(d=>{if(d.id===r&&d.alternatives.length>2){const h=d.alternatives.filter(f=>f.id!==i);return{...d,alternatives:h.map((f,M)=>({...f,letter:String.fromCharCode(65+M)}))}}return d}))},k=(r,i)=>{E.debug("[ClosedQuestions] ‚úÖ Marcando alternativa como correta:",{questionId:r,altId:i}),t(a.map(d=>{if(d.id===r){const h={...d,alternatives:d.alternatives.map(f=>({...f,isCorrect:f.id===i}))};return E.debug("[ClosedQuestions] Quest√£o atualizada:",h),h}return d}))},w=r=>{u(r)},G=(r,i)=>{if(r.preventDefault(),s===null||s===i)return;const d=[...a],h=d[s];d.splice(s,1),d.splice(i,0,h),t(d),u(i)},x=()=>{u(null)},o=a.reduce((r,i)=>r+(parseFloat(i.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Fechadas (Objetivas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:[a.length," quest√£o(√µes) ‚Ä¢ Total: ",o.toFixed(1)," pontos"]}),m&&Math.abs(o-m)>.1&&e.jsxs($,{variant:"destructive",className:"ml-2",children:["Meta: ",m," pontos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:b,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Quest√£o Objetiva"]}),n&&e.jsxs(C,{onClick:n,variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Quest√£o Dissertativa"]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(C,{onClick:b,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((r,i)=>{const d=r.alternatives?.some(h=>h.isCorrect);return e.jsx(F,{className:`p-6 border-l-4 border-l-blue-500 transition-opacity ${s===i?"opacity-50":"opacity-100"}`,draggable:!0,onDragStart:()=>w(i),onDragOver:h=>G(h,i),onDragEnd:x,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-gray-400 cursor-move",title:"Arraste para reordenar"}),e.jsxs($,{className:"bg-blue-100 text-blue-700",children:["Q",i+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Enunciado da Quest√£o *"}),e.jsx(te,{placeholder:"Digite o enunciado da quest√£o...",value:r.text,onChange:h=>j(r.id,"text",h.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Pontua√ß√£o *"}),e.jsx(P,{type:"number",step:"0.1",min:"0",value:r.points,onChange:h=>j(r.id,"points",parseFloat(h.target.value)),className:"mt-1 w-32"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(g,{children:["Alternativas *",!d&&e.jsx($,{variant:"destructive",className:"ml-2",children:"Marque a correta"})]}),e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>Q(r.id),children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Adicionar Alternativa"]})]}),e.jsx("div",{className:"space-y-3",children:r.alternatives?.map(h=>e.jsxs("div",{className:"flex gap-3 items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-${r.id}`,checked:h.isCorrect,onChange:()=>k(r.id,h.id),className:"w-5 h-5 cursor-pointer",title:"Marcar como correta"}),e.jsx($,{variant:"outline",className:"w-8 justify-center",children:h.letter})]}),e.jsx(P,{placeholder:"Texto da alternativa",value:h.text,onChange:f=>V(r.id,h.id,"text",f.target.value),className:"flex-1"}),r.alternatives.length>2&&e.jsx(C,{size:"sm",variant:"ghost",onClick:()=>c(r.id,h.id),children:e.jsx(he,{className:"w-4 h-4 text-red-500"})})]},h.id))})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Explica√ß√£o da Resposta Correta (Opcional)"}),e.jsx(te,{placeholder:"Explique por que a alternativa est√° correta...",value:r.explanation,onChange:h=>j(r.id,"explanation",h.target.value),className:"mt-1 min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Dica para Alunos (Opcional)"}),e.jsx(P,{placeholder:"Uma dica que pode ajudar...",value:r.hint,onChange:h=>j(r.id,"hint",h.target.value),className:"mt-1"})]})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>N(r.id),children:e.jsx(he,{className:"w-5 h-5 text-red-500"})})]})},r.id)})})]})})},va=({questions:a,setQuestions:t,maxScore:m})=>{const[n,s]=v.useState("open"),u=a.filter(c=>c.type==="open"),b=a.filter(c=>c.type==="closed"),j=c=>{const k=c==="open"?{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,rubric:[],expectedAnswer:""}:{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:""};t([...a,k])},N=a.reduce((c,k)=>c+(parseFloat(k.points)||0),0),Q=u.length>0?(u.reduce((c,k)=>c+k.points,0)/N*100).toFixed(0):0,V=b.length>0?(b.reduce((c,k)=>c+k.points,0)/N*100).toFixed(0):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Mistas"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:[a.length," quest√£o(√µes) total"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[u.length," Abertas - Dissertativas (",Q,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[b.length," Fechadas - Objetivas (",V,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:["Total: ",N.toFixed(1)," pontos"]}),m&&Math.abs(N-m)>.1&&e.jsxs($,{variant:"destructive",className:"ml-2",children:["Meta: ",m," pontos"]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsx("p",{className:"mb-6",children:"Comece adicionando quest√µes abertas ou fechadas."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(C,{onClick:()=>j("open"),variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Aberta"]}),e.jsxs(C,{onClick:()=>j("closed"),variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Fechada"]})]})]}):e.jsxs(qe,{defaultValue:"all",className:"w-full",children:[e.jsxs(ea,{className:"grid w-full grid-cols-3",children:[e.jsxs(ue,{value:"all",children:["Todas (",a.length,")"]}),e.jsxs(ue,{value:"open",children:["Abertas - Dissertativas (",u.length,")"]}),e.jsxs(ue,{value:"closed",children:["Fechadas - Objetivas (",b.length,")"]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:a.map((c,k)=>e.jsxs(F,{className:`p-4 border-l-4 ${c.type==="open"?"border-l-green-500":"border-l-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs($,{className:c.type==="open"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700",children:["Q",k+1," - ",c.type==="open"?"Aberta":"Fechada"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[c.points," pontos"]})]}),e.jsx("p",{className:"text-sm text-gray-700 truncate",children:c.text||"Sem enunciado"})]},c.id))})})]})]}),u.length>0&&e.jsx(Oe,{questions:u,setQuestions:c=>{t([...c,...b])},maxScore:m*(Q/100),onAddClosed:()=>j("closed")}),b.length>0&&e.jsx($e,{questions:b,setQuestions:c=>{t([...u,...c])},maxScore:m*(V/100),onAddOpen:()=>j("open")})]})},ja=({settings:a,setSettings:t,activityType:m})=>{const n=(s,u)=>{t({...a,[s]:u})};return e.jsxs(F,{className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Configura√ß√µes Avan√ßadas"}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Envio Atrasado"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Permitir Envio Atrasado"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos poder√£o submeter ap√≥s o prazo"})]}),e.jsx(W,{checked:a.allowLateSubmission,onCheckedChange:s=>n("allowLateSubmission",s)})]}),a.allowLateSubmission&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Tipo de Penalidade"}),e.jsxs(le,{value:a.latePenaltyType,onValueChange:s=>n("latePenaltyType",s),children:[e.jsx(ne,{className:"mt-1",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(U,{value:"percentage",children:"Percentual"}),e.jsx(U,{value:"points",children:"Pontos Fixos"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Valor da Penalidade"}),e.jsx(P,{type:"number",value:a.latePenaltyValue,onChange:s=>n("latePenaltyValue",parseFloat(s.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"M√°ximo de Dias Atrasados"}),e.jsx(P,{type:"number",value:a.maxLateDays,onChange:s=>n("maxLateDays",parseInt(s.target.value)),className:"mt-1"})]})]})]}),(m==="closed"||m==="quiz"||m==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"M√∫ltiplas Tentativas"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Permitir M√∫ltiplas Tentativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos podem refazer a atividade"})]}),e.jsx(W,{checked:a.allowMultipleAttempts,onCheckedChange:s=>n("allowMultipleAttempts",s)})]}),a.allowMultipleAttempts&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(g,{children:"M√°ximo de Tentativas"}),e.jsx(P,{type:"number",min:"1",value:a.maxAttempts,onChange:s=>n("maxAttempts",parseInt(s.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Considerar"}),e.jsxs(le,{value:a.attemptScoring,onValueChange:s=>n("attemptScoring",s),children:[e.jsx(ne,{className:"mt-1",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(U,{value:"best",children:"Melhor Nota"}),e.jsx(U,{value:"last",children:"√öltima Nota"}),e.jsx(U,{value:"average",children:"M√©dia"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Tempo Limite"}),e.jsxs("div",{children:[e.jsx(g,{children:"Tempo M√°ximo (minutos)"}),e.jsx(P,{type:"number",placeholder:"Ilimitado",value:a.timeLimit||"",onChange:s=>n("timeLimit",s.target.value?parseInt(s.target.value):null),className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Deixe vazio para sem limite"})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Feedback e Gabarito"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{children:"Mostrar nota imediatamente"}),e.jsx(W,{checked:a.showScoreImmediately,onCheckedChange:s=>n("showScoreImmediately",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{children:"Mostrar gabarito ap√≥s submiss√£o"}),e.jsx(W,{checked:a.showAnswerKey,onCheckedChange:s=>n("showAnswerKey",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{children:"Liberar gabarito ap√≥s prazo"}),e.jsx(W,{checked:a.releaseAnswerAfterDeadline,onCheckedChange:s=>n("releaseAnswerAfterDeadline",s)})]})]})]}),(m==="open"||m==="assignment"||m==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Antipl√°gio"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Ativar Detec√ß√£o de Antipl√°gio"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verificar originalidade das respostas dissertativas"})]}),e.jsx(W,{checked:a.plagiarismEnabled,onCheckedChange:s=>n("plagiarismEnabled",s)})]}),a.plagiarismEnabled&&e.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Sensibilidade"}),e.jsxs(le,{value:a.plagiarismSensitivity,onValueChange:s=>n("plagiarismSensitivity",s),children:[e.jsx(ne,{className:"mt-1",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(U,{value:"low",children:"Baixa"}),e.jsx(U,{value:"medium",children:"M√©dia"}),e.jsx(U,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{children:[e.jsxs(g,{children:["Originalidade M√≠nima: ",a.plagiarismMinOriginality,"%"]}),e.jsx(oa,{value:[a.plagiarismMinOriginality],onValueChange:s=>n("plagiarismMinOriginality",s[0]),min:0,max:100,step:5,className:"mt-2"})]})]})]}),(m==="closed"||m==="quiz"||m==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Randomiza√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Embaralhar Quest√µes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cada aluno v√™ ordem diferente"})]}),e.jsx(W,{checked:a.shuffleQuestions,onCheckedChange:s=>n("shuffleQuestions",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Embaralhar Alternativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ordem aleat√≥ria das op√ß√µes"})]}),e.jsx(W,{checked:a.shuffleAlternatives,onCheckedChange:s=>n("shuffleAlternatives",s)})]})]})]})]})},fa=({errors:a,warnings:t,onValidate:m,onNavigateToError:n})=>e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Valida√ß√£o da Atividade"}),e.jsx("p",{className:"text-gray-600",children:"Verifique se sua atividade est√° pronta para ser publicada"})]}),e.jsx(C,{onClick:m,className:"w-full",children:"Executar Valida√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(F,{className:"p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ye,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"V√°lido"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.length===0?"‚úì":"‚Äî"})]}),e.jsxs(F,{className:"p-4 bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Erros"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.length})]}),e.jsxs(F,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Avisos"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:t.length})]})]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-600"}),e.jsxs("h3",{className:"font-semibold text-red-600",children:["Erros Cr√≠ticos (",a.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:a.map((s,u)=>e.jsx(F,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-l-red-500 cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>n(s.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx($,{variant:"destructive",className:"mb-2",children:s.field}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:s.message})]}),e.jsx(be,{className:"w-5 h-5 text-red-600 flex-shrink-0"})]})},u))}),e.jsx("p",{className:"text-sm text-red-600 mt-3",children:"‚ùå Corrija todos os erros antes de publicar a atividade."})]}),t.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("h3",{className:"font-semibold text-yellow-600",children:["Avisos (",t.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:t.map((s,u)=>e.jsx(F,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-l-yellow-500 cursor-pointer hover:bg-yellow-100 transition-colors",onClick:()=>n(s.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx($,{variant:"outline",className:"mb-2 border-yellow-600 text-yellow-700",children:s.field}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:s.message})]}),e.jsx(be,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"})]})},u))}),e.jsx("p",{className:"text-sm text-yellow-600 mt-3",children:"‚ö†Ô∏è Avisos n√£o impedem a publica√ß√£o, mas √© recomendado corrigi-los."})]}),a.length===0&&t.length===0&&e.jsx(F,{className:"p-6 bg-green-50 dark:bg-green-900/20 border-2 border-green-500",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800 dark:text-green-200",children:"Atividade Pronta!"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Sua atividade est√° v√°lida e pronta para ser publicada."})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Checklist Geral"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{checked:a.filter(s=>s.field==="title").length===0,label:"T√≠tulo v√°lido"}),e.jsx(ee,{checked:a.filter(s=>s.field==="description").length===0,label:"Descri√ß√£o v√°lida"}),e.jsx(ee,{checked:a.filter(s=>s.field==="questions").length===0,label:"Pelo menos uma quest√£o"}),e.jsx(ee,{checked:a.filter(s=>s.field.startsWith("question")).length===0,label:"Todas as quest√µes v√°lidas"}),e.jsx(ee,{checked:t.filter(s=>s.field==="tags").length===0,label:"Tags adicionadas",warning:!0}),e.jsx(ee,{checked:t.filter(s=>s.field==="score").length===0,label:"Pontua√ß√£o consistente",warning:!0})]})]})]})}),ee=({checked:a,label:t,warning:m=!1})=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800",children:[a?e.jsx(ye,{className:`w-5 h-5 ${m?"text-yellow-600":"text-green-600"}`}):e.jsx(Ne,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:`text-sm ${a?"text-gray-900 dark:text-gray-100":"text-gray-500"}`,children:t})]}),I=[];for(let a=0;a<256;++a)I.push((a+256).toString(16).slice(1));function ba(a,t=0){return(I[a[t+0]]+I[a[t+1]]+I[a[t+2]]+I[a[t+3]]+"-"+I[a[t+4]]+I[a[t+5]]+"-"+I[a[t+6]]+I[a[t+7]]+"-"+I[a[t+8]]+I[a[t+9]]+"-"+I[a[t+10]]+I[a[t+11]]+I[a[t+12]]+I[a[t+13]]+I[a[t+14]]+I[a[t+15]]).toLowerCase()}let ge;const ya=new Uint8Array(16);function Na(){if(!ge){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ge=crypto.getRandomValues.bind(crypto)}return ge(ya)}const wa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ee={randomUUID:wa};function Ca(a,t,m){a=a||{};const n=a.random??a.rng?.()??Na();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ba(n)}function ve(a,t,m){return Ee.randomUUID&&!a?Ee.randomUUID():Ca(a)}const se={DRAFTS:"drafts",ACTIVITIES:"activities",SUBMISSIONS:"submissions"},Aa=async(a,t,m="")=>{try{const n=a.name.split(".").pop(),s=`${Math.random().toString(36).substring(2,15)}-${Date.now()}.${n}`,u=m?`${m}/${s}`:s,{data:b,error:j}=await T.storage.from(t).upload(u,a,{cacheControl:"3600",upsert:!1});if(j)throw j;const{data:{publicUrl:N}}=T.storage.from(t).getPublicUrl(u);return{data:{path:b.path,publicUrl:N,fileName:a.name,fileType:a.type,size:a.size},error:null}}catch(n){return E.error("Error uploading file:",n),{data:null,error:n}}},ze=async(a,t)=>{try{const{data:m,error:n}=await T.storage.from(a).remove([t]);if(n)throw n;return{data:m,error:null}}catch(m){return E.error("Error removing file:",m),{data:null,error:m}}},Sa=(a,t)=>{const{data:m}=T.storage.from(a).getPublicUrl(t);return m.publicUrl},ka=async(a,t,m,n)=>{try{const{data:s,error:u}=await T.storage.from(a).download(t);if(u)throw u;const{data:b,error:j}=await Aa(new File([s],n.split("/").pop(),{type:s.type}),m,n.split("/").slice(0,-1).join("/"));if(j)throw j;return await ze(a,t),{data:b,error:null}}catch(s){return E.error("Error moving file:",s),{data:null,error:s}}},Te=a=>a&&a.startsWith("image/"),je=(a,t,m={})=>{const{width:n=300,height:s=300,quality:u=80,resize:b="cover"}=m,{data:j}=T.storage.from(a).getPublicUrl(t,{transform:{width:n,height:s,resize:b,quality:u}});return j.publicUrl},Pe=(a,t)=>({small:je(a,t,{width:150,height:150}),medium:je(a,t,{width:300,height:300}),large:je(a,t,{width:600,height:600}),original:Sa(a,t)}),Da=(a,t,m=!1)=>{const[n,s]=v.useState(!1),[u,b]=v.useState(0),[j,N]=v.useState(null),Q=v.useCallback(()=>m?se.DRAFTS:se.ACTIVITIES,[m]),V=v.useCallback(x=>{const o=Date.now(),r=x.split(".").pop(),i=ve();return`${t}/${a}/${o}-${i}.${r}`},[a,t]),c=v.useCallback(async x=>{if(!x)return null;s(!0),N(null);try{const o=Q(),r=V(x.name),i={cacheControl:"3600",upsert:!1,onProgress:S=>{const _=Math.round(S.loaded/S.total*100);b(_)}},{data:d,error:h}=await T.storage.from(o).upload(r,x,i);if(h)throw h;const{data:{publicUrl:f}}=T.storage.from(o).getPublicUrl(r),M={id:ve(),name:x.name,url:f,path:d.path,size:x.size,type:x.type,isNew:!0,isImage:Te(x.type)};return M.isImage&&(M.thumbnails=Pe(o,d.path)),M}catch(o){throw E.error("Erro ao fazer upload do arquivo:",o),N(o.message||"Erro ao fazer upload do arquivo"),o}finally{s(!1),b(0)}},[Q,V]),k=v.useCallback(async x=>{if(!x)return!1;try{const o=Q(),{error:r}=await ze(o,x);if(r)throw r;return!0}catch(o){throw E.error("Erro ao remover arquivo:",o),N(o.message||"Erro ao remover o arquivo"),o}},[Q]),w=v.useCallback(async(x=null)=>{try{if(!m)throw new Error("Apenas rascunhos podem ser publicados");const o=se.DRAFTS,r=se.ACTIVITIES,i=`${t}/${a||"temp"}`,d=`${t}/${x||a}`,{data:h,error:f}=await T.storage.from(o).list(i);if(f)throw f;const M=[];for(const S of h){const _=`${i}/${S.name}`,O=`${d}/${S.name}`,{error:ae}=await ka(o,_,r,O);if(ae){E.warn(`Falha ao mover o arquivo ${S.name}:`,ae);continue}const{data:{publicUrl:z}}=T.storage.from(r).getPublicUrl(O);M.push({originalPath:_,newPath:O,url:z,name:S.name,type:S.metadata?.mimetype||"application/octet-stream",size:S.metadata?.size||0})}return M}catch(o){throw E.error("Erro ao publicar arquivos da atividade:",o),N(o.message||"Erro ao publicar os arquivos da atividade"),o}},[a,m,t]),G=v.useCallback(async(x,o)=>{if(!x||!o)throw new Error("Arquivo e ID de submiss√£o s√£o obrigat√≥rios");s(!0),N(null);try{const r=se.SUBMISSIONS,i=`${t}/${a}/${o}/${x.name}`,d={cacheControl:"3600",upsert:!1,onProgress:_=>{const O=Math.round(_.loaded/_.total*100);b(O)}},{data:h,error:f}=await T.storage.from(r).upload(i,x,d);if(f)throw f;const{data:{publicUrl:M}}=T.storage.from(r).getPublicUrl(i),S={id:ve(),name:x.name,url:M,path:h.path,size:x.size,type:x.type,isNew:!0,isImage:Te(x.type)};return S.isImage&&(S.thumbnails=Pe(r,h.path)),S}catch(r){throw E.error("Erro ao fazer upload da submiss√£o:",r),N(r.message||"Erro ao fazer upload da submiss√£o"),r}finally{s(!1),b(0)}},[a,t]);return{isUploading:n,uploadProgress:u,error:j,uploadActivityFile:c,removeActivityFile:k,publishActivityFiles:w,uploadSubmission:G,resetError:()=>N(null)}},K={OPEN:"open",CLOSED:"closed",MIXED:"mixed"},Y={ASSIGNMENT:"assignment",QUIZ:"quiz",ESSAY:"essay",PROJECT:"project"},Ea={[K.OPEN]:Y.ASSIGNMENT,[K.CLOSED]:Y.QUIZ,[K.MIXED]:Y.ASSIGNMENT},Ta={[Y.ASSIGNMENT]:K.OPEN,[Y.QUIZ]:K.CLOSED,[Y.ESSAY]:K.OPEN,[Y.PROJECT]:K.MIXED};function fe(a){const t=Ea[a];return t||(console.warn(`[Activity Type Mapping] Tipo desconhecido: ${a}, usando 'assignment' como fallback`),Y.ASSIGNMENT)}function Pa(a){const t=Ta[a];return t||(console.warn(`[Activity Type Mapping] Tipo do banco desconhecido: ${a}, usando 'open' como fallback`),K.OPEN)}function Ma(a){return Object.values(Y).includes(a)}const Is=()=>{const a=He(),{id:t}=Xe(),{user:m}=Je(),{toast:n}=na(),s=!!t,[u,b]=v.useState(s),[j,N]=v.useState(!1),[Q,V]=v.useState(null),[c,k]=v.useState(null),[w,G]=v.useState(""),[x,o]=v.useState(""),[r,i]=v.useState(""),[d,h]=v.useState([]),[f,M]=v.useState("medium"),[S,_]=v.useState(""),[O,ae]=v.useState(10),[z,q]=v.useState([]),[xe,Ce]=v.useState([]),[H,Ae]=v.useState({allowLateSubmission:!1,latePenaltyType:"percentage",latePenaltyValue:10,maxLateDays:7,allowMultipleAttempts:!1,maxAttempts:1,attemptScoring:"best",timeLimit:null,showScoreImmediately:!0,showAnswerKey:!1,releaseAnswerAfterDeadline:!0,plagiarismEnabled:!1,plagiarismSensitivity:"medium",plagiarismMinOriginality:70,shuffleQuestions:!1,shuffleAlternatives:!1}),[L,R]=v.useState(s?"basics":"type"),[Qe,Se]=v.useState(!1),[pe,Ve]=v.useState([]),[re,Ue]=v.useState([]),[Le,ie]=v.useState(!1),{publishActivityFiles:_e}=Da(t||"temp",m?.id,!s);v.useEffect(()=>{if(!c)return;const l=setInterval(()=>{Ge()},6e4);return()=>clearInterval(l)},[c,w,x,z,H]),v.useEffect(()=>{s?Be():Re()},[t]);const Re=()=>{try{const l=sessionStorage.getItem("importedActivity");if(l){const p=JSON.parse(l);let y=p.activityType||null;if(!y&&Array.isArray(p.questions)&&p.questions.length>0){const A=p.questions.some(X=>X.type==="closed"),D=p.questions.some(X=>X.type==="open");A&&D?y="mixed":A?y="quiz":D&&(y="open")}k(y||"mixed"),G(p.title||""),o(p.description||""),Array.isArray(p.questions)&&p.questions.length>0?q(p.questions):p.content&&q([{id:Date.now().toString(),type:"open",text:p.content,points:10,maxLines:null,maxCharacters:null,image:null,attachments:[],rubric:[],expectedAnswer:""}]),n({title:"üì• Atividade importada",description:`Conte√∫do de "${p.importedFrom}" carregado. Revise e edite conforme necess√°rio.`}),sessionStorage.removeItem("importedActivity"),R("questions")}}catch(l){E.error("Erro ao carregar dados importados:",l)}},Be=async()=>{try{b(!0);const{data:l,error:p}=await T.from("activities").select("*").eq("id",t).single();if(p)throw p;const y=Pa(l.type);E.debug("[Activity Load] Convertendo tipo:",{databaseType:l.type,frontendType:y}),k(y),G(l.title),o(l.description||""),i(l.content?.subject||""),h(l.content?.tags||[]),M(l.content?.difficulty||"medium"),_(l.content?.estimated_time||""),ae(l.max_score||10),q(l.content?.questions||[]),Ce(l.content?.attachments||[]),l.content?.advanced_settings&&Ae(l.content.advanced_settings),n({title:"Atividade carregada",description:"Voc√™ pode editar e salvar as altera√ß√µes."})}catch(l){E.error("Erro ao carregar atividade:",l),n({title:"Erro",description:"N√£o foi poss√≠vel carregar a atividade.",variant:"destructive"}),a("/dashboard/activities")}finally{b(!1)}},Ge=async()=>{if(!(!w||!c))try{const l=fe(c),p={title:w,description:x,type:l,max_score:O,status:"draft",content:{subject:r,tags:d,difficulty:f,estimated_time:S,questions:z,attachments:xe,advanced_settings:H},created_by:m.id,updated_at:new Date().toISOString()};if(s){const{error:y}=await T.from("activities").update(p).eq("id",t);if(y)throw y}V(new Date)}catch(l){E.error("Erro no auto-save:",l)}},ke=()=>{const l=[],p=[];(!w||w.trim().length<3)&&l.push({field:"title",message:"T√≠tulo deve ter pelo menos 3 caracteres"}),(!x||x.trim().length<10)&&l.push({field:"description",message:"Descri√ß√£o deve ter pelo menos 10 caracteres"}),z.length===0&&l.push({field:"questions",message:"Adicione pelo menos uma quest√£o"}),z.forEach((A,D)=>{(!A.text||A.text.trim().length<5)&&l.push({field:`question-${D}`,message:`Quest√£o ${D+1}: enunciado muito curto`}),(!A.points||A.points<=0)&&l.push({field:`question-${D}`,message:`Quest√£o ${D+1}: pontua√ß√£o inv√°lida`}),(c==="closed"||c==="quiz")&&A.type==="closed"&&((!A.alternatives||A.alternatives.length<2)&&l.push({field:`question-${D}`,message:`Quest√£o ${D+1}: deve ter pelo menos 2 alternativas`}),(A.alternatives?.filter(J=>J.isCorrect)||[]).length===0&&l.push({field:`question-${D}`,message:`Quest√£o ${D+1}: marque pelo menos uma alternativa correta`}))}),d.length===0&&p.push({field:"tags",message:"Considere adicionar tags para facilitar a organiza√ß√£o"}),S||p.push({field:"time",message:"Tempo estimado n√£o definido"});const y=z.reduce((A,D)=>A+(D.points||0),0);return Math.abs(y-O)>.1&&p.push({field:"score",message:`Soma das quest√µes (${y}) difere da pontua√ß√£o m√°xima (${O})`}),Ve(l),Ue(p),l.length===0},Ye=async()=>{if(!w||w.trim().length<3){n({title:"T√≠tulo obrigat√≥rio",description:"Defina um t√≠tulo para salvar o rascunho.",variant:"destructive"});return}if(!c){n({title:"Tipo obrigat√≥rio",description:"Selecione o tipo de atividade.",variant:"destructive"});return}try{N(!0);const l=fe(c);E.debug("[Activity Draft] Mapeando tipo:",{frontendType:c,databaseType:l});const p={title:w.trim(),description:x?.trim()||"",type:l,max_score:O,status:"draft",content:{subject:r,tags:d,difficulty:f,estimated_time:S,questions:z,attachments:xe,advanced_settings:H},created_by:m.id,updated_at:new Date().toISOString()};if(console.log("[TeacherActivityCreatePage] üíæ Salvando atividade:",{title:w,type:c,questionsCount:z.length,advancedSettings:H}),s){const{error:y}=await T.from("activities").update(p).eq("id",t);if(y)throw y;n({title:"Rascunho salvo",description:"Suas altera√ß√µes foram salvas."})}else{const{data:y,error:A}=await T.from("activities").insert(p).select().single();if(A)throw A;n({title:"‚úÖ Rascunho salvo!",description:"Atividade salva como rascunho. Aparecer√° na sua lista de atividades."}),a(`/dashboard/activities/${y.id}/edit`,{replace:!0})}V(new Date)}catch(l){E.error("Erro ao salvar rascunho:",l),n({title:"Erro",description:"N√£o foi poss√≠vel salvar o rascunho.",variant:"destructive"})}finally{N(!1)}},We=async()=>{if(!ke()){n({title:"Valida√ß√£o falhou",description:"Corrija os erros antes de publicar.",variant:"destructive"});return}if(re.length>0){ie(!0);return}await De()},De=async()=>{ie(!1);try{N(!0);const l=fe(c);E.debug("[Activity Create] Mapeando tipo:",{frontendType:c,databaseType:l,isValid:Ma(l)});let p={title:w,description:x,type:l,max_score:O,status:"published",is_published:!0,content:{subject:r,tags:d,difficulty:f,estimated_time:S,questions:z,attachments:xe,advanced_settings:H},created_by:m.id,updated_at:new Date().toISOString()};if(s){const{error:y}=await T.from("activities").update(p).eq("id",t);if(y)throw y}else{const{data:y,error:A}=await T.from("activities").insert(p).select().single();if(A)throw A;try{const D=await _e(y.id);if(D&&D.length>0){const X=D.map(J=>({name:J.name,url:J.url,path:J.newPath,size:J.size,type:J.type}));p={...p,content:{...p.content,attachments:X}},await T.from("activities").update(p).eq("id",y.id),Ce(X)}}catch(D){E.warn("Falha ao mover anexos de rascunho ao publicar:",D)}}n({title:"Atividade publicada!",description:"Agora voc√™ pode postar em suas turmas."}),a("/dashboard/activities")}catch(l){E.error("Erro ao publicar:",l),n({title:"Erro",description:"N√£o foi poss√≠vel publicar a atividade.",variant:"destructive"})}finally{N(!1)}};return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ze,{size:"lg",text:"Carregando atividade..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>a("/dashboard/activities"),children:e.jsx(da,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:s?`Editar: ${w||"Atividade"}`:"Criar Nova Atividade"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx($,{variant:c?"default":"secondary",children:c||"Tipo n√£o definido"}),e.jsx($,{variant:"outline",children:s?"Editando":"Nova"}),Q&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Salvo ",Math.floor((new Date-Q)/1e3),"s atr√°s"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(C,{variant:"outline",onClick:()=>Se(!0),disabled:!c,children:[e.jsx(ma,{className:"w-5 h-5 mr-2"}),"Pr√©via"]}),e.jsxs(C,{variant:"outline",onClick:Ye,disabled:j||!c||!w||w.trim().length<3,children:[e.jsx(ha,{className:"w-5 h-5 mr-2"}),j?"Salvando...":"Salvar"]}),e.jsxs(C,{onClick:We,disabled:j||!c,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(me,{className:"w-5 h-5 mr-2"}),s?"Publicar Altera√ß√µes":"Publicar Atividade"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(F,{className:"p-4 sticky top-6",children:e.jsxs("nav",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>R("type"),className:Z("w-full text-left px-4 py-2 rounded-lg transition-colors",L==="type"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:s,children:[e.jsx(Ie,{className:"w-4 h-4 inline mr-2"}),"Tipo de Atividade"]}),e.jsxs("button",{onClick:()=>R("basics"),className:Z("w-full text-left px-4 py-2 rounded-lg transition-colors",L==="basics"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(xa,{className:"w-4 h-4 inline mr-2"}),"Informa√ß√µes B√°sicas"]}),e.jsxs("button",{onClick:()=>R("questions"),className:Z("w-full text-left px-4 py-2 rounded-lg transition-colors",L==="questions"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:!c,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"Quest√µes (",z.length,")"]}),e.jsxs("button",{onClick:()=>R("advanced"),className:Z("w-full text-left px-4 py-2 rounded-lg transition-colors",L==="advanced"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(pa,{className:"w-4 h-4 inline mr-2"}),"Configura√ß√µes"]}),e.jsxs("button",{onClick:()=>R("validation"),className:Z("w-full text-left px-4 py-2 rounded-lg transition-colors",L==="validation"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(me,{className:"w-4 h-4 inline mr-2"}),"Valida√ß√£o",pe.length>0&&e.jsx($,{variant:"destructive",className:"ml-2",children:pe.length})]})]})})}),e.jsx("div",{className:"col-span-9",children:e.jsxs(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[L==="type"&&!s&&e.jsx(ga,{selectedType:c,onSelectType:l=>{k(l),R("basics")}}),L==="basics"&&e.jsxs(F,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Informa√ß√µes B√°sicas"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"title",children:"T√≠tulo da Atividade *"}),e.jsx(P,{id:"title",placeholder:"Ex: Avalia√ß√£o de √Ålgebra Linear - Unidade 2",value:w,onChange:l=>G(l.target.value),className:"mt-1",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[w.length,"/200 caracteres"]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"description",children:"Descri√ß√£o *"}),e.jsx(te,{id:"description",placeholder:"Descreva o objetivo e instru√ß√µes gerais da atividade...",value:x,onChange:l=>o(l.target.value),className:"mt-1 min-h-[120px]",maxLength:2e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[x.length,"/2000 caracteres"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"subject",children:"Disciplina/Mat√©ria *"}),e.jsx(P,{id:"subject",placeholder:"Ex: Matem√°tica",value:r,onChange:l=>i(l.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"difficulty",children:"Dificuldade"}),e.jsxs(le,{value:f,onValueChange:M,children:[e.jsx(ne,{className:"mt-1",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(U,{value:"easy",children:"F√°cil"}),e.jsx(U,{value:"medium",children:"M√©dia"}),e.jsx(U,{value:"hard",children:"Dif√≠cil"}),e.jsx(U,{value:"very_hard",children:"Muito Dif√≠cil"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"time",children:"Tempo Estimado (minutos)"}),e.jsx(P,{id:"time",type:"number",placeholder:"45",value:S,onChange:l=>_(l.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"maxScore",children:"Pontua√ß√£o M√°xima Total *"}),e.jsx(P,{id:"maxScore",type:"number",step:"0.1",min:"0.1",max:"100",value:O,onChange:l=>ae(parseFloat(l.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"tags",children:"T√≥picos/Tags"}),e.jsx(P,{id:"tags",placeholder:"Pressione Enter para adicionar (Ex: √Ålgebra, Matrizes)",onKeyDown:l=>{l.key==="Enter"&&l.target.value.trim()&&(l.preventDefault(),d.includes(l.target.value.trim())||(h([...d,l.target.value.trim()]),l.target.value=""))},className:"mt-1"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.map((l,p)=>e.jsxs($,{variant:"secondary",className:"cursor-pointer hover:bg-red-100",onClick:()=>h(d.filter((y,A)=>A!==p)),children:["#",l," √ó"]},p))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(C,{onClick:()=>R("questions"),disabled:!w||!x||!r,children:"Pr√≥ximo: Adicionar Quest√µes"})})]})]}),L==="questions"&&c&&e.jsxs(e.Fragment,{children:[(c==="open"||c==="assignment")&&e.jsx(Oe,{questions:z,setQuestions:q,maxScore:O,onAddClosed:void 0}),(c==="closed"||c==="quiz")&&e.jsx($e,{questions:z,setQuestions:q,maxScore:O,onAddOpen:void 0}),(c==="mixed"||c==="project")&&e.jsx(va,{questions:z,setQuestions:q,maxScore:O})]}),L==="advanced"&&e.jsx(ja,{settings:H,setSettings:Ae,activityType:c}),L==="validation"&&e.jsx(fa,{errors:pe,warnings:re,onValidate:ke,onNavigateToError:l=>{l.startsWith("question")?R("questions"):["title","description","subject"].includes(l)&&R("basics")}})]},L)})]}),Qe&&e.jsx(ca,{activity:{title:w,description:x,type:c,subject:r,tags:d,difficulty:f,estimatedTime:S,maxScore:O,questions:z,advancedSettings:H},onClose:()=>Se(!1)}),e.jsx(aa,{open:Le,onOpenChange:ie,children:e.jsxs(sa,{children:[e.jsxs(ta,{children:[e.jsxs(ra,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-6 h-6 text-orange-600"}),"Avisos Detectados"]}),e.jsxs(ia,{children:["H√° ",re.length," aviso(s) na atividade. Deseja publicar mesmo assim?"]})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"space-y-2",children:re.map((l,p)=>e.jsx("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:["‚ö†Ô∏è ",l.message]})},p))})}),e.jsxs(la,{children:[e.jsx(C,{variant:"outline",onClick:()=>ie(!1),children:"Cancelar"}),e.jsx(C,{onClick:De,className:"bg-orange-600 hover:bg-orange-700",children:"Publicar Mesmo Assim"})]})]})})]})};export{Is as default};
