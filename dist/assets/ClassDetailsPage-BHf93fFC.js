import{c as Pe,u as ts,r as a,s as b,l as B,j as e,q as me,h as _s,b as Ss,C as As}from"./main-CDwcRVbo.js";import{B as q}from"./button-BuH7Xbht.js";import{C as p}from"./card-BeDiIhdC.js";import{B as K}from"./badge-C6gXtPyv.js";import{t as g}from"./use-toast-BOz3McvK.js";import{D as ke,a as Ce,b as _e,e as H,d as Se}from"./dropdown-menu-DUHtGofS.js";import{D as xs,a as us,b as hs,c as gs,e as ps,d as Es}from"./dialog-C1lfrTz_.js";import{I as pe}from"./input-BByzzpRS.js";import{C as ls}from"./checkbox-REItPVxG.js";import{L as Ee}from"./label-CwZn5L96.js";import{C as Ds}from"./classService-tSZnsifO.js";import{r as Ve}from"./redisCache-D1ftQZX5.js";import{U as ce}from"./users-CgJEdG6v.js";import{T as De}from"./trending-up-DCuPlkSP.js";import{C as oe}from"./circle-check-big-ZpCnrfY5.js";import{C as Te}from"./clock-DTcmbWF-.js";import{m as Y}from"./proxy-BQZ2TmvR.js";import{C as te}from"./calendar-BqfKTByC.js";import{P as ue}from"./plus-CvKRhDg_.js";import{F as X}from"./file-text-DqPfoEgV.js";import{C as he}from"./circle-alert-CzqxqrLI.js";import{M as be,I as Ue,A as vs,a as fs,b as js}from"./avatar-DYE71gSn.js";import{S as Ts}from"./square-check-big-DEeY-kJ5.js";import{S as le,a as ie,b as ne,c as de,d as T}from"./select-DLEl6fnx.js";import{X as ze}from"./x-Dx_XJWp3.js";import{V as Ie}from"./video-DaIYnU7A.js";import{L as Qe}from"./link-C1XcG9Kf.js";import{U as bs}from"./upload-hHx_Ei_T.js";import{C as Re}from"./ConfirmDialog-BuU1wJTh.js";import{E as Ae}from"./ellipsis-vertical-4xJhA8ij.js";import{E as ve}from"./eye-DwPEs21A.js";import{D as qe}from"./download-Dd-HeChr.js";import{S as Fe}from"./square-pen-XyPwf7va.js";import{T as We}from"./trash-2-DWzFVjOL.js";import{M as as}from"./message-square-Cmtxa8py.js";import{f as ye}from"./formatDistanceToNow-sn9sU9NS.js";import{p as ge}from"./pt-BR-D0BJ_iDf.js";import{I as He}from"./info-CYj_Qsj6.js";import{T as Xe}from"./triangle-alert-3VG5rXf9.js";import{B as is}from"./bell-BCMDKcho.js";import{B as Ye}from"./book-open-B_wcLpnO.js";import{F as Le}from"./folder-DYyt85gR.js";import{S as we}from"./search-6oujL9dj.js";import{P as je}from"./progress-_kQrU16b.js";import{f as Ne}from"./format-B5colFmK.js";import{i as Be}from"./isPast-DRdJRFoN.js";import{C as Je}from"./clipboard-list-BhZnsXAz.js";import{A as Ms}from"./archive-SYxT_NH7.js";import{t as qs}from"./en-US-DaE-csDX.js";import{a as Ps}from"./addDays-ByTXhFEf.js";import{c as zs}from"./constructNow-BZVcxkR5.js";import{i as Rs}from"./isSameDay-D48s9Jab.js";import{i as fe}from"./isToday-Cwn90TaQ.js";import{C as Me}from"./copy-D7hakCSI.js";import{U as ns}from"./user-plus-BN10iUyM.js";import{M as Fs}from"./mail-itZWCqAF.js";import{A as ds}from"./award-BzkgCaDU.js";import{T as os}from"./target-CbUvD44h.js";import{B as Ge}from"./bot-CEshKSBq.js";import{M as Os}from"./message-circle-B9SdJZHY.js";import{Z as $s}from"./zap-N99Lt2zz.js";import{B as cs}from"./brain-B546Q6XX.js";import{S as Ns}from"./settings-DAYbyNc3.js";import{s as ms}from"./toastUtils-tVR3rJfQ.js";import{A as Ls}from"./arrow-left-M6tAHSp6.js";import"./index-Dh6vDsM6.js";import"./index-CPGjc502.js";import"./index-CqoVHjef.js";import"./index-CcEjAaVA.js";import"./Combination-CkmxMhvN.js";import"./SidebarPremium-DtY86ggr.js";import"./house-BzSw2wbQ.js";import"./graduation-cap-D_9lOntz.js";import"./chart-column-CiDVUyDs.js";import"./index-CrH3dQlI.js";import"./chevron-right-C7mHeVR8.js";import"./index-Bnl_O2Nv.js";import"./check-CJ5iHYK_.js";import"./index-RCrci90a.js";import"./index-CQXXlVAR.js";import"./chevron-down-C12er63L.js";import"./chevron-up-CjnVXTVX.js";import"./differenceInCalendarMonths-CtUCBvak.js";import"./endOfDay-BZ13SNr-.js";import"./endOfMonth-B3jF8fTW.js";import"./getRoundingMethod-D0I6Z7xl.js";const Bs=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],es=Pe("chart-no-axes-column",Bs);const Gs=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Vs=Pe("layout-dashboard",Gs);const Us=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],ss=Pe("pin",Us);const Is=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],Qs=Pe("thumbs-up",Is);const Hs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ws=Pe("user-x",Hs);function Zs(n){return+qs(n)>Date.now()}function Ke(n,P){return Rs(n,Ps(zs(n),1),P)}const Ks=({classId:n,classData:P,onTabChange:M})=>{const S=ts(),[D,N]=a.useState(!0),[r,c]=a.useState({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0}),[$,j]=a.useState([]),d=o=>{switch(o){case"Criar Atividade":S(`/dashboard/activities/create?classId=${n}`);break;case"Adicionar Aluno":M?.("students");break;case"Novo Material":M?.("library");break;case"Agendar Aula":M?.("schedule");break;case"Postar Comunicado":M?.("announcements");break;case"Corrigir Trabalhos":M?.("activities");break}};a.useEffect(()=>{A()},[n]);const A=async()=>{try{N(!0);const o=await Ve.getClassStats(n,async()=>{const{data:u}=await b.from("activity_class_assignments").select(`
            id,
            assigned_at,
            activity:activities(
              id,
              title,
              type,
              due_date,
              max_score,
              status,
              created_at
            )
          `).eq("class_id",n).order("assigned_at",{ascending:!1}),f=(u||[]).map(l=>l.activity?.id).filter(Boolean),{count:z}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student");if(!f||f.length===0)return{totalStudents:z||0,avgGrade:0,onTimeRate:0,openActivities:0,recentActivities:[],timestamp:new Date().toISOString()};const{data:V,count:L}=await b.from("submissions").select("grade, submitted_at",{count:"exact"}).in("activity_id",f).not("grade","is",null).limit(1e3),G=V?.filter(l=>l.grade!==null)||[],R=G.length>0?G.reduce((l,E)=>l+parseFloat(E.grade),0)/G.length:0,k=V?.filter(l=>!!l.submitted_at)||[],C=L>0?Math.round(k.length/L*100):0,O=(u||[]).filter(l=>l.activity).slice(0,3).map(l=>({id:l.activity.id,title:l.activity.title,type:l.activity.type,due_date:l.activity.due_date,status:l.activity.status,assigned_at:l.assigned_at}));return{totalStudents:z||0,avgGrade:Number(R.toFixed(1)),onTimeRate:C,openActivities:f.length,recentActivities:O,timestamp:new Date().toISOString()}});o?(c({totalStudents:o.totalStudents||0,avgGrade:typeof o.avgGrade=="number"?o.avgGrade:0,onTimeRate:o.onTimeRate||0,openActivities:o.openActivities||0}),j(Array.isArray(o.recentActivities)?o.recentActivities:[])):(c({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0}),j([]))}catch(o){B.error("Erro ao carregar estatÃ­sticas:",o),c({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0}),j([])}finally{N(!1)}};if(D)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})});const v=[{title:"Total de Alunos",value:r.totalStudents,icon:ce,color:"blue",description:r.totalStudents===0?"Nenhum aluno matriculado ainda":r.totalStudents===1?"1 aluno matriculado na turma":`${r.totalStudents} alunos matriculados na turma`},{title:"Nota MÃ©dia da Turma",value:r.avgGrade.toFixed(1),icon:De,color:r.avgGrade>=7?"green":r.avgGrade>=5?"yellow":"red",description:r.avgGrade===0?"Ainda nÃ£o hÃ¡ notas lanÃ§adas para esta turma":"Baseada nas notas das atividades corrigidas"},{title:"Taxa de Entrega no Prazo",value:`${r.onTimeRate}%`,icon:oe,color:r.onTimeRate>=80?"green":r.onTimeRate>=60?"yellow":"red",description:r.onTimeRate===0?"Nenhuma submissÃ£o com prazo registrada ainda":"Entre todas as submissÃµes desta turma"},{title:"Atividades em Aberto",value:r.openActivities,icon:Te,color:r.openActivities>10?"red":r.openActivities>5?"yellow":"blue",description:r.openActivities===0?"Nenhuma atividade aberta no momento":"Atividades jÃ¡ postadas para esta turma"}],m={blue:"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800",green:"bg-green-50 dark:bg-green-950 text-green-600 dark:text-green-400 border-green-200 dark:border-green-800",yellow:"bg-yellow-50 dark:bg-yellow-950 text-yellow-600 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",red:"bg-red-50 dark:bg-red-950 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800"};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:v.map((o,u)=>{const f=o.icon;return e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:u*.1},children:e.jsxs(p,{className:`p-6 border-2 ${m[o.color]}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:`p-3 rounded-lg ${m[o.color]}`,children:e.jsx(f,{className:"w-6 h-6"})})}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:o.value}),e.jsx("div",{className:"text-sm font-medium mb-2",children:o.title}),o.description&&e.jsx("div",{className:"text-xs opacity-75",children:o.description})]})},o.title)})}),e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-blue-600"}),"Agenda de Aulas"]}),e.jsx(q,{variant:"outline",size:"sm",onClick:()=>M?.("schedule"),children:"Ver Completa"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Nenhuma aula agendada nos prÃ³ximos dias"}),e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>d("Agendar Aula"),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Agendar Aula"]})]})]}),e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),"Ãšltimas Atividades Postadas"]}),e.jsx(q,{variant:"link",size:"sm",onClick:()=>M?.("activities"),children:"Ver todas"})]}),$.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(X,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhuma atividade postada para esta turma."})]}):e.jsx("div",{className:"space-y-3",children:$.map(o=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0 border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:o.title||"Sem tÃ­tulo"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:o.due_date?`Prazo: ${new Date(o.due_date).toLocaleDateString("pt-BR")}`:"Sem prazo definido"})]}),e.jsx("div",{className:"ml-4 text-xs text-slate-500 dark:text-slate-400 flex flex-col items-end",children:e.jsxs("span",{children:["Postada"," ",o.assigned_at?new Date(o.assigned_at).toLocaleDateString("pt-BR"):"â€”"]})})]},o.id))})]}),e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-yellow-600"}),"Alunos que Precisam de AtenÃ§Ã£o"]}),e.jsx(q,{variant:"link",size:"sm",onClick:()=>M?.("students"),children:"Ver todos"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"w-12 h-12 text-green-300 dark:text-green-700 mx-auto mb-3"}),e.jsx("p",{className:"text-green-600 dark:text-green-400 font-medium mb-2",children:"Nenhum aluno em situaÃ§Ã£o de alerta"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"ParabÃ©ns! Todos estÃ£o acompanhando bem."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"AÃ§Ãµes RÃ¡pidas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[{icon:ue,label:"Criar Atividade",color:"blue"},{icon:ce,label:"Adicionar Aluno",color:"green"},{icon:X,label:"Novo Material",color:"purple"},{icon:te,label:"Agendar Aula",color:"orange"},{icon:be,label:"Postar Comunicado",color:"yellow"},{icon:Ts,label:"Corrigir Trabalhos",color:"red"}].map(o=>{const u=o.icon;return e.jsx(p,{className:"p-4 hover:shadow-lg transition-shadow cursor-pointer group",onClick:()=>d(o.label),children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 group-hover:scale-110 transition-transform",children:e.jsx(u,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:o.label})]})},o.label)})})]})]})},Xs=({isOpen:n,onClose:P,classId:M,onSuccess:S,editingPost:D})=>{const[N,r]=a.useState(!1),[c,$]=a.useState(D?.file_type?.includes("video")?"video":D?.file_type==="link"?"link":"text"),[j,d]=a.useState({title:D?.title||"",content:D?.description||"",link:D?.file_url||"",file:null}),A=[{id:"text",label:"Texto",icon:X,desc:"Compartilhe um texto ou aviso"},{id:"video",label:"VÃ­deo",icon:Ie,desc:"Adicione um vÃ­deo do YouTube ou Vimeo"},{id:"link",label:"Link",icon:Qe,desc:"Compartilhe um link externo"},{id:"image",label:"Imagem",icon:Ue,desc:"Adicione fotos ou imagens"}],v=async m=>{if(m.preventDefault(),!j.title.trim()||!j.content.trim()){g({title:"Campos obrigatÃ³rios",description:"Preencha tÃ­tulo e conteÃºdo",variant:"destructive"});return}try{r(!0);const{data:{user:o}}=await b.auth.getUser();if(!o)throw new Error("UsuÃ¡rio nÃ£o autenticado");const u={title:j.title,description:j.content,file_url:j.link||null,file_type:c==="video"?"video/url":c==="link"?"link":"text",category:"post",is_public:!1};let f;if(D?{error:f}=await b.from("class_materials").update(u).eq("id",D.id):{error:f}=await b.from("class_materials").insert({...u,class_id:M,created_by:o.id}),f)throw f;await Ve.invalidateClass(M),g({title:D?"âœ… Post atualizado!":"âœ… Post criado!",description:D?"Suas alteraÃ§Ãµes foram salvas.":"Seu post foi publicado no mural."}),d({title:"",content:"",link:"",file:null}),$("text"),S?.(),P()}catch(o){B.error("Erro ao criar post:",o),g({title:"Erro ao criar post",description:o.message,variant:"destructive"})}finally{r(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(p,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:D?"Editar Postagem":"Nova Postagem"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:D?"Atualize o conteÃºdo da postagem":"Compartilhe conteÃºdo com seus alunos"})]}),e.jsx("button",{onClick:P,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(ze,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Tipo de ConteÃºdo"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:A.map(m=>{const o=m.icon;return e.jsx("button",{type:"button",onClick:()=>$(m.id),className:`p-4 rounded-lg border-2 text-left transition-all ${c===m.id?"border-blue-600 bg-blue-50 dark:bg-blue-950":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:`w-5 h-5 ${c===m.id?"text-blue-600":"text-slate-600"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:m.label}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:m.desc})]})]})},m.id)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["TÃ­tulo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:j.title,onChange:m=>d({...j,title:m.target.value}),placeholder:"Ex: Material sobre FunÃ§Ãµes QuadrÃ¡ticas",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:200,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[j.title.length,"/200"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["ConteÃºdo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:j.content,onChange:m=>d({...j,content:m.target.value}),placeholder:"Escreva o conteÃºdo da postagem...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:2e3,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[j.content.length,"/2000"]})]}),c==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Link do VÃ­deo"}),e.jsx("input",{type:"url",value:j.link,onChange:m=>d({...j,link:m.target.value}),placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),c==="link"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"URL do Link"}),e.jsx("input",{type:"url",value:j.link,onChange:m=>d({...j,link:m.target.value}),placeholder:"https://exemplo.com/artigo",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),c==="image"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Upload de Imagem"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(bs,{className:"w-12 h-12 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Arraste uma imagem ou clique para selecionar"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"image-upload",onChange:m=>d({...j,file:m.target.files[0]})}),e.jsx(q,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>document.getElementById("image-upload").click(),children:"Selecionar Arquivo"}),j.file&&e.jsx("p",{className:"text-sm text-green-600 mt-2",children:j.file.name})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(q,{type:"button",variant:"outline",onClick:P,className:"flex-1",disabled:N,children:"Cancelar"}),e.jsx(q,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600",disabled:N,children:N?"Publicando...":"Publicar"})]})]})]})}):null},Ys=({classId:n})=>{const[P,M]=a.useState(!1),[S,D]=a.useState(!0),[N,r]=a.useState([]),[c,$]=a.useState("all"),[j,d]=a.useState({isOpen:!1,id:null,title:""}),[A,v]=a.useState(null),[m,o]=a.useState({});a.useEffect(()=>{u()},[n]),a.useEffect(()=>{N.length>0&&f()},[N]);const u=async()=>{try{D(!0);const{data:t,error:x}=await b.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",n).order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(x)throw x;r(t||[])}catch(t){B.error("Erro ao carregar posts:",t),g({title:"Erro ao carregar posts",description:t.message,variant:"destructive"})}finally{D(!1)}},f=async()=>{try{const t=N.map(y=>y.id),{data:x}=await b.from("post_likes").select("post_id, user_id, profiles!post_likes_user_id_fkey(full_name, avatar_url)").in("post_id",t),{data:F}=await b.from("post_views").select("post_id, user_id").in("post_id",t),{data:s}=await b.from("post_comments").select("post_id, id").in("post_id",t).is("parent_comment_id",null),_={};t.forEach(y=>{_[y]={likes:x?.filter(U=>U.post_id===y)||[],views:F?.filter(U=>U.post_id===y)||[],comments:s?.filter(U=>U.post_id===y)||[]}}),o(_)}catch(t){B.error("Erro ao carregar engagement:",t)}},z=()=>{M(!1),v(null),u()},V=t=>{t.file_url?window.open(t.file_url,"_blank"):g({title:"ConteÃºdo nÃ£o disponÃ­vel",description:"Este post nÃ£o possui arquivo ou link associado"})},L=t=>{v(t),M(!0)},G=async t=>{try{const x=!t.is_pinned,{error:F}=await b.from("class_materials").update({is_pinned:x}).eq("id",t.id);if(F)throw F;g({title:x?"âœ… Post fixado!":"âœ… Post desafixado!",description:x?"Este post agora aparece no topo do mural.":"Este post foi removido do topo."}),u()}catch(x){B.error("Erro ao fixar/desafixar post:",x),g({title:"âŒ Erro",description:"NÃ£o foi possÃ­vel alterar o status do post.",variant:"destructive"})}},R=t=>{t.file_url?window.open(t.file_url,"_blank"):g({title:"Arquivo nÃ£o disponÃ­vel",variant:"destructive"})},k=(t,x)=>{d({isOpen:!0,id:t,title:x})},C=async()=>{const{id:t,title:x}=j;try{const{error:F}=await b.from("class_materials").delete().eq("id",t);if(F)throw F;g({title:"âœ… Post deletado",description:`"${x}" foi removido com sucesso.`}),u()}catch(F){B.error("Erro ao deletar post:",F),g({title:"âŒ Erro ao deletar post",description:F.message,variant:"destructive"})}},O=t=>t?t.includes("video")?Ie:t.includes("image")?Ue:t.includes("pdf")?X:Qe:X,l=t=>t?t.includes("video")?"bg-purple-100 text-purple-700":t.includes("image")?"bg-pink-100 text-pink-700":t.includes("pdf")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700",E=()=>c==="all"?N:N.filter(t=>{if(!t.file_type)return!1;switch(c){case"video":return t.file_type.includes("video");case"image":return t.file_type.includes("image");case"pdf":return t.file_type.includes("pdf");case"link":return t.file_type==="link";default:return!0}});if(S)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})});const Z=E();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Mural de ConteÃºdo"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[Z.length," de ",N.length," posts"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(le,{value:c,onValueChange:$,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filtrar por tipo"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todos os Tipos"}),e.jsx(T,{value:"video",children:"ðŸ“¹ VÃ­deos"}),e.jsx(T,{value:"pdf",children:"ðŸ“„ PDFs"}),e.jsx(T,{value:"image",children:"ðŸ–¼ï¸ Imagens"}),e.jsx(T,{value:"link",children:"ðŸ”— Links"})]})]}),e.jsxs(q,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>M(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Nova Postagem"]})]})]}),Z.length===0?e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(X,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:N.length===0?"Nenhum conteÃºdo postado ainda":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:N.length===0?"Compartilhe materiais, vÃ­deos e links com seus alunos":"Ajuste o filtro para ver mais resultados."}),N.length===0&&e.jsxs(q,{onClick:()=>M(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Criar Primeira Postagem"]})]}):e.jsx("div",{className:"space-y-4",children:Z.map((t,x)=>{const F=O(t.file_type);return e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.05},children:e.jsxs(p,{className:`p-6 hover:shadow-lg transition-all ${t.is_pinned?"border-2 border-amber-400 bg-amber-50/50 dark:bg-amber-950/20":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsxs(vs,{className:"w-10 h-10",children:[e.jsx(fs,{src:t.creator?.avatar_url}),e.jsx(js,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white",children:t.creator?.full_name?.[0]||"P"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold",children:t.creator?.full_name||"Professor"}),t.is_pinned&&e.jsxs(K,{className:"bg-amber-500 text-white text-xs",children:[e.jsx(ss,{className:"w-3 h-3 mr-1"}),"Fixado"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"â€¢"}),e.jsx("span",{className:"text-sm text-slate-500",children:ye(new Date(t.created_at),{locale:ge,addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{className:l(t.file_type),children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),t.file_type?.split("/")[0]||"Arquivo"]}),t.category&&e.jsx(K,{variant:"outline",className:"text-xs",children:t.category})]})]})]}),e.jsxs(ke,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(q,{variant:"ghost",size:"sm",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(_e,{align:"end",children:[e.jsxs(H,{onClick:()=>V(t),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(H,{onClick:()=>R(t),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Baixar Arquivo"]}),e.jsxs(H,{onClick:()=>L(t),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Editar Post"]}),e.jsxs(H,{onClick:()=>G(t),children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),t.is_pinned?"Desafixar":"Fixar no Topo"]}),e.jsx(Se,{}),e.jsxs(H,{className:"text-red-600 dark:text-red-400",onClick:()=>k(t.id,t.title),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Deletar Post"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:t.title}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 line-clamp-3",children:t.description||"Sem descriÃ§Ã£o"})]}),t.file_type?.includes("image")&&t.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:t.file_url,alt:t.title,className:"w-full max-h-96 object-contain cursor-pointer",onClick:()=>window.open(t.file_url,"_blank")})}),t.file_type?.includes("video")&&t.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:t.file_url.includes("youtube")||t.file_url.includes("youtu.be")?e.jsx("div",{className:"aspect-video",children:e.jsx("iframe",{src:t.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allowFullScreen:!0,title:t.title})}):e.jsx("video",{controls:!0,className:"w-full max-h-96",children:e.jsx("source",{src:t.file_url})})}),t.file_type==="link"&&t.file_url&&e.jsx("a",{href:t.file_url,target:"_blank",rel:"noopener noreferrer",className:"mb-4 block p-4 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-950/40 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-blue-600 hover:underline truncate",children:t.file_url})]})}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:t.tags.map((s,_)=>e.jsxs(K,{variant:"secondary",className:"text-xs",children:["#",s]},_))}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Qs,{className:"w-4 h-4"}),m[t.id]?.likes?.length||0," curtidas"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),m[t.id]?.views?.length||0," visualizaÃ§Ãµes"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(as,{className:"w-4 h-4"}),m[t.id]?.comments?.length||0," comentÃ¡rios"]})]}),t.file_url&&e.jsxs(q,{size:"sm",variant:"outline",onClick:()=>window.open(t.file_url,"_blank"),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Baixar"]})]})]})},t.id)})}),e.jsx(Xs,{isOpen:P,onClose:()=>{M(!1),v(null)},classId:n,onSuccess:z,editingPost:A}),e.jsx(Re,{isOpen:j.isOpen,onClose:()=>d({isOpen:!1,id:null,title:""}),onConfirm:C,title:"Deletar Post",message:`Tem certeza que deseja deletar "${j.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},Js=({isOpen:n,onClose:P,classId:M,onSuccess:S})=>{const[D,N]=a.useState(!1),[r,c]=a.useState({title:"",description:"",urgency:"info"}),$=[{value:"info",label:"ðŸ“˜ InformaÃ§Ã£o",color:"blue",icon:He},{value:"warning",label:"âš ï¸ Aviso",color:"yellow",icon:Xe},{value:"urgent",label:"ðŸ”” Urgente",color:"orange",icon:be},{value:"critical",label:"ðŸš¨ CrÃ­tico",color:"red",icon:he}],j=async v=>{if(v.preventDefault(),!r.title.trim()||!r.description.trim()){g({title:"Campos obrigatÃ³rios",description:"Preencha tÃ­tulo e descriÃ§Ã£o",variant:"destructive"});return}try{N(!0);const{data:{user:m}}=await b.auth.getUser();if(!m)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{error:o}=await b.from("class_materials").insert({class_id:M,title:r.title,description:r.description,category:"announcement",tags:[r.urgency],created_by:m.id,is_public:!1,file_type:"announcement"});if(o)throw o;g({title:"Comunicado criado!",description:"Todos os alunos serÃ£o notificados"}),c({title:"",description:"",urgency:"info"}),S?.(),P()}catch(m){B.error("Erro ao criar comunicado:",m),g({title:"Erro ao criar comunicado",description:m.message,variant:"destructive"})}finally{N(!1)}};if(!n)return null;const d=$.find(v=>v.value===r.urgency),A=d?.icon||He;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(p,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Novo Comunicado"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Envie avisos importantes para todos os alunos"})]}),e.jsx("button",{onClick:P,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(ze,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"NÃ­vel de UrgÃªncia"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:$.map(v=>{const m=v.icon;return e.jsx("button",{type:"button",onClick:()=>c({...r,urgency:v.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${r.urgency===v.value?`border-${v.color}-600 bg-${v.color}-50 dark:bg-${v.color}-950/20`:"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:v.label})]})},v.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"TÃ­tulo do Comunicado"}),e.jsx("input",{type:"text",value:r.title,onChange:v=>c({...r,title:v.target.value}),placeholder:"Ex: AlteraÃ§Ã£o de horÃ¡rio da prova",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Mensagem"}),e.jsx("textarea",{value:r.description,onChange:v=>c({...r,description:v.target.value}),placeholder:"Descreva o comunicado em detalhes...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 border-${d?.color}-200 bg-${d?.color}-50 dark:bg-${d?.color}-950/20`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${d?.color}-100`,children:e.jsx(A,{className:`w-5 h-5 text-${d?.color}-600`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:r.title||"TÃ­tulo do comunicado"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:r.description||"Mensagem do comunicado aparecerÃ¡ aqui..."})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(q,{type:"button",variant:"outline",onClick:P,children:"Cancelar"}),e.jsx(q,{type:"submit",disabled:D,className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",children:D?"Publicando...":"Publicar Comunicado"})]})]})]})})},et=({classId:n})=>{const[P,M]=a.useState(!0),[S,D]=a.useState([]),[N,r]=a.useState("all"),[c,$]=a.useState(!1),[j,d]=a.useState(null),[A,v]=a.useState({isOpen:!1,id:null,title:""}),[m,o]=a.useState({total:0,info:0,warning:0,urgent:0,critical:0});a.useEffect(()=>{u()},[n]);const u=async()=>{try{M(!0);const{data:C,error:O}=await b.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",n).eq("category","announcement").order("created_at",{ascending:!1});if(O)throw O;const l=C||[];o({total:l.length,info:l.filter(E=>(E.tags?.[0]||"info")==="info").length,warning:l.filter(E=>(E.tags?.[0]||"info")==="warning").length,urgent:l.filter(E=>(E.tags?.[0]||"info")==="urgent").length,critical:l.filter(E=>(E.tags?.[0]||"info")==="critical").length}),D(l)}catch(C){B.error("Erro ao carregar comunicados:",C),g({title:"Erro ao carregar comunicados",description:C.message,variant:"destructive"})}finally{M(!1)}},f=C=>{switch(C){case"critical":return{icon:Xe,color:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",borderColor:"border-red-200 dark:border-red-800",label:"CrÃ­tico"};case"urgent":return{icon:is,color:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",borderColor:"border-orange-200 dark:border-orange-800",label:"Urgente"};case"warning":return{icon:he,color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",borderColor:"border-yellow-200 dark:border-yellow-800",label:"Aviso"};default:return{icon:He,color:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",borderColor:"border-blue-200 dark:border-blue-800",label:"InformaÃ§Ã£o"}}},z=async C=>{try{const{data:O,error:l}=await b.from("class_members").select("user_id, profiles!user_id(full_name)").eq("class_id",n).eq("role","student");if(l)throw l;const E=O?.length||0;g({title:`ðŸ“Š ${E} aluno(s)`,description:"Sistema de tracking de leituras serÃ¡ implementado em breve."})}catch(O){B.error("Erro:",O),g({title:"âŒ Erro",description:O.message,variant:"destructive"})}},V=C=>{d(C),$(!0)},L=async C=>{try{const O=!C.is_pinned,{error:l}=await b.from("announcements").update({is_pinned:O}).eq("id",C.id);if(l)throw l;g({title:O?"âœ… Comunicado fixado!":"âœ… Comunicado desafixado!",description:O?"Este comunicado agora aparece no topo.":"Este comunicado foi removido do topo."}),u()}catch(O){B.error("Erro ao fixar/desafixar:",O),g({title:"âŒ Erro",description:O.message,variant:"destructive"})}},G=(C,O)=>{v({isOpen:!0,id:C,title:O})},R=async()=>{const{id:C,title:O}=A;try{const{error:l}=await b.from("class_materials").delete().eq("id",C);if(l)throw l;g({title:"âœ… Comunicado deletado",description:`"${O}" foi removido com sucesso.`}),u()}catch(l){B.error("Erro ao deletar comunicado:",l),g({title:"âŒ Erro ao deletar comunicado",description:l.message,variant:"destructive"})}},k=N==="all"?S:S.filter(C=>(C.tags?.[0]||"info")===N);return P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(p,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(be,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(He,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.info}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Info"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(he,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.warning}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Avisos"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900",children:e.jsx(is,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.urgent}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Urgentes"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(Xe,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CrÃ­ticos"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Comunicados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[k.length," de ",m.total," comunicados"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(le,{value:N,onValueChange:r,children:[e.jsx(ie,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Filtrar urgÃªncia"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todos"}),e.jsx(T,{value:"info",children:"ðŸ“˜ InformaÃ§Ã£o"}),e.jsx(T,{value:"warning",children:"âš ï¸ Aviso"}),e.jsx(T,{value:"urgent",children:"ðŸ”” Urgente"}),e.jsx(T,{value:"critical",children:"ðŸš¨ CrÃ­tico"})]})]}),e.jsxs(q,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",onClick:()=>$(!0),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Novo Comunicado"]})]})]}),k.length===0?e.jsx(p,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:S.length===0?"Nenhum comunicado publicado":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:S.length===0?"Avisos importantes aparecerÃ£o aqui e notificarÃ£o todos os alunos":"Ajuste o filtro para ver mais resultados."}),S.length===0&&e.jsxs(q,{className:"bg-gradient-to-r from-orange-600 to-red-600",onClick:()=>$(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Criar Primeiro Comunicado"]})]})}):e.jsx("div",{className:"space-y-4",children:k.map((C,O)=>{const l=C.tags?.[0]||"info",E=f(l),Z=E.icon;return e.jsx(Y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:O*.05},children:e.jsx(p,{className:`p-6 border-2 ${E.borderColor} hover:shadow-lg transition-all`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${E.color}`,children:e.jsx(Z,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:C.title}),e.jsx(K,{className:E.color,children:E.label})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(te,{className:"w-3 h-3"}),ye(new Date(C.created_at),{locale:ge,addSuffix:!0})]})]}),e.jsxs(ke,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(q,{variant:"ghost",size:"sm",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(_e,{align:"end",children:[e.jsxs(H,{onClick:()=>z(),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Ver Leituras"]}),e.jsxs(H,{onClick:()=>V(C),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(H,{onClick:()=>L(C),children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),"Fixar no Topo"]}),e.jsx(Se,{}),e.jsxs(H,{className:"text-red-600",onClick:()=>G(C.id,C.title),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 mb-3",children:C.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),"Todos os alunos"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"0 leituras"]})]})]})]})})},C.id)})}),e.jsx(Js,{isOpen:c,onClose:()=>{$(!1),d(null)},classId:n,editingAnnouncement:j,onSuccess:u}),e.jsx(Re,{isOpen:A.isOpen,onClose:()=>v({isOpen:!1,id:null,title:""}),onConfirm:R,title:"Deletar Comunicado",message:`Tem certeza que deseja deletar "${A.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},st=({isOpen:n,onClose:P,classId:M,onSuccess:S})=>{const[D,N]=a.useState(!1),[r,c]=a.useState({title:"",description:"",category:"aulas",file:null,fileUrl:""}),$=[{value:"aulas",label:"ðŸ“š Aulas e Slides"},{value:"exercicios",label:"ðŸ“ ExercÃ­cios"},{value:"referencias",label:"ðŸ“– ReferÃªncias"},{value:"complementar",label:"âž• Material Complementar"}],j=A=>{const v=A.target.files[0];v&&c({...r,file:v,title:r.title||v.name})},d=async A=>{if(A.preventDefault(),!r.title.trim()){g({title:"TÃ­tulo obrigatÃ³rio",description:"Digite um tÃ­tulo para o material",variant:"destructive"});return}if(!r.file&&!r.fileUrl.trim()){g({title:"Arquivo ou link obrigatÃ³rio",description:"FaÃ§a upload de um arquivo ou cole um link",variant:"destructive"});return}try{N(!0);const{data:{user:v}}=await b.auth.getUser();if(!v)throw new Error("UsuÃ¡rio nÃ£o autenticado");let m=r.fileUrl,o="link",u=null;if(r.file){const z=`${Date.now()}_${r.file.name}`,V=`${M}/${z}`,{error:L}=await b.storage.from("class-materials").upload(V,r.file);if(L)throw L;const{data:{publicUrl:G}}=b.storage.from("class-materials").getPublicUrl(V);m=G,o=r.file.type,u=r.file.size}const{error:f}=await b.from("class_materials").insert({class_id:M,title:r.title,description:r.description||null,file_url:m,file_type:o,file_size:u,category:r.category,created_by:v.id,is_public:!1});if(f)throw f;g({title:"Material adicionado!",description:"O material estÃ¡ disponÃ­vel na biblioteca"}),c({title:"",description:"",category:"aulas",file:null,fileUrl:""}),S?.(),P()}catch(v){B.error("Erro ao adicionar material:",v),g({title:"Erro ao adicionar material",description:v.message,variant:"destructive"})}finally{N(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(p,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Material"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Compartilhe arquivos e recursos com seus alunos"})]}),e.jsx("button",{onClick:P,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(ze,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"TÃ­tulo do Material"}),e.jsx("input",{type:"text",value:r.title,onChange:A=>c({...r,title:A.target.value}),placeholder:"Ex: Slides da Aula 1 - IntroduÃ§Ã£o",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Categoria"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:$.map(A=>e.jsx("button",{type:"button",onClick:()=>c({...r,category:A.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${r.category===A.value?"border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsx("span",{className:"font-medium text-sm",children:A.label})},A.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Arquivo ou Link"}),e.jsx("div",{children:e.jsx("label",{className:"block",children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${r.file?"border-green-500 bg-green-50 dark:bg-green-950/20":"border-slate-300 dark:border-slate-700 hover:border-blue-600"}`,children:[r.file?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"text-sm font-medium mb-1 text-green-700 dark:text-green-300",children:["âœ“ ",r.file.name]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[(r.file.size/1024/1024).toFixed(2)," MB"]}),e.jsx("button",{type:"button",onClick:A=>{A.preventDefault(),c({...r,file:null,title:""})},className:"mt-2 text-xs text-red-600 hover:underline",children:"Remover arquivo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(bs,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),e.jsx("div",{className:"text-sm font-medium mb-1",children:"Clique para fazer upload"}),e.jsx("div",{className:"text-xs text-slate-500",children:"PDF, DOC, PPT, Imagens, VÃ­deos (mÃ¡x 50MB)"})]}),e.jsx("input",{type:"file",onChange:j,className:"hidden",accept:".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.mp4,.avi"})]})})}),e.jsx("div",{className:"text-center text-sm text-slate-500",children:"OU"}),e.jsx("div",{children:e.jsx("input",{type:"url",value:r.fileUrl,onChange:A=>c({...r,fileUrl:A.target.value}),placeholder:"Cole um link (Google Drive, YouTube, etc)",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"DescriÃ§Ã£o (opcional)"}),e.jsx("textarea",{value:r.description,onChange:A=>c({...r,description:A.target.value}),placeholder:"Adicione informaÃ§Ãµes sobre o material...",rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(q,{type:"button",variant:"outline",onClick:P,children:"Cancelar"}),e.jsx(q,{type:"submit",disabled:D,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:D?"Adicionando...":"Adicionar Material"})]})]})]})}):null},tt=({classId:n})=>{const[P,M]=a.useState(!0),[S,D]=a.useState([]),[N,r]=a.useState(""),[c,$]=a.useState("all"),[j,d]=a.useState("all"),[A,v]=a.useState(!1),[m,o]=a.useState(!1),[u,f]=a.useState({total:0,pdfs:0,videos:0,images:0,others:0}),[z,V]=a.useState({isOpen:!1,id:null,title:""});a.useEffect(()=>{L()},[n]);const L=async()=>{try{M(!0);const{data:x,error:F}=await b.from("class_materials").select(`
          *,
          uploader:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",n).neq("category","announcement").order("created_at",{ascending:!1});if(F)throw F;const s=x||[];f({total:s.length,pdfs:s.filter(_=>_.file_type?.includes("pdf")).length,videos:s.filter(_=>_.file_type?.includes("video")).length,images:s.filter(_=>_.file_type?.includes("image")).length,others:s.filter(_=>!_.file_type?.includes("pdf")&&!_.file_type?.includes("video")&&!_.file_type?.includes("image")).length}),D(s)}catch(x){B.error("Erro ao carregar materiais:",x),g({title:"Erro ao carregar materiais",description:x.message,variant:"destructive"})}finally{M(!1)}},G=x=>{x.file_url?window.open(x.file_url,"_blank"):g({title:"Arquivo nÃ£o disponÃ­vel",description:"Este material nÃ£o possui arquivo associado",variant:"destructive"})},R=x=>{g({title:"Em desenvolvimento",description:"FunÃ§Ã£o de ediÃ§Ã£o serÃ¡ implementada em breve"})},k=(x,F)=>{V({isOpen:!0,id:x,title:F})},C=async()=>{const{id:x,title:F}=z;try{const{error:s}=await b.from("class_materials").delete().eq("id",x);if(s)throw s;g({title:"âœ… Material deletado",description:`"${F}" foi removido com sucesso.`}),L()}catch(s){B.error("Erro ao deletar material:",s),g({title:"âŒ Erro ao deletar material",description:s.message,variant:"destructive"})}},O=x=>x?x.includes("video")?Ie:x.includes("image")?Ue:x.includes("pdf")?X:X:X,l=x=>x?x.includes("video")?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":x.includes("image")?"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300":x.includes("pdf")?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"bg-slate-100 text-slate-700",E=x=>{if(!x)return"N/A";const F=x/(1024*1024);return F<1?`${(x/1024).toFixed(0)} KB`:`${F.toFixed(1)} MB`},Z=S.filter(x=>{if(N){const F=N.toLowerCase();if(!x.title?.toLowerCase().includes(F)&&!x.description?.toLowerCase().includes(F))return!1}return!(c!=="all"&&x.category!==c||j!=="all"&&(j==="pdf"&&!x.file_type?.includes("pdf")||j==="video"&&!x.file_type?.includes("video")||j==="image"&&!x.file_type?.includes("image")))}),t=Z.reduce((x,F)=>{const s=F.category||"Sem Categoria";return x[s]||(x[s]=[]),x[s].push(F),x},{});return P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(p,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Ye,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(X,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.pdfs}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"PDFs"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(Ie,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.videos}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"VÃ­deos"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-pink-200 dark:border-pink-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-pink-100 dark:bg-pink-900",children:e.jsx(Ue,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.images}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Imagens"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(Le,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.others}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Outros"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Biblioteca de Materiais"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[Z.length," de ",u.total," materiais"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>{g({title:"Em desenvolvimento",description:"FunÃ§Ã£o de mÃ³dulos serÃ¡ implementada em breve"})},children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Novo MÃ³dulo"]}),e.jsxs(q,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>o(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Adicionar Material"]})]})]}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(pe,{placeholder:"Buscar material...",value:N,onChange:x=>r(x.target.value),className:"pl-10"})]})}),e.jsxs(le,{value:j,onValueChange:d,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Tipo"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todos os Tipos"}),e.jsx(T,{value:"pdf",children:"ðŸ“„ PDFs"}),e.jsx(T,{value:"video",children:"ðŸ“¹ VÃ­deos"}),e.jsx(T,{value:"image",children:"ðŸ–¼ï¸ Imagens"})]})]}),e.jsxs(le,{value:c,onValueChange:$,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Categoria"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todas Categorias"}),e.jsx(T,{value:"aulas",children:"Aulas"}),e.jsx(T,{value:"exercicios",children:"ExercÃ­cios"}),e.jsx(T,{value:"referencias",children:"ReferÃªncias"}),e.jsx(T,{value:"complementar",children:"Material Complementar"})]})]})]})}),Z.length===0?e.jsx(p,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ye,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:S.length===0?"Biblioteca Vazia":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:S.length===0?"Comece organizando seus materiais em mÃ³dulos e tÃ³picos":"Ajuste os filtros para ver mais resultados."}),S.length===0&&e.jsxs(q,{children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Criar Primeiro MÃ³dulo"]})]})}):e.jsx("div",{className:"space-y-6",children:Object.entries(t).map(([x,F])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Le,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:x}),e.jsx(K,{variant:"secondary",children:F.length})]}),e.jsx("div",{className:"space-y-3 ml-6",children:F.map((s,_)=>{const y=O(s.file_type),U=l(s.file_type);return e.jsx(Y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:_*.05},children:e.jsxs(p,{className:"p-4 hover:shadow-md transition-shadow",children:[s.file_url&&s.file_type?.includes("image")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:s.file_url,alt:s.title,className:"w-full max-h-64 object-contain cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(s.file_url,"_blank")})}),s.file_url&&s.file_type?.includes("video")&&!s.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsxs("video",{controls:!0,className:"w-full max-h-64",children:[e.jsx("source",{src:s.file_url}),"Seu navegador nÃ£o suporta vÃ­deos."]})}),s.file_url&&s.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800 aspect-video",children:e.jsx("iframe",{src:s.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${U}`,children:e.jsx(y,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-1",children:s.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsx("span",{children:E(s.file_size)}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),ye(new Date(s.created_at),{locale:ge,addSuffix:!0})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex gap-1",children:s.tags.slice(0,2).map((W,xe)=>e.jsx(K,{variant:"outline",className:"text-xs",children:W},xe))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.file_url&&e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>window.open(s.file_url,"_blank"),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Baixar"]}),e.jsxs(ke,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(q,{variant:"ghost",size:"sm",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(_e,{align:"end",children:[e.jsxs(H,{onClick:()=>G(s),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Visualizar"]}),e.jsxs(H,{onClick:()=>R(),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsx(Se,{}),e.jsxs(H,{className:"text-red-600",onClick:()=>k(s.id,s.title),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})]})},s.id)})})]},x))}),e.jsx(st,{isOpen:m,onClose:()=>o(!1),classId:n,onSuccess:L}),e.jsx(Re,{isOpen:z.isOpen,onClose:()=>V({isOpen:!1,id:null,title:""}),onConfirm:C,title:"Deletar Material",message:`Tem certeza que deseja deletar "${z.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},at=({isOpen:n,onClose:P,classId:M,onSuccess:S})=>{const[D,N]=a.useState(!1),[r,c]=a.useState([]),[$,j]=a.useState(""),[d,A]=a.useState(null);a.useEffect(()=>{n&&v()},[n]);const v=async()=>{try{N(!0);const{data:{user:u}}=await b.auth.getUser();if(!u)return;const{data:f,error:z}=await b.from("activities").select("*").eq("created_by",u.id).order("created_at",{ascending:!1});if(z)throw z;const{data:V,error:L}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",M);if(L)throw L;const G=V.map(k=>k.activity_id),R=f.filter(k=>!G.includes(k.id));c(R)}catch(u){B.error("Erro ao carregar atividades:",u),g({title:"Erro ao carregar",description:u.message,variant:"destructive"})}finally{N(!1)}},m=async()=>{if(!d){g({title:"Selecione uma atividade",description:"Escolha uma atividade para postar na turma",variant:"destructive"});return}try{N(!0);const{error:u}=await b.from("activities").update({is_published:!0,is_draft:!1,status:d.status==="archived"?d.status:"active",updated_at:new Date().toISOString()}).eq("id",d.id);if(u)throw u;const{error:f}=await b.from("activity_class_assignments").insert({activity_id:d.id,class_id:M,assigned_at:new Date().toISOString()});if(f)throw f;const{error:z}=await b.from("classes").update({updated_at:new Date().toISOString()}).eq("id",M);z&&B.warn("Erro ao atualizar updated_at da turma ao postar atividade existente:",z),g({title:"âœ… Atividade postada!",description:`"${d.title}" foi adicionada Ã  turma`}),S?.(),P()}catch(u){B.error("Erro ao postar atividade:",u),g({title:"Erro ao postar",description:u.message,variant:"destructive"})}finally{N(!1)}};if(!n)return null;const o=r.filter(u=>u.title?.toLowerCase().includes($.toLowerCase())||u.description?.toLowerCase().includes($.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(p,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Postar Atividade Existente"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha uma atividade criada anteriormente"})]}),e.jsx("button",{onClick:P,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(ze,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(pe,{placeholder:"Buscar atividades...",value:$,onChange:u=>j(u.target.value),className:"pl-10"})]}),D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r.length===0?"Nenhuma atividade disponÃ­vel":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:r.length===0?"Crie atividades primeiro para poder postÃ¡-las aqui":"Tente buscar por outro termo"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:o.map(u=>e.jsx(p,{className:`p-4 cursor-pointer transition-all hover:shadow-md ${d?.id===u.id?"border-2 border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border hover:border-blue-300"}`,onClick:()=>A(u),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:u.title}),e.jsx(K,{variant:u.status==="active"?"default":"secondary",children:u.status==="active"?"Publicada":"Rascunho"})]}),u.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:u.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[u.due_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),"Prazo: ",Ne(new Date(u.due_date),"dd/MM/yyyy 'Ã s' HH:mm",{locale:ge})]}),u.max_grade&&e.jsxs("span",{children:["Nota: ",u.max_grade," pts"]})]})]}),d?.id===u.id&&e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-white"})})})]})},u.id))}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t dark:border-slate-700",children:[e.jsx(q,{type:"button",variant:"outline",onClick:P,children:"Cancelar"}),e.jsx(q,{onClick:m,disabled:D||!d,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:D?"Postando...":"Postar Atividade"})]})]})]})})},rt=({classId:n})=>{const P=ts(),[M,S]=a.useState(!0),[D,N]=a.useState([]),[r,c]=a.useState({isOpen:!1,id:null,title:""}),[$,j]=a.useState(""),[d,A]=a.useState("all"),[v,m]=a.useState("all"),[o,u]=a.useState("all"),[f,z]=a.useState("recent"),[V,L]=a.useState(!1),[G,R]=a.useState({total:0,published:0,draft:0,overdue:0,pendingCorrections:0}),[k,C]=a.useState({isOpen:!1,activityId:null,dueDate:"",dueTime:"23:59"}),[O,l]=a.useState(!1);a.useEffect(()=>{E()},[n]);const E=async()=>{try{S(!0);const{data:i,error:h}=await b.from("activity_class_assignments").select(`
          id,
          assigned_at,
          activity:activities(
            id,
            title,
            description,
            type,
            due_date,
            max_score,
            status,
            created_at
          )
        `).eq("class_id",n).order("assigned_at",{ascending:!1});if(h)throw h;const{count:w}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student"),I=await Promise.all((i||[]).map(async Q=>{const ee=Q.activity?.id;if(!ee)return{...Q,submissionsCount:0,totalStudents:w||0,pendingCorrections:0,avgGrade:null,submissionRate:0};const{data:se}=await b.from("class_members").select("user_id").eq("class_id",n).eq("role","student"),Oe=se?.map(re=>re.user_id)||[];let $e=[];if(Oe.length>0){const{data:re}=await b.from("submissions").select("id, status, grade").eq("activity_id",ee).in("student_id",Oe);$e=re||[]}const rs=$e?.length||0,ys=$e?.filter(re=>re.status==="submitted").length||0,Ze=$e?.filter(re=>re.grade!==null).map(re=>parseFloat(re.grade))||[],ws=Ze.length>0?Ze.reduce((re,Cs)=>re+Cs,0)/Ze.length:null,ks=w>0?rs/w*100:0;return{...Q,submissionsCount:rs,totalStudents:w||0,pendingCorrections:ys,avgGrade:ws,submissionRate:ks}})),J=new Date,ae={total:I.length,published:I.filter(Q=>{const ee=Q.activity?.status;return ee==="published"||ee==="active"}).length,draft:I.filter(Q=>{const ee=Q.activity?.status;return!ee||ee==="draft"}).length,overdue:I.filter(Q=>Q.activity?.due_date&&Be(new Date(Q.activity.due_date))&&!fe(new Date(Q.activity.due_date))).length,pendingCorrections:I.reduce((Q,ee)=>Q+(ee.pendingCorrections||0),0)};N(I),R(ae)}catch(i){B.error("Erro ao carregar atividades:",i),g({title:"Erro ao carregar atividades",description:i.message,variant:"destructive"}),N([])}finally{S(!1)}},Z=()=>{let i=D;if($){const h=$.toLowerCase();i=i.filter(w=>w.activity?.title?.toLowerCase().includes(h)||w.activity?.description?.toLowerCase().includes(h))}if(d!=="all"&&(i=i.filter(h=>{const w=h.activity?.status;return d==="published"?w==="published"||w==="active":d==="draft"?!w||w==="draft":d==="pending_correction"?h.pendingCorrections>0:!0})),v!=="all"&&(i=i.filter(h=>h.activity?.type===v)),o!=="all"){const h=new Date;i=i.filter(w=>{if(!w.activity?.due_date)return o==="no_deadline";const I=new Date(w.activity.due_date);switch(o){case"overdue":return Be(I)&&!fe(I);case"today":return fe(I);case"tomorrow":return Ke(I);case"week":return Zs(I)&&I<=new Date(h.getTime()+10080*60*1e3);default:return!0}})}return i.sort((h,w)=>{switch(f){case"recent":return new Date(w.assigned_at)-new Date(h.assigned_at);case"deadline":return h.activity?.due_date?w.activity?.due_date?new Date(h.activity.due_date)-new Date(w.activity.due_date):-1:1;case"submissions":return w.submissionsCount-h.submissionsCount;case"corrections":return w.pendingCorrections-h.pendingCorrections;case"title":return(h.activity?.title||"").localeCompare(w.activity?.title||"");default:return 0}}),i},t=i=>{if(!i)return"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300";const h=new Date(i);return Be(h)&&!fe(h)?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":fe(h)||Ke(h)?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"},x=i=>{if(!i)return"Sem prazo";const h=new Date(i);return fe(h)?`Hoje Ã s ${Ne(h,"HH:mm")}`:Ke(h)?`AmanhÃ£ Ã s ${Ne(h,"HH:mm")}`:Be(h)?`Atrasado - ${Ne(h,"dd/MM/yyyy")}`:ye(h,{locale:ge,addSuffix:!0})},F=i=>{if(i)try{let h="",w="23:59";if(i.due_date){const J=new Date(i.due_date).toISOString();h=J.split("T")[0],w=J.substring(11,16)}else h=new Date().toISOString().split("T")[0];C({isOpen:!0,activityId:i.id,dueDate:h,dueTime:w||"23:59"})}catch(h){B.error("Erro ao preparar ediÃ§Ã£o de prazo:",h),g({title:"Erro ao carregar prazo",description:"NÃ£o foi possÃ­vel carregar a data de entrega atual.",variant:"destructive"})}},s=async()=>{if(!k.activityId||!k.dueDate){g({title:"Data obrigatÃ³ria",description:"Defina uma data de entrega para salvar.",variant:"destructive"});return}try{l(!0);const i=k.dueTime||"23:59",h=`${k.dueDate}T${i}:00`,{error:w}=await b.from("activities").update({due_date:h}).eq("id",k.activityId);if(w)throw w;g({title:"Prazo atualizado",description:"A data de entrega da atividade foi atualizada."}),C(I=>({...I,isOpen:!1})),await E()}catch(i){B.error("Erro ao salvar novo prazo da atividade:",i),g({title:"Erro ao atualizar prazo",description:i.message,variant:"destructive"})}finally{l(!1)}},_=async i=>{try{const{data:h,error:w}=await b.from("submissions").select(`
          *,
          student:profiles!student_id(full_name, email)
        `).eq("activity_id",i.id).not("grade","is",null);if(w)throw w;if(!h||h.length===0){g({title:"Sem notas",description:"Esta atividade ainda nÃ£o possui notas lanÃ§adas.",variant:"destructive"});return}const I=[["Aluno","Email","Nota","Data de Envio","Data de CorreÃ§Ã£o"],...h.map(Q=>[Q.student?.full_name||"Sem nome",Q.student?.email||"",Q.grade||"0",Q.submitted_at?new Date(Q.submitted_at).toLocaleDateString("pt-BR"):"-",Q.graded_at?new Date(Q.graded_at).toLocaleDateString("pt-BR"):"-"])].map(Q=>Q.join(",")).join(`
`),J=new Blob([I],{type:"text/csv;charset=utf-8;"}),ae=document.createElement("a");ae.href=URL.createObjectURL(J),ae.download=`notas_${i.title.replace(/[^a-z0-9]/gi,"_")}.csv`,ae.click(),g({title:"âœ… Notas exportadas!",description:`${h.length} nota(s) exportada(s) em CSV.`})}catch(h){B.error("Erro ao exportar notas:",h),g({title:"âŒ Erro ao exportar",description:h.message,variant:"destructive"})}},y=async i=>{try{const{error:h}=await b.from("activities").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",i.id);if(h)throw h;g({title:"âœ… Atividade arquivada!",description:"A atividade foi movida para arquivados."}),E()}catch(h){B.error("Erro ao arquivar atividade:",h),g({title:"âŒ Erro ao arquivar",description:h.message,variant:"destructive"})}},U=(i,h)=>{c({isOpen:!0,id:i,title:h})},W=async()=>{const{id:i,title:h}=r;if(!i){g({title:"âŒ Erro",description:"ID da atividade nÃ£o encontrado.",variant:"destructive"}),c({isOpen:!1,id:null,title:""});return}try{const{error:w}=await b.from("activity_class_assignments").delete().eq("activity_id",i).eq("class_id",n);if(w)throw w;g({title:"âœ… Atividade removida",description:`"${h}" foi removida da turma com sucesso.`}),c({isOpen:!1,id:null,title:""}),E()}catch(w){B.error("Erro ao deletar atividade:",w),g({title:"âŒ Erro ao deletar atividade",description:w.message,variant:"destructive"}),c({isOpen:!1,id:null,title:""})}};if(M)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})});const xe=Z();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(p,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Je,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(oe,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.published}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Publicadas"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(X,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.draft}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Rascunhos"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(Te,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.overdue}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Atrasadas"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(he,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"P/ Corrigir"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atividades da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[xe.length," de ",G.total," atividades"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>L(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Postar Existente"]}),e.jsxs(q,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>P(`/atividades/criar?classId=${n}`),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Nova Atividade"]})]})]}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(pe,{placeholder:"Buscar atividade...",value:$,onChange:i=>j(i.target.value),className:"pl-10"})]})}),e.jsxs(le,{value:d,onValueChange:A,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Status"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todos os Status"}),e.jsx(T,{value:"published",children:"Publicadas"}),e.jsx(T,{value:"draft",children:"Rascunhos"}),e.jsx(T,{value:"pending_correction",children:"Pendentes"})]})]}),e.jsxs(le,{value:o,onValueChange:u,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Prazo"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todos os Prazos"}),e.jsx(T,{value:"overdue",children:"Atrasadas"}),e.jsx(T,{value:"today",children:"Hoje"}),e.jsx(T,{value:"tomorrow",children:"AmanhÃ£"}),e.jsx(T,{value:"week",children:"Esta Semana"}),e.jsx(T,{value:"no_deadline",children:"Sem Prazo"})]})]}),e.jsxs(le,{value:f,onValueChange:z,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Ordenar"})}),e.jsxs(de,{children:[e.jsx(T,{value:"recent",children:"Mais Recentes"}),e.jsx(T,{value:"deadline",children:"Prazo (prÃ³ximo)"}),e.jsx(T,{value:"submissions",children:"SubmissÃµes"}),e.jsx(T,{value:"corrections",children:"CorreÃ§Ãµes"}),e.jsx(T,{value:"title",children:"TÃ­tulo (A-Z)"})]})]})]})}),xe.length===0?e.jsx(p,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Je,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:D.length===0?"Nenhuma atividade postada":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:D.length===0?"Crie ou poste uma atividade para comeÃ§ar.":"Ajuste os filtros para ver mais resultados."}),D.length===0&&e.jsxs(q,{onClick:()=>P(`/dashboard/activities/create?classId=${n}`),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Criar Primeira Atividade"]})]})}):e.jsx("div",{className:"space-y-3",children:xe.map((i,h)=>{const w=i.activity,I=i.submissionRate>=80?"text-green-600":i.submissionRate>=50?"text-yellow-600":"text-red-600";return e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:h*.05},children:e.jsx(p,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:w?.title||"Sem tÃ­tulo"}),w&&(!w.status||w.status==="draft")&&e.jsx(K,{variant:"secondary",className:"text-xs",children:"Rascunho"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:w?.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(K,{variant:"outline",className:"text-xs",children:w?.type==="assignment"?"Trabalho":w?.type==="quiz"?"Quiz":w?.type==="exam"?"Prova":w?.type||"Atividade"}),e.jsxs(K,{className:`text-xs ${t(w?.due_date)}`,children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),x(w?.due_date)]}),e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),"Postado ",ye(new Date(i.assigned_at),{locale:ge,addSuffix:!0})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ce,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:`text-sm font-semibold ${I}`,children:[i.submissionRate.toFixed(0),"%"]})]}),e.jsx(je,{value:i.submissionRate,className:"h-2 mb-1"}),e.jsxs("div",{className:"text-xs text-slate-500",children:[i.submissionsCount,"/",i.totalStudents," submissÃµes"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${i.pendingCorrections>0?"text-yellow-600":"text-green-600"}`,children:i.pendingCorrections}),e.jsx("div",{className:"text-xs text-slate-500",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.avgGrade?.toFixed(1)||"â€”"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>P(`/dashboard/activities/${w?.id}/submissions`),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Ver SubmissÃµes"]}),e.jsxs(ke,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(q,{variant:"ghost",size:"sm",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(_e,{align:"end",children:[e.jsxs(H,{onClick:()=>P(`/dashboard/activities/${w?.id}/edit`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Editar Atividade"]}),e.jsxs(H,{onClick:()=>F(w),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Editar Prazo"]}),e.jsxs(H,{onClick:()=>_(w),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Exportar Notas"]}),e.jsx(Se,{}),e.jsxs(H,{onClick:()=>y(w),children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Arquivar"]}),e.jsxs(H,{className:"text-red-600 dark:text-red-400",onClick:()=>{const J=i?.activity?.id,ae=i?.activity?.title||"Atividade";B.debug("[ActivitiesTab] Delete clicked:",{activityId:J,activityTitle:ae,fullAssignment:i}),U(J,ae)},children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})})},i.id)})}),e.jsx(at,{isOpen:V,onClose:()=>L(!1),classId:n,onSuccess:E}),e.jsx(xs,{open:k.isOpen,onOpenChange:i=>{i||C(h=>({...h,isOpen:!1}))},children:e.jsxs(us,{className:"max-w-md",children:[e.jsx(hs,{children:e.jsx(gs,{children:"Editar prazo da atividade"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ee,{htmlFor:"edit-due-date",children:[e.jsx(te,{className:"w-4 h-4 inline mr-1"}),"Data de Entrega"]}),e.jsx(pe,{id:"edit-due-date",type:"date",value:k.dueDate,onChange:i=>C(h=>({...h,dueDate:i.target.value})),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ee,{htmlFor:"edit-due-time",children:[e.jsx(Te,{className:"w-4 h-4 inline mr-1"}),"Hora"]}),e.jsx(pe,{id:"edit-due-time",type:"time",value:k.dueTime,onChange:i=>C(h=>({...h,dueTime:i.target.value}))})]})]}),e.jsxs(ps,{children:[e.jsx(q,{variant:"outline",onClick:()=>C(i=>({...i,isOpen:!1})),disabled:O,children:"Cancelar"}),e.jsx(q,{onClick:s,disabled:O||!k.dueDate,children:O?"Salvando...":"Salvar Prazo"})]})]})}),e.jsx(Re,{isOpen:r.isOpen,onClose:()=>c({isOpen:!1,id:null,title:""}),onConfirm:W,title:"Remover Atividade da Turma",message:`Tem certeza que deseja remover "${r.title}" desta turma? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},lt=({isOpen:n,onClose:P,classId:M,classData:S,onSuccess:D})=>{const[N,r]=a.useState(!1),[c,$]=a.useState("email"),[j,d]=a.useState(""),[A,v]=a.useState(""),[m,o]=a.useState(null),u=S?.invite_code?`${window.location.origin}/join/${S.invite_code}`:"",f=async()=>{if(!j.trim()){g({title:"Email obrigatÃ³rio",description:"Digite um email para buscar",variant:"destructive"});return}try{r(!0);const{data:R,error:k}=await b.from("profiles").select("id, full_name, email, avatar_url").eq("email",j.toLowerCase()).eq("role","student").single();if(k||!R){o({found:!1,searched:!0}),g({title:"Aluno nÃ£o encontrado",description:"Email nÃ£o cadastrado no sistema como aluno",variant:"destructive"});return}o({found:!0,user:R})}catch(R){B.error("Erro ao buscar email:",R)}finally{r(!1)}},z=async()=>{if(m?.user)try{r(!0);const{data:R}=await b.from("class_members").select("id").eq("class_id",M).eq("user_id",m.user.id).single();if(R){g({title:"Aluno jÃ¡ estÃ¡ na turma",variant:"destructive"});return}const{data:k,error:C}=await b.from("class_members").insert({class_id:M,user_id:m.user.id,role:"student",joined_at:new Date().toISOString()}).select();if(C)throw C;if(!k||k.length===0)throw new Error("Falha ao adicionar aluno - nenhum registro criado");B.debug("âœ… Aluno adicionado com sucesso:",k[0]);try{await Ve.invalidateClass(M)}catch(O){B.warn("Aviso: Erro ao invalidar cache, mas aluno foi adicionado:",O)}g({title:"âœ… Aluno adicionado com sucesso!",description:`${m.user.full_name} agora faz parte da turma. PeÃ§a para ele fazer logout e login novamente.`}),d(""),o(null),D?.()}catch(R){B.error("Erro ao adicionar aluno:",R),g({title:"Erro ao adicionar aluno",description:R.message,variant:"destructive"})}finally{r(!1)}},V=async()=>{const R=A.split(`
`).map(k=>k.trim()).filter(k=>k&&k.includes("@"));if(R.length===0){g({title:"Nenhum email vÃ¡lido",variant:"destructive"});return}try{r(!0);let k=0,C=0,O=0;for(const l of R){const{data:E}=await b.from("profiles").select("id").eq("email",l.toLowerCase()).eq("role","student").single();if(!E){C++;continue}const{data:Z}=await b.from("class_members").select("id").eq("class_id",M).eq("user_id",E.id).single();if(Z){O++;continue}await b.from("class_members").insert({class_id:M,user_id:E.id,role:"student",joined_at:new Date().toISOString()}),k++}await Ve.invalidateClass(M),g({title:"ImportaÃ§Ã£o concluÃ­da",description:`${k} alunos adicionados, ${C} nÃ£o encontrados, ${O} jÃ¡ eram membros`}),v(""),D?.()}catch(k){B.error("Erro na importaÃ§Ã£o:",k),g({title:"Erro na importaÃ§Ã£o",description:k.message,variant:"destructive"})}finally{r(!1)}},L=()=>{navigator.clipboard.writeText(u),g({title:"Link copiado!",description:"Link de convite copiado para Ã¡rea de transferÃªncia"})},G=()=>{navigator.clipboard.writeText(S.invite_code),g({title:"CÃ³digo copiado!",description:"CÃ³digo de convite copiado"})};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(p,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Aluno"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha um mÃ©todo para adicionar alunos"})]}),e.jsx("button",{onClick:P,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(ze,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex gap-2",children:[{id:"email",label:"Buscar por Email",icon:we},{id:"invite_link",label:"Link de Convite",icon:Qe}].map(R=>{const k=R.icon;return e.jsxs("button",{onClick:()=>$(R.id),className:`flex-1 px-4 py-2 rounded-lg font-medium text-sm transition-all ${c===R.id?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200"}`,children:[e.jsx(k,{className:"w-4 h-4 inline mr-2"}),R.label]},R.id)})}),c==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email do Aluno"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:j,onChange:R=>d(R.target.value),placeholder:"aluno@exemplo.com",className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",onKeyPress:R=>R.key==="Enter"&&f()}),e.jsxs(q,{onClick:f,disabled:N,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),N?"Buscando...":"Buscar"]})]})]}),m?.found&&m.user&&e.jsx(p,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:m.user.full_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:m.user.full_name}),e.jsx("div",{className:"text-sm text-slate-600",children:m.user.email})]})]}),e.jsx(q,{onClick:z,disabled:N,children:N?"Adicionando...":"Adicionar Ã  Turma"})]})}),m?.searched&&!m?.found&&e.jsx(p,{className:"p-4 bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-1",children:"âŒ Email nÃ£o encontrado"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Verifique se o email estÃ¡ correto ou se o aluno jÃ¡ estÃ¡ cadastrado no sistema."})]})})]}),c==="invite_link"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(p,{className:"p-4 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"CÃ³digo de Convite"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-lg font-mono",children:S?.invite_code||"N/A"}),e.jsx(q,{variant:"outline",size:"sm",onClick:G,children:e.jsx(Me,{className:"w-4 h-4"})})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Link de Convite"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:u,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-sm"}),e.jsx(q,{variant:"outline",size:"sm",onClick:L,children:e.jsx(Me,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Compartilhe o cÃ³digo ou link com os alunos. Eles poderÃ£o entrar automaticamente na turma."})]}),c==="bulk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Lista de Emails"}),e.jsx("textarea",{value:A,onChange:R=>v(R.target.value),placeholder:`aluno1@exemplo.com
aluno2@exemplo.com
aluno3@exemplo.com`,rows:8,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Cole uma lista de emails (um por linha)"})]}),e.jsx(q,{onClick:V,disabled:N,className:"w-full",children:N?"Importando...":"Importar Alunos"})]})]})]})}):null},it=({classId:n,classData:P})=>{const[M,S]=a.useState(!0),[D,N]=a.useState([]),[r,c]=a.useState(""),[$,j]=a.useState({isOpen:!1,id:null,name:""}),[d,A]=a.useState("all"),[v,m]=a.useState("all"),[o,u]=a.useState("all"),[f,z]=a.useState("name"),[V,L]=a.useState(!1),[G,R]=a.useState({total:0,active:0,alert:0,critical:0});a.useEffect(()=>{k()},[n]);const k=async()=>{try{S(!0);const{data:s,error:_}=await b.from("class_members").select(`
          *,
          profile:profiles!inner(id, full_name, email, avatar_url)
        `).eq("class_id",n).eq("role","student").order("joined_at",{ascending:!1});if(_)throw _;const{data:y}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",n),U=y?.map(i=>i.activity_id)||[],W=await Promise.all((s||[]).map(async i=>{if(!i.user_id||U.length===0)return{...i,avgGrade:null,deliveryRate:0,submissionsCount:0,totalActivities:U.length,status:"active",lastActivity:null};const{data:h}=await b.from("submissions").select("grade, status, submitted_at").eq("student_id",i.user_id).in("activity_id",U),w=h?.map(se=>parseFloat(se.grade)).filter(se=>!isNaN(se))||[],I=w.length>0?w.reduce((se,Oe)=>se+Oe,0)/w.length:null,J=h?.filter(se=>se.status==="submitted"||se.status==="graded").length||0,ae=U.length>0?J/U.length*100:0;let Q="active";I!==null&&I<5?Q="critical":(I!==null&&I<6||ae<60)&&(Q="alert");const ee=h&&h.length>0?new Date(Math.max(...h.map(se=>new Date(se.submitted_at||0)))):null;return{...i,avgGrade:I,deliveryRate:ae,submissionsCount:J,totalActivities:U.length,status:Q,lastActivity:ee}})),xe={total:W.length,active:W.filter(i=>i.status==="active").length,alert:W.filter(i=>i.status==="alert").length,critical:W.filter(i=>i.status==="critical").length};N(W),R(xe)}catch(s){B.error("Erro ao carregar alunos:",s),g({title:"Erro ao carregar alunos",description:s.message,variant:"destructive"}),N([])}finally{S(!1)}},C=()=>{let s=D;if(r){const _=r.toLowerCase();s=s.filter(y=>y.profile?.full_name?.toLowerCase().includes(_)||y.profile?.email?.toLowerCase().includes(_))}return d!=="all"&&(s=s.filter(_=>_.status===d)),v!=="all"&&(s=s.filter(_=>{if(!_.avgGrade)return v==="none";switch(v){case"excellent":return _.avgGrade>=9;case"good":return _.avgGrade>=7&&_.avgGrade<9;case"regular":return _.avgGrade>=5&&_.avgGrade<7;case"low":return _.avgGrade<5;default:return!0}})),o!=="all"&&(s=s.filter(_=>{switch(o){case"high":return _.deliveryRate>=80;case"medium":return _.deliveryRate>=50&&_.deliveryRate<80;case"low":return _.deliveryRate<50;default:return!0}})),s.sort((_,y)=>{switch(f){case"name":return(_.profile?.full_name||"").localeCompare(y.profile?.full_name||"");case"grade":return(y.avgGrade||0)-(_.avgGrade||0);case"delivery":return y.deliveryRate-_.deliveryRate;case"recent":return new Date(y.joined_at)-new Date(_.joined_at);default:return 0}}),s},O=s=>{g({title:"Em desenvolvimento",description:"PÃ¡gina de detalhes do aluno serÃ¡ implementada em breve"})},l=s=>{g({title:"Em desenvolvimento",description:"VisualizaÃ§Ã£o de atividades do aluno serÃ¡ implementada em breve"})},E=s=>{g({title:"Em desenvolvimento",description:"Sistema de mensagens serÃ¡ implementado em breve"})},Z=(s,_)=>{j({isOpen:!0,id:s,name:_})},t=async()=>{const{id:s,name:_}=$;try{const{error:y}=await b.from("class_members").delete().eq("user_id",s).eq("class_id",n);if(y)throw y;g({title:"âœ… Aluno removido",description:`${_} foi removido da turma com sucesso.`}),k()}catch(y){B.error("Erro ao remover aluno:",y),g({title:"âŒ Erro ao remover aluno",description:y.message,variant:"destructive"})}},x=()=>{const s=C(),_=[["Nome","Email","Nota MÃ©dia","Taxa de Entrega","Status","Data de Entrada"],...s.map(W=>[W.profile?.full_name||"",W.profile?.email||"",W.avgGrade?.toFixed(1)||"N/A",`${W.deliveryRate.toFixed(0)}%`,W.status==="active"?"Ativo":W.status==="alert"?"Alerta":"CrÃ­tico",Ne(new Date(W.joined_at),"dd/MM/yyyy",{locale:ge})])].map(W=>W.join(",")).join(`
`),y=new Blob([_],{type:"text/csv;charset=utf-8;"}),U=document.createElement("a");U.href=URL.createObjectURL(y),U.download=`alunos_${P?.name||"turma"}_${Ne(new Date,"yyyy-MM-dd")}.csv`,U.click(),g({title:"Lista exportada",description:"Arquivo CSV baixado com sucesso."})};if(M)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})});const F=C();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(p,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(ce,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(oe,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.active}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Ativos"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(he,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.alert}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Em Alerta"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(he,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:G.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CrÃ­tico"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Alunos da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[F.length," de ",G.total," alunos"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(q,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>L(!0),children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),"Adicionar Aluno"]})]})]}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(pe,{placeholder:"Buscar por nome ou email...",value:r,onChange:s=>c(s.target.value),className:"pl-10"})]})}),e.jsxs(le,{value:d,onValueChange:A,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Status"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todos os Status"}),e.jsx(T,{value:"active",children:"Ativo"}),e.jsx(T,{value:"alert",children:"Em Alerta"}),e.jsx(T,{value:"critical",children:"CrÃ­tico"})]})]}),e.jsxs(le,{value:v,onValueChange:m,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Nota"})}),e.jsxs(de,{children:[e.jsx(T,{value:"all",children:"Todas as Notas"}),e.jsx(T,{value:"excellent",children:"Excelente (â‰¥9.0)"}),e.jsx(T,{value:"good",children:"Bom (7.0-8.9)"}),e.jsx(T,{value:"regular",children:"Regular (5.0-6.9)"}),e.jsx(T,{value:"low",children:"Baixo (<5.0)"}),e.jsx(T,{value:"none",children:"Sem Nota"})]})]}),e.jsxs(le,{value:f,onValueChange:z,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Ordenar"})}),e.jsxs(de,{children:[e.jsx(T,{value:"name",children:"Nome (A-Z)"}),e.jsx(T,{value:"grade",children:"Nota (maior)"}),e.jsx(T,{value:"delivery",children:"Taxa Entrega"}),e.jsx(T,{value:"recent",children:"Mais Recentes"})]})]})]})}),F.length===0?e.jsx(p,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:D.length===0?"Nenhum aluno na turma":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:D.length===0?"Adicione alunos ou compartilhe o cÃ³digo de convite da turma.":"Ajuste os filtros para ver mais resultados."}),D.length===0&&e.jsxs(q,{onClick:()=>L(!0),children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),"Adicionar Primeiro Aluno"]})]})}):e.jsx("div",{className:"space-y-3",children:F.map((s,_)=>{const y=s.avgGrade>=7?"text-green-600":s.avgGrade>=5?"text-yellow-600":"text-red-600",U=s.deliveryRate>=80?"text-green-600":s.deliveryRate>=60?"text-yellow-600":"text-red-600";return e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:_*.05},children:e.jsx(p,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs(vs,{className:"w-12 h-12",children:[e.jsx(fs,{src:s.profile?.avatar_url}),e.jsx(js,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white font-bold",children:s.profile?.full_name?.[0]||"A"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg",children:s.profile?.full_name||"Nome nÃ£o disponÃ­vel"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.profile?.email||"Email nÃ£o disponÃ­vel"}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2 mt-1",children:[e.jsx(te,{className:"w-3 h-3"}),"Entrou ",ye(new Date(s.joined_at),{locale:ge,addSuffix:!0})]})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${y}`,children:s.avgGrade?.toFixed(1)||"â€”"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]}),e.jsxs("div",{className:"text-center min-w-[120px]",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("span",{className:`text-sm font-semibold ${U}`,children:[s.deliveryRate.toFixed(0),"%"]})}),e.jsx(je,{value:s.deliveryRate,className:"h-2"}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[s.submissionsCount,"/",s.totalActivities," entregas"]})]}),e.jsx(K,{className:s.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":s.status==="alert"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",children:s.status==="active"?"Ativo":s.status==="alert"?"Alerta":"CrÃ­tico"})]}),e.jsxs(ke,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(q,{variant:"ghost",size:"sm",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(_e,{align:"end",children:[e.jsxs(H,{onClick:()=>O(),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(H,{onClick:()=>l(),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Ver Atividades"]}),e.jsxs(H,{onClick:()=>E(),children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),"Enviar Mensagem"]}),e.jsx(Se,{}),e.jsxs(H,{className:"text-red-600 dark:text-red-400",onClick:()=>Z(s.id,s.profile?.full_name),children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),"Remover da Turma"]})]})]})]})})},s.id)})}),e.jsx(lt,{isOpen:V,onClose:()=>L(!1),classId:n,classData:P,onSuccess:()=>{L(!1),k()}}),e.jsx(Re,{isOpen:$.isOpen,onClose:()=>j({isOpen:!1,id:null,name:""}),onConfirm:t,title:"Remover Aluno da Turma",message:`Tem certeza que deseja remover ${$.name} desta turma? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},nt=({classId:n})=>{const[P,M]=a.useState(!0),[S,D]=a.useState({avgGrade:0,deliveryRate:0,engagement:0,totalStudents:0,activeStudents:0,totalActivities:0,completedActivities:0,pendingCorrections:0}),[N,r]=a.useState([]),[c,$]=a.useState([]);a.useEffect(()=>{j()},[n]);const j=async()=>{try{M(!0);const{count:d}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student"),{data:A}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",n),v=A?.map(l=>l.activity_id)||[];let m=[];if(v.length>0){const{data:l}=await b.from("submissions").select("student_id, activity_id, grade, status").in("activity_id",v);m=l||[]}const o=m.filter(l=>l.grade!==null).map(l=>parseFloat(l.grade)),u=o.length>0?o.reduce((l,E)=>l+E,0)/o.length:0,f=d*v.length,z=f>0?m.length/f*100:0,V=m.filter(l=>l.status==="submitted").length,L={};m.forEach(l=>{L[l.student_id]||(L[l.student_id]={grades:[],submissions:0}),L[l.student_id].submissions++,l.grade!==null&&L[l.student_id].grades.push(parseFloat(l.grade))});const{data:G}=await b.from("profiles").select("id, full_name").in("id",Object.keys(L)),R=Object.entries(L).map(([l,E])=>{const Z=G?.find(x=>x.id===l),t=E.grades.length>0?E.grades.reduce((x,F)=>x+F,0)/E.grades.length:0;return{id:l,name:Z?.full_name||"Desconhecido",avgGrade:t,submissions:E.submissions,deliveryRate:E.submissions/v.length*100}}).sort((l,E)=>E.avgGrade-l.avgGrade).slice(0,5);r(R);const k={};m.forEach(l=>{k[l.activity_id]||(k[l.activity_id]={count:0,grades:[]}),k[l.activity_id].count++,l.grade!==null&&k[l.activity_id].grades.push(parseFloat(l.grade))});const{data:C}=await b.from("activities").select("id, title").in("id",Object.keys(k)),O=Object.entries(k).map(([l,E])=>{const Z=C?.find(x=>x.id===l),t=E.grades.length>0?E.grades.reduce((x,F)=>x+F,0)/E.grades.length:0;return{title:Z?.title||"Sem tÃ­tulo",submissions:E.count,avgGrade:t,rate:E.count/d*100}}).sort((l,E)=>E.submissions-l.submissions).slice(0,5);$(O),D({avgGrade:u,deliveryRate:z,engagement:z,totalStudents:d||0,activeStudents:Object.keys(L).length,totalActivities:v.length,completedActivities:v.length,pendingCorrections:V})}catch(d){B.error("Erro ao carregar mÃ©tricas:",d),g({title:"Erro ao carregar mÃ©tricas",description:d.message,variant:"destructive"})}finally{M(!1)}};return P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"MÃ©tricas da Turma"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"AnÃ¡lise de desempenho e engajamento"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(p,{className:"p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(ds,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx(De,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:S.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Nota MÃ©dia Geral"}),e.jsx("div",{className:"mt-2",children:e.jsx(je,{value:S.avgGrade/10*100,className:"h-2"})})]}),e.jsxs(p,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(oe,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx(De,{className:"w-5 h-5 text-blue-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[S.deliveryRate.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Taxa de Entrega"}),e.jsx("div",{className:"mt-2",children:e.jsx(je,{value:S.deliveryRate,className:"h-2"})})]}),e.jsxs(p,{className:"p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(os,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx(De,{className:"w-5 h-5 text-purple-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:[S.engagement.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Engajamento"}),e.jsx("div",{className:"mt-2",children:e.jsx(je,{value:S.engagement,className:"h-2"})})]}),e.jsxs(p,{className:"p-6 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(Te,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),S.pendingCorrections>0?e.jsx(he,{className:"w-5 h-5 text-yellow-600"}):e.jsx(oe,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-1",children:S.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CorreÃ§Ãµes Pendentes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:S.totalStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total de Alunos"})]})]})}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:S.activeStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Alunos Ativos"})]})]})}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:S.totalActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Atividades"})]})]})}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(os,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:S.completedActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"ConcluÃ­das"})]})]})})]}),e.jsxs(p,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-yellow-600"}),"Top 5 Alunos por Desempenho"]}),N.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhum dado disponÃ­vel ainda"}):e.jsx("div",{className:"space-y-3",children:N.map((d,A)=>e.jsxs(Y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:A*.1},className:"flex items-center justify-between p-4 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`
                    w-8 h-8 rounded-full flex items-center justify-center font-bold
                    ${A===0?"bg-yellow-100 text-yellow-700":A===1?"bg-slate-200 text-slate-700":A===2?"bg-orange-100 text-orange-700":"bg-slate-100 text-slate-600"}
                  `,children:A+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:d.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[d.submissions," submissÃµes â€¢ ",d.deliveryRate.toFixed(0),"% entrega"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]})]},d.id))})]}),e.jsxs(p,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(es,{className:"w-5 h-5 text-blue-600"}),"Top 5 Atividades por Engajamento"]}),c.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhuma atividade com submissÃµes ainda"}):e.jsx("div",{className:"space-y-4",children:c.map((d,A)=>e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:A*.1},children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:d.title}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[d.submissions," submissÃµes â€¢ MÃ©dia: ",d.avgGrade.toFixed(1)]})]}),e.jsxs(K,{className:d.rate>=80?"bg-green-100 text-green-700":d.rate>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700",children:[d.rate.toFixed(0),"%"]})]}),e.jsx(je,{value:d.rate,className:"h-2"})]})},A))})]}),e.jsxs(p,{className:"p-12 text-center border-2 border-dashed",children:[e.jsx(es,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"GrÃ¡ficos Detalhados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:["GrÃ¡ficos de evoluÃ§Ã£o temporal, distribuiÃ§Ã£o de notas e comparativos",e.jsx("br",{}),"podem ser adicionados aqui usando Recharts ou Chart.js"]}),e.jsx(K,{variant:"secondary",children:"Em Breve"})]})]})},dt=({classId:n,classData:P})=>{const[M,S]=a.useState(!0),[D,N]=a.useState(!1),[r,c]=a.useState([]),[$,j]=a.useState([]),[d,A]=a.useState("friendly"),[v,m]=a.useState({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0});a.useRef(!1),a.useEffect(()=>{o(),(async()=>{try{const{data:z,error:V}=await b.from("classes").select("settings").eq("id",n).single();if(V)throw V;const L=z?.settings?.chatbot_enabled||!1,G=z?.settings?.chatbot_paused||!1;N(L&&!G),B.debug("ðŸ¤– Estado do chatbot carregado:",{enabled:L,paused:G})}catch(z){B.error("Erro ao carregar estado do chatbot:",z)}})()},[n,P]);const o=async()=>{try{S(!0);const{data:f}=await b.from("class_materials").select("id, title, file_type, category").eq("class_id",n);c(f||[]);const{data:z}=await b.from("rag_training_sources").select("*").eq("class_id",n);j(z||[]),m({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0})}catch(f){B.error("Erro ao carregar dados do chatbot:",f),g({title:"Erro ao carregar chatbot",description:f.message,variant:"destructive"})}finally{S(!1)}},u=async f=>{N(f);try{const{data:z}=await b.from("classes").select("settings").eq("id",n).single(),{error:V}=await b.from("classes").update({settings:{...z?.settings||{},chatbot_enabled:f,chatbot_paused:!f}}).eq("id",n);if(V)throw V;g({title:f?"âœ… Chatbot Ativado":"â¸ï¸ Chatbot Desativado",description:f?"O assistente virtual estÃ¡ agora disponÃ­vel para os alunos.":"O assistente virtual foi desativado."}),B.debug("ðŸ¤– Estado do chatbot salvo:",{enabled:f})}catch(z){B.error("Erro ao salvar configuraÃ§Ã£o:",z),N(!f),g({title:"Erro ao salvar",description:"NÃ£o foi possÃ­vel salvar a configuraÃ§Ã£o. Tente novamente.",variant:"destructive"})}};return M?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Assistente Virtual (Chatbot)"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Configure um assistente com IA para responder dÃºvidas dos alunos"})]}),e.jsx(p,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg",children:e.jsx(Ge,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Status do Chatbot"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:D?"âœ… Assistente virtual ativo e respondendo alunos":"âš ï¸ Assistente virtual desativado"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:f=>u(f.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(p,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Os,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:v.totalQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Perguntas"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:v.answeredQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Respondidas"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($s,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:v.avgResponseTime}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Tempo MÃ©dio"})]})]})}),e.jsx(p,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[v.satisfactionRate,"%"]}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"SatisfaÃ§Ã£o"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(p,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-blue-600"}),"Personalidade do Bot"]}),e.jsxs(le,{value:d,onValueChange:A,children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Escolha a personalidade"})}),e.jsxs(de,{children:[e.jsx(T,{value:"friendly",children:"ðŸ˜Š AmigÃ¡vel e Casual"}),e.jsx(T,{value:"formal",children:"ðŸ‘” Formal e Profissional"}),e.jsx(T,{value:"motivational",children:"ðŸš€ Motivador e EnergÃ©tico"}),e.jsx(T,{value:"patient",children:"ðŸ§˜ Paciente e DidÃ¡tico"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[d==="friendly"&&"ðŸ’¬ O bot usarÃ¡ linguagem casual e amigÃ¡vel",d==="formal"&&"ðŸ“ O bot manterÃ¡ tom profissional e formal",d==="motivational"&&"âœ¨ O bot serÃ¡ motivador e entusiasta",d==="patient"&&"ðŸŽ¯ O bot explicarÃ¡ com paciÃªncia e detalhes"]})})]}),e.jsxs(p,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5 text-purple-600"}),"Modelo de IA"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Claude 3.5 Sonnet"}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Modelo avanÃ§ado da Anthropic"})]}),e.jsx(K,{className:"bg-green-100 text-green-700",children:"Ativo"})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["âœ… Respostas contextualizadas",e.jsx("br",{}),"âœ… CompreensÃ£o avanÃ§ada de linguagem",e.jsx("br",{}),"âœ… SeguranÃ§a e moderaÃ§Ã£o automÃ¡tica"]})]})]})]}),e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),"Materiais para Treinamento (RAG)"]}),e.jsxs(K,{variant:"secondary",children:[$.length," fontes ativas"]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Selecione materiais da turma para treinar o chatbot. Ele usarÃ¡ esses conteÃºdos para responder perguntas."}),r.length===0?e.jsxs("div",{className:"text-center py-8 bg-slate-50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-2 text-slate-300"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Nenhum material disponÃ­vel.",e.jsx("br",{}),"Adicione materiais na tab Biblioteca primeiro."]})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.slice(0,5).map((f,z)=>e.jsxs(Y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:z*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",defaultChecked:$.some(V=>V.material_id===f.id)}),e.jsx(X,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:f.title}),e.jsx("div",{className:"text-xs text-slate-500",children:f.category})]}),e.jsx(K,{variant:"outline",className:"text-xs",children:f.file_type?.split("/")[1]||"arquivo"})]},f.id))}),e.jsxs(q,{className:"w-full mt-4",variant:"outline",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Treinar Chatbot com Materiais Selecionados"]})]}),e.jsxs(p,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-blue-600"}),"Preview do Chatbot"]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center",children:e.jsx(Ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm",children:["OlÃ¡! ðŸ‘‹ Sou o assistente virtual da turma ",e.jsx("strong",{children:P?.name}),". Como posso ajudar vocÃª hoje?"]})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Agora mesmo"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsxs("div",{className:"flex-1 max-w-md",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-lg p-3",children:e.jsx("p",{className:"text-sm",children:"Quando Ã© a prova de matemÃ¡tica?"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1 text-right",children:"VisualizaÃ§Ã£o"})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-300 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4"})})]})]})]})]}),!D&&e.jsxs(p,{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-flex p-6 rounded-full bg-slate-100 dark:bg-slate-800 mb-4",children:e.jsx(Ge,{className:"w-16 h-16 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Chatbot Desativado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6 max-w-md mx-auto",children:"Ative o assistente virtual para permitir que alunos tirem dÃºvidas automaticamente 24/7 com respostas contextualizadas baseadas nos materiais da turma."}),e.jsx("div",{className:"flex justify-center gap-4",children:e.jsxs(q,{onClick:()=>u(!0),size:"lg",children:[e.jsx(Ge,{className:"w-5 h-5 mr-2"}),"Ativar Chatbot"]})})]})]})},Ba=()=>{const{classId:n}=_s(),P=ts(),{user:M}=Ss(),[S,D]=As(),[N,r]=a.useState(!0),[c,$]=a.useState(null),[j,d]=a.useState(S.get("tab")||"overview"),[A,v]=a.useState(0),[m,o]=a.useState(!1),[u,f]=a.useState(!1),[z,V]=a.useState(""),[L,G]=a.useState(!0),[R,k]=a.useState(!0),[C,O]=a.useState(!1);a.useEffect(()=>{if(!/^[0-9a-fA-F-]{36}$/.test(n)){P("/dashboard/classes",{replace:!0});return}n&&l()},[n]),a.useEffect(()=>{const y=S.get("tab");y&&d(y)},[S]);const l=async()=>{try{r(!0);const{data:y,error:U}=await b.from("classes").select("*").eq("id",n).single();if(U)throw B.error("Erro ao buscar turma:",U),U;if(!y)throw B.error("Turma nÃ£o encontrada:",n),new Error("Turma nÃ£o encontrada");$(y);const{count:W}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student");if(v(W||0),M?.id){const{data:xe,error:i}=await b.from("class_members").select("role").eq("class_id",n).eq("user_id",M.id).maybeSingle();i?B.warn("Erro ao verificar papel do usuÃ¡rio na turma:",i):o(xe?.role==="teacher")}}catch(y){ms(g,"NÃ£o foi possÃ­vel carregar os dados da turma.",y,{logPrefix:"[ClassDetailsPage] Erro ao carregar turma"}),P("/dashboard/classes")}finally{r(!1)}},E=y=>{d(y),D({tab:y})},Z=()=>{c?.invite_code&&(navigator.clipboard.writeText(c.invite_code),g({title:"CÃ³digo copiado!",description:"O cÃ³digo de convite foi copiado para a Ã¡rea de transferÃªncia."}))},t=()=>{c&&(V(`${c.name} - CÃ³pia`),G(!0),k(!0),f(!0))},x=async()=>{if(!(!n||!c))try{O(!0);const y=await Ds.cloneClassStructure(n,{name:z||`${c.name} - CÃ³pia`,copyStudents:L,copyActivities:R});g({title:"Turma clonada com sucesso",description:"Redirecionando para a nova turma..."}),f(!1),P(`/dashboard/classes/${y.id}`)}catch(y){ms(g,"NÃ£o foi possÃ­vel clonar a turma.",y,{logPrefix:"[ClassDetailsPage] Erro ao clonar turma"})}finally{O(!1)}},F=[{id:"overview",label:"VisÃ£o Geral",icon:Vs},{id:"content",label:"Mural de ConteÃºdo",icon:X},{id:"announcements",label:"Comunicados",icon:be},{id:"library",label:"Biblioteca",icon:Ye},{id:"activities",label:"Atividades",icon:Je},{id:"students",label:"Alunos",icon:ce},{id:"metrics",label:"MÃ©tricas",icon:es},{id:"chatbot",label:"Chatbot",icon:as}];if(N)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(me,{size:"lg"})});const s=c?.color||"from-blue-600 to-cyan-500",_=!N&&m;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsxs("div",{className:`relative h-64 bg-gradient-to-r ${s} overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute top-4 left-6",children:e.jsxs(q,{variant:"ghost",onClick:()=>P("/dashboard/classes"),className:"text-white hover:bg-white/20",children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs("div",{className:"absolute top-4 right-6 flex items-center gap-2",children:[e.jsx(q,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(Ns,{className:"w-4 h-4"})}),e.jsx(q,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsxs(ke,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(q,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(_e,{align:"end",className:"w-56",children:[c?.invite_code&&e.jsxs(H,{onClick:Z,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Ver CÃ³digo de Convite"]}),e.jsxs(H,{onClick:t,disabled:!_,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),_?"Clonar Turma":"Clonar Turma (apenas professor)"]}),e.jsx(Se,{}),e.jsx(H,{disabled:!0,children:"Arquivar Turma (em breve)"})]})]})]}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-center px-6 max-w-7xl mx-auto",children:[e.jsx(Y.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-4xl font-bold text-white mb-2",children:c?.name}),e.jsx(Y.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-lg text-white/90 mb-4",children:c?.subject}),c?.description&&e.jsx(Y.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-white/80 max-w-2xl line-clamp-2",children:c.description}),e.jsxs(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex items-center gap-3 mt-4",children:[e.jsxs(K,{className:"bg-white/20 text-white border-white/30",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),A," alunos"]}),c?.is_active!==!1?e.jsxs(K,{className:"bg-green-500/20 text-green-100 border-green-400/30",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Ativa"]}):e.jsx(K,{className:"bg-gray-500/20 text-gray-100 border-gray-400/30",children:"Arquivada"}),c?.invite_code&&e.jsxs(K,{className:"bg-white/20 text-white border-white/30 cursor-pointer hover:bg-white/30",onClick:Z,children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),"CÃ³digo: ",c.invite_code]})]})]}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 h-16 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsx("div",{className:"sticky top-0 z-40 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide py-1",children:F.map(y=>{const U=y.icon,W=j===y.id;return e.jsxs("button",{onClick:()=>E(y.id),className:`
                    flex items-center gap-2 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all
                    ${W?"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}
                  `,children:[e.jsx(U,{className:"w-4 h-4"}),y.label]},y.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[j==="overview"&&e.jsx(Ks,{classId:n,classData:c}),j==="content"&&e.jsx(Ys,{classId:n}),j==="announcements"&&e.jsx(et,{classId:n}),j==="library"&&e.jsx(tt,{classId:n}),j==="activities"&&e.jsx(rt,{classId:n}),j==="students"&&e.jsx(it,{classId:n,classData:c}),j==="metrics"&&e.jsx(nt,{classId:n}),j==="chatbot"&&e.jsx(dt,{classId:n,classData:c})]}),e.jsx(xs,{open:u,onOpenChange:f,children:e.jsxs(us,{className:"max-w-lg",children:[e.jsxs(hs,{children:[e.jsx(gs,{children:"Clonar Turma"}),e.jsxs(Es,{children:["Crie uma nova turma a partir de ",c?.name,". As atividades serÃ£o copiadas como rascunhos e nÃ£o serÃ£o publicadas automaticamente. Apenas professores podem clonar turmas."]})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx(Ee,{htmlFor:"clone-name",className:"text-sm font-medium",children:"Nome da nova turma"}),e.jsx(pe,{id:"clone-name",type:"text",value:z,onChange:y=>V(y.target.value),className:"mt-1",placeholder:`${c?.name||"Turma"} - CÃ³pia`})]}),e.jsxs(p,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"copy-students",checked:L,onCheckedChange:y=>G(!!y)}),e.jsx(Ee,{htmlFor:"copy-students",className:"cursor-pointer",children:"Copiar alunos da turma original"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"copy-activities",checked:R,onCheckedChange:y=>k(!!y)}),e.jsx(Ee,{htmlFor:"copy-activities",className:"cursor-pointer",children:"Copiar atividades (como rascunhos) para a nova turma"})]})]})]}),e.jsxs(ps,{className:"mt-4",children:[e.jsx(q,{variant:"outline",onClick:()=>f(!1),disabled:C,children:"Cancelar"}),e.jsx(q,{onClick:x,disabled:C||N||!m,className:"bg-blue-600 hover:bg-blue-700",children:C?"Clonando...":"Clonar Turma"})]})]})})]})};export{Ba as default};
