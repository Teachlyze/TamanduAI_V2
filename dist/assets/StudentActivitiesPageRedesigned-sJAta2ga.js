import{b as me,u as ue,r,s as o,l as T,j as e}from"./main-BtydHokz.js";import{u as pe}from"./use-toast-BD7ojcJx.js";import{C as $}from"./card-BLN8IVBT.js";import{A as F}from"./ActivityCard-CbCYqYef.js";import{E as xe}from"./EmptyState-Dl2p8Yg2.js";import"./button-pkZcz0fw.js";import"./dialog-BI66C03T.js";import{I as fe}from"./input-DevW5dIO.js";import{T as ge,a as he,b as _}from"./tabs-CcynQOeo.js";import{S as P,a as z,b as B,c as Q,d as m}from"./select-D2GCnsr7.js";import{m as R}from"./proxy-BKNTM3tf.js";import{F as G}from"./file-text-GwBv-P3B.js";import{C as ve}from"./clock-cyyJEg8O.js";import{C as H}from"./circle-check-D34UQm6h.js";import{T as O}from"./triangle-alert-BxEcMhlL.js";import{S as U}from"./search-B-7BMQB5.js";import{d as be}from"./differenceInHours-DYlE495b.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-DaE-csDX.js";import"./formatDistanceToNow-sn9sU9NS.js";import"./constructNow-BZVcxkR5.js";import"./differenceInCalendarMonths-CtUCBvak.js";import"./endOfDay-BZ13SNr-.js";import"./endOfMonth-B3jF8fTW.js";import"./format-B5colFmK.js";import"./pt-BR-D0BJ_iDf.js";import"./index-BRR_QA-l.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./users-CntpuLnR.js";import"./book-open-BQJiPDff.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./chevron-right-Bh44L5jc.js";import"./x-BtLVjj0F.js";import"./index-DsrKRt14.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";import"./index-C35Ckziv.js";import"./chevron-down-BPlSfXS4.js";import"./check-B1zY7uXK.js";import"./chevron-up-B8VCb_df.js";const gs=()=>{const{user:u}=me(),f=ue(),{toast:A}=pe(),[je,w]=r.useState(!0),[W,J]=r.useState(!0),[E,k]=r.useState([]),[p,K]=r.useState([]),[l,X]=r.useState("all"),[g,Y]=r.useState(""),[h,Z]=r.useState("all"),[v,ee]=r.useState("all"),[se,te]=r.useState([]),[b,ae]=r.useState({total:0,pending:0,completed:0,late:0,urgent:0});r.useEffect(()=>{u?.id&&(re(),ie())},[u]),r.useEffect(()=>{le()},[E,l,g,h,v]);const ie=async()=>{try{const{data:s}=await o.from("class_members").select("class_id").eq("user_id",u.id).eq("role","student"),t=s?.map(j=>j.class_id)||[],{data:i}=await o.from("classes").select("id, name, subject").in("id",t);te(i||[])}catch(s){T.error("Erro ao carregar turmas:",s),A({title:"Erro ao carregar turmas",description:"Não foi possível carregar suas turmas. Tente novamente em instantes.",variant:"destructive"})}},re=async()=>{try{w(!0);const{data:s}=await o.from("class_members").select("class_id").eq("user_id",u.id).eq("role","student"),t=s?.map(a=>a.class_id)||[];if(t.length===0){k([]),w(!1);return}const{data:i}=await o.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",t),j=i?.map(a=>a.activity_id).filter(Boolean)||[],{data:oe}=await o.from("activities").select("id, title, description, type, due_date, max_score, created_at").in("id",j),{data:ce}=await o.from("classes").select("id, name, subject, color").in("id",t),N={};oe?.forEach(a=>{N[a.id]=a});const q={};ce?.forEach(a=>{q[a.id]=a});const{data:ne,error:I}=await o.from("submissions").select("activity_id, status, grade, feedback, submitted_at").eq("student_id",u.id).in("activity_id",j);I&&T.error("Erro ao buscar submissões:",I);const V={};ne?.forEach(a=>{V[a.activity_id]=a});const c=(i||[]).filter(a=>N[a.activity_id]).map(a=>{const D=N[a.activity_id],y=q[a.class_id],n=V[a.activity_id],S=new Date(D.due_date),C=new Date,M=be(S,C);let d="pending";return n?n.status==="graded"?d="completed":n.status==="submitted"?d="submitted":d=S<C?"late":"pending":S<C&&(d="late"),{...D,class_id:a.class_id,class_name:y?.name,class_subject:y?.subject,class_color:y?.color,status:d,grade:n?.grade,feedback:n?.feedback,submitted_at:n?.submitted_at,assigned_at:a.assigned_at,is_urgent:M<=24&&M>=0&&d==="pending"}}),de={total:c.length,pending:c.filter(a=>a.status==="pending").length,completed:c.filter(a=>a.status==="completed"||a.status==="submitted").length,late:c.filter(a=>a.status==="late").length,urgent:c.filter(a=>a.is_urgent).length};ae(de),k(c)}catch(s){T.error("Erro ao carregar atividades:",s),A({title:"Erro ao carregar atividades",description:"Não foi possível carregar suas atividades. Tente novamente em instantes.",variant:"destructive"})}finally{w(!1),W&&J(!1)}},le=()=>{let s=[...E];if(l==="pending"?s=s.filter(t=>t.status==="pending"||t.status==="late"):l==="completed"?s=s.filter(t=>t.status==="completed"||t.status==="submitted"):l==="late"&&(s=s.filter(t=>t.status==="late")),g){const t=g.toLowerCase();s=s.filter(i=>i.title?.toLowerCase().includes(t)||i.description?.toLowerCase().includes(t)||i.class_name?.toLowerCase().includes(t))}h!=="all"&&(s=s.filter(t=>t.class_id===h)),v!=="all"&&(s=s.filter(t=>t.type===v)),s.sort((t,i)=>t.status==="late"&&i.status!=="late"?-1:t.status!=="late"&&i.status==="late"?1:t.is_urgent&&!i.is_urgent?-1:!t.is_urgent&&i.is_urgent?1:new Date(t.due_date)-new Date(i.due_date)),K(s)},x=p.filter(s=>s.is_urgent),L=p.filter(s=>!s.is_urgent);return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-3 sm:p-4 md:p-6",children:[e.jsxs(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 sm:mb-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-2 sm:gap-3",children:[e.jsx(G,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-600"}),"Minhas Atividades"]}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-400",children:"Gerencie suas atividades e acompanhe seu progresso"})]}),e.jsx($,{className:"p-3 sm:p-4 md:p-6 mb-6 sm:mb-8",children:e.jsxs(ge,{value:l,onValueChange:X,children:[e.jsxs(he,{className:"grid grid-cols-2 sm:grid-cols-4 w-full mb-4 sm:mb-6",children:[e.jsxs(_,{value:"all",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),"Todas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:b.total})]}),e.jsxs(_,{value:"pending",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(ve,{className:"w-4 h-4"}),"Pendentes",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:b.pending})]}),e.jsxs(_,{value:"completed",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"Concluídas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:b.completed})]}),e.jsxs(_,{value:"late",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),"Atrasadas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:b.late})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(fe,{placeholder:"Buscar atividades...",value:g,onChange:s=>Y(s.target.value),className:"pl-10"})]})}),e.jsxs(P,{value:h,onValueChange:Z,children:[e.jsx(z,{className:"w-full md:w-48",children:e.jsx(B,{placeholder:"Todas as turmas"})}),e.jsxs(Q,{children:[e.jsx(m,{value:"all",children:"Todas as turmas"}),se.map(s=>e.jsx(m,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(P,{value:v,onValueChange:ee,children:[e.jsx(z,{className:"w-full md:w-48",children:e.jsx(B,{placeholder:"Todos os tipos"})}),e.jsxs(Q,{children:[e.jsx(m,{value:"all",children:"Todos os tipos"}),e.jsx(m,{value:"objective",children:"Objetiva"}),e.jsx(m,{value:"open",children:"Aberta"}),e.jsx(m,{value:"mixed",children:"Mista"})]})]})]})]})}),x.length>0&&e.jsx(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"mb-8",children:e.jsxs($,{className:"p-6 border-l-4 border-amber-500 bg-white dark:bg-slate-900",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-amber-500"}),"Atividades Urgentes - Prazo nas próximas 24 horas"]}),e.jsx("div",{className:"space-y-4",children:x.map((s,t)=>e.jsx(F,{activity:s,onStart:()=>f(`/students/activities/${s.id}`),onView:()=>f(`/students/activities/${s.id}`),index:t},s.id))})]})}),L.length>0?e.jsx("div",{className:"space-y-4",children:L.map((s,t)=>e.jsx(F,{activity:s,onStart:()=>f(`/students/activities/${s.id}`),onView:()=>f(`/students/activities/${s.id}`),index:t},s.id))}):e.jsx(xe,{icon:p.length===0&&x.length===0?H:U,title:p.length===0&&x.length===0?l==="completed"?"Nenhuma atividade concluída":"Nenhuma atividade":"Nenhum resultado encontrado",description:p.length===0&&x.length===0?l==="completed"?"Comece a fazer suas atividades para vê-las aqui quando concluídas.":"Você não tem atividades nesta categoria no momento.":"Tente ajustar os filtros de busca para encontrar o que procura.",variant:l==="completed"?"success":"default"})]})};export{gs as default};
