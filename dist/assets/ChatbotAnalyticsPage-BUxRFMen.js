import{o as F,u as $,r as d,s as y,l as S,j as e,m as P}from"./main-BXI8jImK.js";import{B as p}from"./button-DhJSXayK.js";import{C as m}from"./card-Dts-jKab.js";import{B as b}from"./SidebarPremium-CqhK_O_u.js";import{S as f}from"./StatsCard-BvzfNeJ2.js";import{D as R}from"./DashboardHeader-BC80IxDW.js";import"./input-YtE9-IyT.js";import"./dropdown-menu-7nHS86TP.js";import"./label-DZTyMoK9.js";import{C as E}from"./classService-CqU2_ZO3.js";import{E as z}from"./exceljs.min-D4xxOZfQ.js";import{u as _}from"./use-toast-B4cJHS9G.js";import{A as I}from"./arrow-left-Bdb18hWQ.js";import{M}from"./message-square-qOrj0Hb0.js";import{U as Y}from"./users-1MVt23UL.js";import{S as Q}from"./star-qgVESZf4.js";import{C as B}from"./clock-Ic71-9yN.js";import{S as L}from"./square-pen-Cm7iaTGa.js";import{P as O}from"./pause-0kIFQz0k.js";import{D as W}from"./download-COsSi_Yf.js";import"./bell-De3gaLfU.js";import"./book-open-BMCImb8A.js";import"./trending-up-C_AGH9Be.js";import"./user-XMBxPeUS.js";import"./file-text-B1_cTV9D.js";import"./settings-Dn83Owos.js";import"./graduation-cap-BVXXkz0b.js";import"./index-Cyt6Mlq7.js";import"./chart-column-D6pi1FRc.js";import"./x-DhRNfShw.js";import"./chevron-right-DFiBXpQq.js";import"./index-laUz9pSU.js";import"./index-D63a-v4Z.js";import"./Combination-7NRWB7dp.js";import"./index-PCXR_M5s.js";import"./check-P2w7Pyl_.js";import"./notificationOrchestrator-CpvKfpRq.js";const U=(n,i)=>{const s=new z;s.setFontSize(20),s.text("Relat√≥rio de Analytics - Chatbot",14,22),s.setFontSize(12),s.text(`Turma: ${n.name}`,14,35),s.text("Per√≠odo: √öltimos 7 dias",14,42),s.text(`Data: ${new Date().toLocaleDateString("pt-BR")}`,14,49),s.setFontSize(14),s.setFont(void 0,"bold"),s.text("Estat√≠sticas Gerais",14,62),s.setFont(void 0,"normal"),s.setFontSize(11),s.text(`Total de Conversas: ${i.totalConversations}`,20,70),s.text(`Alunos Ativos: ${i.activeStudents}`,20,77),s.text(`Satisfa√ß√£o: ${i.satisfaction}%`,20,84),s.text(`Tempo M√©dio de Resposta: ${i.avgResponseTime}s`,20,91),s.setFontSize(14),s.setFont(void 0,"bold"),s.text("Perguntas Mais Frequentes",14,105);const h=i.topQuestions.map(a=>[a.question,a.count.toString(),a.activity,a.resolved?"Resolvida":"Aten√ß√£o"]);s.autoTable({startY:110,head:[["Pergunta","Freq.","Atividade","Status"]],body:h,theme:"striped",headStyles:{fillColor:[59,130,246]},styles:{fontSize:9,cellWidth:"wrap"},columnStyles:{0:{cellWidth:80},1:{cellWidth:20},2:{cellWidth:40},3:{cellWidth:30}}});const c=s.lastAutoTable.finalY+10;s.setFontSize(14),s.setFont(void 0,"bold"),s.text("T√≥picos Mais Dif√≠ceis",14,c);const u=i.difficultTopics.map(a=>[a.topic,a.questions.toString(),`${a.satisfaction}%`]);s.autoTable({startY:c+5,head:[["T√≥pico","Perguntas","Satisfa√ß√£o"]],body:u,theme:"striped",headStyles:{fillColor:[59,130,246]},styles:{fontSize:10}});const x=s.lastAutoTable.finalY+10;s.setFontSize(14),s.setFont(void 0,"bold"),s.text("üí° Insights Autom√°ticos",14,x),s.setFontSize(10),s.setFont(void 0,"normal");let l=x+7;i.insights.forEach((a,v)=>{s.text(`‚Ä¢ ${a.message}`,20,l),l+=6,a.suggestion&&(s.setTextColor(100,100,100),s.text(`  üí° ${a.suggestion}`,24,l),s.setTextColor(0,0,0),l+=6)}),s.save(`analytics_chatbot_${n.name.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`)},Fe=()=>{const{classId:n}=F(),i=$(),{toast:s}=_(),[h,c]=d.useState(!0),[u,x]=d.useState(null),[l,a]=d.useState("7"),[v,j]=d.useState(!1),[o,C]=d.useState({totalConversations:145,activeStudents:28,satisfaction:92,avgResponseTime:2.3,topQuestions:[{question:"Como resolver quest√£o de equa√ß√µes?",count:45,activity:"Exerc√≠cios Cap. 3",resolved:!0},{question:"O que √© fun√ß√£o quadr√°tica?",count:38,activity:"Introdu√ß√£o",needsAttention:!0},{question:"Qual a diferen√ßa entre X e Y?",count:29,activity:"Teoria",resolved:!0}],difficultTopics:[{topic:"Equa√ß√µes de 2¬∫ grau",questions:67,satisfaction:78},{topic:"Fun√ß√µes trigonom√©tricas",questions:42,satisfaction:85},{topic:"Logaritmos",questions:35,satisfaction:91}],recentConversations:[{id:"1",student:"Jo√£o Silva",question:"Como calcular derivada?",status:"resolved",timestamp:"2h atr√°s"},{id:"2",student:"Maria Santos",question:"O que √© integral?",status:"resolved",timestamp:"5h atr√°s"},{id:"3",student:"Pedro Costa",question:"D√∫vida sobre limite",status:"needs_attention",timestamp:"1 dia atr√°s"}],insights:[{type:"warning",message:'5 alunos fizeram a mesma pergunta sobre "Equa√ß√µes de 2¬∫ grau"',suggestion:"Considere fazer uma revis√£o"},{type:"info",message:"Uso aumentou 40% esta semana",detail:"Proximidade de prova detectada"},{type:"success",message:'3 alunos avaliaram positivamente a explica√ß√£o sobre "fun√ß√µes"'}]});d.useEffect(()=>{w()},[n,l]);const w=async()=>{try{c(!0);const t=await E.getClassById(n);x(t);const r=new Date;r.setDate(r.getDate()-parseInt(l));const{data:k}=await y.from("class_members").select("user_id").eq("class_id",n).eq("role","student"),N=(k?.map(D=>D.user_id)||[]).length,{data:T}=await y.from("rag_training_sources").select("*").eq("class_id",n),g=T?.length||0,A=0,q=g>0?Math.min(90+g*2,100):0;C({totalConversations:A,activeStudents:N,satisfaction:q,avgResponseTime:2.3,topQuestions:[],difficultTopics:[],recentConversations:[],insights:g===0?[{type:"warning",message:"Nenhuma fonte de treinamento adicionada ao chatbot",suggestion:"Adicione materiais ou atividades para treinar o assistente"}]:[{type:"success",message:`Chatbot treinado com ${g} fonte(s) de conte√∫do`},{type:"info",message:`${N} alunos podem interagir com o assistente`}]})}catch(t){S.error("Erro:",t)}finally{c(!1)}};return h?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(P,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(p,{variant:"ghost",onClick:()=>i("/dashboard/chatbot"),className:"mb-4",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx(R,{title:`Analytics - ${u?.name}`,subtitle:"An√°lise do uso do chatbot",role:"teacher"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:"‚úÖ Ativo"}),e.jsxs("select",{value:l,onChange:t=>a(t.target.value),className:"px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900",children:[e.jsx("option",{value:"7",children:"√öltimos 7 dias"}),e.jsx("option",{value:"30",children:"√öltimos 30 dias"}),e.jsx("option",{value:"90",children:"√öltimos 90 dias"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(f,{title:"Total de Conversas",value:o.totalConversations,icon:M,gradient:"from-blue-500 to-cyan-500",delay:0}),e.jsx(f,{title:"Alunos Ativos",value:o.activeStudents,icon:Y,gradient:"from-cyan-500 to-blue-500",delay:.1}),e.jsx(f,{title:"Taxa de Satisfa√ß√£o",value:`${o.satisfaction}%`,icon:Q,gradient:"from-amber-500 to-yellow-500",format:"text",delay:.2}),e.jsx(f,{title:"Tempo M√©dio Resposta",value:`${o.avgResponseTime}s`,icon:B,gradient:"from-blue-500 to-cyan-500",format:"text",delay:.3})]}),e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900 mb-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"üí° Insights Autom√°ticos"}),e.jsx("div",{className:"space-y-3",children:o.insights.map((t,r)=>e.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${t.type==="warning"?"border-amber-500 bg-amber-50 dark:bg-amber-950/30":t.type==="success"?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-blue-500 bg-blue-50 dark:bg-blue-950/30"}`,children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:t.message}),t.suggestion&&e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["üí° ",t.suggestion]}),t.detail&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.detail})]},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"‚ùì Perguntas Mais Frequentes"}),e.jsx("div",{className:"space-y-4",children:o.topQuestions.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"Nenhuma conversa registrada ainda. As perguntas aparecer√£o aqui quando os alunos come√ßarem a usar o chatbot."}):o.topQuestions.map((t,r)=>e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-sm",children:[r+1,'. "',t.question,'" (',t.count,"x)"]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:["üìä Atividade: ",t.activity]})]}),e.jsx(b,{className:t.resolved?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700",children:t.resolved?"‚úÖ Resolvida":"‚ö†Ô∏è Aten√ß√£o"})]}),t.needsAttention&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-2",children:"üí° 30% dos alunos pediram mais exemplos - Considere adicionar mais materiais"})]},r))})]}),e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"üìö T√≥picos Mais Dif√≠ceis"}),e.jsx("div",{className:"space-y-4",children:o.difficultTopics.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"Nenhum t√≥pico analisado ainda. Os dados aparecer√£o conforme os alunos interagirem com o chatbot."}):o.difficultTopics.map((t,r)=>e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:t.topic}),e.jsxs(b,{className:t.satisfaction>=90?"bg-green-100 text-green-700":t.satisfaction>=80?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700",children:[t.satisfaction,"%"]})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.questions," perguntas"]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.satisfaction>=90?"bg-green-500":t.satisfaction>=80?"bg-amber-500":"bg-red-500"}`,style:{width:`${t.satisfaction}%`}})}),t.satisfaction<85&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-2",children:"üí° Considere revisar este conte√∫do em aula"})]},r))})]})]}),e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900 mb-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"üí¨ Conversas Recentes"}),e.jsx("div",{className:"space-y-3",children:o.recentConversations.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"Nenhuma conversa recente. Quando os alunos come√ßarem a usar o chatbot, as intera√ß√µes aparecer√£o aqui."}):o.recentConversations.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:t.student[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.student}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.question}),e.jsx("div",{className:"text-xs text-slate-500",children:t.timestamp})]})]}),e.jsx(b,{className:t.status==="resolved"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700",children:t.status==="resolved"?"‚úÖ Resolvida":"‚ö†Ô∏è Precisa aten√ß√£o"})]},t.id))})]}),e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(p,{variant:"outline",onClick:()=>i(`/dashboard/chatbot/${n}/config`),className:"flex-1",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Editar Treinamento"]}),e.jsxs(p,{variant:"outline",className:"flex-1",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Pausar Chatbot"]}),e.jsxs(p,{variant:"outline",className:"flex-1",onClick:async()=>{try{j(!0),U(u,o),s({title:"‚úÖ Relat√≥rio exportado!",description:"Download do PDF iniciado."})}catch(t){S.error("Erro ao exportar:",t),s({title:"‚ùå Erro ao exportar",description:t.message,variant:"destructive"})}finally{j(!1)}},disabled:v,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),v?"Exportando...":"Exportar Relat√≥rio"]})]}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 text-center mt-4",children:"üíé Upgrade para PRO: Hist√≥rico completo e an√°lise avan√ßada com IA"})]})]})};export{Fe as default};
