import{c as De,j as e,r as v,u as Te,m as Me,a as Pe,s as $,k as Ee}from"./main-XRKQFEIr.js";import{m as W,B as f}from"./button-D4bIZ4Ty.js";import{C as u}from"./card-BEk2G2Us.js";import{I as b}from"./input-BrWaMOrb.js";import{L as x}from"./label-_ADcUmGf.js";import{T as G}from"./textarea-wXaf8p7F.js";import{B as g}from"./SidebarPremium-BnsbfpCV.js";import{T as Fe,a as Qe,b as ae}from"./tabs-D66ljSV7.js";import{S as H,a as U,b as X,c as J,d as A}from"./select-BDOb0ZK1.js";import{u as Le}from"./use-toast-Cv69gxoh.js";import{c as _}from"./utils-gX3u9bFQ.js";import{F as pe}from"./file-text-tq0U235S.js";import{S as Y}from"./square-check-big-DO1dpip8.js";import{G as je,S as V}from"./switch-F5JHdijQ.js";import{C as te}from"./chevron-right-C-DpTlMS.js";import"./checkbox-DMTpvyPR.js";import{P}from"./plus-DVhNLwZX.js";import{T as Z}from"./trash-2-BFBmoqwg.js";import{S as Ve}from"./slider-BDrQLPNX.js";import{D as Ie,a as _e,b as ze,c as Oe}from"./dialog-B2ShbSiF.js";import{C as $e}from"./clock-BXvepPh_.js";import{B as ue}from"./book-open-CAn3t7Hm.js";import{T as Re}from"./trending-up-eowzUgXK.js";import{C as ie}from"./circle-check-Dt8a2DkT.js";import{C as le}from"./circle-x-5o3wj-UJ.js";import{C as he}from"./circle-alert-CmSW_OAP.js";import{A as Be}from"./arrow-left-faOheEeC.js";import{E as Ge}from"./eye-DrCLqRJv.js";import{S as Ke}from"./save-i4jRp2ou.js";import{S as We}from"./settings-pQ42cErW.js";import"./bell-v36tl0On.js";import"./user-CCHLYTsx.js";import"./users-DP4-CTtE.js";import"./graduation-cap-CRbvieNe.js";import"./index-e3XtT_BD.js";import"./chart-column-CBFsA3dh.js";import"./x-BPPDjH10.js";import"./Combination-TYhCc4jv.js";import"./index-ysAnX8Hi.js";import"./index-B_kCUa_t.js";import"./chevron-down--5IVxs-k.js";import"./check-Cifhij8e.js";import"./chevron-up-Bc2ZkTy5.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],ge=De("grip-vertical",He),Ue=({selectedType:a,onSelectType:d})=>{const n=[{id:"open",name:"Atividade Aberta",subtitle:"Dissertativa",icon:pe,color:"from-green-500 to-emerald-600",description:"QuestÃµes dissertativas com respostas textuais",features:["Respostas escritas pelos alunos","CorreÃ§Ã£o manual com rubricas","AnÃ¡lise de antiplÃ¡gio disponÃ­vel"],idealFor:"AnÃ¡lises, redaÃ§Ãµes, explicaÃ§Ãµes detalhadas"},{id:"closed",name:"Atividade Fechada",subtitle:"Objetiva",icon:Y,color:"from-blue-500 to-cyan-600",description:"QuestÃµes de mÃºltipla escolha",features:["Alternativas prÃ©-definidas","CorreÃ§Ã£o automÃ¡tica instantÃ¢nea","Feedback imediato para alunos"],idealFor:"Testes, quizzes, avaliaÃ§Ãµes rÃ¡pidas"},{id:"mixed",name:"Atividade Mista",subtitle:"HÃ­brida",icon:je,color:"from-purple-500 to-pink-600",description:"Combina questÃµes abertas e fechadas",features:["Flexibilidade mÃ¡xima","Parte automÃ¡tica + parte manual","AvaliaÃ§Ã£o completa e versÃ¡til"],idealFor:"Provas completas, avaliaÃ§Ãµes abrangentes"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Escolha o Tipo de Atividade"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Selecione o formato que melhor se adequa Ã  sua avaliaÃ§Ã£o. VocÃª nÃ£o poderÃ¡ mudar apÃ³s salvar."})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:n.map((r,t)=>{const j=r.icon,N=a===r.id;return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:e.jsx(u,{className:_("p-6 cursor-pointer transition-all duration-200 hover:shadow-xl",N&&"ring-2 ring-blue-500 shadow-xl"),onClick:()=>d(r.id),children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:_("p-4 rounded-xl bg-gradient-to-br",r.color,"flex-shrink-0"),children:e.jsx(j,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:r.name}),e.jsx(g,{variant:"outline",children:r.subtitle})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:r.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"CaracterÃ­sticas:"}),e.jsx("ul",{className:"space-y-1",children:r.features.map((y,w)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(te,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-green-500"}),e.jsx("span",{children:y})]},w))})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:"Ideal para:"}),e.jsx("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:r.idealFor})]})]}),N&&e.jsx(W.div,{initial:{scale:0},animate:{scale:1},className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-white"})})})]})})},r.id)})}),a&&e.jsx(W.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx(g,{className:"bg-green-100 text-green-700 px-4 py-2",children:"âœ“ Tipo selecionado! Continue preenchendo as informaÃ§Ãµes bÃ¡sicas."})})]})},ve=({questions:a,setQuestions:d,maxScore:n})=>{const r=()=>{d([...a,{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,image:null,attachments:[],rubric:[],expectedAnswer:""}])},t=(o,s,l)=>{d(a.map(c=>c.id===o?{...c,[s]:l}:c))},j=o=>{d(a.filter(s=>s.id!==o))},N=o=>{d(a.map(s=>s.id===o?{...s,rubric:[...s.rubric||[],{id:Date.now(),name:"",description:"",maxPoints:0}]}:s))},y=(o,s,l,c)=>{d(a.map(m=>m.id===o?{...m,rubric:m.rubric.map(h=>h.id===s?{...h,[l]:c}:h)}:m))},w=(o,s)=>{d(a.map(l=>l.id===o?{...l,rubric:l.rubric.filter(c=>c.id!==s)}:l))},D=a.reduce((o,s)=>o+(parseFloat(s.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"QuestÃµes Abertas (Dissertativas)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[a.length," questÃ£o(Ãµes) â€¢ Total: ",D.toFixed(1)," pontos",n&&Math.abs(D-n)>.1&&e.jsxs(g,{variant:"destructive",className:"ml-2",children:["Meta: ",n," pontos"]})]})]}),e.jsxs(f,{onClick:r,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Adicionar QuestÃ£o"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma questÃ£o adicionada ainda."}),e.jsxs(f,{onClick:r,variant:"outline",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Criar Primeira QuestÃ£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((o,s)=>e.jsx(u,{className:"p-6 border-l-4 border-l-green-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-gray-400 cursor-move"}),e.jsxs(g,{className:"bg-green-100 text-green-700",children:["Q",s+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Enunciado da QuestÃ£o *"}),e.jsx(G,{placeholder:"Digite o enunciado da questÃ£o...",value:o.text,onChange:l=>t(o.id,"text",l.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"PontuaÃ§Ã£o *"}),e.jsx(b,{type:"number",step:"0.1",min:"0",value:o.points,onChange:l=>t(o.id,"points",parseFloat(l.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"MÃ¡x. Linhas"}),e.jsx(b,{type:"number",placeholder:"Ilimitado",value:o.maxLines||"",onChange:l=>t(o.id,"maxLines",l.target.value?parseInt(l.target.value):null),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"MÃ¡x. Caracteres"}),e.jsx(b,{type:"number",placeholder:"Ilimitado",value:o.maxCharacters||"",onChange:l=>t(o.id,"maxCharacters",l.target.value?parseInt(l.target.value):null),className:"mt-1"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(x,{children:"Rubrica de AvaliaÃ§Ã£o (Opcional)"}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>N(o.id),children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Adicionar CritÃ©rio"]})]}),o.rubric&&o.rubric.length>0&&e.jsx("div",{className:"space-y-3",children:o.rubric.map(l=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(b,{placeholder:"Nome do critÃ©rio",value:l.name,onChange:c=>y(o.id,l.id,"name",c.target.value)}),e.jsx(b,{placeholder:"DescriÃ§Ã£o",value:l.description,onChange:c=>y(o.id,l.id,"description",c.target.value)}),e.jsx(b,{type:"number",step:"0.1",placeholder:"Pontos mÃ¡ximos",value:l.maxPoints,onChange:c=>y(o.id,l.id,"maxPoints",parseFloat(c.target.value))})]}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>w(o.id,l.id),children:e.jsx(Z,{className:"w-4 h-4 text-red-500"})})]},l.id))})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Resposta Esperada (Gabarito - Opcional)"}),e.jsx(G,{placeholder:"Digite uma resposta de referÃªncia para consulta durante correÃ§Ã£o...",value:o.expectedAnswer,onChange:l=>t(o.id,"expectedAnswer",l.target.value),className:"mt-1 min-h-[80px]"})]})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>j(o.id),children:e.jsx(Z,{className:"w-5 h-5 text-red-500"})})]})},o.id))})]})})},fe=({questions:a,setQuestions:d,maxScore:n})=>{const r=()=>{d([...a,{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:"",hint:""}])},t=(s,l,c)=>{d(a.map(m=>m.id===s?{...m,[l]:c}:m))},j=s=>{d(a.filter(l=>l.id!==s))},N=s=>{d(a.map(l=>{if(l.id===s){const c=String.fromCharCode(65+l.alternatives.length);return{...l,alternatives:[...l.alternatives,{id:Date.now(),letter:c,text:"",isCorrect:!1}]}}return l}))},y=(s,l,c,m)=>{d(a.map(h=>h.id===s?{...h,alternatives:h.alternatives.map(L=>L.id===l?{...L,[c]:m}:L)}:h))},w=(s,l)=>{d(a.map(c=>{if(c.id===s&&c.alternatives.length>2){const m=c.alternatives.filter(h=>h.id!==l);return{...c,alternatives:m.map((h,L)=>({...h,letter:String.fromCharCode(65+L)}))}}return c}))},D=(s,l)=>{console.log("[ClosedQuestions] âœ… Marcando alternativa como correta:",{questionId:s,altId:l}),d(a.map(c=>{if(c.id===s){const m={...c,alternatives:c.alternatives.map(h=>({...h,isCorrect:h.id===l}))};return console.log("[ClosedQuestions] QuestÃ£o atualizada:",m),m}return c}))},o=a.reduce((s,l)=>s+(parseFloat(l.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"QuestÃµes Fechadas (Objetivas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:[a.length," questÃ£o(Ãµes) â€¢ Total: ",o.toFixed(1)," pontos"]}),n&&Math.abs(o-n)>.1&&e.jsxs(g,{variant:"destructive",className:"ml-2",children:["Meta: ",n," pontos"]})]})]}),e.jsxs(f,{onClick:r,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Adicionar QuestÃ£o"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma questÃ£o adicionada ainda."}),e.jsxs(f,{onClick:r,variant:"outline",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Criar Primeira QuestÃ£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((s,l)=>{const c=s.alternatives?.some(m=>m.isCorrect);return e.jsx(u,{className:"p-6 border-l-4 border-l-blue-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-gray-400 cursor-move"}),e.jsxs(g,{className:"bg-blue-100 text-blue-700",children:["Q",l+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Enunciado da QuestÃ£o *"}),e.jsx(G,{placeholder:"Digite o enunciado da questÃ£o...",value:s.text,onChange:m=>t(s.id,"text",m.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"PontuaÃ§Ã£o *"}),e.jsx(b,{type:"number",step:"0.1",min:"0",value:s.points,onChange:m=>t(s.id,"points",parseFloat(m.target.value)),className:"mt-1 w-32"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(x,{children:["Alternativas *",!c&&e.jsx(g,{variant:"destructive",className:"ml-2",children:"Marque a correta"})]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>N(s.id),children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Adicionar Alternativa"]})]}),e.jsx("div",{className:"space-y-3",children:s.alternatives?.map(m=>e.jsxs("div",{className:"flex gap-3 items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-${s.id}`,checked:m.isCorrect,onChange:()=>D(s.id,m.id),className:"w-5 h-5 cursor-pointer",title:"Marcar como correta"}),e.jsx(g,{variant:"outline",className:"w-8 justify-center",children:m.letter})]}),e.jsx(b,{placeholder:"Texto da alternativa",value:m.text,onChange:h=>y(s.id,m.id,"text",h.target.value),className:"flex-1"}),s.alternatives.length>2&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>w(s.id,m.id),children:e.jsx(Z,{className:"w-4 h-4 text-red-500"})})]},m.id))})]}),e.jsxs("div",{children:[e.jsx(x,{children:"ExplicaÃ§Ã£o da Resposta Correta (Opcional)"}),e.jsx(G,{placeholder:"Explique por que a alternativa estÃ¡ correta...",value:s.explanation,onChange:m=>t(s.id,"explanation",m.target.value),className:"mt-1 min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Dica para Alunos (Opcional)"}),e.jsx(b,{placeholder:"Uma dica que pode ajudar...",value:s.hint,onChange:m=>t(s.id,"hint",m.target.value),className:"mt-1"})]})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>j(s.id),children:e.jsx(Z,{className:"w-5 h-5 text-red-500"})})]})},s.id)})})]})})},Xe=({questions:a,setQuestions:d,maxScore:n})=>{const[r,t]=v.useState("open"),j=a.filter(s=>s.type==="open"),N=a.filter(s=>s.type==="closed"),y=s=>{const l=s==="open"?{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,rubric:[],expectedAnswer:""}:{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:""};d([...a,l])},w=a.reduce((s,l)=>s+(parseFloat(l.points)||0),0),D=j.length>0?(j.reduce((s,l)=>s+l.points,0)/w*100).toFixed(0):0,o=N.length>0?(N.reduce((s,l)=>s+l.points,0)/w*100).toFixed(0):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"QuestÃµes Mistas"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:[a.length," questÃ£o(Ãµes) total"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[j.length," Abertas (",D,"%)"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[N.length," Fechadas (",o,"%)"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Total: ",w.toFixed(1)," pontos"]}),n&&Math.abs(w-n)>.1&&e.jsxs(g,{variant:"destructive",className:"ml-2",children:["Meta: ",n," pontos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:()=>y("open"),variant:"outline",className:"bg-green-50",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"QuestÃ£o Aberta"]}),e.jsxs(f,{onClick:()=>y("closed"),variant:"outline",className:"bg-blue-50",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"QuestÃ£o Fechada"]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma questÃ£o adicionada ainda."}),e.jsx("p",{className:"mb-6",children:"Comece adicionando questÃµes abertas ou fechadas."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(f,{onClick:()=>y("open"),variant:"outline",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Adicionar QuestÃ£o Aberta"]}),e.jsxs(f,{onClick:()=>y("closed"),variant:"outline",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Adicionar QuestÃ£o Fechada"]})]})]}):e.jsxs(Fe,{defaultValue:"all",className:"w-full",children:[e.jsxs(Qe,{className:"grid w-full grid-cols-3",children:[e.jsxs(ae,{value:"all",children:["Todas (",a.length,")"]}),e.jsxs(ae,{value:"open",children:["Abertas (",j.length,")"]}),e.jsxs(ae,{value:"closed",children:["Fechadas (",N.length,")"]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:a.map((s,l)=>e.jsxs(u,{className:`p-4 border-l-4 ${s.type==="open"?"border-l-green-500":"border-l-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(g,{className:s.type==="open"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700",children:["Q",l+1," - ",s.type==="open"?"Aberta":"Fechada"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.points," pontos"]})]}),e.jsx("p",{className:"text-sm text-gray-700 truncate",children:s.text||"Sem enunciado"})]},s.id))})})]})]}),j.length>0&&e.jsx(ve,{questions:j,setQuestions:s=>{d([...s,...N])},maxScore:n*(D/100)}),N.length>0&&e.jsx(fe,{questions:N,setQuestions:s=>{d([...j,...s])},maxScore:n*(o/100)})]})},Je=({settings:a,setSettings:d,activityType:n})=>{const r=(t,j)=>{d({...a,[t]:j})};return e.jsxs(u,{className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ConfiguraÃ§Ãµes AvanÃ§adas"}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Envio Atrasado"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Permitir Envio Atrasado"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos poderÃ£o submeter apÃ³s o prazo"})]}),e.jsx(V,{checked:a.allowLateSubmission,onCheckedChange:t=>r("allowLateSubmission",t)})]}),a.allowLateSubmission&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Tipo de Penalidade"}),e.jsxs(H,{value:a.latePenaltyType,onValueChange:t=>r("latePenaltyType",t),children:[e.jsx(U,{className:"mt-1",children:e.jsx(X,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"percentage",children:"Percentual"}),e.jsx(A,{value:"points",children:"Pontos Fixos"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Valor da Penalidade"}),e.jsx(b,{type:"number",value:a.latePenaltyValue,onChange:t=>r("latePenaltyValue",parseFloat(t.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"MÃ¡ximo de Dias Atrasados"}),e.jsx(b,{type:"number",value:a.maxLateDays,onChange:t=>r("maxLateDays",parseInt(t.target.value)),className:"mt-1"})]})]})]}),(n==="closed"||n==="quiz"||n==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"MÃºltiplas Tentativas"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Permitir MÃºltiplas Tentativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos podem refazer a atividade"})]}),e.jsx(V,{checked:a.allowMultipleAttempts,onCheckedChange:t=>r("allowMultipleAttempts",t)})]}),a.allowMultipleAttempts&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(x,{children:"MÃ¡ximo de Tentativas"}),e.jsx(b,{type:"number",min:"1",value:a.maxAttempts,onChange:t=>r("maxAttempts",parseInt(t.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Considerar"}),e.jsxs(H,{value:a.attemptScoring,onValueChange:t=>r("attemptScoring",t),children:[e.jsx(U,{className:"mt-1",children:e.jsx(X,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"best",children:"Melhor Nota"}),e.jsx(A,{value:"last",children:"Ãšltima Nota"}),e.jsx(A,{value:"average",children:"MÃ©dia"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Tempo Limite"}),e.jsxs("div",{children:[e.jsx(x,{children:"Tempo MÃ¡ximo (minutos)"}),e.jsx(b,{type:"number",placeholder:"Ilimitado",value:a.timeLimit||"",onChange:t=>r("timeLimit",t.target.value?parseInt(t.target.value):null),className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Deixe vazio para sem limite"})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Feedback e Gabarito"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Mostrar nota imediatamente"}),e.jsx(V,{checked:a.showScoreImmediately,onCheckedChange:t=>r("showScoreImmediately",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Mostrar gabarito apÃ³s submissÃ£o"}),e.jsx(V,{checked:a.showAnswerKey,onCheckedChange:t=>r("showAnswerKey",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Liberar gabarito apÃ³s prazo"}),e.jsx(V,{checked:a.releaseAnswerAfterDeadline,onCheckedChange:t=>r("releaseAnswerAfterDeadline",t)})]})]})]}),(n==="open"||n==="assignment"||n==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"AntiplÃ¡gio"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Ativar DetecÃ§Ã£o de AntiplÃ¡gio"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verificar originalidade das respostas"})]}),e.jsx(V,{checked:a.plagiarismEnabled,onCheckedChange:t=>r("plagiarismEnabled",t)})]}),a.plagiarismEnabled&&e.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Sensibilidade"}),e.jsxs(H,{value:a.plagiarismSensitivity,onValueChange:t=>r("plagiarismSensitivity",t),children:[e.jsx(U,{className:"mt-1",children:e.jsx(X,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"low",children:"Baixa"}),e.jsx(A,{value:"medium",children:"MÃ©dia"}),e.jsx(A,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{children:[e.jsxs(x,{children:["Originalidade MÃ­nima: ",a.plagiarismMinOriginality,"%"]}),e.jsx(Ve,{value:[a.plagiarismMinOriginality],onValueChange:t=>r("plagiarismMinOriginality",t[0]),min:0,max:100,step:5,className:"mt-2"})]})]})]}),(n==="closed"||n==="quiz"||n==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"RandomizaÃ§Ã£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Embaralhar QuestÃµes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cada aluno vÃª ordem diferente"})]}),e.jsx(V,{checked:a.shuffleQuestions,onCheckedChange:t=>r("shuffleQuestions",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Embaralhar Alternativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ordem aleatÃ³ria das opÃ§Ãµes"})]}),e.jsx(V,{checked:a.shuffleAlternatives,onCheckedChange:t=>r("shuffleAlternatives",t)})]})]})]})]})},Ye=({activity:a,onClose:d})=>e.jsx(Ie,{open:!0,onOpenChange:d,children:e.jsxs(_e,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ze,{children:e.jsx(Oe,{children:"PrÃ©via da Atividade"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(g,{children:a.type}),e.jsx(g,{variant:"outline",children:a.difficulty}),a.estimatedTime&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx($e,{className:"w-4 h-4"}),a.estimatedTime," min"]})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:a.title||"Sem tÃ­tulo"}),e.jsx("p",{className:"text-gray-600",children:a.description||"Sem descriÃ§Ã£o"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ue,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Disciplina"})]}),e.jsx("p",{className:"font-semibold",children:a.subject||"NÃ£o definida"})]}),e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"PontuaÃ§Ã£o"})]}),e.jsxs("p",{className:"font-semibold",children:[a.maxScore," pontos"]})]}),e.jsxs(u,{className:"p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm text-gray-600",children:"QuestÃµes"})}),e.jsxs("p",{className:"font-semibold",children:[a.questions?.length||0," questÃµes"]})]})]}),a.tags&&a.tags.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"TÃ³picos"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map((n,r)=>e.jsxs(g,{variant:"secondary",children:["#",n]},r))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:"QuestÃµes"}),a.questions&&a.questions.length>0?e.jsx("div",{className:"space-y-6",children:a.questions.map((n,r)=>e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(g,{children:r+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(g,{variant:"outline",children:n.type==="open"?"Dissertativa":"MÃºltipla Escolha"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:[n.points," ponto(s)"]})]}),e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:n.text})]})]}),n.type==="closed"&&n.alternatives&&e.jsx("div",{className:"space-y-2 mt-4 pl-8",children:n.alternatives.map(t=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded hover:bg-gray-50",children:[e.jsxs("span",{className:"font-semibold text-gray-600",children:[t.letter,")"]}),e.jsx("span",{className:t.isCorrect?"font-semibold text-green-600":"",children:t.text})]},t.id))}),n.type==="open"&&(n.maxLines||n.maxCharacters)&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600 pl-8",children:[n.maxLines&&e.jsxs("p",{children:["MÃ¡ximo de ",n.maxLines," linhas"]}),n.maxCharacters&&e.jsxs("p",{children:["MÃ¡ximo de ",n.maxCharacters," caracteres"]})]})]},r))}):e.jsx("p",{className:"text-center py-8 text-gray-500",children:"Nenhuma questÃ£o adicionada"})]}),a.advancedSettings&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"ConfiguraÃ§Ãµes"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[a.advancedSettings.allowLateSubmission&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Permite envio atrasado"})]}),a.advancedSettings.allowMultipleAttempts&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{children:["MÃºltiplas tentativas: ",a.advancedSettings.maxAttempts]})]}),a.advancedSettings.timeLimit&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsxs("span",{children:["Tempo limite: ",a.advancedSettings.timeLimit," min"]})]}),a.advancedSettings.plagiarismEnabled&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{children:"AntiplÃ¡gio ativado"})]})]})]})]})]})}),Ze=({errors:a,warnings:d,onValidate:n,onNavigateToError:r})=>e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ValidaÃ§Ã£o da Atividade"}),e.jsx("p",{className:"text-gray-600",children:"Verifique se sua atividade estÃ¡ pronta para ser publicada"})]}),e.jsx(f,{onClick:n,className:"w-full",children:"Executar ValidaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(u,{className:"p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ie,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"VÃ¡lido"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.length===0?"âœ“":"â€”"})]}),e.jsxs(u,{className:"p-4 bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Erros"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.length})]}),e.jsxs(u,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(he,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Avisos"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:d.length})]})]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(le,{className:"w-5 h-5 text-red-600"}),e.jsxs("h3",{className:"font-semibold text-red-600",children:["Erros CrÃ­ticos (",a.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:a.map((t,j)=>e.jsx(u,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-l-red-500 cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>r(t.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(g,{variant:"destructive",className:"mb-2",children:t.field}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:t.message})]}),e.jsx(te,{className:"w-5 h-5 text-red-600 flex-shrink-0"})]})},j))}),e.jsx("p",{className:"text-sm text-red-600 mt-3",children:"âŒ Corrija todos os erros antes de publicar a atividade."})]}),d.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(he,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("h3",{className:"font-semibold text-yellow-600",children:["Avisos (",d.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:d.map((t,j)=>e.jsx(u,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-l-yellow-500 cursor-pointer hover:bg-yellow-100 transition-colors",onClick:()=>r(t.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(g,{variant:"outline",className:"mb-2 border-yellow-600 text-yellow-700",children:t.field}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:t.message})]}),e.jsx(te,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"})]})},j))}),e.jsx("p",{className:"text-sm text-yellow-600 mt-3",children:"âš ï¸ Avisos nÃ£o impedem a publicaÃ§Ã£o, mas Ã© recomendado corrigi-los."})]}),a.length===0&&d.length===0&&e.jsx(u,{className:"p-6 bg-green-50 dark:bg-green-900/20 border-2 border-green-500",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800 dark:text-green-200",children:"Atividade Pronta!"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Sua atividade estÃ¡ vÃ¡lida e pronta para ser publicada."})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Checklist Geral"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{checked:a.filter(t=>t.field==="title").length===0,label:"TÃ­tulo vÃ¡lido"}),e.jsx(R,{checked:a.filter(t=>t.field==="description").length===0,label:"DescriÃ§Ã£o vÃ¡lida"}),e.jsx(R,{checked:a.filter(t=>t.field==="questions").length===0,label:"Pelo menos uma questÃ£o"}),e.jsx(R,{checked:a.filter(t=>t.field.startsWith("question")).length===0,label:"Todas as questÃµes vÃ¡lidas"}),e.jsx(R,{checked:d.filter(t=>t.field==="tags").length===0,label:"Tags adicionadas",warning:!0}),e.jsx(R,{checked:d.filter(t=>t.field==="score").length===0,label:"PontuaÃ§Ã£o consistente",warning:!0})]})]})]})}),R=({checked:a,label:d,warning:n=!1})=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800",children:[a?e.jsx(ie,{className:`w-5 h-5 ${n?"text-yellow-600":"text-green-600"}`}):e.jsx(le,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:`text-sm ${a?"text-gray-900 dark:text-gray-100":"text-gray-500"}`,children:d})]}),Bs=()=>{const a=Te(),{id:d}=Me(),{user:n}=Pe(),{toast:r}=Le(),t=!!d,[j,N]=v.useState(t),[y,w]=v.useState(!1),[D,o]=v.useState(null),[s,l]=v.useState(null),[c,m]=v.useState(""),[h,L]=v.useState(""),[z,re]=v.useState(""),[E,q]=v.useState([]),[B,ne]=v.useState("medium"),[O,ce]=v.useState(""),[T,de]=v.useState(10),[C,K]=v.useState([]),[I,oe]=v.useState({allowLateSubmission:!1,latePenaltyType:"percentage",latePenaltyValue:10,maxLateDays:7,allowMultipleAttempts:!1,maxAttempts:1,attemptScoring:"best",timeLimit:null,showScoreImmediately:!0,showAnswerKey:!1,releaseAnswerAfterDeadline:!0,plagiarismEnabled:!1,plagiarismSensitivity:"medium",plagiarismMinOriginality:70,shuffleQuestions:!1,shuffleAlternatives:!1}),[S,F]=v.useState("basics"),[be,me]=v.useState(!1),[ee,Ne]=v.useState([]),[se,ye]=v.useState([]);v.useEffect(()=>{if(!s)return;const i=setInterval(()=>{Ce()},6e4);return()=>clearInterval(i)},[s,c,h,C,I]),v.useEffect(()=>{t&&we()},[d]);const we=async()=>{try{N(!0);const{data:i,error:p}=await $.from("activities").select("*").eq("id",d).single();if(p)throw p;l(i.type),m(i.title),L(i.description||""),re(i.content?.subject||""),q(i.content?.tags||[]),ne(i.content?.difficulty||"medium"),ce(i.content?.estimated_time||""),de(i.max_score||10),K(i.content?.questions||[]),i.content?.advanced_settings&&oe(i.content.advanced_settings),r({title:"Atividade carregada",description:"VocÃª pode editar e salvar as alteraÃ§Ãµes."})}catch(i){console.error("Erro ao carregar atividade:",i),r({title:"Erro",description:"NÃ£o foi possÃ­vel carregar a atividade.",variant:"destructive"}),a("/dashboard/activities")}finally{N(!1)}},Ce=async()=>{if(!(!c||!s))try{const i={title:c,description:h,type:s,max_score:T,status:"draft",content:{subject:z,tags:E,difficulty:B,estimated_time:O,questions:C,advanced_settings:I},created_by:n.id,updated_at:new Date().toISOString()};if(t){const{error:p}=await $.from("activities").update(i).eq("id",d);if(p)throw p}o(new Date)}catch(i){console.error("Erro no auto-save:",i)}},xe=()=>{const i=[],p=[];(!c||c.trim().length<3)&&i.push({field:"title",message:"TÃ­tulo deve ter pelo menos 3 caracteres"}),(!h||h.trim().length<10)&&i.push({field:"description",message:"DescriÃ§Ã£o deve ter pelo menos 10 caracteres"}),C.length===0&&i.push({field:"questions",message:"Adicione pelo menos uma questÃ£o"}),C.forEach((k,M)=>{(!k.text||k.text.trim().length<5)&&i.push({field:`question-${M}`,message:`QuestÃ£o ${M+1}: enunciado muito curto`}),(!k.points||k.points<=0)&&i.push({field:`question-${M}`,message:`QuestÃ£o ${M+1}: pontuaÃ§Ã£o invÃ¡lida`}),(s==="closed"||s==="quiz")&&k.type==="closed"&&((!k.alternatives||k.alternatives.length<2)&&i.push({field:`question-${M}`,message:`QuestÃ£o ${M+1}: deve ter pelo menos 2 alternativas`}),(k.alternatives?.filter(Se=>Se.isCorrect)||[]).length===0&&i.push({field:`question-${M}`,message:`QuestÃ£o ${M+1}: marque pelo menos uma alternativa correta`}))}),E.length===0&&p.push({field:"tags",message:"Considere adicionar tags para facilitar a organizaÃ§Ã£o"}),O||p.push({field:"time",message:"Tempo estimado nÃ£o definido"});const Q=C.reduce((k,M)=>k+(M.points||0),0);return Math.abs(Q-T)>.1&&p.push({field:"score",message:`Soma das questÃµes (${Q}) difere da pontuaÃ§Ã£o mÃ¡xima (${T})`}),Ne(i),ye(p),i.length===0},ke=async()=>{try{w(!0);const i={title:c,description:h,type:s,max_score:T,status:"draft",content:{subject:z,tags:E,difficulty:B,estimated_time:O,questions:C,advanced_settings:I},created_by:n.id,updated_at:new Date().toISOString()};if(console.log("[TeacherActivityCreatePage] ðŸ’¾ Salvando atividade:",{title:c,type:s,questionsCount:C.length,advancedSettings:I}),t){const{error:p}=await $.from("activities").update(i).eq("id",d);if(p)throw p;r({title:"Rascunho salvo",description:"Suas alteraÃ§Ãµes foram salvas."})}else{const{data:p,error:Q}=await $.from("activities").insert(i).select().single();if(Q)throw Q;r({title:"Rascunho salvo",description:"VocÃª pode continuar editando depois."}),a(`/teacher/activities/${p.id}/edit`,{replace:!0})}o(new Date)}catch(i){console.error("Erro ao salvar rascunho:",i),r({title:"Erro",description:"NÃ£o foi possÃ­vel salvar o rascunho.",variant:"destructive"})}finally{w(!1)}},Ae=async()=>{if(!xe()){r({title:"ValidaÃ§Ã£o falhou",description:"Corrija os erros antes de publicar.",variant:"destructive"});return}if(!(se.length>0&&!window.confirm(`HÃ¡ ${se.length} aviso(s). Deseja publicar mesmo assim?`)))try{w(!0);const i={title:c,description:h,type:s,max_score:T,status:"published",is_published:!0,content:{subject:z,tags:E,difficulty:B,estimated_time:O,questions:C,advanced_settings:I},created_by:n.id,updated_at:new Date().toISOString()};if(t){const{error:p}=await $.from("activities").update(i).eq("id",d);if(p)throw p}else{const{data:p,error:Q}=await $.from("activities").insert(i).select().single();if(Q)throw Q}r({title:"Atividade publicada!",description:"Agora vocÃª pode postar em suas turmas."}),a("/dashboard/activities")}catch(i){console.error("Erro ao publicar:",i),r({title:"Erro",description:"NÃ£o foi possÃ­vel publicar a atividade.",variant:"destructive"})}finally{w(!1)}};return j?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ee,{size:"lg",text:"Carregando atividade..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>a("/dashboard/activities"),children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:t?`Editar: ${c||"Atividade"}`:"Criar Nova Atividade"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(g,{variant:s?"default":"secondary",children:s||"Tipo nÃ£o definido"}),e.jsx(g,{variant:"outline",children:t?"Editando":"Nova"}),D&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Salvo ",Math.floor((new Date-D)/1e3),"s atrÃ¡s"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(f,{variant:"outline",onClick:()=>me(!0),disabled:!s,children:[e.jsx(Ge,{className:"w-5 h-5 mr-2"}),"PrÃ©via"]}),e.jsxs(f,{variant:"outline",onClick:ke,disabled:y||!s,children:[e.jsx(Ke,{className:"w-5 h-5 mr-2"}),y?"Salvando...":"Salvar Rascunho"]}),e.jsxs(f,{onClick:Ae,disabled:y||!s,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),t?"Salvar AlteraÃ§Ãµes":"Publicar Atividade"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(u,{className:"p-4 sticky top-6",children:e.jsxs("nav",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>F("type"),className:_("w-full text-left px-4 py-2 rounded-lg transition-colors",S==="type"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:t,children:[e.jsx(je,{className:"w-4 h-4 inline mr-2"}),"Tipo de Atividade"]}),e.jsxs("button",{onClick:()=>F("basics"),className:_("w-full text-left px-4 py-2 rounded-lg transition-colors",S==="basics"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(ue,{className:"w-4 h-4 inline mr-2"}),"InformaÃ§Ãµes BÃ¡sicas"]}),e.jsxs("button",{onClick:()=>F("questions"),className:_("w-full text-left px-4 py-2 rounded-lg transition-colors",S==="questions"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:!s,children:[e.jsx(pe,{className:"w-4 h-4 inline mr-2"}),"QuestÃµes (",C.length,")"]}),e.jsxs("button",{onClick:()=>F("advanced"),className:_("w-full text-left px-4 py-2 rounded-lg transition-colors",S==="advanced"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(We,{className:"w-4 h-4 inline mr-2"}),"ConfiguraÃ§Ãµes"]}),e.jsxs("button",{onClick:()=>F("validation"),className:_("w-full text-left px-4 py-2 rounded-lg transition-colors",S==="validation"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(Y,{className:"w-4 h-4 inline mr-2"}),"ValidaÃ§Ã£o",ee.length>0&&e.jsx(g,{variant:"destructive",className:"ml-2",children:ee.length})]})]})})}),e.jsx("div",{className:"col-span-9",children:e.jsxs(W.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[S==="type"&&!t&&e.jsx(Ue,{selectedType:s,onSelectType:i=>{l(i),F("basics")}}),S==="basics"&&e.jsxs(u,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"InformaÃ§Ãµes BÃ¡sicas"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"title",children:"TÃ­tulo da Atividade *"}),e.jsx(b,{id:"title",placeholder:"Ex: AvaliaÃ§Ã£o de Ãlgebra Linear - Unidade 2",value:c,onChange:i=>m(i.target.value),className:"mt-1",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/200 caracteres"]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"description",children:"DescriÃ§Ã£o *"}),e.jsx(G,{id:"description",placeholder:"Descreva o objetivo e instruÃ§Ãµes gerais da atividade...",value:h,onChange:i=>L(i.target.value),className:"mt-1 min-h-[120px]",maxLength:2e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[h.length,"/2000 caracteres"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"subject",children:"Disciplina/MatÃ©ria *"}),e.jsx(b,{id:"subject",placeholder:"Ex: MatemÃ¡tica",value:z,onChange:i=>re(i.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"difficulty",children:"Dificuldade"}),e.jsxs(H,{value:B,onValueChange:ne,children:[e.jsx(U,{className:"mt-1",children:e.jsx(X,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"easy",children:"FÃ¡cil"}),e.jsx(A,{value:"medium",children:"MÃ©dia"}),e.jsx(A,{value:"hard",children:"DifÃ­cil"}),e.jsx(A,{value:"very_hard",children:"Muito DifÃ­cil"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"time",children:"Tempo Estimado (minutos)"}),e.jsx(b,{id:"time",type:"number",placeholder:"45",value:O,onChange:i=>ce(i.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"maxScore",children:"PontuaÃ§Ã£o MÃ¡xima Total *"}),e.jsx(b,{id:"maxScore",type:"number",step:"0.1",min:"0.1",max:"100",value:T,onChange:i=>de(parseFloat(i.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"tags",children:"TÃ³picos/Tags"}),e.jsx(b,{id:"tags",placeholder:"Pressione Enter para adicionar (Ex: Ãlgebra, Matrizes)",onKeyDown:i=>{i.key==="Enter"&&i.target.value.trim()&&(i.preventDefault(),E.includes(i.target.value.trim())||(q([...E,i.target.value.trim()]),i.target.value=""))},className:"mt-1"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:E.map((i,p)=>e.jsxs(g,{variant:"secondary",className:"cursor-pointer hover:bg-red-100",onClick:()=>q(E.filter((Q,k)=>k!==p)),children:["#",i," Ã—"]},p))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(f,{onClick:()=>F("questions"),disabled:!c||!h||!z,children:"PrÃ³ximo: Adicionar QuestÃµes"})})]})]}),S==="questions"&&s&&e.jsxs(e.Fragment,{children:[(s==="open"||s==="assignment")&&e.jsx(ve,{questions:C,setQuestions:K,maxScore:T}),(s==="closed"||s==="quiz")&&e.jsx(fe,{questions:C,setQuestions:K,maxScore:T}),(s==="mixed"||s==="project")&&e.jsx(Xe,{questions:C,setQuestions:K,maxScore:T})]}),S==="advanced"&&e.jsx(Je,{settings:I,setSettings:oe,activityType:s}),S==="validation"&&e.jsx(Ze,{errors:ee,warnings:se,onValidate:xe,onNavigateToError:i=>{i.startsWith("question")?F("questions"):["title","description","subject"].includes(i)&&F("basics")}})]},S)})]}),be&&e.jsx(Ye,{activity:{title:c,description:h,type:s,subject:z,tags:E,difficulty:B,estimatedTime:O,maxScore:T,questions:C,advancedSettings:I},onClose:()=>me(!1)})]})};export{Bs as default};
