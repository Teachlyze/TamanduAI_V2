import{c as k,k as P,u as $,r,s as S,j as e,i as q}from"./main-BYt0atFx.js";import{B as V,C as Q}from"./card-OcUoX-wQ.js";import{D as R,g}from"./dropdown-menu-SP7CzJJe.js";import{S as x}from"./StatsCard-CeLbUark.js";import{E as U}from"./EmptyState-Bdw76lE5.js";import{S as H}from"./SearchInput-DluosGzB.js";import{D as O}from"./DataTable-DK3Pvz1t.js";import"./label-Co3Fv3aZ.js";import{C as _}from"./classService-DDEMbQ3F.js";import{A as W}from"./arrow-left-BLRXZrhk.js";import{T as m}from"./trending-up-CFHDi0Ep.js";import"./index-B8z1bzn5.js";import"./chevron-right-D-kejNpi.js";import"./x-D6AaFmWt.js";import"./badge-CqY1vF3c.js";import"./chevron-down-CQZHTFv6.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M5 12h14",key:"1ays0h"}]],K=k("minus",J);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],C=k("trending-down",X),xe=()=>{const{classId:l}=P(),w=$(),[E,b]=r.useState(!0),[L,M]=r.useState(null),[h,D]=r.useState([]),[j,y]=r.useState([]),[u,F]=r.useState(""),[d,I]=r.useState({average:0,highest:0,lowest:0,totalGrades:0});r.useEffect(()=>{A()},[l]),r.useEffect(()=>{T()},[h,u]);const A=async()=>{try{b(!0);const s=await _.getClassById(l);M(s);const a=await _.getClassMembers(l,{role:"student"}),{data:i}=await S.from("activity_class_assignments").select("activity_id").eq("class_id",l),p=i?.map(t=>t.activity_id)||[],c=await Promise.all(a.map(async t=>{const{data:o}=await S.from("submissions").select("grade, activity_id").eq("user_id",t.user_id).in("activity_id",p).not("grade","is",null),v=o?.map(f=>f.grade)||[],N=v.length>0?v.reduce((f,z)=>f+z,0)/v.length:null;return{id:t.user_id,name:t.user?.name||"Sem nome",email:t.user?.email,avatar:t.user?.avatar_url,grades:o||[],average:N?Number(N.toFixed(2)):null}}));D(c);const n=c.map(t=>t.average).filter(t=>t!==null),G=n.length>0?n.reduce((t,o)=>t+o,0)/n.length:0;I({average:Number(G.toFixed(2)),highest:n.length>0?Math.max(...n):0,lowest:n.length>0?Math.min(...n):0,totalGrades:c.reduce((t,o)=>t+o.grades.length,0)})}catch(s){console.error("Erro:",s)}finally{b(!1)}},T=()=>{if(!u){y(h);return}const s=u.toLowerCase();y(h.filter(a=>a.name?.toLowerCase().includes(s)||a.email?.toLowerCase().includes(s)))},B=[{key:"name",label:"Aluno",sortable:!0,render:(s,a)=>e.jsxs("div",{className:"flex items-center gap-3",children:[a.avatar?e.jsx("img",{src:a.avatar,alt:a.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:a.name[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a.name}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:a.email})]})]})},{key:"gradesCount",label:"Notas Lançadas",sortable:!0,render:(s,a)=>a.grades.length},{key:"average",label:"Média",sortable:!0,render:(s,a)=>{if(a.average===null)return"-";const i=a.average-d.average,p=i>0?m:i<0?C:K,c=i>0?"text-green-600":i<0?"text-red-600":"text-slate-600";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg",children:a.average.toFixed(2)}),e.jsx(p,{className:`w-4 h-4 ${c}`})]})}}];return E?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(q,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(V,{variant:"ghost",onClick:()=>w(`/teacher/classes/${l}`),className:"mb-4",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(R,{title:`Notas - ${L?.name||"Turma"}`,subtitle:"Visualização de notas dos alunos",role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(x,{title:"Média da Turma",value:d.average.toFixed(2),icon:m,gradient:g.primary,format:"text",delay:0}),e.jsx(x,{title:"Maior Nota",value:d.highest.toFixed(2),icon:m,gradient:g.success,format:"text",delay:.1}),e.jsx(x,{title:"Menor Nota",value:d.lowest.toFixed(2),icon:C,gradient:g.danger,format:"text",delay:.2}),e.jsx(x,{title:"Notas Lançadas",value:d.totalGrades,icon:m,gradient:g.stats.activities,delay:.3})]}),e.jsx(Q,{className:"p-6 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800 mb-8",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:["⚠️ ",e.jsx("strong",{children:"Versão FREE:"})," Upgrade para visualização em matriz interativa e exportação em Excel/PDF."]})}),e.jsx("div",{className:"mb-8",children:e.jsx(H,{placeholder:"Buscar aluno...",value:u,onChange:F})}),j.length>0?e.jsx(O,{columns:B,data:j,sortBy:"name",sortOrder:"asc"}):e.jsx(U,{icon:m,title:"Nenhum aluno encontrado",description:"Aguardando notas dos alunos."})]})};export{xe as default};
