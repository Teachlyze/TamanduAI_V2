import{a as ce,u as oe,r,s as n,l as _,j as e,q as de}from"./main-DAPsYT4a.js";import{C as $}from"./card-CHLrcnUu.js";import{A as z}from"./ActivityCard-PQ2ioeq7.js";import{E as me}from"./EmptyState-DA4FrWll.js";import{m as F}from"./button-DFkxrTs2.js";import"./dialog-Cmv7zdkS.js";import{I as ue}from"./input-gY-F_5Pf.js";import{T as pe,a as ge,b as N}from"./tabs-Dv6sYzdL.js";import{S as P,a as R,b as B,c as G,d}from"./select-BPeLDmde.js";import{F as Q}from"./trending-up-B2-WBYxN.js";import{C as fe}from"./clock-CYIyH-Yw.js";import{C as H}from"./circle-check-CkujO_rT.js";import{T as xe}from"./triangle-alert-t8QkS9SO.js";import{S as O}from"./search-D-GL0Z3Y.js";import{d as he}from"./differenceInHours-DzWJNcba.js";import"./SidebarPremium-B0l6FvNw.js";import"./chevron-right-CgUPhRTY.js";import"./user-BscNjPFV.js";import"./settings-BMbEXDky.js";import"./index-CxoQTrGk.js";import"./house-Dx0sCuaE.js";import"./users-Bs21yf14.js";import"./graduation-cap-BRPCRZmC.js";import"./index-DTFBvU13.js";import"./chart-column-DPF3N0FI.js";import"./x-B7wPkr0Q.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-B6HbAA6N.js";import"./formatDistanceToNow-CMbiJYtj.js";import"./constructNow-re94FRT2.js";import"./differenceInCalendarMonths-FFYroMBa.js";import"./endOfDay-mJ-5sjFp.js";import"./endOfMonth-BD-g1yyK.js";import"./circle-alert-DnnpR18B.js";import"./target-CBEOxlkX.js";import"./format-BcFT9btV.js";import"./pt-BR-CuGSKEGQ.js";import"./index-D0-hv4e2.js";import"./index-CCLfHPmf.js";import"./index-Bd5NktG4.js";import"./index-CKoyZSwW.js";import"./index-B2bzlyZg.js";import"./chevron-down-gl_d4Nmb.js";import"./check-cEAmrvjJ.js";import"./chevron-up-DF4ET_PF.js";const os=()=>{const{user:c}=ce(),f=oe(),[U,y]=r.useState(!0),[T,A]=r.useState([]),[m,W]=r.useState([]),[l,J]=r.useState("all"),[x,K]=r.useState(""),[h,X]=r.useState("all"),[v,Y]=r.useState("all"),[Z,ee]=r.useState([]),[b,se]=r.useState({total:0,pending:0,completed:0,late:0,urgent:0});r.useEffect(()=>{c?.id&&(ae(),te())},[c]),r.useEffect(()=>{ie()},[T,l,x,h,v]);const te=async()=>{try{const{data:s}=await n.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),t=s?.map(p=>p.class_id)||[],{data:i}=await n.from("classes").select("id, name, subject").in("id",t);ee(i||[])}catch(s){_.error("Erro ao carregar turmas:",s)}},ae=async()=>{try{y(!0);const{data:s}=await n.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),t=s?.map(a=>a.class_id)||[];if(t.length===0){A([]),y(!1);return}const{data:i}=await n.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",t),p=i?.map(a=>a.activity_id).filter(Boolean)||[],{data:re}=await n.from("activities").select("id, title, description, type, due_date, max_score, created_at").in("id",p),{data:le}=await n.from("classes").select("id, name, subject, color").in("id",t),w={};re?.forEach(a=>{w[a.id]=a});const k={};le?.forEach(a=>{k[a.id]=a});const{data:S,error:q}=await n.from("submissions").select("activity_id, status, grade, feedback, submitted_at").eq("student_id",c.id).in("activity_id",p);q&&_.error("Erro ao buscar submissÃµes:",q),_.debug("[Activities] SubmissÃµes encontradas:",{userId:c.id,totalActivities:p.length,submissions:S?.length||0,submissionsData:S});const I={};S?.forEach(a=>{I[a.activity_id]=a});const o=(i||[]).filter(a=>w[a.activity_id]).map(a=>{const L=w[a.activity_id],C=k[a.class_id],g=I[a.activity_id],D=new Date(L.due_date),V=new Date,M=he(D,V);let j="pending";return g?j=g.status==="graded"?"completed":"submitted":D<V&&(j="late"),{...L,class_id:a.class_id,class_name:C?.name,class_subject:C?.subject,class_color:C?.color,status:j,grade:g?.grade,feedback:g?.feedback,submitted_at:g?.submitted_at,assigned_at:a.assigned_at,is_urgent:M<=24&&M>=0&&j==="pending"}}),ne={total:o.length,pending:o.filter(a=>a.status==="pending").length,completed:o.filter(a=>a.status==="completed"||a.status==="submitted").length,late:o.filter(a=>a.status==="late").length,urgent:o.filter(a=>a.is_urgent).length};se(ne),A(o)}catch(s){_.error("Erro ao carregar atividades:",s)}finally{y(!1)}},ie=()=>{let s=[...T];if(l==="pending"?s=s.filter(t=>t.status==="pending"||t.status==="late"):l==="completed"?s=s.filter(t=>t.status==="completed"||t.status==="submitted"):l==="late"&&(s=s.filter(t=>t.status==="late")),x){const t=x.toLowerCase();s=s.filter(i=>i.title?.toLowerCase().includes(t)||i.description?.toLowerCase().includes(t)||i.class_name?.toLowerCase().includes(t))}h!=="all"&&(s=s.filter(t=>t.class_id===h)),v!=="all"&&(s=s.filter(t=>t.type===v)),s.sort((t,i)=>t.status==="late"&&i.status!=="late"?-1:t.status!=="late"&&i.status==="late"?1:t.is_urgent&&!i.is_urgent?-1:!t.is_urgent&&i.is_urgent?1:new Date(t.due_date)-new Date(i.due_date)),W(s)},u=m.filter(s=>s.is_urgent),E=m.filter(s=>!s.is_urgent);return U?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(de,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs(F.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(Q,{className:"w-8 h-8 text-blue-600"}),"Minhas Atividades"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Gerencie suas atividades e acompanhe seu progresso"})]}),e.jsx($,{className:"p-6 mb-8",children:e.jsxs(pe,{value:l,onValueChange:J,children:[e.jsxs(ge,{className:"grid grid-cols-4 w-full mb-6",children:[e.jsxs(N,{value:"all",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Todas",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-slate-200 dark:bg-slate-700 rounded-full text-xs",children:b.total})]}),e.jsxs(N,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Pendentes",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-orange-200 dark:bg-orange-900 rounded-full text-xs",children:b.pending})]}),e.jsxs(N,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"ConcluÃ­das",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-green-200 dark:bg-green-900 rounded-full text-xs",children:b.completed})]}),e.jsxs(N,{value:"late",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Atrasadas",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-red-200 dark:bg-red-900 rounded-full text-xs",children:b.late})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(ue,{placeholder:"Buscar atividades...",value:x,onChange:s=>K(s.target.value),className:"pl-10"})]})}),e.jsxs(P,{value:h,onValueChange:X,children:[e.jsx(R,{className:"w-full md:w-48",children:e.jsx(B,{placeholder:"Todas as turmas"})}),e.jsxs(G,{children:[e.jsx(d,{value:"all",children:"Todas as turmas"}),Z.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(P,{value:v,onValueChange:Y,children:[e.jsx(R,{className:"w-full md:w-48",children:e.jsx(B,{placeholder:"Todos os tipos"})}),e.jsxs(G,{children:[e.jsx(d,{value:"all",children:"Todos os tipos"}),e.jsx(d,{value:"objective",children:"ğŸ“ Objetiva"}),e.jsx(d,{value:"open",children:"âœï¸ Aberta"}),e.jsx(d,{value:"mixed",children:"ğŸ¯ Mista"})]})]})]})]})}),u.length>0&&e.jsx(F.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"mb-8",children:e.jsxs($,{className:"p-6 border-2 border-orange-500 bg-orange-50/50 dark:bg-orange-950/20",children:[e.jsx("h2",{className:"text-xl font-bold text-orange-900 dark:text-orange-100 mb-4 flex items-center gap-2",children:"ğŸ”¥ URGENTE - Prazo nas prÃ³ximas 24 horas!"}),e.jsx("div",{className:"space-y-4",children:u.map((s,t)=>e.jsx(z,{activity:s,onStart:()=>f(`/students/activities/${s.id}`),onView:()=>f(`/students/activities/${s.id}`),index:t},s.id))})]})}),E.length>0?e.jsx("div",{className:"space-y-4",children:E.map((s,t)=>e.jsx(z,{activity:s,onStart:()=>f(`/students/activities/${s.id}`),onView:()=>f(`/students/activities/${s.id}`),index:t},s.id))}):e.jsx(me,{icon:m.length===0&&u.length===0?H:O,title:m.length===0&&u.length===0?l==="completed"?"Nenhuma atividade concluÃ­da":"Nenhuma atividade":"Nenhum resultado encontrado",description:m.length===0&&u.length===0?l==="completed"?"Comece a fazer suas atividades para vÃª-las aqui quando concluÃ­das.":"VocÃª nÃ£o tem atividades nesta categoria no momento.":"Tente ajustar os filtros de busca para encontrar o que procura.",variant:l==="completed"?"success":"default"})]})};export{os as default};
