import{c as te,u as se,a as ae,r as n,s as V,l as le,j as e,m as re}from"./main-BXI8jImK.js";import{C as F}from"./card-Dts-jKab.js";import{B as G}from"./SidebarPremium-CqhK_O_u.js";import{B as I}from"./button-DhJSXayK.js";import{T as ie,a as de,b as k,c as _}from"./tabs-Cc_Y9tQd.js";import{S,a as C,b as D,c as y,d as r}from"./select-BYpegp6M.js";import{S as R}from"./StatsCard-BvzfNeJ2.js";import{D as ne}from"./DashboardHeader-BC80IxDW.js";import{E as oe}from"./EmptyState-BgA-VgrI.js";import"./input-YtE9-IyT.js";import"./dropdown-menu-7nHS86TP.js";import"./label-DZTyMoK9.js";import{F as ce}from"./funnel-rLvg5Q-7.js";import{C as q}from"./clock-Ic71-9yN.js";import{C as me}from"./circle-check-big-BGyFuaS8.js";import{C as ue}from"./circle-alert-D0X6fNnu.js";import{F as H}from"./file-text-B1_cTV9D.js";import{E as xe}from"./eye-CtZjPFNS.js";import{T as ge}from"./triangle-alert-fhQdnZTc.js";import"./bell-De3gaLfU.js";import"./book-open-BMCImb8A.js";import"./trending-up-C_AGH9Be.js";import"./user-XMBxPeUS.js";import"./settings-Dn83Owos.js";import"./users-1MVt23UL.js";import"./graduation-cap-BVXXkz0b.js";import"./index-Cyt6Mlq7.js";import"./chart-column-D6pi1FRc.js";import"./x-DhRNfShw.js";import"./index-laUz9pSU.js";import"./index-D63a-v4Z.js";import"./Combination-7NRWB7dp.js";import"./index-PCXR_M5s.js";import"./index-DWCzEl6o.js";import"./chevron-down-vfmnlur0.js";import"./check-P2w7Pyl_.js";import"./chevron-up-3f7I9tWa.js";import"./chevron-right-DFiBXpQq.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$=te("circle-play",he),et=()=>{const Y=se(),{user:u}=ae(),[J,x]=n.useState(!0),[g,K]=n.useState([]),[A,Q]=n.useState([]),[W,X]=n.useState([]),[c,Z]=n.useState({pending:0,completed:0,late:0}),[m,T]=n.useState("all"),[h,B]=n.useState("all"),[p,E]=n.useState("all"),[f,O]=n.useState("deadline-asc");n.useEffect(()=>{u?.id?ee():x(!1)},[u]);const ee=async()=>{if(!u?.id){x(!1);return}try{x(!0);const{data:t}=await V.from("class_members").select("class_id, class:classes(id, name, subject, color)").eq("user_id",u.id).eq("role","student"),s=t?.map(l=>l.class_id)||[];if(X(t?.map(l=>l.class).filter(Boolean)||[]),s.length===0){x(!1);return}const{data:a}=await V.from("activity_class_assignments").select(`
          activity_id,
          class_id,
          class:classes (id, name, subject, color),
          activity:activities (
            id,
            title,
            description,
            due_date,
            max_score,
            type,
            status,
            created_at
          )
        `).in("class_id",s),i=(a||[]).map(l=>({...l.activity,class:l.class})).filter(Boolean);K(i);const d=i.map(l=>l.id),{data:o}=await V.from("submissions").select("*").eq("student_id",u.id).in("activity_id",d);Q(o||[]);const v=new Date;let b=0,w=0,z=0;i.forEach(l=>{const N=o?.find(M=>M.activity_id===l.id);N?N.grade!==null&&w++:l.due_date&&new Date(l.due_date)<v?z++:b++}),Z({pending:b,completed:w,late:z})}catch(t){le.error("Erro:",t)}finally{x(!1)}},P=t=>{const s=A.find(d=>d.activity_id===t.id),a=new Date,i=t.due_date?new Date(t.due_date):null;return s?s.grade!==null?{status:"completed",label:"Concluída",color:"bg-green-100 text-green-700"}:{status:"submitted",label:"Enviada",color:"bg-blue-100 text-blue-700"}:i&&i<a?{status:"late",label:"Atrasada",color:"bg-red-100 text-red-700"}:{status:"pending",label:"Pendente",color:"bg-amber-100 text-amber-700"}},L=t=>g.filter(s=>P(s).status===t),U=n.useMemo(()=>{let t=[...g];if(m!=="all"){const s=new Date,a={"7days":7,"30days":30,thisMonth:new Date(s.getFullYear(),s.getMonth()+1,0).getDate()};if(a[m]){const i=new Date;i.setDate(i.getDate()+a[m]),t=t.filter(d=>{if(!d.due_date)return!1;const o=new Date(d.due_date);return o>=s&&o<=i})}}return h!=="all"&&(t=t.filter(s=>s.class?.id===h)),p!=="all"&&(t=t.filter(s=>P(s).status===p)),t.sort((s,a)=>{switch(f){case"deadline-asc":return s.due_date?a.due_date?new Date(s.due_date)-new Date(a.due_date):-1:1;case"deadline-desc":return s.due_date?a.due_date?new Date(a.due_date)-new Date(s.due_date):-1:1;case"newest":return new Date(a.created_at)-new Date(s.created_at);case"score-high":return(a.max_score||0)-(s.max_score||0);case"score-low":return(s.max_score||0)-(a.max_score||0);default:return 0}}),t},[g,m,h,p,f,A]),j=({activity:t})=>{const s=P(t),a=A.find(M=>M.activity_id===t.id),i=new Date,d=t.due_date?new Date(t.due_date):null,o=d&&(d-i)/(1e3*60*60*24)<3&&s.status==="pending",v=d&&d<i,b=v&&t.accept_late_submissions===!0,w=v&&!b,l=a?.grade!==null?{text:"Ver Correção",icon:xe,variant:"outline",disabled:!1}:a?.status==="submitted"?{text:"Aguardando Correção",icon:q,variant:"outline",disabled:!0}:a?.status==="draft"?{text:"Continuar Rascunho",icon:$,variant:"default",disabled:!1}:w?{text:"Prazo Encerrado",icon:ge,variant:"outline",disabled:!0,tooltip:"O prazo desta atividade expirou e o professor não permite respostas atrasadas."}:b?{text:"Responder (Atrasada)",icon:$,variant:"default",disabled:!1,className:"bg-orange-600 hover:bg-orange-700"}:{text:"Iniciar",icon:$,variant:"default",disabled:!1},N=l.icon;return e.jsxs(F,{className:"p-4 hover:shadow-lg transition-all border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white line-clamp-2",children:t.title}),o&&e.jsx(G,{className:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300 text-xs",children:"Urgente!"})]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.class?.name," • ",t.class?.subject]})]}),e.jsx(G,{className:`px-3 py-1 rounded-full text-xs font-semibold flex-shrink-0 ${s.color}`,children:s.label})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),t.due_date?e.jsx("span",{className:o?"text-red-600 font-semibold":"",children:new Date(t.due_date).toLocaleDateString("pt-BR")}):"Sem prazo"]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[t.max_score," pts"]})]}),a?.grade!==null&&a?.grade!==void 0&&e.jsx("div",{className:"mb-3 p-2 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["Nota: ",a?.grade,"/",t.max_score]})}),e.jsxs("div",{className:"relative group/tooltip",children:[e.jsxs(I,{onClick:()=>Y(`/students/activities/${t.id}`),variant:l.variant,disabled:l.disabled,className:`w-full ${l.className||""}`,title:l.tooltip,children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),l.text]}),l.tooltip&&l.disabled&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover/tooltip:block z-10",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-lg px-3 py-2 whitespace-nowrap shadow-lg",children:[l.tooltip,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900"})]})})]})]})};return J?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(re,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-slate-200 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-6",children:[e.jsx(ne,{title:"Minhas Atividades",subtitle:"Gerencie suas tarefas e entregas",role:"student"}),e.jsxs(F,{className:"p-4 mb-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Período"}),e.jsxs(S,{value:m,onValueChange:T,children:[e.jsx(C,{children:e.jsx(D,{placeholder:"Todas"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"Todas"}),e.jsx(r,{value:"7days",children:"Próximos 7 dias"}),e.jsx(r,{value:"30days",children:"Próximos 30 dias"}),e.jsx(r,{value:"thisMonth",children:"Este mês"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Turma"}),e.jsxs(S,{value:h,onValueChange:B,children:[e.jsx(C,{children:e.jsx(D,{placeholder:"Todas as turmas"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"Todas as turmas"}),W.map(t=>e.jsx(r,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Status"}),e.jsxs(S,{value:p,onValueChange:E,children:[e.jsx(C,{children:e.jsx(D,{placeholder:"Todos"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"Todos"}),e.jsx(r,{value:"pending",children:"Não iniciadas"}),e.jsx(r,{value:"submitted",children:"Enviadas"}),e.jsx(r,{value:"completed",children:"Corrigidas"}),e.jsx(r,{value:"late",children:"Atrasadas"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Ordenar por"}),e.jsxs(S,{value:f,onValueChange:O,children:[e.jsx(C,{children:e.jsx(D,{})}),e.jsxs(y,{children:[e.jsx(r,{value:"deadline-asc",children:"Prazo mais próximo"}),e.jsx(r,{value:"deadline-desc",children:"Prazo mais distante"}),e.jsx(r,{value:"newest",children:"Recém adicionadas"}),e.jsx(r,{value:"score-high",children:"Maior pontuação"}),e.jsx(r,{value:"score-low",children:"Menor pontuação"})]})]})]})]}),(m!=="all"||h!=="all"||p!=="all"||f!=="deadline-asc")&&e.jsx(I,{variant:"outline",size:"sm",onClick:()=>{T("all"),B("all"),E("all"),O("deadline-asc")},className:"mt-4",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(R,{title:"Pendentes",value:c.pending,icon:q,gradient:"from-sky-500 to-blue-600",delay:0}),e.jsx(R,{title:"Concluídas",value:c.completed,icon:me,gradient:"from-cyan-500 to-slate-600",delay:.1}),e.jsx(R,{title:"Atrasadas",value:c.late,icon:ue,gradient:"from-slate-600 to-slate-800",delay:.2})]}),e.jsxs(ie,{defaultValue:"all",className:"w-full",children:[e.jsxs(de,{className:"mb-6 bg-slate-100/60 dark:bg-slate-800/60 border border-slate-200 dark:border-slate-700",children:[e.jsxs(k,{value:"all",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Todas (",g.length,")"]}),e.jsxs(k,{value:"pending",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Pendentes (",c.pending,")"]}),e.jsxs(k,{value:"completed",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Concluídas (",c.completed,")"]}),e.jsxs(k,{value:"late",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Atrasadas (",c.late,")"]})]}),e.jsx(_,{value:"all",children:U.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:U.map(t=>e.jsx(j,{activity:t},t.id))}):e.jsxs(F,{className:"p-12 text-center bg-white dark:bg-slate-900",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Nenhuma atividade encontrada com esses filtros"}),e.jsx(I,{variant:"outline",onClick:()=>{T("all"),B("all"),E("all")},children:"Limpar filtros"})]})}),e.jsx(_,{value:"pending",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L("pending").map(t=>e.jsx(j,{activity:t},t.id))})}),e.jsx(_,{value:"completed",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L("completed").map(t=>e.jsx(j,{activity:t},t.id))})}),e.jsx(_,{value:"late",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L("late").map(t=>e.jsx(j,{activity:t},t.id))})})]}),g.length===0&&e.jsx(oe,{icon:H,title:"Nenhuma atividade encontrada",description:"Entre em uma turma para ver atividades"})]})};export{et as default};
