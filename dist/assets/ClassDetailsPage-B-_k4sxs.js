import{c as Se,u as Je,r as l,s as b,l as L,j as e,q as ie,v as xs,a as us,y as hs}from"./main-DAPsYT4a.js";import{m as W,B as T}from"./button-DFkxrTs2.js";import{C as h}from"./card-CHLrcnUu.js";import{e as U,f as ss,A as ts,i as gs}from"./SidebarPremium-B0l6FvNw.js";import{t as g}from"./use-toast-Bdk-Ih8K.js";import{r as $e}from"./redisCache-BwKk-0Mr.js";import{U as le}from"./users-Bs21yf14.js";import{T as _e,F as H}from"./trending-up-B2-WBYxN.js";import{C as ae}from"./circle-check-big-DQOwfVGB.js";import{C as ze}from"./clock-CYIyH-Yw.js";import{C as re}from"./index-DTFBvU13.js";import{P as ne}from"./plus-0Y0qFIi_.js";import{C as oe}from"./circle-alert-DnnpR18B.js";import{M as ge,I as Le,A as is,a as ns,b as ds}from"./avatar-C8PXyb4J.js";import{S as fs}from"./square-check-big-CA4SVH9b.js";import{D as Ae,a as Ee,b as De,c as I,d as Te}from"./dropdown-menu-r_4kt0iB.js";import{S as Y,a as J,b as ee,c as se,d as _}from"./select-BPeLDmde.js";import{X as be}from"./x-B7wPkr0Q.js";import{V as Oe}from"./video-DFbtSh6z.js";import{L as Ve}from"./link-zi7pi0Ce.js";import{U as os}from"./upload-DlUOntv_.js";import{T as Be}from"./triangle-alert-t8QkS9SO.js";import{E as je}from"./ellipsis-vertical-DzgFdeHn.js";import{E as xe}from"./eye-CBaT0EpC.js";import{D as Ce}from"./download-wFpaslwU.js";import{S as Me}from"./square-pen-D5jHjvBZ.js";import{T as Ue}from"./trash-2-DtkQmUIP.js";import{T as vs}from"./thumbs-up-Dk8hUZqd.js";import{M as es}from"./message-square-9JNOD9_T.js";import{f as ve}from"./formatDistanceToNow-CMbiJYtj.js";import{p as ce}from"./pt-BR-CuGSKEGQ.js";import{I as Ge}from"./info-DY34n2Gg.js";import{I as Ie}from"./input-gY-F_5Pf.js";import{B as We}from"./chevron-right-CgUPhRTY.js";import{S as pe}from"./search-D-GL0Z3Y.js";import{P as he}from"./progress-Bh049seL.js";import{f as fe}from"./format-BcFT9btV.js";import{i as Pe}from"./isPast-CeQjbKRK.js";import{C as Ze}from"./clipboard-list-D9cGfwOl.js";import{A as ps}from"./archive-Bd9vwwFu.js";import{t as bs}from"./en-US-B6HbAA6N.js";import{a as js}from"./addDays-pVIPqqUr.js";import{c as Ns}from"./constructNow-re94FRT2.js";import{i as ws}from"./isSameDay-D5LInQhv.js";import{i as ue}from"./isToday-By0hfvNN.js";import{C as Ke}from"./copy-_qMpEEwa.js";import{U as as}from"./user-plus-B-NMrk2S.js";import{M as ys}from"./mail-B02ll939.js";import{T as rs}from"./target-CBEOxlkX.js";import{B as Fe}from"./bot-dUQ1Fust.js";import{Z as ks}from"./zap-DJw9nLp-.js";import{B as ls}from"./brain-BHo9qCGs.js";import{S as cs}from"./settings-BMbEXDky.js";import{A as _s}from"./arrow-left-CIeYlM-r.js";import"./user-BscNjPFV.js";import"./index-CxoQTrGk.js";import"./house-Dx0sCuaE.js";import"./graduation-cap-BRPCRZmC.js";import"./chart-column-DPF3N0FI.js";import"./index-CCUDCLY6.js";import"./index-Bd5NktG4.js";import"./index-CKoyZSwW.js";import"./index-D0-hv4e2.js";import"./index-CCLfHPmf.js";import"./check-cEAmrvjJ.js";import"./index-B2bzlyZg.js";import"./chevron-down-gl_d4Nmb.js";import"./chevron-up-DF4ET_PF.js";import"./differenceInCalendarMonths-FFYroMBa.js";import"./endOfDay-mJ-5sjFp.js";import"./endOfMonth-BD-g1yyK.js";import"./getRoundingMethod-D0I6Z7xl.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],Xe=Se("chart-no-axes-column",Cs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Re=Se("folder",Ss);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Es=Se("layout-dashboard",As);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],Ye=Se("pin",Ds);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ms=Se("user-x",Ts);function qs(n){return+bs(n)>Date.now()}function He(n,E){return ws(n,js(Ns(n),1),E)}const Ps=({classId:n,classData:E,onTabChange:C})=>{const j=Je(),[N,p]=l.useState(!0),[r,m]=l.useState({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0}),P=i=>{switch(i){case"Criar Atividade":j(`/dashboard/activities/create?classId=${n}`);break;case"Adicionar Aluno":C?.("students");break;case"Novo Material":C?.("library");break;case"Agendar Aula":C?.("schedule");break;case"Postar Comunicado":C?.("announcements");break;case"Corrigir Trabalhos":C?.("activities");break}};l.useEffect(()=>{v()},[n]);const v=async()=>{try{p(!0);const i=await $e.getClassStats(n,async()=>{const{data:d}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",n),S=(d||[]).map(k=>k.activity_id),{count:x}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student");if(!S||S.length===0)return{totalStudents:x||0,avgGrade:0,onTimeRate:0,openActivities:0,timestamp:new Date().toISOString()};const{data:y,count:$}=await b.from("submissions").select("grade, submitted_at",{count:"exact"}).in("activity_id",S).not("grade","is",null).limit(1e3),A=y?.filter(k=>k.grade!==null)||[],F=A.length>0?A.reduce((k,D)=>k+parseFloat(D.grade),0)/A.length:0,V=y?.filter(k=>!!k.submitted_at)||[],R=$>0?Math.round(V.length/$*100):0;return{totalStudents:x||0,avgGrade:Number(F.toFixed(1)),onTimeRate:R,openActivities:S.length,timestamp:new Date().toISOString()}});m(i)}catch(i){L.error("Erro ao carregar estatÃ­sticas:",i),m({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0})}finally{p(!1)}};if(N)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const o=[{title:"Total de Alunos",value:r.totalStudents,icon:le,color:"blue",change:"+2 esta semana"},{title:"Nota MÃ©dia da Turma",value:r.avgGrade.toFixed(1),icon:_e,color:r.avgGrade>=7?"green":r.avgGrade>=5?"yellow":"red",change:"+0.3 vs mÃªs anterior"},{title:"Taxa de Entrega no Prazo",value:`${r.onTimeRate}%`,icon:ae,color:r.onTimeRate>=80?"green":r.onTimeRate>=60?"yellow":"red",change:"+5% vs perÃ­odo anterior"},{title:"Atividades em Aberto",value:r.openActivities,icon:ze,color:r.openActivities>10?"red":r.openActivities>5?"yellow":"blue",change:"3 aguardando correÃ§Ã£o"}],w={blue:"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800",green:"bg-green-50 dark:bg-green-950 text-green-600 dark:text-green-400 border-green-200 dark:border-green-800",yellow:"bg-yellow-50 dark:bg-yellow-950 text-yellow-600 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",red:"bg-red-50 dark:bg-red-950 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800"};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:o.map((i,d)=>{const S=i.icon;return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:d*.1},children:e.jsxs(h,{className:`p-6 border-2 ${w[i.color]}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:`p-3 rounded-lg ${w[i.color]}`,children:e.jsx(S,{className:"w-6 h-6"})})}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:i.value}),e.jsx("div",{className:"text-sm font-medium mb-2",children:i.title}),e.jsx("div",{className:"text-xs opacity-75",children:i.change})]})},i.title)})}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Agenda de Aulas"]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>C?.("schedule"),children:"Ver Completa"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Nenhuma aula agendada nos prÃ³ximos dias"}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>P("Agendar Aula"),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Agendar Aula"]})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),"Ãšltimas Atividades Postadas"]}),e.jsx(T,{variant:"link",size:"sm",onClick:()=>C?.("activities"),children:"Ver todas"})]}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx(H,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhuma atividade postada"})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-yellow-600"}),"Alunos que Precisam de AtenÃ§Ã£o"]}),e.jsx(T,{variant:"link",size:"sm",onClick:()=>C?.("students"),children:"Ver todos"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-green-300 dark:text-green-700 mx-auto mb-3"}),e.jsx("p",{className:"text-green-600 dark:text-green-400 font-medium mb-2",children:"Nenhum aluno em situaÃ§Ã£o de alerta"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"ParabÃ©ns! Todos estÃ£o acompanhando bem."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"AÃ§Ãµes RÃ¡pidas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[{icon:ne,label:"Criar Atividade",color:"blue"},{icon:le,label:"Adicionar Aluno",color:"green"},{icon:H,label:"Novo Material",color:"purple"},{icon:re,label:"Agendar Aula",color:"orange"},{icon:ge,label:"Postar Comunicado",color:"yellow"},{icon:fs,label:"Corrigir Trabalhos",color:"red"}].map(i=>{const d=i.icon;return e.jsx(h,{className:"p-4 hover:shadow-lg transition-shadow cursor-pointer group",onClick:()=>P(i.label),children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 group-hover:scale-110 transition-transform",children:e.jsx(d,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:i.label})]})},i.label)})})]})]})},Fs=({isOpen:n,onClose:E,classId:C,onSuccess:j,editingPost:N})=>{const[p,r]=l.useState(!1),[m,P]=l.useState(N?.file_type?.includes("video")?"video":N?.file_type==="link"?"link":"text"),[v,o]=l.useState({title:N?.title||"",content:N?.description||"",link:N?.file_url||"",file:null}),w=[{id:"text",label:"Texto",icon:H,desc:"Compartilhe um texto ou aviso"},{id:"video",label:"VÃ­deo",icon:Oe,desc:"Adicione um vÃ­deo do YouTube ou Vimeo"},{id:"link",label:"Link",icon:Ve,desc:"Compartilhe um link externo"},{id:"image",label:"Imagem",icon:Le,desc:"Adicione fotos ou imagens"}],i=async d=>{if(d.preventDefault(),!v.title.trim()||!v.content.trim()){g({title:"Campos obrigatÃ³rios",description:"Preencha tÃ­tulo e conteÃºdo",variant:"destructive"});return}try{r(!0);const{data:{user:S}}=await b.auth.getUser();if(!S)throw new Error("UsuÃ¡rio nÃ£o autenticado");const x={title:v.title,description:v.content,file_url:v.link||null,file_type:m==="video"?"video/url":m==="link"?"link":"text",category:"post",is_public:!1};let y;if(N?{error:y}=await b.from("class_materials").update(x).eq("id",N.id):{error:y}=await b.from("class_materials").insert({...x,class_id:C,created_by:S.id}),y)throw y;await $e.invalidateClass(C),g({title:N?"âœ… Post atualizado!":"âœ… Post criado!",description:N?"Suas alteraÃ§Ãµes foram salvas.":"Seu post foi publicado no mural."}),o({title:"",content:"",link:"",file:null}),P("text"),j?.(),E()}catch(S){L.error("Erro ao criar post:",S),g({title:"Erro ao criar post",description:S.message,variant:"destructive"})}finally{r(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(h,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:N?"Editar Postagem":"Nova Postagem"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:N?"Atualize o conteÃºdo da postagem":"Compartilhe conteÃºdo com seus alunos"})]}),e.jsx("button",{onClick:E,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:i,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Tipo de ConteÃºdo"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:w.map(d=>{const S=d.icon;return e.jsx("button",{type:"button",onClick:()=>P(d.id),className:`p-4 rounded-lg border-2 text-left transition-all ${m===d.id?"border-blue-600 bg-blue-50 dark:bg-blue-950":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:`w-5 h-5 ${m===d.id?"text-blue-600":"text-slate-600"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:d.label}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:d.desc})]})]})},d.id)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["TÃ­tulo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:v.title,onChange:d=>o({...v,title:d.target.value}),placeholder:"Ex: Material sobre FunÃ§Ãµes QuadrÃ¡ticas",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:200,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[v.title.length,"/200"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["ConteÃºdo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:v.content,onChange:d=>o({...v,content:d.target.value}),placeholder:"Escreva o conteÃºdo da postagem...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:2e3,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[v.content.length,"/2000"]})]}),m==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Link do VÃ­deo"}),e.jsx("input",{type:"url",value:v.link,onChange:d=>o({...v,link:d.target.value}),placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),m==="link"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"URL do Link"}),e.jsx("input",{type:"url",value:v.link,onChange:d=>o({...v,link:d.target.value}),placeholder:"https://exemplo.com/artigo",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),m==="image"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Upload de Imagem"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(os,{className:"w-12 h-12 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Arraste uma imagem ou clique para selecionar"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"image-upload",onChange:d=>o({...v,file:d.target.files[0]})}),e.jsx(T,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>document.getElementById("image-upload").click(),children:"Selecionar Arquivo"}),v.file&&e.jsx("p",{className:"text-sm text-green-600 mt-2",children:v.file.name})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(T,{type:"button",variant:"outline",onClick:E,className:"flex-1",disabled:p,children:"Cancelar"}),e.jsx(T,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600",disabled:p,children:p?"Publicando...":"Publicar"})]})]})]})}):null},qe=({isOpen:n,onClose:E,onConfirm:C,title:j,message:N,confirmText:p="Confirmar",cancelText:r="Cancelar",variant:m="danger"})=>{if(!n)return null;const P=()=>{C(),E()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(h,{className:"w-full max-w-md bg-white dark:bg-slate-900 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${m==="danger"?"bg-red-100 dark:bg-red-900/20":"bg-yellow-100 dark:bg-yellow-900/20"}`,children:e.jsx(Be,{className:`w-6 h-6 ${m==="danger"?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`})}),e.jsx("h2",{className:"text-xl font-bold",children:j})]}),e.jsx("button",{onClick:E,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:N}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(T,{variant:"outline",onClick:E,children:r}),e.jsx(T,{onClick:P,className:m==="danger"?"bg-red-600 hover:bg-red-700 text-white":"bg-yellow-600 hover:bg-yellow-700 text-white",children:p})]})]})})},Rs=({classId:n})=>{const[E,C]=l.useState(!1),[j,N]=l.useState(!0),[p,r]=l.useState([]),[m,P]=l.useState("all"),[v,o]=l.useState({isOpen:!1,id:null,title:""}),[w,i]=l.useState(null),[d,S]=l.useState({});l.useEffect(()=>{x()},[n]),l.useEffect(()=>{p.length>0&&y()},[p]);const x=async()=>{try{N(!0);const{data:a,error:c}=await b.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",n).order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(c)throw c;r(a||[])}catch(a){L.error("Erro ao carregar posts:",a),g({title:"Erro ao carregar posts",description:a.message,variant:"destructive"})}finally{N(!1)}},y=async()=>{try{const a=p.map(u=>u.id),{data:c}=await b.from("post_likes").select("post_id, user_id, profiles!post_likes_user_id_fkey(full_name, avatar_url)").in("post_id",a),{data:q}=await b.from("post_views").select("post_id, user_id").in("post_id",a),{data:s}=await b.from("post_comments").select("post_id, id").in("post_id",a).is("parent_comment_id",null),t={};a.forEach(u=>{t[u]={likes:c?.filter(z=>z.post_id===u)||[],views:q?.filter(z=>z.post_id===u)||[],comments:s?.filter(z=>z.post_id===u)||[]}}),S(t)}catch(a){L.error("Erro ao carregar engagement:",a)}},$=()=>{C(!1),i(null),x()},A=a=>{a.file_url?window.open(a.file_url,"_blank"):g({title:"ConteÃºdo nÃ£o disponÃ­vel",description:"Este post nÃ£o possui arquivo ou link associado"})},F=a=>{i(a),C(!0)},V=async a=>{try{const c=!a.is_pinned,{error:q}=await b.from("class_materials").update({is_pinned:c}).eq("id",a.id);if(q)throw q;g({title:c?"âœ… Post fixado!":"âœ… Post desafixado!",description:c?"Este post agora aparece no topo do mural.":"Este post foi removido do topo."}),x()}catch(c){L.error("Erro ao fixar/desafixar post:",c),g({title:"âŒ Erro",description:"NÃ£o foi possÃ­vel alterar o status do post.",variant:"destructive"})}},R=a=>{a.file_url?window.open(a.file_url,"_blank"):g({title:"Arquivo nÃ£o disponÃ­vel",variant:"destructive"})},k=(a,c)=>{o({isOpen:!0,id:a,title:c})},D=async()=>{const{id:a,title:c}=v;try{const{error:q}=await b.from("class_materials").delete().eq("id",a);if(q)throw q;g({title:"âœ… Post deletado",description:`"${c}" foi removido com sucesso.`}),x()}catch(q){L.error("Erro ao deletar post:",q),g({title:"âŒ Erro ao deletar post",description:q.message,variant:"destructive"})}},B=a=>a?a.includes("video")?Oe:a.includes("image")?Le:a.includes("pdf")?H:Ve:H,f=a=>a?a.includes("video")?"bg-purple-100 text-purple-700":a.includes("image")?"bg-pink-100 text-pink-700":a.includes("pdf")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700",M=()=>m==="all"?p:p.filter(a=>{if(!a.file_type)return!1;switch(m){case"video":return a.file_type.includes("video");case"image":return a.file_type.includes("image");case"pdf":return a.file_type.includes("pdf");case"link":return a.file_type==="link";default:return!0}});if(j)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const Q=M();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Mural de ConteÃºdo"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[Q.length," de ",p.length," posts"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{value:m,onValueChange:P,children:[e.jsx(J,{className:"w-[180px]",children:e.jsx(ee,{placeholder:"Filtrar por tipo"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Tipos"}),e.jsx(_,{value:"video",children:"ðŸ“¹ VÃ­deos"}),e.jsx(_,{value:"pdf",children:"ðŸ“„ PDFs"}),e.jsx(_,{value:"image",children:"ðŸ–¼ï¸ Imagens"}),e.jsx(_,{value:"link",children:"ðŸ”— Links"})]})]}),e.jsxs(T,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>C(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Nova Postagem"]})]})]}),Q.length===0?e.jsxs(h,{className:"p-12 text-center",children:[e.jsx(H,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:p.length===0?"Nenhum conteÃºdo postado ainda":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:p.length===0?"Compartilhe materiais, vÃ­deos e links com seus alunos":"Ajuste o filtro para ver mais resultados."}),p.length===0&&e.jsxs(T,{onClick:()=>C(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Criar Primeira Postagem"]})]}):e.jsx("div",{className:"space-y-4",children:Q.map((a,c)=>{const q=B(a.file_type);return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.05},children:e.jsxs(h,{className:`p-6 hover:shadow-lg transition-all ${a.is_pinned?"border-2 border-amber-400 bg-amber-50/50 dark:bg-amber-950/20":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsxs(is,{className:"w-10 h-10",children:[e.jsx(ns,{src:a.creator?.avatar_url}),e.jsx(ds,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white",children:a.creator?.full_name?.[0]||"P"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold",children:a.creator?.full_name||"Professor"}),a.is_pinned&&e.jsxs(U,{className:"bg-amber-500 text-white text-xs",children:[e.jsx(Ye,{className:"w-3 h-3 mr-1"}),"Fixado"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"â€¢"}),e.jsx("span",{className:"text-sm text-slate-500",children:ve(new Date(a.created_at),{locale:ce,addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(U,{className:f(a.file_type),children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),a.file_type?.split("/")[0]||"Arquivo"]}),a.category&&e.jsx(U,{variant:"outline",className:"text-xs",children:a.category})]})]})]}),e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(De,{align:"end",children:[e.jsxs(I,{onClick:()=>A(a),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(I,{onClick:()=>R(a),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Baixar Arquivo"]}),e.jsxs(I,{onClick:()=>F(a),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar Post"]}),e.jsxs(I,{onClick:()=>V(a),children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),a.is_pinned?"Desafixar":"Fixar no Topo"]}),e.jsx(Te,{}),e.jsxs(I,{className:"text-red-600 dark:text-red-400",onClick:()=>k(a.id,a.title),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar Post"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:a.title}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 line-clamp-3",children:a.description||"Sem descriÃ§Ã£o"})]}),a.file_type?.includes("image")&&a.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:a.file_url,alt:a.title,className:"w-full max-h-96 object-contain cursor-pointer",onClick:()=>window.open(a.file_url,"_blank")})}),a.file_type?.includes("video")&&a.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:a.file_url.includes("youtube")||a.file_url.includes("youtu.be")?e.jsx("div",{className:"aspect-video",children:e.jsx("iframe",{src:a.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allowFullScreen:!0,title:a.title})}):e.jsx("video",{controls:!0,className:"w-full max-h-96",children:e.jsx("source",{src:a.file_url})})}),a.file_type==="link"&&a.file_url&&e.jsx("a",{href:a.file_url,target:"_blank",rel:"noopener noreferrer",className:"mb-4 block p-4 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-950/40 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-blue-600 hover:underline truncate",children:a.file_url})]})}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:a.tags.map((s,t)=>e.jsxs(U,{variant:"secondary",className:"text-xs",children:["#",s]},t))}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"w-4 h-4"}),d[a.id]?.likes?.length||0," curtidas"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),d[a.id]?.views?.length||0," visualizaÃ§Ãµes"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(es,{className:"w-4 h-4"}),d[a.id]?.comments?.length||0," comentÃ¡rios"]})]}),a.file_url&&e.jsxs(T,{size:"sm",variant:"outline",onClick:()=>window.open(a.file_url,"_blank"),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Baixar"]})]})]})},a.id)})}),e.jsx(Fs,{isOpen:E,onClose:()=>{C(!1),i(null)},classId:n,onSuccess:$,editingPost:w}),e.jsx(qe,{isOpen:v.isOpen,onClose:()=>o({isOpen:!1,id:null,title:""}),onConfirm:D,title:"Deletar Post",message:`Tem certeza que deseja deletar "${v.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},$s=({isOpen:n,onClose:E,classId:C,onSuccess:j})=>{const[N,p]=l.useState(!1),[r,m]=l.useState({title:"",description:"",urgency:"info"}),P=[{value:"info",label:"ðŸ“˜ InformaÃ§Ã£o",color:"blue",icon:Ge},{value:"warning",label:"âš ï¸ Aviso",color:"yellow",icon:Be},{value:"urgent",label:"ðŸ”” Urgente",color:"orange",icon:ge},{value:"critical",label:"ðŸš¨ CrÃ­tico",color:"red",icon:oe}],v=async i=>{if(i.preventDefault(),!r.title.trim()||!r.description.trim()){g({title:"Campos obrigatÃ³rios",description:"Preencha tÃ­tulo e descriÃ§Ã£o",variant:"destructive"});return}try{p(!0);const{data:{user:d}}=await b.auth.getUser();if(!d)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{error:S}=await b.from("class_materials").insert({class_id:C,title:r.title,description:r.description,category:"announcement",tags:[r.urgency],created_by:d.id,is_public:!1,file_type:"announcement"});if(S)throw S;g({title:"Comunicado criado!",description:"Todos os alunos serÃ£o notificados"}),m({title:"",description:"",urgency:"info"}),j?.(),E()}catch(d){L.error("Erro ao criar comunicado:",d),g({title:"Erro ao criar comunicado",description:d.message,variant:"destructive"})}finally{p(!1)}};if(!n)return null;const o=P.find(i=>i.value===r.urgency),w=o?.icon||Ge;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(h,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Novo Comunicado"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Envie avisos importantes para todos os alunos"})]}),e.jsx("button",{onClick:E,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"NÃ­vel de UrgÃªncia"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:P.map(i=>{const d=i.icon;return e.jsx("button",{type:"button",onClick:()=>m({...r,urgency:i.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${r.urgency===i.value?`border-${i.color}-600 bg-${i.color}-50 dark:bg-${i.color}-950/20`:"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:i.label})]})},i.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"TÃ­tulo do Comunicado"}),e.jsx("input",{type:"text",value:r.title,onChange:i=>m({...r,title:i.target.value}),placeholder:"Ex: AlteraÃ§Ã£o de horÃ¡rio da prova",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Mensagem"}),e.jsx("textarea",{value:r.description,onChange:i=>m({...r,description:i.target.value}),placeholder:"Descreva o comunicado em detalhes...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 border-${o?.color}-200 bg-${o?.color}-50 dark:bg-${o?.color}-950/20`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${o?.color}-100`,children:e.jsx(w,{className:`w-5 h-5 text-${o?.color}-600`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:r.title||"TÃ­tulo do comunicado"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:r.description||"Mensagem do comunicado aparecerÃ¡ aqui..."})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(T,{type:"button",variant:"outline",onClick:E,children:"Cancelar"}),e.jsx(T,{type:"submit",disabled:N,className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",children:N?"Publicando...":"Publicar Comunicado"})]})]})]})})},zs=({classId:n})=>{const[E,C]=l.useState(!0),[j,N]=l.useState([]),[p,r]=l.useState("all"),[m,P]=l.useState(!1),[v,o]=l.useState(null),[w,i]=l.useState({isOpen:!1,id:null,title:""}),[d,S]=l.useState({total:0,info:0,warning:0,urgent:0,critical:0});l.useEffect(()=>{x()},[n]);const x=async()=>{try{C(!0);const{data:D,error:B}=await b.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",n).eq("category","announcement").order("created_at",{ascending:!1});if(B)throw B;const f=D||[];S({total:f.length,info:f.filter(M=>(M.tags?.[0]||"info")==="info").length,warning:f.filter(M=>(M.tags?.[0]||"info")==="warning").length,urgent:f.filter(M=>(M.tags?.[0]||"info")==="urgent").length,critical:f.filter(M=>(M.tags?.[0]||"info")==="critical").length}),N(f)}catch(D){L.error("Erro ao carregar comunicados:",D),g({title:"Erro ao carregar comunicados",description:D.message,variant:"destructive"})}finally{C(!1)}},y=D=>{switch(D){case"critical":return{icon:Be,color:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",borderColor:"border-red-200 dark:border-red-800",label:"CrÃ­tico"};case"urgent":return{icon:ss,color:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",borderColor:"border-orange-200 dark:border-orange-800",label:"Urgente"};case"warning":return{icon:oe,color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",borderColor:"border-yellow-200 dark:border-yellow-800",label:"Aviso"};default:return{icon:Ge,color:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",borderColor:"border-blue-200 dark:border-blue-800",label:"InformaÃ§Ã£o"}}},$=async D=>{try{const{data:B,error:f}=await b.from("class_members").select("user_id, profiles!user_id(full_name)").eq("class_id",n).eq("role","student");if(f)throw f;const M=B?.length||0;g({title:`ðŸ“Š ${M} aluno(s)`,description:"Sistema de tracking de leituras serÃ¡ implementado em breve."})}catch(B){L.error("Erro:",B),g({title:"âŒ Erro",description:B.message,variant:"destructive"})}},A=D=>{o(D),P(!0)},F=async D=>{try{const B=!D.is_pinned,{error:f}=await b.from("announcements").update({is_pinned:B}).eq("id",D.id);if(f)throw f;g({title:B?"âœ… Comunicado fixado!":"âœ… Comunicado desafixado!",description:B?"Este comunicado agora aparece no topo.":"Este comunicado foi removido do topo."}),x()}catch(B){L.error("Erro ao fixar/desafixar:",B),g({title:"âŒ Erro",description:B.message,variant:"destructive"})}},V=(D,B)=>{i({isOpen:!0,id:D,title:B})},R=async()=>{const{id:D,title:B}=w;try{const{error:f}=await b.from("class_materials").delete().eq("id",D);if(f)throw f;g({title:"âœ… Comunicado deletado",description:`"${B}" foi removido com sucesso.`}),x()}catch(f){L.error("Erro ao deletar comunicado:",f),g({title:"âŒ Erro ao deletar comunicado",description:f.message,variant:"destructive"})}},k=p==="all"?j:j.filter(D=>(D.tags?.[0]||"info")===p);return E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(h,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(ge,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Ge,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.info}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Info"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(oe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.warning}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Avisos"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900",children:e.jsx(ss,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.urgent}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Urgentes"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(Be,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CrÃ­ticos"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Comunicados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[k.length," de ",d.total," comunicados"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{value:p,onValueChange:r,children:[e.jsx(J,{className:"w-[180px]",children:e.jsx(ee,{placeholder:"Filtrar urgÃªncia"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos"}),e.jsx(_,{value:"info",children:"ðŸ“˜ InformaÃ§Ã£o"}),e.jsx(_,{value:"warning",children:"âš ï¸ Aviso"}),e.jsx(_,{value:"urgent",children:"ðŸ”” Urgente"}),e.jsx(_,{value:"critical",children:"ðŸš¨ CrÃ­tico"})]})]}),e.jsxs(T,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",onClick:()=>P(!0),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Novo Comunicado"]})]})]}),k.length===0?e.jsx(h,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:j.length===0?"Nenhum comunicado publicado":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:j.length===0?"Avisos importantes aparecerÃ£o aqui e notificarÃ£o todos os alunos":"Ajuste o filtro para ver mais resultados."}),j.length===0&&e.jsxs(T,{className:"bg-gradient-to-r from-orange-600 to-red-600",onClick:()=>P(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Criar Primeiro Comunicado"]})]})}):e.jsx("div",{className:"space-y-4",children:k.map((D,B)=>{const f=D.tags?.[0]||"info",M=y(f),Q=M.icon;return e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:B*.05},children:e.jsx(h,{className:`p-6 border-2 ${M.borderColor} hover:shadow-lg transition-all`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${M.color}`,children:e.jsx(Q,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:D.title}),e.jsx(U,{className:M.color,children:M.label})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(re,{className:"w-3 h-3"}),ve(new Date(D.created_at),{locale:ce,addSuffix:!0})]})]}),e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(De,{align:"end",children:[e.jsxs(I,{onClick:()=>$(),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver Leituras"]}),e.jsxs(I,{onClick:()=>A(D),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(I,{onClick:()=>F(D),children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Fixar no Topo"]}),e.jsx(Te,{}),e.jsxs(I,{className:"text-red-600",onClick:()=>V(D.id,D.title),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 mb-3",children:D.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),"Todos os alunos"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),"0 leituras"]})]})]})]})})},D.id)})}),e.jsx($s,{isOpen:m,onClose:()=>{P(!1),o(null)},classId:n,editingAnnouncement:v,onSuccess:x}),e.jsx(qe,{isOpen:w.isOpen,onClose:()=>i({isOpen:!1,id:null,title:""}),onConfirm:R,title:"Deletar Comunicado",message:`Tem certeza que deseja deletar "${w.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},Ls=({isOpen:n,onClose:E,classId:C,onSuccess:j})=>{const[N,p]=l.useState(!1),[r,m]=l.useState({title:"",description:"",category:"aulas",file:null,fileUrl:""}),P=[{value:"aulas",label:"ðŸ“š Aulas e Slides"},{value:"exercicios",label:"ðŸ“ ExercÃ­cios"},{value:"referencias",label:"ðŸ“– ReferÃªncias"},{value:"complementar",label:"âž• Material Complementar"}],v=w=>{const i=w.target.files[0];i&&m({...r,file:i,title:r.title||i.name})},o=async w=>{if(w.preventDefault(),!r.title.trim()){g({title:"TÃ­tulo obrigatÃ³rio",description:"Digite um tÃ­tulo para o material",variant:"destructive"});return}if(!r.file&&!r.fileUrl.trim()){g({title:"Arquivo ou link obrigatÃ³rio",description:"FaÃ§a upload de um arquivo ou cole um link",variant:"destructive"});return}try{p(!0);const{data:{user:i}}=await b.auth.getUser();if(!i)throw new Error("UsuÃ¡rio nÃ£o autenticado");let d=r.fileUrl,S="link",x=null;if(r.file){const $=`${Date.now()}_${r.file.name}`,A=`${C}/${$}`,{error:F}=await b.storage.from("class-materials").upload(A,r.file);if(F)throw F;const{data:{publicUrl:V}}=b.storage.from("class-materials").getPublicUrl(A);d=V,S=r.file.type,x=r.file.size}const{error:y}=await b.from("class_materials").insert({class_id:C,title:r.title,description:r.description||null,file_url:d,file_type:S,file_size:x,category:r.category,created_by:i.id,is_public:!1});if(y)throw y;g({title:"Material adicionado!",description:"O material estÃ¡ disponÃ­vel na biblioteca"}),m({title:"",description:"",category:"aulas",file:null,fileUrl:""}),j?.(),E()}catch(i){L.error("Erro ao adicionar material:",i),g({title:"Erro ao adicionar material",description:i.message,variant:"destructive"})}finally{p(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(h,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Material"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Compartilhe arquivos e recursos com seus alunos"})]}),e.jsx("button",{onClick:E,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"TÃ­tulo do Material"}),e.jsx("input",{type:"text",value:r.title,onChange:w=>m({...r,title:w.target.value}),placeholder:"Ex: Slides da Aula 1 - IntroduÃ§Ã£o",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Categoria"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:P.map(w=>e.jsx("button",{type:"button",onClick:()=>m({...r,category:w.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${r.category===w.value?"border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsx("span",{className:"font-medium text-sm",children:w.label})},w.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Arquivo ou Link"}),e.jsx("div",{children:e.jsx("label",{className:"block",children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${r.file?"border-green-500 bg-green-50 dark:bg-green-950/20":"border-slate-300 dark:border-slate-700 hover:border-blue-600"}`,children:[r.file?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"text-sm font-medium mb-1 text-green-700 dark:text-green-300",children:["âœ“ ",r.file.name]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[(r.file.size/1024/1024).toFixed(2)," MB"]}),e.jsx("button",{type:"button",onClick:w=>{w.preventDefault(),m({...r,file:null,title:""})},className:"mt-2 text-xs text-red-600 hover:underline",children:"Remover arquivo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),e.jsx("div",{className:"text-sm font-medium mb-1",children:"Clique para fazer upload"}),e.jsx("div",{className:"text-xs text-slate-500",children:"PDF, DOC, PPT, Imagens, VÃ­deos (mÃ¡x 50MB)"})]}),e.jsx("input",{type:"file",onChange:v,className:"hidden",accept:".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.mp4,.avi"})]})})}),e.jsx("div",{className:"text-center text-sm text-slate-500",children:"OU"}),e.jsx("div",{children:e.jsx("input",{type:"url",value:r.fileUrl,onChange:w=>m({...r,fileUrl:w.target.value}),placeholder:"Cole um link (Google Drive, YouTube, etc)",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"DescriÃ§Ã£o (opcional)"}),e.jsx("textarea",{value:r.description,onChange:w=>m({...r,description:w.target.value}),placeholder:"Adicione informaÃ§Ãµes sobre o material...",rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(T,{type:"button",variant:"outline",onClick:E,children:"Cancelar"}),e.jsx(T,{type:"submit",disabled:N,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:N?"Adicionando...":"Adicionar Material"})]})]})]})}):null},Os=({classId:n})=>{const[E,C]=l.useState(!0),[j,N]=l.useState([]),[p,r]=l.useState(""),[m,P]=l.useState("all"),[v,o]=l.useState("all"),[w,i]=l.useState(!1),[d,S]=l.useState(!1),[x,y]=l.useState({total:0,pdfs:0,videos:0,images:0,others:0}),[$,A]=l.useState({isOpen:!1,id:null,title:""});l.useEffect(()=>{F()},[n]);const F=async()=>{try{C(!0);const{data:c,error:q}=await b.from("class_materials").select(`
          *,
          uploader:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",n).neq("category","announcement").order("created_at",{ascending:!1});if(q)throw q;const s=c||[];y({total:s.length,pdfs:s.filter(t=>t.file_type?.includes("pdf")).length,videos:s.filter(t=>t.file_type?.includes("video")).length,images:s.filter(t=>t.file_type?.includes("image")).length,others:s.filter(t=>!t.file_type?.includes("pdf")&&!t.file_type?.includes("video")&&!t.file_type?.includes("image")).length}),N(s)}catch(c){L.error("Erro ao carregar materiais:",c),g({title:"Erro ao carregar materiais",description:c.message,variant:"destructive"})}finally{C(!1)}},V=c=>{c.file_url?window.open(c.file_url,"_blank"):g({title:"Arquivo nÃ£o disponÃ­vel",description:"Este material nÃ£o possui arquivo associado",variant:"destructive"})},R=c=>{g({title:"Em desenvolvimento",description:"FunÃ§Ã£o de ediÃ§Ã£o serÃ¡ implementada em breve"})},k=(c,q)=>{A({isOpen:!0,id:c,title:q})},D=async()=>{const{id:c,title:q}=$;try{const{error:s}=await b.from("class_materials").delete().eq("id",c);if(s)throw s;g({title:"âœ… Material deletado",description:`"${q}" foi removido com sucesso.`}),F()}catch(s){L.error("Erro ao deletar material:",s),g({title:"âŒ Erro ao deletar material",description:s.message,variant:"destructive"})}},B=c=>c?c.includes("video")?Oe:c.includes("image")?Le:c.includes("pdf")?H:H:H,f=c=>c?c.includes("video")?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":c.includes("image")?"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300":c.includes("pdf")?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"bg-slate-100 text-slate-700",M=c=>{if(!c)return"N/A";const q=c/(1024*1024);return q<1?`${(c/1024).toFixed(0)} KB`:`${q.toFixed(1)} MB`},Q=j.filter(c=>{if(p){const q=p.toLowerCase();if(!c.title?.toLowerCase().includes(q)&&!c.description?.toLowerCase().includes(q))return!1}return!(m!=="all"&&c.category!==m||v!=="all"&&(v==="pdf"&&!c.file_type?.includes("pdf")||v==="video"&&!c.file_type?.includes("video")||v==="image"&&!c.file_type?.includes("image")))}),a=Q.reduce((c,q)=>{const s=q.category||"Sem Categoria";return c[s]||(c[s]=[]),c[s].push(q),c},{});return E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(h,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(We,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(H,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.pdfs}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"PDFs"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(Oe,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.videos}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"VÃ­deos"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-pink-200 dark:border-pink-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-pink-100 dark:bg-pink-900",children:e.jsx(Le,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.images}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Imagens"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(Re,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.others}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Outros"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Biblioteca de Materiais"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[Q.length," de ",x.total," materiais"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{g({title:"Em desenvolvimento",description:"FunÃ§Ã£o de mÃ³dulos serÃ¡ implementada em breve"})},children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Novo MÃ³dulo"]}),e.jsxs(T,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>S(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Adicionar Material"]})]})]}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar material...",value:p,onChange:c=>r(c.target.value),className:"pl-10"})]})}),e.jsxs(Y,{value:v,onValueChange:o,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Tipo"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Tipos"}),e.jsx(_,{value:"pdf",children:"ðŸ“„ PDFs"}),e.jsx(_,{value:"video",children:"ðŸ“¹ VÃ­deos"}),e.jsx(_,{value:"image",children:"ðŸ–¼ï¸ Imagens"})]})]}),e.jsxs(Y,{value:m,onValueChange:P,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Categoria"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todas Categorias"}),e.jsx(_,{value:"aulas",children:"Aulas"}),e.jsx(_,{value:"exercicios",children:"ExercÃ­cios"}),e.jsx(_,{value:"referencias",children:"ReferÃªncias"}),e.jsx(_,{value:"complementar",children:"Material Complementar"})]})]})]})}),Q.length===0?e.jsx(h,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(We,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:j.length===0?"Biblioteca Vazia":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:j.length===0?"Comece organizando seus materiais em mÃ³dulos e tÃ³picos":"Ajuste os filtros para ver mais resultados."}),j.length===0&&e.jsxs(T,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Criar Primeiro MÃ³dulo"]})]})}):e.jsx("div",{className:"space-y-6",children:Object.entries(a).map(([c,q])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:c}),e.jsx(U,{variant:"secondary",children:q.length})]}),e.jsx("div",{className:"space-y-3 ml-6",children:q.map((s,t)=>{const u=B(s.file_type),z=f(s.file_type);return e.jsx(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},children:e.jsxs(h,{className:"p-4 hover:shadow-md transition-shadow",children:[s.file_url&&s.file_type?.includes("image")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:s.file_url,alt:s.title,className:"w-full max-h-64 object-contain cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(s.file_url,"_blank")})}),s.file_url&&s.file_type?.includes("video")&&!s.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsxs("video",{controls:!0,className:"w-full max-h-64",children:[e.jsx("source",{src:s.file_url}),"Seu navegador nÃ£o suporta vÃ­deos."]})}),s.file_url&&s.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800 aspect-video",children:e.jsx("iframe",{src:s.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${z}`,children:e.jsx(u,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-1",children:s.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsx("span",{children:M(s.file_size)}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),ve(new Date(s.created_at),{locale:ce,addSuffix:!0})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex gap-1",children:s.tags.slice(0,2).map((G,Z)=>e.jsx(U,{variant:"outline",className:"text-xs",children:G},Z))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.file_url&&e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>window.open(s.file_url,"_blank"),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Baixar"]}),e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(De,{align:"end",children:[e.jsxs(I,{onClick:()=>V(s),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Visualizar"]}),e.jsxs(I,{onClick:()=>R(),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsx(Te,{}),e.jsxs(I,{className:"text-red-600",onClick:()=>k(s.id,s.title),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})]})},s.id)})})]},c))}),e.jsx(Ls,{isOpen:d,onClose:()=>S(!1),classId:n,onSuccess:F}),e.jsx(qe,{isOpen:$.isOpen,onClose:()=>A({isOpen:!1,id:null,title:""}),onConfirm:D,title:"Deletar Material",message:`Tem certeza que deseja deletar "${$.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},Vs=({isOpen:n,onClose:E,classId:C,onSuccess:j})=>{const[N,p]=l.useState(!1),[r,m]=l.useState([]),[P,v]=l.useState(""),[o,w]=l.useState(null);l.useEffect(()=>{n&&i()},[n]);const i=async()=>{try{p(!0);const{data:{user:x}}=await b.auth.getUser();if(!x)return;const{data:y,error:$}=await b.from("activities").select("*").eq("created_by",x.id).order("created_at",{ascending:!1});if($)throw $;const{data:A,error:F}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",C);if(F)throw F;const V=A.map(k=>k.activity_id),R=y.filter(k=>!V.includes(k.id));m(R)}catch(x){L.error("Erro ao carregar atividades:",x),g({title:"Erro ao carregar",description:x.message,variant:"destructive"})}finally{p(!1)}},d=async()=>{if(!o){g({title:"Selecione uma atividade",description:"Escolha uma atividade para postar na turma",variant:"destructive"});return}try{p(!0);const{error:x}=await b.from("activity_class_assignments").insert({activity_id:o.id,class_id:C,assigned_at:new Date().toISOString()});if(x)throw x;g({title:"âœ… Atividade postada!",description:`"${o.title}" foi adicionada Ã  turma`}),j?.(),E()}catch(x){L.error("Erro ao postar atividade:",x),g({title:"Erro ao postar",description:x.message,variant:"destructive"})}finally{p(!1)}};if(!n)return null;const S=r.filter(x=>x.title?.toLowerCase().includes(P.toLowerCase())||x.description?.toLowerCase().includes(P.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(h,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Postar Atividade Existente"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha uma atividade criada anteriormente"})]}),e.jsx("button",{onClick:E,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar atividades...",value:P,onChange:x=>v(x.target.value),className:"pl-10"})]}),N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r.length===0?"Nenhuma atividade disponÃ­vel":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:r.length===0?"Crie atividades primeiro para poder postÃ¡-las aqui":"Tente buscar por outro termo"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:S.map(x=>e.jsx(h,{className:`p-4 cursor-pointer transition-all hover:shadow-md ${o?.id===x.id?"border-2 border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border hover:border-blue-300"}`,onClick:()=>w(x),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:x.title}),e.jsx(U,{variant:x.status==="active"?"default":"secondary",children:x.status==="active"?"Publicada":"Rascunho"})]}),x.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:x.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[x.due_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),"Prazo: ",fe(new Date(x.due_date),"dd/MM/yyyy 'Ã s' HH:mm",{locale:ce})]}),x.max_grade&&e.jsxs("span",{children:["Nota: ",x.max_grade," pts"]})]})]}),o?.id===x.id&&e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-white"})})})]})},x.id))}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t dark:border-slate-700",children:[e.jsx(T,{type:"button",variant:"outline",onClick:E,children:"Cancelar"}),e.jsx(T,{onClick:d,disabled:N||!o,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:N?"Postando...":"Postar Atividade"})]})]})]})})},Bs=({classId:n})=>{const E=Je(),[C,j]=l.useState(!0),[N,p]=l.useState([]),[r,m]=l.useState({isOpen:!1,id:null,title:""}),[P,v]=l.useState(""),[o,w]=l.useState("all"),[i,d]=l.useState("all"),[S,x]=l.useState("all"),[y,$]=l.useState("recent"),[A,F]=l.useState(!1),[V,R]=l.useState({total:0,published:0,draft:0,overdue:0,pendingCorrections:0});l.useEffect(()=>{k()},[n]);const k=async()=>{try{j(!0);const{data:s,error:t}=await b.from("activity_class_assignments").select(`
          id,
          assigned_at,
          activity:activities(
            id,
            title,
            description,
            type,
            due_date,
            max_score,
            status,
            created_at
          )
        `).eq("class_id",n).order("assigned_at",{ascending:!1});if(t)throw t;const{count:u}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student"),z=await Promise.all((s||[]).map(async O=>{const te=O.activity?.id;if(!te)return{...O,submissionsCount:0,totalStudents:u||0,pendingCorrections:0,avgGrade:null,submissionRate:0};const{data:Ne}=await b.from("class_members").select("user_id").eq("class_id",n).eq("role","student"),de=Ne?.map(X=>X.user_id)||[];let me=[];if(de.length>0){const{data:X}=await b.from("submissions").select("id, status, grade").eq("activity_id",te).in("student_id",de);me=X||[]}const we=me?.length||0,ye=me?.filter(X=>X.status==="submitted").length||0,ke=me?.filter(X=>X.grade!==null).map(X=>parseFloat(X.grade))||[],K=ke.length>0?ke.reduce((X,ms)=>X+ms,0)/ke.length:null,Qe=u>0?we/u*100:0;return{...O,submissionsCount:we,totalStudents:u||0,pendingCorrections:ye,avgGrade:K,submissionRate:Qe}})),G=new Date,Z={total:z.length,published:z.filter(O=>O.activity?.is_published).length,draft:z.filter(O=>!O.activity?.is_published).length,overdue:z.filter(O=>O.activity?.due_date&&Pe(new Date(O.activity.due_date))&&!ue(new Date(O.activity.due_date))).length,pendingCorrections:z.reduce((O,te)=>O+(te.pendingCorrections||0),0)};p(z),R(Z)}catch(s){L.error("Erro ao carregar atividades:",s),g({title:"Erro ao carregar atividades",description:s.message,variant:"destructive"}),p([])}finally{j(!1)}},D=()=>{let s=N;if(P){const t=P.toLowerCase();s=s.filter(u=>u.activity?.title?.toLowerCase().includes(t)||u.activity?.description?.toLowerCase().includes(t))}if(o!=="all"&&(s=s.filter(t=>o==="published"?t.activity?.status==="active":o==="draft"?t.activity?.status==="draft":o==="pending_correction"?t.pendingCorrections>0:!0)),i!=="all"&&(s=s.filter(t=>t.activity?.type===i)),S!=="all"){const t=new Date;s=s.filter(u=>{if(!u.activity?.due_date)return S==="no_deadline";const z=new Date(u.activity.due_date);switch(S){case"overdue":return Pe(z)&&!ue(z);case"today":return ue(z);case"tomorrow":return He(z);case"week":return qs(z)&&z<=new Date(t.getTime()+10080*60*1e3);default:return!0}})}return s.sort((t,u)=>{switch(y){case"recent":return new Date(u.assigned_at)-new Date(t.assigned_at);case"deadline":return t.activity?.due_date?u.activity?.due_date?new Date(t.activity.due_date)-new Date(u.activity.due_date):-1:1;case"submissions":return u.submissionsCount-t.submissionsCount;case"corrections":return u.pendingCorrections-t.pendingCorrections;case"title":return(t.activity?.title||"").localeCompare(u.activity?.title||"");default:return 0}}),s},B=s=>{if(!s)return"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300";const t=new Date(s);return Pe(t)&&!ue(t)?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":ue(t)||He(t)?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"},f=s=>{if(!s)return"Sem prazo";const t=new Date(s);return ue(t)?`Hoje Ã s ${fe(t,"HH:mm")}`:He(t)?`AmanhÃ£ Ã s ${fe(t,"HH:mm")}`:Pe(t)?`Atrasado - ${fe(t,"dd/MM/yyyy")}`:ve(t,{locale:ce,addSuffix:!0})},M=async s=>{try{const{data:t,error:u}=await b.from("submissions").select(`
          *,
          student:profiles!student_id(full_name, email)
        `).eq("activity_id",s.id).not("grade","is",null);if(u)throw u;if(!t||t.length===0){g({title:"Sem notas",description:"Esta atividade ainda nÃ£o possui notas lanÃ§adas.",variant:"destructive"});return}const z=[["Aluno","Email","Nota","Data de Envio","Data de CorreÃ§Ã£o"],...t.map(O=>[O.student?.full_name||"Sem nome",O.student?.email||"",O.grade||"0",O.submitted_at?new Date(O.submitted_at).toLocaleDateString("pt-BR"):"-",O.graded_at?new Date(O.graded_at).toLocaleDateString("pt-BR"):"-"])].map(O=>O.join(",")).join(`
`),G=new Blob([z],{type:"text/csv;charset=utf-8;"}),Z=document.createElement("a");Z.href=URL.createObjectURL(G),Z.download=`notas_${s.title.replace(/[^a-z0-9]/gi,"_")}.csv`,Z.click(),g({title:"âœ… Notas exportadas!",description:`${t.length} nota(s) exportada(s) em CSV.`})}catch(t){L.error("Erro ao exportar notas:",t),g({title:"âŒ Erro ao exportar",description:t.message,variant:"destructive"})}},Q=async s=>{try{const{error:t}=await b.from("activities").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",s.id);if(t)throw t;g({title:"âœ… Atividade arquivada!",description:"A atividade foi movida para arquivados."}),k()}catch(t){L.error("Erro ao arquivar atividade:",t),g({title:"âŒ Erro ao arquivar",description:t.message,variant:"destructive"})}},a=(s,t)=>{m({isOpen:!0,id:s,title:t})},c=async()=>{const{id:s,title:t}=r;if(!s){g({title:"âŒ Erro",description:"ID da atividade nÃ£o encontrado.",variant:"destructive"}),m({isOpen:!1,id:null,title:""});return}try{const{error:u}=await b.from("activity_class_assignments").delete().eq("activity_id",s).eq("class_id",n);if(u)throw u;g({title:"âœ… Atividade removida",description:`"${t}" foi removida da turma com sucesso.`}),m({isOpen:!1,id:null,title:""}),k()}catch(u){L.error("Erro ao deletar atividade:",u),g({title:"âŒ Erro ao deletar atividade",description:u.message,variant:"destructive"}),m({isOpen:!1,id:null,title:""})}};if(C)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const q=D();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(h,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Ze,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(ae,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.published}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Publicadas"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(H,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.draft}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Rascunhos"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(ze,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.overdue}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Atrasadas"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(oe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"P/ Corrigir"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atividades da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[q.length," de ",V.total," atividades"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>F(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Postar Existente"]}),e.jsxs(T,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>E(`/atividades/criar?classId=${n}`),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Nova Atividade"]})]})]}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar atividade...",value:P,onChange:s=>v(s.target.value),className:"pl-10"})]})}),e.jsxs(Y,{value:o,onValueChange:w,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Status"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Status"}),e.jsx(_,{value:"published",children:"Publicadas"}),e.jsx(_,{value:"draft",children:"Rascunhos"}),e.jsx(_,{value:"pending_correction",children:"Pendentes"})]})]}),e.jsxs(Y,{value:S,onValueChange:x,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Prazo"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Prazos"}),e.jsx(_,{value:"overdue",children:"Atrasadas"}),e.jsx(_,{value:"today",children:"Hoje"}),e.jsx(_,{value:"tomorrow",children:"AmanhÃ£"}),e.jsx(_,{value:"week",children:"Esta Semana"}),e.jsx(_,{value:"no_deadline",children:"Sem Prazo"})]})]}),e.jsxs(Y,{value:y,onValueChange:$,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Ordenar"})}),e.jsxs(se,{children:[e.jsx(_,{value:"recent",children:"Mais Recentes"}),e.jsx(_,{value:"deadline",children:"Prazo (prÃ³ximo)"}),e.jsx(_,{value:"submissions",children:"SubmissÃµes"}),e.jsx(_,{value:"corrections",children:"CorreÃ§Ãµes"}),e.jsx(_,{value:"title",children:"TÃ­tulo (A-Z)"})]})]})]})}),q.length===0?e.jsx(h,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:N.length===0?"Nenhuma atividade postada":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:N.length===0?"Crie ou poste uma atividade para comeÃ§ar.":"Ajuste os filtros para ver mais resultados."}),N.length===0&&e.jsxs(T,{onClick:()=>E(`/dashboard/activities/create?classId=${n}`),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Criar Primeira Atividade"]})]})}):e.jsx("div",{className:"space-y-3",children:q.map((s,t)=>{const u=s.activity,z=s.submissionRate>=80?"text-green-600":s.submissionRate>=50?"text-yellow-600":"text-red-600";return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsx(h,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500",children:e.jsx(H,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:u?.title||"Sem tÃ­tulo"}),!u?.is_published&&e.jsx(U,{variant:"secondary",className:"text-xs",children:"Rascunho"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:u?.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(U,{variant:"outline",className:"text-xs",children:u?.type==="assignment"?"Trabalho":u?.type==="quiz"?"Quiz":u?.type==="exam"?"Prova":u?.type||"Atividade"}),e.jsxs(U,{className:`text-xs ${B(u?.due_date)}`,children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),f(u?.due_date)]}),e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),"Postado ",ve(new Date(s.assigned_at),{locale:ce,addSuffix:!0})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:`text-sm font-semibold ${z}`,children:[s.submissionRate.toFixed(0),"%"]})]}),e.jsx(he,{value:s.submissionRate,className:"h-2 mb-1"}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.submissionsCount,"/",s.totalStudents," submissÃµes"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${s.pendingCorrections>0?"text-yellow-600":"text-green-600"}`,children:s.pendingCorrections}),e.jsx("div",{className:"text-xs text-slate-500",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.avgGrade?.toFixed(1)||"â€”"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>E(`/dashboard/activities/${u?.id}/submissions`),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver SubmissÃµes"]}),e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(De,{align:"end",children:[e.jsxs(I,{onClick:()=>E(`/dashboard/activities/${u?.activity?.id}/edit`),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar Atividade"]}),e.jsxs(I,{onClick:()=>M(u),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Exportar Notas"]}),e.jsx(Te,{}),e.jsxs(I,{onClick:()=>Q(u),children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Arquivar"]}),e.jsxs(I,{className:"text-red-600 dark:text-red-400",onClick:()=>{const G=s?.activity?.id,Z=s?.activity?.title||"Atividade";L.debug("[ActivitiesTab] Delete clicked:",{activityId:G,activityTitle:Z,fullAssignment:s}),a(G,Z)},children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})})},s.id)})}),e.jsx(Vs,{isOpen:A,onClose:()=>F(!1),classId:n,onSuccess:k}),e.jsx(qe,{isOpen:r.isOpen,onClose:()=>m({isOpen:!1,id:null,title:""}),onConfirm:c,title:"Remover Atividade da Turma",message:`Tem certeza que deseja remover "${r.title}" desta turma? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},Gs=({isOpen:n,onClose:E,classId:C,classData:j,onSuccess:N})=>{const[p,r]=l.useState(!1),[m,P]=l.useState("email"),[v,o]=l.useState(""),[w,i]=l.useState(""),[d,S]=l.useState(null),x=j?.invite_code?`${window.location.origin}/join/${j.invite_code}`:"",y=async()=>{if(!v.trim()){g({title:"Email obrigatÃ³rio",description:"Digite um email para buscar",variant:"destructive"});return}try{r(!0);const{data:R,error:k}=await b.from("profiles").select("id, full_name, email, avatar_url").eq("email",v.toLowerCase()).eq("role","student").single();if(k||!R){S({found:!1,searched:!0}),g({title:"Aluno nÃ£o encontrado",description:"Email nÃ£o cadastrado no sistema como aluno",variant:"destructive"});return}S({found:!0,user:R})}catch(R){L.error("Erro ao buscar email:",R)}finally{r(!1)}},$=async()=>{if(d?.user)try{r(!0);const{data:R}=await b.from("class_members").select("id").eq("class_id",C).eq("user_id",d.user.id).single();if(R){g({title:"Aluno jÃ¡ estÃ¡ na turma",variant:"destructive"});return}const{data:k,error:D}=await b.from("class_members").insert({class_id:C,user_id:d.user.id,role:"student",joined_at:new Date().toISOString()}).select();if(D)throw D;if(!k||k.length===0)throw new Error("Falha ao adicionar aluno - nenhum registro criado");L.debug("âœ… Aluno adicionado com sucesso:",k[0]);try{await $e.invalidateClass(C)}catch(B){L.warn("Aviso: Erro ao invalidar cache, mas aluno foi adicionado:",B)}g({title:"âœ… Aluno adicionado com sucesso!",description:`${d.user.full_name} agora faz parte da turma. PeÃ§a para ele fazer logout e login novamente.`}),o(""),S(null),N?.()}catch(R){L.error("Erro ao adicionar aluno:",R),g({title:"Erro ao adicionar aluno",description:R.message,variant:"destructive"})}finally{r(!1)}},A=async()=>{const R=w.split(`
`).map(k=>k.trim()).filter(k=>k&&k.includes("@"));if(R.length===0){g({title:"Nenhum email vÃ¡lido",variant:"destructive"});return}try{r(!0);let k=0,D=0,B=0;for(const f of R){const{data:M}=await b.from("profiles").select("id").eq("email",f.toLowerCase()).eq("role","student").single();if(!M){D++;continue}const{data:Q}=await b.from("class_members").select("id").eq("class_id",C).eq("user_id",M.id).single();if(Q){B++;continue}await b.from("class_members").insert({class_id:C,user_id:M.id,role:"student",joined_at:new Date().toISOString()}),k++}await $e.invalidateClass(C),g({title:"ImportaÃ§Ã£o concluÃ­da",description:`${k} alunos adicionados, ${D} nÃ£o encontrados, ${B} jÃ¡ eram membros`}),i(""),N?.()}catch(k){L.error("Erro na importaÃ§Ã£o:",k),g({title:"Erro na importaÃ§Ã£o",description:k.message,variant:"destructive"})}finally{r(!1)}},F=()=>{navigator.clipboard.writeText(x),g({title:"Link copiado!",description:"Link de convite copiado para Ã¡rea de transferÃªncia"})},V=()=>{navigator.clipboard.writeText(j.invite_code),g({title:"CÃ³digo copiado!",description:"CÃ³digo de convite copiado"})};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(h,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Aluno"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha um mÃ©todo para adicionar alunos"})]}),e.jsx("button",{onClick:E,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(be,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex gap-2",children:[{id:"email",label:"Buscar por Email",icon:pe},{id:"invite_link",label:"Link de Convite",icon:Ve}].map(R=>{const k=R.icon;return e.jsxs("button",{onClick:()=>P(R.id),className:`flex-1 px-4 py-2 rounded-lg font-medium text-sm transition-all ${m===R.id?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200"}`,children:[e.jsx(k,{className:"w-4 h-4 inline mr-2"}),R.label]},R.id)})}),m==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email do Aluno"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:v,onChange:R=>o(R.target.value),placeholder:"aluno@exemplo.com",className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",onKeyPress:R=>R.key==="Enter"&&y()}),e.jsxs(T,{onClick:y,disabled:p,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),p?"Buscando...":"Buscar"]})]})]}),d?.found&&d.user&&e.jsx(h,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:d.user.full_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:d.user.full_name}),e.jsx("div",{className:"text-sm text-slate-600",children:d.user.email})]})]}),e.jsx(T,{onClick:$,disabled:p,children:p?"Adicionando...":"Adicionar Ã  Turma"})]})}),d?.searched&&!d?.found&&e.jsx(h,{className:"p-4 bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-1",children:"âŒ Email nÃ£o encontrado"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Verifique se o email estÃ¡ correto ou se o aluno jÃ¡ estÃ¡ cadastrado no sistema."})]})})]}),m==="invite_link"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{className:"p-4 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"CÃ³digo de Convite"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-lg font-mono",children:j?.invite_code||"N/A"}),e.jsx(T,{variant:"outline",size:"sm",onClick:V,children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Link de Convite"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:x,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-sm"}),e.jsx(T,{variant:"outline",size:"sm",onClick:F,children:e.jsx(Ke,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Compartilhe o cÃ³digo ou link com os alunos. Eles poderÃ£o entrar automaticamente na turma."})]}),m==="bulk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Lista de Emails"}),e.jsx("textarea",{value:w,onChange:R=>i(R.target.value),placeholder:`aluno1@exemplo.com
aluno2@exemplo.com
aluno3@exemplo.com`,rows:8,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Cole uma lista de emails (um por linha)"})]}),e.jsx(T,{onClick:A,disabled:p,className:"w-full",children:p?"Importando...":"Importar Alunos"})]})]})]})}):null},Us=({classId:n,classData:E})=>{const[C,j]=l.useState(!0),[N,p]=l.useState([]),[r,m]=l.useState(""),[P,v]=l.useState({isOpen:!1,id:null,name:""}),[o,w]=l.useState("all"),[i,d]=l.useState("all"),[S,x]=l.useState("all"),[y,$]=l.useState("name"),[A,F]=l.useState(!1),[V,R]=l.useState({total:0,active:0,alert:0,critical:0});l.useEffect(()=>{k()},[n]);const k=async()=>{try{j(!0);const{data:s,error:t}=await b.from("class_members").select(`
          *,
          profile:profiles!inner(id, full_name, email, avatar_url)
        `).eq("class_id",n).eq("role","student").order("joined_at",{ascending:!1});if(t)throw t;const{data:u}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",n),z=u?.map(O=>O.activity_id)||[],G=await Promise.all((s||[]).map(async O=>{if(!O.user_id||z.length===0)return{...O,avgGrade:null,deliveryRate:0,submissionsCount:0,totalActivities:z.length,status:"active",lastActivity:null};const{data:te}=await b.from("submissions").select("grade, status, submitted_at").eq("student_id",O.user_id).in("activity_id",z),Ne=te?.map(K=>parseFloat(K.grade)).filter(K=>!isNaN(K))||[],de=Ne.length>0?Ne.reduce((K,Qe)=>K+Qe,0)/Ne.length:null,me=te?.filter(K=>K.status==="submitted"||K.status==="graded").length||0,we=z.length>0?me/z.length*100:0;let ye="active";de!==null&&de<5?ye="critical":(de!==null&&de<6||we<60)&&(ye="alert");const ke=te&&te.length>0?new Date(Math.max(...te.map(K=>new Date(K.submitted_at||0)))):null;return{...O,avgGrade:de,deliveryRate:we,submissionsCount:me,totalActivities:z.length,status:ye,lastActivity:ke}})),Z={total:G.length,active:G.filter(O=>O.status==="active").length,alert:G.filter(O=>O.status==="alert").length,critical:G.filter(O=>O.status==="critical").length};p(G),R(Z)}catch(s){L.error("Erro ao carregar alunos:",s),g({title:"Erro ao carregar alunos",description:s.message,variant:"destructive"}),p([])}finally{j(!1)}},D=()=>{let s=N;if(r){const t=r.toLowerCase();s=s.filter(u=>u.profile?.full_name?.toLowerCase().includes(t)||u.profile?.email?.toLowerCase().includes(t))}return o!=="all"&&(s=s.filter(t=>t.status===o)),i!=="all"&&(s=s.filter(t=>{if(!t.avgGrade)return i==="none";switch(i){case"excellent":return t.avgGrade>=9;case"good":return t.avgGrade>=7&&t.avgGrade<9;case"regular":return t.avgGrade>=5&&t.avgGrade<7;case"low":return t.avgGrade<5;default:return!0}})),S!=="all"&&(s=s.filter(t=>{switch(S){case"high":return t.deliveryRate>=80;case"medium":return t.deliveryRate>=50&&t.deliveryRate<80;case"low":return t.deliveryRate<50;default:return!0}})),s.sort((t,u)=>{switch(y){case"name":return(t.profile?.full_name||"").localeCompare(u.profile?.full_name||"");case"grade":return(u.avgGrade||0)-(t.avgGrade||0);case"delivery":return u.deliveryRate-t.deliveryRate;case"recent":return new Date(u.joined_at)-new Date(t.joined_at);default:return 0}}),s},B=s=>{g({title:"Em desenvolvimento",description:"PÃ¡gina de detalhes do aluno serÃ¡ implementada em breve"})},f=s=>{g({title:"Em desenvolvimento",description:"VisualizaÃ§Ã£o de atividades do aluno serÃ¡ implementada em breve"})},M=s=>{g({title:"Em desenvolvimento",description:"Sistema de mensagens serÃ¡ implementado em breve"})},Q=(s,t)=>{v({isOpen:!0,id:s,name:t})},a=async()=>{const{id:s,name:t}=P;try{const{error:u}=await b.from("class_members").delete().eq("user_id",s).eq("class_id",n);if(u)throw u;g({title:"âœ… Aluno removido",description:`${t} foi removido da turma com sucesso.`}),k()}catch(u){L.error("Erro ao remover aluno:",u),g({title:"âŒ Erro ao remover aluno",description:u.message,variant:"destructive"})}},c=()=>{const s=D(),t=[["Nome","Email","Nota MÃ©dia","Taxa de Entrega","Status","Data de Entrada"],...s.map(G=>[G.profile?.full_name||"",G.profile?.email||"",G.avgGrade?.toFixed(1)||"N/A",`${G.deliveryRate.toFixed(0)}%`,G.status==="active"?"Ativo":G.status==="alert"?"Alerta":"CrÃ­tico",fe(new Date(G.joined_at),"dd/MM/yyyy",{locale:ce})])].map(G=>G.join(",")).join(`
`),u=new Blob([t],{type:"text/csv;charset=utf-8;"}),z=document.createElement("a");z.href=URL.createObjectURL(u),z.download=`alunos_${E?.name||"turma"}_${fe(new Date,"yyyy-MM-dd")}.csv`,z.click(),g({title:"Lista exportada",description:"Arquivo CSV baixado com sucesso."})};if(C)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const q=D();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(h,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(le,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(ae,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.active}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Ativos"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(oe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.alert}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Em Alerta"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(oe,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CrÃ­tico"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Alunos da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[q.length," de ",V.total," alunos"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(T,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>F(!0),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Adicionar Aluno"]})]})]}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar por nome ou email...",value:r,onChange:s=>m(s.target.value),className:"pl-10"})]})}),e.jsxs(Y,{value:o,onValueChange:w,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Status"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Status"}),e.jsx(_,{value:"active",children:"Ativo"}),e.jsx(_,{value:"alert",children:"Em Alerta"}),e.jsx(_,{value:"critical",children:"CrÃ­tico"})]})]}),e.jsxs(Y,{value:i,onValueChange:d,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Nota"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todas as Notas"}),e.jsx(_,{value:"excellent",children:"Excelente (â‰¥9.0)"}),e.jsx(_,{value:"good",children:"Bom (7.0-8.9)"}),e.jsx(_,{value:"regular",children:"Regular (5.0-6.9)"}),e.jsx(_,{value:"low",children:"Baixo (<5.0)"}),e.jsx(_,{value:"none",children:"Sem Nota"})]})]}),e.jsxs(Y,{value:y,onValueChange:$,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Ordenar"})}),e.jsxs(se,{children:[e.jsx(_,{value:"name",children:"Nome (A-Z)"}),e.jsx(_,{value:"grade",children:"Nota (maior)"}),e.jsx(_,{value:"delivery",children:"Taxa Entrega"}),e.jsx(_,{value:"recent",children:"Mais Recentes"})]})]})]})}),q.length===0?e.jsx(h,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:N.length===0?"Nenhum aluno na turma":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:N.length===0?"Adicione alunos ou compartilhe o cÃ³digo de convite da turma.":"Ajuste os filtros para ver mais resultados."}),N.length===0&&e.jsxs(T,{onClick:()=>F(!0),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Adicionar Primeiro Aluno"]})]})}):e.jsx("div",{className:"space-y-3",children:q.map((s,t)=>{const u=s.avgGrade>=7?"text-green-600":s.avgGrade>=5?"text-yellow-600":"text-red-600",z=s.deliveryRate>=80?"text-green-600":s.deliveryRate>=60?"text-yellow-600":"text-red-600";return e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsx(h,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs(is,{className:"w-12 h-12",children:[e.jsx(ns,{src:s.profile?.avatar_url}),e.jsx(ds,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white font-bold",children:s.profile?.full_name?.[0]||"A"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg",children:s.profile?.full_name||"Nome nÃ£o disponÃ­vel"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.profile?.email||"Email nÃ£o disponÃ­vel"}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2 mt-1",children:[e.jsx(re,{className:"w-3 h-3"}),"Entrou ",ve(new Date(s.joined_at),{locale:ce,addSuffix:!0})]})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${u}`,children:s.avgGrade?.toFixed(1)||"â€”"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]}),e.jsxs("div",{className:"text-center min-w-[120px]",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("span",{className:`text-sm font-semibold ${z}`,children:[s.deliveryRate.toFixed(0),"%"]})}),e.jsx(he,{value:s.deliveryRate,className:"h-2"}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[s.submissionsCount,"/",s.totalActivities," entregas"]})]}),e.jsx(U,{className:s.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":s.status==="alert"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",children:s.status==="active"?"Ativo":s.status==="alert"?"Alerta":"CrÃ­tico"})]}),e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(De,{align:"end",children:[e.jsxs(I,{onClick:()=>B(),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(I,{onClick:()=>f(),children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Ver Atividades"]}),e.jsxs(I,{onClick:()=>M(),children:[e.jsx(ys,{className:"w-4 h-4 mr-2"}),"Enviar Mensagem"]}),e.jsx(Te,{}),e.jsxs(I,{className:"text-red-600 dark:text-red-400",onClick:()=>Q(s.id,s.profile?.full_name),children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Remover da Turma"]})]})]})]})})},s.id)})}),e.jsx(Gs,{isOpen:A,onClose:()=>F(!1),classId:n,classData:E,onSuccess:()=>{F(!1),k()}}),e.jsx(qe,{isOpen:P.isOpen,onClose:()=>v({isOpen:!1,id:null,name:""}),onConfirm:a,title:"Remover Aluno da Turma",message:`Tem certeza que deseja remover ${P.name} desta turma? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},Is=({classId:n})=>{const[E,C]=l.useState(!0),[j,N]=l.useState({avgGrade:0,deliveryRate:0,engagement:0,totalStudents:0,activeStudents:0,totalActivities:0,completedActivities:0,pendingCorrections:0}),[p,r]=l.useState([]),[m,P]=l.useState([]);l.useEffect(()=>{v()},[n]);const v=async()=>{try{C(!0);const{count:o}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student"),{data:w}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",n),i=w?.map(f=>f.activity_id)||[];let d=[];if(i.length>0){const{data:f}=await b.from("submissions").select("student_id, activity_id, grade, status").in("activity_id",i);d=f||[]}const S=d.filter(f=>f.grade!==null).map(f=>parseFloat(f.grade)),x=S.length>0?S.reduce((f,M)=>f+M,0)/S.length:0,y=o*i.length,$=y>0?d.length/y*100:0,A=d.filter(f=>f.status==="submitted").length,F={};d.forEach(f=>{F[f.student_id]||(F[f.student_id]={grades:[],submissions:0}),F[f.student_id].submissions++,f.grade!==null&&F[f.student_id].grades.push(parseFloat(f.grade))});const{data:V}=await b.from("profiles").select("id, full_name").in("id",Object.keys(F)),R=Object.entries(F).map(([f,M])=>{const Q=V?.find(c=>c.id===f),a=M.grades.length>0?M.grades.reduce((c,q)=>c+q,0)/M.grades.length:0;return{id:f,name:Q?.full_name||"Desconhecido",avgGrade:a,submissions:M.submissions,deliveryRate:M.submissions/i.length*100}}).sort((f,M)=>M.avgGrade-f.avgGrade).slice(0,5);r(R);const k={};d.forEach(f=>{k[f.activity_id]||(k[f.activity_id]={count:0,grades:[]}),k[f.activity_id].count++,f.grade!==null&&k[f.activity_id].grades.push(parseFloat(f.grade))});const{data:D}=await b.from("activities").select("id, title").in("id",Object.keys(k)),B=Object.entries(k).map(([f,M])=>{const Q=D?.find(c=>c.id===f),a=M.grades.length>0?M.grades.reduce((c,q)=>c+q,0)/M.grades.length:0;return{title:Q?.title||"Sem tÃ­tulo",submissions:M.count,avgGrade:a,rate:M.count/o*100}}).sort((f,M)=>M.submissions-f.submissions).slice(0,5);P(B),N({avgGrade:x,deliveryRate:$,engagement:$,totalStudents:o||0,activeStudents:Object.keys(F).length,totalActivities:i.length,completedActivities:i.length,pendingCorrections:A})}catch(o){L.error("Erro ao carregar mÃ©tricas:",o),g({title:"Erro ao carregar mÃ©tricas",description:o.message,variant:"destructive"})}finally{C(!1)}};return E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"MÃ©tricas da Turma"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"AnÃ¡lise de desempenho e engajamento"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(h,{className:"p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(ts,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx(_e,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:j.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Nota MÃ©dia Geral"}),e.jsx("div",{className:"mt-2",children:e.jsx(he,{value:j.avgGrade/10*100,className:"h-2"})})]}),e.jsxs(h,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(ae,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx(_e,{className:"w-5 h-5 text-blue-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[j.deliveryRate.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Taxa de Entrega"}),e.jsx("div",{className:"mt-2",children:e.jsx(he,{value:j.deliveryRate,className:"h-2"})})]}),e.jsxs(h,{className:"p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(rs,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx(_e,{className:"w-5 h-5 text-purple-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:[j.engagement.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Engajamento"}),e.jsx("div",{className:"mt-2",children:e.jsx(he,{value:j.engagement,className:"h-2"})})]}),e.jsxs(h,{className:"p-6 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(ze,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),j.pendingCorrections>0?e.jsx(oe,{className:"w-5 h-5 text-yellow-600"}):e.jsx(ae,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-1",children:j.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CorreÃ§Ãµes Pendentes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total de Alunos"})]})]})}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.activeStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Alunos Ativos"})]})]})}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Atividades"})]})]})}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rs,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.completedActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"ConcluÃ­das"})]})]})})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5 text-yellow-600"}),"Top 5 Alunos por Desempenho"]}),p.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhum dado disponÃ­vel ainda"}):e.jsx("div",{className:"space-y-3",children:p.map((o,w)=>e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:w*.1},className:"flex items-center justify-between p-4 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`
                    w-8 h-8 rounded-full flex items-center justify-center font-bold
                    ${w===0?"bg-yellow-100 text-yellow-700":w===1?"bg-slate-200 text-slate-700":w===2?"bg-orange-100 text-orange-700":"bg-slate-100 text-slate-600"}
                  `,children:w+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:o.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[o.submissions," submissÃµes â€¢ ",o.deliveryRate.toFixed(0),"% entrega"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]})]},o.id))})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-blue-600"}),"Top 5 Atividades por Engajamento"]}),m.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhuma atividade com submissÃµes ainda"}):e.jsx("div",{className:"space-y-4",children:m.map((o,w)=>e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:w*.1},children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:o.title}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[o.submissions," submissÃµes â€¢ MÃ©dia: ",o.avgGrade.toFixed(1)]})]}),e.jsxs(U,{className:o.rate>=80?"bg-green-100 text-green-700":o.rate>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700",children:[o.rate.toFixed(0),"%"]})]}),e.jsx(he,{value:o.rate,className:"h-2"})]})},w))})]}),e.jsxs(h,{className:"p-12 text-center border-2 border-dashed",children:[e.jsx(Xe,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"GrÃ¡ficos Detalhados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:["GrÃ¡ficos de evoluÃ§Ã£o temporal, distribuiÃ§Ã£o de notas e comparativos",e.jsx("br",{}),"podem ser adicionados aqui usando Recharts ou Chart.js"]}),e.jsx(U,{variant:"secondary",children:"Em Breve"})]})]})},Qs=({classId:n,classData:E})=>{const[C,j]=l.useState(!0),[N,p]=l.useState(!1),[r,m]=l.useState([]),[P,v]=l.useState([]),[o,w]=l.useState("friendly"),[i,d]=l.useState({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0});l.useRef(!1),l.useEffect(()=>{S(),(async()=>{try{const{data:$,error:A}=await b.from("classes").select("settings").eq("id",n).single();if(A)throw A;const F=$?.settings?.chatbot_enabled||!1,V=$?.settings?.chatbot_paused||!1;p(F&&!V),L.debug("ðŸ¤– Estado do chatbot carregado:",{enabled:F,paused:V})}catch($){L.error("Erro ao carregar estado do chatbot:",$)}})()},[n,E]);const S=async()=>{try{j(!0);const{data:y}=await b.from("class_materials").select("id, title, file_type, category").eq("class_id",n);m(y||[]);const{data:$}=await b.from("rag_training_sources").select("*").eq("class_id",n);v($||[]),d({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0})}catch(y){L.error("Erro ao carregar dados do chatbot:",y),g({title:"Erro ao carregar chatbot",description:y.message,variant:"destructive"})}finally{j(!1)}},x=async y=>{p(y);try{const{data:$}=await b.from("classes").select("settings").eq("id",n).single(),{error:A}=await b.from("classes").update({settings:{...$?.settings||{},chatbot_enabled:y,chatbot_paused:!y}}).eq("id",n);if(A)throw A;g({title:y?"âœ… Chatbot Ativado":"â¸ï¸ Chatbot Desativado",description:y?"O assistente virtual estÃ¡ agora disponÃ­vel para os alunos.":"O assistente virtual foi desativado."}),L.debug("ðŸ¤– Estado do chatbot salvo:",{enabled:y})}catch($){L.error("Erro ao salvar configuraÃ§Ã£o:",$),p(!y),g({title:"Erro ao salvar",description:"NÃ£o foi possÃ­vel salvar a configuraÃ§Ã£o. Tente novamente.",variant:"destructive"})}};return C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Assistente Virtual (Chatbot)"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Configure um assistente com IA para responder dÃºvidas dos alunos"})]}),e.jsx(h,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg",children:e.jsx(Fe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Status do Chatbot"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:N?"âœ… Assistente virtual ativo e respondendo alunos":"âš ï¸ Assistente virtual desativado"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:y=>x(y.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})}),N&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(h,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gs,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.totalQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Perguntas"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.answeredQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Respondidas"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ks,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.avgResponseTime}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Tempo MÃ©dio"})]})]})}),e.jsx(h,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[i.satisfactionRate,"%"]}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"SatisfaÃ§Ã£o"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5 text-blue-600"}),"Personalidade do Bot"]}),e.jsxs(Y,{value:o,onValueChange:w,children:[e.jsx(J,{children:e.jsx(ee,{placeholder:"Escolha a personalidade"})}),e.jsxs(se,{children:[e.jsx(_,{value:"friendly",children:"ðŸ˜Š AmigÃ¡vel e Casual"}),e.jsx(_,{value:"formal",children:"ðŸ‘” Formal e Profissional"}),e.jsx(_,{value:"motivational",children:"ðŸš€ Motivador e EnergÃ©tico"}),e.jsx(_,{value:"patient",children:"ðŸ§˜ Paciente e DidÃ¡tico"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[o==="friendly"&&"ðŸ’¬ O bot usarÃ¡ linguagem casual e amigÃ¡vel",o==="formal"&&"ðŸ“ O bot manterÃ¡ tom profissional e formal",o==="motivational"&&"âœ¨ O bot serÃ¡ motivador e entusiasta",o==="patient"&&"ðŸŽ¯ O bot explicarÃ¡ com paciÃªncia e detalhes"]})})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-purple-600"}),"Modelo de IA"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Claude 3.5 Sonnet"}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Modelo avanÃ§ado da Anthropic"})]}),e.jsx(U,{className:"bg-green-100 text-green-700",children:"Ativo"})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["âœ… Respostas contextualizadas",e.jsx("br",{}),"âœ… CompreensÃ£o avanÃ§ada de linguagem",e.jsx("br",{}),"âœ… SeguranÃ§a e moderaÃ§Ã£o automÃ¡tica"]})]})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),"Materiais para Treinamento (RAG)"]}),e.jsxs(U,{variant:"secondary",children:[P.length," fontes ativas"]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Selecione materiais da turma para treinar o chatbot. Ele usarÃ¡ esses conteÃºdos para responder perguntas."}),r.length===0?e.jsxs("div",{className:"text-center py-8 bg-slate-50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-2 text-slate-300"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Nenhum material disponÃ­vel.",e.jsx("br",{}),"Adicione materiais na tab Biblioteca primeiro."]})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.slice(0,5).map((y,$)=>e.jsxs(W.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:$*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",defaultChecked:P.some(A=>A.material_id===y.id)}),e.jsx(H,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:y.title}),e.jsx("div",{className:"text-xs text-slate-500",children:y.category})]}),e.jsx(U,{variant:"outline",className:"text-xs",children:y.file_type?.split("/")[1]||"arquivo"})]},y.id))}),e.jsxs(T,{className:"w-full mt-4",variant:"outline",children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Treinar Chatbot com Materiais Selecionados"]})]}),e.jsxs(h,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(es,{className:"w-5 h-5 text-blue-600"}),"Preview do Chatbot"]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm",children:["OlÃ¡! ðŸ‘‹ Sou o assistente virtual da turma ",e.jsx("strong",{children:E?.name}),". Como posso ajudar vocÃª hoje?"]})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Agora mesmo"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsxs("div",{className:"flex-1 max-w-md",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-lg p-3",children:e.jsx("p",{className:"text-sm",children:"Quando Ã© a prova de matemÃ¡tica?"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1 text-right",children:"VisualizaÃ§Ã£o"})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-300 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(le,{className:"w-4 h-4"})})]})]})]})]}),!N&&e.jsxs(h,{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-flex p-6 rounded-full bg-slate-100 dark:bg-slate-800 mb-4",children:e.jsx(Fe,{className:"w-16 h-16 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Chatbot Desativado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6 max-w-md mx-auto",children:"Ative o assistente virtual para permitir que alunos tirem dÃºvidas automaticamente 24/7 com respostas contextualizadas baseadas nos materiais da turma."}),e.jsx("div",{className:"flex justify-center gap-4",children:e.jsxs(T,{onClick:()=>x(!0),size:"lg",children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),"Ativar Chatbot"]})})]})]})},ma=()=>{const{classId:n}=xs(),E=Je(),{user:C}=us(),[j,N]=hs(),[p,r]=l.useState(!0),[m,P]=l.useState(null),[v,o]=l.useState(j.get("tab")||"overview"),[w,i]=l.useState(0);l.useEffect(()=>{if(!/^[0-9a-fA-F-]{36}$/.test(n)){E("/dashboard/classes",{replace:!0});return}n&&d()},[n]),l.useEffect(()=>{const A=j.get("tab");A&&o(A)},[j]);const d=async()=>{try{r(!0);const{data:A,error:F}=await b.from("classes").select("*").eq("id",n).single();if(F)throw L.error("Erro ao buscar turma:",F),F;if(!A)throw L.error("Turma nÃ£o encontrada:",n),new Error("Turma nÃ£o encontrada");P(A);const{count:V}=await b.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",n).eq("role","student");i(V||0)}catch(A){L.error("Erro ao carregar turma:",A),g({title:"Erro ao carregar turma",description:A.message||"NÃ£o foi possÃ­vel carregar os dados da turma.",variant:"destructive"}),E("/dashboard/classes")}finally{r(!1)}},S=A=>{o(A),N({tab:A})},x=()=>{m?.invite_code&&(navigator.clipboard.writeText(m.invite_code),g({title:"CÃ³digo copiado!",description:"O cÃ³digo de convite foi copiado para a Ã¡rea de transferÃªncia."}))},y=[{id:"overview",label:"VisÃ£o Geral",icon:Es},{id:"content",label:"Mural de ConteÃºdo",icon:H},{id:"announcements",label:"Comunicados",icon:ge},{id:"library",label:"Biblioteca",icon:We},{id:"activities",label:"Atividades",icon:Ze},{id:"students",label:"Alunos",icon:le},{id:"metrics",label:"MÃ©tricas",icon:Xe},{id:"chatbot",label:"Chatbot",icon:es}];if(p)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ie,{size:"lg"})});const $=m?.color||"from-blue-600 to-cyan-500";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsxs("div",{className:`relative h-64 bg-gradient-to-r ${$} overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute top-4 left-6",children:e.jsxs(T,{variant:"ghost",onClick:()=>E("/dashboard/classes"),className:"text-white hover:bg-white/20",children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs("div",{className:"absolute top-4 right-6 flex items-center gap-2",children:[e.jsx(T,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(cs,{className:"w-4 h-4"})}),e.jsx(T,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(T,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-center px-6 max-w-7xl mx-auto",children:[e.jsx(W.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-4xl font-bold text-white mb-2",children:m?.name}),e.jsx(W.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-lg text-white/90 mb-4",children:m?.subject}),m?.description&&e.jsx(W.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-white/80 max-w-2xl line-clamp-2",children:m.description}),e.jsxs(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex items-center gap-3 mt-4",children:[e.jsxs(U,{className:"bg-white/20 text-white border-white/30",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),w," alunos"]}),m?.is_active!==!1?e.jsxs(U,{className:"bg-green-500/20 text-green-100 border-green-400/30",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Ativa"]}):e.jsx(U,{className:"bg-gray-500/20 text-gray-100 border-gray-400/30",children:"Arquivada"}),m?.invite_code&&e.jsxs(U,{className:"bg-white/20 text-white border-white/30 cursor-pointer hover:bg-white/30",onClick:x,children:[e.jsx(Ke,{className:"w-3 h-3 mr-1"}),"CÃ³digo: ",m.invite_code]})]})]}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 h-16 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsx("div",{className:"sticky top-0 z-40 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide py-1",children:y.map(A=>{const F=A.icon,V=v===A.id;return e.jsxs("button",{onClick:()=>S(A.id),className:`
                    flex items-center gap-2 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all
                    ${V?"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}
                  `,children:[e.jsx(F,{className:"w-4 h-4"}),A.label]},A.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[v==="overview"&&e.jsx(Ps,{classId:n,classData:m}),v==="content"&&e.jsx(Rs,{classId:n}),v==="announcements"&&e.jsx(zs,{classId:n}),v==="library"&&e.jsx(Os,{classId:n}),v==="activities"&&e.jsx(Bs,{classId:n}),v==="students"&&e.jsx(Us,{classId:n,classData:m}),v==="metrics"&&e.jsx(Is,{classId:n}),v==="chatbot"&&e.jsx(Qs,{classId:n,classData:m})]})]})};export{ma as default};
