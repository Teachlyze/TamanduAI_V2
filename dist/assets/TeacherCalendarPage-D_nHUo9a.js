import{r as l,s as A,l as M,j as e,p as V,a as se,g as le}from"./main--zAWDl51.js";import{C as I}from"./card-CLX4UMWo.js";import{B as C,m as X}from"./button-C_V7g8cA.js";import{t as z}from"./use-toast-BfpXbgWI.js";import{r as L}from"./redisCache-CSEX10d9.js";import{X as ee}from"./x-CvZonSQM.js";import{B as re}from"./book-open-DyM283ur.js";import{F as ie}from"./file-text-B2IQk9lY.js";import{U as oe}from"./users-C9tJN0-i.js";import{C as te}from"./calendar-DeEHT-Ew.js";import{S as ne}from"./save-DlWf1i0c.js";import{f as m}from"./format-BcFT9btV.js";import{E as de}from"./EventDetailsModal-CoO2z7Ko.js";import{F as ce}from"./funnel-Cr4vRVVN.js";import{s as W,a as me,i as ue}from"./isSameMonth-CK0W24Ro.js";import{e as Y}from"./endOfMonth-BD-g1yyK.js";import{s as xe,e as be}from"./subMonths-CphOl_Aj.js";import{P as Z}from"./plus-BNtwMxGF.js";import{C as pe}from"./SidebarPremium-CfP5whq7.js";import{C as he}from"./chevron-right-CHTWP7iA.js";import{A as ge}from"./index-Bvvn9rAe.js";import{i as ve}from"./isToday-By0hfvNN.js";import{p as K}from"./pt-BR-CuGSKEGQ.js";import"./en-US-B6HbAA6N.js";import"./badge-DEf2O6Nf.js";import"./clock-D8WWZ3gq.js";import"./map-pin-BQc7abEH.js";import"./user-DT5H40dm.js";import"./video-vHTtQH-O.js";import"./square-pen-CbQa5Brh.js";import"./copy-BZ49xlji.js";import"./trash-2-B1ZEmBt6.js";import"./index-CJgcaHTP.js";import"./house-CLldyvL4.js";import"./graduation-cap-D26J0z2u.js";import"./chart-column-C5QwmSZ5.js";import"./message-circle-CZexvp4h.js";import"./settings-C_eaHXhN.js";import"./constructNow-re94FRT2.js";import"./isSameDay-D5LInQhv.js";const ye=({isOpen:r,onClose:o,onSuccess:p,selectedDate:y,teacherId:g,editEvent:n=null})=>{const[x,S]=l.useState(!1),[D,F]=l.useState([]),[f,i]=l.useState([]),[j,_]=l.useState([]),[E,$]=l.useState(!1),k=!!n,[t,c]=l.useState({title:"",description:"",type:"event",start_date:y?m(y,"yyyy-MM-dd"):m(new Date,"yyyy-MM-dd"),start_time:"08:00",end_time:"09:00",modality:"online",meeting_link:"",location:"",selected_classes:[],selected_students:[],invite_type:"all",color:"#3B82F6",activity_id:null});l.useEffect(()=>{P(),T()},[g]),l.useEffect(()=>{if(k&&n&&r){const a=new Date(n.start_time),d=new Date(n.end_time);c({title:n.title||"",description:n.description||"",type:n.type||"event",start_date:m(a,"yyyy-MM-dd"),start_time:m(a,"HH:mm"),end_time:m(d,"HH:mm"),modality:n.modality||"online",meeting_link:n.meeting_link||"",location:n.location||"",selected_classes:n.class_id?[n.class_id]:[],selected_students:n.attendees||[],invite_type:n.attendees?.length>0?"individuals":n.class_id?"classes":"all",color:n.color||"#3B82F6",activity_id:n.activity_id||null})}else!k&&r&&c({title:"",description:"",type:"event",start_date:y?m(y,"yyyy-MM-dd"):m(new Date,"yyyy-MM-dd"),start_time:"08:00",end_time:"09:00",modality:"online",meeting_link:"",location:"",selected_classes:[],selected_students:[],invite_type:"all",color:"#3B82F6",activity_id:null})},[k,n,r,y]),l.useEffect(()=>{t.selected_classes.length>0&&t.invite_type==="individuals"?N():i([])},[t.selected_classes,t.invite_type]);const P=async()=>{try{const{data:a}=await A.from("classes").select("id, name").eq("created_by",g).eq("is_active",!0).order("name");F(a||[])}catch(a){M.error("Erro ao carregar turmas:",a)}},T=async()=>{try{const{data:a}=await A.from("activities").select("id, title, type, status").eq("created_by",g).neq("status","archived").order("created_at",{ascending:!1}).limit(50);_(a||[])}catch(a){M.error("Erro ao carregar atividades:",a)}},N=async()=>{try{$(!0);const{data:a,error:d}=await A.from("class_members").select(`
          user_id,
          class_id,
          profile:profiles!class_members_user_id_fkey(
            id,
            full_name,
            email,
            avatar_url
          )
        `).in("class_id",t.selected_classes).eq("role","student");if(d)throw d;const b=(a||[]).map(h=>({id:h.profile.id,name:h.profile.full_name||h.profile.email,email:h.profile.email,avatar:h.profile.avatar_url,classId:h.class_id})),v=Array.from(new Map(b.map(h=>[h.id,h])).values());i(v)}catch(a){M.error("Erro ao carregar alunos:",a),z({title:"Erro ao carregar alunos",description:a.message,variant:"destructive"})}finally{$(!1)}},R=async a=>{if(a.preventDefault(),!t.title.trim()){z({title:"Erro de validaÃ§Ã£o",description:"O tÃ­tulo Ã© obrigatÃ³rio.",variant:"destructive"});return}if(t.modality==="online"&&!t.meeting_link.trim()){z({title:"Erro de validaÃ§Ã£o",description:"Link da reuniÃ£o Ã© obrigatÃ³rio para eventos online.",variant:"destructive"});return}try{if(S(!0),k&&n){const H=new Date(`${t.start_date}T${t.start_time}`),s=new Date(`${t.start_date}T${t.end_time}`),u={title:t.title,description:t.description,type:t.type,start_time:H.toISOString(),end_time:s.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,attendees:t.invite_type==="individuals"?t.selected_students:null,color:t.color,activity_id:t.activity_id||null,updated_at:new Date().toISOString()},{error:w}=await A.from("calendar_events").update(u).eq("id",n.id);if(w)throw M.error("Erro ao atualizar evento:",w),new Error(w.message||"Erro ao atualizar evento");await L.deletePattern(`calendar:${g}:*`),z({title:"âœ… Evento atualizado!",description:`${t.title} foi atualizado com sucesso`}),p&&p(),o();return}const d=new Date(`${t.start_date}T${t.start_time}`),b=new Date(`${t.start_date}T${t.end_time}`);let v=null;t.type==="meeting"&&t.invite_type==="individuals"&&(v=t.selected_students);const h=t.selected_classes.length>0?t.selected_classes.map(H=>({title:t.title,description:t.description,type:t.type,start_time:d.toISOString(),end_time:b.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,class_id:H,attendees:v,color:t.color,activity_id:t.activity_id||null})):[{title:t.title,description:t.description,type:t.type,start_time:d.toISOString(),end_time:b.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,attendees:v,color:t.color,activity_id:t.activity_id||null}],{error:O}=await A.from("calendar_events").insert(h);if(O)throw M.error("Erro ao criar evento:",O),new Error(O.message||"Erro ao criar evento no banco de dados");const Q=m(d,"yyyy-MM");await L.deletePattern(`calendar:${g}:*`);const B=h.length;z({title:"âœ… Evento criado com sucesso!",description:B>1?`${B} eventos criados para diferentes turmas`:`${t.title} foi adicionado ao calendÃ¡rio`}),p&&p(),o()}catch(d){M.error("Erro ao criar evento:",d),z({title:"âŒ Erro ao criar evento",description:d.message||"NÃ£o foi possÃ­vel criar o evento. Tente novamente.",variant:"destructive"})}finally{S(!1)}},q=[{value:"event",label:"Aula",icon:re,color:"blue"},{value:"activity",label:"Atividade",icon:ie,color:"orange"},{value:"meeting",label:"ReuniÃ£o",icon:oe,color:"purple"},{value:"deadline",label:"Prazo",icon:te,color:"red"}];return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:k?"Editar Evento":"Novo Evento"}),e.jsx("button",{onClick:o,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(ee,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:R,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Tipo de Evento"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:q.map(a=>{const d=a.icon,b=t.type===a.value;return e.jsxs("button",{type:"button",onClick:()=>c({...t,type:a.value}),className:`p-4 rounded-lg border-2 transition-all ${b?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:[e.jsx(d,{className:`w-6 h-6 mx-auto mb-2 ${b?"text-blue-600":"text-slate-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:a.label})]},a.value)})})]}),t.type==="activity"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Vincular Atividade"}),e.jsxs("select",{value:t.activity_id||"",onChange:a=>{const d=a.target.value||null,b=j.find(v=>v.id===d);c({...t,activity_id:d,title:b?b.title:t.title})},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Nenhuma atividade vinculada"}),j.map(a=>e.jsxs("option",{value:a.id,children:[a.title," (",a.type,")"]},a.id))]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Vincule uma atividade existente a este evento de agenda"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"TÃ­tulo *"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>c({...t,title:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Aula de MatemÃ¡tica",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:t.description,onChange:a=>c({...t,description:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Detalhes do evento..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Data *"}),e.jsx("input",{type:"date",value:t.start_date,onChange:a=>c({...t,start_date:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"InÃ­cio *"}),e.jsx("input",{type:"time",value:t.start_time,onChange:a=>c({...t,start_time:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Fim *"}),e.jsx("input",{type:"time",value:t.end_time,onChange:a=>c({...t,end_time:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]})]}),t.type==="meeting"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Convidar"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>c({...t,invite_type:"all",selected_classes:[],selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="all"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸ“¢ Todos"}),e.jsx("button",{type:"button",onClick:()=>c({...t,invite_type:"classes",selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="classes"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸŽ“ Por Turma"}),e.jsx("button",{type:"button",onClick:()=>c({...t,invite_type:"individuals"}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="individuals"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸ‘¤ Individual"})]})]}),(t.type==="event"||t.type==="activity"||t.type==="meeting"&&(t.invite_type==="classes"||t.invite_type==="individuals"))&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Turmas ",t.invite_type==="individuals"&&"(selecione para filtrar alunos)"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:D.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhuma turma encontrada"}):D.map(a=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_classes.includes(a.id),onChange:d=>{const b=d.target.checked?[...t.selected_classes,a.id]:t.selected_classes.filter(v=>v!==a.id);c({...t,selected_classes:b})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:a.name})]},a.id))})]}),t.type==="meeting"&&t.invite_type==="individuals"&&t.selected_classes.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Selecionar Alunos (",t.selected_students.length," selecionados)"]}),E?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(V,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-slate-500",children:"Carregando alunos..."})]}):e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:f.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhum aluno encontrado nas turmas selecionadas"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-slate-900 pb-2 border-b border-slate-200 dark:border-slate-700",children:e.jsx("button",{type:"button",onClick:()=>{const a=f.every(d=>t.selected_students.includes(d.id));c({...t,selected_students:a?[]:f.map(d=>d.id)})},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:f.every(a=>t.selected_students.includes(a.id))?"Desmarcar todos":"Selecionar todos"})}),f.map(a=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_students.includes(a.id),onChange:d=>{const b=d.target.checked?[...t.selected_students,a.id]:t.selected_students.filter(v=>v!==a.id);c({...t,selected_students:b})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[a.avatar?e.jsx("img",{src:a.avatar,alt:a.name,className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs",children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:a.name}),e.jsx("p",{className:"text-xs text-slate-500",children:a.email})]})]})]},a.id))]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Modalidade"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"online",checked:t.modality==="online",onChange:a=>c({...t,modality:a.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Online"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"presential",checked:t.modality==="presential",onChange:a=>c({...t,modality:a.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Presencial"})]})]})]}),t.modality==="online"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Link da ReuniÃ£o *"}),e.jsx("input",{type:"url",value:t.meeting_link,onChange:a=>c({...t,meeting_link:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"https://meet.google.com/...",required:!0})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Local"}),e.jsx("textarea",{value:t.location,onChange:a=>c({...t,location:a.target.value}),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Sala 203, Bloco B"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(C,{type:"button",variant:"outline",onClick:o,disabled:x,className:"flex-1",children:"Cancelar"}),e.jsx(C,{type:"submit",disabled:x,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:x?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:"sm",className:"mr-2"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),k?"Salvar AlteraÃ§Ãµes":"Criar Evento"]})})]})]})]})}):null},fe=({filters:r,setFilters:o,teacherId:p})=>{const[y,g]=l.useState([]);l.useEffect(()=>{n()},[p]);const n=async()=>{try{const{data:i}=await A.from("classes").select("id, name").eq("created_by",p).eq("is_active",!0).order("name");g(i||[])}catch(i){M.error("Erro ao carregar turmas:",i)}},x=[{value:"class",label:"Aulas",color:"blue"},{value:"exam",label:"Provas",color:"red"},{value:"meeting",label:"ReuniÃµes",color:"purple"},{value:"personal",label:"Pessoal",color:"gray"}],S=i=>{const j=r.types.includes(i)?r.types.filter(_=>_!==i):[...r.types,i];o({...r,types:j})},D=i=>{const j=r.classes.includes(i)?r.classes.filter(_=>_!==i):[...r.classes,i];o({...r,classes:j})},F=()=>{o({types:[],classes:[],modality:"all"})},f=r.types.length>0||r.classes.length>0||r.modality!=="all";return e.jsxs(I,{className:"p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Filtros"]}),f&&e.jsx(C,{variant:"ghost",size:"sm",onClick:F,children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Tipo de Evento"}),e.jsx("div",{className:"space-y-2",children:x.map(i=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.types.includes(i.value),onChange:()=>S(i.value),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:i.label})]},i.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Turmas"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:y.map(i=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.classes.includes(i.id),onChange:()=>D(i.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:i.name})]},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Modalidade"}),e.jsxs("select",{value:r.modality,onChange:i=>o({...r,modality:i.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 text-sm",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"presential",children:"Presencial"})]})]})]})},ae=le.memo(({day:r,dayEvents:o,isCurrentDay:p,isSameMonthDay:y,onClick:g,onEventClick:n})=>e.jsxs(X.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},onClick:g,className:`
        min-h-[120px] p-3 border rounded-xl cursor-pointer transition-all hover:shadow-lg group relative
        ${p?"border-2 border-blue-600 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 shadow-md":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}
        ${!y&&"opacity-40"}
        hover:bg-gradient-to-br hover:from-slate-50 hover:to-blue-50 dark:hover:from-slate-800 dark:hover:to-blue-950/30
      `,children:[e.jsxs("div",{className:`
        text-sm font-bold mb-2 flex items-center justify-between
        ${p?"text-blue-600":"text-slate-900 dark:text-white"}
      `,children:[e.jsx("span",{children:m(r,"d")}),o.length>0&&e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-600 text-white text-xs flex items-center justify-center",children:o.length})]}),e.jsxs("div",{className:"space-y-1.5",children:[o.slice(0,2).map(x=>e.jsx("div",{onClick:S=>{S.stopPropagation(),n(x)},className:`
              text-xs px-2 py-1.5 rounded-lg truncate font-medium shadow-sm transition-all
              ${x.type==="event"&&"bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 dark:from-blue-900 dark:to-blue-800 dark:text-blue-200 hover:shadow-md"}
              ${x.type==="activity"&&"bg-gradient-to-r from-orange-100 to-orange-200 text-orange-800 dark:from-orange-900 dark:to-orange-800 dark:text-orange-200 hover:shadow-md"}
              ${x.type==="meeting"&&"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 dark:from-purple-900 dark:to-purple-800 dark:text-purple-200 hover:shadow-md"}
              ${x.type==="deadline"&&"bg-gradient-to-r from-red-100 to-red-200 text-red-800 dark:from-red-900 dark:to-red-800 dark:text-red-200 hover:shadow-md"}
              hover:scale-105
            `,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:m(new Date(x.start_time),"HH:mm")}),e.jsx("span",{className:"truncate",children:x.title})]})},x.id)),o.length>2&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 px-2 py-1 bg-blue-50 dark:bg-blue-950/30 rounded-lg font-medium",children:["+",o.length-2," evento",o.length-2>1?"s":""]})]})]}));ae.displayName="CalendarDay";const ot=()=>{const{user:r}=se(),[o,p]=l.useState(new Date),[y,g]=l.useState([]),[n,x]=l.useState([]),[S,D]=l.useState(!0),[F,f]=l.useState(!1),[i,j]=l.useState(!1),[_,E]=l.useState(null),[$,k]=l.useState(null),[t,c]=l.useState([]),[P,T]=l.useState(!1),[N,R]=l.useState({types:[],classes:[],modality:"all"}),q=l.useCallback(async()=>{try{D(!0);const s=W(o),u=Y(o),w=L.generateKey("calendar",r.id,m(o,"yyyy-MM")),U=await L.cacheQuery(w,async()=>{const{data:G,error:J}=await A.from("calendar_events").select(`
              *,
              class:classes(id, name)
            `).eq("created_by",r.id).gte("start_time",s.toISOString()).lte("start_time",u.toISOString()).order("start_time");if(J)throw J;return G||[]},300);g(U)}catch(s){M.error("Erro ao carregar eventos:",s),z({title:"Erro ao carregar eventos",description:"NÃ£o foi possÃ­vel carregar seus eventos.",variant:"destructive"})}finally{D(!1)}},[o,r?.id]),a=l.useCallback(()=>{let s=[...y];N.types.length>0&&(s=s.filter(u=>N.types.includes(u.type))),N.classes.length>0&&(s=s.filter(u=>u.class_id&&N.classes.includes(u.class_id))),N.modality!=="all"&&(s=s.filter(u=>u.modality===N.modality)),x(s)},[y,N]);l.useEffect(()=>{r?.id&&q()},[r?.id,q]),l.useEffect(()=>{a()},[a]);const d=l.useCallback(()=>{p(s=>xe(s)),T(!1)},[]),b=l.useCallback(()=>{p(s=>me(s,1)),T(!1)},[]),v=l.useCallback(()=>{p(new Date),T(!1)},[]),h=s=>{k(s);const u=Q(s);c(u),T(!0)},O=s=>{E(s),j(!0)},Q=s=>n.filter(u=>{const w=new Date(u.start_time);return m(w,"yyyy-MM-dd")===m(s,"yyyy-MM-dd")}),B=l.useMemo(()=>{const s=W(o),u=Y(o);return be({start:s,end:u})},[o]),H=l.useMemo(()=>["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"],[]);return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(V,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Minha Agenda"}),e.jsx("p",{className:"text-cyan-100",children:"Gerencie aulas, reuniÃµes e eventos"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{onClick:v,variant:"outline",className:"bg-white/10 hover:bg-white/20 border-white/20 text-white",children:"Hoje"}),e.jsxs(C,{onClick:()=>{k(new Date),f(!0)},className:"bg-white text-blue-600 hover:bg-white/90",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Novo Evento"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:P?"lg:col-span-8 transition-all duration-300":"lg:col-span-9 transition-all duration-300",children:e.jsxs(I,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(C,{variant:"ghost",size:"sm",onClick:d,children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white capitalize",children:m(o,"MMMM yyyy",{locale:K})}),e.jsx(C,{variant:"ghost",size:"sm",onClick:b,children:e.jsx(he,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[H.map(s=>e.jsx("div",{className:"text-center text-sm font-semibold text-slate-600 dark:text-slate-400 py-2",children:s},s)),e.jsx(ge,{children:B.map((s,u)=>{const w=Q(s),U=ve(s),G=ue(s,o);return e.jsx(ae,{day:s,dayEvents:w,isCurrentDay:U,isSameMonthDay:G,onClick:()=>h(s),onEventClick:O},`${m(s,"yyyy-MM-dd")}-${u}`)})})]})]})}),!P&&e.jsx("div",{className:"lg:col-span-3 space-y-4",children:e.jsx(fe,{filters:N,setFilters:R,teacherId:r?.id})}),P&&$&&e.jsx("div",{className:"lg:col-span-4",children:e.jsxs(I,{className:"p-6 bg-white dark:bg-slate-900 border-2 border-blue-200 dark:border-blue-800 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:m($,"d 'de' MMMM",{locale:K})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:m($,"EEEE",{locale:K})})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>T(!1),className:"text-slate-500 hover:text-slate-700",children:"âœ•"})]}),e.jsxs(C,{onClick:()=>f(!0),className:"w-full mb-4 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white shadow-lg",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Novo Evento"]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-24rem)] overflow-y-auto",children:t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 mx-auto text-slate-300 dark:text-slate-700 mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nenhum evento neste dia"}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:'Clique em "Novo Evento" para adicionar'})]}):t.map(s=>e.jsx(X.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onClick:()=>O(s),className:`
                        p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md group
                        ${s.type==="event"?"border-blue-300 bg-blue-50 dark:bg-blue-950/30":""}
                        ${s.type==="activity"?"border-orange-300 bg-orange-50 dark:bg-orange-950/30":""}
                        ${s.type==="meeting"?"border-purple-300 bg-purple-50 dark:bg-purple-950/30":""}
                        ${s.type==="deadline"?"border-red-300 bg-red-50 dark:bg-red-950/30":""}
                      `,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:`
                              text-xs font-semibold px-2 py-1 rounded-full
                              ${s.type==="event"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":""}
                              ${s.type==="activity"?"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300":""}
                              ${s.type==="meeting"?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":""}
                              ${s.type==="deadline"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":""}
                            `,children:s.type==="event"?"ðŸ“š Aula":s.type==="activity"?"ðŸ“ Atividade":s.type==="meeting"?"ðŸ‘¥ ReuniÃ£o":"ðŸ“… Prazo"})}),e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white mb-1 group-hover:text-blue-600",children:s.title}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:[m(new Date(s.start_time),"HH:mm")," - ",m(new Date(s.end_time),"HH:mm")]}),s.class?.name&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸŽ“ ",s.class.name]}),s.location&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸ“ ",s.location]})]})})},s.id))})]})})]}),F&&e.jsx(ye,{isOpen:F,onClose:()=>{f(!1),k(null),E(null)},onSuccess:()=>{q(),E(null)},selectedDate:$,teacherId:r?.id,editEvent:_}),i&&_&&e.jsx(de,{isOpen:i,onClose:()=>{j(!1),E(null)},event:_,onEdit:s=>{j(!1),E(s),f(!0)},onDelete:q})]})};export{ot as default};
