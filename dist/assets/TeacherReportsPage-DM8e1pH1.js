import{c as te,r as o,d as ue,f as vt,s as E,j as s,a as ft,l as V}from"./main-BXI8jImK.js";import{C as q}from"./card-Dts-jKab.js";import{B as S,m as gt}from"./button-DhJSXayK.js";import{B as Me}from"./SidebarPremium-CqhK_O_u.js";import{L as ie}from"./label-DZTyMoK9.js";import{T as bt,a as xt,b as $e,c as Fe}from"./tabs-Cc_Y9tQd.js";import{S as ne,a as oe,b as le,c as ce,d as F}from"./select-BYpegp6M.js";import{D as yt}from"./DashboardHeader-BC80IxDW.js";import"./input-YtE9-IyT.js";import"./dropdown-menu-7nHS86TP.js";import{u as tt}from"./use-toast-B4cJHS9G.js";import{D as jt}from"./download-COsSi_Yf.js";import{S as wt}from"./share-2-Cuo1eKc9.js";import{X as at}from"./x-DhRNfShw.js";import{a as rt,S as Pt,u as me,s as Nt,i as je,b as At,c as Et,d as St,e as Ot,f as kt,g as Se,h as Ct,j as Be,k as Rt,l as O,p as re,m as _t,n as Dt,o as H,q as Tt,r as Lt,t as st,v as It,w as Mt,x as W,y as $t,z as Ft,A as Bt,B as Gt,C as it,D as qt,E as zt,F as Kt,G as Vt,H as Wt,I as Ut,J as nt,K as Ht,L as Oe,M as ot,R as Jt,N as Zt,O as Xt,P as lt,Q as Yt,T as Q,U as Qt,V as ea,W as ta,X as aa,Y as Ge,Z as de,_ as we,$ as ra,a0 as sa,a1 as ia,a2 as na,a3 as oa,a4 as la,a5 as ae,a6 as qe,a7 as ca,a8 as da,a9 as ua,aa as ma,ab as pa,ac as ha,ad as va,ae as fa,af as ga,ag as be,ah as xe,ai as ze,aj as Ke,ak as Ve}from"./CartesianChart-CT_d4aWO.js";import{S as ba,C as ke,u as xa,a as ya,b as ja,c as wa,B as Pa,d as Na}from"./BarChart-BxSKjVb3.js";import{L as Aa,a as Ea}from"./LineChart-BmFjTQSi.js";import{S as Sa}from"./settings-Dn83Owos.js";import{P as ye}from"./plus-CjBUib9U.js";import{F as Oa}from"./funnel-rLvg5Q-7.js";import{U as ka}from"./user-XMBxPeUS.js";import{U as Ca}from"./users-1MVt23UL.js";import{C as Ra}from"./clipboard-list-DArUsZqA.js";import{F as Pe}from"./file-text-B1_cTV9D.js";import{S as _a}from"./star-qgVESZf4.js";import{E as Da}from"./eye-CtZjPFNS.js";import"./bell-De3gaLfU.js";import"./book-open-BMCImb8A.js";import"./trending-up-C_AGH9Be.js";import"./graduation-cap-BVXXkz0b.js";import"./index-Cyt6Mlq7.js";import"./chart-column-D6pi1FRc.js";import"./index-laUz9pSU.js";import"./index-D63a-v4Z.js";import"./Combination-7NRWB7dp.js";import"./index-PCXR_M5s.js";import"./index-DWCzEl6o.js";import"./chevron-down-vfmnlur0.js";import"./check-P2w7Pyl_.js";import"./chevron-up-3f7I9tWa.js";import"./chevron-right-DFiBXpQq.js";import"./index-Bl3P6sXQ.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],La=te("chart-no-axes-column-increasing",Ta);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Ma=te("file-image",Ia);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],Fa=te("file-spreadsheet",$a);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],Ga=te("git-compare",Ba);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],We=te("history",qa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],Ka=te("printer",za);function Ne(){return Ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Ne.apply(null,arguments)}function Ue(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),a.push.apply(a,r)}return a}function Va(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?Ue(Object(a),!0).forEach(function(r){Ce(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ue(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function Ce(e,t,a){return(t=Wa(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Wa(e){var t=Ua(e,"string");return typeof t=="symbol"?t:t+""}function Ua(e,t){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var r=a.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var L=32;class Re extends o.PureComponent{renderIcon(t,a){var{inactiveColor:r}=this.props,i=L/2,n=L/6,c=L/3,l=t.inactive?r:t.color,m=a??t.type;if(m==="none")return null;if(m==="plainline")return o.createElement("line",{strokeWidth:4,fill:"none",stroke:l,strokeDasharray:t.payload.strokeDasharray,x1:0,y1:i,x2:L,y2:i,className:"recharts-legend-icon"});if(m==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:l,d:"M0,".concat(i,"h").concat(c,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(2*c,",").concat(i,`
            H`).concat(L,"M").concat(2*c,",").concat(i,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(c,",").concat(i),className:"recharts-legend-icon"});if(m==="rect")return o.createElement("path",{stroke:"none",fill:l,d:"M0,".concat(L/8,"h").concat(L,"v").concat(L*3/4,"h").concat(-L,"z"),className:"recharts-legend-icon"});if(o.isValidElement(t.legendIcon)){var v=Va({},t);return delete v.legendIcon,o.cloneElement(t.legendIcon,v)}return o.createElement(ba,{fill:l,cx:i,cy:i,size:L,sizeType:"diameter",type:m})}renderItems(){var{payload:t,iconSize:a,layout:r,formatter:i,inactiveColor:n,iconType:c}=this.props,l={x:0,y:0,width:L,height:L},m={display:r==="horizontal"?"inline-block":"block",marginRight:10},v={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((d,f)=>{var p=d.formatter||i,h=ue({"recharts-legend-item":!0,["legend-item-".concat(f)]:!0,inactive:d.inactive});if(d.type==="none")return null;var g=d.inactive?n:d.color,b=p?p(d.value,d,f):d.value;return o.createElement("li",Ne({className:h,style:m,key:"legend-item-".concat(f)},rt(this.props,d,f)),o.createElement(Pt,{width:a,height:a,viewBox:l,style:v,"aria-label":"".concat(b," legend icon")},this.renderIcon(d,c)),o.createElement("span",{className:"recharts-legend-item-text",style:{color:g}},b))})}render(){var{payload:t,layout:a,align:r}=this.props;if(!t||!t.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?r:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}Ce(Re,"displayName","Legend");Ce(Re,"defaultProps",{align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"});function Ha(){return me(Nt)}var Ja=["contextPayload"];function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Ae.apply(null,arguments)}function He(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),a.push.apply(a,r)}return a}function ee(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?He(Object(a),!0).forEach(function(r){_e(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):He(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function _e(e,t,a){return(t=Za(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Za(e){var t=Xa(e,"string");return typeof t=="symbol"?t:t+""}function Xa(e,t){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var r=a.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ya(e,t){if(e==null)return{};var a,r,i=Qa(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Qa(e,t){if(e==null)return{};var a={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;a[r]=e[r]}return a}function er(e){return e.value}function tr(e){var{contextPayload:t}=e,a=Ya(e,Ja),r=Rt(t,e.payloadUniqBy,er),i=ee(ee({},a),{},{payload:r});return o.isValidElement(e.content)?o.cloneElement(e.content,i):typeof e.content=="function"?o.createElement(e.content,i):o.createElement(Re,i)}function ar(e,t,a,r,i,n){var{layout:c,align:l,verticalAlign:m}=t,v,d;return(!e||(e.left===void 0||e.left===null)&&(e.right===void 0||e.right===null))&&(l==="center"&&c==="vertical"?v={left:((r||0)-n.width)/2}:v=l==="right"?{right:a&&a.right||0}:{left:a&&a.left||0}),(!e||(e.top===void 0||e.top===null)&&(e.bottom===void 0||e.bottom===null))&&(m==="middle"?d={top:((i||0)-n.height)/2}:d=m==="bottom"?{bottom:a&&a.bottom||0}:{top:a&&a.top||0}),ee(ee({},v),d)}function rr(e){var t=Se();return o.useEffect(()=>{t(Ct(e))},[t,e]),null}function sr(e){var t=Se();return o.useEffect(()=>(t(Be(e)),()=>{t(Be({width:0,height:0}))}),[t,e]),null}function ir(e){var t=Ha(),a=At(),r=Et(),{width:i,height:n,wrapperStyle:c,portal:l}=e,[m,v]=St([t]),d=Ot(),f=kt();if(d==null||f==null)return null;var p=d-(r.left||0)-(r.right||0),h=Y.getWidthOrHeight(e.layout,n,i,p),g=l?c:ee(ee({position:"absolute",width:h?.width||i||"auto",height:h?.height||n||"auto"},ar(c,e,r,d,f,m)),c),b=l??a;if(b==null)return null;var k=o.createElement("div",{className:"recharts-legend-wrapper",style:g,ref:v},o.createElement(rr,{layout:e.layout,align:e.align,verticalAlign:e.verticalAlign,itemSorter:e.itemSorter}),o.createElement(sr,{width:m.width,height:m.height}),o.createElement(tr,Ae({},e,h,{margin:r,chartWidth:d,chartHeight:f,contextPayload:t})));return vt.createPortal(k,b)}class Y extends o.PureComponent{static getWidthOrHeight(t,a,r,i){return t==="vertical"&&je(a)?{height:a}:t==="horizontal"?{width:r||i}:null}render(){return o.createElement(ir,this.props)}}_e(Y,"displayName","Legend");_e(Y,"defaultProps",{align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"});var ct=e=>e.graphicalItems.polarItems,nr=O([re,_t],Dt),pe=O([ct,H,nr],Tt),or=O([pe],Lt),he=O([or,st],It),lr=O([he,H,pe],Mt);O([he,H,pe],(e,t,a)=>a.length>0?e.flatMap(r=>a.flatMap(i=>{var n,c=W(r,(n=t.dataKey)!==null&&n!==void 0?n:i.dataKey);return{value:c,errorDomain:[]}})).filter(Boolean):t?.dataKey!=null?e.map(r=>({value:W(r,t.dataKey),errorDomain:[]})):e.map(r=>({value:r,errorDomain:[]})));var Je=()=>{},cr=O([he,H,pe,$t,re],Ft),dr=O([H,Bt,Gt,Je,cr,Je,it,re],qt),dt=O([H,it,he,lr,zt,re,dr],Kt),ur=O([dt,H,Vt],Wt);O([H,dt,ur,re],Ut);function Ze(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),a.push.apply(a,r)}return a}function Xe(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?Ze(Object(a),!0).forEach(function(r){mr(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ze(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function mr(e,t,a){return(t=pr(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pr(e){var t=hr(e,"string");return typeof t=="symbol"?t:t+""}function hr(e,t){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var r=a.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var vr=(e,t)=>t,De=O([ct,vr],(e,t)=>e.filter(a=>a.type==="pie").find(a=>a.id===t)),fr=[],Te=(e,t,a)=>a?.length===0?fr:a,ut=O([st,De,Te],(e,t,a)=>{var{chartData:r}=e;if(t!=null){var i;if(t?.data!=null&&t.data.length>0?i=t.data:i=r,(!i||!i.length)&&a!=null&&(i=a.map(n=>Xe(Xe({},t.presentationProps),n.props))),i!=null)return i}}),gr=O([ut,De,Te],(e,t,a)=>{if(!(e==null||t==null))return e.map((r,i)=>{var n,c=W(r,t.nameKey,t.name),l;return a!=null&&(n=a[i])!==null&&n!==void 0&&(n=n.props)!==null&&n!==void 0&&n.fill?l=a[i].props.fill:typeof r=="object"&&r!=null&&"fill"in r?l=r.fill:l=t.fill,{value:nt(c,t.dataKey),color:l,payload:r,type:t.legendType}})}),br=O([ut,De,Te,Ht],(e,t,a,r)=>{if(!(t==null||e==null))return $r({offset:r,pieSettings:t,displayedData:e,cells:a})}),xr=["onMouseEnter","onClick","onMouseLeave"],yr=["id"],jr=["id"];function Le(e,t){if(e==null)return{};var a,r,i=wr(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function wr(e,t){if(e==null)return{};var a={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;a[r]=e[r]}return a}function Ye(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),a.push.apply(a,r)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?Ye(Object(a),!0).forEach(function(r){Pr(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ye(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function Pr(e,t,a){return(t=Nr(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Nr(e){var t=Ar(e,"string");return typeof t=="symbol"?t:t+""}function Ar(e,t){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var r=a.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},U.apply(null,arguments)}function Er(e){var t=o.useMemo(()=>lt(e.children,ke),[e.children]),a=me(r=>gr(r,e.id,t));return a==null?null:o.createElement(Yt,{legendPayload:a})}function Sr(e){var{dataKey:t,nameKey:a,sectors:r,stroke:i,strokeWidth:n,fill:c,name:l,hide:m,tooltipType:v}=e;return{dataDefinedOnItem:r.map(d=>d.tooltipPayload),positions:r.map(d=>d.tooltipPosition),settings:{stroke:i,strokeWidth:n,fill:c,dataKey:t,nameKey:a,name:nt(l,t),hide:m,type:v,color:c,unit:""}}}var Or=(e,t)=>e>t?"start":e<t?"end":"middle",kr=(e,t,a)=>typeof t=="function"?ae(t(e),a,a*.8):ae(t,a,a*.8),Cr=(e,t,a)=>{var{top:r,left:i,width:n,height:c}=t,l=la(n,c),m=i+ae(e.cx,n,n/2),v=r+ae(e.cy,c,c/2),d=ae(e.innerRadius,l,0),f=kr(a,e.outerRadius,l),p=e.maxRadius||Math.sqrt(n*n+c*c)/2;return{cx:m,cy:v,innerRadius:d,outerRadius:f,maxRadius:p}},Rr=(e,t)=>{var a=de(t-e),r=Math.min(Math.abs(t-e),360);return a*r};function _r(e){return e&&typeof e=="object"&&"className"in e&&typeof e.className=="string"?e.className:""}var Dr=(e,t)=>{if(o.isValidElement(e))return o.cloneElement(e,t);if(typeof e=="function")return e(t);var a=ue("recharts-pie-label-line",typeof e!="boolean"?e.className:"");return o.createElement(ca,U({},t,{type:"linear",className:a}))},Tr=(e,t,a)=>{if(o.isValidElement(e))return o.cloneElement(e,t);var r=a;if(typeof e=="function"&&(r=e(t),o.isValidElement(r)))return r;var i=ue("recharts-pie-label-text",_r(e));return o.createElement(da,U({},t,{alignmentBaseline:"middle",className:i}),r)};function Lr(e){var{sectors:t,props:a,showLabels:r}=e,{label:i,labelLine:n,dataKey:c}=a;if(!r||!i||!t)return null;var l=ot(a),m=qe(i),v=qe(n),d=typeof i=="object"&&"offsetRadius"in i&&typeof i.offsetRadius=="number"&&i.offsetRadius||20,f=t.map((p,h)=>{var g=(p.startAngle+p.endAngle)/2,b=we(p.cx,p.cy,p.outerRadius+d,g),k=y(y(y(y({},l),p),{},{stroke:"none"},m),{},{index:h,textAnchor:Or(b.x,p.cx)},b),M=y(y(y(y({},l),p),{},{fill:"none",stroke:p.fill},v),{},{index:h,points:[we(p.cx,p.cy,p.outerRadius,g),b],key:"line"});return o.createElement(Q,{key:"label-".concat(p.startAngle,"-").concat(p.endAngle,"-").concat(p.midAngle,"-").concat(h)},n&&Dr(n,M),Tr(i,k,W(p,c)))});return o.createElement(Q,{className:"recharts-pie-labels"},f)}function Ir(e){var{sectors:t,props:a,showLabels:r}=e,{label:i}=a;return typeof i=="object"&&i!=null&&"position"in i?o.createElement(oa,{label:i}):o.createElement(Lr,{sectors:t,props:a,showLabels:r})}function Mr(e){var{sectors:t,activeShape:a,inactiveShape:r,allOtherPieProps:i}=e,n=me(sa),{onMouseEnter:c,onClick:l,onMouseLeave:m}=i,v=Le(i,xr),d=xa(c,i.dataKey),f=ya(m),p=ja(l,i.dataKey);return t==null||t.length===0?null:o.createElement(o.Fragment,null,t.map((h,g)=>{if(h?.startAngle===0&&h?.endAngle===0&&t.length!==1)return null;var b=a&&String(g)===n,k=n?r:null,M=b?a:k,R=y(y({},h),{},{stroke:h.stroke,tabIndex:-1,[na]:g,[ia]:i.dataKey});return o.createElement(Q,U({key:"sector-".concat(h?.startAngle,"-").concat(h?.endAngle,"-").concat(h.midAngle,"-").concat(g),tabIndex:-1,className:"recharts-pie-sector"},rt(v,h,g),{onMouseEnter:d(h,g),onMouseLeave:f(h,g),onClick:p(h,g)}),o.createElement(wa,U({option:M,isActive:b,shapeType:"sector"},R)))}))}function $r(e){var t,{pieSettings:a,displayedData:r,cells:i,offset:n}=e,{cornerRadius:c,startAngle:l,endAngle:m,dataKey:v,nameKey:d,tooltipType:f}=a,p=Math.abs(a.minAngle),h=Rr(l,m),g=Math.abs(h),b=r.length<=1?0:(t=a.paddingAngle)!==null&&t!==void 0?t:0,k=r.filter(A=>W(A,v,0)!==0).length,M=(g>=360?k:k-1)*b,R=g-k*p-M,_=r.reduce((A,I)=>{var j=W(I,v,0);return A+(je(j)?j:0)},0),B;if(_>0){var T;B=r.map((A,I)=>{var j=W(A,v,0),$=W(A,d,I),z=Cr(a,n,A),K=(je(j)?j:0)/_,G,J=y(y({},A),i&&i[I]&&i[I].props);I?G=T.endAngle+de(h)*b*(j!==0?1:0):G=l;var X=G+de(h)*((j!==0?p:0)+K*R),Z=(G+X)/2,se=(z.innerRadius+z.outerRadius)/2,ve=[{name:$,value:j,payload:J,dataKey:v,type:f}],fe=we(z.cx,z.cy,se,Z);return T=y(y(y(y({},a.presentationProps),{},{percent:K,cornerRadius:c,name:$,tooltipPayload:ve,midAngle:Z,middleRadius:se,tooltipPosition:fe},J),z),{},{value:j,startAngle:G,endAngle:X,payload:J,paddingAngle:de(h)*b}),T})}return B}function Fr(e){var{showLabels:t,sectors:a,children:r}=e,i=o.useMemo(()=>!t||!a?[]:a.map(n=>({value:n.value,payload:n.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:n.cx,cy:n.cy,innerRadius:n.innerRadius,outerRadius:n.outerRadius,startAngle:n.startAngle,endAngle:n.endAngle,clockWise:!1},fill:n.fill})),[a,t]);return o.createElement(ra,{value:t?i:void 0},r)}function Br(e){var{props:t,previousSectorsRef:a}=e,{sectors:r,isAnimationActive:i,animationBegin:n,animationDuration:c,animationEasing:l,activeShape:m,inactiveShape:v,onAnimationStart:d,onAnimationEnd:f}=t,p=ea(t,"recharts-pie-"),h=a.current,[g,b]=o.useState(!1),k=o.useCallback(()=>{typeof f=="function"&&f(),b(!1)},[f]),M=o.useCallback(()=>{typeof d=="function"&&d(),b(!0)},[d]);return o.createElement(Fr,{showLabels:!g,sectors:r},o.createElement(ta,{animationId:p,begin:n,duration:c,isActive:i,easing:l,onAnimationStart:M,onAnimationEnd:k,key:p},R=>{var _=[],B=r&&r[0],T=B?.startAngle;return r?.forEach((A,I)=>{var j=h&&h[I],$=I>0?aa(A,"paddingAngle",0):0;if(j){var z=Ge(j.endAngle-j.startAngle,A.endAngle-A.startAngle,R),K=y(y({},A),{},{startAngle:T+$,endAngle:T+z+$});_.push(K),T=K.endAngle}else{var{endAngle:G,startAngle:J}=A,X=Ge(0,G-J,R),Z=y(y({},A),{},{startAngle:T+$,endAngle:T+X+$});_.push(Z),T=Z.endAngle}}),a.current=_,o.createElement(Q,null,o.createElement(Mr,{sectors:_,activeShape:m,inactiveShape:v,allOtherPieProps:t}))}),o.createElement(Ir,{showLabels:!g,sectors:r,props:t}),t.children)}var Gr={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!Xt.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff"};function qr(e){var{id:t}=e,a=Le(e,yr),{hide:r,className:i,rootTabIndex:n}=e,c=o.useMemo(()=>lt(e.children,ke),[e.children]),l=me(d=>br(d,t,c)),m=o.useRef(null),v=ue("recharts-pie",i);return r||l==null?(m.current=null,o.createElement(Q,{tabIndex:n,className:v})):o.createElement(o.Fragment,null,o.createElement(Qt,{fn:Sr,args:y(y({},e),{},{sectors:l})}),o.createElement(Q,{tabIndex:n,className:v},o.createElement(Br,{props:y(y({},a),{},{sectors:l}),previousSectorsRef:m})))}function mt(e){var t=Oe(e,Gr),{id:a}=t,r=Le(t,jr),i=ot(r);return o.createElement(Jt,{id:a,type:"pie"},n=>o.createElement(o.Fragment,null,o.createElement(Zt,{type:"pie",id:n,data:r.data,dataKey:r.dataKey,hide:r.hide,angleAxisId:0,radiusAxisId:0,name:r.name,nameKey:r.nameKey,tooltipType:r.tooltipType,legendType:r.legendType,fill:r.fill,cx:r.cx,cy:r.cy,startAngle:r.startAngle,endAngle:r.endAngle,paddingAngle:r.paddingAngle,minAngle:r.minAngle,innerRadius:r.innerRadius,outerRadius:r.outerRadius,cornerRadius:r.cornerRadius,presentationProps:i,maxRadius:t.maxRadius}),o.createElement(Er,U({},r,{id:n})),o.createElement(qr,U({},r,{id:n}))))}mt.displayName="Pie";function zr(e){var t=Se();return o.useEffect(()=>{t(ua(e))},[t,e]),null}var Kr=["layout"];function Ee(){return Ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Ee.apply(null,arguments)}function Vr(e,t){if(e==null)return{};var a,r,i=Wr(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Wr(e,t){if(e==null)return{};var a={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;a[r]=e[r]}return a}var Ur={top:5,right:5,bottom:5,left:5},Hr={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:Ur,reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1},Jr=o.forwardRef(function(t,a){var r,i=Oe(t.categoricalChartProps,Hr),{layout:n}=i,c=Vr(i,Kr),{chartName:l,defaultTooltipEventType:m,validateTooltipEventTypes:v,tooltipPayloadSearcher:d}=t,f={chartName:l,defaultTooltipEventType:m,validateTooltipEventTypes:v,tooltipPayloadSearcher:d,eventEmitter:void 0};return o.createElement(ma,{preloadedState:{options:f},reduxStoreName:(r=i.id)!==null&&r!==void 0?r:l},o.createElement(pa,{chartData:i.data}),o.createElement(ha,{layout:n,margin:i.margin}),o.createElement(va,{accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),o.createElement(zr,{cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius}),o.createElement(fa,Ee({},c,{ref:a})))}),Zr=["item"],Xr={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},Yr=o.forwardRef((e,t)=>{var a=Oe(e,Xr);return o.createElement(Jr,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:Zr,tooltipPayloadSearcher:ga,categoricalChartProps:a,ref:t})});class Qr{async generateStudentReport(t,a=30){const r=new Date;r.setDate(r.getDate()-a);const{data:i}=await E.from("profiles").select("full_name, email").eq("id",t).single(),{data:n}=await E.from("class_members").select("class:classes(id, name, subject)").eq("user_id",t).eq("role","student"),{data:c}=await E.from("submissions").select(`
        grade,
        submitted_at,
        activity:activities(title, max_score, type)
      `).eq("student_id",t).gte("submitted_at",r.toISOString()).not("grade","is",null),l=c?.map(p=>p.grade)||[],m=l.length>0?l.reduce((p,h)=>p+h,0)/l.length:0,v=l.length>0?Math.max(...l):0,d=l.length>0?Math.min(...l):0,f=c?.map(p=>({name:p.activity.title.substring(0,20),value:p.grade}))||[];return{title:`RelatÃ³rio de Desempenho - ${i?.full_name||"Aluno"}`,templateName:"Desempenho Individual (Aluno)",generatedAt:new Date().toISOString(),studentId:t,summary:{totalActivities:c?.length||0,avgGrade:m.toFixed(1),maxGrade:v.toFixed(1),minGrade:d.toFixed(1),totalClasses:n?.length||0},charts:[{title:"Notas por Atividade",type:"bar",data:f},{title:"EvoluÃ§Ã£o do Desempenho",type:"line",data:f}],tables:[{title:"Turmas Inscritas",headers:["Nome","MatÃ©ria"],rows:n?.map(p=>[p.class.name,p.class.subject||"-"])||[]}],details:`RelatÃ³rio gerado para o perÃ­odo de ${a} dias. Total de ${c?.length||0} atividades avaliadas.`}}async generateClassReport(t,a=30){const{data:r}=await E.from("classes").select("name, subject, created_by").eq("id",t).single(),{data:i}=await E.from("class_members").select("user_id, profiles:user_id(full_name)").eq("class_id",t).eq("role","student"),{data:n}=await E.from("activity_class_assignments").select("activity_id, activity:activities(id, title)").eq("class_id",t),c=n?.map(p=>p.activity_id)||[],{data:l}=await E.from("submissions").select("grade, student_id, activity_id").in("activity_id",c).not("grade","is",null),m=l?.map(p=>p.grade)||[],v=m.length>0?m.reduce((p,h)=>p+h,0)/m.length:0,d={"Excelente (90-100)":0,"Bom (70-89)":0,"Regular (50-69)":0,"Insuficiente (0-49)":0};m.forEach(p=>{p>=90?d["Excelente (90-100)"]++:p>=70?d["Bom (70-89)"]++:p>=50?d["Regular (50-69)"]++:d["Insuficiente (0-49)"]++});const f=Object.entries(d).map(([p,h])=>({name:p,value:h}));return{title:`RelatÃ³rio de Turma - ${r?.name||"Turma"}`,templateName:"RelatÃ³rio de Turma",generatedAt:new Date().toISOString(),classId:t,summary:{totalStudents:i?.length||0,totalActivities:n?.length||0,avgGrade:v.toFixed(1),submissionsCount:l?.length||0},charts:[{title:"DistribuiÃ§Ã£o de Notas",type:"pie",data:f}],tables:[{title:"Lista de Alunos",headers:["Nome","SubmissÃµes"],rows:i?.map(p=>{const h=l?.filter(g=>g.student_id===p.user_id).length||0;return[p.profiles.full_name,h]})||[]}],details:`Turma: ${r?.name}
MatÃ©ria: ${r?.subject||"NÃ£o especificada"}
PerÃ­odo: Ãºltimos ${a} dias`}}async generateComparativeReport(t){const{data:a}=await E.from("classes").select("id, name, subject").eq("created_by",t).eq("is_active",!0);a?.map(i=>i.id);const r=await Promise.all(a?.map(async i=>{const{data:n}=await E.from("activity_class_assignments").select("activity_id").eq("class_id",i.id),c=n?.map(d=>d.activity_id)||[],{data:l}=await E.from("submissions").select("grade").in("activity_id",c).not("grade","is",null),m=l?.map(d=>d.grade)||[],v=m.length>0?m.reduce((d,f)=>d+f,0)/m.length:0;return{name:i.name,value:v}})||[]);return{title:"RelatÃ³rio Comparativo de Turmas",templateName:"Comparativo de Desempenho",generatedAt:new Date().toISOString(),teacherId:t,summary:{totalClasses:a?.length||0,avgGrade:(r.reduce((i,n)=>i+n.value,0)/(r.length||1)).toFixed(1)},charts:[{title:"MÃ©dia por Turma",type:"bar",data:r}],tables:[{title:"Detalhamento por Turma",headers:["Turma","MatÃ©ria","MÃ©dia"],rows:a?.map((i,n)=>[i.name,i.subject||"-",r[n]?.value.toFixed(1)||"0"])||[]}]}}async generateTeacherReport(t){const{data:a}=await E.from("classes").select("id").eq("created_by",t).eq("is_active",!0),{count:r}=await E.from("class_members").select("id",{count:"exact",head:!0}).in("class_id",a?.map(m=>m.id)||[]).eq("role","student"),{data:i}=await E.from("activities").select("id").eq("created_by",t),{data:n}=await E.from("submissions").select("grade").in("activity_id",i?.map(m=>m.id)||[]).not("grade","is",null),c=n?.map(m=>m.grade)||[],l=c.length>0?c.reduce((m,v)=>m+v,0)/c.length:0;return{title:"RelatÃ³rio de Desempenho do Professor",templateName:"Desempenho (Professor)",generatedAt:new Date().toISOString(),teacherId:t,summary:{totalClasses:a?.length||0,totalStudents:r||0,totalActivities:i?.length||0,avgGrade:l.toFixed(1)},details:"RelatÃ³rio consolidado de todas as turmas e atividades criadas."}}async generateReport(t,a,r={}){switch(t){case"individual-student":return await this.generateStudentReport(a,r.period);case"class-report":return await this.generateClassReport(a,r.period);case"comparative":return await this.generateComparativeReport(a);case"teacher-performance":return await this.generateTeacherReport(a);case"activity-report":return{title:"RelatÃ³rio de Atividade",templateName:"RelatÃ³rio de Atividade",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};case"bulletin":return{title:"Boletim Geral",templateName:"Boletim Geral",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};default:throw new Error("Template de relatÃ³rio nÃ£o encontrado")}}}const es=new Qr,Qe=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],ts=({report:e,onClose:t})=>{const{toast:a}=tt();if(!e)return null;const r=(i,n)=>{const c=(l,m=16)=>l?.length>m?l.slice(0,m)+"â€¦":l;switch(i){case"bar":return s.jsx(be,{width:"100%",height:300,children:s.jsxs(Pa,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(ze,{strokeDasharray:"3 3"}),s.jsx(Ke,{dataKey:"name",tickFormatter:l=>c(l),interval:"preserveEnd"}),s.jsx(Ve,{}),s.jsx(xe,{}),s.jsx(Y,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Na,{dataKey:"value",fill:"#3B82F6"})]})});case"line":return s.jsx(be,{width:"100%",height:300,children:s.jsxs(Aa,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(ze,{strokeDasharray:"3 3"}),s.jsx(Ke,{dataKey:"name",tickFormatter:l=>c(l),interval:"preserveEnd"}),s.jsx(Ve,{}),s.jsx(xe,{}),s.jsx(Y,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Ea,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2})]})});case"pie":return s.jsx(be,{width:"100%",height:300,children:s.jsxs(Yr,{children:[s.jsx(mt,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:l=>`${c(l.name)}: ${l.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((l,m)=>s.jsx(ke,{fill:Qe[m%Qe.length]},`cell-${m}`))}),s.jsx(xe,{}),s.jsx(Y,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}})]})});default:return null}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 overflow-auto",children:s.jsxs(q,{className:"w-full max-w-6xl max-h-[90vh] overflow-auto bg-white dark:bg-slate-900",children:[s.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between z-10",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:e.title||e.templateName}),s.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Gerado em ",new Date(e.generatedAt).toLocaleString("pt-BR")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(S,{variant:"outline",size:"sm",onClick:()=>{try{if(e.tables&&e.tables.length>0){const m=e.tables[0],d=[(m.headers||[]).join(",")];(m.rows||[]).forEach(k=>{const M=k.map(R=>{const _=typeof R=="object"?JSON.stringify(R):String(R??"");return/[",\n]/.test(_)?'"'+_.replace(/"/g,'""')+'"':_}).join(",");d.push(M)});const f=d.join(`
`),p=new Blob([f],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(p),g=document.createElement("a"),b=(e.title||e.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");g.href=h,g.download=`${b}-${Date.now()}.csv`,document.body.appendChild(g),g.click(),g.remove(),URL.revokeObjectURL(h),a({title:"Exportado (CSV)",description:"Arquivo CSV baixado com sucesso."});return}const i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),c=document.createElement("a"),l=(e.title||e.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");c.href=n,c.download=`${l}-${Date.now()}.json`,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(n),a({title:"Exportado (JSON)",description:"Arquivo JSON baixado com sucesso."})}catch{a({variant:"destructive",title:"Falha na exportaÃ§Ã£o",description:"Tente novamente."})}},children:[s.jsx(jt,{className:"w-4 h-4 mr-2"}),"Exportar"]}),s.jsxs(S,{variant:"outline",size:"sm",onClick:()=>{try{window.print()}catch{a({variant:"destructive",title:"Falha ao imprimir",description:"Tente novamente."})}},children:[s.jsx(Ka,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),s.jsxs(S,{variant:"outline",size:"sm",onClick:async()=>{try{const i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),c=e.title||e.templateName||"RelatÃ³rio";navigator.share?await navigator.share({title:c,text:c,url:n}):(await navigator.clipboard.writeText(n),a({title:"Link copiado",description:"Link do relatÃ³rio copiado para a Ã¡rea de transferÃªncia."}))}catch{a({variant:"destructive",title:"Falha ao compartilhar",description:"Tente novamente."})}},children:[s.jsx(wt,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),s.jsx(S,{variant:"ghost",size:"sm",onClick:t,children:s.jsx(at,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[e.summary&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(e.summary).map(([i,n])=>s.jsxs(q,{className:"p-4",children:[s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:i.replace(/([A-Z])/g," $1").trim()}),s.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white mt-1",children:typeof n=="number"?n.toFixed(1):n})]},i))}),e.charts&&e.charts.map((i,n)=>s.jsxs(q,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),r(i.type,i.data)]},n)),e.tables&&e.tables.map((i,n)=>s.jsxs(q,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:i.headers.map((c,l)=>s.jsx("th",{className:"text-left p-2 font-semibold",children:c},l))})}),s.jsx("tbody",{children:i.rows.map((c,l)=>s.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:c.map((m,v)=>s.jsx("td",{className:"p-2",children:m},v))},l))})]})})]},n)),e.details&&s.jsxs(q,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detalhes"}),s.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.details})]})]})]})})},et=[{id:"individual-student",name:"RelatÃ³rio Individual de Aluno",description:"RelatÃ³rio completo de um aluno especÃ­fico",icon:ka,color:"from-blue-500 to-cyan-500",includes:["Dados pessoais","HistÃ³rico de notas","FrequÃªncia","Feedbacks recebidos","GrÃ¡ficos de evoluÃ§Ã£o","AnÃ¡lise de desempenho"],usage:"ReuniÃ£o com pais, coordenaÃ§Ã£o",popular:!0},{id:"class-report",name:"RelatÃ³rio de Turma",description:"AnÃ¡lise completa de uma turma",icon:Ca,color:"from-purple-500 to-pink-500",includes:["EstatÃ­sticas gerais","DistribuiÃ§Ã£o de notas","Taxa de aprovaÃ§Ã£o/reprovaÃ§Ã£o","MÃ©dia da turma","Alunos em destaque","Ãreas de atenÃ§Ã£o"],usage:"Fechamento de semestre, relatÃ³rios institucionais",popular:!0},{id:"comparative",name:"RelatÃ³rio Comparativo",description:"ComparaÃ§Ã£o entre mÃºltiplas turmas",icon:Ga,color:"from-orange-500 to-red-500",includes:["Tabela comparativa","GrÃ¡ficos lado a lado","AnÃ¡lise de diferenÃ§as","Melhores prÃ¡ticas identificadas"],usage:"AnÃ¡lise pedagÃ³gica, ajustes metodolÃ³gicos"},{id:"activity-report",name:"RelatÃ³rio de Atividade",description:"AnÃ¡lise de uma atividade especÃ­fica",icon:Ra,color:"from-green-500 to-teal-500",includes:["EstatÃ­sticas de submissÃ£o","DistribuiÃ§Ã£o de notas","QuestÃµes mais erradas","Tempo mÃ©dio de resoluÃ§Ã£o","Lista de notas por aluno"],usage:"ValidaÃ§Ã£o de atividade, ajustes"},{id:"bulletin",name:"Boletim (PerÃ­odo)",description:"Boletim formal por perÃ­odo",icon:Pe,color:"from-indigo-500 to-purple-500",includes:["Notas por disciplina","MÃ©dias parciais e finais","FrequÃªncia","ObservaÃ§Ãµes do professor","Assinatura"],usage:"Entrega oficial para instituiÃ§Ã£o/pais",popular:!0},{id:"teacher-performance",name:"RelatÃ³rio de Desempenho (Professor)",description:"Auto-avaliaÃ§Ã£o do professor",icon:La,color:"from-yellow-500 to-orange-500",includes:["Atividades postadas","CorreÃ§Ãµes realizadas","Tempo mÃ©dio de feedback","SatisfaÃ§Ã£o dos alunos","EvoluÃ§Ã£o das turmas"],usage:"AvaliaÃ§Ã£o institucional, portfÃ³lio"}],Ks=()=>{const{user:e}=ft(),{toast:t}=tt(),[a,r]=o.useState(!1),[i,n]=o.useState("templates"),[c,l]=o.useState([]),[m,v]=o.useState(!1),[d,f]=o.useState(null),[p,h]=o.useState(null),[g,b]=o.useState(null),[k,M]=o.useState(null),[R,_]=o.useState("30"),[B,T]=o.useState([]),[A,I]=o.useState([]),[j,$]=o.useState(""),[z,K]=o.useState(!1);o.useEffect(()=>{G(),J()},[e]);const G=async()=>{l([])},J=async()=>{if(e)try{K(!0);const{data:u,error:x}=await E.from("classes").select("id, name, subject").eq("created_by",e.id).eq("is_active",!0).order("name",{ascending:!0});if(x)throw x;I(u||[]);const{data:C,error:D}=await E.from("class_members").select(`
          user_id,
          profile:profiles!class_members_user_id_fkey(id, full_name, email),
          class:classes!class_members_class_id_fkey(id, name)
        `).in("class_id",u?.map(w=>w.id)||[]).eq("role","student");if(D)throw D;const N=[],P=new Set;C?.forEach(w=>{w.profile&&!P.has(w.profile.id)&&(P.add(w.profile.id),N.push({id:w.profile.id,name:w.profile.full_name,email:w.profile.email,className:w.class?.name}))}),T(N)}catch(u){V.error("Erro ao carregar dados:",u),t({title:"Erro ao carregar dados",description:u.message,variant:"destructive"})}finally{K(!1)}},X=async u=>{if(!j){t({title:"Selecione o escopo do relatÃ³rio",description:"Escolha se deseja gerar para um aluno, turma ou todos os alunos.",variant:"destructive"});return}if(j==="student"&&!p){t({title:"Selecione um aluno",description:"Escolha qual aluno vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}if(j==="class"&&!g){t({title:"Selecione uma turma",description:"Escolha qual turma vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}v(!0),f(null);try{let x=e?.id;const C=et.find(N=>N.id===u);if(t({title:`ðŸ“Š Gerando ${C?.name||"RelatÃ³rio"}`,description:"Processando dados... Aguarde."}),u==="class-report")if(g)x=g;else{const{data:N}=await E.from("classes").select("id, is_active").eq("created_by",e.id).eq("is_active",!0).order("name",{ascending:!0});if(!N||N.length===0)throw new Error("Nenhuma turma ativa encontrada para gerar o relatÃ³rio.");x=N[0].id}const D=await es.generateReport(u,x,{period:parseInt(R),includeArchived:!1});f(D),t({title:"âœ… RelatÃ³rio Gerado",description:`${D.templateName} gerado com sucesso!`}),l(N=>[{id:Date.now(),templateId:u,generatedAt:new Date().toISOString(),cached:!1},...N.slice(0,9)])}catch(x){V.error("Erro ao gerar relatÃ³rio:",x),t({title:"Erro",description:x.message||"NÃ£o foi possÃ­vel gerar o relatÃ³rio",variant:"destructive"})}finally{v(!1)}},Z=()=>{n("history")},se=()=>{t({title:"Em desenvolvimento",description:"Gerenciamento de templates serÃ¡ implementado em breve"})},ve=u=>{if(!u)return null;if(Array.isArray(u))return u;if(Array.isArray(u?.rows))return u.rows;if(Array.isArray(u?.data))return u.data;if(Array.isArray(u?.items))return u.items;const x=Object.values(u).find(C=>Array.isArray(C));return Array.isArray(x)?x:[u]},fe=u=>{if(!u||u.length===0)return"";const x=Array.from(u.reduce((P,w)=>(Object.keys(w||{}).forEach(ge=>P.add(ge)),P),new Set)),C=P=>{if(P==null)return"";const w=typeof P=="object"?JSON.stringify(P):String(P);return/[",\n]/.test(w)?'"'+w.replace(/"/g,'""')+'"':w},D=x.map(C).join(","),N=u.map(P=>x.map(w=>C(P?.[w])).join(","));return[D,...N].join(`
`)},Ie=(u,x,C)=>{const D=new Blob([u],{type:C}),N=URL.createObjectURL(D),P=document.createElement("a");P.href=N,P.download=x,document.body.appendChild(P),P.click(),P.remove(),URL.revokeObjectURL(N)},pt=()=>{if(!d){t({title:"Nenhum relatÃ³rio para exportar",description:"Gere um relatÃ³rio primeiro.",variant:"destructive"});return}try{const u=ve(d).map(D=>{const N={};return Object.entries(D||{}).forEach(([P,w])=>{w&&typeof w=="object"&&!Array.isArray(w)?Object.entries(w).forEach(([ge,ht])=>{N[`${P}.${ge}`]=ht}):N[P]=w}),N}),x=fe(u);if(!x)throw new Error("NÃ£o hÃ¡ dados tabulares para exportar");const C=(d?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ie(x,`${C}-${Date.now()}.csv`,"text/csv;charset=utf-8;"),t({title:"Exportado com sucesso",description:"Arquivo CSV baixado."})}catch(u){V.warn("CSV export fallback to JSON:",u);const x=(d?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ie(JSON.stringify(d,null,2),`${x}-${Date.now()}.json`,"application/json"),t({title:"Exportado como JSON",description:"NÃ£o foi possÃ­vel gerar CSV. Baixamos o JSON.",variant:"destructive"})}};return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[s.jsx(yt,{title:"RelatÃ³rios",subtitle:"Gere relatÃ³rios formais e exportÃ¡veis",role:"teacher",actions:s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(S,{variant:"outline",onClick:Z,children:[s.jsx(We,{className:"w-4 h-4 mr-2"}),"HistÃ³rico"]}),s.jsxs(S,{variant:"outline",onClick:se,children:[s.jsx(Sa,{className:"w-4 h-4 mr-2"}),"Templates"]}),s.jsxs(S,{onClick:()=>t({title:"Selecione um template abaixo"}),children:[s.jsx(ye,{className:"w-4 h-4 mr-2"}),"Novo RelatÃ³rio"]})]})}),s.jsx(q,{className:"mt-6 p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:s.jsx(Oa,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-900 dark:text-blue-100",children:"Selecione o Escopo do RelatÃ³rio"}),s.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Escolha para quem deseja gerar o relatÃ³rio antes de selecionar um template"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(ie,{className:"text-sm font-medium mb-2 block",children:"Tipo de RelatÃ³rio"}),s.jsxs(ne,{value:j,onValueChange:$,children:[s.jsx(oe,{className:"bg-white dark:bg-slate-900",children:s.jsx(le,{placeholder:"Selecione o tipo..."})}),s.jsxs(ce,{children:[s.jsx(F,{value:"student",children:"Aluno EspecÃ­fico"}),s.jsx(F,{value:"class",children:"Turma Completa"}),s.jsx(F,{value:"all",children:"Todos os Alunos"})]})]})]}),j==="student"&&s.jsxs("div",{children:[s.jsx(ie,{className:"text-sm font-medium mb-2 block",children:"Selecionar Aluno"}),s.jsxs(ne,{value:p||"",onValueChange:h,children:[s.jsx(oe,{className:"bg-white dark:bg-slate-900",children:s.jsx(le,{placeholder:"Escolha um aluno..."})}),s.jsx(ce,{children:B.map(u=>s.jsxs(F,{value:u.id,children:[u.name," ",u.className&&`(${u.className})`]},u.id))})]})]}),j==="class"&&s.jsxs("div",{children:[s.jsx(ie,{className:"text-sm font-medium mb-2 block",children:"Selecionar Turma"}),s.jsxs(ne,{value:g||"",onValueChange:b,children:[s.jsx(oe,{className:"bg-white dark:bg-slate-900",children:s.jsx(le,{placeholder:"Escolha uma turma..."})}),s.jsx(ce,{children:A.map(u=>s.jsxs(F,{value:u.id,children:[u.name," ",u.subject&&`- ${u.subject}`]},u.id))})]})]}),s.jsxs("div",{children:[s.jsx(ie,{className:"text-sm font-medium mb-2 block",children:"PerÃ­odo"}),s.jsxs(ne,{value:R,onValueChange:_,children:[s.jsx(oe,{className:"bg-white dark:bg-slate-900",children:s.jsx(le,{})}),s.jsxs(ce,{children:[s.jsx(F,{value:"7",children:"Ãšltimos 7 dias"}),s.jsx(F,{value:"30",children:"Ãšltimos 30 dias"}),s.jsx(F,{value:"90",children:"Ãšltimos 90 dias"}),s.jsx(F,{value:"180",children:"Ãšltimos 6 meses"}),s.jsx(F,{value:"365",children:"Ãšltimo ano"})]})]})]})]}),j&&s.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[s.jsx("strong",{children:"Filtro ativo:"})," ",j==="student"?`Aluno - ${B.find(u=>u.id===p)?.name||"Selecione"}`:j==="class"?`Turma - ${A.find(u=>u.id===g)?.name||"Selecione"}`:"Todos os alunos"]}),s.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>{$(""),h(null),b(null)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[s.jsx(at,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]})]})}),s.jsxs(bt,{value:i,onValueChange:n,className:"mt-6",children:[s.jsxs(xt,{className:"grid w-full max-w-md grid-cols-2",children:[s.jsx($e,{value:"templates",children:"Templates"}),s.jsx($e,{value:"history",children:"HistÃ³rico"})]}),s.jsxs(Fe,{value:"templates",className:"mt-6",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:et.map((u,x)=>{const C=u.icon;return s.jsx(gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},style:{pointerEvents:"auto"},children:s.jsxs(q,{className:"p-6 h-full flex flex-col hover:shadow-lg transition-shadow relative",style:{pointerEvents:"auto"},children:[s.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${u.color} opacity-5 group-hover:opacity-10 transition-opacity`}),u.popular&&s.jsxs(Me,{className:"absolute top-4 right-4 bg-yellow-500 text-white",children:[s.jsx(_a,{className:"w-3 h-3 mr-1"}),"Popular"]}),s.jsx("div",{className:"mb-4 relative z-10",children:s.jsx("div",{className:`inline-flex p-3 rounded-xl bg-gradient-to-r ${u.color}`,children:s.jsx(C,{className:"w-6 h-6 text-white"})})}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:u.name}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:u.description}),s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-2",children:"Inclui:"}),s.jsxs("ul",{className:"space-y-1",children:[u.includes.slice(0,3).map((D,N)=>s.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-center",children:[s.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mr-2"}),D]},N)),u.includes.length>3&&s.jsxs("li",{className:"text-xs text-blue-600 dark:text-blue-400",children:["+",u.includes.length-3," mais..."]})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx(Me,{variant:"outline",className:"text-xs",children:u.usage})}),s.jsxs("div",{className:"flex gap-2 mt-auto pt-4 relative z-50",children:[s.jsxs(S,{className:`flex-1 bg-gradient-to-r ${u.color} text-white hover:opacity-90`,onClick:()=>{V.debug("BotÃ£o Gerar clicado:",u.id),X(u.id)},children:[s.jsx(ye,{className:"w-4 h-4 mr-2"}),"Gerar"]}),s.jsx(S,{variant:"outline",size:"icon",onClick:()=>{V.debug("BotÃ£o Preview clicado"),t({title:"Preview",description:"VisualizaÃ§Ã£o serÃ¡ implementada"})},children:s.jsx(Da,{className:"w-4 h-4"})})]})]})},u.id)})}),s.jsxs(q,{className:"mt-8 p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Formatos de ExportaÃ§Ã£o"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs(S,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-red-50 hover:border-red-300 dark:hover:bg-red-950/20",onClick:()=>{V.debug("Exportar PDF clicado"),t({title:"Exportar PDF",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(Pe,{className:"w-8 h-8 mb-2 text-red-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PDF"})]}),s.jsxs(S,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-green-50 hover:border-green-300 dark:hover:bg-green-950/20",onClick:pt,children:[s.jsx(Fa,{className:"w-8 h-8 mb-2 text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Excel"})]}),s.jsxs(S,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20",onClick:()=>{V.debug("Exportar Word clicado"),t({title:"Exportar Word",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(Pe,{className:"w-8 h-8 mb-2 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Word"})]}),s.jsxs(S,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-purple-50 hover:border-purple-300 dark:hover:bg-purple-950/20",onClick:()=>{V.debug("Exportar PNG clicado"),t({title:"Exportar PNG",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(Ma,{className:"w-8 h-8 mb-2 text-purple-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PNG"})]})]})]})]}),s.jsx(Fe,{value:"history",className:"mt-6",children:s.jsx(q,{className:"p-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx(We,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:"Nenhum relatÃ³rio gerado ainda"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"RelatÃ³rios que vocÃª gerar aparecerÃ£o aqui para fÃ¡cil acesso"}),s.jsxs(S,{onClick:()=>n("templates"),children:[s.jsx(ye,{className:"w-4 h-4 mr-2"}),"Gerar Primeiro RelatÃ³rio"]})]})})})]}),d&&s.jsx(ts,{report:d,onClose:()=>f(null)})]})};export{Ks as default};
