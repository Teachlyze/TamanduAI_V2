import{b as K,u as G,E as V,r as t,s as m,l as j,j as e,q as Z}from"./main-CDwcRVbo.js";import{C as b}from"./card-BeDiIhdC.js";import{B as o}from"./button-BuH7Xbht.js";import{I as N}from"./input-BByzzpRS.js";import{L as v}from"./label-CwZn5L96.js";import{t as r}from"./use-toast-BOz3McvK.js";import{U as H}from"./user-AHcA6CRu.js";import{S as J}from"./settings-DAYbyNc3.js";import{S as Q}from"./shield-C5XjaDu3.js";import{S as W}from"./save-KA2dtO22.js";import{M as D,S as R}from"./sun-6CpRvYzt.js";import{B as Y}from"./bell-BCMDKcho.js";import{K as ee}from"./key-qYfTE8ss.js";import{T as F}from"./triangle-alert-3VG5rXf9.js";import{T as M}from"./trash-2-DWzFVjOL.js";import{A as ae}from"./index-CrH3dQlI.js";import{m as O}from"./proxy-BQZ2TmvR.js";const be=()=>{const{user:i,signOut:k}=K(),w=G(),{theme:d,toggleTheme:I}=V(),[L,y]=t.useState(!0),[S,U]=t.useState(!0),[C,E]=t.useState(!1),[x,_]=t.useState("personal"),[$,f]=t.useState(!1),[p,T]=t.useState(""),[c,A]=t.useState(!1),P=a=>a?(a=String(a).replace(/\D/g,""),a.length<=10?(a=a.replace(/(\d{2})(\d)/,"($1) $2"),a=a.replace(/(\d{4})(\d)/,"$1-$2")):(a=a.replace(/(\d{2})(\d)/,"($1) $2"),a=a.replace(/(\d{5})(\d)/,"$1-$2")),a):"",[l,u]=t.useState({full_name:"",email:"",phone:"",avatar_url:""}),[n,h]=t.useState({notifications:{email:{newActivities:!0,gradeUpdates:!0,upcomingEvents:!0,weeklyReport:!0},push:{newActivities:!0,todayEvents:!1,messages:!0}},interface:{theme:"light",language:"pt-BR"}});t.useEffect(()=>{i?.id&&q()},[i]);const q=async()=>{try{y(!0);const{data:a,error:s}=await m.from("profiles").select("*").eq("id",i.id).single();if(s&&s.code!=="PGRST116")throw s;a&&(u({full_name:a.full_name||"",email:a.email||i.email||"",phone:P(a.phone||""),avatar_url:a.avatar_url||""}),a.preferences&&h(g=>({...g,...a.preferences})))}catch(a){j.error("Erro ao carregar perfil:",a),r({title:"Erro ao carregar perfil",description:"Não foi possível carregar seus dados.",variant:"destructive"})}finally{y(!1),S&&U(!1)}},z=async()=>{try{E(!0);const{error:a}=await m.from("profiles").upsert({id:i.id,full_name:l.full_name,phone:l.phone.replace(/\D/g,""),email:l.email,updated_at:new Date().toISOString()});if(a)throw a;r({title:"Perfil atualizado",description:"Suas informações foram salvas com sucesso."})}catch(a){j.error("Erro ao salvar:",a),r({title:"Erro",description:"Não foi possível salvar as alterações.",variant:"destructive"})}finally{E(!1)}},B=()=>{const a=d==="dark"?"light":"dark";I(),h(s=>({...s,interface:{...s.interface,theme:a}}))},X=[{id:"personal",label:"Dados Pessoais",icon:H},{id:"preferences",label:"Preferências",icon:J},{id:"security",label:"Segurança",icon:Q}];return L&&S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Z,{size:"lg",text:"Carregando..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-slate-900 dark:text-white",children:"Configurações"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"space-y-2",children:X.map(a=>{const s=a.icon,g=x===a.id;return e.jsxs("button",{onClick:()=>_(a.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${g?"bg-blue-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[e.jsx(s,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:a.label})]},a.id)})})}),e.jsxs("div",{className:"lg:col-span-3",children:[x==="personal"&&e.jsxs(b,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Dados Pessoais"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(N,{id:"fullName",value:l.full_name,onChange:a=>u({...l,full_name:a.target.value}),placeholder:"Seu nome completo",className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"email",children:"Email"}),e.jsx(N,{id:"email",type:"email",value:l.email,disabled:!0,className:"mt-2 bg-slate-100 dark:bg-slate-800"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"O email não pode ser alterado"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"phone",children:"Telefone"}),e.jsx(N,{id:"phone",value:l.phone,onChange:a=>u({...l,phone:P(a.target.value)}),placeholder:"(11) 99999-9999",className:"mt-2"})]}),e.jsx(o,{onClick:z,disabled:C,className:"w-full",children:C?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Salvar Alterações"]})})]})]}),x==="preferences"&&e.jsxs(b,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Preferências"}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[d==="dark"?e.jsx(D,{className:"w-5 h-5"}):e.jsx(R,{className:"w-5 h-5"}),"Tema"]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Modo ",d==="dark"?"Escuro":"Claro"]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Atualmente usando tema ",d==="dark"?"escuro":"claro"]})]}),e.jsx(o,{onClick:B,variant:"outline",children:d==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Modo Claro"]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Modo Escuro"]})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Notificações"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Novas Atividades"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Receba notificações quando houver novas atividades"})]}),e.jsx("input",{type:"checkbox",checked:n.notifications.email.newActivities,onChange:a=>h({...n,notifications:{...n.notifications,email:{...n.notifications.email,newActivities:a.target.checked}}}),className:"w-5 h-5"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Notas Atualizadas"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Receba notificações quando suas notas forem atualizadas"})]}),e.jsx("input",{type:"checkbox",checked:n.notifications.email.gradeUpdates,onChange:a=>h({...n,notifications:{...n.notifications,email:{...n.notifications.email,gradeUpdates:a.target.checked}}}),className:"w-5 h-5"})]})]})]})]}),x==="security"&&e.jsxs(b,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Segurança"}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Alterar Senha"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Para alterar sua senha, você receberá um email com instruções."}),e.jsx(o,{variant:"outline",onClick:async()=>{const{error:a}=await m.auth.resetPasswordForEmail(i.email,{redirectTo:`${window.location.origin}/reset-password`});a?r({title:"Erro",description:"Não foi possível enviar o email de redefinição.",variant:"destructive"}):r({title:"Email Enviado",description:"Verifique sua caixa de entrada para redefinir sua senha."})},children:"Enviar Email de Redefinição"})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-8",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-red-600",children:[e.jsx(F,{className:"w-5 h-5"}),"Zona de Perigo"]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-300 mb-2",children:"Deletar Conta"}),e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-400 mb-4",children:["Esta ação é ",e.jsx("strong",{children:"irreversível"}),". Todos os seus dados, histórico e submissões serão permanentemente deletados."]}),e.jsxs(o,{variant:"destructive",onClick:()=>f(!0),className:"bg-red-600 hover:bg-red-700",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Deletar Minha Conta"]})]})]})]})]})]})]}),e.jsx(ae,{children:$&&e.jsxs(e.Fragment,{children:[e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 z-[100]",onClick:()=>!c&&f(!1)}),e.jsx(O.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{type:"spring",duration:.3},className:"fixed inset-0 z-[101] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-2xl p-6 border border-red-200 dark:border-red-800 w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-600",children:"Deletar Conta Permanentemente"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Esta ação não pode ser desfeita"})]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-red-900 dark:text-red-300 font-semibold mb-2",children:"⚠️ O que será deletado:"}),e.jsxs("ul",{className:"text-sm text-red-800 dark:text-red-400 space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"Todos os seus dados pessoais"}),e.jsx("li",{children:"Suas submissões e notas"}),e.jsx("li",{children:"Participação em turmas"}),e.jsx("li",{children:"Todo o histórico acadêmico"}),e.jsx("li",{children:"Acesso permanente à plataforma"})]})]}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-4",children:["Para confirmar, digite ",e.jsx("strong",{className:"font-mono bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded",children:"CONFIRMAR EXCLUSÃO"})," abaixo:"]}),e.jsx("input",{type:"text",value:p,onChange:a=>T(a.target.value),placeholder:"Digite: CONFIRMAR EXCLUSÃO",disabled:c,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg mb-6 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:opacity-50"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{onClick:()=>{f(!1),T("")},disabled:c,variant:"outline",className:"flex-1",children:"Cancelar"}),e.jsx(o,{onClick:async()=>{if(p!=="CONFIRMAR EXCLUSÃO"){r({title:"Texto Incorreto",description:'Por favor, digite exatamente "CONFIRMAR EXCLUSÃO".',variant:"destructive"});return}A(!0);try{const{error:a}=await m.from("profiles").delete().eq("id",i.id);if(a)throw a;const{error:s}=await m.auth.admin.deleteUser(i.id);if(s){await k(),r({title:"Conta Desativada",description:"Sua conta foi desativada. Entre em contato com o suporte para conclusão."}),w("/login");return}await k(),r({title:"Conta Deletada",description:"Sua conta foi permanentemente deletada."}),w("/login")}catch(a){j.error("Erro ao deletar conta:",a),r({title:"Erro",description:"Não foi possível deletar a conta. Tente novamente.",variant:"destructive"}),A(!1)}},disabled:c||p!=="CONFIRMAR EXCLUSÃO",className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"}),"Deletando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Deletar Permanentemente"]})})]})]})})]})})]})};export{be as default};
