import{h as J,u as P,b as $,r as l,l as u,s as g,j as e,a as C}from"./main-CDwcRVbo.js";import{B as j}from"./button-BuH7Xbht.js";import{C as k}from"./card-BeDiIhdC.js";import{I as D}from"./input-BByzzpRS.js";import{C as y}from"./circle-check-big-ZpCnrfY5.js";import{B as E}from"./book-open-B_wcLpnO.js";import{A as R}from"./arrow-right-CwVz_fzu.js";import{C as A}from"./circle-x-BzJpmwsL.js";import{U as I}from"./users-CgJEdG6v.js";const H=()=>{const{code:x}=J(),n=P(),{user:c,profile:o}=$(),[h,_]=l.useState(x||""),[f,p]=l.useState(!1),[d,N]=l.useState(!1),[s,b]=l.useState(null),[v,t]=l.useState(null),[S,T]=l.useState(!1);l.useEffect(()=>{x&&c&&o&&w(x)},[x,c,o]);const w=async(r=h)=>{try{p(!0),t(null),b(null);const a=r.replace(/\s/g,"").trim().toUpperCase();if(!a){t("Digite um c贸digo v谩lido");return}if(a.length!==8){t("O c贸digo deve ter 8 caracteres");return}u.debug("[JoinClass] Buscando turma com c贸digo:",a);const{data:i,error:m}=await g.from("classes").select(`
          id,
          name,
          subject,
          description,
          color,
          banner_color,
          invite_code,
          created_by,
          profiles:created_by(full_name)
        `).eq("invite_code",a).eq("is_active",!0).single();if(u.debug("[JoinClass] Resultado da busca:",{classInfo:i,classError:m}),m){m.code==="PGRST116"?t("Turma n茫o encontrada. Verifique o c贸digo e tente novamente."):(u.error("[JoinClass] Erro ao buscar turma:",m),t(`Erro ao buscar turma: ${m.message}`));return}if(!i){t("Turma n茫o encontrada. Verifique o c贸digo e tente novamente.");return}const{data:q}=await g.from("class_members").select("id").eq("class_id",i.id).eq("user_id",c.id).single();if(q){t("Voc锚 j谩 茅 membro desta turma"),setTimeout(()=>{o.role==="student"?n(`/students/classes/${i.id}`):n(`/dashboard/classes/${i.id}`)},2e3);return}b(i)}catch(a){u.error("Erro ao buscar turma:",a),t("Erro ao buscar turma. Tente novamente.")}finally{p(!1)}},B=async()=>{if(!(!s||!c))try{N(!0),t(null);const{error:r}=await g.from("class_members").insert({class_id:s.id,user_id:c.id,role:o.role==="teacher"?"teacher":"student",joined_at:new Date().toISOString()});if(r)throw r;T(!0),setTimeout(()=>{o.role==="student"?n(`/students/classes/${s.id}`):n(`/dashboard/classes/${s.id}`)},1500)}catch(r){u.error("Erro ao entrar na turma:",r),t("Erro ao entrar na turma. Tente novamente.")}finally{N(!1)}};return S?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 dark:from-slate-950 dark:to-slate-900 flex items-center justify-center p-6",children:e.jsxs(k,{className:"p-12 text-center max-w-md w-full",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:e.jsx(y,{className:"w-12 h-12 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-green-900 dark:text-green-100",children:" Parab茅ns!"}),e.jsxs("p",{className:"text-lg text-slate-600 dark:text-slate-400 mb-4",children:["Voc锚 entrou na turma ",e.jsx("strong",{children:s?.name})]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Redirecionando para a turma..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-cyan-50 to-purple-50 dark:from-slate-950 dark:to-slate-900 flex items-center justify-center p-6",children:e.jsxs(k,{className:"p-8 max-w-lg w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-600 flex items-center justify-center",children:e.jsx(E,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 text-slate-900 dark:text-white",children:"Entrar em uma Turma"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Digite o c贸digo de convite da turma"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"C贸digo da Turma"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{type:"text",value:h,onChange:r=>{const a=r.target.value.toUpperCase();a.length<=8&&(_(a),t(null),b(null))},placeholder:"EX: ABC12345",className:"font-mono text-lg text-center tracking-wider",maxLength:8,disabled:f||d}),e.jsx(j,{onClick:()=>w(),disabled:f||d||!h.trim()||h.length!==8,className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white",children:f?e.jsx(C,{className:"w-4 h-4 animate-spin"}):e.jsx(R,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"O c贸digo tem 8 caracteres e 茅 fornecido pelo professor"})]}),v&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-red-900 dark:text-red-100",children:v})})]})}),s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`h-24 -mx-8 mb-4 rounded-xl bg-gradient-to-r ${s.banner_color||"from-blue-500 to-purple-500"} flex items-center justify-center`,children:e.jsx(E,{className:"w-12 h-12 text-white"})}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-xl p-6 mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:s.name}),s.subject&&e.jsxs("p",{className:"text-slate-700 dark:text-slate-300 mb-2",children:[" ",s.subject]}),s.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsxs("span",{children:["Professor(a): ",s.profiles?.full_name||"Professor"]})]})]}),e.jsx(j,{className:"w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white",onClick:B,disabled:d,size:"lg",children:d?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-5 h-5 mr-2 animate-spin"}),"Entrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Entrar nesta Turma"]})})]}),e.jsx("div",{className:"text-center",children:e.jsx(j,{variant:"ghost",onClick:()=>{o?.role==="student"?n("/student/classes"):n("/dashboard")},disabled:f||d,children:"Cancelar"})})]})})};export{H as default};
