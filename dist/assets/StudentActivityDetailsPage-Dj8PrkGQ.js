import{c as _,r as i,j as e,e as A,k as D,u as E,a as C,s as m,i as P}from"./main-vCmkj0Ph.js";import{B as v,C as c}from"./card-QZFCDucj.js";import{B as x}from"./badge-DYNIDruK.js";import{D as R}from"./dropdown-menu-CRv4RkRy.js";import"./label-DA0WPkHe.js";import{A as q}from"./arrow-left-DABf050f.js";import{M as z}from"./message-square-B_K00Q7Z.js";import"./index-DF9gUw3L.js";import"./chevron-right-DOiZ8o1C.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],B=_("send",L),N=i.forwardRef(({className:l,...u},d)=>e.jsx("textarea",{className:A("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),ref:d,...u}));N.displayName="Textarea";const Q=()=>{const{activityId:l}=D(),u=E(),{user:d}=C(),[y,b]=i.useState(!0),[h,g]=i.useState(!1),[s,w]=i.useState(null),[t,p]=i.useState(null),[o,f]=i.useState(""),[I,F]=i.useState([]);i.useEffect(()=>{j()},[l,d]);const j=async()=>{if(d)try{b(!0);const{data:a}=await m.from("activities").select(`
          *,
          created_by_user:profiles!activities_created_by_fkey (
            id,
            name
          )
        `).eq("id",l).single();w(a);const{data:n}=await m.from("submissions").select(`
          *,
          feedback:feedbacks (*)
        `).eq("activity_id",l).eq("student_id",d.id).single();n&&(p(n),f(n.content||""))}catch(a){console.error("Erro:",a)}finally{b(!1)}},k=async()=>{if(!o.trim()){alert("Por favor, escreva sua resposta");return}try{if(g(!0),t){const{error:a}=await m.from("submissions").update({content:o,submitted_at:new Date().toISOString(),status:"submitted"}).eq("id",t.id);if(a)throw a}else{const{data:a,error:n}=await m.from("submissions").insert({activity_id:l,student_id:d.id,content:o,submitted_at:new Date().toISOString(),status:"submitted"}).select().single();if(n)throw n;p(a)}alert("Atividade enviada com sucesso!"),j()}catch(a){console.error("Erro:",a),alert("Erro ao enviar atividade")}finally{g(!1)}};if(y)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(P,{size:"lg"})});const S=s?.due_date&&new Date(s.due_date)<new Date,r=t?.grade!==null;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(v,{variant:"ghost",onClick:()=>u("/student/activities"),className:"mb-4",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(R,{title:s?.title||"Atividade",subtitle:`Por ${s?.created_by_user?.name||"Professor"}`,role:"student"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(x,{className:s?.status==="active"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700",children:s?.status==="active"?"Ativa":"Encerrada"}),S&&e.jsx(x,{className:"bg-red-100 text-red-700",children:"Atrasada"}),r&&e.jsx(x,{className:"bg-blue-100 text-blue-700",children:"Corrigida"})]}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Instruções"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 whitespace-pre-wrap",children:s?.description||"Sem descrição"})]}),!r&&s?.status==="active"?e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Sua Resposta"}),e.jsx(N,{value:o,onChange:a=>f(a.target.value),placeholder:"Digite sua resposta aqui...",className:"mb-4 min-h-[300px]",disabled:r}),e.jsx("div",{className:"flex gap-2",children:e.jsx(v,{onClick:k,disabled:h||r,className:"bg-gradient-to-r from-blue-600 to-purple-600",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),t?"Atualizar Resposta":"Enviar Resposta"]})})})]}):r?e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Sua Resposta (Corrigida)"}),e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-lg mb-4",children:e.jsx("p",{className:"whitespace-pre-wrap",children:t?.content})})]}):null,r&&e.jsxs(c,{className:"p-6 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Feedback do Professor"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:t?.feedback?.[0]?.comment||"Sem comentários"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Nota:"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[t?.grade,"/",s?.max_score]})]})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Detalhes"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Prazo:"}),e.jsx("div",{className:"font-semibold",children:s?.due_date?new Date(s.due_date).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Sem prazo"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Pontuação:"}),e.jsxs("div",{className:"font-semibold",children:[s?.max_score," pontos"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Tipo:"}),e.jsx("div",{className:"font-semibold capitalize",children:s?.type||"Tarefa"})]}),t&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Status:"}),e.jsx("div",{className:"font-semibold",children:r?"Corrigida":t.submitted_at?"Enviada":"Rascunho"})]})]})]})})]})]})};export{Q as default};
