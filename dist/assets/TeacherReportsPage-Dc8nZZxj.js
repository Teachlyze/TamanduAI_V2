import{c as Ee,r as o,d as de,f as nt,s as N,j as s,a as ot,l as F}from"./main-DdaZa2uw.js";import{C as G}from"./card-B5qOXzCs.js";import{B as R}from"./button-C8tPcSnA.js";import{B as ke}from"./badge-BIkuT5Lr.js";import{L as ae}from"./label-C86gYWIM.js";import{T as lt,a as ct,b as Ce,c as Re}from"./tabs-C0jNhETU.js";import{S as re,a as se,b as ie,c as ne,d as B}from"./select-CtQC0DVu.js";import{D as dt}from"./DashboardHeader-CzmIe9wt.js";import"./input-1LHkCxOt.js";import"./dropdown-menu-BtcRZYAO.js";import{u as He}from"./use-toast-BHHozLsU.js";import{D as ut}from"./download-CBaSo5wG.js";import{P as mt,F as pt}from"./printer-D2334dsj.js";import{S as ht}from"./share-2-CYuaD-J9.js";import{X as We}from"./x-Dfn-8env.js";import{r as ue,a as Je,S as ft,b as vt,u as me,s as gt,c as bt,d as xt,e as yt,f as jt,g as wt,i as xe,h as Ze,j as Et,k as Te,l as Nt,m as pe,n as Y,o as Ye,p as Pt,q as At,D as Xe,t as Qe,R as St,v as Ot,G as kt,w as et,x as Ct,L as X,Z as tt,y as Rt,z as Tt,J as _t,A as Dt,B as _e,C as oe,E as ye,P as Lt,F as $t,H as It,I as Ft,K as Mt,M as Bt,N as zt,O as ee,Q as De,T as qt,U as Ut,V as Gt,W as ve,X as ge,Y as Kt,_ as Le,$ as $e,a0 as Ie,a1 as Vt}from"./LineChart-kmVrN76k.js";import{s as Ht,P as Wt}from"./PolarChart-Ccj9WHat.js";import{C as Ne,u as Jt,a as Zt,b as Yt,B as Xt,c as Qt}from"./BarChart-HTNTqSFO.js";import{H as Fe}from"./history-BtpH9uC8.js";import{S as ea}from"./settings-Lxan3lFe.js";import{P as be}from"./plus-BDIfUHIr.js";import{F as ta}from"./funnel-BiF3iJ2N.js";import{U as aa}from"./user-CvzLzPOM.js";import{U as ra}from"./users-CL6i5PZL.js";import{C as sa}from"./clipboard-list-e7I1pS1G.js";import{F as je}from"./file-text-KG1EARAT.js";import{m as ia}from"./proxy-cOiZ72Cz.js";import{S as na}from"./star-op6BUVmU.js";import{E as oa}from"./eye-DFSUYF2x.js";import"./SidebarPremium-DVCiHgHT.js";import"./house-BuCVh-jt.js";import"./book-open-BB96wzR_.js";import"./graduation-cap-BXMQrtzB.js";import"./calendar-BgLSegFA.js";import"./chart-column-fsDJzCSk.js";import"./message-circle-D6wHM5-f.js";import"./index-Aqr4bB4c.js";import"./chevron-right-D-Gd8Ev0.js";import"./index-Chp0GnAd.js";import"./index-B7hVVF4G.js";import"./index-BbNaVbvl.js";import"./index-DljWCpXy.js";import"./index-Bjez3Xzb.js";import"./chevron-down-CKhbRXKe.js";import"./check-D-al-kKT.js";import"./chevron-up-CREhvnGD.js";import"./index-CWLY1CCX.js";const la=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],ca=Ee("chart-no-axes-column-increasing",la);const da=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],ua=Ee("file-image",da);const ma=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],pa=Ee("git-compare",ma);function ce(){return ce=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},ce.apply(null,arguments)}function Me(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function ha(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Me(Object(a),!0).forEach(function(r){fa(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Me(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function fa(t,e,a){return(e=va(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function va(t){var e=ga(t,"string");return typeof e=="symbol"?e:e+""}function ga(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var $=32,ba={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function xa(t){var{data:e,iconType:a,inactiveColor:r}=t,i=$/2,n=$/6,u=$/3,c=e.inactive?r:e.color,p=a??e.type;if(p==="none")return null;if(p==="plainline"){var f;return o.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:(f=e.payload)===null||f===void 0?void 0:f.strokeDasharray,x1:0,y1:i,x2:$,y2:i,className:"recharts-legend-icon"})}if(p==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(i,"h").concat(u,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(2*u,",").concat(i,`
            H`).concat($,"M").concat(2*u,",").concat(i,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(u,",").concat(i),className:"recharts-legend-icon"});if(p==="rect")return o.createElement("path",{stroke:"none",fill:c,d:"M0,".concat($/8,"h").concat($,"v").concat($*3/4,"h").concat(-$,"z"),className:"recharts-legend-icon"});if(o.isValidElement(e.legendIcon)){var m=ha({},e);return delete m.legendIcon,o.cloneElement(e.legendIcon,m)}return o.createElement(vt,{fill:c,cx:i,cy:i,size:$,sizeType:"diameter",type:p})}function ya(t){var{payload:e,iconSize:a,layout:r,formatter:i,inactiveColor:n,iconType:u}=t,c={x:0,y:0,width:$,height:$},p={display:r==="horizontal"?"inline-block":"block",marginRight:10},f={display:"inline-block",verticalAlign:"middle",marginRight:4};return e.map((m,g)=>{var d=m.formatter||i,h=de({"recharts-legend-item":!0,["legend-item-".concat(g)]:!0,inactive:m.inactive});if(m.type==="none")return null;var v=m.inactive?n:m.color,E=d?d(m.value,m,g):m.value;return o.createElement("li",ce({className:h,style:p,key:"legend-item-".concat(g)},Je(t,m,g)),o.createElement(ft,{width:a,height:a,viewBox:c,style:f,"aria-label":"".concat(E," legend icon")},o.createElement(xa,{data:m,iconType:u,inactiveColor:n})),o.createElement("span",{className:"recharts-legend-item-text",style:{color:v}},E))})}var ja=t=>{var e=ue(t,ba),{payload:a,layout:r,align:i}=e;if(!a||!a.length)return null;var n={padding:0,margin:0,textAlign:r==="horizontal"?i:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:n},o.createElement(ya,ce({},e,{payload:a})))};function wa(){return me(gt)}var Ea=["contextPayload"];function we(){return we=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},we.apply(null,arguments)}function Be(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function Q(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Be(Object(a),!0).forEach(function(r){Na(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Be(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Na(t,e,a){return(e=Pa(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Pa(t){var e=Aa(t,"string");return typeof e=="symbol"?e:e+""}function Aa(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Sa(t,e){if(t==null)return{};var a,r,i=Oa(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function Oa(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function ka(t){return t.value}function Ca(t){var{contextPayload:e}=t,a=Sa(t,Ea),r=Nt(e,t.payloadUniqBy,ka),i=Q(Q({},a),{},{payload:r});return o.isValidElement(t.content)?o.cloneElement(t.content,i):typeof t.content=="function"?o.createElement(t.content,i):o.createElement(ja,i)}function Ra(t,e,a,r,i,n){var{layout:u,align:c,verticalAlign:p}=e,f,m;return(!t||(t.left===void 0||t.left===null)&&(t.right===void 0||t.right===null))&&(c==="center"&&u==="vertical"?f={left:((r||0)-n.width)/2}:f=c==="right"?{right:a&&a.right||0}:{left:a&&a.left||0}),(!t||(t.top===void 0||t.top===null)&&(t.bottom===void 0||t.bottom===null))&&(p==="middle"?m={top:((i||0)-n.height)/2}:m=p==="bottom"?{bottom:a&&a.bottom||0}:{top:a&&a.top||0}),Q(Q({},f),m)}function Ta(t){var e=Ze();return o.useEffect(()=>{e(Et(t))},[e,t]),null}function _a(t){var e=Ze();return o.useEffect(()=>(e(Te(t)),()=>{e(Te({width:0,height:0}))}),[e,t]),null}function Da(t,e,a,r){return t==="vertical"&&xe(e)?{height:e}:t==="horizontal"?{width:a||r}:null}var La={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function le(t){var e=ue(t,La),a=wa(),r=bt(),i=xt(),{width:n,height:u,wrapperStyle:c,portal:p}=e,[f,m]=yt([a]),g=jt(),d=wt();if(g==null||d==null)return null;var h=g-(i?.left||0)-(i?.right||0),v=Da(e.layout,u,n,h),E=p?c:Q(Q({position:"absolute",width:v?.width||n||"auto",height:v?.height||u||"auto"},Ra(c,e,i,g,d,f)),c),P=p??r;if(P==null||a==null)return null;var D=o.createElement("div",{className:"recharts-legend-wrapper",style:E,ref:m},o.createElement(Ta,{layout:e.layout,align:e.align,verticalAlign:e.verticalAlign,itemSorter:e.itemSorter}),o.createElement(_a,{width:f.width,height:f.height}),o.createElement(Ca,we({},e,v,{margin:i,chartWidth:g,chartHeight:d,contextPayload:a})));return nt.createPortal(D,P)}le.displayName="Legend";function ze(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function qe(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?ze(Object(a),!0).forEach(function(r){$a(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ze(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function $a(t,e,a){return(e=Ia(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Ia(t){var e=Fa(t,"string");return typeof e=="symbol"?e:e+""}function Fa(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Ma=(t,e)=>e,Pe=pe([Ht,Ma],(t,e)=>t.filter(a=>a.type==="pie").find(a=>a.id===e)),Ba=[],Ae=(t,e,a)=>a?.length===0?Ba:a,at=pe([At,Pe,Ae],(t,e,a)=>{var{chartData:r}=t;if(e!=null){var i;if(e?.data!=null&&e.data.length>0?i=e.data:i=r,(!i||!i.length)&&a!=null&&(i=a.map(n=>qe(qe({},e.presentationProps),n.props))),i!=null)return i}}),za=pe([at,Pe,Ae],(t,e,a)=>{if(!(t==null||e==null))return t.map((r,i)=>{var n,u=Y(r,e.nameKey,e.name),c;return a!=null&&(n=a[i])!==null&&n!==void 0&&(n=n.props)!==null&&n!==void 0&&n.fill?c=a[i].props.fill:typeof r=="object"&&r!=null&&"fill"in r?c=r.fill:c=e.fill,{value:Ye(u,e.dataKey),color:c,payload:r,type:e.legendType}})}),qa=pe([at,Pe,Ae,Pt],(t,e,a,r)=>{if(!(e==null||t==null))return lr({offset:r,pieSettings:e,displayedData:t,cells:a})}),Ua=["onMouseEnter","onClick","onMouseLeave"],Ga=["id"],Ka=["id"];function Se(t,e){if(t==null)return{};var a,r,i=Va(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function Va(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function Ue(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function w(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Ue(Object(a),!0).forEach(function(r){Ha(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ue(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ha(t,e,a){return(e=Wa(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Wa(t){var e=Ja(t,"string");return typeof e=="symbol"?e:e+""}function Ja(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function V(){return V=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},V.apply(null,arguments)}function Za(t){var e=o.useMemo(()=>et(t.children,Ne),[t.children]),a=me(r=>za(r,t.id,e));return a==null?null:o.createElement(Ct,{legendPayload:a})}function Ya(t){var{dataKey:e,nameKey:a,sectors:r,stroke:i,strokeWidth:n,fill:u,name:c,hide:p,tooltipType:f}=t;return{dataDefinedOnItem:r.map(m=>m.tooltipPayload),positions:r.map(m=>m.tooltipPosition),settings:{stroke:i,strokeWidth:n,fill:u,dataKey:e,nameKey:a,name:Ye(c,e),hide:p,type:f,color:u,unit:""}}}var Xa=(t,e)=>t>e?"start":t<e?"end":"middle",Qa=(t,e,a)=>typeof e=="function"?ee(e(t),a,a*.8):ee(e,a,a*.8),er=(t,e,a)=>{var{top:r,left:i,width:n,height:u}=e,c=zt(n,u),p=i+ee(t.cx,n,n/2),f=r+ee(t.cy,u,u/2),m=ee(t.innerRadius,c,0),g=Qa(a,t.outerRadius,c),d=t.maxRadius||Math.sqrt(n*n+u*u)/2;return{cx:p,cy:f,innerRadius:m,outerRadius:g,maxRadius:d}},tr=(t,e)=>{var a=oe(e-t),r=Math.min(Math.abs(e-t),360);return a*r};function ar(t){return t&&typeof t=="object"&&"className"in t&&typeof t.className=="string"?t.className:""}var rr=(t,e)=>{if(o.isValidElement(t))return o.cloneElement(t,e);if(typeof t=="function")return t(e);var a=de("recharts-pie-label-line",typeof t!="boolean"?t.className:"");return o.createElement(qt,V({},e,{type:"linear",className:a}))},sr=(t,e,a)=>{if(o.isValidElement(t))return o.cloneElement(t,e);var r=a;if(typeof t=="function"&&(r=t(e),o.isValidElement(r)))return r;var i=de("recharts-pie-label-text",ar(t));return o.createElement(Ut,V({},e,{alignmentBaseline:"middle",className:i}),r)};function ir(t){var{sectors:e,props:a,showLabels:r}=t,{label:i,labelLine:n,dataKey:u}=a;if(!r||!i||!e)return null;var c=Qe(a),p=De(i),f=De(n),m=typeof i=="object"&&"offsetRadius"in i&&typeof i.offsetRadius=="number"&&i.offsetRadius||20,g=e.map((d,h)=>{var v=(d.startAngle+d.endAngle)/2,E=ye(d.cx,d.cy,d.outerRadius+m,v),P=w(w(w(w({},c),d),{},{stroke:"none"},p),{},{index:h,textAnchor:Xa(E.x,d.cx)},E),D=w(w(w(w({},c),d),{},{fill:"none",stroke:d.fill},f),{},{index:h,points:[ye(d.cx,d.cy,d.outerRadius,v),E],key:"line"});return o.createElement(tt,{zIndex:Xe.label,key:"label-".concat(d.startAngle,"-").concat(d.endAngle,"-").concat(d.midAngle,"-").concat(h)},o.createElement(X,null,n&&rr(n,D),sr(i,P,Y(d,u))))});return o.createElement(X,{className:"recharts-pie-labels"},g)}function nr(t){var{sectors:e,props:a,showLabels:r}=t,{label:i}=a;return typeof i=="object"&&i!=null&&"position"in i?o.createElement(Bt,{label:i}):o.createElement(ir,{sectors:e,props:a,showLabels:r})}function or(t){var{sectors:e,activeShape:a,inactiveShape:r,allOtherPieProps:i}=t,n=me($t),{onMouseEnter:u,onClick:c,onMouseLeave:p}=i,f=Se(i,Ua),m=Jt(u,i.dataKey),g=Zt(p),d=Yt(c,i.dataKey);return e==null||e.length===0?null:o.createElement(o.Fragment,null,e.map((h,v)=>{if(h?.startAngle===0&&h?.endAngle===0&&e.length!==1)return null;var E=a&&String(v)===n,P=n?r:null,D=E?a:P,C=w(w({},h),{},{stroke:h.stroke,tabIndex:-1,[Ft]:v,[It]:i.dataKey});return o.createElement(X,V({key:"sector-".concat(h?.startAngle,"-").concat(h?.endAngle,"-").concat(h.midAngle,"-").concat(v),tabIndex:-1,className:"recharts-pie-sector"},Je(f,h,v),{onMouseEnter:m(h,v),onMouseLeave:g(h,v),onClick:d(h,v)}),o.createElement(Mt,V({option:D,isActive:E,shapeType:"sector"},C)))}))}function lr(t){var e,{pieSettings:a,displayedData:r,cells:i,offset:n}=t,{cornerRadius:u,startAngle:c,endAngle:p,dataKey:f,nameKey:m,tooltipType:g}=a,d=Math.abs(a.minAngle),h=tr(c,p),v=Math.abs(h),E=r.length<=1?0:(e=a.paddingAngle)!==null&&e!==void 0?e:0,P=r.filter(A=>Y(A,f,0)!==0).length,D=(v>=360?P:P-1)*E,C=v-P*d-D,T=r.reduce((A,L)=>{var b=Y(L,f,0);return A+(xe(b)?b:0)},0),z;if(T>0){var _;z=r.map((A,L)=>{var b=Y(A,f,0),M=Y(A,m,L),K=er(a,n,A),q=(xe(b)?b:0)/T,U,H=w(w({},A),i&&i[L]&&i[L].props);L?U=_.endAngle+oe(h)*E*(b!==0?1:0):U=c;var J=U+oe(h)*((b!==0?d:0)+q*C),W=(U+J)/2,te=(K.innerRadius+K.outerRadius)/2,he=[{name:M,value:b,payload:H,dataKey:f,type:g}],fe=ye(K.cx,K.cy,te,W);return _=w(w(w(w({},a.presentationProps),{},{percent:q,cornerRadius:typeof u=="string"?parseFloat(u):u,name:M,tooltipPayload:he,midAngle:W,middleRadius:te,tooltipPosition:fe},H),K),{},{value:b,startAngle:U,endAngle:J,payload:H,paddingAngle:oe(h)*E}),_})}return z}function cr(t){var{showLabels:e,sectors:a,children:r}=t,i=o.useMemo(()=>!e||!a?[]:a.map(n=>({value:n.value,payload:n.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:n.cx,cy:n.cy,innerRadius:n.innerRadius,outerRadius:n.outerRadius,startAngle:n.startAngle,endAngle:n.endAngle,clockWise:!1},fill:n.fill})),[a,e]);return o.createElement(Lt,{value:e?i:void 0},r)}function dr(t){var{props:e,previousSectorsRef:a}=t,{sectors:r,isAnimationActive:i,animationBegin:n,animationDuration:u,animationEasing:c,activeShape:p,inactiveShape:f,onAnimationStart:m,onAnimationEnd:g}=e,d=Tt(e,"recharts-pie-"),h=a.current,[v,E]=o.useState(!1),P=o.useCallback(()=>{typeof g=="function"&&g(),E(!1)},[g]),D=o.useCallback(()=>{typeof m=="function"&&m(),E(!0)},[m]);return o.createElement(cr,{showLabels:!v,sectors:r},o.createElement(_t,{animationId:d,begin:n,duration:u,isActive:i,easing:c,onAnimationStart:D,onAnimationEnd:P,key:d},C=>{var T=[],z=r&&r[0],_=z?.startAngle;return r?.forEach((A,L)=>{var b=h&&h[L],M=L>0?Dt(A,"paddingAngle",0):0;if(b){var K=_e(b.endAngle-b.startAngle,A.endAngle-A.startAngle,C),q=w(w({},A),{},{startAngle:_+M,endAngle:_+K+M});T.push(q),_=q.endAngle}else{var{endAngle:U,startAngle:H}=A,J=_e(0,U-H,C),W=w(w({},A),{},{startAngle:_+M,endAngle:_+J+M});T.push(W),_=W.endAngle}}),a.current=T,o.createElement(X,null,o.createElement(or,{sectors:T,activeShape:p,inactiveShape:f,allOtherPieProps:e}))}),o.createElement(nr,{showLabels:!v,sectors:r,props:e}),e.children)}var ur={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!kt.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:Xe.area};function mr(t){var{id:e}=t,a=Se(t,Ga),{hide:r,className:i,rootTabIndex:n}=t,u=o.useMemo(()=>et(t.children,Ne),[t.children]),c=me(m=>qa(m,e,u)),p=o.useRef(null),f=de("recharts-pie",i);return r||c==null?(p.current=null,o.createElement(X,{tabIndex:n,className:f})):o.createElement(tt,{zIndex:t.zIndex},o.createElement(Rt,{fn:Ya,args:w(w({},t),{},{sectors:c})}),o.createElement(X,{tabIndex:n,className:f},o.createElement(dr,{props:w(w({},a),{},{sectors:c}),previousSectorsRef:p})))}function rt(t){var e=ue(t,ur),{id:a}=e,r=Se(e,Ka),i=Qe(r);return o.createElement(St,{id:a,type:"pie"},n=>o.createElement(o.Fragment,null,o.createElement(Ot,{type:"pie",id:n,data:r.data,dataKey:r.dataKey,hide:r.hide,angleAxisId:0,radiusAxisId:0,name:r.name,nameKey:r.nameKey,tooltipType:r.tooltipType,legendType:r.legendType,fill:r.fill,cx:r.cx,cy:r.cy,startAngle:r.startAngle,endAngle:r.endAngle,paddingAngle:r.paddingAngle,minAngle:r.minAngle,innerRadius:r.innerRadius,outerRadius:r.outerRadius,cornerRadius:r.cornerRadius,presentationProps:i,maxRadius:e.maxRadius}),o.createElement(Za,V({},r,{id:n})),o.createElement(mr,V({},r,{id:n}))))}rt.displayName="Pie";var pr=["item"],hr={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},fr=o.forwardRef((t,e)=>{var a=ue(t,hr);return o.createElement(Wt,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:pr,tooltipPayloadSearcher:Gt,categoricalChartProps:a,ref:e})});class vr{async generateStudentReport(e,a=30){const r=new Date;r.setDate(r.getDate()-a);const{data:i}=await N.from("profiles").select("full_name, email").eq("id",e).single(),{data:n}=await N.from("class_members").select("class:classes(id, name, subject)").eq("user_id",e).eq("role","student"),{data:u}=await N.from("submissions").select(`
        grade,
        submitted_at,
        activity:activities(title, max_score, type)
      `).eq("student_id",e).gte("submitted_at",r.toISOString()).not("grade","is",null),c=u?.map(d=>d.grade)||[],p=c.length>0?c.reduce((d,h)=>d+h,0)/c.length:0,f=c.length>0?Math.max(...c):0,m=c.length>0?Math.min(...c):0,g=u?.map(d=>({name:d.activity.title.substring(0,20),value:d.grade}))||[];return{title:`RelatÃ³rio de Desempenho - ${i?.full_name||"Aluno"}`,templateName:"Desempenho Individual (Aluno)",generatedAt:new Date().toISOString(),studentId:e,summary:{totalActivities:u?.length||0,avgGrade:p.toFixed(1),maxGrade:f.toFixed(1),minGrade:m.toFixed(1),totalClasses:n?.length||0},charts:[{title:"Notas por Atividade",type:"bar",data:g},{title:"EvoluÃ§Ã£o do Desempenho",type:"line",data:g}],tables:[{title:"Turmas Inscritas",headers:["Nome","MatÃ©ria"],rows:n?.map(d=>[d.class.name,d.class.subject||"-"])||[]}],details:`RelatÃ³rio gerado para o perÃ­odo de ${a} dias. Total de ${u?.length||0} atividades avaliadas.`}}async generateClassReport(e,a=30){const{data:r}=await N.from("classes").select("name, subject, created_by").eq("id",e).single(),{data:i}=await N.from("class_members").select("user_id, profiles:user_id(full_name)").eq("class_id",e).eq("role","student"),{data:n}=await N.from("activity_class_assignments").select("activity_id, activity:activities(id, title)").eq("class_id",e),u=n?.map(d=>d.activity_id)||[],{data:c}=await N.from("submissions").select("grade, student_id, activity_id").in("activity_id",u).not("grade","is",null),p=c?.map(d=>d.grade)||[],f=p.length>0?p.reduce((d,h)=>d+h,0)/p.length:0,m={"Excelente (90-100)":0,"Bom (70-89)":0,"Regular (50-69)":0,"Insuficiente (0-49)":0};p.forEach(d=>{d>=90?m["Excelente (90-100)"]++:d>=70?m["Bom (70-89)"]++:d>=50?m["Regular (50-69)"]++:m["Insuficiente (0-49)"]++});const g=Object.entries(m).map(([d,h])=>({name:d,value:h}));return{title:`RelatÃ³rio de Turma - ${r?.name||"Turma"}`,templateName:"RelatÃ³rio de Turma",generatedAt:new Date().toISOString(),classId:e,summary:{totalStudents:i?.length||0,totalActivities:n?.length||0,avgGrade:f.toFixed(1),submissionsCount:c?.length||0},charts:[{title:"DistribuiÃ§Ã£o de Notas",type:"pie",data:g}],tables:[{title:"Lista de Alunos",headers:["Nome","SubmissÃµes"],rows:i?.map(d=>{const h=c?.filter(v=>v.student_id===d.user_id).length||0;return[d.profiles.full_name,h]})||[]}],details:`Turma: ${r?.name}
MatÃ©ria: ${r?.subject||"NÃ£o especificada"}
PerÃ­odo: Ãºltimos ${a} dias`}}async generateComparativeReport(e){const{data:a}=await N.from("classes").select("id, name, subject").eq("created_by",e).eq("is_active",!0);a?.map(i=>i.id);const r=await Promise.all(a?.map(async i=>{const{data:n}=await N.from("activity_class_assignments").select("activity_id").eq("class_id",i.id),u=n?.map(m=>m.activity_id)||[],{data:c}=await N.from("submissions").select("grade").in("activity_id",u).not("grade","is",null),p=c?.map(m=>m.grade)||[],f=p.length>0?p.reduce((m,g)=>m+g,0)/p.length:0;return{name:i.name,value:f}})||[]);return{title:"RelatÃ³rio Comparativo de Turmas",templateName:"Comparativo de Desempenho",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,avgGrade:(r.reduce((i,n)=>i+n.value,0)/(r.length||1)).toFixed(1)},charts:[{title:"MÃ©dia por Turma",type:"bar",data:r}],tables:[{title:"Detalhamento por Turma",headers:["Turma","MatÃ©ria","MÃ©dia"],rows:a?.map((i,n)=>[i.name,i.subject||"-",r[n]?.value.toFixed(1)||"0"])||[]}]}}async generateTeacherReport(e){const{data:a}=await N.from("classes").select("id").eq("created_by",e).eq("is_active",!0),{count:r}=await N.from("class_members").select("id",{count:"exact",head:!0}).in("class_id",a?.map(p=>p.id)||[]).eq("role","student"),{data:i}=await N.from("activities").select("id").eq("created_by",e),{data:n}=await N.from("submissions").select("grade").in("activity_id",i?.map(p=>p.id)||[]).not("grade","is",null),u=n?.map(p=>p.grade)||[],c=u.length>0?u.reduce((p,f)=>p+f,0)/u.length:0;return{title:"RelatÃ³rio de Desempenho do Professor",templateName:"Desempenho (Professor)",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,totalStudents:r||0,totalActivities:i?.length||0,avgGrade:c.toFixed(1)},details:"RelatÃ³rio consolidado de todas as turmas e atividades criadas."}}async generateReport(e,a,r={}){switch(e){case"individual-student":return await this.generateStudentReport(a,r.period);case"class-report":return await this.generateClassReport(a,r.period);case"comparative":return await this.generateComparativeReport(a);case"teacher-performance":return await this.generateTeacherReport(a);case"activity-report":return{title:"RelatÃ³rio de Atividade",templateName:"RelatÃ³rio de Atividade",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};case"bulletin":return{title:"Boletim Geral",templateName:"Boletim Geral",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};default:throw new Error("Template de relatÃ³rio nÃ£o encontrado")}}}const gr=new vr,Ge=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],br=({report:t,onClose:e})=>{const{toast:a}=He();if(!t)return null;const r=(i,n)=>{const u=(c,p=16)=>c?.length>p?c.slice(0,p)+"â€¦":c;switch(i){case"bar":return s.jsx(ve,{width:"100%",height:300,children:s.jsxs(Xt,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Le,{strokeDasharray:"3 3"}),s.jsx($e,{dataKey:"name",tickFormatter:c=>u(c),interval:"preserveEnd"}),s.jsx(Ie,{}),s.jsx(ge,{}),s.jsx(le,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Qt,{dataKey:"value",fill:"#3B82F6"})]})});case"line":return s.jsx(ve,{width:"100%",height:300,children:s.jsxs(Kt,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Le,{strokeDasharray:"3 3"}),s.jsx($e,{dataKey:"name",tickFormatter:c=>u(c),interval:"preserveEnd"}),s.jsx(Ie,{}),s.jsx(ge,{}),s.jsx(le,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Vt,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2})]})});case"pie":return s.jsx(ve,{width:"100%",height:300,children:s.jsxs(fr,{children:[s.jsx(rt,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:c=>`${u(c.name)}: ${c.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((c,p)=>s.jsx(Ne,{fill:Ge[p%Ge.length]},`cell-${p}`))}),s.jsx(ge,{}),s.jsx(le,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}})]})});default:return null}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 overflow-auto",children:s.jsxs(G,{className:"w-full max-w-6xl max-h-[90vh] overflow-auto bg-white dark:bg-slate-900",children:[s.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between z-10",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t.title||t.templateName}),s.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Gerado em ",new Date(t.generatedAt).toLocaleString("pt-BR")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{try{if(t.tables&&t.tables.length>0){const p=t.tables[0],m=[(p.headers||[]).join(",")];(p.rows||[]).forEach(P=>{const D=P.map(C=>{const T=typeof C=="object"?JSON.stringify(C):String(C??"");return/[",\n]/.test(T)?'"'+T.replace(/"/g,'""')+'"':T}).join(",");m.push(D)});const g=m.join(`
`),d=new Blob([g],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(d),v=document.createElement("a"),E=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");v.href=h,v.download=`${E}-${Date.now()}.csv`,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(h),a({title:"Exportado (CSV)",description:"Arquivo CSV baixado com sucesso."});return}const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),u=document.createElement("a"),c=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");u.href=n,u.download=`${c}-${Date.now()}.json`,document.body.appendChild(u),u.click(),u.remove(),URL.revokeObjectURL(n),a({title:"Exportado (JSON)",description:"Arquivo JSON baixado com sucesso."})}catch{a({variant:"destructive",title:"Falha na exportaÃ§Ã£o",description:"Tente novamente."})}},children:[s.jsx(ut,{className:"w-4 h-4 mr-2"}),"Exportar"]}),s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{try{window.print()}catch{a({variant:"destructive",title:"Falha ao imprimir",description:"Tente novamente."})}},children:[s.jsx(mt,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),s.jsxs(R,{variant:"outline",size:"sm",onClick:async()=>{try{const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),u=t.title||t.templateName||"RelatÃ³rio";navigator.share?await navigator.share({title:u,text:u,url:n}):(await navigator.clipboard.writeText(n),a({title:"Link copiado",description:"Link do relatÃ³rio copiado para a Ã¡rea de transferÃªncia."}))}catch{a({variant:"destructive",title:"Falha ao compartilhar",description:"Tente novamente."})}},children:[s.jsx(ht,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),s.jsx(R,{variant:"ghost",size:"sm",onClick:e,children:s.jsx(We,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[t.summary&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(t.summary).map(([i,n])=>s.jsxs(G,{className:"p-4",children:[s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:i.replace(/([A-Z])/g," $1").trim()}),s.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white mt-1",children:typeof n=="number"?n.toFixed(1):n})]},i))}),t.charts&&t.charts.map((i,n)=>s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),r(i.type,i.data)]},n)),t.tables&&t.tables.map((i,n)=>s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:i.headers.map((u,c)=>s.jsx("th",{className:"text-left p-2 font-semibold",children:u},c))})}),s.jsx("tbody",{children:i.rows.map((u,c)=>s.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:u.map((p,f)=>s.jsx("td",{className:"p-2",children:p},f))},c))})]})})]},n)),t.details&&s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detalhes"}),s.jsx("div",{className:"prose dark:prose-invert max-w-none",children:t.details})]})]})]})})};class xr{constructor(){this.enabled=!1,this.url="https://comic-mudfish-15106.upstash.io",this.token="ATsCAAIncDIxMzViNjFkMDQ0Zjk0NGU3YTljYjlhNTM2YTRhZDM1NXAyMTUxMDY",this.url&&this.token?(this.enabled=!0,console.log("[Cache] âœ… Upstash Redis configurado")):(console.warn("[Cache] âš ï¸  Upstash Redis nÃ£o configurado - cache desabilitado"),console.warn("[Cache] Configure VITE_UPSTASH_REDIS_REST_URL e VITE_UPSTASH_REDIS_REST_TOKEN"))}async get(e){if(!this.enabled)return null;try{const a=await fetch(`${this.url}/get/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(r.result===null)return console.log(`[Cache] âŒ Miss: ${e}`),null;console.log(`[Cache] âœ… Hit: ${e}`);try{return JSON.parse(r.result)}catch{return r.result}}catch(a){return console.error(`[Cache] Erro ao buscar ${e}:`,a),null}}async set(e,a,r=300){if(!this.enabled)return!1;try{const i=typeof a=="string"?a:JSON.stringify(a),n=await fetch(`${this.url}/set/${encodeURIComponent(e)}/${encodeURIComponent(i)}?EX=${r}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return console.log(`[Cache] ðŸ’¾ Saved: ${e} (TTL: ${r}s)`),!0}catch(i){return console.error(`[Cache] Erro ao salvar ${e}:`,i),!1}}async del(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/del/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return console.log(`[Cache] ðŸ—‘ï¸  Deleted: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao deletar ${e}:`,a),!1}}async invalidatePattern(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/keys/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=(await a.json()).result||[];if(i.length===0)return console.log(`[Cache] ðŸ” No keys found for pattern: ${e}`),!0;const n=i.map(u=>this.del(u));return await Promise.all(n),console.log(`[Cache] ðŸ§¹ Invalidated ${i.length} keys matching: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao invalidar padrÃ£o ${e}:`,a),!1}}async remember(e,a,r=300){const i=await this.get(e);if(i!==null)return i;const n=await a();return await this.set(e,n,r),n}async flush(){if(!this.enabled)return!1;try{const e=await fetch(`${this.url}/flushdb`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return console.log("[Cache] ðŸš¨ Cache completamente limpo (FLUSH)"),!0}catch(e){return console.error("[Cache] Erro ao limpar cache:",e),!1}}getStatus(){return{enabled:this.enabled,hasCredentials:!!(this.url&&this.token),url:this.url?this.url.replace(/https?:\/\//,"").split(".")[0]+"...":"nÃ£o configurado"}}}const Ke=new xr,Ve=[{id:"individual-student",name:"RelatÃ³rio Individual de Aluno",description:"RelatÃ³rio completo de um aluno especÃ­fico",icon:aa,color:"from-blue-500 to-cyan-500",includes:["Dados pessoais","HistÃ³rico de notas","FrequÃªncia","Feedbacks recebidos","GrÃ¡ficos de evoluÃ§Ã£o","AnÃ¡lise de desempenho"],usage:"ReuniÃ£o com pais, coordenaÃ§Ã£o",popular:!0},{id:"class-report",name:"RelatÃ³rio de Turma",description:"AnÃ¡lise completa de uma turma",icon:ra,color:"from-purple-500 to-pink-500",includes:["EstatÃ­sticas gerais","DistribuiÃ§Ã£o de notas","Taxa de aprovaÃ§Ã£o/reprovaÃ§Ã£o","MÃ©dia da turma","Alunos em destaque","Ãreas de atenÃ§Ã£o"],usage:"Fechamento de semestre, relatÃ³rios institucionais",popular:!0},{id:"comparative",name:"RelatÃ³rio Comparativo",description:"ComparaÃ§Ã£o entre mÃºltiplas turmas",icon:pa,color:"from-orange-500 to-red-500",includes:["Tabela comparativa","GrÃ¡ficos lado a lado","AnÃ¡lise de diferenÃ§as","Melhores prÃ¡ticas identificadas"],usage:"AnÃ¡lise pedagÃ³gica, ajustes metodolÃ³gicos"},{id:"activity-report",name:"RelatÃ³rio de Atividade",description:"AnÃ¡lise de uma atividade especÃ­fica",icon:sa,color:"from-green-500 to-teal-500",includes:["EstatÃ­sticas de submissÃ£o","DistribuiÃ§Ã£o de notas","QuestÃµes mais erradas","Tempo mÃ©dio de resoluÃ§Ã£o","Lista de notas por aluno"],usage:"ValidaÃ§Ã£o de atividade, ajustes"},{id:"bulletin",name:"Boletim (PerÃ­odo)",description:"Boletim formal por perÃ­odo",icon:je,color:"from-indigo-500 to-purple-500",includes:["Notas por disciplina","MÃ©dias parciais e finais","FrequÃªncia","ObservaÃ§Ãµes do professor","Assinatura"],usage:"Entrega oficial para instituiÃ§Ã£o/pais",popular:!0},{id:"teacher-performance",name:"RelatÃ³rio de Desempenho (Professor)",description:"Auto-avaliaÃ§Ã£o do professor",icon:ca,color:"from-yellow-500 to-orange-500",includes:["Atividades postadas","CorreÃ§Ãµes realizadas","Tempo mÃ©dio de feedback","SatisfaÃ§Ã£o dos alunos","EvoluÃ§Ã£o das turmas"],usage:"AvaliaÃ§Ã£o institucional, portfÃ³lio"}],ps=()=>{const{user:t}=ot(),{toast:e}=He(),[a,r]=o.useState(!1),[i,n]=o.useState("templates"),[u,c]=o.useState([]),[p,f]=o.useState(!1),[m,g]=o.useState(null),[d,h]=o.useState(null),[v,E]=o.useState(null),[P,D]=o.useState(null),[C,T]=o.useState("30"),[z,_]=o.useState([]),[A,L]=o.useState([]),[b,M]=o.useState(""),[K,q]=o.useState(!1);o.useEffect(()=>{U(),H()},[t]);const U=async()=>{if(t)try{const{data:l,error:x}=await N.from("report_history").select(`
          id,
          template_id,
          template_name,
          filter_type,
          student_id,
          class_id,
          activity_id,
          period,
          created_at,
          report_data
        `).eq("teacher_id",t.id).order("created_at",{ascending:!1}).limit(20);if(x)throw x;c(l||[]),console.log(`âœ… [Reports] ${l?.length||0} relatÃ³rios carregados do histÃ³rico`)}catch(l){F.error("Erro ao carregar histÃ³rico:",l),c([])}},H=async()=>{if(t)try{q(!0);const l=`teacher:reports:data:${t.id}:${C}`,x=await Ke.get(l);if(x){console.log("âœ… [Reports] Dados carregados do cache"),L(x.classes||[]),_(x.students||[]),q(!1);return}console.log("ðŸ”„ [Reports] Buscando dados do banco...");const{data:S,error:k}=await N.from("classes").select("id, name, subject").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(k)throw k;L(S||[]);const{data:y,error:j}=await N.from("class_members").select(`
          user_id,
          profile:profiles!class_members_user_id_fkey(id, full_name, email),
          class:classes!class_members_class_id_fkey(id, name)
        `).in("class_id",S?.map(I=>I.id)||[]).eq("role","student");if(j)throw j;const O=[],Z=new Set;y?.forEach(I=>{I.profile&&!Z.has(I.profile.id)&&(Z.add(I.profile.id),O.push({id:I.profile.id,name:I.profile.full_name,email:I.profile.email,className:I.class?.name}))}),_(O),await Ke.set(l,{classes:S||[],students:O},300),console.log("ðŸ’¾ [Reports] Dados salvos no cache (TTL: 5min)")}catch(l){F.error("Erro ao carregar dados:",l),e({title:"Erro ao carregar dados",description:l.message,variant:"destructive"})}finally{q(!1)}},J=l=>l==="comparative"?!1:!!(b==="student"&&["class-report"].includes(l)||b==="class"&&["individual-student"].includes(l)||P&&l!=="activity-report"),W=async l=>{if(l!=="comparative"){if(!b){e({title:"Selecione o escopo do relatÃ³rio",description:"Escolha se deseja gerar para um aluno, turma ou todos os alunos.",variant:"destructive"});return}if(b==="student"&&!d){e({title:"Selecione um aluno",description:"Escolha qual aluno vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}if(b==="class"&&!v){e({title:"Selecione uma turma",description:"Escolha qual turma vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}}f(!0),g(null);try{let x=t?.id;const S=Ve.find(y=>y.id===l);if(e({title:`ðŸ“Š Gerando ${S?.name||"RelatÃ³rio"}`,description:"Processando dados... Aguarde."}),b==="student"&&d)x=d;else if(b==="class"&&v)x=v;else if(l==="class-report")if(v)x=v;else{const{data:y}=await N.from("classes").select("id, is_active").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(!y||y.length===0)throw new Error("Nenhuma turma ativa encontrada para gerar o relatÃ³rio.");x=y[0].id}const k=await gr.generateReport(l,x,{period:parseInt(C),includeArchived:!1,filterType:b,studentId:d,classId:v,activityId:P});g(k),e({title:"âœ… RelatÃ³rio Gerado",description:`${k.templateName} gerado com sucesso!`});try{const{error:y}=await N.from("report_history").insert({teacher_id:t.id,template_id:l,template_name:S?.name||"RelatÃ³rio",filter_type:b||null,student_id:d||null,class_id:v||null,activity_id:P||null,period:parseInt(C),report_data:k});y?F.error("Erro ao salvar histÃ³rico:",y):console.log("âœ… RelatÃ³rio salvo no histÃ³rico")}catch(y){F.error("Erro ao salvar histÃ³rico:",y)}c(y=>[{id:Date.now(),templateId:l,templateName:S?.name,generatedAt:new Date().toISOString(),cached:!1,filterType:b,studentId:d,classId:v},...y.slice(0,9)])}catch(x){F.error("Erro ao gerar relatÃ³rio:",x),e({title:"Erro",description:x.message||"NÃ£o foi possÃ­vel gerar o relatÃ³rio",variant:"destructive"})}finally{f(!1)}},te=()=>{n("history")},he=()=>{e({title:"Em desenvolvimento",description:"Gerenciamento de templates serÃ¡ implementado em breve"})},fe=l=>{if(!l)return null;if(Array.isArray(l))return l;if(Array.isArray(l?.rows))return l.rows;if(Array.isArray(l?.data))return l.data;if(Array.isArray(l?.items))return l.items;const x=Object.values(l).find(S=>Array.isArray(S));return Array.isArray(x)?x:[l]},st=l=>{if(!l||l.length===0)return"";const x=Array.from(l.reduce((j,O)=>(Object.keys(O||{}).forEach(Z=>j.add(Z)),j),new Set)),S=j=>{if(j==null)return"";const O=typeof j=="object"?JSON.stringify(j):String(j);return/[",\n]/.test(O)?'"'+O.replace(/"/g,'""')+'"':O},k=x.map(S).join(","),y=l.map(j=>x.map(O=>S(j?.[O])).join(","));return[k,...y].join(`
`)},Oe=(l,x,S)=>{const k=new Blob([l],{type:S}),y=URL.createObjectURL(k),j=document.createElement("a");j.href=y,j.download=x,document.body.appendChild(j),j.click(),j.remove(),URL.revokeObjectURL(y)},it=()=>{if(!m){e({title:"Nenhum relatÃ³rio para exportar",description:"Gere um relatÃ³rio primeiro.",variant:"destructive"});return}try{const l=fe(m).map(k=>{const y={};return Object.entries(k||{}).forEach(([j,O])=>{O&&typeof O=="object"&&!Array.isArray(O)?Object.entries(O).forEach(([Z,I])=>{y[`${j}.${Z}`]=I}):y[j]=O}),y}),x=st(l);if(!x)throw new Error("NÃ£o hÃ¡ dados tabulares para exportar");const S=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Oe(x,`${S}-${Date.now()}.csv`,"text/csv;charset=utf-8;"),e({title:"Exportado com sucesso",description:"Arquivo CSV baixado."})}catch(l){F.warn("CSV export fallback to JSON:",l);const x=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Oe(JSON.stringify(m,null,2),`${x}-${Date.now()}.json`,"application/json"),e({title:"Exportado como JSON",description:"NÃ£o foi possÃ­vel gerar CSV. Baixamos o JSON.",variant:"destructive"})}};return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[s.jsx(dt,{title:"RelatÃ³rios",subtitle:"Gere relatÃ³rios formais e exportÃ¡veis",role:"teacher",actions:s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(R,{variant:"outline",onClick:te,children:[s.jsx(Fe,{className:"w-4 h-4 mr-2"}),"HistÃ³rico"]}),s.jsxs(R,{variant:"outline",onClick:he,children:[s.jsx(ea,{className:"w-4 h-4 mr-2"}),"Templates"]}),s.jsxs(R,{onClick:()=>e({title:"Selecione um template abaixo"}),children:[s.jsx(be,{className:"w-4 h-4 mr-2"}),"Novo RelatÃ³rio"]})]})}),s.jsx(G,{className:"mt-6 p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:s.jsx(ta,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-900 dark:text-blue-100",children:"Selecione o Escopo do RelatÃ³rio"}),s.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Escolha para quem deseja gerar o relatÃ³rio antes de selecionar um template"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(ae,{className:"text-sm font-medium mb-2 block",children:"Tipo de RelatÃ³rio"}),s.jsxs(re,{value:b,onValueChange:M,children:[s.jsx(se,{className:"bg-white dark:bg-slate-900",children:s.jsx(ie,{placeholder:"Selecione o tipo..."})}),s.jsxs(ne,{children:[s.jsx(B,{value:"student",children:"Aluno EspecÃ­fico"}),s.jsx(B,{value:"class",children:"Turma Completa"}),s.jsx(B,{value:"all",children:"Todos os Alunos"})]})]})]}),b==="student"&&s.jsxs("div",{children:[s.jsx(ae,{className:"text-sm font-medium mb-2 block",children:"Selecionar Aluno"}),s.jsxs(re,{value:d||"",onValueChange:h,children:[s.jsx(se,{className:"bg-white dark:bg-slate-900",children:s.jsx(ie,{placeholder:"Escolha um aluno..."})}),s.jsx(ne,{children:z.map(l=>s.jsxs(B,{value:l.id,children:[l.name," ",l.className&&`(${l.className})`]},l.id))})]})]}),b==="class"&&s.jsxs("div",{children:[s.jsx(ae,{className:"text-sm font-medium mb-2 block",children:"Selecionar Turma"}),s.jsxs(re,{value:v||"",onValueChange:E,children:[s.jsx(se,{className:"bg-white dark:bg-slate-900",children:s.jsx(ie,{placeholder:"Escolha uma turma..."})}),s.jsx(ne,{children:A.map(l=>s.jsxs(B,{value:l.id,children:[l.name," ",l.subject&&`- ${l.subject}`]},l.id))})]})]}),s.jsxs("div",{children:[s.jsx(ae,{className:"text-sm font-medium mb-2 block",children:"PerÃ­odo"}),s.jsxs(re,{value:C,onValueChange:T,children:[s.jsx(se,{className:"bg-white dark:bg-slate-900",children:s.jsx(ie,{})}),s.jsxs(ne,{children:[s.jsx(B,{value:"7",children:"Ãšltimos 7 dias"}),s.jsx(B,{value:"30",children:"Ãšltimos 30 dias"}),s.jsx(B,{value:"90",children:"Ãšltimos 90 dias"}),s.jsx(B,{value:"180",children:"Ãšltimos 6 meses"}),s.jsx(B,{value:"365",children:"Ãšltimo ano"})]})]})]})]}),b&&s.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[s.jsx("strong",{children:"Filtro ativo:"})," ",b==="student"?`Aluno - ${z.find(l=>l.id===d)?.name||"Selecione"}`:b==="class"?`Turma - ${A.find(l=>l.id===v)?.name||"Selecione"}`:"Todos os alunos"]}),s.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>{M(""),h(null),E(null)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[s.jsx(We,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]})]})}),s.jsxs(lt,{value:i,onValueChange:n,className:"mt-6",children:[s.jsxs(ct,{className:"grid w-full max-w-md grid-cols-2",children:[s.jsx(Ce,{value:"templates",children:"Templates"}),s.jsx(Ce,{value:"history",children:"HistÃ³rico"})]}),s.jsxs(Re,{value:"templates",className:"mt-6",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ve.map((l,x)=>{const S=l.icon,k=J(l.id);return s.jsx(ia.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},style:{pointerEvents:"auto"},children:s.jsxs(G,{className:`p-6 h-full flex flex-col hover:shadow-lg transition-shadow relative ${k?"opacity-50":""}`,style:{pointerEvents:"auto"},children:[s.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${l.color} opacity-5 group-hover:opacity-10 transition-opacity`}),l.popular&&s.jsxs(ke,{className:"absolute top-4 right-4 bg-yellow-500 text-white",children:[s.jsx(na,{className:"w-3 h-3 mr-1"}),"Popular"]}),s.jsx("div",{className:"mb-4 relative z-10",children:s.jsx("div",{className:`inline-flex p-3 rounded-xl bg-gradient-to-r ${l.color}`,children:s.jsx(S,{className:"w-6 h-6 text-white"})})}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:l.name}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:l.description}),s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-2",children:"Inclui:"}),s.jsxs("ul",{className:"space-y-1",children:[l.includes.slice(0,3).map((y,j)=>s.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-center",children:[s.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mr-2"}),y]},j)),l.includes.length>3&&s.jsxs("li",{className:"text-xs text-blue-600 dark:text-blue-400",children:["+",l.includes.length-3," mais..."]})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx(ke,{variant:"outline",className:"text-xs",children:l.usage})}),s.jsxs("div",{className:"flex gap-2 mt-auto pt-4 relative z-50",children:[s.jsxs(R,{className:`flex-1 bg-gradient-to-r ${l.color} text-white hover:opacity-90`,onClick:()=>{if(k){e({title:"Template incompatÃ­vel",description:"Este template nÃ£o Ã© compatÃ­vel com os filtros selecionados.",variant:"destructive"});return}F.debug("BotÃ£o Gerar clicado:",l.id),W(l.id)},disabled:k,children:[s.jsx(be,{className:"w-4 h-4 mr-2"}),"Gerar"]}),s.jsx(R,{variant:"outline",size:"icon",onClick:()=>{F.debug("BotÃ£o Preview clicado"),e({title:"Preview",description:"VisualizaÃ§Ã£o serÃ¡ implementada"})},children:s.jsx(oa,{className:"w-4 h-4"})})]})]})},l.id)})}),s.jsxs(G,{className:"mt-8 p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Formatos de ExportaÃ§Ã£o"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-red-50 hover:border-red-300 dark:hover:bg-red-950/20",onClick:()=>{F.debug("Exportar PDF clicado"),e({title:"Exportar PDF",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(je,{className:"w-8 h-8 mb-2 text-red-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PDF"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-green-50 hover:border-green-300 dark:hover:bg-green-950/20",onClick:it,children:[s.jsx(pt,{className:"w-8 h-8 mb-2 text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Excel"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20",onClick:()=>{F.debug("Exportar Word clicado"),e({title:"Exportar Word",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(je,{className:"w-8 h-8 mb-2 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Word"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-purple-50 hover:border-purple-300 dark:hover:bg-purple-950/20",onClick:()=>{F.debug("Exportar PNG clicado"),e({title:"Exportar PNG",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(ua,{className:"w-8 h-8 mb-2 text-purple-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PNG"})]})]})]})]}),s.jsx(Re,{value:"history",className:"mt-6",children:s.jsx(G,{className:"p-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx(Fe,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:"Nenhum relatÃ³rio gerado ainda"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"RelatÃ³rios que vocÃª gerar aparecerÃ£o aqui para fÃ¡cil acesso"}),s.jsxs(R,{onClick:()=>n("templates"),children:[s.jsx(be,{className:"w-4 h-4 mr-2"}),"Gerar Primeiro RelatÃ³rio"]})]})})})]}),m&&s.jsx(br,{report:m,onClose:()=>g(null)})]})};export{ps as default};
