import{r as l,s as $,l as E,j as e,p as Q,a as ae,g as le}from"./main-CQL62Pt9.js";import{C as U}from"./card-CeKCmDnl.js";import{B as w,m as G}from"./button-CXd9Ydu2.js";import{t as D}from"./use-toast-Djw8A-a9.js";import{r as K}from"./redisCache-Dwe5c7D9.js";import{X as Z}from"./x-Q__6dFVj.js";import{B as re,C as ie}from"./chevron-right-CC_eXMfz.js";import{F as oe}from"./file-text-0rRUQINA.js";import{U as ne}from"./users-BtfqzUVv.js";import{C as I,A as de}from"./index-zZOcwNkD.js";import{S as ce}from"./save-sETwFI3G.js";import{f as b}from"./format-BcFT9btV.js";import{E as me}from"./EventDetailsModal-CC5vDix3.js";import{F as ue}from"./funnel-CzAWABqr.js";import{s as J,a as xe,i as be}from"./isSameMonth-CK0W24Ro.js";import{e as W}from"./endOfMonth-BD-g1yyK.js";import{s as pe,e as he}from"./subMonths-CphOl_Aj.js";import{P as Y}from"./plus-CaXgjLmQ.js";import{C as ge}from"./SidebarPremium--x3DStDs.js";import{i as ve}from"./isToday-By0hfvNN.js";import{p as H}from"./pt-BR-CuGSKEGQ.js";import"./en-US-B6HbAA6N.js";import"./clock-sqyMS1RB.js";import"./map-pin-BSh05kW8.js";import"./user-DAj5MP6f.js";import"./video-BREjiski.js";import"./square-pen-CbR7RYpw.js";import"./copy-h-QjC0o2.js";import"./trash-2-Cxkxlzod.js";import"./bell-CU7gBYYE.js";import"./trending-up-CC7Upw_D.js";import"./settings-Dvldtua5.js";import"./house-Dxla3ep4.js";import"./graduation-cap-BjoHLR7H.js";import"./chart-column-BKLyUAC0.js";import"./constructNow-re94FRT2.js";import"./isSameDay-D5LInQhv.js";const ye=({isOpen:i,onClose:n,onSuccess:h,selectedDate:f,teacherId:g})=>{const[j,u]=l.useState(!1),[_,M]=l.useState([]),[v,k]=l.useState([]),[r,N]=l.useState([]),[C,T]=l.useState(!1),[t,d]=l.useState({title:"",description:"",type:"event",start_date:f?b(f,"yyyy-MM-dd"):b(new Date,"yyyy-MM-dd"),start_time:"08:00",end_time:"09:00",modality:"online",meeting_link:"",location:"",selected_classes:[],selected_students:[],invite_type:"all",color:"#3B82F6",activity_id:null});l.useEffect(()=>{z(),B()},[g]),l.useEffect(()=>{t.selected_classes.length>0&&t.invite_type==="individuals"?A():k([])},[t.selected_classes,t.invite_type]);const z=async()=>{try{const{data:s}=await $.from("classes").select("id, name").eq("created_by",g).eq("is_active",!0).order("name");M(s||[])}catch(s){E.error("Erro ao carregar turmas:",s)}},B=async()=>{try{const{data:s}=await $.from("activities").select("id, title, type, status").eq("created_by",g).neq("status","archived").order("created_at",{ascending:!1}).limit(50);N(s||[])}catch(s){E.error("Erro ao carregar atividades:",s)}},A=async()=>{try{T(!0);const{data:s,error:o}=await $.from("class_members").select(`
          user_id,
          class_id,
          profile:profiles!class_members_user_id_fkey(
            id,
            full_name,
            email,
            avatar_url
          )
        `).in("class_id",t.selected_classes).eq("role","student");if(o)throw o;const c=(s||[]).map(x=>({id:x.profile.id,name:x.profile.full_name||x.profile.email,email:x.profile.email,avatar:x.profile.avatar_url,classId:x.class_id})),p=Array.from(new Map(c.map(x=>[x.id,x])).values());k(p)}catch(s){E.error("Erro ao carregar alunos:",s),D({title:"Erro ao carregar alunos",description:s.message,variant:"destructive"})}finally{T(!1)}},S=async s=>{if(s.preventDefault(),!t.title.trim()){D({title:"Erro de validaÃ§Ã£o",description:"O tÃ­tulo Ã© obrigatÃ³rio.",variant:"destructive"});return}if(t.modality==="online"&&!t.meeting_link.trim()){D({title:"Erro de validaÃ§Ã£o",description:"Link da reuniÃ£o Ã© obrigatÃ³rio para eventos online.",variant:"destructive"});return}try{u(!0);const o=new Date(`${t.start_date}T${t.start_time}`),c=new Date(`${t.start_date}T${t.end_time}`);let p=null;t.type==="meeting"&&t.invite_type==="individuals"&&(p=t.selected_students);const x=t.selected_classes.length>0?t.selected_classes.map(P=>({title:t.title,description:t.description,type:t.type,start_time:o.toISOString(),end_time:c.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,class_id:P,attendees:p,color:t.color,activity_id:t.activity_id||null})):[{title:t.title,description:t.description,type:t.type,start_time:o.toISOString(),end_time:c.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,attendees:p,color:t.color,activity_id:t.activity_id||null}],{error:q}=await $.from("calendar_events").insert(x);if(q)throw E.error("Erro ao criar evento:",q),new Error(q.message||"Erro ao criar evento no banco de dados");const V=b(o,"yyyy-MM");await K.deletePattern(`calendar:${g}:*`);const F=x.length;D({title:"âœ… Evento criado com sucesso!",description:F>1?`${F} eventos criados para diferentes turmas`:`${t.title} foi adicionado ao calendÃ¡rio`}),h&&h(),n()}catch(o){E.error("Erro ao criar evento:",o),D({title:"âŒ Erro ao criar evento",description:o.message||"NÃ£o foi possÃ­vel criar o evento. Tente novamente.",variant:"destructive"})}finally{u(!1)}},y=[{value:"event",label:"Aula",icon:re,color:"blue"},{value:"activity",label:"Atividade",icon:oe,color:"orange"},{value:"meeting",label:"ReuniÃ£o",icon:ne,color:"purple"},{value:"deadline",label:"Prazo",icon:I,color:"red"}];return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Novo Evento"}),e.jsx("button",{onClick:n,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:S,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Tipo de Evento"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:y.map(s=>{const o=s.icon,c=t.type===s.value;return e.jsxs("button",{type:"button",onClick:()=>d({...t,type:s.value}),className:`p-4 rounded-lg border-2 transition-all ${c?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:[e.jsx(o,{className:`w-6 h-6 mx-auto mb-2 ${c?"text-blue-600":"text-slate-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.value)})})]}),t.type==="activity"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Vincular Atividade"}),e.jsxs("select",{value:t.activity_id||"",onChange:s=>{const o=s.target.value||null,c=r.find(p=>p.id===o);d({...t,activity_id:o,title:c?c.title:t.title})},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Nenhuma atividade vinculada"}),r.map(s=>e.jsxs("option",{value:s.id,children:[s.title," (",s.type,")"]},s.id))]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Vincule uma atividade existente a este evento de agenda"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"TÃ­tulo *"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>d({...t,title:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Aula de MatemÃ¡tica",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:t.description,onChange:s=>d({...t,description:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Detalhes do evento..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Data *"}),e.jsx("input",{type:"date",value:t.start_date,onChange:s=>d({...t,start_date:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"InÃ­cio *"}),e.jsx("input",{type:"time",value:t.start_time,onChange:s=>d({...t,start_time:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Fim *"}),e.jsx("input",{type:"time",value:t.end_time,onChange:s=>d({...t,end_time:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]})]}),t.type==="meeting"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Convidar"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>d({...t,invite_type:"all",selected_classes:[],selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="all"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸ“¢ Todos"}),e.jsx("button",{type:"button",onClick:()=>d({...t,invite_type:"classes",selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="classes"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸŽ“ Por Turma"}),e.jsx("button",{type:"button",onClick:()=>d({...t,invite_type:"individuals"}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="individuals"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"ðŸ‘¤ Individual"})]})]}),(t.type==="event"||t.type==="activity"||t.type==="meeting"&&(t.invite_type==="classes"||t.invite_type==="individuals"))&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Turmas ",t.invite_type==="individuals"&&"(selecione para filtrar alunos)"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:_.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhuma turma encontrada"}):_.map(s=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_classes.includes(s.id),onChange:o=>{const c=o.target.checked?[...t.selected_classes,s.id]:t.selected_classes.filter(p=>p!==s.id);d({...t,selected_classes:c})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))})]}),t.type==="meeting"&&t.invite_type==="individuals"&&t.selected_classes.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Selecionar Alunos (",t.selected_students.length," selecionados)"]}),C?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Q,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-slate-500",children:"Carregando alunos..."})]}):e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:v.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhum aluno encontrado nas turmas selecionadas"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-slate-900 pb-2 border-b border-slate-200 dark:border-slate-700",children:e.jsx("button",{type:"button",onClick:()=>{const s=v.every(o=>t.selected_students.includes(o.id));d({...t,selected_students:s?[]:v.map(o=>o.id)})},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:v.every(s=>t.selected_students.includes(s.id))?"Desmarcar todos":"Selecionar todos"})}),v.map(s=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_students.includes(s.id),onChange:o=>{const c=o.target.checked?[...t.selected_students,s.id]:t.selected_students.filter(p=>p!==s.id);d({...t,selected_students:c})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.email})]})]})]},s.id))]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Modalidade"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"online",checked:t.modality==="online",onChange:s=>d({...t,modality:s.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Online"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"presential",checked:t.modality==="presential",onChange:s=>d({...t,modality:s.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Presencial"})]})]})]}),t.modality==="online"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Link da ReuniÃ£o *"}),e.jsx("input",{type:"url",value:t.meeting_link,onChange:s=>d({...t,meeting_link:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"https://meet.google.com/...",required:!0})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Local"}),e.jsx("textarea",{value:t.location,onChange:s=>d({...t,location:s.target.value}),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Sala 203, Bloco B"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(w,{type:"button",variant:"outline",onClick:n,disabled:j,className:"flex-1",children:"Cancelar"}),e.jsx(w,{type:"submit",disabled:j,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:"sm",className:"mr-2"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Criar Evento"]})})]})]})]})}):null},fe=({filters:i,setFilters:n,teacherId:h})=>{const[f,g]=l.useState([]);l.useEffect(()=>{j()},[h]);const j=async()=>{try{const{data:r}=await $.from("classes").select("id, name").eq("created_by",h).eq("is_active",!0).order("name");g(r||[])}catch(r){E.error("Erro ao carregar turmas:",r)}},u=[{value:"class",label:"Aulas",color:"blue"},{value:"exam",label:"Provas",color:"red"},{value:"meeting",label:"ReuniÃµes",color:"purple"},{value:"personal",label:"Pessoal",color:"gray"}],_=r=>{const N=i.types.includes(r)?i.types.filter(C=>C!==r):[...i.types,r];n({...i,types:N})},M=r=>{const N=i.classes.includes(r)?i.classes.filter(C=>C!==r):[...i.classes,r];n({...i,classes:N})},v=()=>{n({types:[],classes:[],modality:"all"})},k=i.types.length>0||i.classes.length>0||i.modality!=="all";return e.jsxs(U,{className:"p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Filtros"]}),k&&e.jsx(w,{variant:"ghost",size:"sm",onClick:v,children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Tipo de Evento"}),e.jsx("div",{className:"space-y-2",children:u.map(r=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:i.types.includes(r.value),onChange:()=>_(r.value),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:r.label})]},r.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Turmas"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:f.map(r=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:i.classes.includes(r.id),onChange:()=>M(r.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:r.name})]},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Modalidade"}),e.jsxs("select",{value:i.modality,onChange:r=>n({...i,modality:r.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 text-sm",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"presential",children:"Presencial"})]})]})]})},ee=le.memo(({day:i,dayEvents:n,isCurrentDay:h,isSameMonthDay:f,onClick:g,onEventClick:j})=>e.jsxs(G.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},onClick:g,className:`
        min-h-[120px] p-3 border rounded-xl cursor-pointer transition-all hover:shadow-lg group relative
        ${h?"border-2 border-blue-600 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 shadow-md":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}
        ${!f&&"opacity-40"}
        hover:bg-gradient-to-br hover:from-slate-50 hover:to-blue-50 dark:hover:from-slate-800 dark:hover:to-blue-950/30
      `,children:[e.jsxs("div",{className:`
        text-sm font-bold mb-2 flex items-center justify-between
        ${h?"text-blue-600":"text-slate-900 dark:text-white"}
      `,children:[e.jsx("span",{children:b(i,"d")}),n.length>0&&e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-600 text-white text-xs flex items-center justify-center",children:n.length})]}),e.jsxs("div",{className:"space-y-1.5",children:[n.slice(0,2).map(u=>e.jsx("div",{onClick:_=>{_.stopPropagation(),j(u)},className:`
              text-xs px-2 py-1.5 rounded-lg truncate font-medium shadow-sm transition-all
              ${u.type==="event"&&"bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 dark:from-blue-900 dark:to-blue-800 dark:text-blue-200 hover:shadow-md"}
              ${u.type==="activity"&&"bg-gradient-to-r from-orange-100 to-orange-200 text-orange-800 dark:from-orange-900 dark:to-orange-800 dark:text-orange-200 hover:shadow-md"}
              ${u.type==="meeting"&&"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 dark:from-purple-900 dark:to-purple-800 dark:text-purple-200 hover:shadow-md"}
              ${u.type==="deadline"&&"bg-gradient-to-r from-red-100 to-red-200 text-red-800 dark:from-red-900 dark:to-red-800 dark:text-red-200 hover:shadow-md"}
              hover:scale-105
            `,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:b(new Date(u.start_time),"HH:mm")}),e.jsx("span",{className:"truncate",children:u.title})]})},u.id)),n.length>2&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 px-2 py-1 bg-blue-50 dark:bg-blue-950/30 rounded-lg font-medium",children:["+",n.length-2," evento",n.length-2>1?"s":""]})]})]}));ee.displayName="CalendarDay";const lt=()=>{const{user:i}=ae(),[n,h]=l.useState(new Date),[f,g]=l.useState([]),[j,u]=l.useState([]),[_,M]=l.useState(!0),[v,k]=l.useState(!1),[r,N]=l.useState(!1),[C,T]=l.useState(null),[t,d]=l.useState(null),[z,B]=l.useState([]),[A,S]=l.useState(!1),[y,s]=l.useState({types:[],classes:[],modality:"all"}),o=l.useCallback(async()=>{try{M(!0);const a=J(n),m=W(n),O=K.generateKey("calendar",i.id,b(n,"yyyy-MM")),L=await K.cacheQuery(O,async()=>{const{data:R,error:X}=await $.from("calendar_events").select(`
              *,
              class:classes(id, name)
            `).eq("created_by",i.id).gte("start_time",a.toISOString()).lte("start_time",m.toISOString()).order("start_time");if(X)throw X;return R||[]},300);g(L)}catch(a){E.error("Erro ao carregar eventos:",a),D({title:"Erro ao carregar eventos",description:"NÃ£o foi possÃ­vel carregar seus eventos.",variant:"destructive"})}finally{M(!1)}},[n,i?.id]),c=l.useCallback(()=>{let a=[...f];y.types.length>0&&(a=a.filter(m=>y.types.includes(m.type))),y.classes.length>0&&(a=a.filter(m=>m.class_id&&y.classes.includes(m.class_id))),y.modality!=="all"&&(a=a.filter(m=>m.modality===y.modality)),u(a)},[f,y]);l.useEffect(()=>{i?.id&&o()},[i?.id,o]),l.useEffect(()=>{c()},[c]);const p=l.useCallback(()=>{h(a=>pe(a)),S(!1)},[]),x=l.useCallback(()=>{h(a=>xe(a,1)),S(!1)},[]),q=l.useCallback(()=>{h(new Date),S(!1)},[]),V=a=>{d(a);const m=P(a);B(m),S(!0)},F=a=>{T(a),N(!0)},P=a=>j.filter(m=>{const O=new Date(m.start_time);return b(O,"yyyy-MM-dd")===b(a,"yyyy-MM-dd")}),te=l.useMemo(()=>{const a=J(n),m=W(n);return he({start:a,end:m})},[n]),se=l.useMemo(()=>["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"],[]);return _?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Q,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Minha Agenda"}),e.jsx("p",{className:"text-cyan-100",children:"Gerencie aulas, reuniÃµes e eventos"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{onClick:q,variant:"outline",className:"bg-white/10 hover:bg-white/20 border-white/20 text-white",children:"Hoje"}),e.jsxs(w,{onClick:()=>{d(new Date),k(!0)},className:"bg-white text-blue-600 hover:bg-white/90",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Novo Evento"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:A?"lg:col-span-8 transition-all duration-300":"lg:col-span-9 transition-all duration-300",children:e.jsxs(U,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:p,children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white capitalize",children:b(n,"MMMM yyyy",{locale:H})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:x,children:e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[se.map(a=>e.jsx("div",{className:"text-center text-sm font-semibold text-slate-600 dark:text-slate-400 py-2",children:a},a)),e.jsx(de,{children:te.map((a,m)=>{const O=P(a),L=ve(a),R=be(a,n);return e.jsx(ee,{day:a,dayEvents:O,isCurrentDay:L,isSameMonthDay:R,onClick:()=>V(a),onEventClick:F},`${b(a,"yyyy-MM-dd")}-${m}`)})})]})]})}),!A&&e.jsx("div",{className:"lg:col-span-3 space-y-4",children:e.jsx(fe,{filters:y,setFilters:s,teacherId:i?.id})}),A&&t&&e.jsx("div",{className:"lg:col-span-4",children:e.jsxs(U,{className:"p-6 bg-white dark:bg-slate-900 border-2 border-blue-200 dark:border-blue-800 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:b(t,"d 'de' MMMM",{locale:H})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:b(t,"EEEE",{locale:H})})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>S(!1),className:"text-slate-500 hover:text-slate-700",children:"âœ•"})]}),e.jsxs(w,{onClick:()=>k(!0),className:"w-full mb-4 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white shadow-lg",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Novo Evento"]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-24rem)] overflow-y-auto",children:z.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-12 h-12 mx-auto text-slate-300 dark:text-slate-700 mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nenhum evento neste dia"}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:'Clique em "Novo Evento" para adicionar'})]}):z.map(a=>e.jsx(G.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onClick:()=>F(a),className:`
                        p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md group
                        ${a.type==="event"?"border-blue-300 bg-blue-50 dark:bg-blue-950/30":""}
                        ${a.type==="activity"?"border-orange-300 bg-orange-50 dark:bg-orange-950/30":""}
                        ${a.type==="meeting"?"border-purple-300 bg-purple-50 dark:bg-purple-950/30":""}
                        ${a.type==="deadline"?"border-red-300 bg-red-50 dark:bg-red-950/30":""}
                      `,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:`
                              text-xs font-semibold px-2 py-1 rounded-full
                              ${a.type==="event"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":""}
                              ${a.type==="activity"?"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300":""}
                              ${a.type==="meeting"?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":""}
                              ${a.type==="deadline"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":""}
                            `,children:a.type==="event"?"ðŸ“š Aula":a.type==="activity"?"ðŸ“ Atividade":a.type==="meeting"?"ðŸ‘¥ ReuniÃ£o":"ðŸ“… Prazo"})}),e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white mb-1 group-hover:text-blue-600",children:a.title}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:[b(new Date(a.start_time),"HH:mm")," - ",b(new Date(a.end_time),"HH:mm")]}),a.class?.name&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸŽ“ ",a.class.name]}),a.location&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸ“ ",a.location]})]})})},a.id))})]})})]}),v&&e.jsx(ye,{isOpen:v,onClose:()=>{k(!1),d(null)},onSuccess:o,selectedDate:t,teacherId:i?.id}),r&&C&&e.jsx(me,{isOpen:r,onClose:()=>{N(!1),T(null)},event:C,onEdit:()=>{N(!1),k(!0)},onDelete:o})]})};export{lt as default};
