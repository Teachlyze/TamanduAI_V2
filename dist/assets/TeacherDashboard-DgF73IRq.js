import{a as fe,r as l,s as d,j as e,k as je,L as h}from"./main-XRKQFEIr.js";import{m as g,B as n}from"./button-D4bIZ4Ty.js";import{C as m}from"./card-BEk2G2Us.js";import{B as S}from"./SidebarPremium-BnsbfpCV.js";import{S as ve}from"./StatsCard-D5ZQ3-Yq.js";import{D as we}from"./DashboardHeader-B78p6TYW.js";import{E as j}from"./EmptyState-D0gyH3nl.js";import"./input-BrWaMOrb.js";import"./dropdown-menu-DyRCHyY4.js";import"./label-_ADcUmGf.js";import{a as Ne}from"./addDays-TIrBYM62.js";import{i as ye}from"./isToday-DbOgdeJ3.js";import{B as C}from"./book-open-CAn3t7Hm.js";import{U as ke}from"./users-DP4-CTtE.js";import{T as _e}from"./trending-up-eowzUgXK.js";import{C as A}from"./clock-BXvepPh_.js";import{C as D}from"./index-e3XtT_BD.js";import{f as v}from"./format-CxHpq9RK.js";import{T as Se}from"./target--MqGdgEh.js";import{C as E}from"./chevron-right-C-DpTlMS.js";import{P as T}from"./plus-DVhNLwZX.js";import{F as J}from"./file-text-tq0U235S.js";import{T as Ce}from"./triangle-alert-Bz2ASMAl.js";import{C as Ae}from"./circle-check-Dt8a2DkT.js";import{C as De}from"./chart-column-CBFsA3dh.js";import{p as Ee}from"./pt-BR-CXWZr0Zs.js";import"./bell-v36tl0On.js";import"./user-CCHLYTsx.js";import"./settings-pQ42cErW.js";import"./graduation-cap-CRbvieNe.js";import"./x-BPPDjH10.js";import"./Combination-TYhCc4jv.js";import"./index-ysAnX8Hi.js";import"./index-B_kCUa_t.js";import"./check-Cifhij8e.js";import"./en-US-azV9x4mt.js";import"./constructNow-C8CNs5uJ.js";import"./isSameDay-7UPP47mY.js";const pt=()=>{const{user:x}=fe(),[K,w]=l.useState(!0),[Te,G]=l.useState(null),[c,Q]=l.useState({totalClasses:0,totalStudents:0,totalActivities:0,pendingGrading:0,avgGrade:0,todayCorrections:0}),[q,X]=l.useState([]),[P,Y]=l.useState([]),[B,Z]=l.useState([]),[I,O]=l.useState([]),[z,ee]=l.useState([]),[b,te]=l.useState([]),[R,ae]=l.useState([]);l.useEffect(()=>{se()},[]);const se=async()=>{if(!x?.id){w(!1);return}try{w(!0),G(null),console.log("[TeacherDashboard] Carregando dados...");const{data:t,error:s}=await d.from("classes").select(`
          *,
          class_members(count)
        `).eq("created_by",x.id).eq("is_active",!0);if(s)throw s;const N=t?.map(a=>({...a,student_count:a.class_members?.[0]?.count||0}))||[],{data:y,error:$}=await d.from("activities").select(`
          *,
          activity_class_assignments(class:classes(name))
        `).eq("created_by",x.id).order("created_at",{ascending:!1}).limit(10);if($)throw $;const le=y?.map(a=>({...a,class_name:a.activity_class_assignments?.[0]?.class?.name||"Sem turma"}))||[],p=y?.map(a=>a.id)||[],{data:H,error:L}=await d.from("submissions").select(`
          *,
          activity:activities(title),
          student:profiles!student_id(full_name)
        `).in("activity_id",p).eq("status","submitted").order("submitted_at",{ascending:!0}).limit(10);if(L)throw L;const de=H?.map(a=>({...a,student_name:a.student?.full_name||"Aluno",activity_title:a.activity?.title||"Atividade"}))||[],{data:k,error:V}=await d.from("submissions").select("grade").in("activity_id",p).not("grade","is",null);if(V)throw V;const oe=k?.length>0?k.reduce((a,i)=>a+i.grade,0)/k.length:0,u=new Date;u.setHours(0,0,0,0);const f=new Date(u);f.setDate(f.getDate()+1);const{data:ne,error:F}=await d.from("submissions").select("id").in("activity_id",p).gte("graded_at",u.toISOString()).lt("graded_at",f.toISOString());if(F)throw F;const M=Ne(new Date,7),{data:_,error:ce}=await d.from("calendar_events").select("*").eq("created_by",x.id).gte("start_time",new Date().toISOString()).lte("start_time",M.toISOString()).order("start_time",{ascending:!0}).limit(5);!ce&&_&&(O(_),ee(_.filter(a=>ye(new Date(a.start_time)))));const{data:U,error:me}=await d.from("meetings").select("*").eq("created_by",x.id).gte("start_time",new Date().toISOString()).lte("start_time",M.toISOString()).order("start_time",{ascending:!0}).limit(5);if(!me&&U){const a=U.map(i=>({...i,title:i.title,start_time:i.start_time,event_type:"meeting"}));O(i=>[...i,...a].sort((r,o)=>new Date(r.start_time)-new Date(o.start_time)).slice(0,5))}const{data:W,error:xe}=await d.from("submissions").select(`
          student_id,
          grade,
          student:profiles!student_id(full_name)
        `).in("activity_id",p).not("grade","is",null);if(!xe&&W){const a={};W.forEach(r=>{a[r.student_id]||(a[r.student_id]={grades:[],name:r.student?.full_name||"Aluno"}),a[r.student_id].grades.push(r.grade)});const i=Object.entries(a).map(([r,o])=>({id:r,name:o.name,avgGrade:o.grades.reduce((pe,ue)=>pe+ue,0)/o.grades.length,totalActivities:o.grades.length})).filter(r=>r.avgGrade<6).sort((r,o)=>r.avgGrade-o.avgGrade).slice(0,10);te(i)}const{data:he,error:ge}=await d.from("activities").select("*").eq("created_by",x.id).eq("status","draft").gte("created_at",u.toISOString()).lt("created_at",f.toISOString());ge||ae(he||[]);const be=N.reduce((a,i)=>a+(i.student_count||0),0);Q({totalClasses:N.length,totalStudents:be,totalActivities:y?.length||0,pendingGrading:H?.length||0,avgGrade:Number(oe.toFixed(1)),todayCorrections:ne?.length||0}),X(N.slice(0,5)),Y(le.slice(0,5)),Z(de),console.log("[TeacherDashboard] Dados carregados com sucesso")}catch(t){console.error("Erro ao carregar dashboard:",t),G("Erro ao carregar dados do dashboard. Tente novamente.")}finally{w(!1)}},re=[{title:"Total de Turmas",value:c.totalClasses,icon:C,gradient:"from-blue-600 to-cyan-600",bgColor:"bg-blue-50 dark:bg-blue-950/30",change:`${c.totalStudents} alunos`},{title:"Total de Alunos",value:c.totalStudents,icon:ke,gradient:"from-cyan-500 to-blue-600",bgColor:"bg-cyan-50 dark:bg-cyan-950/30"},{title:"MÃ©dia Geral",value:c.avgGrade,icon:_e,gradient:"from-emerald-500 to-teal-500",bgColor:"bg-emerald-50 dark:bg-emerald-950/30",change:c.avgGrade>=7?"Excelente":"Pode melhorar"},{title:"Aguardando CorreÃ§Ã£o",value:c.pendingGrading,icon:A,gradient:"from-amber-500 to-orange-500",bgColor:"bg-amber-50 dark:bg-amber-950/30",change:`${c.todayCorrections} hoje`}],ie=[{label:"Nova Turma",icon:T,href:"/dashboard/classes/new",gradient:"from-blue-600 to-indigo-600"},{label:"Nova Atividade",icon:T,href:"/dashboard/activities/new",gradient:"from-blue-600 to-cyan-600"},{label:"Ver Analytics",icon:De,href:"/dashboard/analytics",gradient:"from-emerald-600 to-teal-600"}];return K?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(je,{size:"lg",text:"Carregando dashboard..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(we,{title:"Dashboard do Professor",subtitle:"Bem-vindo de volta! Aqui estÃ¡ um resumo das suas turmas e atividades.",role:"teacher"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:re.map((t,s)=>e.jsx(ve,{title:t.title,value:t.value,icon:t.icon,gradient:t.gradient,bgColor:t.bgColor,change:t.change,delay:s*.1},t.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(D,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"PrÃ³ximos Eventos (7 dias)"})]}),e.jsx("div",{className:"space-y-3",children:I.length>0?I.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-center gap-3 p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:[e.jsxs("div",{className:"flex-shrink-0 w-16 h-16 bg-gradient-to-br from-blue-600 to-cyan-500 rounded-lg flex flex-col items-center justify-center text-white",children:[e.jsx("div",{className:"text-2xl font-bold",children:v(new Date(t.start_time),"d")}),e.jsx("div",{className:"text-xs uppercase",children:v(new Date(t.start_time),"MMM",{locale:Ee})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white truncate",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:v(new Date(t.start_time),"HH:mm")}),e.jsx(S,{className:`mt-1 ${t.event_type==="meeting"?"bg-purple-100 text-purple-700":t.event_type==="exam"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:t.event_type||"evento"})]})]},t.id)):e.jsx(j,{icon:D,title:"Nenhum evento prÃ³ximo",description:"Seus prÃ³ximos eventos aparecerÃ£o aqui."})})]}),e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Agenda de Hoje"})]}),e.jsxs("div",{className:"space-y-4",children:[z.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Eventos"}),z.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800",children:[e.jsx(A,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:v(new Date(t.start_time),"HH:mm")})]})]},t.id))]}):e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Nenhum evento hoje"}),R.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Atividades para Postar"}),R.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-slate-900 dark:text-white text-sm",children:t.title})}),e.jsx(n,{size:"sm",className:"bg-gradient-to-r from-blue-600 to-cyan-600",onClick:()=>navigate(`/dashboard/activities/${t.id}`),children:"Publicar"})]},t.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Turmas Recentes"]}),e.jsx(h,{to:"/dashboard/classes",children:e.jsxs(n,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(E,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:q.length>0?q.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},children:e.jsx(h,{to:`/dashboard/classes/${t.id}`,children:e.jsx(m,{className:"p-4 hover:shadow-md transition-all border-2 hover:border-blue-200 dark:hover:border-blue-800 bg-white dark:bg-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${t.color||"from-blue-500 to-indigo-500"} flex items-center justify-center text-white font-bold`,children:t.name?.[0]||"T"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.subject||"Sem matÃ©ria"," â€¢ ",t.student_count||0," alunos"]})]})]}),e.jsx(n,{size:"sm",variant:"ghost",className:"whitespace-nowrap",children:"Ver Turma"})]})})})},t.id)):e.jsx(j,{icon:C,title:"Nenhuma turma encontrada",description:"Crie sua primeira turma para comeÃ§ar a gerenciar suas aulas e atividades.",actionLabel:"Criar Primeira Turma",actionIcon:T,action:()=>window.location.href="/dashboard/classes/new"})})]}),e.jsxs(m,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Atividades Recentes"]}),e.jsx(h,{to:"/dashboard/activities",children:e.jsxs(n,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(E,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:P.length>0?P.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700 transition-all bg-white dark:bg-slate-800",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:t.class_name}),e.jsx("div",{className:"flex items-center gap-3 text-xs text-slate-500 dark:text-slate-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),new Date(t.due_date).toLocaleDateString("pt-BR")]})})]}),e.jsx(S,{variant:t.status==="active"?"default":"secondary",className:"whitespace-nowrap",children:t.status==="active"?"Ativa":"Encerrada"})]})},t.id)):e.jsx(j,{icon:J,title:"Nenhuma atividade encontrada",description:"Suas atividades recentes aparecerÃ£o aqui."})})]})]}),b.length>0&&e.jsxs(m,{className:"p-6 mb-8 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-950/20 dark:to-orange-950/20 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100 dark:bg-yellow-900/40",children:e.jsx(Ce,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Alunos que Precisam de AtenÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[b.length," aluno",b.length>1?"s":""," com desempenho abaixo de 6.0"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:s*.05},className:"flex items-center gap-4 p-4 rounded-lg bg-white dark:bg-slate-900 border-2 border-yellow-200 dark:border-yellow-800 hover:shadow-md transition-all",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center text-white font-bold text-lg",children:t.name?.[0]||"A"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(S,{className:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300 text-xs",children:["MÃ©dia: ",t.avgGrade.toFixed(1)]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[t.totalActivities," atividade",t.totalActivities>1?"s":""]})]})]}),e.jsx(n,{size:"sm",variant:"outline",className:"whitespace-nowrap border-yellow-600 text-yellow-700 hover:bg-yellow-50",onClick:()=>navigate(`/dashboard/students/${t.id}`),children:"Ver Detalhes"})]},t.id))})]}),e.jsxs(m,{className:"p-6 mb-8 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"SubmissÃµes Pendentes de CorreÃ§Ã£o"]}),e.jsx(h,{to:"/dashboard/grading",children:e.jsxs(n,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(E,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:B.length>0?B.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-center justify-between p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-amber-300 dark:hover:border-amber-700 transition-all bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold",children:t.student_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.student_name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.activity_title}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Enviado em ",new Date(t.submitted_at).toLocaleDateString("pt-BR")]})]})]}),e.jsx(h,{to:`/dashboard/grading/${t.id}`,children:e.jsx(n,{size:"sm",className:"whitespace-nowrap bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white",children:"Corrigir Agora"})})]},t.id)):e.jsx(j,{icon:Ae,title:"Nenhuma correÃ§Ã£o pendente!",description:"ParabÃ©ns! VocÃª estÃ¡ em dia com as correÃ§Ãµes. ðŸŽ‰"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:ie.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},children:e.jsx(h,{to:t.href,children:e.jsxs(n,{size:"lg",className:`w-full whitespace-nowrap inline-flex items-center justify-center gap-2 bg-gradient-to-r ${t.gradient} hover:opacity-90 text-white h-16 text-lg`,children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsx("span",{children:t.label})]})})},t.label))})]})};export{pt as default};
