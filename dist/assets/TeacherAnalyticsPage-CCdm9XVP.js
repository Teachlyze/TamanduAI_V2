import{c as Aa,r as n,e as wa,b as Ca,u as Sa,s as O,l as G,j as e,q as Ea}from"./main-CDwcRVbo.js";import{C as J}from"./card-BeDiIhdC.js";import{B as pe}from"./button-BuH7Xbht.js";import{B as qe}from"./badge-C6gXtPyv.js";import{D as Da,a as Pa,b as Ia,e as Ue}from"./dropdown-menu-DUHtGofS.js";import{S as xe,a as he,b as ge,c as ve,d as Y}from"./select-DLEl6fnx.js";import{C as Ta}from"./checkbox-REItPVxG.js";import"./tabs-DtTHGX-p.js";import{P as Fa}from"./progress-_kQrU16b.js";import{D as Oa,g as ee}from"./DashboardHeader-MvNqeZZV.js";import{S as ne}from"./StatsCard-DSbLqF9t.js";import"./input-BByzzpRS.js";import"./label-CwZn5L96.js";import{u as Ma}from"./use-toast-BOz3McvK.js";import{a as za}from"./exportService-CSbpIUUo.js";import{B as La}from"./bell-BCMDKcho.js";import{D as Ra}from"./download-Dd-HeChr.js";import{C as Ga}from"./calendar-BqfKTByC.js";import{U as Te}from"./users-CgJEdG6v.js";import{C as Ba}from"./clipboard-list-BhZnsXAz.js";import{C as $a}from"./clock-DTcmbWF-.js";import{C as Ka}from"./circle-alert-CzqxqrLI.js";import{T as Wa}from"./trending-up-DCuPlkSP.js";import{C as Va}from"./circle-check-big-ZpCnrfY5.js";import{c as ze,s as Le,a as ta,b as sa,d as qa,e as Ua,f as Xe,g as Xa,i as ia,h as Ye,j as Ya,p as Qa,r as ra,D as Za,u as na,R as Ha,S as Ja,k as et,l as at,m as la,n as tt,o as st,q as it,t as rt,v as nt,w as lt,x as ot,y as ct,Z as dt,L as Ae,G as mt,A as Qe,z as Ze,B as He,C as de,E as ut,F as pt,J as xt,H as le,I as ht,K as gt,M as vt,N as ft,O as oa,P as yt,Q as Fe,T as bt,U as we,V as jt,W as Nt,X as _t,Y as fe,_ as ye,$ as be,a0 as je,a1 as Ne}from"./CartesianChart-D4xkdshh.js";import{C as Oe}from"./chart-column-CiDVUyDs.js";import{B as Me,a as _e,C as Je}from"./BarChart-DO45ujyh.js";import{L as kt}from"./Legend-Co5RbA8i.js";import{C as At}from"./chart-pie-BIwWzm5w.js";import{S as wt}from"./shield-C5XjaDu3.js";import{A as Ct}from"./award-BzkgCaDU.js";import{T as St}from"./trending-down-vNpRg_Z2.js";import{Z as Et}from"./zap-N99Lt2zz.js";import{f as ke}from"./format-B5colFmK.js";import{s as oe}from"./subDays-DYXO191S.js";import"./index-Dh6vDsM6.js";import"./index-CPGjc502.js";import"./index-CqoVHjef.js";import"./index-CcEjAaVA.js";import"./Combination-CkmxMhvN.js";import"./SidebarPremium-DtY86ggr.js";import"./house-BzSw2wbQ.js";import"./book-open-B_wcLpnO.js";import"./file-text-DqPfoEgV.js";import"./graduation-cap-D_9lOntz.js";import"./message-circle-B9SdJZHY.js";import"./settings-DAYbyNc3.js";import"./brain-B546Q6XX.js";import"./index-CrH3dQlI.js";import"./proxy-BQZ2TmvR.js";import"./chevron-right-C7mHeVR8.js";import"./x-Dx_XJWp3.js";import"./index-Bnl_O2Nv.js";import"./check-CJ5iHYK_.js";import"./index-RCrci90a.js";import"./chevron-down-C12er63L.js";import"./chevron-up-CjnVXTVX.js";import"./jspdf.plugin.autotable-DzBHNUwN.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./index-CQXXlVAR.js";import"./en-US-DaE-csDX.js";import"./addDays-ByTXhFEf.js";const Dt=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Pt=Aa("chart-line",Dt);var ca=(s,t,i,r)=>ta(s,"xAxis",t,r),da=(s,t,i,r)=>sa(s,"xAxis",t,r),ma=(s,t,i,r)=>ta(s,"yAxis",i,r),ua=(s,t,i,r)=>sa(s,"yAxis",i,r),It=ze([Le,ca,ma,da,ua],(s,t,i,r,u)=>ia(s,"xAxis")?Ye(t,r,!1):Ye(i,u,!1)),Tt=(s,t,i,r,u)=>u,pa=ze([Ya,Tt],(s,t)=>s.filter(i=>i.type==="area").find(i=>i.id===t)),Ft=(s,t,i,r,u)=>{var o,c=pa(s,t,i,r,u);if(c!=null){var d=Le(s),l=ia(d,"xAxis"),f;if(l?f=Xe(s,"yAxis",i,r):f=Xe(s,"xAxis",t,r),f!=null){var{stackId:A}=c,E=Xa(c);if(!(A==null||E==null)){var w=(o=f[A])===null||o===void 0?void 0:o.stackedData;return w?.find(C=>C.key===E)}}}},Ot=ze([Le,ca,ma,da,ua,Ft,qa,It,pa,Ua],(s,t,i,r,u,o,c,d,l,f)=>{var{chartData:A,dataStartIndex:E,dataEndIndex:w}=c;if(!(l==null||s!=="horizontal"&&s!=="vertical"||t==null||i==null||r==null||u==null||r.length===0||u.length===0||d==null)){var{data:C}=l,P;if(C&&C.length>0?P=C:P=A?.slice(E,w+1),P!=null)return es({layout:s,xAxis:t,yAxis:i,xAxisTicks:r,yAxisTicks:u,dataStartIndex:E,areaSettings:l,stackedData:o,displayedData:P,chartBaseValue:f,bandSize:d})}}),Mt=["id"],zt=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function te(){return te=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},te.apply(null,arguments)}function xa(s,t){if(s==null)return{};var i,r,u=Lt(s,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);for(r=0;r<o.length;r++)i=o[r],t.indexOf(i)===-1&&{}.propertyIsEnumerable.call(s,i)&&(u[i]=s[i])}return u}function Lt(s,t){if(s==null)return{};var i={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(t.indexOf(r)!==-1)continue;i[r]=s[r]}return i}function ea(s,t){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);t&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(s,u).enumerable})),i.push.apply(i,r)}return i}function ce(s){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ea(Object(i),!0).forEach(function(r){Rt(s,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):ea(Object(i)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(i,r))})}return s}function Rt(s,t,i){return(t=Gt(t))in s?Object.defineProperty(s,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[t]=i,s}function Gt(s){var t=Bt(s,"string");return typeof t=="symbol"?t:t+""}function Bt(s,t){if(typeof s!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var r=i.call(s,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Ce(s,t){return s&&s!=="none"?s:t}var $t=s=>{var{dataKey:t,name:i,stroke:r,fill:u,legendType:o,hide:c}=s;return[{inactive:c,dataKey:t,type:o,color:Ce(r,u),value:la(i,t),payload:s}]},Kt=n.memo(s=>{var{dataKey:t,data:i,stroke:r,strokeWidth:u,fill:o,name:c,hide:d,unit:l,tooltipType:f}=s,A={dataDefinedOnItem:i,positions:void 0,settings:{stroke:r,strokeWidth:u,fill:o,dataKey:t,nameKey:void 0,name:la(c,t),hide:d,type:f,color:Ce(r,o),unit:l}};return n.createElement(tt,{tooltipEntrySettings:A})});function Wt(s){var{clipPathId:t,points:i,props:r}=s,{needClip:u,dot:o,dataKey:c}=r,d=oa(r);return n.createElement(bt,{points:i,dot:o,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:c,baseProps:d,needClip:u,clipPathId:t})}function Vt(s){var{showLabels:t,children:i,points:r}=s,u=r.map(o=>{var c,d,l={x:(c=o.x)!==null&&c!==void 0?c:0,y:(d=o.y)!==null&&d!==void 0?d:0,width:0,lowerWidth:0,upperWidth:0,height:0};return ce(ce({},l),{},{value:o.value,payload:o.payload,parentViewBox:void 0,viewBox:l,fill:void 0})});return n.createElement(ft,{value:t?u:void 0},i)}function aa(s){var{points:t,baseLine:i,needClip:r,clipPathId:u,props:o}=s,{layout:c,type:d,stroke:l,connectNulls:f,isRange:A}=o,{id:E}=o,w=xa(o,Mt),C=oa(w),P=yt(w);return n.createElement(n.Fragment,null,t?.length>1&&n.createElement(Ae,{clipPath:r?"url(#clipPath-".concat(u,")"):void 0},n.createElement(Fe,te({},P,{id:E,points:t,connectNulls:f,type:d,baseLine:i,layout:c,stroke:"none",className:"recharts-area-area"})),l!=="none"&&n.createElement(Fe,te({},C,{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:t})),l!=="none"&&A&&n.createElement(Fe,te({},C,{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:i}))),n.createElement(Wt,{points:t,props:w,clipPathId:u}))}function qt(s){var{alpha:t,baseLine:i,points:r,strokeWidth:u}=s,o=r[0].y,c=r[r.length-1].y;if(!we(o)||!we(c))return null;var d=t*Math.abs(o-c),l=Math.max(...r.map(f=>f.x||0));return de(i)?l=Math.max(i,l):i&&Array.isArray(i)&&i.length&&(l=Math.max(...i.map(f=>f.x||0),l)),de(l)?n.createElement("rect",{x:0,y:o<c?o:o-d,width:l+(u?parseInt("".concat(u),10):1),height:Math.floor(d)}):null}function Ut(s){var{alpha:t,baseLine:i,points:r,strokeWidth:u}=s,o=r[0].x,c=r[r.length-1].x;if(!we(o)||!we(c))return null;var d=t*Math.abs(o-c),l=Math.max(...r.map(f=>f.y||0));return de(i)?l=Math.max(i,l):i&&Array.isArray(i)&&i.length&&(l=Math.max(...i.map(f=>f.y||0),l)),de(l)?n.createElement("rect",{x:o<c?o:o-d,y:0,width:d,height:Math.floor(l+(u?parseInt("".concat(u),10):1))}):null}function Xt(s){var{alpha:t,layout:i,points:r,baseLine:u,strokeWidth:o}=s;return i==="vertical"?n.createElement(qt,{alpha:t,points:r,baseLine:u,strokeWidth:o}):n.createElement(Ut,{alpha:t,points:r,baseLine:u,strokeWidth:o})}function Yt(s){var{needClip:t,clipPathId:i,props:r,previousPointsRef:u,previousBaselineRef:o}=s,{points:c,baseLine:d,isAnimationActive:l,animationBegin:f,animationDuration:A,animationEasing:E,onAnimationStart:w,onAnimationEnd:C}=r,P=n.useMemo(()=>({points:c,baseLine:d}),[c,d]),L=ut(P,"recharts-area-"),D=pt(),[U,B]=n.useState(!1),K=!U,h=n.useCallback(()=>{typeof C=="function"&&C(),B(!1)},[C]),I=n.useCallback(()=>{typeof w=="function"&&w(),B(!0)},[w]);if(D==null)return null;var g=u.current,$=o.current;return n.createElement(Vt,{showLabels:K,points:c},r.children,n.createElement(xt,{animationId:L,begin:f,duration:A,isActive:l,easing:E,onAnimationEnd:h,onAnimationStart:I,key:L},F=>{if(g){var Z=g.length/c.length,X=F===1?c:c.map((M,W)=>{var V=Math.floor(W*Z);if(g[V]){var H=g[V];return ce(ce({},M),{},{x:le(H.x,M.x,F),y:le(H.y,M.y,F)})}return M}),R;return de(d)?R=le($,d,F):ht(d)||gt(d)?R=le($,0,F):R=d.map((M,W)=>{var V=Math.floor(W*Z);if(Array.isArray($)&&$[V]){var H=$[V];return ce(ce({},M),{},{x:le(H.x,M.x,F),y:le(H.y,M.y,F)})}return M}),F>0&&(u.current=X,o.current=R),n.createElement(aa,{points:X,baseLine:R,needClip:t,clipPathId:i,props:r})}return F>0&&(u.current=c,o.current=d),n.createElement(Ae,null,l&&n.createElement("defs",null,n.createElement("clipPath",{id:"animationClipPath-".concat(i)},n.createElement(Xt,{alpha:F,points:c,baseLine:d,layout:D,strokeWidth:r.strokeWidth}))),n.createElement(Ae,{clipPath:"url(#animationClipPath-".concat(i,")")},n.createElement(aa,{points:c,baseLine:d,needClip:t,clipPathId:i,props:r})))}),n.createElement(vt,{label:r.label}))}function Qt(s){var{needClip:t,clipPathId:i,props:r}=s,u=n.useRef(null),o=n.useRef();return n.createElement(Yt,{needClip:t,clipPathId:i,props:r,previousPointsRef:u,previousBaselineRef:o})}class Zt extends n.PureComponent{render(){var{hide:t,dot:i,points:r,className:u,top:o,left:c,needClip:d,xAxisId:l,yAxisId:f,width:A,height:E,id:w,baseLine:C,zIndex:P}=this.props;if(t)return null;var L=wa("recharts-area",u),D=w,{r:U,strokeWidth:B}=ot(i),K=ct(i),h=U*2+B,I=d?"url(#clipPath-".concat(K?"":"dots-").concat(D,")"):void 0;return n.createElement(dt,{zIndex:P},n.createElement(Ae,{className:L},d&&n.createElement("defs",null,n.createElement(mt,{clipPathId:D,xAxisId:l,yAxisId:f}),!K&&n.createElement("clipPath",{id:"clipPath-dots-".concat(D)},n.createElement("rect",{x:c-h/2,y:o-h/2,width:A+h,height:E+h}))),n.createElement(Qt,{needClip:d,clipPathId:D,props:this.props})),n.createElement(Qe,{points:r,mainColor:Ce(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:I}),this.props.isRange&&Array.isArray(C)&&n.createElement(Qe,{points:C,mainColor:Ce(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:I}))}}var ha={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Za.area};function Ht(s){var t,i=ra(s,ha),{activeDot:r,animationBegin:u,animationDuration:o,animationEasing:c,connectNulls:d,dot:l,fill:f,fillOpacity:A,hide:E,isAnimationActive:w,legendType:C,stroke:P,xAxisId:L,yAxisId:D}=i,U=xa(i,zt),B=st(),K=it(),{needClip:h}=rt(L,D),I=na(),{points:g,isRange:$,baseLine:F}=(t=nt(V=>Ot(V,L,D,I,s.id)))!==null&&t!==void 0?t:{},Z=lt();if(B!=="horizontal"&&B!=="vertical"||Z==null||K!=="AreaChart"&&K!=="ComposedChart")return null;var{height:X,width:R,x:M,y:W}=Z;return!g||!g.length?null:n.createElement(Zt,te({},U,{activeDot:r,animationBegin:u,animationDuration:o,animationEasing:c,baseLine:F,connectNulls:d,dot:l,fill:f,fillOpacity:A,height:X,hide:E,layout:B,isAnimationActive:w==="auto"?!jt.isSsr:w,isRange:$,legendType:C,needClip:h,points:g,stroke:P,width:R,left:M,top:W,xAxisId:L,yAxisId:D}))}var Jt=(s,t,i,r,u)=>{var o=i??t;if(de(o))return o;var c=s==="horizontal"?u:r,d=c.scale.domain();if(c.type==="number"){var l=Math.max(d[0],d[1]),f=Math.min(d[0],d[1]);return o==="dataMin"?f:o==="dataMax"||l<0?l:Math.max(Math.min(d[0],d[1]),0)}return o==="dataMin"?d[0]:o==="dataMax"?d[1]:d[0]};function es(s){var{areaSettings:{connectNulls:t,baseValue:i,dataKey:r},stackedData:u,layout:o,chartBaseValue:c,xAxis:d,yAxis:l,displayedData:f,dataStartIndex:A,xAxisTicks:E,yAxisTicks:w,bandSize:C}=s,P=u&&u.length,L=Jt(o,c,i,d,l),D=o==="horizontal",U=!1,B=f.map((h,I)=>{var g;P?g=u[A+I]:(g=Ze(h,r),Array.isArray(g)?U=!0:g=[L,g]);var $=g[1]==null||P&&!t&&Ze(h,r)==null;return D?{x:He({axis:d,ticks:E,bandSize:C,entry:h,index:I}),y:$?null:l.scale(g[1]),value:g,payload:h}:{x:$?null:d.scale(g[1]),y:He({axis:l,ticks:w,bandSize:C,entry:h,index:I}),value:g,payload:h}}),K;return P||U?K=B.map(h=>{var I=Array.isArray(h.value)?h.value[0]:null;return D?{x:h.x,y:I!=null&&h.y!=null?l.scale(I):null,payload:h.payload}:{x:I!=null?d.scale(I):null,y:h.y,payload:h.payload}}):K=D?l.scale(L):d.scale(L),{points:B,baseLine:K,isRange:U}}function as(s){var t=ra(s,ha),i=na();return n.createElement(Ha,{id:t.id,type:"area"},r=>n.createElement(n.Fragment,null,n.createElement(Ja,{legendPayload:$t(t)}),n.createElement(Kt,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType}),n.createElement(et,{type:"area",id:r,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:at(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:i,connectNulls:t.connectNulls}),n.createElement(Ht,te({},t,{id:r}))))}var ga=n.memo(as,Qa);ga.displayName="Area";var ts=["axis"],ss=n.forwardRef((s,t)=>n.createElement(Nt,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:ts,tooltipPayloadSearcher:_t,categoricalChartProps:s,ref:t}));const pi=()=>{const{user:s}=Ca(),{toast:t}=Ma();Sa();const[i,r]=n.useState(!0),[u,o]=n.useState(!0),[c,d]=n.useState("30"),[l,f]=n.useState([]),[A,E]=n.useState([]),[w,C]=n.useState(["all"]),[P,L]=n.useState(["graded"]),[D,U]=n.useState(!1),[B,K]=n.useState(!0),[h,I]=n.useState([]),[g,$]=n.useState({totalStudents:0,totalActivities:0,pendingCorrections:0,avgGrade:0,onTimeRate:0,openActivities:0}),[F,Z]=n.useState([]),[X,R]=n.useState([]),[M,W]=n.useState(null),[V,H]=n.useState([]),[Se,Ee]=n.useState([]),[me,ue]=n.useState([]),[De,Pe]=n.useState([]),[se,ie]=n.useState(null),[is,va]=n.useState(null);n.useEffect(()=>{Re()},[s,c,l,w,P]),n.useEffect(()=>{s?.id&&(u||Ie())},[A]),n.useEffect(()=>{let a;return D&&(a=setInterval(Re,300*1e3)),()=>clearInterval(a)},[D]);const Re=async()=>{if(s?.id){r(!0);try{const a=await fa(),p=(a&&a.length?a:h).map(x=>x.id);if(B){try{const{data:x}=await O.auth.getSession(),_=x?.session?.access_token,y=await fetch("https://wapbwaimkurbuihatmix.supabase.co/functions/v1/get-teacher-analytics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},body:JSON.stringify({period:c,selectedClasses:p})});if(y.ok){const j=await y.json(),k=j.data||{};ue(Array.isArray(k.topStudents)?k.topStudents:[]),j.cached&&t({title:"‚ö° Cache",description:"Top alunos carregados do cache (5min)",duration:2e3})}else G.error("Erro ao carregar analytics (edge):",y.status)}catch(x){G.error("Erro na Edge Function de analytics:",x)}await Promise.all([Ge(),Be(),Ie(),$e(),Ke(),We(),Ve()])}else await Promise.all([Ge(),Be(),Ie(),$e(),Ke(),ya(),We(),Ve()])}catch(a){G.error("Erro ao carregar analytics:",a),t({title:"Erro",description:"N√£o foi poss√≠vel carregar os dados de analytics",variant:"destructive"})}finally{r(!1),u&&o(!1)}}},fa=async()=>{try{const{data:a,error:p}=await O.from("classes").select("id, name, subject, color").eq("created_by",s.id).eq("is_active",!0).order("name",{ascending:!0});if(p)throw p;const x=a||[];return I(x),l.length===0&&x.length>0&&f(x.map(_=>_.id)),x}catch(a){return G.error("Erro ao carregar turmas:",a),I([]),[]}},Ge=async()=>{if(l.length===0){$({totalStudents:0,totalActivities:0,pendingCorrections:0,avgGrade:0,onTimeRate:0,openActivities:0});return}const a=c==="all"?null:ke(oe(new Date,parseInt(c)),"yyyy-MM-dd"),{data:p}=await O.from("class_members").select("user_id").in("class_id",l).eq("role","student"),x=new Set(p?.map(q=>q.user_id)||[]).size;let _=O.from("activity_class_assignments").select("activity_id, activities!inner(id, created_at, status)").in("class_id",l);a&&(_=_.gte("activities.created_at",a));const{data:y}=await _,j=new Set(y?.map(q=>q.activity_id)||[]).size,{data:k}=await O.from("submissions").select("id, activity_id, activities!inner(id, activity_class_assignments!inner(class_id))").eq("status","submitted").in("activities.activity_class_assignments.class_id",l),m=k?.length||0;let v=O.from("submissions").select("grade, activity_id, activities!inner(id, activity_class_assignments!inner(class_id))").not("grade","is",null).in("activities.activity_class_assignments.class_id",l);a&&(v=v.gte("graded_at",a));const{data:S}=await v,b=S?.length>0?(S.reduce((q,ka)=>q+(ka.grade||0),0)/S.length).toFixed(1):0;let T=O.from("submissions").select("submitted_at, activity_id, activities!inner(due_date, activity_class_assignments!inner(class_id))").in("status",["submitted","graded"]).in("activities.activity_class_assignments.class_id",l).not("submitted_at","is",null).not("activities.due_date","is",null);a&&(T=T.gte("submitted_at",a));const{data:N}=await T,z=N?.filter(q=>new Date(q.submitted_at)<=new Date(q.activities.due_date)).length||0,Q=N?.length>0?Math.round(z/N.length*100):0,{data:re}=await O.from("activity_class_assignments").select("activity_id, activities!inner(status, due_date)").in("class_id",l).eq("activities.status","active").gte("activities.due_date",new Date().toISOString()),ae=re?.length||0;$({totalStudents:x,totalActivities:j,pendingCorrections:m,avgGrade:parseFloat(b),onTimeRate:Q,openActivities:ae})},Be=async()=>{if(l.length===0){Z([]);return}const a=c==="all"?90:Number.parseInt(c,10)||30,p=oe(new Date,a),{data:x,error:_}=await O.from("submissions").select("grade, graded_at, activity_id, activities!inner(activity_class_assignments!inner(class_id))").not("grade","is",null).in("activities.activity_class_assignments.class_id",l).gte("graded_at",p.toISOString()).order("graded_at",{ascending:!0}).limit(1e3);if(_){G.error("Erro ao carregar evolu√ß√£o de notas:",_),Z([]);return}const y={};(x||[]).forEach(k=>{if(!k||k.grade==null||!k.graded_at)return;const m=parseFloat(k.grade);if(Number.isNaN(m))return;const v=new Date(k.graded_at);if(Number.isNaN(v.getTime()))return;const S=ke(v,"dd/MM");y[S]||(y[S]=[]),y[S].push(m)});const j=Object.entries(y).map(([k,m])=>{const v=m.length>0?m.reduce((S,b)=>S+b,0)/m.length:0;return{date:k,media:parseFloat(v.toFixed(2)),submissoes:m.length}});Z(j.slice(-30))},Ie=async()=>{if(!h||h.length<2){R([]),W({type:"not_enough_total"});return}const a=(A||[]).filter(Boolean),p=Array.from(new Set(a));if(p.length===0||p.length===1){R([]),W({type:"need_two"});return}try{const{data:x,error:_}=await O.from("submissions").select(`
          grade,
          activity_id,
          activities!inner(
            activity_class_assignments!inner(class_id)
          )
        `).not("grade","is",null).in("activities.activity_class_assignments.class_id",p).limit(2e3);if(_)throw _;const{data:y,error:j}=await O.from("class_members").select("class_id, user_id").in("class_id",p).eq("role","student");if(j)throw j;const{data:k,error:m}=await O.from("activity_class_assignments").select("class_id, activity_id").in("class_id",p);if(m)throw m;const v=[],S={},b={};(y||[]).forEach(N=>{N.class_id&&(S[N.class_id]=(S[N.class_id]||0)+1)}),(k||[]).forEach(N=>{N.class_id&&(b[N.class_id]=(b[N.class_id]||0)+1)});const T=h.reduce((N,z)=>(N[z.id]=z,N),{});p.forEach(N=>{const z=T[N];if(!z)return;const Q=(x||[]).filter(ae=>ae.activities?.activity_class_assignments?.some(q=>q.class_id===N));if(Q.length===0)return;const re=Q.reduce((ae,q)=>ae+(q.grade||0),0)/Q.length;v.push({name:z.name,media:parseFloat(re.toFixed(2)),alunos:S[N]||0,atividades:b[N]||0,color:z.color||"#3B82F6"})}),v.length===0?(R([]),W({type:"no_grades"})):(R(v.sort((N,z)=>z.media-N.media)),W(null))}catch(x){G.error("Erro ao carregar compara√ß√£o entre turmas:",x),R([]),W({type:"error"})}},$e=async()=>{if(l.length===0){H([]);return}const{data:a,error:p}=await O.from("submissions").select("grade, activity_id, activities!inner(max_score, activity_class_assignments!inner(class_id))").not("grade","is",null).in("activities.activity_class_assignments.class_id",l).limit(1e3);if(p){G.error("Erro ao carregar distribui√ß√£o de notas:",p),H([]);return}const x=[{range:"0-2",count:0,color:"#EF4444"},{range:"2-4",count:0,color:"#F97316"},{range:"4-6",count:0,color:"#F59E0B"},{range:"6-8",count:0,color:"#3B82F6"},{range:"8-10",count:0,color:"#10B981"}];a?.forEach(({grade:_,activities:y})=>{const j=parseFloat(_),k=parseFloat(y?.max_score||10);if(isNaN(j))return;let m=j;k>0&&k!==10&&(m=j/k*10),m=Math.max(0,Math.min(10,m)),m<2?x[0].count++:m<4?x[1].count++:m<6?x[2].count++:m<8?x[3].count++:x[4].count++}),H(x)},Ke=async()=>{if(l.length===0){Ee([]);return}const a=ke(oe(new Date,84),"yyyy-MM-dd"),{data:p,error:x}=await O.from("submissions").select("submitted_at, status, activity_id, activities!inner(due_date, activity_class_assignments!inner(class_id))").in("status",["submitted","graded"]).in("activities.activity_class_assignments.class_id",l).gte("submitted_at",a).limit(1e3);if(x){G.error("Erro ao carregar tend√™ncia semanal de entregas:",x),Ee([]);return}const _=[];for(let y=0;y<12;y++){const j=oe(new Date,(12-y)*7),k=oe(new Date,(11-y)*7),m=p?.filter(b=>{const T=new Date(b.submitted_at);return T>=j&&T<=k})||[],v=m.filter(b=>b.activities?.due_date&&new Date(b.submitted_at)<=new Date(b.activities.due_date)).length,S=m.filter(b=>b.activities?.due_date&&new Date(b.submitted_at)>new Date(b.activities.due_date)).length;_.push({week:`S${12-y}`,noPrazo:v,atrasadas:S,total:m.length})}Ee(_)},ya=async()=>{if(l.length===0){ue([]),Pe([]);return}const{data:a,error:p}=await O.from("submissions").select(`
        grade,
        status,
        submitted_at,
        student_id,
        student:profiles!submissions_student_id_fkey(id, full_name, avatar_url),
        activity_id,
        activities!inner(max_score, due_date, activity_class_assignments!inner(class_id))
      `).not("grade","is",null).in("activities.activity_class_assignments.class_id",l).limit(500);if(p){G.error("Erro ao carregar top/bottom students:",p),ue([]),Pe([]);return}const x=h.reduce((m,v)=>(m[v.id]=v,m),{}),_={};a?.forEach(m=>{_[m.student_id]||(_[m.student_id]={student:m.student,grades:[],total:0,onTime:0,classes:new Set});const v=_[m.student_id],S=parseFloat(m.grade)||0;v.grades.push(S),v.total++;const b=m.submitted_at?new Date(m.submitted_at):null,T=m.activities?.due_date?new Date(m.activities.due_date):null;b&&T&&b<=T&&v.onTime++,(m.activities?.activity_class_assignments||[]).forEach(z=>{const Q=x[z.class_id];Q&&v.classes.add(Q.name)})});const y=Object.entries(_).map(([m,v])=>{const S=v.grades.length>0?v.grades.reduce((T,N)=>T+N,0)/v.grades.length:0,b=v.total>0?Math.round(v.onTime/v.total*100):0;return{id:m,name:v.student?.full_name||"Sem nome",avatar:v.student?.avatar_url,avgGrade:S,activities:v.total,onTimeRate:b,classes:Array.from(v.classes).slice(0,3)}}).sort((m,v)=>v.avgGrade-m.avgGrade),j=y.slice(0,10),k=y.filter(m=>m.activities>=3).slice(-10).sort((m,v)=>m.avgGrade-v.avgGrade);ue(j),Pe(k)},We=async()=>{if(l.length===0){ie(null);return}const a=c==="all"?90:Number.parseInt(c,10)||30,p=oe(new Date,a);try{const{data:x,error:_}=await O.from("plagiarism_checks_v2").select(`
          similarity_percentage,
          plagiarism_severity,
          checked_at,
          activity_id,
          submission_id,
          activities!inner(activity_class_assignments!inner(class_id))
        `).in("activities.activity_class_assignments.class_id",l).gte("checked_at",p.toISOString()).limit(1e3);_&&G.error("Erro ao carregar estat√≠sticas de pl√°gio (v2):",_);const y=(x||[]).filter(b=>b.similarity_percentage!=null);if(y.length>0){const b=y.reduce((z,Q)=>{const re=Number.parseFloat(Q.similarity_percentage),ae=Number.isNaN(re)?0:re;return z+(100-ae)},0)/y.length,T=["high","critical"],N=y.filter(z=>T.includes((z.plagiarism_severity||"").toLowerCase())).length;ie({avgOriginality:Math.round(b),totalChecks:y.length,casesDetected:N,aiDetected:0});return}const{data:j,error:k}=await O.from("plagiarism_checks").select(`
          plagiarism_percentage,
          ai_generated,
          submission_id,
          submissions!inner(activity_id, activities!inner(activity_class_assignments!inner(class_id)))
        `).in("submissions.activities.activity_class_assignments.class_id",l).gte("checked_at",p.toISOString()).limit(1e3);if(k){G.error("Erro ao carregar estat√≠sticas de pl√°gio (legacy):",k),ie(null);return}const m=(j||[]).filter(b=>b.plagiarism_percentage!=null);if(m.length===0){ie(null);return}const v=m.reduce((b,T)=>{const N=T.plagiarism_percentage||0;return b+(100-N)},0)/m.length,S=m.filter(b=>100-(b.plagiarism_percentage||0)<70).length;ie({avgOriginality:Math.round(v),totalChecks:m.length,casesDetected:S,aiDetected:m.filter(b=>b.ai_generated).length})}catch(x){G.error("Erro ao carregar estat√≠sticas de pl√°gio:",x),ie(null)}},Ve=async()=>{va({uniqueAccess:0,avgSessionTime:0,returnRate:0,interactions:0})},ba=async()=>{try{const a=[];a.push("TamanduAI - Analytics Dashboard"),a.push(`Per√≠odo: √öltimos ${c} dias`),a.push(`Data de Exporta√ß√£o: ${new Date().toLocaleString("pt-BR")}`),a.push(""),a.push("KPIs Principais"),a.push("Indicador,Valor"),a.push(`Total de Alunos,${g.totalStudents}`),a.push(`Total de Atividades,${g.totalActivities}`),a.push(`Corre√ß√µes Pendentes,${g.pendingCorrections}`),a.push(`M√©dia Geral,${g.avgGrade.toFixed(2)}`),a.push(`Taxa de Entrega no Prazo,${g.onTimeRate.toFixed(1)}%`),a.push(""),a.push("Evolu√ß√£o de Notas"),a.push("Dia,M√©dia"),F.forEach(j=>{a.push(`${j.date},${j.media}`)}),a.push(""),a.push("Compara√ß√£o de Turmas"),a.push("Turma,M√©dia"),X.forEach(j=>{a.push(`${j.name},${j.media}`)}),a.push(""),a.push("Top 10 Alunos"),a.push("Posi√ß√£o,Nome,M√©dia,Atividades,Entregas no Prazo (%),Turmas"),me.forEach((j,k)=>{const m=(j.classes||[]).join(" | ");a.push(`${k+1},${j.name},${j.avgGrade.toFixed(2)},${j.activities},${j.onTimeRate},${m}`)});const p=a.join(`
`),x=new Blob([p],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(x),y=document.createElement("a");y.setAttribute("href",_),y.setAttribute("download",`analytics-dashboard-${ke(new Date,"yyyy-MM-dd")}.csv`),document.body.appendChild(y),y.click(),document.body.removeChild(y),t({title:"‚úÖ Dashboard exportado!",description:"Arquivo CSV baixado com sucesso"})}catch(a){G.error("Erro ao exportar:",a),t({title:"‚ùå Erro ao exportar",description:a.message,variant:"destructive"})}},ja=async()=>{try{await za({period:c,kpis:g,gradeEvolution:F,classComparison:X,gradeDistribution:V,weeklyTrends:Se,topStudents:me,bottomStudents:De}),t({title:"‚úÖ Dashboard exportado!",description:"PDF gerado com sucesso"})}catch(a){G.error("Erro ao exportar PDF:",a),t({title:"‚ùå Erro ao exportar PDF",description:a.message,variant:"destructive"})}},Na=()=>{const a=[];g.avgGrade<6&&a.push("‚ö†Ô∏è M√©dia da turma est√° abaixo de 6.0"),g.pendingCorrections>10&&a.push(`‚ö†Ô∏è ${g.pendingCorrections} corre√ß√µes pendentes`),g.onTimeRate<70&&a.push(`‚ö†Ô∏è Taxa de entrega no prazo est√° em ${g.onTimeRate.toFixed(1)}%`),a.length>0?t({title:"üîî Alertas Ativos",description:a.join(" ‚Ä¢ "),duration:5e3}):t({title:"‚úÖ Tudo certo!",description:"Nenhum alerta ativo no momento"})},_a=()=>{d("30"),f(h.map(a=>a.id)),C(["all"]),L(["graded"]),E([]),R([]),W(null),t({title:"Filtros limpos"})};return i&&u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ea,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(Oa,{title:"Analytics e Insights",subtitle:"An√°lise completa de desempenho e tend√™ncias",role:"teacher",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(pe,{variant:"outline",onClick:Na,children:[e.jsx(La,{className:"w-4 h-4 mr-2"}),"Configurar Alertas"]}),e.jsxs(Da,{children:[e.jsx(Pa,{asChild:!0,children:e.jsxs(pe,{variant:"outline",children:[e.jsx(Ra,{className:"w-4 h-4 mr-2"}),"Exportar"]})}),e.jsxs(Ia,{align:"end",children:[e.jsx(Ue,{onClick:ba,children:"Exportar CSV"}),e.jsx(Ue,{onClick:ja,children:"Exportar PDF"})]})]})]})}),e.jsxs(J,{className:"p-6 mb-6 sticky top-0 z-10 bg-white dark:bg-slate-900 shadow-lg",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[e.jsx(Ga,{className:"w-4 h-4 inline mr-2"}),"Per√≠odo"]}),e.jsxs(xe,{value:c,onValueChange:d,children:[e.jsx(he,{children:e.jsx(ge,{})}),e.jsxs(ve,{children:[e.jsx(Y,{value:"7",children:"√öltimos 7 dias"}),e.jsx(Y,{value:"15",children:"√öltimos 15 dias"}),e.jsx(Y,{value:"30",children:"√öltimos 30 dias"}),e.jsx(Y,{value:"60",children:"√öltimos 60 dias"}),e.jsx(Y,{value:"90",children:"√öltimos 90 dias"}),e.jsx(Y,{value:"180",children:"√öltimos 180 dias"}),e.jsx(Y,{value:"all",children:"Todo o Per√≠odo"})]})]})]}),e.jsxs("div",{className:"flex-1 min-w-[250px]",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[e.jsx(Te,{className:"w-4 h-4 inline mr-2"}),"Turmas"]}),e.jsxs(xe,{value:h.length===0||l.length===h.length||l.length===0?"all":l[0],onValueChange:a=>{f(a==="all"?h.map(p=>p.id):[a])},children:[e.jsx(he,{children:e.jsx(ge,{placeholder:h.length===0?"Nenhuma turma ativa":"Todas as turmas"})}),e.jsxs(ve,{children:[e.jsx(Y,{value:"all",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Todas as turmas"]})}),h.map(a=>e.jsxs(Y,{value:a.id,children:[a.name," ",a.subject&&`- ${a.subject}`]},a.id))]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(pe,{variant:"outline",onClick:_a,children:"Limpar"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ta,{checked:D,onCheckedChange:U,id:"auto-refresh"}),e.jsx("label",{htmlFor:"auto-refresh",className:"text-sm cursor-pointer",children:"Auto-atualizar (5min)"})]})]}),l.length>0&&l.length<h.length&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:l.map(a=>{const p=h.find(x=>x.id===a);return p?e.jsxs(qe,{variant:"secondary",className:"text-xs",children:[p.name,e.jsx("button",{onClick:()=>f(l.filter(x=>x!==a)),className:"ml-1 hover:text-red-500",children:"√ó"})]},a):null})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-8",children:[e.jsx(ne,{title:"Total de Alunos",value:g.totalStudents,icon:Te,gradient:ee.primary,bgColor:"bg-blue-50 dark:bg-blue-950/30"}),e.jsx(ne,{title:"Atividades Postadas",value:g.totalActivities,icon:Ba,gradient:ee.info,bgColor:"bg-cyan-50 dark:bg-cyan-950/30"}),e.jsx(ne,{title:"Atividades Abertas",value:g.openActivities,icon:$a,gradient:ee.warning,bgColor:"bg-yellow-50 dark:bg-yellow-950/30"}),e.jsx(ne,{title:"Aguardando Corre√ß√£o",value:g.pendingCorrections,icon:Ka,gradient:ee.danger,bgColor:"bg-red-50 dark:bg-red-950/30"}),e.jsx(ne,{title:"Nota M√©dia Geral",value:g.avgGrade.toFixed(1),icon:Wa,gradient:g.avgGrade>=7?ee.success:g.avgGrade>=5?ee.warning:ee.danger,bgColor:g.avgGrade>=7?"bg-green-50 dark:bg-green-950/30":"bg-yellow-50 dark:bg-yellow-950/30"}),e.jsx(ne,{title:"Taxa Entrega no Prazo",value:`${g.onTimeRate.toFixed(1)}%`,icon:Va,gradient:ee.success,bgColor:"bg-green-50 dark:bg-green-950/30",format:"text"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40",children:e.jsx(Pt,{className:"w-5 h-5 text-blue-600 dark:text-blue-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Evolu√ß√£o das notas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"M√©dia por dia de corre√ß√£o no per√≠odo selecionado"})]})]})}),F.length>0?e.jsx("div",{className:"h-64",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(ss,{data:F,margin:{left:-20,right:10},children:[e.jsx(ye,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(be,{dataKey:"date",tick:{fontSize:10}}),e.jsx(je,{domain:[0,10],tick:{fontSize:10}}),e.jsx(Ne,{labelFormatter:a=>`Dia ${a}`,formatter:a=>[`M√©dia ${a.toFixed(2)}`,"Nota"]}),e.jsx(ga,{type:"monotone",dataKey:"media",stroke:"#2563EB",fillOpacity:.15,fill:"#60A5FA"})]})})}):e.jsx("p",{className:"text-xs text-slate-500",children:"Ainda n√£o h√° notas suficientes para calcular a evolu√ß√£o."})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100 dark:bg-emerald-900/40",children:e.jsx(Oe,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Tend√™ncia semanal de entregas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Entregues no prazo x atrasadas (√∫ltimas 12 semanas)"})]})]})}),Se.length>0?e.jsx("div",{className:"h-64",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Me,{data:Se,margin:{left:-20,right:10},children:[e.jsx(ye,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(be,{dataKey:"week",tick:{fontSize:10}}),e.jsx(je,{tick:{fontSize:10}}),e.jsx(Ne,{}),e.jsx(kt,{}),e.jsx(_e,{dataKey:"noPrazo",name:"No prazo",stackId:"a",fill:"#22C55E"}),e.jsx(_e,{dataKey:"atrasadas",name:"Atrasadas",stackId:"a",fill:"#F97316"})]})})}):e.jsx("p",{className:"text-xs text-slate-500",children:"Nenhuma entrega registrada neste per√≠odo."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8",children:[e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-100 dark:bg-indigo-900/40",children:e.jsx(At,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Distribui√ß√£o de notas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Faixas de desempenho das avalia√ß√µes"})]})]})}),V.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-56",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Me,{data:V,children:[e.jsx(ye,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(be,{dataKey:"range",tick:{fontSize:10}}),e.jsx(je,{tick:{fontSize:10}}),e.jsx(Ne,{}),e.jsx(_e,{dataKey:"count",children:V.map((a,p)=>e.jsx(Je,{fill:a.color},p))})]})})}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2",children:[e.jsx(qe,{variant:"outline",className:"text-[10px]",children:"‚úì Notas normalizadas para escala 0-10"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"As notas s√£o exibidas em faixas de 0 a 10 apenas para visualiza√ß√£o."})]})]}):e.jsx("p",{className:"text-xs text-slate-500",children:"Nenhuma nota registrada ainda para montar a distribui√ß√£o."})]}),e.jsxs(J,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/40",children:e.jsx(Oe,{className:"w-5 h-5 text-purple-600 dark:text-purple-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Compara√ß√£o entre turmas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"M√©dia geral por turma"})]})]}),h.length>=2&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"Turmas para comparar"}),e.jsxs(xe,{value:A[0]||"",onValueChange:a=>{E(p=>{const[,x]=p||[];return[a,x||""]})},children:[e.jsx(he,{className:"h-8 w-32 text-xs",children:e.jsx(ge,{placeholder:"Turma 1"})}),e.jsx(ve,{children:h.map(a=>e.jsx(Y,{value:a.id,children:a.name},a.id))})]}),e.jsxs(xe,{value:A[1]||"",onValueChange:a=>{E(p=>{const[x]=p||[];return[x||"",a]})},children:[e.jsx(he,{className:"h-8 w-32 text-xs",children:e.jsx(ge,{placeholder:"Turma 2"})}),e.jsx(ve,{children:h.map(a=>e.jsx(Y,{value:a.id,children:a.name},a.id))})]})]})]}),X.length>0?e.jsx("div",{className:"h-56 overflow-x-auto",children:e.jsx("div",{className:X.length>6?"min-w-[640px]":"min-w-full",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Me,{data:X,children:[e.jsx(ye,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(be,{dataKey:"name",tick:{fontSize:10}}),e.jsx(je,{domain:[0,10],tick:{fontSize:10}}),e.jsx(Ne,{}),e.jsx(_e,{dataKey:"media",name:"M√©dia",children:X.map((a,p)=>e.jsx(Je,{fill:a.color||"#3B82F6"},p))})]})})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-xs text-slate-500 dark:text-slate-400 text-center",children:[e.jsx(Oe,{className:"w-6 h-6 mb-2 text-purple-400"}),M?.type==="not_enough_total"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"Poucas turmas cadastradas"}),e.jsx("p",{children:"Crie pelo menos duas turmas para visualizar a compara√ß√£o."})]}):M?.type==="need_two"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"Selecione duas turmas"}),e.jsx("p",{children:"Use os seletores acima para escolher duas turmas para comparar."})]}):M?.type==="no_grades"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"Sem notas registradas"}),e.jsx("p",{children:"Ainda n√£o h√° notas lan√ßadas para as turmas selecionadas no per√≠odo escolhido para montar a compara√ß√£o."})]}):M?.type==="error"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"Erro ao carregar dados"}),e.jsx("p",{children:"Tente atualizar a p√°gina ou ajustar os filtros."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"Sem dados suficientes"}),e.jsx("p",{children:"Configure as turmas de compara√ß√£o acima para visualizar o gr√°fico."})]})]})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100 dark:bg-emerald-900/40",children:e.jsx(wt,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Originalidade e pl√°gio"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Resumo das verifica√ß√µes de pl√°gio"})]})]})}),se?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 text-xs",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Originalidade m√©dia"}),e.jsxs("span",{className:"font-semibold text-emerald-600 dark:text-emerald-300",children:[se.avgOriginality,"%"]})]}),e.jsx(Fa,{value:se.avgOriginality,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Verifica√ß√µes realizadas"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:se.totalChecks})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/40",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Casos cr√≠ticos"}),e.jsx("p",{className:"text-lg font-semibold text-amber-700 dark:text-amber-300",children:se.casesDetected})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/40",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Poss√≠vel IA"}),e.jsx("p",{className:"text-lg font-semibold text-purple-700 dark:text-purple-300",children:se.aiDetected})]})]})]}):e.jsxs("div",{className:"space-y-2 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("p",{children:"Nenhuma verifica√ß√£o de pl√°gio registrada neste per√≠odo para as turmas selecionadas."}),e.jsx("p",{children:"Quando voc√™ utilizar o detector de pl√°gio nas corre√ß√µes, um resumo com originalidade e casos cr√≠ticos aparecer√° aqui."})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12",children:[e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40",children:e.jsx(Ct,{className:"w-5 h-5 text-blue-600 dark:text-blue-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Top alunos"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Desempenho m√©dio dos alunos mais ativos"})]})]})}),me.length>0?e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto pr-1",children:me.map((a,p)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-900/60",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:(a.name||"?").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-900 dark:text-slate-50",children:[p+1,". ",a.name]}),e.jsxs("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:[a.activities," atividades ‚Ä¢ ",a.onTimeRate,"% no prazo"]}),a.classes&&a.classes.length>0&&e.jsxs("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-0.5",children:["Turmas: ",a.classes.join(", ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:a.avgGrade.toFixed(1)}),e.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"nota m√©dia"})]})]},a.id))}):e.jsx("p",{className:"text-xs text-slate-500",children:"Ainda n√£o h√° dados suficientes para ranquear os alunos."}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h3",{className:"text-sm font-semibold text-slate-900 dark:text-slate-50 flex items-center gap-1",children:[e.jsx(St,{className:"w-4 h-4 text-amber-500"}),"Alunos que precisam de aten√ß√£o"]})}),De.length>0?e.jsx("div",{className:"space-y-2 max-h-56 overflow-y-auto pr-1",children:De.map((a,p)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-amber-50/60 dark:bg-amber-900/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center text-white text-[11px] font-bold",children:(a.name||"?").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-semibold text-slate-900 dark:text-slate-50",children:[p+1,". ",a.name]}),e.jsxs("p",{className:"text-[10px] text-slate-600 dark:text-slate-400",children:[a.activities," atividades ‚Ä¢ ",a.onTimeRate,"% no prazo"]}),a.classes&&a.classes.length>0&&e.jsxs("p",{className:"text-[10px] text-slate-500 dark:text-slate-500 mt-0.5",children:["Turmas: ",a.classes.join(", ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-amber-700 dark:text-amber-300",children:a.avgGrade.toFixed(1)}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"nota m√©dia"}),e.jsx(pe,{size:"sm",variant:"outline",className:"mt-1 text-xs h-6 px-2",onClick:()=>{window.location.href=`/dashboard/students/${a.id}`},children:"Ver Detalhes"})]})]},a.id))}):e.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"Nenhum aluno em destaque negativo neste per√≠odo."})]})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-sky-100 dark:bg-sky-900/40",children:e.jsx(Et,{className:"w-5 h-5 text-sky-600 dark:text-sky-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Engajamento (beta)"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Vis√£o geral do engajamento dos alunos"})]})]})}),e.jsxs("div",{className:"space-y-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("p",{children:"Estes indicadores ser√£o enriquecidos com dados de uso da plataforma (acessos, tempo de sess√£o, intera√ß√µes). Por enquanto, use as demais m√©tricas para monitorar participa√ß√£o e desempenho."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Acessos √∫nicos (em breve)"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Tempo m√©dio de estudo"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Taxa de retorno"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Intera√ß√µes na plataforma"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]})]})]})]})]})]})};export{pi as default};
