import{s as l,l as w}from"./main-BtydHokz.js";function y(t,e,r={}){const{easy_multiplier:a=2.5,good_multiplier:o=1,hard_multiplier:c=.5,max_interval_days:g=365,graduating_interval:d=1,easy_interval:_=4}=r;let{easiness_factor:s=2.5,interval_days:f=0,repetitions:u=0}=t,n=s,i=f,h=u,m=t.card_status||"new";if(e>=0&&e<=4){const b=.1-(3-e)*(.08+(3-e)*.02);n=s+b,n=Math.max(1.3,n),n=Math.min(3,n),n=Math.round(n*100)/100}if(e<2)h=0,i=0,m=m==="new"?"learning":"relearning";else if(m==="new")e===4?(i=_,h=1,m="young"):(i=d,h=1,m="learning");else if(m==="learning"||m==="relearning")e===4?(i=_,h=2,m="young"):(i=d,h=1,m="young");else{switch(h+=1,e){case 4:h===1?i=1:h===2?i=6:i=Math.round(f*n*a);break;case 3:h===1?i=1:h===2?i=6:i=Math.round(f*n*o);break;case 2:h===1?i=1:i=Math.max(1,Math.round(f*c));break;default:i=1}i=Math.min(i,g),i>=21?m="mature":m="young"}const D=new Date,v=new Date(D);return v.setDate(v.getDate()+i),{easiness_factor:n,interval_days:i,repetitions:h,card_status:m,next_review_at:v.toISOString()}}function G(t,e={}){return[{value:0,label:"Repetir",color:"red"},{value:1,label:"Difícil",color:"orange"},{value:2,label:"Bom",color:"blue"},{value:3,label:"Fácil",color:"green"},{value:4,label:"Perfeito",color:"emerald"}].map(a=>{const o=y(t,a.value,e);return{...a,interval_days:o.interval_days,next_review_at:o.next_review_at,formatted_interval:E(o.interval_days)}})}function E(t){if(t===0)return"Agora";if(t===1)return"1 dia";if(t<7)return`${t} dias`;if(t<30){const r=Math.round(t/7);return r===1?"1 semana":`${r} semanas`}if(t<365){const r=Math.round(t/30);return r===1?"1 mês":`${r} meses`}const e=Math.round(t/365);return e===1?"1 ano":`${e} anos`}function Q(t){const e={0:{label:"Repetir",description:"Não lembrei",color:"red",icon:"X",shortcut:"1"},1:{label:"Difícil",description:"Lembrei com muita dificuldade",color:"orange",icon:"AlertCircle",shortcut:"2"},2:{label:"Bom",description:"Lembrei com algum esforço",color:"blue",icon:"Check",shortcut:"3"},3:{label:"Fácil",description:"Lembrei facilmente",color:"green",icon:"CheckCircle",shortcut:"4"},4:{label:"Perfeito",description:"Resposta perfeita e imediata",color:"emerald",icon:"Sparkles",shortcut:"5"}};return e[t]||e[2]}function S(t,e){return e===0?0:Math.round(t/e*100)}function X(t,e=7){const r=[],a=new Date;a.setHours(0,0,0,0);for(let o=0;o<e;o++){const c=new Date(a);c.setDate(c.getDate()+o);const g=new Date(c);g.setDate(g.getDate()+1);const d=t.filter(_=>{const s=new Date(_.next_review_at);return s>=c&&s<g});r.push({date:c.toISOString().split("T")[0],count:d.length,new_cards:d.filter(_=>_.card_status==="new").length,review_cards:d.filter(_=>_.card_status!=="new").length})}return r}function q(t,e={}){const{include_new:r=!0,include_learning:a=!0,include_review:o=!0,max_new:c=20,max_reviews:g=200,order:d="random"}=e,_=new Date;let s=t.filter(n=>{if(n.is_suspended)return!1;if(n.card_status==="new")return r;if(!n.next_review_at)return o;const i=new Date(n.next_review_at);if(isNaN(i.getTime()))return o;const h=i<=_;return n.card_status==="learning"||n.card_status==="relearning"?a&&h:o&&h});const f=s.filter(n=>n.card_status==="new").slice(0,c),u=s.filter(n=>n.card_status!=="new").slice(0,g);switch(s=[...f,...u],d){case"difficulty":s.sort((n,i)=>n.easiness_factor-i.easiness_factor);break;case"chronological":s.sort((n,i)=>new Date(n.next_review_at)-new Date(i.next_review_at));break;case"random":default:for(let n=s.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[s[n],s[i]]=[s[i],s[n]]}break}return s}function z(t,e="today"){const r=new Date;let a=new Date(r);switch(e){case"today":a.setHours(0,0,0,0);break;case"week":a.setDate(a.getDate()-7);break;case"month":a.setDate(a.getDate()-30);break;case"all":a=new Date(0);break}const o=t.filter(u=>new Date(u.reviewed_at)>=a),c=o.length,g=o.filter(u=>u.quality>=2).length,d=o.reduce((u,n)=>u+(n.time_taken_ms||0),0),_=c>0?Math.round(d/c):0,s={};o.forEach(u=>{const n=new Date(u.reviewed_at).toISOString().split("T")[0];s[n]||(s[n]={date:n,reviews:0,correct:0}),s[n].reviews++,u.quality>=2&&s[n].correct++});const f=Object.values(s).sort((u,n)=>new Date(u.date)-new Date(n.date));return{total_reviews:c,correct_reviews:g,incorrect_reviews:c-g,retention_rate:S(g,c),average_time_ms:_,total_time_ms:d,chart_data:f}}async function k(t){try{const{data:e,error:r}=await l.from("decks").select(`
        *,
        deck_stats(*)
      `).eq("user_id",t).order("updated_at",{ascending:!1});if(r)throw r;return{data:e,error:null}}catch(e){return w.error("Error fetching decks:",e),{data:null,error:e}}}async function C(t){try{const{data:e,error:r}=await l.from("decks").select(`
        *,
        deck_stats(*)
      `).eq("id",t).single();if(r)throw r;return{data:e,error:null}}catch(e){return w.error("Error fetching deck:",e),{data:null,error:e}}}async function x(t){try{const{data:e,error:r}=await l.from("decks").insert([t]).select().single();if(r)throw r;return await l.from("deck_stats").insert([{deck_id:e.id,user_id:t.user_id}]),{data:e,error:null}}catch(e){return w.error("Error creating deck:",e),{data:null,error:e}}}async function M(t,e){try{const{data:r,error:a}=await l.from("decks").update(e).eq("id",t).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return w.error("Error updating deck:",r),{data:null,error:r}}}async function R(t){try{const{error:e}=await l.from("decks").delete().eq("id",t);if(e)throw e;return{error:null}}catch(e){return w.error("Error deleting deck:",e),{error:e}}}async function T(t){try{const{data:e,error:r}=await l.from("cards").select(`
        *,
        card_stats(*)
      `).eq("deck_id",t).order("created_at",{ascending:!1});if(r)throw r;return{data:e,error:null}}catch(e){return w.error("Error fetching cards:",e),{data:null,error:e}}}async function B(t,e,r={}){try{let a=l.from("cards").select(`
        *,
        card_stats(*),
        deck:decks(name, color)
      `).eq("user_id",t);e&&(a=a.textSearch("fts",e,{type:"websearch",config:"portuguese"})),r.deck_id&&(a=a.eq("deck_id",r.deck_id)),r.tags&&r.tags.length>0&&(a=a.contains("tags",r.tags)),r.card_type&&(a=a.eq("card_type",r.card_type)),r.is_suspended!==void 0&&(a=a.eq("is_suspended",r.is_suspended));const{data:o,error:c}=await a.limit(100);if(c)throw c;return{data:o,error:null}}catch(a){return w.error("Error searching cards:",a),{data:null,error:a}}}async function I(t){try{const{data:e,error:r}=await l.from("cards").insert([t]).select().single();if(r)throw r;return{data:e,error:null}}catch(e){return w.error("Error creating card:",e),{data:null,error:e}}}async function O(t){try{const{error:e}=await l.from("cards").insert(t);if(e)throw e;return{data:null,error:null}}catch(e){return w.error("Error creating cards:",e),{data:null,error:e}}}async function p(t,e){try{const{data:r,error:a}=await l.from("cards").update(e).eq("id",t).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return w.error("Error updating card:",r),{data:null,error:r}}}async function A(t){try{const{error:e}=await l.from("cards").delete().eq("id",t);if(e)throw e;return{error:null}}catch(e){return w.error("Error deleting card:",e),{error:e}}}async function F(t,e=!0){return p(t,{is_suspended:e})}async function H(t,e,r={}){try{const{data:a,error:o}=await l.from("cards").select(`
        *,
        card_stats(*)
      `).eq("deck_id",t).eq("user_id",e).eq("is_suspended",!1);if(o)throw o;const c=a.map(d=>{const _=Array.isArray(d.card_stats)?d.card_stats[0]:d.card_stats,s=d.id;return{...d,..._,id:s,card_stats:void 0}});return{data:q(c,r),error:null}}catch(a){return w.error("Error getting due cards:",a),{data:null,error:a}}}async function N(t,e,r,a,o={}){try{const{data:c,error:g}=await l.from("card_stats").select("*").eq("card_id",t).eq("user_id",e).single();if(g)throw g;const d=y(c,r,o),{error:_}=await l.from("card_reviews").insert([{card_id:t,user_id:e,quality:r,easiness_factor:d.easiness_factor,interval_days:d.interval_days,repetitions:d.repetitions,time_taken_ms:a}]);if(_)throw _;const s=r>=2?1:0,{data:f,error:u}=await l.from("card_stats").update({...d,last_reviewed_at:new Date().toISOString(),total_reviews:c.total_reviews+1,correct_reviews:c.correct_reviews+s,incorrect_reviews:c.incorrect_reviews+(1-s),retention_rate:(c.correct_reviews+s)/(c.total_reviews+1)*100}).eq("card_id",t).eq("user_id",e).select().single();if(u)throw u;return{data:f,error:null}}catch(c){return w.error("Error submitting review:",c),{data:null,error:c}}}async function $(t,e){try{const{data:r,error:a}=await l.from("deck_stats").select("*").eq("deck_id",t).eq("user_id",e).single();if(a)throw a;return{data:r,error:null}}catch(r){return w.error("Error fetching deck stats:",r),{data:null,error:r}}}async function L(t,e={}){try{let r=l.from("card_reviews").select(`
        *,
        card:cards(front, back, deck_id)
      `).eq("user_id",t).order("reviewed_at",{ascending:!1});e.card_id&&(r=r.eq("card_id",e.card_id)),e.from_date&&(r=r.gte("reviewed_at",e.from_date)),e.to_date&&(r=r.lte("reviewed_at",e.to_date)),e.limit&&(r=r.limit(e.limit));const{data:a,error:o}=await r;if(o)throw o;return{data:a,error:null}}catch(r){return w.error("Error fetching review history:",r),{data:null,error:r}}}async function P(t){try{const{data:e}=await k(t);if(e&&e.length>0){const s=e.map(n=>n.id),{data:f}=await l.from("cards").select("deck_id").in("deck_id",s).eq("user_id",t),u={};f&&f.forEach(n=>{u[n.deck_id]=(u[n.deck_id]||0)+1}),e.forEach(n=>{n.total_cards=u[n.id]||0})}const r=new Date;r.setHours(0,0,0,0);const{data:a}=await l.from("card_reviews").select("*").eq("user_id",t).gte("reviewed_at",r.toISOString()),o=e?.length||0,c=e?.reduce((s,f)=>s+(f.total_cards||0),0)||0,g=e?.reduce((s,f)=>s+(f.deck_stats?.[0]?.cards_due_today||0),0)||0,d=a?.length||0;return{data:{total_decks:o,total_cards:c,cards_due_today:g,reviews_today:d,decks:e},error:null}}catch(e){return w.error("Error fetching user stats:",e),{data:null,error:e}}}async function U(t){try{let{data:e,error:r}=await l.from("flashcard_user_settings").select("*").eq("user_id",t).single();if(r&&r.code==="PGRST116"){const{data:a,error:o}=await l.from("flashcard_user_settings").insert([{user_id:t}]).select().single();if(o)throw o;return{data:a,error:null}}if(r)throw r;return{data:e,error:null}}catch(e){return w.error("Error fetching user settings:",e),{data:null,error:e}}}async function j(t,e){try{const{data:r,error:a}=await l.from("flashcard_user_settings").update(e).eq("user_id",t).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return w.error("Error updating user settings:",r),{data:null,error:r}}}const J={getDecks:k,getDeckById:C,createDeck:x,updateDeck:M,deleteDeck:R,getCardsInDeck:T,searchCards:B,createCard:I,createCards:O,updateCard:p,deleteCard:A,suspendCard:F,getDueCardsForReview:H,submitReview:N,getDeckStats:$,getReviewHistory:L,getUserStats:P,getUserSettings:U,updateUserSettings:j};export{G as a,Q as b,z as c,J as f,q as g,X as p};
