import{u as P,a as q,r,s as f,j as e,i as z}from"./main-vCmkj0Ph.js";import{C as I}from"./card-QZFCDucj.js";import{B as R}from"./badge-DYNIDruK.js";import{T as G,a as H,b as m,c as u}from"./tabs-DESQXg6q.js";import{S as b}from"./StatsCard-DsNwPDbG.js";import{D as M}from"./dropdown-menu-CRv4RkRy.js";import{E as V}from"./EmptyState-BSzsQ55S.js";import"./label-DA0WPkHe.js";import{C}from"./clock-BTS0eNcV.js";import{C as $}from"./circle-check-big-C2wc7EfX.js";import{C as J}from"./circle-alert-CMpGX98n.js";import{F as S}from"./file-text-BrP95lln.js";import"./index-DF9gUw3L.js";import"./chevron-right-DOiZ8o1C.js";const re=()=>{const A=P(),{user:d}=q(),[D,g]=r.useState(!0),[n,E]=r.useState([]),[k,T]=r.useState([]),[i,y]=r.useState({pending:0,completed:0,late:0});r.useEffect(()=>{B()},[d]);const B=async()=>{if(d)try{g(!0);const{data:s}=await f.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),t=s?.map(a=>a.class_id)||[];if(t.length===0){g(!1);return}const{data:o}=await f.from("activity_class_assignments").select(`
          activity_id,
          class_id,
          class:classes (id, name, subject, color),
          activity:activities (
            id,
            title,
            description,
            due_date,
            max_score,
            type,
            status,
            created_at
          )
        `).in("class_id",t),l=(o||[]).map(a=>({...a.activity,class:a.class})).filter(Boolean);E(l);const x=l.map(a=>a.id),{data:j}=await f.from("submissions").select("*").eq("student_id",d.id).in("activity_id",x);T(j||[]);const L=new Date;let v=0,_=0,N=0;l.forEach(a=>{const w=j?.find(F=>F.activity_id===a.id);w?w.grade!==null&&_++:a.due_date&&new Date(a.due_date)<L?N++:v++}),y({pending:v,completed:_,late:N})}catch(s){console.error("Erro:",s)}finally{g(!1)}},h=s=>{const t=k.find(x=>x.activity_id===s.id),o=new Date,l=s.due_date?new Date(s.due_date):null;return t?t.grade!==null?{status:"completed",label:"Concluída",color:"bg-green-100 text-green-700"}:{status:"submitted",label:"Enviada",color:"bg-blue-100 text-blue-700"}:l&&l<o?{status:"late",label:"Atrasada",color:"bg-red-100 text-red-700"}:{status:"pending",label:"Pendente",color:"bg-amber-100 text-amber-700"}},p=s=>n.filter(t=>h(t).status===s),c=({activity:s})=>{const t=h(s);return e.jsxs(I,{onClick:()=>A(`/student/activities/${s.id}`),className:"p-6 cursor-pointer hover:shadow-lg transition-all bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:s.class?.color||"#3B82F6"},children:e.jsx(S,{className:"w-5 h-5 text-white"})}),e.jsx(R,{className:t.color,children:t.label})]}),e.jsx("h3",{className:"font-bold mb-2",children:s.title}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:[s.class?.name," • ",s.class?.subject]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:s.due_date?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 inline mr-1"}),new Date(s.due_date).toLocaleDateString("pt-BR")]}):"Sem prazo"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[s.max_score," pts"]})]})]})};return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(z,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(M,{title:"Minhas Atividades",subtitle:"Gerencie suas tarefas e entregas",role:"student"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(b,{title:"Pendentes",value:i.pending,icon:C,gradient:"from-amber-500 to-orange-500",delay:0}),e.jsx(b,{title:"Concluídas",value:i.completed,icon:$,gradient:"from-green-500 to-emerald-500",delay:.1}),e.jsx(b,{title:"Atrasadas",value:i.late,icon:J,gradient:"from-red-500 to-rose-500",delay:.2})]}),e.jsxs(G,{defaultValue:"all",className:"w-full",children:[e.jsxs(H,{className:"mb-6",children:[e.jsxs(m,{value:"all",children:["Todas (",n.length,")"]}),e.jsxs(m,{value:"pending",children:["Pendentes (",i.pending,")"]}),e.jsxs(m,{value:"completed",children:["Concluídas (",i.completed,")"]}),e.jsxs(m,{value:"late",children:["Atrasadas (",i.late,")"]})]}),e.jsx(u,{value:"all",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(s=>e.jsx(c,{activity:s},s.id))})}),e.jsx(u,{value:"pending",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p("pending").map(s=>e.jsx(c,{activity:s},s.id))})}),e.jsx(u,{value:"completed",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p("completed").map(s=>e.jsx(c,{activity:s},s.id))})}),e.jsx(u,{value:"late",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p("late").map(s=>e.jsx(c,{activity:s},s.id))})})]}),n.length===0&&e.jsx(V,{icon:S,title:"Nenhuma atividade encontrada",description:"Entre em uma turma para ver atividades"})]})};export{re as default};
