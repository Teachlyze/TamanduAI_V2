import{c as Ge,u as es,r as i,s as S,l as $,j as e,m as ie,g as ss,e as ts,o as As,a as Es,p as Ds}from"./main-KTzSHcut.js";import{m as H,B as M}from"./button-Ch10pVNC.js";import{C as x}from"./card-D1C_XPb6.js";import{B as U,A as os,c as Ms}from"./SidebarPremium-Bjey2152.js";import{t as u}from"./use-toast-Dl4X8ZMv.js";import{r as Le}from"./redisCache-C5lAJ-QK.js";import{U as le}from"./users-BaZp6eLM.js";import{T as Ce}from"./trending-up-BsXLUj7W.js";import{C as ae}from"./circle-check-big-7fo8IdEE.js";import{C as Fe}from"./clock-Ca1Xubpl.js";import{C as re}from"./index-Bp0dZcFm.js";import{P as ne}from"./plus-DCFQf4Ef.js";import{F as Q}from"./file-text-DYnGBvGu.js";import{C as oe}from"./circle-alert-Czyt50tS.js";import{M as ge,I as $e,P as We}from"./pin-DWtjUHcW.js";import{S as Ts}from"./square-check-big-BK5WcWjp.js";import{c as qs,P as as}from"./index-sBzZX1-K.js";import{b as Ps,e as Ze}from"./index-BpWMJgsg.js";import{r as Rs}from"./index-wM7q3PNH.js";import{D as Se,a as Ae,b as Ee,c as I,d as De}from"./dropdown-menu-CFKsTZzS.js";import{S as X,a as Y,b as ee,c as se,d as _}from"./select-CopAKCqT.js";import{X as je}from"./x-ZCLeMxGr.js";import{V as ze}from"./video-CZubiwiU.js";import{L as Oe}from"./link-bPwQSkIB.js";import{U as gs}from"./upload-Dv_J8QNP.js";import{T as Be}from"./triangle-alert-CVkDYYk3.js";import{E as be}from"./ellipsis-vertical-DgIylDmA.js";import{E as xe}from"./eye-B5rNRoor.js";import{D as _e}from"./download-DmhiuLGw.js";import{S as Me}from"./square-pen-B2UAy1WY.js";import{T as Ue}from"./trash-2-CFeWlj6l.js";import{M as rs}from"./message-square-DQuEZT1L.js";import{f as ve}from"./formatDistanceToNow-D7eyLJlI.js";import{p as ce}from"./pt-BR-CXWZr0Zs.js";import{I as Ve}from"./info-B9QXRGZx.js";import{B as cs}from"./bell-B4NUN7bW.js";import{I as Ie}from"./input-CKizEs14.js";import{B as Ke}from"./book-open-dxp_3U19.js";import{S as pe}from"./search-CbOh-JcF.js";import{P as he}from"./progress-CLM8R6un.js";import{f as fe}from"./format-CxHpq9RK.js";import{t as fs}from"./en-US-azV9x4mt.js";import{C as Je}from"./clipboard-list-BYQ0TGL3.js";import{A as Ls}from"./archive-C05HnvBb.js";import{a as Fs}from"./addDays-TIrBYM62.js";import{c as $s}from"./constructNow-C8CNs5uJ.js";import{i as zs}from"./isSameDay-7UPP47mY.js";import{i as ue}from"./isToday-DbOgdeJ3.js";import{C as Xe}from"./copy-DXaMUfbW.js";import{U as ms}from"./user-plus-BMQFxiHA.js";import{M as Os}from"./mail-BvotnHqw.js";import{T as xs}from"./target-CQ0DvT5W.js";import{B as qe}from"./bot-CtW4Igcb.js";import{Z as Bs}from"./zap-9zidiSBF.js";import{B as us}from"./brain-DTHU0HpH.js";import{S as vs}from"./settings-BYjJE2lM.js";import{A as Vs}from"./arrow-left-C_Z1RXOs.js";import"./user-CWyOXzMq.js";import"./graduation-cap-ArnOenSA.js";import"./chart-column-BJvjjOHx.js";import"./Combination-CGrYuS6N.js";import"./index-BMHZaHkZ.js";import"./chevron-right-DlLEuI3N.js";import"./check-GWOQjZuW.js";import"./index-DiimN8vU.js";import"./chevron-down-reY69kiz.js";import"./chevron-up-Bj9q73lY.js";import"./differenceInCalendarMonths-Cr16ZqgI.js";import"./endOfMonth-BvBmjNQ6.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],Ye=Ge("chart-no-axes-column",Gs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Pe=Ge("folder",Us);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Qs=Ge("layout-dashboard",Is);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ws=Ge("user-x",Hs);function Zs(a){return+fs(a)>Date.now()}function Re(a){return+fs(a)<Date.now()}function He(a,v){return zs(a,Fs($s(a),1),v)}const Ks=({classId:a,classData:v,onTabChange:p})=>{const h=es(),[j,m]=i.useState(!0),[l,d]=i.useState({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0}),A=n=>{switch(n){case"Criar Atividade":h(`/dashboard/activities/create?classId=${a}`);break;case"Adicionar Aluno":p?.("students");break;case"Novo Material":p?.("library");break;case"Agendar Aula":u({title:"Em desenvolvimento",description:"FunÃ§Ã£o de agendar aulas serÃ¡ implementada em breve"});break;case"Postar Comunicado":p?.("announcements");break;case"Corrigir Trabalhos":p?.("activities");break}};i.useEffect(()=>{g()},[a]);const g=async()=>{try{m(!0);const n=await Le.getClassStats(a,async()=>{const{data:c}=await S.from("activity_class_assignments").select("activity_id").eq("class_id",a),E=(c||[]).map(C=>C.activity_id),{count:f}=await S.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",a).eq("role","student");if(!E||E.length===0)return{totalStudents:f||0,avgGrade:0,onTimeRate:0,openActivities:0,timestamp:new Date().toISOString()};const{data:k,count:q}=await S.from("submissions").select("grade, submitted_at",{count:"exact"}).in("activity_id",E).not("grade","is",null).limit(1e3),T=k?.filter(C=>C.grade!==null)||[],R=T.length>0?T.reduce((C,D)=>C+parseFloat(D.grade),0)/T.length:0,z=k?.filter(C=>!!C.submitted_at)||[],P=q>0?Math.round(z.length/q*100):0;return{totalStudents:f||0,avgGrade:Number(R.toFixed(1)),onTimeRate:P,openActivities:E.length,timestamp:new Date().toISOString()}});d(n)}catch(n){$.error("Erro ao carregar estatÃ­sticas:",n),d({totalStudents:0,avgGrade:0,onTimeRate:0,openActivities:0})}finally{m(!1)}};if(j)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const o=[{title:"Total de Alunos",value:l.totalStudents,icon:le,color:"blue",change:"+2 esta semana"},{title:"Nota MÃ©dia da Turma",value:l.avgGrade.toFixed(1),icon:Ce,color:l.avgGrade>=7?"green":l.avgGrade>=5?"yellow":"red",change:"+0.3 vs mÃªs anterior"},{title:"Taxa de Entrega no Prazo",value:`${l.onTimeRate}%`,icon:ae,color:l.onTimeRate>=80?"green":l.onTimeRate>=60?"yellow":"red",change:"+5% vs perÃ­odo anterior"},{title:"Atividades em Aberto",value:l.openActivities,icon:Fe,color:l.openActivities>10?"red":l.openActivities>5?"yellow":"blue",change:"3 aguardando correÃ§Ã£o"}],y={blue:"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800",green:"bg-green-50 dark:bg-green-950 text-green-600 dark:text-green-400 border-green-200 dark:border-green-800",yellow:"bg-yellow-50 dark:bg-yellow-950 text-yellow-600 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",red:"bg-red-50 dark:bg-red-950 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800"};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:o.map((n,c)=>{const E=n.icon;return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.1},children:e.jsxs(x,{className:`p-6 border-2 ${y[n.color]}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:`p-3 rounded-lg ${y[n.color]}`,children:e.jsx(E,{className:"w-6 h-6"})})}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:n.value}),e.jsx("div",{className:"text-sm font-medium mb-2",children:n.title}),e.jsx("div",{className:"text-xs opacity-75",children:n.change})]})},n.title)})}),e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Agenda de Aulas"]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>u({title:"Em desenvolvimento",description:"CalendÃ¡rio completo serÃ¡ implementado em breve"}),children:"Ver Completa"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Nenhuma aula agendada nos prÃ³ximos dias"}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>A("Agendar Aula"),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Agendar Aula"]})]})]}),e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-600"}),"Ãšltimas Atividades Postadas"]}),e.jsx(M,{variant:"link",size:"sm",onClick:()=>p?.("activities"),children:"Ver todas"})]}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Q,{className:"w-12 h-12 text-slate-300 dark:text-slate-700 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhuma atividade postada"})]})]}),e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-yellow-600"}),"Alunos que Precisam de AtenÃ§Ã£o"]}),e.jsx(M,{variant:"link",size:"sm",onClick:()=>p?.("students"),children:"Ver todos"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-green-300 dark:text-green-700 mx-auto mb-3"}),e.jsx("p",{className:"text-green-600 dark:text-green-400 font-medium mb-2",children:"Nenhum aluno em situaÃ§Ã£o de alerta"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"ParabÃ©ns! Todos estÃ£o acompanhando bem."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"AÃ§Ãµes RÃ¡pidas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[{icon:ne,label:"Criar Atividade",color:"blue"},{icon:le,label:"Adicionar Aluno",color:"green"},{icon:Q,label:"Novo Material",color:"purple"},{icon:re,label:"Agendar Aula",color:"orange"},{icon:ge,label:"Postar Comunicado",color:"yellow"},{icon:Ts,label:"Corrigir Trabalhos",color:"red"}].map(n=>{const c=n.icon;return e.jsx(x,{className:"p-4 hover:shadow-lg transition-shadow cursor-pointer group",onClick:()=>A(n.label),children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 group-hover:scale-110 transition-transform",children:e.jsx(c,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-sm font-medium",children:n.label})]})},n.label)})})]})]})};var Js=Rs();function Xs(){return Js.useSyncExternalStore(Ys,()=>!0,()=>!1)}function Ys(){return()=>{}}var ls="Avatar",[et]=qs(ls),[st,ps]=et(ls),js=i.forwardRef((a,v)=>{const{__scopeAvatar:p,...h}=a,[j,m]=i.useState("idle");return e.jsx(st,{scope:p,imageLoadingStatus:j,onImageLoadingStatusChange:m,children:e.jsx(as.span,{...h,ref:v})})});js.displayName=ls;var bs="AvatarImage",Ns=i.forwardRef((a,v)=>{const{__scopeAvatar:p,src:h,onLoadingStatusChange:j=()=>{},...m}=a,l=ps(bs,p),d=tt(h,m),A=Ps(g=>{j(g),l.onImageLoadingStatusChange(g)});return Ze(()=>{d!=="idle"&&A(d)},[d,A]),d==="loaded"?e.jsx(as.img,{...m,ref:v,src:h}):null});Ns.displayName=bs;var ws="AvatarFallback",ys=i.forwardRef((a,v)=>{const{__scopeAvatar:p,delayMs:h,...j}=a,m=ps(ws,p),[l,d]=i.useState(h===void 0);return i.useEffect(()=>{if(h!==void 0){const A=window.setTimeout(()=>d(!0),h);return()=>window.clearTimeout(A)}},[h]),l&&m.imageLoadingStatus!=="loaded"?e.jsx(as.span,{...j,ref:v}):null});ys.displayName=ws;function hs(a,v){return a?v?(a.src!==v&&(a.src=v),a.complete&&a.naturalWidth>0?"loaded":"loading"):"error":"idle"}function tt(a,{referrerPolicy:v,crossOrigin:p}){const h=Xs(),j=i.useRef(null),m=h?(j.current||(j.current=new window.Image),j.current):null,[l,d]=i.useState(()=>hs(m,a));return Ze(()=>{d(hs(m,a))},[m,a]),Ze(()=>{const A=y=>()=>{d(y)};if(!m)return;const g=A("loaded"),o=A("error");return m.addEventListener("load",g),m.addEventListener("error",o),v&&(m.referrerPolicy=v),typeof p=="string"&&(m.crossOrigin=p),()=>{m.removeEventListener("load",g),m.removeEventListener("error",o)}},[m,p,v]),l}var ks=js,Cs=Ns,_s=ys;const is=ss.forwardRef(({className:a,...v},p)=>e.jsx(ks,{ref:p,className:ts("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...v})),ns=ss.forwardRef(({className:a,...v},p)=>e.jsx(Cs,{ref:p,className:ts("aspect-square h-full w-full",a),...v})),ds=ss.forwardRef(({className:a,...v},p)=>e.jsx(_s,{ref:p,className:ts("flex h-full w-full items-center justify-center rounded-full bg-slate-100 text-slate-600 font-medium",a),...v}));is.displayName=ks.displayName;ns.displayName=Cs.displayName;ds.displayName=_s.displayName;const at=({isOpen:a,onClose:v,classId:p,onSuccess:h,editingPost:j})=>{const[m,l]=i.useState(!1),[d,A]=i.useState(j?.file_type?.includes("video")?"video":j?.file_type==="link"?"link":"text"),[g,o]=i.useState({title:j?.title||"",content:j?.description||"",link:j?.file_url||"",file:null}),y=[{id:"text",label:"Texto",icon:Q,desc:"Compartilhe um texto ou aviso"},{id:"video",label:"VÃ­deo",icon:ze,desc:"Adicione um vÃ­deo do YouTube ou Vimeo"},{id:"link",label:"Link",icon:Oe,desc:"Compartilhe um link externo"},{id:"image",label:"Imagem",icon:$e,desc:"Adicione fotos ou imagens"}],n=async c=>{if(c.preventDefault(),!g.title.trim()||!g.content.trim()){u({title:"Campos obrigatÃ³rios",description:"Preencha tÃ­tulo e conteÃºdo",variant:"destructive"});return}try{l(!0);const{data:{user:E}}=await S.auth.getUser();if(!E)throw new Error("UsuÃ¡rio nÃ£o autenticado");const f={title:g.title,description:g.content,file_url:g.link||null,file_type:d==="video"?"video/url":d==="link"?"link":"text",category:"post",is_public:!1};let k;if(j?{error:k}=await S.from("class_materials").update(f).eq("id",j.id):{error:k}=await S.from("class_materials").insert({...f,class_id:p,created_by:E.id}),k)throw k;await Le.invalidateClass(p),u({title:j?"âœ… Post atualizado!":"âœ… Post criado!",description:j?"Suas alteraÃ§Ãµes foram salvas.":"Seu post foi publicado no mural."}),o({title:"",content:"",link:"",file:null}),A("text"),h?.(),v()}catch(E){$.error("Erro ao criar post:",E),u({title:"Erro ao criar post",description:E.message,variant:"destructive"})}finally{l(!1)}};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(x,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:j?"Editar Postagem":"Nova Postagem"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:j?"Atualize o conteÃºdo da postagem":"Compartilhe conteÃºdo com seus alunos"})]}),e.jsx("button",{onClick:v,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(je,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:n,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Tipo de ConteÃºdo"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:y.map(c=>{const E=c.icon;return e.jsx("button",{type:"button",onClick:()=>A(c.id),className:`p-4 rounded-lg border-2 text-left transition-all ${d===c.id?"border-blue-600 bg-blue-50 dark:bg-blue-950":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:`w-5 h-5 ${d===c.id?"text-blue-600":"text-slate-600"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:c.label}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:c.desc})]})]})},c.id)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["TÃ­tulo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:g.title,onChange:c=>o({...g,title:c.target.value}),placeholder:"Ex: Material sobre FunÃ§Ãµes QuadrÃ¡ticas",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:200,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[g.title.length,"/200"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["ConteÃºdo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:g.content,onChange:c=>o({...g,content:c.target.value}),placeholder:"Escreva o conteÃºdo da postagem...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",maxLength:2e3,required:!0}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[g.content.length,"/2000"]})]}),d==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Link do VÃ­deo"}),e.jsx("input",{type:"url",value:g.link,onChange:c=>o({...g,link:c.target.value}),placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),d==="link"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"URL do Link"}),e.jsx("input",{type:"url",value:g.link,onChange:c=>o({...g,link:c.target.value}),placeholder:"https://exemplo.com/artigo",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),d==="image"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Upload de Imagem"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(gs,{className:"w-12 h-12 mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Arraste uma imagem ou clique para selecionar"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"image-upload",onChange:c=>o({...g,file:c.target.files[0]})}),e.jsx(M,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>document.getElementById("image-upload").click(),children:"Selecionar Arquivo"}),g.file&&e.jsx("p",{className:"text-sm text-green-600 mt-2",children:g.file.name})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(M,{type:"button",variant:"outline",onClick:v,className:"flex-1",disabled:m,children:"Cancelar"}),e.jsx(M,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600",disabled:m,children:m?"Publicando...":"Publicar"})]})]})]})}):null},Te=({isOpen:a,onClose:v,onConfirm:p,title:h,message:j,confirmText:m="Confirmar",cancelText:l="Cancelar",variant:d="danger"})=>{if(!a)return null;const A=()=>{p(),v()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(x,{className:"w-full max-w-md bg-white dark:bg-slate-900 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${d==="danger"?"bg-red-100 dark:bg-red-900/20":"bg-yellow-100 dark:bg-yellow-900/20"}`,children:e.jsx(Be,{className:`w-6 h-6 ${d==="danger"?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`})}),e.jsx("h2",{className:"text-xl font-bold",children:h})]}),e.jsx("button",{onClick:v,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:j}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(M,{variant:"outline",onClick:v,children:l}),e.jsx(M,{onClick:A,className:d==="danger"?"bg-red-600 hover:bg-red-700 text-white":"bg-yellow-600 hover:bg-yellow-700 text-white",children:m})]})]})})},rt=({classId:a})=>{const[v,p]=i.useState(!1),[h,j]=i.useState(!0),[m,l]=i.useState([]),[d,A]=i.useState("all"),[g,o]=i.useState({isOpen:!1,id:null,title:""}),[y,n]=i.useState(null);i.useEffect(()=>{c()},[a]);const c=async()=>{try{j(!0);const{data:s,error:N}=await S.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",a).order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(N)throw N;l(s||[])}catch(s){$.error("Erro ao carregar posts:",s),u({title:"Erro ao carregar posts",description:s.message,variant:"destructive"})}finally{j(!1)}},E=()=>{p(!1),n(null),c()},f=s=>{s.file_url?window.open(s.file_url,"_blank"):u({title:"ConteÃºdo nÃ£o disponÃ­vel",description:"Este post nÃ£o possui arquivo ou link associado"})},k=s=>{n(s),p(!0)},q=async s=>{try{const N=!s.is_pinned,{error:V}=await S.from("class_materials").update({is_pinned:N}).eq("id",s.id);if(V)throw V;u({title:N?"âœ… Post fixado!":"âœ… Post desafixado!",description:N?"Este post agora aparece no topo do mural.":"Este post foi removido do topo."}),c()}catch(N){$.error("Erro ao fixar/desafixar post:",N),u({title:"âŒ Erro",description:"NÃ£o foi possÃ­vel alterar o status do post.",variant:"destructive"})}},T=s=>{s.file_url?window.open(s.file_url,"_blank"):u({title:"Arquivo nÃ£o disponÃ­vel",variant:"destructive"})},R=(s,N)=>{o({isOpen:!0,id:s,title:N})},z=async()=>{const{id:s,title:N}=g;try{const{error:V}=await S.from("class_materials").delete().eq("id",s);if(V)throw V;u({title:"âœ… Post deletado",description:`"${N}" foi removido com sucesso.`}),c()}catch(V){$.error("Erro ao deletar post:",V),u({title:"âŒ Erro ao deletar post",description:V.message,variant:"destructive"})}},P=s=>s?s.includes("video")?ze:s.includes("image")?$e:s.includes("pdf")?Q:Oe:Q,C=s=>s?s.includes("video")?"bg-purple-100 text-purple-700":s.includes("image")?"bg-pink-100 text-pink-700":s.includes("pdf")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700",D=()=>d==="all"?m:m.filter(s=>{if(!s.file_type)return!1;switch(d){case"video":return s.file_type.includes("video");case"image":return s.file_type.includes("image");case"pdf":return s.file_type.includes("pdf");case"link":return s.file_type==="link";default:return!0}});if(h)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const L=D();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Mural de ConteÃºdo"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[L.length," de ",m.length," posts"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{value:d,onValueChange:A,children:[e.jsx(Y,{className:"w-[180px]",children:e.jsx(ee,{placeholder:"Filtrar por tipo"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Tipos"}),e.jsx(_,{value:"video",children:"ðŸ“¹ VÃ­deos"}),e.jsx(_,{value:"pdf",children:"ðŸ“„ PDFs"}),e.jsx(_,{value:"image",children:"ðŸ–¼ï¸ Imagens"}),e.jsx(_,{value:"link",children:"ðŸ”— Links"})]})]}),e.jsxs(M,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>p(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Nova Postagem"]})]})]}),L.length===0?e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(Q,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:m.length===0?"Nenhum conteÃºdo postado ainda":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:m.length===0?"Compartilhe materiais, vÃ­deos e links com seus alunos":"Ajuste o filtro para ver mais resultados."}),m.length===0&&e.jsxs(M,{onClick:()=>p(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Criar Primeira Postagem"]})]}):e.jsx("div",{className:"space-y-4",children:L.map((s,N)=>{const V=P(s.file_type);return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:N*.05},children:e.jsxs(x,{className:`p-6 hover:shadow-lg transition-all ${s.is_pinned?"border-2 border-amber-400 bg-amber-50/50 dark:bg-amber-950/20":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsxs(is,{className:"w-10 h-10",children:[e.jsx(ns,{src:s.creator?.avatar_url}),e.jsx(ds,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white",children:s.creator?.full_name?.[0]||"P"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold",children:s.creator?.full_name||"Professor"}),s.is_pinned&&e.jsxs(U,{className:"bg-amber-500 text-white text-xs",children:[e.jsx(We,{className:"w-3 h-3 mr-1"}),"Fixado"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"â€¢"}),e.jsx("span",{className:"text-sm text-slate-500",children:ve(new Date(s.created_at),{locale:ce,addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(U,{className:C(s.file_type),children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),s.file_type?.split("/")[0]||"Arquivo"]}),s.category&&e.jsx(U,{variant:"outline",className:"text-xs",children:s.category})]})]})]}),e.jsxs(Se,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(I,{onClick:()=>f(s),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(I,{onClick:()=>T(s),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Baixar Arquivo"]}),e.jsxs(I,{onClick:()=>k(s),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar Post"]}),e.jsxs(I,{onClick:()=>q(s),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),s.is_pinned?"Desafixar":"Fixar no Topo"]}),e.jsx(De,{}),e.jsxs(I,{className:"text-red-600 dark:text-red-400",onClick:()=>R(s.id,s.title),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar Post"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 line-clamp-3",children:s.description||"Sem descriÃ§Ã£o"})]}),s.file_type?.includes("image")&&s.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:s.file_url,alt:s.title,className:"w-full max-h-96 object-contain cursor-pointer",onClick:()=>window.open(s.file_url,"_blank")})}),s.file_type?.includes("video")&&s.file_url&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:s.file_url.includes("youtube")||s.file_url.includes("youtu.be")?e.jsx("div",{className:"aspect-video",children:e.jsx("iframe",{src:s.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allowFullScreen:!0,title:s.title})}):e.jsx("video",{controls:!0,className:"w-full max-h-96",children:e.jsx("source",{src:s.file_url})})}),s.file_type==="link"&&s.file_url&&e.jsx("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",className:"mb-4 block p-4 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-950/40 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-blue-600 hover:underline truncate",children:s.file_url})]})}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.tags.map((K,w)=>e.jsxs(U,{variant:"secondary",className:"text-xs",children:["#",K]},w))}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),s.views||0," visualizaÃ§Ãµes"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-4 h-4"}),"0 comentÃ¡rios"]})]}),s.file_url&&e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>window.open(s.file_url,"_blank"),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Baixar"]})]})]})},s.id)})}),e.jsx(at,{isOpen:v,onClose:()=>{p(!1),n(null)},classId:a,onSuccess:E,editingPost:y}),e.jsx(Te,{isOpen:g.isOpen,onClose:()=>o({isOpen:!1,id:null,title:""}),onConfirm:z,title:"Deletar Post",message:`Tem certeza que deseja deletar "${g.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},lt=({isOpen:a,onClose:v,classId:p,onSuccess:h})=>{const[j,m]=i.useState(!1),[l,d]=i.useState({title:"",description:"",urgency:"info"}),A=[{value:"info",label:"ðŸ“˜ InformaÃ§Ã£o",color:"blue",icon:Ve},{value:"warning",label:"âš ï¸ Aviso",color:"yellow",icon:Be},{value:"urgent",label:"ðŸ”” Urgente",color:"orange",icon:ge},{value:"critical",label:"ðŸš¨ CrÃ­tico",color:"red",icon:oe}],g=async n=>{if(n.preventDefault(),!l.title.trim()||!l.description.trim()){u({title:"Campos obrigatÃ³rios",description:"Preencha tÃ­tulo e descriÃ§Ã£o",variant:"destructive"});return}try{m(!0);const{data:{user:c}}=await S.auth.getUser();if(!c)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{error:E}=await S.from("class_materials").insert({class_id:p,title:l.title,description:l.description,category:"announcement",tags:[l.urgency],created_by:c.id,is_public:!1,file_type:"announcement"});if(E)throw E;u({title:"Comunicado criado!",description:"Todos os alunos serÃ£o notificados"}),d({title:"",description:"",urgency:"info"}),h?.(),v()}catch(c){$.error("Erro ao criar comunicado:",c),u({title:"Erro ao criar comunicado",description:c.message,variant:"destructive"})}finally{m(!1)}};if(!a)return null;const o=A.find(n=>n.value===l.urgency),y=o?.icon||Ve;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(x,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-orange-600 to-red-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Novo Comunicado"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Envie avisos importantes para todos os alunos"})]}),e.jsx("button",{onClick:v,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(je,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"NÃ­vel de UrgÃªncia"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:A.map(n=>{const c=n.icon;return e.jsx("button",{type:"button",onClick:()=>d({...l,urgency:n.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${l.urgency===n.value?`border-${n.color}-600 bg-${n.color}-50 dark:bg-${n.color}-950/20`:"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm",children:n.label})]})},n.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"TÃ­tulo do Comunicado"}),e.jsx("input",{type:"text",value:l.title,onChange:n=>d({...l,title:n.target.value}),placeholder:"Ex: AlteraÃ§Ã£o de horÃ¡rio da prova",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Mensagem"}),e.jsx("textarea",{value:l.description,onChange:n=>d({...l,description:n.target.value}),placeholder:"Descreva o comunicado em detalhes...",rows:6,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-orange-600 dark:bg-slate-800",required:!0})]}),e.jsx("div",{className:`p-4 rounded-lg border-2 border-${o?.color}-200 bg-${o?.color}-50 dark:bg-${o?.color}-950/20`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${o?.color}-100`,children:e.jsx(y,{className:`w-5 h-5 text-${o?.color}-600`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:l.title||"TÃ­tulo do comunicado"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:l.description||"Mensagem do comunicado aparecerÃ¡ aqui..."})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(M,{type:"button",variant:"outline",onClick:v,children:"Cancelar"}),e.jsx(M,{type:"submit",disabled:j,className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",children:j?"Publicando...":"Publicar Comunicado"})]})]})]})})},it=({classId:a})=>{const[v,p]=i.useState(!0),[h,j]=i.useState([]),[m,l]=i.useState("all"),[d,A]=i.useState(!1),[g,o]=i.useState(null),[y,n]=i.useState({isOpen:!1,id:null,title:""}),[c,E]=i.useState({total:0,info:0,warning:0,urgent:0,critical:0});i.useEffect(()=>{f()},[a]);const f=async()=>{try{p(!0);const{data:D,error:L}=await S.from("class_materials").select(`
          *,
          creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",a).eq("category","announcement").order("created_at",{ascending:!1});if(L)throw L;const s=D||[];E({total:s.length,info:s.filter(N=>(N.tags?.[0]||"info")==="info").length,warning:s.filter(N=>(N.tags?.[0]||"info")==="warning").length,urgent:s.filter(N=>(N.tags?.[0]||"info")==="urgent").length,critical:s.filter(N=>(N.tags?.[0]||"info")==="critical").length}),j(s)}catch(D){$.error("Erro ao carregar comunicados:",D),u({title:"Erro ao carregar comunicados",description:D.message,variant:"destructive"})}finally{p(!1)}},k=D=>{switch(D){case"critical":return{icon:Be,color:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",borderColor:"border-red-200 dark:border-red-800",label:"CrÃ­tico"};case"urgent":return{icon:cs,color:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",borderColor:"border-orange-200 dark:border-orange-800",label:"Urgente"};case"warning":return{icon:oe,color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",borderColor:"border-yellow-200 dark:border-yellow-800",label:"Aviso"};default:return{icon:Ve,color:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",borderColor:"border-blue-200 dark:border-blue-800",label:"InformaÃ§Ã£o"}}},q=async D=>{try{const{data:L,error:s}=await S.from("class_members").select("user_id, profiles!user_id(full_name)").eq("class_id",a).eq("role","student");if(s)throw s;const N=L?.length||0;u({title:`ðŸ“Š ${N} aluno(s)`,description:"Sistema de tracking de leituras serÃ¡ implementado em breve."})}catch(L){$.error("Erro:",L),u({title:"âŒ Erro",description:L.message,variant:"destructive"})}},T=D=>{o(D),A(!0)},R=async D=>{try{const L=!D.is_pinned,{error:s}=await S.from("announcements").update({is_pinned:L}).eq("id",D.id);if(s)throw s;u({title:L?"âœ… Comunicado fixado!":"âœ… Comunicado desafixado!",description:L?"Este comunicado agora aparece no topo.":"Este comunicado foi removido do topo."}),f()}catch(L){$.error("Erro ao fixar/desafixar:",L),u({title:"âŒ Erro",description:L.message,variant:"destructive"})}},z=(D,L)=>{n({isOpen:!0,id:D,title:L})},P=async()=>{const{id:D,title:L}=y;try{const{error:s}=await S.from("class_materials").delete().eq("id",D);if(s)throw s;u({title:"âœ… Comunicado deletado",description:`"${L}" foi removido com sucesso.`}),f()}catch(s){$.error("Erro ao deletar comunicado:",s),u({title:"âŒ Erro ao deletar comunicado",description:s.message,variant:"destructive"})}},C=m==="all"?h:h.filter(D=>(D.tags?.[0]||"info")===m);return v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(x,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(ge,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Ve,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.info}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Info"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(oe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.warning}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Avisos"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900",children:e.jsx(cs,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.urgent}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Urgentes"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(Be,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CrÃ­ticos"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Comunicados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[C.length," de ",c.total," comunicados"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{value:m,onValueChange:l,children:[e.jsx(Y,{className:"w-[180px]",children:e.jsx(ee,{placeholder:"Filtrar urgÃªncia"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos"}),e.jsx(_,{value:"info",children:"ðŸ“˜ InformaÃ§Ã£o"}),e.jsx(_,{value:"warning",children:"âš ï¸ Aviso"}),e.jsx(_,{value:"urgent",children:"ðŸ”” Urgente"}),e.jsx(_,{value:"critical",children:"ðŸš¨ CrÃ­tico"})]})]}),e.jsxs(M,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",onClick:()=>A(!0),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Novo Comunicado"]})]})]}),C.length===0?e.jsx(x,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:h.length===0?"Nenhum comunicado publicado":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:h.length===0?"Avisos importantes aparecerÃ£o aqui e notificarÃ£o todos os alunos":"Ajuste o filtro para ver mais resultados."}),h.length===0&&e.jsxs(M,{className:"bg-gradient-to-r from-orange-600 to-red-600",onClick:()=>A(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Criar Primeiro Comunicado"]})]})}):e.jsx("div",{className:"space-y-4",children:C.map((D,L)=>{const s=D.tags?.[0]||"info",N=k(s),V=N.icon;return e.jsx(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:L*.05},children:e.jsx(x,{className:`p-6 border-2 ${N.borderColor} hover:shadow-lg transition-all`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${N.color}`,children:e.jsx(V,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:D.title}),e.jsx(U,{className:N.color,children:N.label})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(re,{className:"w-3 h-3"}),ve(new Date(D.created_at),{locale:ce,addSuffix:!0})]})]}),e.jsxs(Se,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(I,{onClick:()=>q(),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver Leituras"]}),e.jsxs(I,{onClick:()=>T(D),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(I,{onClick:()=>R(D),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Fixar no Topo"]}),e.jsx(De,{}),e.jsxs(I,{className:"text-red-600",onClick:()=>z(D.id,D.title),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 mb-3",children:D.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),"Todos os alunos"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),"0 leituras"]})]})]})]})})},D.id)})}),e.jsx(lt,{isOpen:d,onClose:()=>{A(!1),o(null)},classId:a,editingAnnouncement:g,onSuccess:f}),e.jsx(Te,{isOpen:y.isOpen,onClose:()=>n({isOpen:!1,id:null,title:""}),onConfirm:P,title:"Deletar Comunicado",message:`Tem certeza que deseja deletar "${y.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},nt=({isOpen:a,onClose:v,classId:p,onSuccess:h})=>{const[j,m]=i.useState(!1),[l,d]=i.useState({title:"",description:"",category:"aulas",file:null,fileUrl:""}),A=[{value:"aulas",label:"ðŸ“š Aulas e Slides"},{value:"exercicios",label:"ðŸ“ ExercÃ­cios"},{value:"referencias",label:"ðŸ“– ReferÃªncias"},{value:"complementar",label:"âž• Material Complementar"}],g=y=>{const n=y.target.files[0];n&&d({...l,file:n,title:l.title||n.name})},o=async y=>{if(y.preventDefault(),!l.title.trim()){u({title:"TÃ­tulo obrigatÃ³rio",description:"Digite um tÃ­tulo para o material",variant:"destructive"});return}if(!l.file&&!l.fileUrl.trim()){u({title:"Arquivo ou link obrigatÃ³rio",description:"FaÃ§a upload de um arquivo ou cole um link",variant:"destructive"});return}try{m(!0);const{data:{user:n}}=await S.auth.getUser();if(!n)throw new Error("UsuÃ¡rio nÃ£o autenticado");let c=l.fileUrl,E="link",f=null;if(l.file){const q=`${Date.now()}_${l.file.name}`,T=`${p}/${q}`,{error:R}=await S.storage.from("class-materials").upload(T,l.file);if(R)throw R;const{data:{publicUrl:z}}=S.storage.from("class-materials").getPublicUrl(T);c=z,E=l.file.type,f=l.file.size}const{error:k}=await S.from("class_materials").insert({class_id:p,title:l.title,description:l.description||null,file_url:c,file_type:E,file_size:f,category:l.category,created_by:n.id,is_public:!1});if(k)throw k;u({title:"Material adicionado!",description:"O material estÃ¡ disponÃ­vel na biblioteca"}),d({title:"",description:"",category:"aulas",file:null,fileUrl:""}),h?.(),v()}catch(n){$.error("Erro ao adicionar material:",n),u({title:"Erro ao adicionar material",description:n.message,variant:"destructive"})}finally{m(!1)}};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(x,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Material"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Compartilhe arquivos e recursos com seus alunos"})]}),e.jsx("button",{onClick:v,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(je,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"TÃ­tulo do Material"}),e.jsx("input",{type:"text",value:l.title,onChange:y=>d({...l,title:y.target.value}),placeholder:"Ex: Slides da Aula 1 - IntroduÃ§Ã£o",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Categoria"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:A.map(y=>e.jsx("button",{type:"button",onClick:()=>d({...l,category:y.value}),className:`p-3 rounded-lg border-2 text-left transition-all ${l.category===y.value?"border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border-slate-200 dark:border-slate-700 hover:border-slate-300"}`,children:e.jsx("span",{className:"font-medium text-sm",children:y.label})},y.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Arquivo ou Link"}),e.jsx("div",{children:e.jsx("label",{className:"block",children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${l.file?"border-green-500 bg-green-50 dark:bg-green-950/20":"border-slate-300 dark:border-slate-700 hover:border-blue-600"}`,children:[l.file?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"text-sm font-medium mb-1 text-green-700 dark:text-green-300",children:["âœ“ ",l.file.name]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[(l.file.size/1024/1024).toFixed(2)," MB"]}),e.jsx("button",{type:"button",onClick:y=>{y.preventDefault(),d({...l,file:null,title:""})},className:"mt-2 text-xs text-red-600 hover:underline",children:"Remover arquivo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(gs,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),e.jsx("div",{className:"text-sm font-medium mb-1",children:"Clique para fazer upload"}),e.jsx("div",{className:"text-xs text-slate-500",children:"PDF, DOC, PPT, Imagens, VÃ­deos (mÃ¡x 50MB)"})]}),e.jsx("input",{type:"file",onChange:g,className:"hidden",accept:".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.mp4,.avi"})]})})}),e.jsx("div",{className:"text-center text-sm text-slate-500",children:"OU"}),e.jsx("div",{children:e.jsx("input",{type:"url",value:l.fileUrl,onChange:y=>d({...l,fileUrl:y.target.value}),placeholder:"Cole um link (Google Drive, YouTube, etc)",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"DescriÃ§Ã£o (opcional)"}),e.jsx("textarea",{value:l.description,onChange:y=>d({...l,description:y.target.value}),placeholder:"Adicione informaÃ§Ãµes sobre o material...",rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(M,{type:"button",variant:"outline",onClick:v,children:"Cancelar"}),e.jsx(M,{type:"submit",disabled:j,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:j?"Adicionando...":"Adicionar Material"})]})]})]})}):null},dt=({classId:a})=>{const[v,p]=i.useState(!0),[h,j]=i.useState([]),[m,l]=i.useState(""),[d,A]=i.useState("all"),[g,o]=i.useState("all"),[y,n]=i.useState(!1),[c,E]=i.useState(!1),[f,k]=i.useState({total:0,pdfs:0,videos:0,images:0,others:0}),[q,T]=i.useState({isOpen:!1,id:null,title:""});i.useEffect(()=>{R()},[a]);const R=async()=>{try{p(!0);const{data:w,error:B}=await S.from("class_materials").select(`
          *,
          uploader:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
        `).eq("class_id",a).neq("category","announcement").order("created_at",{ascending:!1});if(B)throw B;const t=w||[];k({total:t.length,pdfs:t.filter(r=>r.file_type?.includes("pdf")).length,videos:t.filter(r=>r.file_type?.includes("video")).length,images:t.filter(r=>r.file_type?.includes("image")).length,others:t.filter(r=>!r.file_type?.includes("pdf")&&!r.file_type?.includes("video")&&!r.file_type?.includes("image")).length}),j(t)}catch(w){$.error("Erro ao carregar materiais:",w),u({title:"Erro ao carregar materiais",description:w.message,variant:"destructive"})}finally{p(!1)}},z=w=>{w.file_url?window.open(w.file_url,"_blank"):u({title:"Arquivo nÃ£o disponÃ­vel",description:"Este material nÃ£o possui arquivo associado",variant:"destructive"})},P=w=>{u({title:"Em desenvolvimento",description:"FunÃ§Ã£o de ediÃ§Ã£o serÃ¡ implementada em breve"})},C=(w,B)=>{T({isOpen:!0,id:w,title:B})},D=async()=>{const{id:w,title:B}=q;try{const{error:t}=await S.from("class_materials").delete().eq("id",w);if(t)throw t;u({title:"âœ… Material deletado",description:`"${B}" foi removido com sucesso.`}),R()}catch(t){$.error("Erro ao deletar material:",t),u({title:"âŒ Erro ao deletar material",description:t.message,variant:"destructive"})}},L=w=>w?w.includes("video")?ze:w.includes("image")?$e:w.includes("pdf")?Q:Q:Q,s=w=>w?w.includes("video")?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":w.includes("image")?"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300":w.includes("pdf")?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"bg-slate-100 text-slate-700",N=w=>{if(!w)return"N/A";const B=w/(1024*1024);return B<1?`${(w/1024).toFixed(0)} KB`:`${B.toFixed(1)} MB`},V=h.filter(w=>{if(m){const B=m.toLowerCase();if(!w.title?.toLowerCase().includes(B)&&!w.description?.toLowerCase().includes(B))return!1}return!(d!=="all"&&w.category!==d||g!=="all"&&(g==="pdf"&&!w.file_type?.includes("pdf")||g==="video"&&!w.file_type?.includes("video")||g==="image"&&!w.file_type?.includes("image")))}),K=V.reduce((w,B)=>{const t=B.category||"Sem Categoria";return w[t]||(w[t]=[]),w[t].push(B),w},{});return v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(x,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Ke,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(Q,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.pdfs}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"PDFs"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(ze,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.videos}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"VÃ­deos"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-pink-200 dark:border-pink-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-pink-100 dark:bg-pink-900",children:e.jsx($e,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.images}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Imagens"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(Pe,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.others}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Outros"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Biblioteca de Materiais"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[V.length," de ",f.total," materiais"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{u({title:"Em desenvolvimento",description:"FunÃ§Ã£o de mÃ³dulos serÃ¡ implementada em breve"})},children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Novo MÃ³dulo"]}),e.jsxs(M,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>E(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Adicionar Material"]})]})]}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar material...",value:m,onChange:w=>l(w.target.value),className:"pl-10"})]})}),e.jsxs(X,{value:g,onValueChange:o,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Tipo"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Tipos"}),e.jsx(_,{value:"pdf",children:"ðŸ“„ PDFs"}),e.jsx(_,{value:"video",children:"ðŸ“¹ VÃ­deos"}),e.jsx(_,{value:"image",children:"ðŸ–¼ï¸ Imagens"})]})]}),e.jsxs(X,{value:d,onValueChange:A,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Categoria"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todas Categorias"}),e.jsx(_,{value:"aulas",children:"Aulas"}),e.jsx(_,{value:"exercicios",children:"ExercÃ­cios"}),e.jsx(_,{value:"referencias",children:"ReferÃªncias"}),e.jsx(_,{value:"complementar",children:"Material Complementar"})]})]})]})}),V.length===0?e.jsx(x,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ke,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:h.length===0?"Biblioteca Vazia":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:h.length===0?"Comece organizando seus materiais em mÃ³dulos e tÃ³picos":"Ajuste os filtros para ver mais resultados."}),h.length===0&&e.jsxs(M,{children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Criar Primeiro MÃ³dulo"]})]})}):e.jsx("div",{className:"space-y-6",children:Object.entries(K).map(([w,B])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:w}),e.jsx(U,{variant:"secondary",children:B.length})]}),e.jsx("div",{className:"space-y-3 ml-6",children:B.map((t,r)=>{const b=L(t.file_type),O=s(t.file_type);return e.jsx(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:r*.05},children:e.jsxs(x,{className:"p-4 hover:shadow-md transition-shadow",children:[t.file_url&&t.file_type?.includes("image")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:t.file_url,alt:t.title,className:"w-full max-h-64 object-contain cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(t.file_url,"_blank")})}),t.file_url&&t.file_type?.includes("video")&&!t.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsxs("video",{controls:!0,className:"w-full max-h-64",children:[e.jsx("source",{src:t.file_url}),"Seu navegador nÃ£o suporta vÃ­deos."]})}),t.file_url&&t.file_url.includes("youtube")&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800 aspect-video",children:e.jsx("iframe",{src:t.file_url.replace("watch?v=","embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${O}`,children:e.jsx(b,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-1",children:t.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsx("span",{children:N(t.file_size)}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),ve(new Date(t.created_at),{locale:ce,addSuffix:!0})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex gap-1",children:t.tags.slice(0,2).map((G,W)=>e.jsx(U,{variant:"outline",className:"text-xs",children:G},W))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.file_url&&e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>window.open(t.file_url,"_blank"),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Baixar"]}),e.jsxs(Se,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(I,{onClick:()=>z(t),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Visualizar"]}),e.jsxs(I,{onClick:()=>P(),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsx(De,{}),e.jsxs(I,{className:"text-red-600",onClick:()=>C(t.id,t.title),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})]})},t.id)})})]},w))}),e.jsx(nt,{isOpen:c,onClose:()=>E(!1),classId:a,onSuccess:R}),e.jsx(Te,{isOpen:q.isOpen,onClose:()=>T({isOpen:!1,id:null,title:""}),onConfirm:D,title:"Deletar Material",message:`Tem certeza que deseja deletar "${q.title}"? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Deletar",cancelText:"Cancelar",variant:"danger"})]})},ot=({isOpen:a,onClose:v,classId:p,onSuccess:h})=>{const[j,m]=i.useState(!1),[l,d]=i.useState([]),[A,g]=i.useState(""),[o,y]=i.useState(null);i.useEffect(()=>{a&&n()},[a]);const n=async()=>{try{m(!0);const{data:{user:f}}=await S.auth.getUser();if(!f)return;const{data:k,error:q}=await S.from("activities").select("*").eq("created_by",f.id).order("created_at",{ascending:!1});if(q)throw q;const{data:T,error:R}=await S.from("activity_class_assignments").select("activity_id").eq("class_id",p);if(R)throw R;const z=T.map(C=>C.activity_id),P=k.filter(C=>!z.includes(C.id));d(P)}catch(f){$.error("Erro ao carregar atividades:",f),u({title:"Erro ao carregar",description:f.message,variant:"destructive"})}finally{m(!1)}},c=async()=>{if(!o){u({title:"Selecione uma atividade",description:"Escolha uma atividade para postar na turma",variant:"destructive"});return}try{m(!0);const{error:f}=await S.from("activity_class_assignments").insert({activity_id:o.id,class_id:p,assigned_at:new Date().toISOString()});if(f)throw f;u({title:"âœ… Atividade postada!",description:`"${o.title}" foi adicionada Ã  turma`}),h?.(),v()}catch(f){$.error("Erro ao postar atividade:",f),u({title:"Erro ao postar",description:f.message,variant:"destructive"})}finally{m(!1)}};if(!a)return null;const E=l.filter(f=>f.title?.toLowerCase().includes(A.toLowerCase())||f.description?.toLowerCase().includes(A.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(x,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Postar Atividade Existente"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha uma atividade criada anteriormente"})]}),e.jsx("button",{onClick:v,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(je,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar atividades...",value:A,onChange:f=>g(f.target.value),className:"pl-10"})]}),j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:l.length===0?"Nenhuma atividade disponÃ­vel":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:l.length===0?"Crie atividades primeiro para poder postÃ¡-las aqui":"Tente buscar por outro termo"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:E.map(f=>e.jsx(x,{className:`p-4 cursor-pointer transition-all hover:shadow-md ${o?.id===f.id?"border-2 border-blue-600 bg-blue-50 dark:bg-blue-950/20":"border hover:border-blue-300"}`,onClick:()=>y(f),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:f.title}),e.jsx(U,{variant:f.status==="active"?"default":"secondary",children:f.status==="active"?"Publicada":"Rascunho"})]}),f.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:f.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[f.due_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),"Prazo: ",fe(new Date(f.due_date),"dd/MM/yyyy 'Ã s' HH:mm",{locale:ce})]}),f.max_grade&&e.jsxs("span",{children:["Nota: ",f.max_grade," pts"]})]})]}),o?.id===f.id&&e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-white"})})})]})},f.id))}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t dark:border-slate-700",children:[e.jsx(M,{type:"button",variant:"outline",onClick:v,children:"Cancelar"}),e.jsx(M,{onClick:c,disabled:j||!o,className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:j?"Postando...":"Postar Atividade"})]})]})]})})},ct=({classId:a})=>{const v=es(),[p,h]=i.useState(!0),[j,m]=i.useState([]),[l,d]=i.useState({isOpen:!1,id:null,title:""}),[A,g]=i.useState(""),[o,y]=i.useState("all"),[n,c]=i.useState("all"),[E,f]=i.useState("all"),[k,q]=i.useState("recent"),[T,R]=i.useState(!1),[z,P]=i.useState({total:0,published:0,draft:0,overdue:0,pendingCorrections:0});i.useEffect(()=>{C()},[a]);const C=async()=>{try{h(!0);const{data:t,error:r}=await S.from("activity_class_assignments").select(`
          id,
          assigned_at,
          activity:activities(
            id,
            title,
            description,
            type,
            due_date,
            max_score,
            status,
            created_at
          )
        `).eq("class_id",a).order("assigned_at",{ascending:!1});if(r)throw r;const{count:b}=await S.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",a).eq("role","student"),O=await Promise.all((t||[]).map(async F=>{const te=F.activity?.id;if(!te)return{...F,submissionsCount:0,totalStudents:b||0,pendingCorrections:0,avgGrade:null,submissionRate:0};const{data:Ne}=await S.from("class_members").select("user_id").eq("class_id",a).eq("role","student"),de=Ne?.map(J=>J.user_id)||[];let me=[];if(de.length>0){const{data:J}=await S.from("submissions").select("id, status, grade").eq("activity_id",te).in("student_id",de);me=J||[]}const we=me?.length||0,ye=me?.filter(J=>J.status==="submitted").length||0,ke=me?.filter(J=>J.grade!==null).map(J=>parseFloat(J.grade))||[],Z=ke.length>0?ke.reduce((J,Ss)=>J+Ss,0)/ke.length:null,Qe=b>0?we/b*100:0;return{...F,submissionsCount:we,totalStudents:b||0,pendingCorrections:ye,avgGrade:Z,submissionRate:Qe}})),G=new Date,W={total:O.length,published:O.filter(F=>F.activity?.is_published).length,draft:O.filter(F=>!F.activity?.is_published).length,overdue:O.filter(F=>F.activity?.due_date&&Re(new Date(F.activity.due_date))&&!ue(new Date(F.activity.due_date))).length,pendingCorrections:O.reduce((F,te)=>F+(te.pendingCorrections||0),0)};m(O),P(W)}catch(t){$.error("Erro ao carregar atividades:",t),u({title:"Erro ao carregar atividades",description:t.message,variant:"destructive"}),m([])}finally{h(!1)}},D=()=>{let t=j;if(A){const r=A.toLowerCase();t=t.filter(b=>b.activity?.title?.toLowerCase().includes(r)||b.activity?.description?.toLowerCase().includes(r))}if(o!=="all"&&(t=t.filter(r=>o==="published"?r.activity?.status==="active":o==="draft"?r.activity?.status==="draft":o==="pending_correction"?r.pendingCorrections>0:!0)),n!=="all"&&(t=t.filter(r=>r.activity?.type===n)),E!=="all"){const r=new Date;t=t.filter(b=>{if(!b.activity?.due_date)return E==="no_deadline";const O=new Date(b.activity.due_date);switch(E){case"overdue":return Re(O)&&!ue(O);case"today":return ue(O);case"tomorrow":return He(O);case"week":return Zs(O)&&O<=new Date(r.getTime()+10080*60*1e3);default:return!0}})}return t.sort((r,b)=>{switch(k){case"recent":return new Date(b.assigned_at)-new Date(r.assigned_at);case"deadline":return r.activity?.due_date?b.activity?.due_date?new Date(r.activity.due_date)-new Date(b.activity.due_date):-1:1;case"submissions":return b.submissionsCount-r.submissionsCount;case"corrections":return b.pendingCorrections-r.pendingCorrections;case"title":return(r.activity?.title||"").localeCompare(b.activity?.title||"");default:return 0}}),t},L=t=>{if(!t)return"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300";const r=new Date(t);return Re(r)&&!ue(r)?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":ue(r)||He(r)?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"},s=t=>{if(!t)return"Sem prazo";const r=new Date(t);return ue(r)?`Hoje Ã s ${fe(r,"HH:mm")}`:He(r)?`AmanhÃ£ Ã s ${fe(r,"HH:mm")}`:Re(r)?`Atrasado - ${fe(r,"dd/MM/yyyy")}`:ve(r,{locale:ce,addSuffix:!0})},N=async t=>{try{const{data:r,error:b}=await S.from("submissions").select(`
          *,
          student:profiles!student_id(full_name, email)
        `).eq("activity_id",t.id).not("grade","is",null);if(b)throw b;if(!r||r.length===0){u({title:"Sem notas",description:"Esta atividade ainda nÃ£o possui notas lanÃ§adas.",variant:"destructive"});return}const O=[["Aluno","Email","Nota","Data de Envio","Data de CorreÃ§Ã£o"],...r.map(F=>[F.student?.full_name||"Sem nome",F.student?.email||"",F.grade||"0",F.submitted_at?new Date(F.submitted_at).toLocaleDateString("pt-BR"):"-",F.graded_at?new Date(F.graded_at).toLocaleDateString("pt-BR"):"-"])].map(F=>F.join(",")).join(`
`),G=new Blob([O],{type:"text/csv;charset=utf-8;"}),W=document.createElement("a");W.href=URL.createObjectURL(G),W.download=`notas_${t.title.replace(/[^a-z0-9]/gi,"_")}.csv`,W.click(),u({title:"âœ… Notas exportadas!",description:`${r.length} nota(s) exportada(s) em CSV.`})}catch(r){$.error("Erro ao exportar notas:",r),u({title:"âŒ Erro ao exportar",description:r.message,variant:"destructive"})}},V=async t=>{try{const{error:r}=await S.from("activities").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",t.id);if(r)throw r;u({title:"âœ… Atividade arquivada!",description:"A atividade foi movida para arquivados."}),C()}catch(r){$.error("Erro ao arquivar atividade:",r),u({title:"âŒ Erro ao arquivar",description:r.message,variant:"destructive"})}},K=(t,r)=>{d({isOpen:!0,id:t,title:r})},w=async()=>{const{id:t,title:r}=l;if(!t){u({title:"âŒ Erro",description:"ID da atividade nÃ£o encontrado.",variant:"destructive"}),d({isOpen:!1,id:null,title:""});return}try{const{error:b}=await S.from("activity_class_assignments").delete().eq("activity_id",t).eq("class_id",a);if(b)throw b;u({title:"âœ… Atividade removida",description:`"${r}" foi removida da turma com sucesso.`}),d({isOpen:!1,id:null,title:""}),C()}catch(b){$.error("Erro ao deletar atividade:",b),u({title:"âŒ Erro ao deletar atividade",description:b.message,variant:"destructive"}),d({isOpen:!1,id:null,title:""})}};if(p)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const B=D();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(x,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(Je,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(ae,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.published}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Publicadas"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:e.jsx(Q,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.draft}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Rascunhos"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(Fe,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.overdue}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Atrasadas"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(oe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"P/ Corrigir"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atividades da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[B.length," de ",z.total," atividades"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>R(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Postar Existente"]}),e.jsxs(M,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>v(`/atividades/criar?classId=${a}`),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Nova Atividade"]})]})]}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar atividade...",value:A,onChange:t=>g(t.target.value),className:"pl-10"})]})}),e.jsxs(X,{value:o,onValueChange:y,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Status"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Status"}),e.jsx(_,{value:"published",children:"Publicadas"}),e.jsx(_,{value:"draft",children:"Rascunhos"}),e.jsx(_,{value:"pending_correction",children:"Pendentes"})]})]}),e.jsxs(X,{value:E,onValueChange:f,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Prazo"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Prazos"}),e.jsx(_,{value:"overdue",children:"Atrasadas"}),e.jsx(_,{value:"today",children:"Hoje"}),e.jsx(_,{value:"tomorrow",children:"AmanhÃ£"}),e.jsx(_,{value:"week",children:"Esta Semana"}),e.jsx(_,{value:"no_deadline",children:"Sem Prazo"})]})]}),e.jsxs(X,{value:k,onValueChange:q,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Ordenar"})}),e.jsxs(se,{children:[e.jsx(_,{value:"recent",children:"Mais Recentes"}),e.jsx(_,{value:"deadline",children:"Prazo (prÃ³ximo)"}),e.jsx(_,{value:"submissions",children:"SubmissÃµes"}),e.jsx(_,{value:"corrections",children:"CorreÃ§Ãµes"}),e.jsx(_,{value:"title",children:"TÃ­tulo (A-Z)"})]})]})]})}),B.length===0?e.jsx(x,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Je,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:j.length===0?"Nenhuma atividade postada":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:j.length===0?"Crie ou poste uma atividade para comeÃ§ar.":"Ajuste os filtros para ver mais resultados."}),j.length===0&&e.jsxs(M,{onClick:()=>v(`/dashboard/activities/create?classId=${a}`),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Criar Primeira Atividade"]})]})}):e.jsx("div",{className:"space-y-3",children:B.map((t,r)=>{const b=t.activity,O=t.submissionRate>=80?"text-green-600":t.submissionRate>=50?"text-yellow-600":"text-red-600";return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.05},children:e.jsx(x,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500",children:e.jsx(Q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:b?.title||"Sem tÃ­tulo"}),!b?.is_published&&e.jsx(U,{variant:"secondary",className:"text-xs",children:"Rascunho"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:b?.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(U,{variant:"outline",className:"text-xs",children:b?.type==="assignment"?"Trabalho":b?.type==="quiz"?"Quiz":b?.type==="exam"?"Prova":b?.type||"Atividade"}),e.jsxs(U,{className:`text-xs ${L(b?.due_date)}`,children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),s(b?.due_date)]}),e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),"Postado ",ve(new Date(t.assigned_at),{locale:ce,addSuffix:!0})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 pt-4 border-t dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:`text-sm font-semibold ${O}`,children:[t.submissionRate.toFixed(0),"%"]})]}),e.jsx(he,{value:t.submissionRate,className:"h-2 mb-1"}),e.jsxs("div",{className:"text-xs text-slate-500",children:[t.submissionsCount,"/",t.totalStudents," submissÃµes"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${t.pendingCorrections>0?"text-yellow-600":"text-green-600"}`,children:t.pendingCorrections}),e.jsx("div",{className:"text-xs text-slate-500",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.avgGrade?.toFixed(1)||"â€”"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>v(`/dashboard/activities/${b?.id}/submissions`),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver SubmissÃµes"]}),e.jsxs(Se,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(I,{onClick:()=>v(`/dashboard/activities/${b?.activity?.id}/edit`),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Editar Atividade"]}),e.jsxs(I,{onClick:()=>N(b),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Exportar Notas"]}),e.jsx(De,{}),e.jsxs(I,{onClick:()=>V(b),children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Arquivar"]}),e.jsxs(I,{className:"text-red-600 dark:text-red-400",onClick:()=>{const G=t?.activity?.id,W=t?.activity?.title||"Atividade";$.debug("[ActivitiesTab] Delete clicked:",{activityId:G,activityTitle:W,fullAssignment:t}),K(G,W)},children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Deletar"]})]})]})]})]})})},t.id)})}),e.jsx(ot,{isOpen:T,onClose:()=>R(!1),classId:a,onSuccess:C}),e.jsx(Te,{isOpen:l.isOpen,onClose:()=>d({isOpen:!1,id:null,title:""}),onConfirm:w,title:"Remover Atividade da Turma",message:`Tem certeza que deseja remover "${l.title}" desta turma? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},mt=({isOpen:a,onClose:v,classId:p,classData:h,onSuccess:j})=>{const[m,l]=i.useState(!1),[d,A]=i.useState("email"),[g,o]=i.useState(""),[y,n]=i.useState(""),[c,E]=i.useState(null),f=h?.invite_code?`${window.location.origin}/join/${h.invite_code}`:"",k=async()=>{if(!g.trim()){u({title:"Email obrigatÃ³rio",description:"Digite um email para buscar",variant:"destructive"});return}try{l(!0);const{data:P,error:C}=await S.from("profiles").select("id, full_name, email, avatar_url").eq("email",g.toLowerCase()).eq("role","student").single();if(C||!P){E({found:!1,searched:!0}),u({title:"Aluno nÃ£o encontrado",description:"Email nÃ£o cadastrado no sistema como aluno",variant:"destructive"});return}E({found:!0,user:P})}catch(P){$.error("Erro ao buscar email:",P)}finally{l(!1)}},q=async()=>{if(c?.user)try{l(!0);const{data:P}=await S.from("class_members").select("id").eq("class_id",p).eq("user_id",c.user.id).single();if(P){u({title:"Aluno jÃ¡ estÃ¡ na turma",variant:"destructive"});return}const{data:C,error:D}=await S.from("class_members").insert({class_id:p,user_id:c.user.id,role:"student",joined_at:new Date().toISOString()}).select();if(D)throw D;if(!C||C.length===0)throw new Error("Falha ao adicionar aluno - nenhum registro criado");$.debug("âœ… Aluno adicionado com sucesso:",C[0]);try{await Le.invalidateClass(p)}catch(L){$.warn("Aviso: Erro ao invalidar cache, mas aluno foi adicionado:",L)}u({title:"âœ… Aluno adicionado com sucesso!",description:`${c.user.full_name} agora faz parte da turma. PeÃ§a para ele fazer logout e login novamente.`}),o(""),E(null),j?.()}catch(P){$.error("Erro ao adicionar aluno:",P),u({title:"Erro ao adicionar aluno",description:P.message,variant:"destructive"})}finally{l(!1)}},T=async()=>{const P=y.split(`
`).map(C=>C.trim()).filter(C=>C&&C.includes("@"));if(P.length===0){u({title:"Nenhum email vÃ¡lido",variant:"destructive"});return}try{l(!0);let C=0,D=0,L=0;for(const s of P){const{data:N}=await S.from("profiles").select("id").eq("email",s.toLowerCase()).eq("role","student").single();if(!N){D++;continue}const{data:V}=await S.from("class_members").select("id").eq("class_id",p).eq("user_id",N.id).single();if(V){L++;continue}await S.from("class_members").insert({class_id:p,user_id:N.id,role:"student",joined_at:new Date().toISOString()}),C++}await Le.invalidateClass(p),u({title:"ImportaÃ§Ã£o concluÃ­da",description:`${C} alunos adicionados, ${D} nÃ£o encontrados, ${L} jÃ¡ eram membros`}),n(""),j?.()}catch(C){$.error("Erro na importaÃ§Ã£o:",C),u({title:"Erro na importaÃ§Ã£o",description:C.message,variant:"destructive"})}finally{l(!1)}},R=()=>{navigator.clipboard.writeText(f),u({title:"Link copiado!",description:"Link de convite copiado para Ã¡rea de transferÃªncia"})},z=()=>{navigator.clipboard.writeText(h.invite_code),u({title:"CÃ³digo copiado!",description:"CÃ³digo de convite copiado"})};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(x,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Adicionar Aluno"}),e.jsx("p",{className:"text-cyan-100 text-sm",children:"Escolha um mÃ©todo para adicionar alunos"})]}),e.jsx("button",{onClick:v,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(je,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex gap-2",children:[{id:"email",label:"Buscar por Email",icon:pe},{id:"invite_link",label:"Link de Convite",icon:Oe}].map(P=>{const C=P.icon;return e.jsxs("button",{onClick:()=>A(P.id),className:`flex-1 px-4 py-2 rounded-lg font-medium text-sm transition-all ${d===P.id?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200"}`,children:[e.jsx(C,{className:"w-4 h-4 inline mr-2"}),P.label]},P.id)})}),d==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email do Aluno"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:g,onChange:P=>o(P.target.value),placeholder:"aluno@exemplo.com",className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800",onKeyPress:P=>P.key==="Enter"&&k()}),e.jsxs(M,{onClick:k,disabled:m,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),m?"Buscando...":"Buscar"]})]})]}),c?.found&&c.user&&e.jsx(x,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:c.user.full_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:c.user.full_name}),e.jsx("div",{className:"text-sm text-slate-600",children:c.user.email})]})]}),e.jsx(M,{onClick:q,disabled:m,children:m?"Adicionando...":"Adicionar Ã  Turma"})]})}),c?.searched&&!c?.found&&e.jsx(x,{className:"p-4 bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold mb-1",children:"âŒ Email nÃ£o encontrado"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Verifique se o email estÃ¡ correto ou se o aluno jÃ¡ estÃ¡ cadastrado no sistema."})]})})]}),d==="invite_link"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(x,{className:"p-4 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"CÃ³digo de Convite"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-lg font-mono",children:h?.invite_code||"N/A"}),e.jsx(M,{variant:"outline",size:"sm",onClick:z,children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Link de Convite"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:f,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-slate-800 rounded border text-sm"}),e.jsx(M,{variant:"outline",size:"sm",onClick:R,children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Compartilhe o cÃ³digo ou link com os alunos. Eles poderÃ£o entrar automaticamente na turma."})]}),d==="bulk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Lista de Emails"}),e.jsx("textarea",{value:y,onChange:P=>n(P.target.value),placeholder:`aluno1@exemplo.com
aluno2@exemplo.com
aluno3@exemplo.com`,rows:8,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-600 dark:bg-slate-800 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Cole uma lista de emails (um por linha)"})]}),e.jsx(M,{onClick:T,disabled:m,className:"w-full",children:m?"Importando...":"Importar Alunos"})]})]})]})}):null},xt=({classId:a,classData:v})=>{const[p,h]=i.useState(!0),[j,m]=i.useState([]),[l,d]=i.useState(""),[A,g]=i.useState({isOpen:!1,id:null,name:""}),[o,y]=i.useState("all"),[n,c]=i.useState("all"),[E,f]=i.useState("all"),[k,q]=i.useState("name"),[T,R]=i.useState(!1),[z,P]=i.useState({total:0,active:0,alert:0,critical:0});i.useEffect(()=>{C()},[a]);const C=async()=>{try{h(!0);const{data:t,error:r}=await S.from("class_members").select(`
          *,
          profile:profiles!inner(id, full_name, email, avatar_url)
        `).eq("class_id",a).eq("role","student").order("joined_at",{ascending:!1});if(r)throw r;const{data:b}=await S.from("activity_class_assignments").select("activity_id").eq("class_id",a),O=b?.map(F=>F.activity_id)||[],G=await Promise.all((t||[]).map(async F=>{if(!F.user_id||O.length===0)return{...F,avgGrade:null,deliveryRate:0,submissionsCount:0,totalActivities:O.length,status:"active",lastActivity:null};const{data:te}=await S.from("submissions").select("grade, status, submitted_at").eq("student_id",F.user_id).in("activity_id",O),Ne=te?.map(Z=>parseFloat(Z.grade)).filter(Z=>!isNaN(Z))||[],de=Ne.length>0?Ne.reduce((Z,Qe)=>Z+Qe,0)/Ne.length:null,me=te?.filter(Z=>Z.status==="submitted"||Z.status==="graded").length||0,we=O.length>0?me/O.length*100:0;let ye="active";de!==null&&de<5?ye="critical":(de!==null&&de<6||we<60)&&(ye="alert");const ke=te&&te.length>0?new Date(Math.max(...te.map(Z=>new Date(Z.submitted_at||0)))):null;return{...F,avgGrade:de,deliveryRate:we,submissionsCount:me,totalActivities:O.length,status:ye,lastActivity:ke}})),W={total:G.length,active:G.filter(F=>F.status==="active").length,alert:G.filter(F=>F.status==="alert").length,critical:G.filter(F=>F.status==="critical").length};m(G),P(W)}catch(t){$.error("Erro ao carregar alunos:",t),u({title:"Erro ao carregar alunos",description:t.message,variant:"destructive"}),m([])}finally{h(!1)}},D=()=>{let t=j;if(l){const r=l.toLowerCase();t=t.filter(b=>b.profile?.full_name?.toLowerCase().includes(r)||b.profile?.email?.toLowerCase().includes(r))}return o!=="all"&&(t=t.filter(r=>r.status===o)),n!=="all"&&(t=t.filter(r=>{if(!r.avgGrade)return n==="none";switch(n){case"excellent":return r.avgGrade>=9;case"good":return r.avgGrade>=7&&r.avgGrade<9;case"regular":return r.avgGrade>=5&&r.avgGrade<7;case"low":return r.avgGrade<5;default:return!0}})),E!=="all"&&(t=t.filter(r=>{switch(E){case"high":return r.deliveryRate>=80;case"medium":return r.deliveryRate>=50&&r.deliveryRate<80;case"low":return r.deliveryRate<50;default:return!0}})),t.sort((r,b)=>{switch(k){case"name":return(r.profile?.full_name||"").localeCompare(b.profile?.full_name||"");case"grade":return(b.avgGrade||0)-(r.avgGrade||0);case"delivery":return b.deliveryRate-r.deliveryRate;case"recent":return new Date(b.joined_at)-new Date(r.joined_at);default:return 0}}),t},L=t=>{u({title:"Em desenvolvimento",description:"PÃ¡gina de detalhes do aluno serÃ¡ implementada em breve"})},s=t=>{u({title:"Em desenvolvimento",description:"VisualizaÃ§Ã£o de atividades do aluno serÃ¡ implementada em breve"})},N=t=>{u({title:"Em desenvolvimento",description:"Sistema de mensagens serÃ¡ implementado em breve"})},V=(t,r)=>{g({isOpen:!0,id:t,name:r})},K=async()=>{const{id:t,name:r}=A;try{const{error:b}=await S.from("class_members").delete().eq("user_id",t).eq("class_id",a);if(b)throw b;u({title:"âœ… Aluno removido",description:`${r} foi removido da turma com sucesso.`}),C()}catch(b){$.error("Erro ao remover aluno:",b),u({title:"âŒ Erro ao remover aluno",description:b.message,variant:"destructive"})}},w=()=>{const t=D(),r=[["Nome","Email","Nota MÃ©dia","Taxa de Entrega","Status","Data de Entrada"],...t.map(G=>[G.profile?.full_name||"",G.profile?.email||"",G.avgGrade?.toFixed(1)||"N/A",`${G.deliveryRate.toFixed(0)}%`,G.status==="active"?"Ativo":G.status==="alert"?"Alerta":"CrÃ­tico",fe(new Date(G.joined_at),"dd/MM/yyyy",{locale:ce})])].map(G=>G.join(",")).join(`
`),b=new Blob([r],{type:"text/csv;charset=utf-8;"}),O=document.createElement("a");O.href=URL.createObjectURL(b),O.download=`alunos_${v?.name||"turma"}_${fe(new Date,"yyyy-MM-dd")}.csv`,O.click(),u({title:"Lista exportada",description:"Arquivo CSV baixado com sucesso."})};if(p)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})});const B=D();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(le,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(ae,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.active}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Ativos"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(oe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.alert}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Em Alerta"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900",children:e.jsx(oe,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.critical}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CrÃ­tico"})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Alunos da Turma"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[B.length," de ",z.total," alunos"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:w,children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(M,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white",onClick:()=>R(!0),children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Adicionar Aluno"]})]})]}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(Ie,{placeholder:"Buscar por nome ou email...",value:l,onChange:t=>d(t.target.value),className:"pl-10"})]})}),e.jsxs(X,{value:o,onValueChange:y,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Status"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todos os Status"}),e.jsx(_,{value:"active",children:"Ativo"}),e.jsx(_,{value:"alert",children:"Em Alerta"}),e.jsx(_,{value:"critical",children:"CrÃ­tico"})]})]}),e.jsxs(X,{value:n,onValueChange:c,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Nota"})}),e.jsxs(se,{children:[e.jsx(_,{value:"all",children:"Todas as Notas"}),e.jsx(_,{value:"excellent",children:"Excelente (â‰¥9.0)"}),e.jsx(_,{value:"good",children:"Bom (7.0-8.9)"}),e.jsx(_,{value:"regular",children:"Regular (5.0-6.9)"}),e.jsx(_,{value:"low",children:"Baixo (<5.0)"}),e.jsx(_,{value:"none",children:"Sem Nota"})]})]}),e.jsxs(X,{value:k,onValueChange:q,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Ordenar"})}),e.jsxs(se,{children:[e.jsx(_,{value:"name",children:"Nome (A-Z)"}),e.jsx(_,{value:"grade",children:"Nota (maior)"}),e.jsx(_,{value:"delivery",children:"Taxa Entrega"}),e.jsx(_,{value:"recent",children:"Mais Recentes"})]})]})]})}),B.length===0?e.jsx(x,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"w-16 h-16 text-slate-300 dark:text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:j.length===0?"Nenhum aluno na turma":"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:j.length===0?"Adicione alunos ou compartilhe o cÃ³digo de convite da turma.":"Ajuste os filtros para ver mais resultados."}),j.length===0&&e.jsxs(M,{onClick:()=>R(!0),children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Adicionar Primeiro Aluno"]})]})}):e.jsx("div",{className:"space-y-3",children:B.map((t,r)=>{const b=t.avgGrade>=7?"text-green-600":t.avgGrade>=5?"text-yellow-600":"text-red-600",O=t.deliveryRate>=80?"text-green-600":t.deliveryRate>=60?"text-yellow-600":"text-red-600";return e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.05},children:e.jsx(x,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs(is,{className:"w-12 h-12",children:[e.jsx(ns,{src:t.profile?.avatar_url}),e.jsx(ds,{className:"bg-gradient-to-br from-blue-500 to-cyan-500 text-white font-bold",children:t.profile?.full_name?.[0]||"A"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg",children:t.profile?.full_name||"Nome nÃ£o disponÃ­vel"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.profile?.email||"Email nÃ£o disponÃ­vel"}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2 mt-1",children:[e.jsx(re,{className:"w-3 h-3"}),"Entrou ",ve(new Date(t.joined_at),{locale:ce,addSuffix:!0})]})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${b}`,children:t.avgGrade?.toFixed(1)||"â€”"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]}),e.jsxs("div",{className:"text-center min-w-[120px]",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("span",{className:`text-sm font-semibold ${O}`,children:[t.deliveryRate.toFixed(0),"%"]})}),e.jsx(he,{value:t.deliveryRate,className:"h-2"}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[t.submissionsCount,"/",t.totalActivities," entregas"]})]}),e.jsx(U,{className:t.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":t.status==="alert"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",children:t.status==="active"?"Ativo":t.status==="alert"?"Alerta":"CrÃ­tico"})]}),e.jsxs(Se,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(I,{onClick:()=>L(),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(I,{onClick:()=>s(),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Ver Atividades"]}),e.jsxs(I,{onClick:()=>N(),children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),"Enviar Mensagem"]}),e.jsx(De,{}),e.jsxs(I,{className:"text-red-600 dark:text-red-400",onClick:()=>V(t.id,t.profile?.full_name),children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),"Remover da Turma"]})]})]})]})})},t.id)})}),e.jsx(mt,{isOpen:T,onClose:()=>R(!1),classId:a,classData:v,onSuccess:()=>{R(!1),C()}}),e.jsx(Te,{isOpen:A.isOpen,onClose:()=>g({isOpen:!1,id:null,name:""}),onConfirm:K,title:"Remover Aluno da Turma",message:`Tem certeza que deseja remover ${A.name} desta turma? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})},ut=({classId:a})=>{const[v,p]=i.useState(!0),[h,j]=i.useState({avgGrade:0,deliveryRate:0,engagement:0,totalStudents:0,activeStudents:0,totalActivities:0,completedActivities:0,pendingCorrections:0}),[m,l]=i.useState([]),[d,A]=i.useState([]);i.useEffect(()=>{g()},[a]);const g=async()=>{try{p(!0);const{count:o}=await S.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",a).eq("role","student"),{data:y}=await S.from("activity_class_assignments").select("activity_id").eq("class_id",a),n=y?.map(s=>s.activity_id)||[];let c=[];if(n.length>0){const{data:s}=await S.from("submissions").select("student_id, activity_id, grade, status").in("activity_id",n);c=s||[]}const E=c.filter(s=>s.grade!==null).map(s=>parseFloat(s.grade)),f=E.length>0?E.reduce((s,N)=>s+N,0)/E.length:0,k=o*n.length,q=k>0?c.length/k*100:0,T=c.filter(s=>s.status==="submitted").length,R={};c.forEach(s=>{R[s.student_id]||(R[s.student_id]={grades:[],submissions:0}),R[s.student_id].submissions++,s.grade!==null&&R[s.student_id].grades.push(parseFloat(s.grade))});const{data:z}=await S.from("profiles").select("id, full_name").in("id",Object.keys(R)),P=Object.entries(R).map(([s,N])=>{const V=z?.find(w=>w.id===s),K=N.grades.length>0?N.grades.reduce((w,B)=>w+B,0)/N.grades.length:0;return{id:s,name:V?.full_name||"Desconhecido",avgGrade:K,submissions:N.submissions,deliveryRate:N.submissions/n.length*100}}).sort((s,N)=>N.avgGrade-s.avgGrade).slice(0,5);l(P);const C={};c.forEach(s=>{C[s.activity_id]||(C[s.activity_id]={count:0,grades:[]}),C[s.activity_id].count++,s.grade!==null&&C[s.activity_id].grades.push(parseFloat(s.grade))});const{data:D}=await S.from("activities").select("id, title").in("id",Object.keys(C)),L=Object.entries(C).map(([s,N])=>{const V=D?.find(w=>w.id===s),K=N.grades.length>0?N.grades.reduce((w,B)=>w+B,0)/N.grades.length:0;return{title:V?.title||"Sem tÃ­tulo",submissions:N.count,avgGrade:K,rate:N.count/o*100}}).sort((s,N)=>N.submissions-s.submissions).slice(0,5);A(L),j({avgGrade:f,deliveryRate:q,engagement:q,totalStudents:o||0,activeStudents:Object.keys(R).length,totalActivities:n.length,completedActivities:n.length,pendingCorrections:T})}catch(o){$.error("Erro ao carregar mÃ©tricas:",o),u({title:"Erro ao carregar mÃ©tricas",description:o.message,variant:"destructive"})}finally{p(!1)}};return v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"MÃ©tricas da Turma"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"AnÃ¡lise de desempenho e engajamento"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(x,{className:"p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-100 dark:bg-green-900",children:e.jsx(os,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx(Ce,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:h.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Nota MÃ©dia Geral"}),e.jsx("div",{className:"mt-2",children:e.jsx(he,{value:h.avgGrade/10*100,className:"h-2"})})]}),e.jsxs(x,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900",children:e.jsx(ae,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsx(Ce,{className:"w-5 h-5 text-blue-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:[h.deliveryRate.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Taxa de Entrega"}),e.jsx("div",{className:"mt-2",children:e.jsx(he,{value:h.deliveryRate,className:"h-2"})})]}),e.jsxs(x,{className:"p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(xs,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx(Ce,{className:"w-5 h-5 text-purple-600"})]}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-1",children:[h.engagement.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Engajamento"}),e.jsx("div",{className:"mt-2",children:e.jsx(he,{value:h.engagement,className:"h-2"})})]}),e.jsxs(x,{className:"p-6 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-yellow-100 dark:bg-yellow-900",children:e.jsx(Fe,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),h.pendingCorrections>0?e.jsx(oe,{className:"w-5 h-5 text-yellow-600"}):e.jsx(ae,{className:"w-5 h-5 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-1",children:h.pendingCorrections}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"CorreÃ§Ãµes Pendentes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:h.totalStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total de Alunos"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:h.activeStudents}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Alunos Ativos"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:h.totalActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Atividades"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xs,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:h.completedActivities}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"ConcluÃ­das"})]})]})})]}),e.jsxs(x,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(os,{className:"w-5 h-5 text-yellow-600"}),"Top 5 Alunos por Desempenho"]}),m.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhum dado disponÃ­vel ainda"}):e.jsx("div",{className:"space-y-3",children:m.map((o,y)=>e.jsxs(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:y*.1},className:"flex items-center justify-between p-4 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`
                    w-8 h-8 rounded-full flex items-center justify-center font-bold
                    ${y===0?"bg-yellow-100 text-yellow-700":y===1?"bg-slate-200 text-slate-700":y===2?"bg-orange-100 text-orange-700":"bg-slate-100 text-slate-600"}
                  `,children:y+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:o.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[o.submissions," submissÃµes â€¢ ",o.deliveryRate.toFixed(0),"% entrega"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.avgGrade.toFixed(1)}),e.jsx("div",{className:"text-xs text-slate-500",children:"Nota MÃ©dia"})]})]},o.id))})]}),e.jsxs(x,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-blue-600"}),"Top 5 Atividades por Engajamento"]}),d.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Nenhuma atividade com submissÃµes ainda"}):e.jsx("div",{className:"space-y-4",children:d.map((o,y)=>e.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:y*.1},children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:o.title}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[o.submissions," submissÃµes â€¢ MÃ©dia: ",o.avgGrade.toFixed(1)]})]}),e.jsxs(U,{className:o.rate>=80?"bg-green-100 text-green-700":o.rate>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700",children:[o.rate.toFixed(0),"%"]})]}),e.jsx(he,{value:o.rate,className:"h-2"})]})},y))})]}),e.jsxs(x,{className:"p-12 text-center border-2 border-dashed",children:[e.jsx(Ye,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"GrÃ¡ficos Detalhados"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:["GrÃ¡ficos de evoluÃ§Ã£o temporal, distribuiÃ§Ã£o de notas e comparativos",e.jsx("br",{}),"podem ser adicionados aqui usando Recharts ou Chart.js"]}),e.jsx(U,{variant:"secondary",children:"Em Breve"})]})]})},ht=({classId:a,classData:v})=>{const[p,h]=i.useState(!0),[j,m]=i.useState(!1),[l,d]=i.useState([]),[A,g]=i.useState([]),[o,y]=i.useState("friendly"),[n,c]=i.useState({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0});i.useRef(!1),i.useEffect(()=>{E();const k=localStorage.getItem(`chatbot_enabled_${a}`);if(k!==null){const q=JSON.parse(k);m(q),$.debug("ðŸ¤– Estado inicial do chatbot (localStorage):",q)}},[a]);const E=async()=>{try{h(!0);const{data:k}=await S.from("class_materials").select("id, title, file_type, category").eq("class_id",a);d(k||[]);const{data:q}=await S.from("rag_training_sources").select("*").eq("class_id",a);g(q||[]),c({totalQuestions:0,answeredQuestions:0,avgResponseTime:"0s",satisfactionRate:0})}catch(k){$.error("Erro ao carregar dados do chatbot:",k),u({title:"Erro ao carregar chatbot",description:k.message,variant:"destructive"})}finally{h(!1)}},f=async k=>{m(k);try{localStorage.setItem(`chatbot_enabled_${a}`,JSON.stringify(k)),u({title:k?"âœ… Chatbot Ativado":"â¸ï¸ Chatbot Desativado",description:k?"O assistente virtual estÃ¡ agora disponÃ­vel para os alunos.":"O assistente virtual foi desativado."});try{const{error:q}=await S.from("classes").update({settings:{chatbot_enabled:k}}).eq("id",a);q&&!q.message.includes("settings")&&$.warn("Erro ao salvar no banco (usando localStorage):",q)}catch(q){$.warn("Banco nÃ£o suporta settings ainda, usando localStorage:",q)}}catch(q){$.error("Erro ao salvar configuraÃ§Ã£o:",q),m(!k),u({title:"Erro ao salvar",description:"NÃ£o foi possÃ­vel salvar a configuraÃ§Ã£o",variant:"destructive"})}};return p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Assistente Virtual (Chatbot)"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Configure um assistente com IA para responder dÃºvidas dos alunos"})]}),e.jsx(x,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg",children:e.jsx(qe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"Status do Chatbot"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:j?"âœ… Assistente virtual ativo e respondendo alunos":"âš ï¸ Assistente virtual desativado"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:k=>f(k.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]})}),j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{className:"p-4 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ms,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.totalQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Perguntas"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.answeredQuestions}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Respondidas"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bs,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.avgResponseTime}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Tempo MÃ©dio"})]})]})}),e.jsx(x,{className:"p-4 border-2 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.satisfactionRate,"%"]}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"SatisfaÃ§Ã£o"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(x,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(us,{className:"w-5 h-5 text-blue-600"}),"Personalidade do Bot"]}),e.jsxs(X,{value:o,onValueChange:y,children:[e.jsx(Y,{children:e.jsx(ee,{placeholder:"Escolha a personalidade"})}),e.jsxs(se,{children:[e.jsx(_,{value:"friendly",children:"ðŸ˜Š AmigÃ¡vel e Casual"}),e.jsx(_,{value:"formal",children:"ðŸ‘” Formal e Profissional"}),e.jsx(_,{value:"motivational",children:"ðŸš€ Motivador e EnergÃ©tico"}),e.jsx(_,{value:"patient",children:"ðŸ§˜ Paciente e DidÃ¡tico"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[o==="friendly"&&"ðŸ’¬ O bot usarÃ¡ linguagem casual e amigÃ¡vel",o==="formal"&&"ðŸ“ O bot manterÃ¡ tom profissional e formal",o==="motivational"&&"âœ¨ O bot serÃ¡ motivador e entusiasta",o==="patient"&&"ðŸŽ¯ O bot explicarÃ¡ com paciÃªncia e detalhes"]})})]}),e.jsxs(x,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5 text-purple-600"}),"Modelo de IA"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Claude 3.5 Sonnet"}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Modelo avanÃ§ado da Anthropic"})]}),e.jsx(U,{className:"bg-green-100 text-green-700",children:"Ativo"})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["âœ… Respostas contextualizadas",e.jsx("br",{}),"âœ… CompreensÃ£o avanÃ§ada de linguagem",e.jsx("br",{}),"âœ… SeguranÃ§a e moderaÃ§Ã£o automÃ¡tica"]})]})]})]}),e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-600"}),"Materiais para Treinamento (RAG)"]}),e.jsxs(U,{variant:"secondary",children:[A.length," fontes ativas"]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Selecione materiais da turma para treinar o chatbot. Ele usarÃ¡ esses conteÃºdos para responder perguntas."}),l.length===0?e.jsxs("div",{className:"text-center py-8 bg-slate-50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-2 text-slate-300"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Nenhum material disponÃ­vel.",e.jsx("br",{}),"Adicione materiais na tab Biblioteca primeiro."]})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:l.slice(0,5).map((k,q)=>e.jsxs(H.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:q*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",defaultChecked:A.some(T=>T.material_id===k.id)}),e.jsx(Q,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:k.title}),e.jsx("div",{className:"text-xs text-slate-500",children:k.category})]}),e.jsx(U,{variant:"outline",className:"text-xs",children:k.file_type?.split("/")[1]||"arquivo"})]},k.id))}),e.jsxs(M,{className:"w-full mt-4",variant:"outline",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Treinar Chatbot com Materiais Selecionados"]})]}),e.jsxs(x,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5 text-blue-600"}),"Preview do Chatbot"]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm",children:["OlÃ¡! ðŸ‘‹ Sou o assistente virtual da turma ",e.jsx("strong",{children:v?.name}),". Como posso ajudar vocÃª hoje?"]})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Agora mesmo"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsxs("div",{className:"flex-1 max-w-md",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-lg p-3",children:e.jsx("p",{className:"text-sm",children:"Quando Ã© a prova de matemÃ¡tica?"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1 text-right",children:"VisualizaÃ§Ã£o"})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-300 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(le,{className:"w-4 h-4"})})]})]})]})]}),!j&&e.jsxs(x,{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-flex p-6 rounded-full bg-slate-100 dark:bg-slate-800 mb-4",children:e.jsx(qe,{className:"w-16 h-16 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Chatbot Desativado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6 max-w-md mx-auto",children:"Ative o assistente virtual para permitir que alunos tirem dÃºvidas automaticamente 24/7 com respostas contextualizadas baseadas nos materiais da turma."}),e.jsx("div",{className:"flex justify-center gap-4",children:e.jsxs(M,{onClick:()=>f(!0),size:"lg",children:[e.jsx(qe,{className:"w-5 h-5 mr-2"}),"Ativar Chatbot"]})})]})]})},Da=()=>{const{classId:a}=As(),v=es(),{user:p}=Es(),[h,j]=Ds(),[m,l]=i.useState(!0),[d,A]=i.useState(null),[g,o]=i.useState(h.get("tab")||"overview"),[y,n]=i.useState(0);i.useEffect(()=>{if(!/^[0-9a-fA-F-]{36}$/.test(a)){v("/dashboard/classes",{replace:!0});return}a&&c()},[a]),i.useEffect(()=>{const T=h.get("tab");T&&o(T)},[h]);const c=async()=>{try{l(!0);const{data:T,error:R}=await S.from("classes").select("*").eq("id",a).single();if(R)throw R;A(T);const{count:z}=await S.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",a).eq("role","student");n(z||0)}catch(T){$.error("Erro ao carregar turma:",T),u({title:"Erro ao carregar turma",description:"NÃ£o foi possÃ­vel carregar os dados da turma.",variant:"destructive"})}finally{l(!1)}},E=T=>{o(T),j({tab:T})},f=()=>{d?.invite_code&&(navigator.clipboard.writeText(d.invite_code),u({title:"CÃ³digo copiado!",description:"O cÃ³digo de convite foi copiado para a Ã¡rea de transferÃªncia."}))},k=[{id:"overview",label:"VisÃ£o Geral",icon:Qs},{id:"content",label:"Mural de ConteÃºdo",icon:Q},{id:"announcements",label:"Comunicados",icon:ge},{id:"library",label:"Biblioteca",icon:Ke},{id:"activities",label:"Atividades",icon:Je},{id:"students",label:"Alunos",icon:le},{id:"metrics",label:"MÃ©tricas",icon:Ye},{id:"chatbot",label:"Chatbot",icon:rs}];if(m)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ie,{size:"lg"})});const q=d?.color||"from-blue-600 to-cyan-500";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsxs("div",{className:`relative h-64 bg-gradient-to-r ${q} overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute top-4 left-6",children:e.jsxs(M,{variant:"ghost",onClick:()=>v("/dashboard/classes"),className:"text-white hover:bg-white/20",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs("div",{className:"absolute top-4 right-6 flex items-center gap-2",children:[e.jsx(M,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(vs,{className:"w-4 h-4"})}),e.jsx(M,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(M,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>{},children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-center px-6 max-w-7xl mx-auto",children:[e.jsx(H.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-4xl font-bold text-white mb-2",children:d?.name}),e.jsx(H.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-lg text-white/90 mb-4",children:d?.subject}),d?.description&&e.jsx(H.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-white/80 max-w-2xl line-clamp-2",children:d.description}),e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex items-center gap-3 mt-4",children:[e.jsxs(U,{className:"bg-white/20 text-white border-white/30",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),y," alunos"]}),d?.is_active!==!1?e.jsxs(U,{className:"bg-green-500/20 text-green-100 border-green-400/30",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Ativa"]}):e.jsx(U,{className:"bg-gray-500/20 text-gray-100 border-gray-400/30",children:"Arquivada"}),d?.invite_code&&e.jsxs(U,{className:"bg-white/20 text-white border-white/30 cursor-pointer hover:bg-white/30",onClick:f,children:[e.jsx(Xe,{className:"w-3 h-3 mr-1"}),"CÃ³digo: ",d.invite_code]})]})]}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 h-16 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsx("div",{className:"sticky top-0 z-40 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide py-1",children:k.map(T=>{const R=T.icon,z=g===T.id;return e.jsxs("button",{onClick:()=>E(T.id),className:`
                    flex items-center gap-2 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all
                    ${z?"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}
                  `,children:[e.jsx(R,{className:"w-4 h-4"}),T.label]},T.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[g==="overview"&&e.jsx(Ks,{classId:a,classData:d}),g==="content"&&e.jsx(rt,{classId:a}),g==="announcements"&&e.jsx(it,{classId:a}),g==="library"&&e.jsx(dt,{classId:a}),g==="activities"&&e.jsx(ct,{classId:a}),g==="students"&&e.jsx(xt,{classId:a,classData:d}),g==="metrics"&&e.jsx(ut,{classId:a}),g==="chatbot"&&e.jsx(ht,{classId:a,classData:d})]})]})};export{Da as default};
