import{c as I,s as i,a as L,r as j,j as e,k as S}from"./main-PnoWv5mu.js";import{C as P}from"./card-DNyDBtwZ.js";import{m as U,B as q}from"./button-B1az96ai.js";import{t as h}from"./use-toast-VMwxor12.js";import{U as O}from"./user-IPdw0V9z.js";import{S as $}from"./settings-BAc4VZJo.js";import{S as D}from"./shield-CWyCoI_W.js";import{S as F}from"./save-C6-ScC0D.js";import{X as R}from"./x-7WqOwCJm.js";import{B as Y}from"./bell-jlu-i0nu.js";import{a as T,b as G}from"./SidebarPremium-DbDmcmQG.js";import{G as H}from"./globe-B93wOFJv.js";import"./book-open-BN8GTFXN.js";import"./trending-up-BnoBnv7_.js";import"./file-text-WNEYLkuB.js";import"./users-CZvcSbj_.js";import"./graduation-cap-BTPeK0uK.js";import"./index-DvZMkTcl.js";import"./chart-column-Ba9dXnEb.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],J=I("camera",V),W=async o=>{try{const{data:s,error:r}=await i.from("profiles").select("*").eq("id",o).eq("role","teacher").single();if(r)throw r;return{data:s,error:null}}catch(s){return console.error("Erro ao buscar perfil do professor:",s),{data:null,error:s}}},X=async(o,s)=>{try{const{data:r,error:n}=await i.from("profiles").update({...s,updated_at:new Date().toISOString()}).eq("id",o).select().single();if(n)throw n;return{data:r,error:null}}catch(r){return console.error("Erro ao atualizar perfil do professor:",r),{data:null,error:r}}},B=async o=>{try{const{data:s,error:r}=await i.from("classes").select("id").eq("created_by",o).eq("is_active",!0);if(r)throw r;const n=s?.length||0,c=s?.map(v=>v.id)||[],{data:d,error:u}=await i.from("class_members").select("user_id").in("class_id",c).eq("role","student");if(u)throw u;const b=new Set(d?.map(v=>v.user_id)||[]).size,{data:l,error:p}=await i.from("activities").select("id").eq("created_by",o);if(p)throw p;const x=l?.length||0,g=l?.map(v=>v.id)||[],{data:y,error:k}=await i.from("submissions").select("id").in("activity_id",g).eq("status","submitted");if(k)throw k;const C=y?.length||0,{data:N,error:_}=await i.from("submissions").select("grade").in("activity_id",g).not("grade","is",null);if(_)throw _;const z=N?.length>0?N.reduce((v,M)=>v+M.grade,0)/N.length:0,a=new Date;a.setHours(0,0,0,0);const t=new Date(a);t.setDate(t.getDate()+1);const{data:m,error:f}=await i.from("submissions").select("id").in("activity_id",g).gte("graded_at",a.toISOString()).lt("graded_at",t.toISOString());if(f)throw f;const A=m?.length||0;return{data:{totalClasses:n,totalStudents:b,totalActivities:x,pendingGrading:C,avgGrade:Number(z.toFixed(1)),todayCorrections:A},error:null}}catch(s){return console.error("Erro ao buscar estatísticas do professor:",s),{data:null,error:s}}},K=async o=>{try{const{data:s,error:r}=await B(o);if(r)throw r;const{data:n,error:c}=await i.from("classes").select(`
        *,
        class_members(count)
      `).eq("created_by",o).eq("is_active",!0).order("updated_at",{ascending:!1}).limit(5);if(c)throw c;const{data:d,error:u}=await i.from("activities").select(`
        *,
        activity_class_assignments(class:classes(name))
      `).eq("created_by",o).order("created_at",{ascending:!1}).limit(5);if(u)throw u;return{data:{stats:s,recentClasses:n||[],recentActivities:d||[]},error:null}}catch(s){return console.error("Erro ao buscar resumo do dashboard:",s),{data:null,error:s}}},Q=async(o,s)=>{try{const{data:r}=await i.from("profiles").select("preferences").eq("id",o).single(),c={...r?.preferences||{},...s,updated_at:new Date().toISOString()},{data:d,error:u}=await i.from("profiles").update({preferences:c}).eq("id",o).select().single();if(u)throw u;return{data:d,error:null}}catch(r){return console.error("Erro ao atualizar preferências:",r),{data:null,error:r}}},Z=async(o,s)=>{try{const r=s.name.split(".").pop(),c=`avatars/${`${o}-${Date.now()}.${r}`}`,{error:d}=await i.storage.from("avatars").upload(c,s,{cacheControl:"3600",upsert:!0});if(d)throw d;const{data:u}=i.storage.from("avatars").getPublicUrl(c),w=u.publicUrl,{error:b}=await i.from("profiles").update({avatar_url:w}).eq("id",o);if(b)throw b;return{data:{avatar_url:w},error:null}}catch(r){return console.error("Erro ao fazer upload do avatar:",r),{data:null,error:r}}},E={getTeacherProfile:W,updateTeacherProfile:X,getTeacherStats:B,getDashboardSummary:K,updatePreferences:Q,uploadAvatar:Z},ve=()=>{const{user:o}=L(),[s,r]=j.useState(!0),[n,c]=j.useState(!1),[d,u]=j.useState("personal"),[w,b]=j.useState(!1),[l,p]=j.useState({full_name:"",email:"",phone:"",cpf:"",date_of_birth:"",bio:"",specializations:[],education:"",institution:"",avatar_url:""}),[x,g]=j.useState({notifications:{email:{newSubmissions:!0,studentsAlert:!0,upcomingEvents:!0,weeklyReport:!0,platform:!0},push:{newSubmissions:!0,todayEvents:!1,messages:!0},inApp:"all"},interface:{language:"pt-BR",theme:"light",fontSize:"medium"},regional:{timezone:"America/Sao_Paulo",dateFormat:"DD/MM/YYYY",timeFormat:"24h"},dashboard:{itemsPerPage:25,defaultClassOrder:"recent",showArchivedClasses:!1}});j.useEffect(()=>{o?.id&&y()},[o]);const y=async()=>{try{r(!0);const{data:a,error:t}=await E.getTeacherProfile(o.id);if(t)throw t;a&&(p({full_name:a.full_name||"",email:a.email||"",phone:a.phone||"",cpf:a.cpf||"",date_of_birth:a.date_of_birth||"",bio:a.bio||"",specializations:a.specializations||[],education:a.education||"",institution:a.institution||"",avatar_url:a.avatar_url||""}),a.preferences&&g(m=>({...m,...a.preferences})))}catch(a){console.error("Erro ao carregar perfil:",a),h({title:"Erro ao carregar perfil",description:"Não foi possível carregar seus dados.",variant:"destructive"})}finally{r(!1)}},k=async a=>{const t=a.target.files?.[0];if(t){if(!t.type.startsWith("image/")){h({title:"Arquivo inválido",description:"Por favor, selecione uma imagem.",variant:"destructive"});return}if(t.size>5*1024*1024){h({title:"Arquivo muito grande",description:"A imagem deve ter no máximo 5MB.",variant:"destructive"});return}try{b(!0);const{data:m,error:f}=await E.uploadAvatar(o.id,t);if(f)throw f;p(A=>({...A,avatar_url:m.avatar_url})),h({title:"Foto atualizada!",description:"Sua foto de perfil foi atualizada com sucesso."})}catch(m){console.error("Erro ao fazer upload:",m),h({title:"Erro ao fazer upload",description:"Não foi possível atualizar sua foto.",variant:"destructive"})}finally{b(!1)}}},C=async()=>{if(!l.full_name.trim()){h({title:"Nome obrigatório",description:"Por favor, preencha seu nome completo.",variant:"destructive"});return}try{c(!0);const{error:a}=await E.updateTeacherProfile(o.id,{full_name:l.full_name,phone:l.phone,cpf:l.cpf,date_of_birth:l.date_of_birth,bio:l.bio,specializations:l.specializations,education:l.education,institution:l.institution});if(a)throw a;h({title:"Perfil atualizado!",description:"Suas informações foram salvas com sucesso."})}catch(a){console.error("Erro ao salvar perfil:",a),h({title:"Erro ao salvar",description:"Não foi possível salvar suas alterações.",variant:"destructive"})}finally{c(!1)}},N=async()=>{try{c(!0);const{error:a}=await E.updatePreferences(o.id,x);if(a)throw a;h({title:"Preferências salvas!",description:"Suas configurações foram atualizadas."}),_(x.interface.theme)}catch(a){console.error("Erro ao salvar preferências:",a),h({title:"Erro ao salvar",description:"Não foi possível salvar suas preferências.",variant:"destructive"})}finally{c(!1)}},_=a=>{const t=document.documentElement;a==="dark"?t.classList.add("dark"):a==="light"?t.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?t.classList.add("dark"):t.classList.remove("dark")},z=[{id:"personal",label:"Dados Pessoais",icon:O},{id:"preferences",label:"Preferências",icon:$},{id:"security",label:"Segurança",icon:D}];return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(S,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Meu Perfil"}),e.jsx("p",{className:"text-cyan-100",children:"Gerencie suas informações pessoais e preferências"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx(P,{className:"lg:col-span-1 p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 h-fit",children:e.jsx("div",{className:"space-y-2",children:z.map(a=>{const t=a.icon,m=d===a.id;return e.jsxs("button",{onClick:()=>u(a.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${m?"bg-blue-50 dark:bg-blue-950/30 text-blue-600 dark:text-blue-400 border-2 border-blue-600":"text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 border-2 border-transparent"}`,children:[e.jsx(t,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:a.label})]},a.id)})})}),e.jsxs("div",{className:"lg:col-span-3",children:[d==="personal"&&e.jsxs(P,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Dados Pessoais"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Foto de Perfil"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center text-white text-2xl font-bold overflow-hidden",children:l.avatar_url?e.jsx("img",{src:l.avatar_url,alt:"Avatar",className:"w-full h-full object-cover"}):l.full_name?.[0]||"P"}),w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:e.jsx(S,{size:"sm"})})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:k,className:"hidden",disabled:w}),e.jsxs("label",{htmlFor:"avatar-upload",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg cursor-pointer transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),"Alterar Foto"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"JPG, PNG ou GIF. Máximo 5MB."})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white",children:"Informações Básicas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:l.full_name,onChange:a=>p(t=>({...t,full_name:a.target.value})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Seu nome completo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:l.email,readOnly:!0,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg bg-slate-100 dark:bg-slate-800 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Telefone"}),e.jsx("input",{type:"tel",value:l.phone,onChange:a=>p(t=>({...t,phone:a.target.value})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:l.cpf,onChange:a=>p(t=>({...t,cpf:a.target.value})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"000.000.000-00"})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white",children:"Informações Profissionais"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Biografia Profissional"}),e.jsxs("span",{className:"text-xs text-slate-500",children:[l.bio.length,"/500"]})]}),e.jsx("textarea",{value:l.bio,onChange:a=>{a.target.value.length<=500&&p(t=>({...t,bio:a.target.value}))},rows:4,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Conte um pouco sobre sua experiência e metodologia..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Instituição"}),e.jsx("input",{type:"text",value:l.institution,onChange:a=>p(t=>({...t,institution:a.target.value})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Nome da escola/universidade"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(q,{onClick:C,disabled:n,className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Salvar Alterações"]})}),e.jsxs(q,{variant:"outline",onClick:y,disabled:n,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Cancelar"]})]})]}),d==="preferences"&&e.jsxs(P,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Preferências"}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Notificações por Email"]}),e.jsx("div",{className:"space-y-3",children:Object.entries({newSubmissions:"Novas submissões de alunos",studentsAlert:"Alunos em alerta",upcomingEvents:"Lembrete de eventos próximos",weeklyReport:"Resumo semanal de atividades",platform:"Comunicados da plataforma"}).map(([a,t])=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.notifications.email[a],onChange:m=>g(f=>({...f,notifications:{...f.notifications,email:{...f.notifications.email,[a]:m.target.checked}}})),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:t})]},a))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[x.interface.theme==="dark"?e.jsx(T,{className:"w-5 h-5"}):e.jsx(G,{className:"w-5 h-5"}),"Interface"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Tema Visual"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Claro",icon:G},{value:"dark",label:"Escuro",icon:T},{value:"auto",label:"Automático",icon:H}].map(({value:a,label:t,icon:m})=>e.jsxs("button",{onClick:()=>g(f=>({...f,interface:{...f.interface,theme:a}})),className:`flex-1 flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${x.interface.theme===a?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:[e.jsx(m,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:t})]},a))})]})})]}),e.jsx("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:e.jsx(q,{onClick:N,disabled:n,className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Salvar Preferências"]})})})]}),d==="security"&&e.jsxs(P,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Segurança"}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Funcionalidades de segurança em breve."})]})]})]})]})]})};export{ve as default};
