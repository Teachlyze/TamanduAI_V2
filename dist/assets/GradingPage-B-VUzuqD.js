import{r as m,j as e,o as R,u as T,s as w,l as P,m as q}from"./main-KTzSHcut.js";import{B as k}from"./button-Ch10pVNC.js";import{C as y}from"./card-D1C_XPb6.js";import{B as A}from"./SidebarPremium-Bjey2152.js";import{u as z}from"./use-toast-Dl4X8ZMv.js";import{c as E,D as J}from"./DashboardHeader-CqV_snk3.js";import{I as Q}from"./input-CKizEs14.js";import"./dropdown-menu-CFKsTZzS.js";import{L as I}from"./label-BhBBP-Nu.js";import{S as U}from"./save-DLCLAimN.js";import{X as G}from"./x-ZCLeMxGr.js";import{A as H}from"./arrow-left-C_Z1RXOs.js";import{U as K}from"./user-CWyOXzMq.js";import{F as M}from"./file-text-DYnGBvGu.js";import{C as V}from"./chevron-left-CSV34vXX.js";import{C as X}from"./chevron-right-DlLEuI3N.js";import"./bell-B4NUN7bW.js";import"./book-open-dxp_3U19.js";import"./trending-up-BsXLUj7W.js";import"./settings-BYjJE2lM.js";import"./users-BaZp6eLM.js";import"./graduation-cap-ArnOenSA.js";import"./index-Bp0dZcFm.js";import"./chart-column-BJvjjOHx.js";import"./index-BpWMJgsg.js";import"./index-sBzZX1-K.js";import"./Combination-CGrYuS6N.js";import"./index-BMHZaHkZ.js";import"./check-GWOQjZuW.js";const W=({maxGrade:l=10,initialGrade:h=null,initialFeedback:j="",onSave:S,onCancel:v,loading:f=!1})=>{const[n,s]=m.useState(h?.toString()||""),[N,g]=m.useState(j),[p,u]=m.useState({}),_=()=>{const t={};if(!n||n.trim()==="")t.grade="Nota √© obrigat√≥ria";else{const c=parseFloat(n);isNaN(c)?t.grade="Nota deve ser um n√∫mero":c<0?t.grade="Nota n√£o pode ser negativa":c>l&&(t.grade=`Nota n√£o pode ser maior que ${l}`)}return u(t),Object.keys(t).length===0},b=t=>{if(t.preventDefault(),!_())return;const c=parseFloat(n);S({grade:c,feedback:N})},$=t=>{const c=t.target.value;(c===""||/^\d*\.?\d*$/.test(c))&&(s(c),p.grade&&u({...p,grade:null}))};return e.jsx(y,{className:"p-6 bg-white dark:bg-slate-900",children:e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(I,{htmlFor:"grade",className:"text-sm font-semibold mb-2 block",children:["Nota (0 - ",l,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{id:"grade",type:"text",value:n,onChange:$,placeholder:`Ex: ${(l/2).toFixed(1)}`,className:`text-lg font-semibold ${p.grade?"border-red-500 focus:ring-red-500":""}`,disabled:f}),e.jsxs("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-slate-500",children:["/ ",l]})]}),p.grade&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:p.grade}),n&&!isNaN(parseFloat(n))&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${parseFloat(n)>=l*.7?"bg-green-500":parseFloat(n)>=l*.5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(parseFloat(n)/l*100,100)}%`}})})})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"feedback",className:"text-sm font-semibold mb-2 block",children:"Feedback (opcional)"}),e.jsx("textarea",{id:"feedback",value:N,onChange:t=>g(t.target.value),placeholder:"Escreva um feedback para o aluno...",rows:6,disabled:f,className:`
              w-full px-3 py-2 rounded-lg border ${E.border.default}
              bg-white dark:bg-slate-900 ${E.text.primary}
              focus:ring-2 focus:ring-blue-500 focus:border-blue-500
              resize-none transition-all
            `}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-500",children:[N.length," caracteres"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{type:"submit",disabled:f,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Salvar Nota"]})}),v&&e.jsxs(k,{type:"button",variant:"outline",onClick:v,disabled:f,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Cancelar"]})]})]})})},$e=()=>{const{submissionId:l}=R(),h=T(),{toast:j}=z(),[S,v]=m.useState(!0),[f,n]=m.useState(!1),[s,N]=m.useState(null),[g,p]=m.useState(null),[u,_]=m.useState(null),[b,$]=m.useState([]),[t,c]=m.useState(0);m.useEffect(()=>{L()},[l]);const D=()=>{if(!s?.content)return e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhum conte√∫do enviado."});if(typeof s.content=="string")return e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-950 rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:s.content})});try{const r=typeof s.content=="string"?JSON.parse(s.content):s.content,o=g?.content?.questions||[];return o.length===0?e.jsx("div",{className:"space-y-4",children:Object.entries(r).map(([a,x],i)=>e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-950 rounded-lg border border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300 font-bold flex-shrink-0",children:i+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-slate-900 dark:text-white mb-1",children:["Quest√£o ",i+1]}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("span",{className:"font-semibold",children:"Resposta:"})," ",Array.isArray(x)?x.join(", "):x]})]})]})},a))}):e.jsx("div",{className:"space-y-4",children:o.map((a,x)=>{const i=r[a.id],d=a.answerKey,C=d&&(Array.isArray(i)?i.length===d.length&&i.every(B=>d.includes(B)):i===d);return e.jsx("div",{className:`p-4 rounded-lg border-2 ${d?C?"bg-emerald-50 dark:bg-emerald-950/30 border-emerald-300 dark:border-emerald-800":"bg-red-50 dark:bg-red-950/30 border-red-300 dark:border-red-800":"bg-slate-50 dark:bg-slate-950 border-slate-200 dark:border-slate-800"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0 ${d?C?"bg-emerald-500 text-white":"bg-red-500 text-white":"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300"}`,children:x+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white mb-2",children:a.title||a.label||`Quest√£o ${x+1}`}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"Resposta do aluno:"}),e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white mt-1",children:Array.isArray(i)?i.join(", "):i||"Sem resposta"})]}),d&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"Gabarito:"}),e.jsx("p",{className:"text-sm font-medium text-emerald-600 dark:text-emerald-400 mt-1",children:Array.isArray(d)?d.join(", "):d})]}),d&&e.jsx("div",{className:"mt-2",children:C?e.jsx(A,{className:"bg-emerald-500 text-white",children:"‚úì Correta"}):e.jsx(A,{className:"bg-red-500 text-white",children:"‚úó Incorreta"})})]})]})},a.id)})})}catch{return e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-950 rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:JSON.stringify(s.content,null,2)})})}},L=async()=>{try{v(!0);const{data:r,error:o}=await w.from("submissions").select(`
          *,
          student:profiles!student_id(id, full_name, email, avatar_url),
          activity:activities!activity_id(id, title, max_score, due_date, content)
        `).eq("id",l).single();if(o){P.error("Erro ao carregar submiss√£o:",o),j({title:"Erro ao carregar submiss√£o",description:o?.message||"N√£o foi poss√≠vel encontrar esta submiss√£o.",variant:"destructive"}),h("/dashboard/activities");return}if(N(r),p(r.activity),r.activity_id){const{data:i}=await w.from("activity_class_assignments").select(`
            class_id,
            classes:class_id(id, name, subject)
          `).eq("activity_id",r.activity_id).single();i?.classes&&_(i.classes)}const{data:a,error:x}=await w.from("submissions").select("id, student_id, status").eq("activity_id",r.activity_id).order("submitted_at",{ascending:!0});if(!x){$(a||[]);const i=a?.findIndex(d=>d.id===l)??0;c(i)}}catch(r){j({title:"Erro ao carregar submiss√£o",description:r?.message||"Tente novamente.",variant:"destructive"})}finally{v(!1)}},O=async({grade:r,feedback:o})=>{try{n(!0);const{error:a}=await w.from("submissions").update({grade:r,feedback:o,status:"graded",graded_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",l);if(a)throw a;if(j({title:"‚úÖ Nota salva com sucesso!",description:"O feedback foi enviado ao aluno."}),t<b.length-1){const x=b[t+1];h(`/dashboard/grading/${x.id}`)}else h(`/dashboard/activities/${g?.id}/submissions`)}catch(a){j({title:"Erro ao salvar nota",description:a?.message||"Tente novamente em instantes.",variant:"destructive"})}finally{n(!1)}},F=r=>{const o=r==="prev"?t-1:t+1;if(o>=0&&o<b.length){const a=b[o];h(`/dashboard/grading/${a.id}`)}};return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(q,{size:"lg",text:"Carregando submiss√£o..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(k,{variant:"ghost",onClick:()=>h(`/dashboard/activities/${g?.id}/submissions`),className:"mb-4",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Voltar para Submiss√µes"]}),e.jsx(J,{title:`Corrigir Submiss√£o${s?.student?.full_name?` - ${s.student.full_name}`:""}`,subtitle:`${g?.title||"Atividade"}${u?.name?` ‚Ä¢ Turma: ${u.name}`:""} ‚Ä¢ ${t+1} de ${b.length}`,role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Informa√ß√µes do Aluno"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[s?.student?.avatar_url?e.jsx("img",{src:s.student.avatar_url,alt:s.student.full_name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white text-2xl font-bold",children:s?.student?.full_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white text-lg",children:s?.student?.full_name||"Aluno"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s?.student?.email||"Sem email"}),u&&e.jsxs("p",{className:"text-sm font-medium text-blue-600 dark:text-blue-400 mt-1",children:["üè´ ",u.name," ",u.subject&&`- ${u.subject}`]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Data de Envio:"}),e.jsx("p",{className:"font-semibold text-slate-900 dark:text-white",children:s?.submitted_at?new Date(s.submitted_at).toLocaleString("pt-BR"):"N√£o enviada"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Status:"}),e.jsx("div",{className:"mt-1",children:e.jsx(A,{className:s?.status==="graded"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",children:s?.status==="graded"?"Corrigida":"Pendente"})})]})]})]}),e.jsxs(y,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Conte√∫do da Submiss√£o"]}),e.jsx("div",{className:"max-w-none",children:D()})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{maxGrade:g?.max_score||10,initialGrade:s?.grade,initialFeedback:s?.feedback||"",onSave:O,onCancel:()=>h(`/dashboard/activities/${g?.id}/submissions`),loading:f}),e.jsx(y,{className:"p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{variant:"outline",onClick:()=>F("prev"),disabled:t===0,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t+1," de ",b.length]}),e.jsxs(k,{variant:"outline",onClick:()=>F("next"),disabled:t>=b.length-1,children:["Pr√≥xima",e.jsx(X,{className:"w-4 h-4 ml-2"})]})]})})]})]})]})};export{$e as default};
