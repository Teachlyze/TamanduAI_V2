import{c as le,r as n,s as D,j as e,k as H,a as re,h as ie}from"./main-XRKQFEIr.js";import{C as z}from"./card-BEk2G2Us.js";import{B as p,m as F}from"./button-D4bIZ4Ty.js";import{t as _}from"./use-toast-Cv69gxoh.js";import{r as P}from"./redisCache-Vh2O3gTE.js";import{X as L}from"./x-BPPDjH10.js";import{B as oe}from"./book-open-CAn3t7Hm.js";import{F as ne}from"./file-text-tq0U235S.js";import{U as A}from"./users-DP4-CTtE.js";import{C as J,A as de}from"./index-e3XtT_BD.js";import{S as ce}from"./save-i4jRp2ou.js";import{f as x}from"./format-CxHpq9RK.js";import{B as U}from"./SidebarPremium-BnsbfpCV.js";import{C as me}from"./clock-BXvepPh_.js";import{M as xe}from"./map-pin-Blwfo7ut.js";import{S as ue}from"./square-pen-DxgcZK8Y.js";import{C as he}from"./copy-M4T8qqHL.js";import{T as be}from"./trash-2-BFBmoqwg.js";import{p as T}from"./pt-BR-CXWZr0Zs.js";import{F as pe}from"./funnel-D6OloZPQ.js";import{s as G,a as ge,i as ve}from"./isSameMonth-BQUH752I.js";import{e as V}from"./endOfMonth-BvBmjNQ6.js";import{s as fe,e as ye}from"./subMonths-DHcpZmnJ.js";import{P as X}from"./plus-DVhNLwZX.js";import{C as je}from"./chevron-left-DdOT0T07.js";import{C as ke}from"./chevron-right-C-DpTlMS.js";import{i as Ne}from"./isToday-DbOgdeJ3.js";import"./en-US-azV9x4mt.js";import"./bell-v36tl0On.js";import"./trending-up-eowzUgXK.js";import"./user-CCHLYTsx.js";import"./settings-pQ42cErW.js";import"./graduation-cap-CRbvieNe.js";import"./chart-column-CBFsA3dh.js";import"./constructNow-C8CNs5uJ.js";import"./isSameDay-7UPP47mY.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],_e=le("external-link",we),Ce=({isOpen:i,onClose:o,onSuccess:l,selectedDate:v,teacherId:u})=>{const[g,m]=n.useState(!1),[k,N]=n.useState([]),[t,d]=n.useState({title:"",description:"",event_type:"class",start_date:v?x(v,"yyyy-MM-dd"):x(new Date,"yyyy-MM-dd"),start_time:"08:00",end_time:"09:00",modality:"online",meeting_link:"",location:"",selected_classes:[],color:"#3B82F6"});n.useEffect(()=>{r()},[u]);const r=async()=>{try{const{data:a}=await D.from("classes").select("id, name").eq("created_by",u).eq("is_active",!0).order("name");N(a||[])}catch(a){console.error("Erro ao carregar turmas:",a)}},f=async a=>{if(a.preventDefault(),!t.title.trim()){_({title:"Erro de validaÃ§Ã£o",description:"O tÃ­tulo Ã© obrigatÃ³rio.",variant:"destructive"});return}if(t.modality==="online"&&!t.meeting_link.trim()){_({title:"Erro de validaÃ§Ã£o",description:"Link da reuniÃ£o Ã© obrigatÃ³rio para eventos online.",variant:"destructive"});return}try{m(!0);const c=new Date(`${t.start_date}T${t.start_time}`),b=new Date(`${t.start_date}T${t.end_time}`),w=t.selected_classes.length>0?t.selected_classes.map(j=>({title:t.title,description:t.description,event_type:t.event_type,start_time:c.toISOString(),end_time:b.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:u,teacher_id:u,class_id:j,color:t.color})):[{title:t.title,description:t.description,event_type:t.event_type,start_time:c.toISOString(),end_time:b.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:u,teacher_id:u,color:t.color}],{error:C}=await D.from("calendar_events").insert(w);if(C)throw C;const S=x(c,"yyyy-MM"),E=P.generateKey("calendar",u,S);await P.invalidatePattern(`calendar:${u}:*`),_({title:"Evento criado!",description:"Seu evento foi criado com sucesso."}),l&&l(),o()}catch(c){console.error("Erro ao criar evento:",c),_({title:"Erro ao criar evento",description:"NÃ£o foi possÃ­vel criar o evento.",variant:"destructive"})}finally{m(!1)}},y=[{value:"class",label:"Aula",icon:oe,color:"blue"},{value:"exam",label:"Prova",icon:ne,color:"red"},{value:"meeting",label:"ReuniÃ£o",icon:A,color:"purple"},{value:"personal",label:"Pessoal",icon:J,color:"gray"}];return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Novo Evento"}),e.jsx("button",{onClick:o,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Tipo de Evento"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:y.map(a=>{const c=a.icon,b=t.event_type===a.value;return e.jsxs("button",{type:"button",onClick:()=>d({...t,event_type:a.value}),className:`p-4 rounded-lg border-2 transition-all ${b?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:[e.jsx(c,{className:`w-6 h-6 mx-auto mb-2 ${b?"text-blue-600":"text-slate-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:a.label})]},a.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"TÃ­tulo *"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>d({...t,title:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Aula de MatemÃ¡tica",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:t.description,onChange:a=>d({...t,description:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Detalhes do evento..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Data *"}),e.jsx("input",{type:"date",value:t.start_date,onChange:a=>d({...t,start_date:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"InÃ­cio *"}),e.jsx("input",{type:"time",value:t.start_time,onChange:a=>d({...t,start_time:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Fim *"}),e.jsx("input",{type:"time",value:t.end_time,onChange:a=>d({...t,end_time:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]})]}),(t.event_type==="class"||t.event_type==="exam")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Turmas"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:k.map(a=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_classes.includes(a.id),onChange:c=>{const b=c.target.checked?[...t.selected_classes,a.id]:t.selected_classes.filter(w=>w!==a.id);d({...t,selected_classes:b})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:a.name})]},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Modalidade"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"online",checked:t.modality==="online",onChange:a=>d({...t,modality:a.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Online"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"presential",checked:t.modality==="presential",onChange:a=>d({...t,modality:a.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Presencial"})]})]})]}),t.modality==="online"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Link da ReuniÃ£o *"}),e.jsx("input",{type:"url",value:t.meeting_link,onChange:a=>d({...t,meeting_link:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"https://meet.google.com/...",required:!0})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Local"}),e.jsx("textarea",{value:t.location,onChange:a=>d({...t,location:a.target.value}),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Sala 203, Bloco B"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(p,{type:"button",variant:"outline",onClick:o,disabled:g,className:"flex-1",children:"Cancelar"}),e.jsx(p,{type:"submit",disabled:g,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:g?e.jsxs(e.Fragment,{children:[e.jsx(H,{size:"sm",className:"mr-2"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Criar Evento"]})})]})]})]})}):null},Ee=({isOpen:i,onClose:o,event:l,onEdit:v,onDelete:u})=>{const[g,m]=n.useState(!1),[k,N]=n.useState(!1),t=async()=>{try{m(!0);const{error:a}=await D.from("calendar_events").delete().eq("id",l.id);if(a)throw a;_({title:"Evento excluÃ­do!",description:"O evento foi removido com sucesso."}),u(),o()}catch(a){console.error("Erro ao excluir evento:",a),_({title:"Erro ao excluir",description:"NÃ£o foi possÃ­vel excluir o evento.",variant:"destructive"})}finally{m(!1)}},d=()=>{_({title:"Em desenvolvimento",description:"Funcionalidade em breve."})},r=a=>({class:"Aula",exam:"Prova",meeting:"ReuniÃ£o",personal:"Pessoal"})[a]||a,f=a=>({class:"bg-blue-100 text-blue-700",exam:"bg-red-100 text-red-700",meeting:"bg-purple-100 text-purple-700",personal:"bg-gray-100 text-gray-700"})[a]||"bg-gray-100 text-gray-700",y=()=>{const a=new Date(l.start_time),b=new Date(l.end_time)-a,w=Math.floor(b/(1e3*60*60)),C=Math.floor(b%(1e3*60*60)/(1e3*60));return w>0?`${w}h ${C}min`:`${C}min`};return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:l.title}),e.jsx(U,{className:f(l.event_type),children:r(l.event_type)})]}),e.jsx("button",{onClick:o,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-slate-300",children:[e.jsx(me,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:x(new Date(l.start_time),"EEEE, d 'de' MMMM",{locale:T})}),e.jsxs("div",{className:"text-sm text-slate-500",children:[x(new Date(l.start_time),"HH:mm")," - ",x(new Date(l.end_time),"HH:mm")," â€¢ ",y()]})]})]}),l.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:"DescriÃ§Ã£o"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:l.description})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:l.modality==="online"?"Online":"Presencial"}),l.modality==="online"&&l.meeting_link&&e.jsxs("a",{href:l.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-1",children:["Abrir link da reuniÃ£o",e.jsx(_e,{className:"w-3 h-3"})]}),l.modality==="presential"&&l.location&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:l.location})]})]}),l.class&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),"Turma"]}),e.jsx(U,{variant:"outline",children:l.class.name})]}),l.participants&&Array.isArray(l.participants)&&l.participants.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),"Participantes"]}),e.jsx("div",{className:"space-y-2",children:l.participants.map((a,c)=>e.jsx("div",{className:"text-sm text-slate-700 dark:text-slate-300",children:a.name||a.email||"Participante"},c))})]}),k&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 mb-3",children:"Tem certeza que deseja excluir este evento? Esta aÃ§Ã£o nÃ£o pode ser desfeita."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>N(!1),disabled:g,children:"Cancelar"}),e.jsx(p,{size:"sm",onClick:t,disabled:g,className:"bg-red-600 hover:bg-red-700",children:g?e.jsxs(e.Fragment,{children:[e.jsx(H,{size:"sm",className:"mr-2"}),"Excluindo..."]}):"Confirmar ExclusÃ£o"})]})]})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(p,{variant:"outline",onClick:v,className:"flex-1",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(p,{variant:"outline",onClick:d,className:"flex-1",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(p,{variant:"outline",onClick:()=>N(!0),className:"flex-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})})]})}):null},Se=({filters:i,setFilters:o,teacherId:l})=>{const[v,u]=n.useState([]);n.useEffect(()=>{g()},[l]);const g=async()=>{try{const{data:r}=await D.from("classes").select("id, name").eq("created_by",l).eq("is_active",!0).order("name");u(r||[])}catch(r){console.error("Erro ao carregar turmas:",r)}},m=[{value:"class",label:"Aulas",color:"blue"},{value:"exam",label:"Provas",color:"red"},{value:"meeting",label:"ReuniÃµes",color:"purple"},{value:"personal",label:"Pessoal",color:"gray"}],k=r=>{const f=i.types.includes(r)?i.types.filter(y=>y!==r):[...i.types,r];o({...i,types:f})},N=r=>{const f=i.classes.includes(r)?i.classes.filter(y=>y!==r):[...i.classes,r];o({...i,classes:f})},t=()=>{o({types:[],classes:[],modality:"all"})},d=i.types.length>0||i.classes.length>0||i.modality!=="all";return e.jsxs(z,{className:"p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Filtros"]}),d&&e.jsx(p,{variant:"ghost",size:"sm",onClick:t,children:e.jsx(L,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Tipo de Evento"}),e.jsx("div",{className:"space-y-2",children:m.map(r=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:i.types.includes(r.value),onChange:()=>k(r.value),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:r.label})]},r.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Turmas"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:v.map(r=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:i.classes.includes(r.id),onChange:()=>N(r.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:r.name})]},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Modalidade"}),e.jsxs("select",{value:i.modality,onChange:r=>o({...i,modality:r.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 text-sm",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"presential",children:"Presencial"})]})]})]})},W=ie.memo(({day:i,dayEvents:o,isCurrentDay:l,isSameMonthDay:v,onClick:u,onEventClick:g})=>e.jsxs(F.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},onClick:u,className:`
        min-h-[120px] p-3 border rounded-xl cursor-pointer transition-all hover:shadow-lg group relative
        ${l?"border-2 border-blue-600 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 shadow-md":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}
        ${!v&&"opacity-40"}
        hover:bg-gradient-to-br hover:from-slate-50 hover:to-blue-50 dark:hover:from-slate-800 dark:hover:to-blue-950/30
      `,children:[e.jsxs("div",{className:`
        text-sm font-bold mb-2 flex items-center justify-between
        ${l?"text-blue-600":"text-slate-900 dark:text-white"}
      `,children:[e.jsx("span",{children:x(i,"d")}),o.length>0&&e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-600 text-white text-xs flex items-center justify-center",children:o.length})]}),e.jsxs("div",{className:"space-y-1.5",children:[o.slice(0,2).map(m=>e.jsx("div",{onClick:k=>{k.stopPropagation(),g(m)},className:`
              text-xs px-2 py-1.5 rounded-lg truncate font-medium shadow-sm transition-all
              ${m.event_type==="class"&&"bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 dark:from-blue-900 dark:to-blue-800 dark:text-blue-200 hover:shadow-md"}
              ${m.event_type==="exam"&&"bg-gradient-to-r from-red-100 to-red-200 text-red-800 dark:from-red-900 dark:to-red-800 dark:text-red-200 hover:shadow-md"}
              ${m.event_type==="meeting"&&"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 dark:from-purple-900 dark:to-purple-800 dark:text-purple-200 hover:shadow-md"}
              ${m.event_type==="other"&&"bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800 dark:from-gray-900 dark:to-gray-800 dark:text-gray-200 hover:shadow-md"}
              hover:scale-105
            `,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:x(new Date(m.start_time),"HH:mm")}),e.jsx("span",{className:"truncate",children:m.title})]})},m.id)),o.length>2&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 px-2 py-1 bg-blue-50 dark:bg-blue-950/30 rounded-lg font-medium",children:["+",o.length-2," evento",o.length-2>1?"s":""]})]})]}));W.displayName="CalendarDay";const mt=()=>{const{user:i}=re(),[o,l]=n.useState(new Date),[v,u]=n.useState([]),[g,m]=n.useState([]),[k,N]=n.useState(!0),[t,d]=n.useState(!1),[r,f]=n.useState(!1),[y,a]=n.useState(null),[c,b]=n.useState(null),[w,C]=n.useState([]),[S,E]=n.useState(!1),[j,Y]=n.useState({types:[],classes:[],modality:"all"}),$=n.useCallback(async()=>{try{N(!0);const s=G(o),h=V(o),M=P.generateKey("calendar",i.id,x(o,"yyyy-MM")),q=await P.cacheQuery(M,async()=>{const{data:O,error:Q}=await D.from("calendar_events").select(`
              *,
              class:classes(id, name)
            `).eq("created_by",i.id).gte("start_time",s.toISOString()).lte("start_time",h.toISOString()).order("start_time");if(Q)throw Q;return O||[]},300);u(q)}catch(s){console.error("Erro ao carregar eventos:",s),_({title:"Erro ao carregar eventos",description:"NÃ£o foi possÃ­vel carregar seus eventos.",variant:"destructive"})}finally{N(!1)}},[o,i?.id]),B=n.useCallback(()=>{let s=[...v];j.types.length>0&&(s=s.filter(h=>j.types.includes(h.event_type))),j.classes.length>0&&(s=s.filter(h=>h.class_id&&j.classes.includes(h.class_id))),j.modality!=="all"&&(s=s.filter(h=>h.modality===j.modality)),m(s)},[v,j]);n.useEffect(()=>{i?.id&&$()},[i?.id,$]),n.useEffect(()=>{B()},[B]);const Z=n.useCallback(()=>{l(s=>fe(s)),E(!1)},[]),I=n.useCallback(()=>{l(s=>ge(s,1)),E(!1)},[]),ee=n.useCallback(()=>{l(new Date),E(!1)},[]),te=s=>{b(s);const h=K(s);C(h),E(!0)},R=s=>{a(s),f(!0)},K=s=>g.filter(h=>{const M=new Date(h.start_time);return x(M,"yyyy-MM-dd")===x(s,"yyyy-MM-dd")}),se=n.useMemo(()=>{const s=G(o),h=V(o);return ye({start:s,end:h})},[o]),ae=n.useMemo(()=>["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"],[]);return k?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(H,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Minha Agenda"}),e.jsx("p",{className:"text-cyan-100",children:"Gerencie aulas, reuniÃµes e eventos"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{onClick:ee,variant:"outline",className:"bg-white/10 hover:bg-white/20 border-white/20 text-white",children:"Hoje"}),e.jsxs(p,{onClick:()=>{b(new Date),d(!0)},className:"bg-white text-blue-600 hover:bg-white/90",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Novo Evento"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:S?"lg:col-span-8 transition-all duration-300":"lg:col-span-9 transition-all duration-300",children:e.jsxs(z,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:Z,children:e.jsx(je,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white capitalize",children:x(o,"MMMM yyyy",{locale:T})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:I,children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[ae.map(s=>e.jsx("div",{className:"text-center text-sm font-semibold text-slate-600 dark:text-slate-400 py-2",children:s},s)),e.jsx(de,{children:se.map((s,h)=>{const M=K(s),q=Ne(s),O=ve(s,o);return e.jsx(W,{day:s,dayEvents:M,isCurrentDay:q,isSameMonthDay:O,onClick:()=>te(s),onEventClick:R},`${x(s,"yyyy-MM-dd")}-${h}`)})})]})]})}),!S&&e.jsx("div",{className:"lg:col-span-3 space-y-4",children:e.jsx(Se,{filters:j,setFilters:Y,teacherId:i?.id})}),S&&c&&e.jsx("div",{className:"lg:col-span-4",children:e.jsxs(z,{className:"p-6 bg-white dark:bg-slate-900 border-2 border-blue-200 dark:border-blue-800 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:x(c,"d 'de' MMMM",{locale:T})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:x(c,"EEEE",{locale:T})})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>E(!1),className:"text-slate-500 hover:text-slate-700",children:"âœ•"})]}),e.jsxs(p,{onClick:()=>d(!0),className:"w-full mb-4 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white shadow-lg",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Novo Evento"]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-24rem)] overflow-y-auto",children:w.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"w-12 h-12 mx-auto text-slate-300 dark:text-slate-700 mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nenhum evento neste dia"}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:'Clique em "Novo Evento" para adicionar'})]}):w.map(s=>e.jsx(F.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onClick:()=>R(s),className:`
                        p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md group
                        ${s.event_type==="class"?"border-blue-300 bg-blue-50 dark:bg-blue-950/30":""}
                        ${s.event_type==="exam"?"border-red-300 bg-red-50 dark:bg-red-950/30":""}
                        ${s.event_type==="meeting"?"border-purple-300 bg-purple-50 dark:bg-purple-950/30":""}
                        ${["class","exam","meeting"].includes(s.event_type)?"":"border-gray-300 bg-gray-50 dark:bg-gray-950/30"}
                      `,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:`
                              text-xs font-semibold px-2 py-1 rounded-full
                              ${s.event_type==="class"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":""}
                              ${s.event_type==="exam"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":""}
                              ${s.event_type==="meeting"?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":""}
                              ${["class","exam","meeting"].includes(s.event_type)?"":"bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-300"}
                            `,children:s.event_type==="class"?"ðŸ“š Aula":s.event_type==="exam"?"ðŸ“ Prova":s.event_type==="meeting"?"ðŸ‘¥ ReuniÃ£o":"ðŸ“… Evento"})}),e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white mb-1 group-hover:text-blue-600",children:s.title}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:[x(new Date(s.start_time),"HH:mm")," - ",x(new Date(s.end_time),"HH:mm")]}),s.class?.name&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸŽ“ ",s.class.name]}),s.location&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["ðŸ“ ",s.location]})]})})},s.id))})]})})]}),t&&e.jsx(Ce,{isOpen:t,onClose:()=>{d(!1),b(null)},onSuccess:$,selectedDate:c,teacherId:i?.id}),r&&y&&e.jsx(Ee,{isOpen:r,onClose:()=>{f(!1),a(null)},event:y,onEdit:()=>{f(!1),d(!0)},onDelete:$})]})};export{mt as default};
