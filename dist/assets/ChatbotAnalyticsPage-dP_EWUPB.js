import{h as P,u as E,r,s as v,l as j,j as e,q as R}from"./main-C5n3kzXQ.js";import{B as l}from"./button-CXfsJEZz.js";import{C as o}from"./card-CjtJprPz.js";import{B as d}from"./badge-DIjZdJB4.js";import{S as m}from"./StatsCard-CYCecPlH.js";import{D as I}from"./DashboardHeader-Bi7WU8Vg.js";import"./input-Bec_LEaF.js";import"./dropdown-menu-CgW1-aRc.js";import"./label-B7q1QW2O.js";import{C as $}from"./classService-1pS9mNXc.js";import{e as _}from"./exportService-PMCD_7TW.js";import{u as M}from"./use-toast-BTst2Jag.js";import{A as Q}from"./arrow-left-CPZhu65i.js";import{M as B}from"./message-square-DopJp9b9.js";import{U as F}from"./users-Boys-rM5.js";import{S as L}from"./star-DcZ05FcA.js";import{C as O}from"./clock-DACORgp8.js";import{S as U}from"./square-pen-CW5vMGb9.js";import{P as z}from"./pause-DGoMjAMh.js";import{D as H}from"./download-BdAT_7E0.js";import"./proxy-C-9wZx5L.js";import"./chevron-right-avg7mug8.js";import"./index-B6XryYCt.js";import"./index-C2-paRPo.js";import"./index-CJbM7HGD.js";import"./index-CsW3l1Gu.js";import"./Combination-Chdg_-Wh.js";import"./SidebarPremium-D25G1dNT.js";import"./house-ZJXziqlE.js";import"./book-open-BP8V__Hw.js";import"./file-text-0s37oUXW.js";import"./graduation-cap-DHgx-smk.js";import"./calendar-BkZi9bLz.js";import"./chart-column-5ubExldJ.js";import"./message-circle-oS8o50gZ.js";import"./settings-BnI-Y10b.js";import"./brain-Bn2z760B.js";import"./index-DJGNkgSL.js";import"./x-3ab3q3Ef.js";import"./index-W2DwLdmL.js";import"./check-UVwrTgdR.js";import"./jspdf.plugin.autotable-BGIicTHv.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const _e=()=>{const{classId:i}=P(),u=E(),{toast:x}=M(),[N,p]=r.useState(!0),[g,y]=r.useState(null),[c,C]=r.useState("7"),[b,h]=r.useState(!1),[t,k]=r.useState({totalConversations:145,activeStudents:28,satisfaction:92,avgResponseTime:2.3,topQuestions:[{question:"Como resolver quest√£o de equa√ß√µes?",count:45,activity:"Exerc√≠cios Cap. 3",resolved:!0},{question:"O que √© fun√ß√£o quadr√°tica?",count:38,activity:"Introdu√ß√£o",needsAttention:!0},{question:"Qual a diferen√ßa entre X e Y?",count:29,activity:"Teoria",resolved:!0}],difficultTopics:[{topic:"Equa√ß√µes de 2¬∫ grau",questions:67,satisfaction:78},{topic:"Fun√ß√µes trigonom√©tricas",questions:42,satisfaction:85},{topic:"Logaritmos",questions:35,satisfaction:91}],recentConversations:[{id:"1",student:"Jo√£o Silva",question:"Como calcular derivada?",status:"resolved",timestamp:"2h atr√°s"},{id:"2",student:"Maria Santos",question:"O que √© integral?",status:"resolved",timestamp:"5h atr√°s"},{id:"3",student:"Pedro Costa",question:"D√∫vida sobre limite",status:"needs_attention",timestamp:"1 dia atr√°s"}],insights:[{type:"warning",message:'5 alunos fizeram a mesma pergunta sobre "Equa√ß√µes de 2¬∫ grau"',suggestion:"Considere fazer uma revis√£o"},{type:"info",message:"Uso aumentou 40% esta semana",detail:"Proximidade de prova detectada"},{type:"success",message:'3 alunos avaliaram positivamente a explica√ß√£o sobre "fun√ß√µes"'}]});r.useEffect(()=>{w()},[i,c]);const w=async()=>{try{p(!0);const s=await $.getClassById(i);y(s);const a=new Date;a.setDate(a.getDate()-parseInt(c));const{data:q}=await v.from("class_members").select("user_id").eq("class_id",i).eq("role","student"),f=(q?.map(T=>T.user_id)||[]).length,{data:S}=await v.from("rag_training_sources").select("*").eq("class_id",i),n=S?.length||0,A=0,D=n>0?Math.min(90+n*2,100):0;k({totalConversations:A,activeStudents:f,satisfaction:D,avgResponseTime:2.3,topQuestions:[],difficultTopics:[],recentConversations:[],insights:n===0?[{type:"warning",message:"Nenhuma fonte de treinamento adicionada ao chatbot",suggestion:"Adicione materiais ou atividades para treinar o assistente"}]:[{type:"success",message:`Chatbot treinado com ${n} fonte(s) de conte√∫do`},{type:"info",message:`${f} alunos podem interagir com o assistente`}]})}catch(s){j.error("Erro:",s)}finally{p(!1)}};return N?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(R,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(l,{variant:"ghost",onClick:()=>u("/dashboard/chatbot"),className:"mb-4",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx(I,{title:`Analytics - ${g?.name}`,subtitle:"An√°lise do uso do chatbot",role:"teacher"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:"‚úÖ Ativo"}),e.jsxs("select",{value:c,onChange:s=>C(s.target.value),className:"px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900",children:[e.jsx("option",{value:"7",children:"√öltimos 7 dias"}),e.jsx("option",{value:"30",children:"√öltimos 30 dias"}),e.jsx("option",{value:"90",children:"√öltimos 90 dias"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8",children:[e.jsx(m,{title:"Total de Conversas",value:t.totalConversations,icon:B,gradient:"from-blue-500 to-cyan-500",delay:0}),e.jsx(m,{title:"Alunos Ativos",value:t.activeStudents,icon:F,gradient:"from-cyan-500 to-blue-500",delay:.1}),e.jsx(m,{title:"Taxa de Satisfa√ß√£o",value:`${t.satisfaction}%`,icon:L,gradient:"from-amber-500 to-yellow-500",format:"text",delay:.2}),e.jsx(m,{title:"Tempo M√©dio Resposta",value:`${t.avgResponseTime}s`,icon:O,gradient:"from-blue-500 to-cyan-500",format:"text",delay:.3})]}),e.jsxs(o,{className:"p-4 sm:p-6 bg-white dark:bg-slate-900 mb-6 md:mb-8",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"üí° Insights Autom√°ticos"}),e.jsx("div",{className:"space-y-3",children:t.insights.map((s,a)=>e.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${s.type==="warning"?"border-amber-500 bg-amber-50 dark:bg-amber-950/30":s.type==="success"?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-blue-500 bg-blue-50 dark:bg-blue-950/30"}`,children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:s.message}),s.suggestion&&e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["üí° ",s.suggestion]}),s.detail&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.detail})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 lg:gap-8 mb-6 md:mb-8",children:[e.jsxs(o,{className:"p-4 sm:p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"‚ùì Perguntas Mais Frequentes"}),e.jsx("div",{className:"space-y-4",children:t.topQuestions.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"Nenhuma conversa registrada ainda. As perguntas aparecer√£o aqui quando os alunos come√ßarem a usar o chatbot."}):t.topQuestions.map((s,a)=>e.jsxs("div",{className:"p-3 sm:p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-sm",children:[a+1,'. "',s.question,'" (',s.count,"x)"]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:["üìä Atividade: ",s.activity]})]}),e.jsx(d,{className:s.resolved?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700",children:s.resolved?"‚úÖ Resolvida":"‚ö†Ô∏è Aten√ß√£o"})]}),s.needsAttention&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-2",children:"üí° 30% dos alunos pediram mais exemplos - Considere adicionar mais materiais"})]},a))})]}),e.jsxs(o,{className:"p-4 sm:p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"üìö T√≥picos Mais Dif√≠ceis"}),e.jsx("div",{className:"space-y-4",children:t.difficultTopics.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"Nenhum t√≥pico analisado ainda. Os dados aparecer√£o conforme os alunos interagirem com o chatbot."}):t.difficultTopics.map((s,a)=>e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold",children:s.topic}),e.jsxs(d,{className:s.satisfaction>=90?"bg-green-100 text-green-700":s.satisfaction>=80?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700",children:[s.satisfaction,"%"]})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[s.questions," perguntas"]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.satisfaction>=90?"bg-green-500":s.satisfaction>=80?"bg-amber-500":"bg-red-500"}`,style:{width:`${s.satisfaction}%`}})}),s.satisfaction<85&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-2",children:"üí° Considere revisar este conte√∫do em aula"})]},a))})]})]}),e.jsxs(o,{className:"p-6 bg-white dark:bg-slate-900 mb-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"üí¨ Conversas Recentes"}),e.jsx("div",{className:"space-y-3",children:t.recentConversations.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"Nenhuma conversa recente. Quando os alunos come√ßarem a usar o chatbot, as intera√ß√µes aparecer√£o aqui."}):t.recentConversations.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:s.student[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.student}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.question}),e.jsx("div",{className:"text-xs text-slate-500",children:s.timestamp})]})]}),e.jsx(d,{className:s.status==="resolved"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700",children:s.status==="resolved"?"‚úÖ Resolvida":"‚ö†Ô∏è Precisa aten√ß√£o"})]},s.id))})]}),e.jsxs(o,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(l,{variant:"outline",onClick:()=>u(`/dashboard/chatbot/${i}/config`),className:"flex-1",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Editar Treinamento"]}),e.jsxs(l,{variant:"outline",className:"flex-1",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Pausar Chatbot"]}),e.jsxs(l,{variant:"outline",className:"flex-1",onClick:async()=>{try{h(!0),_(g,t),x({title:"‚úÖ Relat√≥rio exportado!",description:"Download do PDF iniciado."})}catch(s){j.error("Erro ao exportar:",s),x({title:"‚ùå Erro ao exportar",description:s.message,variant:"destructive"})}finally{h(!1)}},disabled:b,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),b?"Exportando...":"Exportar Relat√≥rio"]})]}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 text-center mt-4",children:"üíé Upgrade para PRO: Hist√≥rico completo e an√°lise avan√ßada com IA"})]})]})};export{_e as default};
