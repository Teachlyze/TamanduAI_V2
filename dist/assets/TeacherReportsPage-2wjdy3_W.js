import{c as Q,s as b,r as $,j as e,f as ke,l as N,b as Re}from"./main-BtydHokz.js";import{C as P}from"./card-BLN8IVBT.js";import{B as E}from"./button-pkZcz0fw.js";import{B as se}from"./badge-DpVvk9bK.js";import{L as z}from"./label-Do1Gcpls.js";import{T as Ce,a as Ae,b as re,c as ie}from"./tabs-CcynQOeo.js";import{S as V,a as I,b as U,c as H,d as G}from"./select-D2GCnsr7.js";import{D as Te}from"./DashboardHeader-Do_OLCE8.js";import"./input-DevW5dIO.js";import"./dropdown-menu-DQk5WS44.js";import{u as he}from"./use-toast-BD7ojcJx.js";import{R as $e,T as Ee,C as pe}from"./SidebarPremium-BEHUuQck.js";import{E as De}from"./jspdf.plugin.autotable-_scs8lDs.js";import{s as O}from"./toastUtils-CQiYPKw9.js";import{D as Fe}from"./download-BR6aT-hQ.js";import{F as J}from"./file-text-GwBv-P3B.js";import{P as Pe,F as Ge}from"./printer-CBcVO-yy.js";import{S as qe}from"./share-2-CC-aHbkA.js";import{X as xe}from"./x-BtLVjj0F.js";import{Y,a1 as W,_ as oe,$ as le,a0 as ne}from"./CartesianChart-B4b88xjZ.js";import{P as Be,a as Le}from"./PieChart-ChZ3ZSv7.js";import{C as Oe,B as Me,a as ze}from"./BarChart-D0_ywCL3.js";import{L as Z}from"./Legend-DgRrTzF2.js";import{L as Ve,a as Ie}from"./LineChart-Zy-lH0MG.js";import{H as ce}from"./history-CzfU_WsB.js";import{S as Ue}from"./settings-BNGXdjmZ.js";import{P as X}from"./plus-MdU524Dr.js";import{F as He}from"./funnel-CJBaT3bZ.js";import{U as Je}from"./user-CD_i74Py.js";import{U as Ke}from"./users-CntpuLnR.js";import{C as Ye}from"./clipboard-list-C51spdVg.js";import{m as We}from"./proxy-BKNTM3tf.js";import{S as Ze}from"./star-C-keNCTw.js";import{E as Xe}from"./eye-D1BkTDwg.js";import"./index-BRR_QA-l.js";import"./index-DsrKRt14.js";import"./index-DOzlJ45Y.js";import"./index-C0ZNntAv.js";import"./index-sWFH3d_M.js";import"./Combination-DK-gSie6.js";import"./index-C35Ckziv.js";import"./chevron-down-BPlSfXS4.js";import"./check-B1zY7uXK.js";import"./chevron-up-B8VCb_df.js";import"./chevron-right-Bh44L5jc.js";import"./house-dUPObbYn.js";import"./book-open-BQJiPDff.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./index-B1zfdoK7.js";import"./PolarChart-CUzkXeS7.js";const Qe=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],et=Q("chart-no-axes-column-increasing",Qe);const tt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],at=Q("file-image",tt);const st=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],rt=Q("git-compare",st);class it{async generateStudentReport(a,o=30){const c=new Date;c.setDate(c.getDate()-o);const{data:u}=await b.from("profiles").select("full_name, email").eq("id",a).single(),{data:h}=await b.from("class_members").select("class:classes(id, name, subject)").eq("user_id",a).eq("role","student"),{data:p}=await b.from("submissions").select(`
        grade,
        submitted_at,
        activity:activities(title, max_score, type)
      `).eq("student_id",a).gte("submitted_at",c.toISOString()).not("grade","is",null),x=p?.map(t=>t.grade)||[],d=x.length>0?x.reduce((t,g)=>t+g,0)/x.length:0,r=x.length>0?Math.max(...x):0,s=x.length>0?Math.min(...x):0,m=p?.map(t=>({name:t.activity.title.substring(0,20),value:t.grade}))||[];return{title:`RelatÃ³rio de Desempenho - ${u?.full_name||"Aluno"}`,templateName:"Desempenho Individual (Aluno)",generatedAt:new Date().toISOString(),studentId:a,summary:{totalActivities:p?.length||0,avgGrade:d.toFixed(1),maxGrade:r.toFixed(1),minGrade:s.toFixed(1),totalClasses:h?.length||0},charts:[{title:"Notas por Atividade",type:"bar",data:m},{title:"EvoluÃ§Ã£o do Desempenho",type:"line",data:m}],tables:[{title:"Turmas Inscritas",headers:["Nome","MatÃ©ria"],rows:h?.map(t=>[t.class.name,t.class.subject||"-"])||[]}],details:`RelatÃ³rio gerado para o perÃ­odo de ${o} dias. Total de ${p?.length||0} atividades avaliadas.`}}async generateClassReport(a,o=30){const{data:c}=await b.from("classes").select("name, subject, created_by").eq("id",a).single(),{data:u}=await b.from("class_members").select("user_id, profiles:user_id(full_name)").eq("class_id",a).eq("role","student"),{data:h}=await b.from("activity_class_assignments").select("activity_id, activity:activities(id, title)").eq("class_id",a),p=h?.map(t=>t.activity_id)||[],{data:x}=await b.from("submissions").select("grade, student_id, activity_id").in("activity_id",p).not("grade","is",null),d=x?.map(t=>t.grade)||[],r=d.length>0?d.reduce((t,g)=>t+g,0)/d.length:0,s={"Excelente (90-100)":0,"Bom (70-89)":0,"Regular (50-69)":0,"Insuficiente (0-49)":0};d.forEach(t=>{t>=90?s["Excelente (90-100)"]++:t>=70?s["Bom (70-89)"]++:t>=50?s["Regular (50-69)"]++:s["Insuficiente (0-49)"]++});const m=Object.entries(s).map(([t,g])=>({name:t,value:g}));return{title:`RelatÃ³rio de Turma - ${c?.name||"Turma"}`,templateName:"RelatÃ³rio de Turma",generatedAt:new Date().toISOString(),classId:a,summary:{totalStudents:u?.length||0,totalActivities:h?.length||0,avgGrade:r.toFixed(1),submissionsCount:x?.length||0},charts:[{title:"DistribuiÃ§Ã£o de Notas",type:"pie",data:m}],tables:[{title:"Lista de Alunos",headers:["Nome","SubmissÃµes"],rows:u?.map(t=>{const g=x?.filter(n=>n.student_id===t.user_id).length||0;return[t.profiles.full_name,g]})||[]}],details:`Turma: ${c?.name}
MatÃ©ria: ${c?.subject||"NÃ£o especificada"}
PerÃ­odo: Ãºltimos ${o} dias`}}async generateComparativeReport(a){const{data:o}=await b.from("classes").select("id, name, subject").eq("created_by",a).eq("is_active",!0);o?.map(u=>u.id);const c=await Promise.all(o?.map(async u=>{const{data:h}=await b.from("activity_class_assignments").select("activity_id").eq("class_id",u.id),p=h?.map(s=>s.activity_id)||[],{data:x}=await b.from("submissions").select("grade").in("activity_id",p).not("grade","is",null),d=x?.map(s=>s.grade)||[],r=d.length>0?d.reduce((s,m)=>s+m,0)/d.length:0;return{name:u.name,value:r}})||[]);return{title:"RelatÃ³rio Comparativo de Turmas",templateName:"Comparativo de Desempenho",generatedAt:new Date().toISOString(),teacherId:a,summary:{totalClasses:o?.length||0,avgGrade:(c.reduce((u,h)=>u+h.value,0)/(c.length||1)).toFixed(1)},charts:[{title:"MÃ©dia por Turma",type:"bar",data:c}],tables:[{title:"Detalhamento por Turma",headers:["Turma","MatÃ©ria","MÃ©dia"],rows:o?.map((u,h)=>[u.name,u.subject||"-",c[h]?.value.toFixed(1)||"0"])||[]}]}}async generateTeacherReport(a){const{data:o}=await b.from("classes").select("id").eq("created_by",a).eq("is_active",!0),{count:c}=await b.from("class_members").select("id",{count:"exact",head:!0}).in("class_id",o?.map(d=>d.id)||[]).eq("role","student"),{data:u}=await b.from("activities").select("id").eq("created_by",a),{data:h}=await b.from("submissions").select("grade").in("activity_id",u?.map(d=>d.id)||[]).not("grade","is",null),p=h?.map(d=>d.grade)||[],x=p.length>0?p.reduce((d,r)=>d+r,0)/p.length:0;return{title:"RelatÃ³rio de Desempenho do Professor",templateName:"Desempenho (Professor)",generatedAt:new Date().toISOString(),teacherId:a,summary:{totalClasses:o?.length||0,totalStudents:c||0,totalActivities:u?.length||0,avgGrade:x.toFixed(1)},details:"RelatÃ³rio consolidado de todas as turmas e atividades criadas."}}async generateBulletinReport(a,o={}){const{period:c=30,classId:u,studentId:h}=o,p=new Date;return p.setDate(p.getDate()-c),h?await this.generateStudentBulletin(h,c):u?await this.generateClassBulletin(u,c):await this.generateTeacherBulletin(a,c)}async generateStudentBulletin(a,o=30){const c=new Date;c.setDate(c.getDate()-o);const{data:u}=await b.from("profiles").select("full_name, email").eq("id",a).single(),{data:h}=await b.from("class_members").select(`
        class:classes(id, name, subject, created_by),
        joined_at
      `).eq("user_id",a).eq("role","student"),{data:p}=await b.from("submissions").select(`
        grade,
        submitted_at,
        graded_at,
        status,
        activity:activities(
          id,
          title,
          type,
          max_score,
          due_date,
          activity_class_assignments!inner(class_id)
        )
      `).eq("student_id",a).gte("submitted_at",c.toISOString()).eq("status","graded");h?.map(s=>s.class.id);const x=[];for(const s of h||[]){const m=p?.filter(f=>f.activity?.activity_class_assignments?.[0]?.class_id===s.class.id)||[],t=m.map(f=>f.grade).filter(f=>f!==null),g=t.length>0?t.reduce((f,D)=>f+D,0)/t.length:0,n=m.length,w=m.filter(f=>f.submitted_at&&f.activity?.due_date&&new Date(f.submitted_at)<=new Date(f.activity.due_date)).length,S=n>0?w/n*100:0;x.push({className:s.class.name,subject:s.class.subject||"-",activities:n,avgGrade:g.toFixed(1),attendanceRate:S.toFixed(1),maxGrade:t.length>0?Math.max(...t).toFixed(1):"-",minGrade:t.length>0?Math.min(...t).toFixed(1):"-",details:m.map(f=>({activityName:f.activity.title,grade:f.grade,maxGrade:f.activity.max_score||100,date:new Date(f.graded_at).toLocaleDateString("pt-BR"),status:f.submitted_at<=f.activity.due_date?"No prazo":"Atrasado"}))})}const d=p?.map(s=>s.grade).filter(s=>s!==null)||[],r=d.length>0?d.reduce((s,m)=>s+m,0)/d.length:0;return{title:`Boletim Escolar - ${u?.full_name||"Aluno"}`,templateName:"Boletim Individual",generatedAt:new Date().toISOString(),studentId:a,period:o,summary:{studentName:u?.full_name||"-",email:u?.email||"-",period:`${o} dias`,totalClasses:h?.length||0,totalActivities:p?.length||0,generalAvg:r.toFixed(1)},tables:[{title:"Resumo por Turma",headers:["Turma","MatÃ©ria","Atividades","MÃ©dia","FrequÃªncia","Maior Nota","Menor Nota"],rows:x.map(s=>[s.className,s.subject,s.activities,s.avgGrade,`${s.attendanceRate}%`,s.maxGrade,s.minGrade])}],details:x,observations:`Boletim gerado automaticamente para o perÃ­odo de ${o} dias. Total de ${p?.length||0} atividades avaliadas. MÃ©dia geral: ${r.toFixed(1)}.`}}async generateClassBulletin(a,o=30){const{data:c}=await b.from("classes").select("name, subject, created_by").eq("id",a).single(),{data:u}=await b.from("class_members").select(`
        user_id,
        profile:profiles!class_members_user_id_fkey(full_name, email)
      `).eq("class_id",a).eq("role","student"),{data:h}=await b.from("activity_class_assignments").select(`
        activity_id,
        activity:activities(id, title, type, max_score, due_date)
      `).eq("class_id",a),p=h?.map(n=>n.activity_id)||[],{data:x}=await b.from("submissions").select(`
        grade,
        student_id,
        submitted_at,
        activity_id,
        activity:activities(title, max_score)
      `).in("activity_id",p).eq("status","graded"),d=[];for(const n of u||[]){const w=x?.filter(k=>k.student_id===n.user_id)||[],S=w.map(k=>k.grade).filter(k=>k!==null),f=S.length>0?S.reduce((k,M)=>k+M,0)/S.length:0,D=w.filter(k=>k.submitted_at&&k.activity?.due_date&&new Date(k.submitted_at)<=new Date(k.activity.due_date)).length,_=w.length>0?D/w.length*100:0;let q="Aprovado";f<6?q="Reprovado":f<7&&(q="RecuperaÃ§Ã£o"),d.push({studentName:n.profile?.full_name||"-",email:n.profile?.email||"-",activities:w.length,avgGrade:f.toFixed(1),attendanceRate:_.toFixed(1),status:q,details:w.map(k=>({activityName:k.activity.title,grade:k.grade,maxGrade:k.activity.max_score}))})}const r=x?.map(n=>n.grade).filter(n=>n!==null)||[],s=r.length>0?r.reduce((n,w)=>n+w,0)/r.length:0,m=d.filter(n=>n.status==="Aprovado").length,t=d.filter(n=>n.status==="RecuperaÃ§Ã£o").length,g=d.filter(n=>n.status==="Reprovado").length;return{title:`Boletim da Turma - ${c?.name||"Turma"}`,templateName:"Boletim da Turma",generatedAt:new Date().toISOString(),classId:a,period:o,summary:{className:c?.name||"-",subject:c?.subject||"-",period:`${o} dias`,totalStudents:u?.length||0,totalActivities:h?.length||0,classAvg:s.toFixed(1),approved:m,recovery:t,failed:g},tables:[{title:"Boletim dos Alunos",headers:["Aluno","Email","Atividades","MÃ©dia","FrequÃªncia","Status"],rows:d.map(n=>[n.studentName,n.email,n.activities,n.avgGrade,`${n.attendanceRate}%`,n.status])}],details:d,observations:`Boletim gerado para a turma ${c?.name}. Total de ${u?.length||0} alunos. MÃ©dia da turma: ${s.toFixed(1)}. Aprovados: ${m}, RecuperaÃ§Ã£o: ${t}, Reprovados: ${g}.`}}async generateTeacherBulletin(a,o=30){const{data:c}=await b.from("classes").select("id, name, subject").eq("created_by",a).eq("is_active",!0),u=c?.map(t=>t.id)||[],{data:h}=await b.from("class_members").select(`
        user_id,
        class_id,
        profile:profiles!class_members_user_id_fkey(full_name, email)
      `).in("class_id",u).eq("role","student"),{data:p}=await b.from("activity_class_assignments").select("activity_id, class_id").in("class_id",u),x=p?.map(t=>t.activity_id)||[],{data:d}=await b.from("submissions").select(`
        grade,
        student_id,
        activity_id,
        activity:activities(title, max_score, due_date),
        activity_class_assignments!inner(class_id)
      `).in("activity_id",x).eq("status","graded"),r=[];for(const t of c||[]){const g=h?.filter(_=>_.class_id===t.id)||[],n=d?.filter(_=>_.activity_class_assignments?.[0]?.class_id===t.id)||[],w=n.map(_=>_.grade).filter(_=>_!==null),S=w.length>0?w.reduce((_,q)=>_+q,0)/w.length:0,f=n.filter(_=>_.submitted_at&&_.activity?.due_date&&new Date(_.submitted_at)<=new Date(_.activity.due_date)).length,D=n.length>0?f/n.length*100:0;r.push({className:t.name,subject:t.subject||"-",students:g.length,activities:p?.filter(_=>_.class_id===t.id).length||0,submissions:n.length,avgGrade:S.toFixed(1),attendanceRate:D.toFixed(1)})}const s=d?.map(t=>t.grade).filter(t=>t!==null)||[],m=s.length>0?s.reduce((t,g)=>t+g,0)/s.length:0;return{title:"Boletim Geral - Todas as Turmas",templateName:"Boletim Geral",generatedAt:new Date().toISOString(),teacherId:a,period:o,summary:{period:`${o} dias`,totalClasses:c?.length||0,totalStudents:h?.length||0,totalActivities:p?.length||0,totalSubmissions:d?.length||0,generalAvg:m.toFixed(1)},tables:[{title:"Resumo por Turma",headers:["Turma","MatÃ©ria","Alunos","Atividades","SubmissÃµes","MÃ©dia","FrequÃªncia"],rows:r.map(t=>[t.className,t.subject,t.students,t.activities,t.submissions,t.avgGrade,`${t.attendanceRate}%`])}],details:r,observations:`Boletim geral gerado para ${c?.length||0} turmas. Total de ${h?.length||0} alunos e ${d?.length||0} submissÃµes. MÃ©dia geral: ${m.toFixed(1)}.`}}async generateReport(a,o,c={}){switch(a){case"individual-student":return await this.generateStudentReport(o,c.period);case"class-report":return await this.generateClassReport(o,c.period);case"comparative":return await this.generateComparativeReport(o);case"teacher-performance":return await this.generateTeacherReport(o);case"activity-report":return{title:"RelatÃ³rio de Atividade",templateName:"RelatÃ³rio de Atividade",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};case"bulletin":return await this.generateBulletinReport(o,c);default:throw new Error("Template de relatÃ³rio nÃ£o encontrado")}}}const ot=new it,lt=$e,nt=Ee,ge=$.forwardRef(({className:l,sideOffset:a=4,...o},c)=>e.jsx(pe,{ref:c,sideOffset:a,className:ke("z-50 overflow-hidden rounded-md border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-1.5 text-sm font-medium text-gray-900 dark:text-white shadow-lg shadow-black/10 animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l),...o}));ge.displayName=pe.displayName;const ct=(l,a,o,c={})=>{const{title:u="TamanduAI - RelatÃ³rio",subtitle:h=null,orientation:p="portrait",pageSize:x="a4"}=c,d=new De({orientation:p,unit:"mm",format:x});d.setFontSize(18),d.setFont("helvetica","bold"),d.text(u,14,20),d.setFontSize(11),d.setFont("helvetica","normal"),d.text(`Gerado em: ${new Date().toLocaleString("pt-BR")}`,14,28),h&&d.text(h,14,34),d.autoTable({head:[o.map(r=>r.header)],body:l.map(r=>o.map(s=>r[s.key]||"-")),startY:h?40:35,theme:"grid",headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontStyle:"bold",fontSize:10},styles:{font:"helvetica",fontSize:9,cellPadding:3},alternateRowStyles:{fillColor:[245,247,250]},margin:{top:10,left:14,right:14},didDrawPage:r=>{const s=d.internal.getNumberOfPages();d.setFontSize(9),d.setTextColor(150),d.text(`PÃ¡gina ${r.pageNumber} de ${s}`,d.internal.pageSize.getWidth()/2,d.internal.pageSize.getHeight()-10,{align:"center"})}}),d.save(`${a}.pdf`)},de=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],L=({text:l,maxLength:a=30})=>!l||l.length<=a?e.jsx("span",{children:l}):e.jsxs(lt,{children:[e.jsx(nt,{children:e.jsxs("span",{className:"cursor-help",children:[l.slice(0,a),"â€¦"]})}),e.jsx(ge,{children:e.jsx("p",{className:"max-w-xs",children:l})})]}),dt=({report:l,onClose:a})=>{const{toast:o}=he(),[c,u]=$.useState(!1);if(!l)return null;const h=(r,s)=>{const m=(t,g=16)=>t?.length>g?t.slice(0,g)+"â€¦":t;switch(r){case"bar":return e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Me,{data:s,margin:{top:8,right:16,bottom:32,left:8},children:[e.jsx(oe,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",tickFormatter:t=>m(t),interval:"preserveEnd"}),e.jsx(ne,{}),e.jsx(W,{}),e.jsx(Z,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),e.jsx(ze,{dataKey:"value",fill:"#3B82F6"})]})});case"line":return e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Ve,{data:s,margin:{top:8,right:16,bottom:32,left:8},children:[e.jsx(oe,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",tickFormatter:t=>m(t),interval:"preserveEnd"}),e.jsx(ne,{}),e.jsx(W,{}),e.jsx(Z,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),e.jsx(Ie,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2})]})});case"pie":return e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Be,{children:[e.jsx(Le,{data:s,cx:"50%",cy:"50%",labelLine:!1,label:t=>`${m(t.name)}: ${t.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:s.map((t,g)=>e.jsx(Oe,{fill:de[g%de.length]},`cell-${g}`))}),e.jsx(W,{}),e.jsx(Z,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}})]})});default:return null}},p=()=>{try{let r="";r+=`${l.title||l.templateName}
`,r+=`Gerado em: ${new Date(l.generatedAt).toLocaleString("pt-BR")}

`,l.summary&&(r+=`RESUMO
`,Object.entries(l.summary).forEach(([n,w])=>{r+=`"${n}","${w}"
`}),r+=`
`),l.tables&&l.tables.length>0&&l.tables.forEach((n,w)=>{r+=`${n.title}
`,r+=n.headers.join(",")+`
`,n.rows.forEach(S=>{r+=S.map(f=>{const D=typeof f=="object"?JSON.stringify(f):String(f??"");return/[",\n]/.test(D)?'"'+D.replace(/"/g,'""')+'"':D}).join(","),r+=`
`}),r+=`
`}),l.details&&Array.isArray(l.details)&&(r+=`DETALHES
`,l.details.forEach((n,w)=>{r+=`
${n.className} - ${n.subject}
`,r+=`Atividades: ${n.activities}, MÃ©dia: ${n.avgGrade}, FrequÃªncia: ${n.attendanceRate}%
`,n.details&&n.details.length>0&&(r+=`Atividade,Nota,Valor,Data,Status
`,n.details.forEach(S=>{r+=`"${S.activityName}","${S.grade}","${S.maxGrade}","${S.date}","${S.status}"
`}))}));const s=new Blob([r],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(s),t=document.createElement("a"),g=(l.title||l.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");t.href=m,t.download=`${g}-${Date.now()}.csv`,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(m),o({title:"Exportado (CSV)",description:"Arquivo CSV baixado com sucesso."})}catch(r){O(o,"NÃ£o foi possÃ­vel exportar o relatÃ³rio em CSV.",r,{logPrefix:"[ReportViewer] Erro ao exportar relatÃ³rio em CSV",title:"Falha na exportaÃ§Ã£o"})}},x=()=>{try{const r=(l.title||l.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-"),s=l.data||[],m=l.columns||Object.keys(s[0]||{}).map(t=>({header:t,key:t}));ct(s,r,m,{title:l.title||l.templateName||"RelatÃ³rio",subtitle:`Gerado em: ${new Date().toLocaleDateString("pt-BR")}`,orientation:"landscape"}),o({title:"Exportado (PDF)",description:"Arquivo PDF baixado com sucesso."})}catch(r){O(o,"NÃ£o foi possÃ­vel exportar o relatÃ³rio em PDF.",r,{logPrefix:"[ReportViewer] Erro ao exportar relatÃ³rio em PDF",title:"Falha na exportaÃ§Ã£o"})}},d=()=>{u(!0),setTimeout(()=>{window.print(),setTimeout(()=>u(!1),100)},100)};return e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:!0,global:!0,children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .print-content, .print-content * {
            visibility: visible;
          }
          .print-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white !important;
            color: black !important;
          }
          .print-content .dark\\:bg-slate-900 {
            background: white !important;
          }
          .print-content .dark\\:text-white {
            color: black !important;
          }
          .print-content .dark\\:text-slate-200 {
            color: black !important;
          }
          .print-content .dark\\:border-slate-700 {
            border-color: #e2e8f0 !important;
          }
          .no-print {
            display: none !important;
          }
          .print-break {
            page-break-after: always;
          }
          .avoid-break {
            page-break-inside: avoid;
          }
        }
      `}),e.jsx("div",{className:`fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 overflow-auto no-print ${c?"opacity-0 pointer-events-none":""}`,children:e.jsxs(P,{className:"w-full max-w-6xl max-h-[90vh] overflow-auto bg-white dark:bg-slate-900 print-content",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between z-10 no-print",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white break-words pr-4",children:e.jsx(L,{text:l.title||l.templateName,maxLength:50})}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Gerado em ",new Date(l.generatedAt).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:p,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Exportar PDF"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:async()=>{try{const r=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),s=URL.createObjectURL(r),m=l.title||l.templateName||"RelatÃ³rio";navigator.share?await navigator.share({title:m,text:m,url:s}):(await navigator.clipboard.writeText(s),o({title:"Link copiado",description:"Link do relatÃ³rio copiado para a Ã¡rea de transferÃªncia."}))}catch(r){O(o,"NÃ£o foi possÃ­vel compartilhar o relatÃ³rio.",r,{logPrefix:"[ReportViewer] Erro ao compartilhar relatÃ³rio",title:"Falha ao compartilhar"})}},children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(xe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[l.summary&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 avoid-break",children:Object.entries(l.summary).map(([r,s])=>e.jsxs(P,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:r.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-white mt-1 break-words",children:typeof s=="string"&&s.length>20?e.jsx(L,{text:s,maxLength:20}):typeof s=="number"?s.toFixed(1):s})]},r))}),l.charts&&l.charts.map((r,s)=>e.jsxs(P,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:r.title}),h(r.type,r.data)]},s)),l.tables&&l.tables.map((r,s)=>e.jsxs(P,{className:"p-6 avoid-break",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:r.title}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:r.headers.map((m,t)=>e.jsx("th",{className:"text-left p-2 font-semibold",children:m},t))})}),e.jsx("tbody",{children:r.rows.map((m,t)=>e.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:m.map((g,n)=>e.jsx("td",{className:"p-2 max-w-xs",children:typeof g=="string"&&g.length>30?e.jsx(L,{text:g,maxLength:30}):g},n))},t))})]})})]},s)),l.details&&Array.isArray(l.details)&&l.templateName==="Boletim Individual"&&e.jsx("div",{className:"space-y-6 avoid-break",children:l.details.map((r,s)=>e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200",children:e.jsx(L,{text:r.className,maxLength:40})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:r.subject})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Atividades"}),e.jsx("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-300",children:r.activities})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"MÃ©dia"}),e.jsx("p",{className:"text-lg font-bold text-green-800 dark:text-green-300",children:r.avgGrade})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:"FrequÃªncia"}),e.jsxs("p",{className:"text-lg font-bold text-purple-800 dark:text-purple-300",children:[r.attendanceRate,"%"]})]}),e.jsxs("div",{className:"text-center p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Maior Nota"}),e.jsx("p",{className:"text-lg font-bold text-amber-800 dark:text-amber-300",children:r.maxGrade})]})]}),r.details&&r.details.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2 text-slate-800 dark:text-slate-200",children:"Atividades Avaliadas:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left p-2",children:"Atividade"}),e.jsx("th",{className:"text-left p-2",children:"Nota"}),e.jsx("th",{className:"text-left p-2",children:"Valor"}),e.jsx("th",{className:"text-left p-2",children:"Data"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:r.details.map((m,t)=>e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:[e.jsx("td",{className:"p-2 max-w-xs",children:e.jsx(L,{text:m.activityName,maxLength:30})}),e.jsx("td",{className:"p-2 font-semibold",children:m.grade}),e.jsx("td",{className:"p-2 text-slate-600 dark:text-slate-400",children:m.maxGrade}),e.jsx("td",{className:"p-2",children:m.date}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${m.status==="No prazo"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300"}`,children:m.status})})]},t))})]})})]})]},s))}),l.details&&Array.isArray(l.details)&&l.templateName!=="Boletim Individual"&&e.jsxs(P,{className:"p-6 avoid-break",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detalhes"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:Object.keys(l.details[0]||{}).map((r,s)=>e.jsx("th",{className:"text-left p-2 font-semibold capitalize",children:r.replace(/([A-Z])/g," $1").trim()},s))})}),e.jsx("tbody",{children:l.details.map((r,s)=>e.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:Object.values(r).map((m,t)=>e.jsx("td",{className:"p-2 max-w-xs",children:typeof m=="string"&&m.length>30?e.jsx(L,{text:m,maxLength:30}):m},t))},s))})]})})]}),l.observations&&e.jsxs(P,{className:"p-6 avoid-break",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:l.observations})]})]})]})})]})};class mt{constructor(){this.enabled=!1,this.url="https://comic-mudfish-15106.upstash.io",this.token="ATsCAAIncDIxMzViNjFkMDQ0Zjk0NGU3YTljYjlhNTM2YTRhZDM1NXAyMTUxMDY",this.url&&this.token?(this.enabled=!0,N.info("[Cache] âœ… Upstash Redis configurado")):(N.warn("[Cache] âš ï¸  Upstash Redis nÃ£o configurado - cache desabilitado"),N.warn("[Cache] Configure VITE_UPSTASH_REDIS_REST_URL e VITE_UPSTASH_REDIS_REST_TOKEN"))}async get(a){if(!this.enabled)return null;try{const o=await fetch(`${this.url}/get/${encodeURIComponent(a)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const c=await o.json();if(c.result===null)return N.debug(`[Cache] âŒ Miss: ${a}`),null;N.debug(`[Cache] âœ… Hit: ${a}`);try{return JSON.parse(c.result)}catch{return c.result}}catch(o){return N.error(`[Cache] Erro ao buscar ${a}:`,o),null}}async set(a,o,c=300){if(!this.enabled)return!1;try{const u=typeof o=="string"?o:JSON.stringify(o),h=await fetch(`${this.url}/set/${encodeURIComponent(a)}/${encodeURIComponent(u)}?EX=${c}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return N.debug(`[Cache] ðŸ’¾ Saved: ${a} (TTL: ${c}s)`),!0}catch(u){return N.error(`[Cache] Erro ao salvar ${a}:`,u),!1}}async del(a){if(!this.enabled)return!1;try{const o=await fetch(`${this.url}/del/${encodeURIComponent(a)}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return N.debug(`[Cache] ðŸ—‘ï¸  Deleted: ${a}`),!0}catch(o){return N.error(`[Cache] Erro ao deletar ${a}:`,o),!1}}async invalidatePattern(a){if(!this.enabled)return!1;try{const o=await fetch(`${this.url}/keys/${encodeURIComponent(a)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const u=(await o.json()).result||[];if(u.length===0)return N.debug(`[Cache] ðŸ” No keys found for pattern: ${a}`),!0;const h=u.map(p=>this.del(p));return await Promise.all(h),N.debug(`[Cache] ðŸ§¹ Invalidated ${u.length} keys matching: ${a}`),!0}catch(o){return N.error(`[Cache] Erro ao invalidar padrÃ£o ${a}:`,o),!1}}async remember(a,o,c=300){const u=await this.get(a);if(u!==null)return u;const h=await o();return await this.set(a,h,c),h}async flush(){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/flushdb`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return N.warn("[Cache] ðŸš¨ Cache completamente limpo (FLUSH)"),!0}catch(a){return N.error("[Cache] Erro ao limpar cache:",a),!1}}getStatus(){return{enabled:this.enabled,hasCredentials:!!(this.url&&this.token),url:this.url?this.url.replace(/https?:\/\//,"").split(".")[0]+"...":"nÃ£o configurado"}}}const me=new mt,ue=[{id:"individual-student",name:"RelatÃ³rio Individual de Aluno",description:"RelatÃ³rio completo de um aluno especÃ­fico",icon:Je,color:"from-blue-500 to-cyan-500",includes:["Dados pessoais","HistÃ³rico de notas","FrequÃªncia","Feedbacks recebidos","GrÃ¡ficos de evoluÃ§Ã£o","AnÃ¡lise de desempenho"],usage:"ReuniÃ£o com pais, coordenaÃ§Ã£o",popular:!0},{id:"class-report",name:"RelatÃ³rio de Turma",description:"AnÃ¡lise completa de uma turma",icon:Ke,color:"from-purple-500 to-pink-500",includes:["EstatÃ­sticas gerais","DistribuiÃ§Ã£o de notas","Taxa de aprovaÃ§Ã£o/reprovaÃ§Ã£o","MÃ©dia da turma","Alunos em destaque","Ãreas de atenÃ§Ã£o"],usage:"Fechamento de semestre, relatÃ³rios institucionais",popular:!0},{id:"comparative",name:"RelatÃ³rio Comparativo",description:"ComparaÃ§Ã£o entre mÃºltiplas turmas",icon:rt,color:"from-orange-500 to-red-500",includes:["Tabela comparativa","GrÃ¡ficos lado a lado","AnÃ¡lise de diferenÃ§as","Melhores prÃ¡ticas identificadas"],usage:"AnÃ¡lise pedagÃ³gica, ajustes metodolÃ³gicos"},{id:"activity-report",name:"RelatÃ³rio de Atividade",description:"AnÃ¡lise de uma atividade especÃ­fica",icon:Ye,color:"from-green-500 to-teal-500",includes:["EstatÃ­sticas de submissÃ£o","DistribuiÃ§Ã£o de notas","QuestÃµes mais erradas","Tempo mÃ©dio de resoluÃ§Ã£o","Lista de notas por aluno"],usage:"ValidaÃ§Ã£o de atividade, ajustes"},{id:"bulletin",name:"Boletim (PerÃ­odo)",description:"Boletim formal por perÃ­odo",icon:J,color:"from-indigo-500 to-purple-500",includes:["Notas por disciplina","MÃ©dias parciais e finais","FrequÃªncia","ObservaÃ§Ãµes do professor","Assinatura"],usage:"Entrega oficial para instituiÃ§Ã£o/pais",popular:!0},{id:"teacher-performance",name:"RelatÃ³rio de Desempenho (Professor)",description:"Auto-avaliaÃ§Ã£o do professor",icon:et,color:"from-yellow-500 to-orange-500",includes:["Atividades postadas","CorreÃ§Ãµes realizadas","Tempo mÃ©dio de feedback","SatisfaÃ§Ã£o dos alunos","EvoluÃ§Ã£o das turmas"],usage:"AvaliaÃ§Ã£o institucional, portfÃ³lio"}],pa=()=>{const{user:l}=Re(),{toast:a}=he(),[o,c]=$.useState(!1),[u,h]=$.useState("templates"),[p,x]=$.useState([]),[d,r]=$.useState(!1),[s,m]=$.useState(null),[t,g]=$.useState(null),[n,w]=$.useState(null),[S,f]=$.useState(null),[D,_]=$.useState("30"),[q,k]=$.useState([]),[M,ee]=$.useState([]),[A,te]=$.useState(""),[ut,K]=$.useState(!1);$.useEffect(()=>{fe(),be()},[l]);const fe=async()=>{if(l)try{const{data:i,error:v}=await b.from("report_history").select(`
          id,
          template_id,
          template_name,
          filter_type,
          student_id,
          class_id,
          activity_id,
          period,
          created_at,
          report_data
        `).eq("teacher_id",l.id).order("created_at",{ascending:!1}).limit(20);if(v)throw v;x(i||[])}catch(i){N.error("Erro ao carregar histÃ³rico:",i),x([])}},be=async()=>{if(l)try{K(!0);const i=`teacher:reports:data:${l.id}:${D}`,v=await me.get(i);if(v){ee(v.classes||[]),k(v.students||[]),K(!1);return}const{data:R,error:T}=await b.from("classes").select("id, name, subject").eq("created_by",l.id).eq("is_active",!0).order("name",{ascending:!0});if(T)throw T;ee(R||[]);const{data:j,error:y}=await b.from("class_members").select(`
          user_id,
          profile:profiles!class_members_user_id_fkey(id, full_name, email),
          class:classes!class_members_class_id_fkey(id, name)
        `).in("class_id",R?.map(F=>F.id)||[]).eq("role","student");if(y)throw y;const C=[],B=new Set;j?.forEach(F=>{F.profile&&!B.has(F.profile.id)&&(B.add(F.profile.id),C.push({id:F.profile.id,name:F.profile.full_name,email:F.profile.email,className:F.class?.name}))}),k(C),await me.set(i,{classes:R||[],students:C},300)}catch(i){O(a,"NÃ£o foi possÃ­vel carregar os dados para relatÃ³rios.",i,{logPrefix:"[TeacherReportsPage] Erro ao carregar dados"})}finally{K(!1)}},ve=i=>i==="comparative"?!1:!!(A==="student"&&["class-report"].includes(i)||A==="class"&&["individual-student"].includes(i)||S&&i!=="activity-report"),je=async i=>{if(i!=="comparative"){if(!A){a({title:"Selecione o escopo do relatÃ³rio",description:"Escolha se deseja gerar para um aluno, turma ou todos os alunos.",variant:"destructive"});return}if(A==="student"&&!t){a({title:"Selecione um aluno",description:"Escolha qual aluno vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}if(A==="class"&&!n){a({title:"Selecione uma turma",description:"Escolha qual turma vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}}r(!0),m(null);try{let v=l?.id;const R=ue.find(j=>j.id===i);if(a({title:`ðŸ“Š Gerando ${R?.name||"RelatÃ³rio"}`,description:"Processando dados... Aguarde."}),A==="student"&&t)v=t;else if(A==="class"&&n)v=n;else if(i==="class-report")if(n)v=n;else{const{data:j}=await b.from("classes").select("id, is_active").eq("created_by",l.id).eq("is_active",!0).order("name",{ascending:!0});if(!j||j.length===0)throw new Error("Nenhuma turma ativa encontrada para gerar o relatÃ³rio.");v=j[0].id}const T=await ot.generateReport(i,v,{period:parseInt(D),includeArchived:!1,filterType:A,studentId:t,classId:n,activityId:S});m(T),a({title:"âœ… RelatÃ³rio Gerado",description:`${T.templateName} gerado com sucesso!`});try{const{error:j}=await b.from("report_history").insert({teacher_id:l.id,template_id:i,template_name:R?.name||"RelatÃ³rio",filter_type:A||null,student_id:t||null,class_id:n||null,activity_id:S||null,period:parseInt(D),report_data:T});j&&N.error("Erro ao salvar histÃ³rico:",j)}catch(j){N.error("Erro ao salvar histÃ³rico:",j)}x(j=>[{id:Date.now(),templateId:i,templateName:R?.name,generatedAt:new Date().toISOString(),cached:!1,filterType:A,studentId:t,classId:n},...j.slice(0,9)])}catch(v){O(a,"NÃ£o foi possÃ­vel gerar o relatÃ³rio.",v,{logPrefix:"[TeacherReportsPage] Erro ao gerar relatÃ³rio"})}finally{r(!1)}},ye=()=>{h("history")},Ne=()=>{a({title:"Em desenvolvimento",description:"Gerenciamento de templates serÃ¡ implementado em breve"})},we=i=>{if(!i)return null;if(Array.isArray(i))return i;if(Array.isArray(i?.rows))return i.rows;if(Array.isArray(i?.data))return i.data;if(Array.isArray(i?.items))return i.items;const v=Object.values(i).find(R=>Array.isArray(R));return Array.isArray(v)?v:[i]},_e=i=>{if(!i||i.length===0)return"";const v=Array.from(i.reduce((y,C)=>(Object.keys(C||{}).forEach(B=>y.add(B)),y),new Set)),R=y=>{if(y==null)return"";const C=typeof y=="object"?JSON.stringify(y):String(y);return/[",\n]/.test(C)?'"'+C.replace(/"/g,'""')+'"':C},T=v.map(R).join(","),j=i.map(y=>v.map(C=>R(y?.[C])).join(","));return[T,...j].join(`
`)},ae=(i,v,R)=>{const T=new Blob([i],{type:R}),j=URL.createObjectURL(T),y=document.createElement("a");y.href=j,y.download=v,document.body.appendChild(y),y.click(),y.remove(),URL.revokeObjectURL(j)},Se=()=>{if(!s){a({title:"Nenhum relatÃ³rio para exportar",description:"Gere um relatÃ³rio primeiro.",variant:"destructive"});return}try{const i=we(s).map(T=>{const j={};return Object.entries(T||{}).forEach(([y,C])=>{C&&typeof C=="object"&&!Array.isArray(C)?Object.entries(C).forEach(([B,F])=>{j[`${y}.${B}`]=F}):j[y]=C}),j}),v=_e(i);if(!v)throw new Error("NÃ£o hÃ¡ dados tabulares para exportar");const R=(s?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");ae(v,`${R}-${Date.now()}.csv`,"text/csv;charset=utf-8;"),a({title:"Exportado com sucesso",description:"Arquivo CSV baixado."})}catch(i){N.warn("CSV export fallback to JSON:",i);const v=(s?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");ae(JSON.stringify(s,null,2),`${v}-${Date.now()}.json`,"application/json"),a({title:"Exportado como JSON",description:"NÃ£o foi possÃ­vel gerar CSV. Baixamos o JSON.",variant:"destructive"})}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(Te,{title:"RelatÃ³rios",subtitle:"Gere relatÃ³rios formais e exportÃ¡veis",role:"teacher",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",onClick:ye,children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"HistÃ³rico"]}),e.jsxs(E,{variant:"outline",onClick:Ne,children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Templates"]}),e.jsxs(E,{onClick:()=>a({title:"Selecione um template abaixo"}),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Novo RelatÃ³rio"]})]})}),e.jsx(P,{className:"mt-4 sm:mt-6 p-4 sm:p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-3 sm:gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(He,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold mb-2 text-blue-900 dark:text-blue-100",children:"Selecione o Escopo do RelatÃ³rio"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Escolha para quem deseja gerar o relatÃ³rio antes de selecionar um template"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium mb-2 block",children:"Tipo de RelatÃ³rio"}),e.jsxs(V,{value:A,onValueChange:te,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{placeholder:"Selecione o tipo..."})}),e.jsxs(H,{children:[e.jsx(G,{value:"student",children:"Aluno EspecÃ­fico"}),e.jsx(G,{value:"class",children:"Turma Completa"}),e.jsx(G,{value:"all",children:"Todos os Alunos"})]})]})]}),A==="student"&&e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium mb-2 block",children:"Selecionar Aluno"}),e.jsxs(V,{value:t||"",onValueChange:g,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{placeholder:"Escolha um aluno..."})}),e.jsx(H,{children:q.map(i=>e.jsxs(G,{value:i.id,children:[i.name," ",i.className&&`(${i.className})`]},i.id))})]})]}),A==="class"&&e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium mb-2 block",children:"Selecionar Turma"}),e.jsxs(V,{value:n||"",onValueChange:w,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{placeholder:"Escolha uma turma..."})}),e.jsx(H,{children:M.map(i=>e.jsxs(G,{value:i.id,children:[i.name," ",i.subject&&`- ${i.subject}`]},i.id))})]})]}),e.jsxs("div",{children:[e.jsx(z,{className:"text-sm font-medium mb-2 block",children:"PerÃ­odo"}),e.jsxs(V,{value:D,onValueChange:_,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{})}),e.jsxs(H,{children:[e.jsx(G,{value:"7",children:"Ãšltimos 7 dias"}),e.jsx(G,{value:"30",children:"Ãšltimos 30 dias"}),e.jsx(G,{value:"90",children:"Ãšltimos 90 dias"}),e.jsx(G,{value:"180",children:"Ãšltimos 6 meses"}),e.jsx(G,{value:"365",children:"Ãšltimo ano"})]})]})]})]}),A&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Filtro ativo:"})," ",A==="student"?`Aluno - ${q.find(i=>i.id===t)?.name||"Selecione"}`:A==="class"?`Turma - ${M.find(i=>i.id===n)?.name||"Selecione"}`:"Todos os alunos"]}),e.jsxs(E,{variant:"ghost",size:"sm",onClick:()=>{te(""),g(null),w(null)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]})]})}),e.jsxs(Ce,{value:u,onValueChange:h,className:"mt-6",children:[e.jsxs(Ae,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsx(re,{value:"templates",children:"Templates"}),e.jsx(re,{value:"history",children:"HistÃ³rico"})]}),e.jsxs(ie,{value:"templates",className:"mt-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:ue.map((i,v)=>{const R=i.icon,T=ve(i.id);return e.jsx(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:v*.1},style:{pointerEvents:"auto"},children:e.jsxs(P,{className:`p-6 h-full flex flex-col hover:shadow-lg transition-shadow relative ${T?"opacity-50":""}`,style:{pointerEvents:"auto"},children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${i.color} opacity-5 group-hover:opacity-10 transition-opacity`}),i.popular&&e.jsxs(se,{className:"absolute top-4 right-4 bg-yellow-500 text-white",children:[e.jsx(Ze,{className:"w-3 h-3 mr-1"}),"Popular"]}),e.jsx("div",{className:"mb-4 relative z-10",children:e.jsx("div",{className:`inline-flex p-3 rounded-xl bg-gradient-to-r ${i.color}`,children:e.jsx(R,{className:"w-6 h-6 text-white"})})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:i.name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:i.description}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-2",children:"Inclui:"}),e.jsxs("ul",{className:"space-y-1",children:[i.includes.slice(0,3).map((j,y)=>e.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-center",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mr-2"}),j]},y)),i.includes.length>3&&e.jsxs("li",{className:"text-xs text-blue-600 dark:text-blue-400",children:["+",i.includes.length-3," mais..."]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(se,{variant:"outline",className:"text-xs",children:i.usage})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 relative z-50",children:[e.jsxs(E,{className:`flex-1 bg-gradient-to-r ${i.color} text-white hover:opacity-90`,onClick:()=>{if(T){a({title:"Template incompatÃ­vel",description:"Este template nÃ£o Ã© compatÃ­vel com os filtros selecionados.",variant:"destructive"});return}N.debug("BotÃ£o Gerar clicado:",i.id),je(i.id)},disabled:T,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Gerar"]}),e.jsx(E,{variant:"outline",size:"icon",onClick:()=>{N.debug("BotÃ£o Preview clicado"),a({title:"Preview",description:"VisualizaÃ§Ã£o serÃ¡ implementada"})},children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})},i.id)})}),e.jsxs(P,{className:"mt-8 p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Formatos de ExportaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs(E,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-red-50 hover:border-red-300 dark:hover:bg-red-950/20",onClick:()=>{N.debug("Exportar PDF clicado"),a({title:"Exportar PDF",description:"Funcionalidade em desenvolvimento"})},children:[e.jsx(J,{className:"w-8 h-8 mb-2 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PDF"})]}),e.jsxs(E,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-green-50 hover:border-green-300 dark:hover:bg-green-950/20",onClick:Se,children:[e.jsx(Ge,{className:"w-8 h-8 mb-2 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Excel"})]}),e.jsxs(E,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20",onClick:()=>{N.debug("Exportar Word clicado"),a({title:"Exportar Word",description:"Funcionalidade em desenvolvimento"})},children:[e.jsx(J,{className:"w-8 h-8 mb-2 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Word"})]}),e.jsxs(E,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-purple-50 hover:border-purple-300 dark:hover:bg-purple-950/20",onClick:()=>{N.debug("Exportar PNG clicado"),a({title:"Exportar PNG",description:"Funcionalidade em desenvolvimento"})},children:[e.jsx(at,{className:"w-8 h-8 mb-2 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PNG"})]})]})]})]}),e.jsx(ie,{value:"history",className:"mt-6",children:e.jsx(P,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Nenhum relatÃ³rio gerado ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"RelatÃ³rios que vocÃª gerar aparecerÃ£o aqui para fÃ¡cil acesso"}),e.jsxs(E,{onClick:()=>h("templates"),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Gerar Primeiro RelatÃ³rio"]})]})})})]}),s&&e.jsx(dt,{report:s,onClose:()=>m(null)})]})};export{pa as default};
