import{t as T,u as I,r as c,l as j,s as x,j as e,p as L}from"./main-CulyknMy.js";import{B as h}from"./button-Dfu2yMjN.js";import{I as k}from"./input-BedeDxLw.js";import{L as d}from"./label-hRNGW-_n.js";import{C as u}from"./card-0IW715z3.js";import{D as M}from"./DashboardHeader-BwYDScVc.js";import"./dropdown-menu-YDjYKa0f.js";import{C as B}from"./classService-Bnp1DWgv.js";import{u as G}from"./use-toast-D1WbEInh.js";import{B as $}from"./bot-Cw-zPOc2.js";import{A as y}from"./arrow-left-BbvKd-s5.js";import{S as z}from"./save-CiiFTid_.js";import{A as q}from"./arrow-right-M2mKAq2x.js";import{R as V}from"./rocket-CJd67kAa.js";import"./SidebarPremium-D7ISy0In.js";import"./index-Bqe-gmK6.js";import"./house-DSNk2C5T.js";import"./users-CLb1Ind1.js";import"./book-open-L6K6GApD.js";import"./file-text-76dwq0ip.js";import"./graduation-cap-DGMUxzM9.js";import"./calendar-CAuJuRcm.js";import"./chart-column-Bg7XzELY.js";import"./message-circle-8Z2L2EEy.js";import"./settings-Bqthy2dX.js";import"./index-BZWQ4euU.js";import"./chevron-right-f5dsdMUG.js";import"./x-C2dkvfPv.js";import"./index-CtoMVlCU.js";import"./index-CKE1C3tK.js";import"./index-qba7jVBc.js";import"./index-Bce5oZaH.js";import"./check-Ds-bvwXg.js";const Ae=()=>{const{classId:l}=T(),b=I(),{toast:p}=G(),[w,v]=c.useState(!0),[F,H]=c.useState(!1),[A,f]=c.useState(!1),[n,m]=c.useState(0),[o,N]=c.useState(1),[C,E]=c.useState(null),[g,S]=c.useState([]),[t,r]=c.useState({name:"",avatar:"ü§ñ",personality:"motivational",useEmojis:!0,useExamples:!0,encourage:!0,selectedActivities:[],selectedMaterials:[],canExplain:!0,canGiveExamples:!0,canAnswerDoubt:!0,canGiveHints:!0,canShowAnswers:!1,availability:"24/7",messagesLimit:10,language:"pt-BR",guidingMode:!0});c.useEffect(()=>{_()},[l]);const _=async()=>{try{v(!0);const s=await B.getClassById(l);if(!s){j.error("Turma n√£o encontrada:",l),p({title:"Erro",description:"Turma n√£o encontrada",variant:"destructive"}),b("/dashboard/classes");return}E(s),s&&r(i=>({...i,name:`Assistente de ${s.subject||s.name||"Turma"}`}));const{data:a}=await x.from("activity_class_assignments").select("activity:activities(*)").eq("class_id",l);S(a?.map(i=>i.activity).filter(Boolean)||[])}catch(s){j.error("Erro:",s)}finally{v(!1)}},D=s=>{r(a=>({...a,selectedActivities:a.selectedActivities.includes(s)?a.selectedActivities.filter(i=>i!==s):[...a.selectedActivities,s]}))},R=async()=>{try{f(!0),m(0),m(25);for(const a of t.selectedActivities){const i=g.find(O=>O.id===a);i&&await x.from("rag_training_sources").upsert({class_id:l,source_type:"activity",source_id:a,content:i.description||i.title,metadata:{title:i.title,due_date:i.due_date}})}m(50);const{data:s}=await x.from("classes").select("settings").eq("id",l).single();await x.from("classes").update({settings:{...s?.settings||{},chatbot_enabled:!0,chatbot_paused:!1,chatbot_config:t}}).eq("id",l),m(75),await x.from("chatbot_configurations").upsert({class_id:l,enabled:!0,keywords:[],themes:[],scope_restrictions:[],is_trained:!0,last_training:new Date().toISOString(),guiding_mode:t.guidingMode,can_show_answers:t.canShowAnswers}),m(100),setTimeout(()=>{p({title:"‚úÖ Chatbot ativado!",description:"Seu assistente virtual est√° pronto para ajudar os alunos."}),b(`/dashboard/chatbot/${l}/analytics`)},500)}catch(s){j.error("Erro ao ativar chatbot:",s),p({title:"‚ùå Erro ao ativar chatbot",description:"Tente novamente em alguns instantes.",variant:"destructive"}),f(!1)}},P=["ü§ñ","üéì","üìö","üí°","üß†","‚≠ê","üéØ","üöÄ"];return w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(L,{size:"lg"})}):A?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(u,{className:"p-8 max-w-md w-full bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"w-16 h-16 mx-auto mb-4 text-blue-600 dark:text-blue-400 animate-pulse"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"üîÑ Treinando Assistente IA..."}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-4 mb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 h-4 rounded-full transition-all duration-300",style:{width:`${n}%`}})}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 space-y-1",children:[e.jsxs("div",{className:n>=25?"text-green-600":"",children:[n>=25?"‚úÖ":"üîÑ"," Processando atividades selecionadas"]}),e.jsxs("div",{className:n>=50?"text-green-600":"",children:[n>=50?"‚úÖ":"üîÑ"," Indexando conte√∫dos"]}),e.jsxs("div",{className:n>=75?"text-green-600":"",children:[n>=75?"‚úÖ":"üîÑ"," Gerando base de conhecimento"]}),e.jsxs("div",{className:n>=100?"text-green-600":"",children:[n>=100?"‚úÖ":"‚è≥"," Otimizando respostas"]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-4",children:"Tempo estimado: 2-3 minutos"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"‚ÑπÔ∏è Voc√™ pode sair desta p√°gina. Notificaremos quando estiver pronto!"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(h,{variant:"ghost",onClick:()=>b("/dashboard/chatbot"),className:"mb-4",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(M,{title:`Configurar Chatbot - ${C?.name}`,subtitle:`Passo ${o} de 3`,role:"teacher"}),e.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold ${o>=s?"bg-gradient-to-r from-blue-600 to-cyan-600 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-600"}`,children:s}),s<3&&e.jsx("div",{className:"w-12 h-1 bg-slate-200 dark:bg-slate-700 mx-2"})]},s))}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[o===1&&e.jsxs(u,{className:"p-8 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"üé® Personalize seu Assistente"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Nome do Bot"}),e.jsx(k,{value:t.name,onChange:s=>r(a=>({...a,name:s.target.value})),placeholder:"Ex: Assistente de Matem√°tica"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Avatar/√çcone"}),e.jsx("div",{className:"flex gap-2 mt-2",children:P.map(s=>e.jsx("button",{onClick:()=>r(a=>({...a,avatar:s})),className:`text-4xl p-3 rounded-lg border-2 transition-all ${t.avatar===s?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 scale-110":"border-slate-200 dark:border-slate-700 hover:scale-105"}`,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Personalidade"}),e.jsx("div",{className:"space-y-2 mt-2",children:[{value:"formal",label:"Formal e Acad√™mico"},{value:"friendly",label:"Amig√°vel e Casual"},{value:"motivational",label:"Encorajador e Motivacional"}].map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"personality",checked:t.personality===s.value,onChange:()=>r(a=>({...a,personality:s.value}))}),e.jsx("span",{children:s.label})]},s.value))})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Tom de Voz"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.useEmojis,onChange:s=>r(a=>({...a,useEmojis:s.target.checked}))}),e.jsx("span",{children:"Usar emojis"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.useExamples,onChange:s=>r(a=>({...a,useExamples:s.target.checked}))}),e.jsx("span",{children:"Responder com exemplos pr√°ticos"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.encourage,onChange:s=>r(a=>({...a,encourage:s.target.checked}))}),e.jsx("span",{children:"Incentivar o aluno"})]})]})]})]})]}),o===2&&e.jsxs(u,{className:"p-8 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"üìù Selecione as Atividades"}),e.jsx("div",{className:"space-y-4 mb-6",children:g.map(s=>e.jsx("label",{className:`block p-4 rounded-lg border-2 cursor-pointer transition-all ${t.selectedActivities.includes(s.id)?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.selectedActivities.includes(s.id),onChange:()=>D(s.id),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["üìÖ Prazo: ",s.due_date?new Date(s.due_date).toLocaleDateString("pt-BR"):"Sem prazo"]})]})]})},s.id))}),e.jsx("div",{className:"p-4 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:["Selecionadas: ",t.selectedActivities.length,"/",g.length," atividades",e.jsx("br",{}),"‚ö†Ô∏è Vers√£o FREE: At√© 10 atividades | üíé PRO: Atividades ilimitadas"]})})]}),o===3&&e.jsxs(u,{className:"p-8 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"‚öôÔ∏è Como o Chatbot pode ajudar"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(d,{children:"O chatbot poder√°:"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canExplain,onChange:s=>r(a=>({...a,canExplain:s.target.checked}))}),e.jsx("span",{children:"Explicar conceitos das atividades"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canGiveExamples,onChange:s=>r(a=>({...a,canGiveExamples:s.target.checked}))}),e.jsx("span",{children:"Dar exemplos similares"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canAnswerDoubt,onChange:s=>r(a=>({...a,canAnswerDoubt:s.target.checked}))}),e.jsx("span",{children:"Tirar d√∫vidas sobre o conte√∫do"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canGiveHints,onChange:s=>r(a=>({...a,canGiveHints:s.target.checked}))}),e.jsx("span",{children:"Dar dicas sobre as quest√µes (RECOMENDADO)"})]}),e.jsxs("label",{className:"flex items-center gap-2 opacity-50 cursor-not-allowed",title:"Desabilitado: O chatbot deve guiar o aluno, n√£o dar respostas diretas",children:[e.jsx("input",{type:"checkbox",checked:t.canShowAnswers,disabled:!0}),e.jsx("span",{className:"line-through",children:"Mostrar respostas corretas (desabilitado)"})]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-semibold mb-2",children:"üéØ Modo de Orienta√ß√£o Ativo"}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["O chatbot ir√° GUIAR o aluno a chegar na resposta atrav√©s de:",e.jsx("br",{}),"‚Ä¢ Perguntas que estimulam o racioc√≠nio",e.jsx("br",{}),"‚Ä¢ Dicas progressivas (se habilitado)",e.jsx("br",{}),"‚Ä¢ Exemplos similares para analogias",e.jsx("br",{}),"‚Ä¢ Explica√ß√µes de conceitos fundamentais"]})]}),e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:["‚ö†Ô∏è O chatbot N√ÉO vai:",e.jsx("br",{}),"‚Ä¢ Fazer as atividades pelo aluno",e.jsx("br",{}),"‚Ä¢ Dar respostas diretas",e.jsx("br",{}),"‚Ä¢ Substituir o professor",e.jsx("br",{}),"‚Ä¢ Resolver exerc√≠cios completos"]})}),e.jsxs("div",{children:[e.jsx(d,{children:"Limite de mensagens por aluno"}),e.jsx(k,{type:"number",value:t.messagesLimit,onChange:s=>r(a=>({...a,messagesLimit:parseInt(s.target.value)})),min:"1",max:"50"}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:"FREE: 10 mensagens/dia | üíé PRO: Mensagens ilimitadas"})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(h,{variant:"outline",onClick:()=>N(s=>Math.max(1,s-1)),disabled:o===1,children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",onClick:()=>{},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Salvar Rascunho"]}),o<3?e.jsxs(h,{onClick:()=>N(s=>s+1),className:"bg-gradient-to-r from-blue-600 to-cyan-600",children:["Pr√≥ximo",e.jsx(q,{className:"w-4 h-4 ml-2"})]}):e.jsxs(h,{onClick:R,className:"bg-gradient-to-r from-blue-600 to-cyan-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Ativar Chatbot"]})]})]})]})]})};export{Ae as default};
