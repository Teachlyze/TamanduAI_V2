import{c as Ve,b as B,r as g,s as N,l as me,j as e,q as xe,u as Be,L as A}from"./main-CI5_MmIm.js";import{D as He,a as Ye,b as Je,c as We,d as Ze,e as Xe}from"./dialog-DzyprNmz.js";import{B as w}from"./button-D7H9d9Gd.js";import{L as he}from"./label-Nf4YzbUq.js";import{S as Qe,a as Ke,b as et,c as tt,d as st}from"./select-DSQCR6Pt.js";import{I as _e}from"./input-BJMmyirp.js";import{u as at}from"./use-toast-D7N2H9RC.js";import{S as pe}from"./send-C3fwnXAu.js";import{U as be}from"./users-ChR7WEeh.js";import{C as L}from"./calendar-Dbm_7POQ.js";import{C as q}from"./clock-3X7dheFj.js";import{X as rt}from"./x-DGmYUGM5.js";import{E as it}from"./EventDetailsModal-DjVL9YCc.js";import{C as O}from"./card-DpcnMbcE.js";import{B as R}from"./badge-BOI6M_d9.js";import{S as nt}from"./StatsCard-C6i8pjlS.js";import"./DashboardHeader-CYuk3ql1.js";import{E as z}from"./EmptyState-2SgC2yO6.js";import"./dropdown-menu-dTrFNQHD.js";import{s as ot,f as P}from"./format-BdDrz3ZT.js";import{s as lt}from"./subDays-C76KfxB7.js";import{e as ct}from"./endOfDay-B-zzKHwV.js";import{t as fe,c as dt,m as Te,a as Ie}from"./en-US-ChNhCS9W.js";import{B as Y}from"./book-open-DlGI5eOy.js";import{T as ue}from"./trending-up-1zEvTPQM.js";import{m as S}from"./proxy-CT7Xtxle.js";import{S as Re}from"./sparkles-D6AqXP1n.js";import{T as mt}from"./target-BgYs7ZJ1.js";import{V as Se}from"./video-Ou893xhQ.js";import{F as $}from"./file-text-CtozP3gh.js";import{T as ae}from"./triangle-alert-ta0gV1VM.js";import{C as ht}from"./circle-check-aCTblfpW.js";import{C as Ee}from"./chart-column-G5dLAdkQ.js";import{C as Ae}from"./chevron-right-CHSrP1xQ.js";import{p as re}from"./pt-BR-C6XVmIDX.js";import"./index-D4BuPd_i.js";import"./index-DHrdJ99Z.js";import"./Combination-BfETjw1A.js";import"./SidebarPremium-0_wHXPj0.js";import"./house-B6Hparzo.js";import"./graduation-cap-mPfDCRgT.js";import"./message-circle-CRpVuYq9.js";import"./settings-BWUwUKXK.js";import"./brain-DVBX4Id_.js";import"./index-RHGs5twt.js";import"./index-CRRraFTu.js";import"./index-CtvfaZbL.js";import"./index-DrPD6SFW.js";import"./chevron-down-DXVEpPD6.js";import"./check-GhIpAKm1.js";import"./chevron-up-CrZ13wWo.js";import"./redisCache-O8mv39UX.js";import"./map-pin-NlcbbFzM.js";import"./user-BVmzLDrp.js";import"./square-pen-6UHqJ7PH.js";import"./copy-DoAVddfE.js";import"./trash-2-CwB_tbLS.js";import"./index-jkBwDHc_.js";import"./addDays-jaRQZo3H.js";const ut=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],gt=Ve("activity",ut),xt=({open:s,onClose:t,activity:a,onSuccess:r})=>{const{user:n}=B(),{toast:o}=at(),[c,x]=g.useState([]),[h,l]=g.useState(""),[d,u]=g.useState(""),[k,b]=g.useState("23:59"),[y,p]=g.useState(!1),[E,F]=g.useState(!1);g.useEffect(()=>{if(s&&n){J();const m=new Date;m.setDate(m.getDate()+7),u(m.toISOString().split("T")[0])}},[s,n]);const J=async()=>{try{F(!0);const{data:m,error:D}=await N.from("classes").select("id, name, subject, is_active").eq("created_by",n.id).eq("is_active",!0).order("name",{ascending:!0});if(D)throw D;x(m||[])}catch(m){me.error("Erro ao carregar turmas:",m),o({title:"Erro ao carregar turmas",description:m.message,variant:"destructive"})}finally{F(!1)}},j=async()=>{if(!h){o({title:"Selecione uma turma",description:"Escolha a turma para postar a atividade.",variant:"destructive"});return}if(!d){o({title:"Defina a data de entrega",description:"A data de entrega é obrigatória.",variant:"destructive"});return}try{p(!0);const m=`${d}T${k}:00`,{error:D}=await N.from("activities").update({due_date:m}).eq("id",a.id);if(D)throw me.error("Erro ao atualizar atividade:",D),D;const{data:T,error:C}=await N.from("activity_class_assignments").insert({activity_id:a.id,class_id:h,assigned_at:new Date().toISOString()}).select().single();if(C)throw C;o({title:"✅ Atividade postada!",description:"A atividade foi postada para a turma selecionada."}),r&&r(T),t()}catch(m){me.error("Erro ao postar atividade:",m),o({title:"Erro ao postar atividade",description:m.message,variant:"destructive"})}finally{p(!1)}},_=()=>{y||(l(""),u(""),b("23:59"),t())};return e.jsx(He,{open:s,onOpenChange:_,children:e.jsxs(Ye,{className:"max-w-md",children:[e.jsxs(Je,{children:[e.jsxs(We,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-600"}),"Postar Atividade"]}),e.jsx(Ze,{children:"Escolha a turma e defina a data de entrega para postar esta atividade."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-900 rounded-lg border",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Atividade:"}),e.jsx("p",{className:"font-semibold",children:a?.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{htmlFor:"class",children:[e.jsx(be,{className:"w-4 h-4 inline mr-1"}),"Turma *"]}),E?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx(xe,{size:"sm"})}):e.jsxs(Qe,{value:h,onValueChange:l,children:[e.jsx(Ke,{id:"class",children:e.jsx(et,{placeholder:"Selecione a turma..."})}),e.jsx(tt,{children:c.map(m=>e.jsxs(st,{value:m.id,children:[m.name," ",m.subject&&`- ${m.subject}`]},m.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{htmlFor:"due-date",children:[e.jsx(L,{className:"w-4 h-4 inline mr-1"}),"Data de Entrega *"]}),e.jsx(_e,{id:"due-date",type:"date",value:d,onChange:m=>u(m.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{htmlFor:"due-time",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),"Hora de Entrega"]}),e.jsx(_e,{id:"due-time",type:"time",value:k,onChange:m=>b(m.target.value)})]})]}),e.jsxs(Xe,{children:[e.jsxs(w,{variant:"outline",onClick:_,disabled:y,children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),e.jsx(w,{onClick:j,disabled:y||!h||!d,children:y?e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:"sm",className:"mr-2"}),"Postando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Postar Atividade"]})})]})]})})};function pt(s,t){return fe(s,t?.in).getDay()}function bt(s,t){const a=()=>dt(t?.in,NaN),n=vt(s);let o;if(n.date){const l=wt(n.date,2);o=Nt(l.restDateString,l.year)}if(!o||isNaN(+o))return a();const c=+o;let x=0,h;if(n.time&&(x=kt(n.time),isNaN(x)))return a();if(n.timezone){if(h=Ct(n.timezone),isNaN(h))return a()}else{const l=new Date(c+x),d=fe(0,t?.in);return d.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),d.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),d}return fe(c+x+h,t?.in)}const ie={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ft=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,yt=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,jt=/^([+-])(\d{2})(?::?(\d{2}))?$/;function vt(s){const t={},a=s.split(ie.dateTimeDelimiter);let r;if(a.length>2)return t;if(/:/.test(a[0])?r=a[0]:(t.date=a[0],r=a[1],ie.timeZoneDelimiter.test(t.date)&&(t.date=s.split(ie.timeZoneDelimiter)[0],r=s.substr(t.date.length,s.length))),r){const n=ie.timezone.exec(r);n?(t.time=r.replace(n[1],""),t.timezone=n[1]):t.time=r}return t}function wt(s,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=s.match(a);if(!r)return{year:NaN,restDateString:""};const n=r[1]?parseInt(r[1]):null,o=r[2]?parseInt(r[2]):null;return{year:o===null?n:o*100,restDateString:s.slice((r[1]||r[2]).length)}}function Nt(s,t){if(t===null)return new Date(NaN);const a=s.match(ft);if(!a)return new Date(NaN);const r=!!a[4],n=Z(a[1]),o=Z(a[2])-1,c=Z(a[3]),x=Z(a[4]),h=Z(a[5])-1;if(r)return Tt(t,x,h)?_t(t,x,h):new Date(NaN);{const l=new Date(0);return!Et(t,o,c)||!Dt(t,n)?new Date(NaN):(l.setUTCFullYear(t,o,Math.max(n,c)),l)}}function Z(s){return s?parseInt(s):1}function kt(s){const t=s.match(yt);if(!t)return NaN;const a=ge(t[1]),r=ge(t[2]),n=ge(t[3]);return It(a,r,n)?a*Te+r*Ie+n*1e3:NaN}function ge(s){return s&&parseFloat(s.replace(",","."))||0}function Ct(s){if(s==="Z")return 0;const t=s.match(jt);if(!t)return 0;const a=t[1]==="+"?-1:1,r=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;return Rt(r,n)?a*(r*Te+n*Ie):NaN}function _t(s,t,a){const r=new Date(0);r.setUTCFullYear(s,0,4);const n=r.getUTCDay()||7,o=(t-1)*7+a+1-n;return r.setUTCDate(r.getUTCDate()+o),r}const St=[31,null,31,30,31,30,31,31,30,31,30,31];function Le(s){return s%400===0||s%4===0&&s%100!==0}function Et(s,t,a){return t>=0&&t<=11&&a>=1&&a<=(St[t]||(Le(s)?29:28))}function Dt(s,t){return t>=1&&t<=(Le(s)?366:365)}function Tt(s,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function It(s,t,a){return s===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&s>=0&&s<25}function Rt(s,t){return t>=0&&t<=59}let De=!1;const X={DEBUG:0,INFO:1,WARN:2,ERROR:3,CRITICAL:4},At=()=>X["INFO".toUpperCase()]??X.INFO,Lt=s=>s>=At(),Ot=()=>{try{return{userId:null,userEmail:null,sessionId:sessionStorage.getItem("session_id")||Mt()}}catch{return{userId:null,userEmail:null,sessionId:"unknown"}}},Mt=()=>{const s=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return sessionStorage.setItem("session_id",s),s},Ut=(s,t,a=null)=>{const r=new Date().toISOString(),n=Ot();return{timestamp:r,level:X[s],levelName:s,message:t,data:a?JSON.stringify(a):null,userId:n.userId,userEmail:n.userEmail,sessionId:n.sessionId,userAgent:navigator.userAgent,url:window.location.href,environment:"production"}},Pt=async s=>{try{if(De||!(s.level>=X.ERROR))return;const{error:a}=await N.from("application_logs").insert([{timestamp:s.timestamp,level:s.level,level_name:s.levelName,message:s.message,data:s.data,user_id:s.userId,user_email:s.userEmail,session_id:s.sessionId,user_agent:s.userAgent,url:s.url,environment:s.environment}]);if(a){const r=(a?.message||"").toLowerCase();if((a?.code||"")==="PGRST205"||r.includes("could not find the table 'public.application_logs'")){De=!0,s("WARN","[Logger] application_logs table not found. Disabling DB logging for this session.");return}s("ERROR","[Logger] Failed to save log to database:",a)}}catch(t){s("ERROR","[Logger] Error saving log:",t)}},$t=(s,t,a=null)=>{const r={DEBUG:"color: #6b7280; font-weight: normal;",INFO:"color: #3b82f6; font-weight: normal;",WARN:"color: #f59e0b; font-weight: bold;",ERROR:"color: #ef4444; font-weight: bold;",CRITICAL:"color: #dc2626; font-weight: bold; background: #fee2e2; padding: 2px 4px; border-radius: 2px;"},n=new Date().toLocaleTimeString();(s==="ERROR"||s==="CRITICAL")&&(a?console.debug(`%c[${n}] ${s}: ${t}`,r[s],a):console.debug(`%c[${n}] ${s}: ${t}`,r[s]))},G=async(s,t,a=null)=>{if(!Lt(X[s]))return;const r=Ut(s,t,a);$t(s,t,a),await Pt(r),s==="CRITICAL"&&window.Sentry&&window.Sentry.captureException(new Error(t),{extra:{data:a,logData:r}})},f={debug:(s,t)=>G("DEBUG",s,t),info:(s,t)=>G("INFO",s,t),warn:(s,t)=>G("WARN",s,t),error:(s,t)=>G("ERROR",s,t),critical:(s,t)=>G("CRITICAL",s,t),setUserContext:(s,t)=>{try{typeof window<"u"&&(sessionStorage.setItem("user_id",s),sessionStorage.setItem("user_email",t))}catch(a){G("ERROR","[Logger] Error setting user context:",a)}},clearUserContext:()=>{try{typeof window<"u"&&(sessionStorage.removeItem("user_id"),sessionStorage.removeItem("user_email"))}catch(s){G("ERROR","[Logger] Error clearing user context:",s)}}},Ft="false".toLowerCase()==="true";class zt{constructor(){this.metrics={cache:{hits:0,misses:0,errors:0,sets:0,deletes:0,stale:0,invalidations:0},api:{calls:0,errors:0,latency:[],byEndpoint:{}},auth:{login:{success:0,errors:0},sessionChecks:0,permissionChecks:0,tokenRefreshes:0,tokenErrors:0},performance:{pageLoad:[],apiCall:[],render:[]},errors:[]},this.initialized=!1,this.pageLoadStart=Date.now(),this.init()}init(){this.initialized||typeof window>"u"||(this.interval=setInterval(()=>this.logMetrics(),300*1e3),this.initialized=!0,window.addEventListener("load",()=>{const t=Date.now()-this.pageLoadStart;this.recordPageLoad(t)}),window.addEventListener("beforeunload",()=>this.logMetrics()),this.setupErrorHandling(),this.setupPerformanceMonitoring())}setupErrorHandling(){window.onerror=(t,a,r,n,o)=>(this.trackError({type:"unhandled_error",message:o?.message||t,stack:o?.stack,source:a,lineno:r,colno:n}),!1),window.addEventListener("unhandledrejection",t=>{this.trackError({type:"unhandled_rejection",message:t.reason?.message||"Unhandled promise rejection",stack:t.reason?.stack})})}setupPerformanceMonitoring(){if(!window.performance)return;const t=performance.getEntriesByType("navigation")[0];if(t){const{domComplete:r,loadEventEnd:n,domInteractive:o,domContentLoadedEventEnd:c}=t;this.recordPageLoad(n),f.info("Page load metrics",{domLoad:r,pageLoad:n,domInteractive:o,domContentLoaded:c})}performance.getEntriesByType("resource").forEach(r=>{f.debug("Resource loaded",{name:r.name,duration:r.duration,initiatorType:r.initiatorType,transferSize:r.transferSize})})}recordPageLoad(t){return this.metrics.performance.pageLoad.push(t),this.metrics.performance.pageLoad.length>100&&this.metrics.performance.pageLoad.shift(),t}apiCall(t,a,r={}){this.metrics.api.calls++,this.metrics.api.latency.push(a),this.metrics.api.byEndpoint[t]||(this.metrics.api.byEndpoint[t]={calls:0,errors:0,totalLatency:0,avgLatency:0});const n=this.metrics.api.byEndpoint[t];return n.calls++,n.totalLatency+=a,n.avgLatency=n.totalLatency/n.calls,f.info("API Call",{endpoint:t,duration:a,...r}),a}apiError(t,a){return this.metrics.api.errors++,this.metrics.api.byEndpoint[t]&&this.metrics.api.byEndpoint[t].errors++,this.trackError({type:"api_error",endpoint:t,message:a?.message||"Unknown API error",stack:a?.stack,status:a?.status,code:a?.code}),a}trackError(t){const a=new Date().toISOString(),r={...t,timestamp:a,userAgent:navigator?.userAgent,url:window.location?.href};return this.metrics.errors.push(r),this.metrics.errors.length>100&&this.metrics.errors.shift(),f.error("Error occurred",r),r}cacheHit(t){return this.metrics.cache.hits++,f.debug("Cache hit",{endpoint:t}),this.metrics.cache.hits}cacheMiss(t){return this.metrics.cache.misses++,f.debug("Cache miss",{endpoint:t}),this.metrics.cache.misses}cacheStale(t){return this.metrics.cache.stale++,f.debug("Cache stale",{endpoint:t}),this.metrics.cache.stale}cacheError(t){return this.metrics.cache.errors++,this.trackError({type:"cache_error",message:t?.message||"Cache error",stack:t?.stack}),this.metrics.cache.errors}cacheSet(t){return this.metrics.cache.sets++,f.debug("Cache set",{key:t}),this.metrics.cache.sets}cacheDelete(t){return this.metrics.cache.deletes++,f.debug("Cache delete",{key:t}),this.metrics.cache.deletes}cacheInvalidate(t){return this.metrics.cache.invalidations++,f.debug("Cache invalidate",{pattern:t}),this.metrics.cache.invalidations}loginSuccess(){return this.metrics.auth.login.success++,this.metrics.auth.login.success}loginError(){return this.metrics.auth.login.errors++,this.metrics.auth.login.errors}sessionCheck(){return this.metrics.auth.sessionChecks++,this.metrics.auth.sessionChecks}permissionCheck(){return this.metrics.auth.permissionChecks++,this.metrics.auth.permissionChecks}async logMetrics(){try{if(!this.initialized)return;const t=new Date().toISOString(),a={...this.metrics,timestamp:t,pageUrl:window.location?.href,userAgent:navigator?.userAgent};if(Ft&&N){const{error:r}=await N.from("metrics").insert([a]);r?f.error("Error saving metrics to Supabase",{error:r}):f.info("Metrics logged successfully")}return this.resetCounters(),a}catch(t){return f.error("Error in metrics logging",{error:t}),null}}resetCounters(){this.metrics.cache.hits=0,this.metrics.cache.misses=0,this.metrics.cache.errors=0,this.metrics.cache.sets=0,this.metrics.cache.deletes=0,this.metrics.cache.stale=0,this.metrics.cache.invalidations=0,this.metrics.api.calls=0,this.metrics.api.errors=0,this.metrics.api.latency=[],this.metrics.auth.login.success=0,this.metrics.auth.login.errors=0,this.metrics.auth.sessionChecks=0,this.metrics.auth.permissionChecks=0}getMetrics(){return{...this.metrics}}}const V=new zt;typeof window<"u"&&V.init();const Gt=typeof window<"u",qt="https://wapbwaimkurbuihatmix.supabase.co/functions/v1/redis-cache";class Oe{constructor(){this.cache=new Map,this.timeouts=new Map}async get(t,a=!0){const r=this.cache.get(t);if(!r)return null;const{data:n,expiresAt:o}=r;return o&&Date.now()>o?(this.cache.delete(t),null):a&&typeof n=="string"?JSON.parse(n):n}async set(t,a,r=300){const n=typeof a=="string"?a:JSON.stringify(a),o=r?Date.now()+r*1e3:null;if(this.cache.set(t,{data:n,expiresAt:o}),r){this.timeouts.has(t)&&clearTimeout(this.timeouts.get(t));const c=setTimeout(()=>{this.cache.delete(t),this.timeouts.delete(t)},r*1e3);this.timeouts.set(t,c)}return!0}async del(t){return this.timeouts.has(t)&&(clearTimeout(this.timeouts.get(t)),this.timeouts.delete(t)),this.cache.delete(t)}async deletePattern(t){const a=new RegExp(t.replace(/\*/g,".*"));let r=0;for(const n of this.cache.keys())a.test(n)&&(await this.del(n),r++);return r}async clear(){return this.cache.clear(),this.timeouts.forEach(clearTimeout),this.timeouts.clear(),!0}async healthCheck(){return{status:"healthy",message:"Using browser in-memory cache",timestamp:new Date().toISOString()}}async getStats(){return{connected:!0,mode:"browser",stats:{keys:this.cache.size,memoryUsage:0,uptime:0}}}}class Vt extends Oe{constructor(){super(),this.edgeFunctionUrl=qt,this.enabled=!!this.edgeFunctionUrl}async makeEdgeFunctionRequest(t,a,r=null,n=null){if(!this.enabled)throw new Error("Upstash Redis edge function not available");const o={action:t,key:a};r!==null&&(o.value=r),n!==null&&(o.ttl=n);const c=await fetch(this.edgeFunctionUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhcGJ3YWlta3VyYnVpaGF0bWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyODY3MjksImV4cCI6MjA3NDg2MjcyOX0.x-NQQ2TtRgaUjjBZCf6j49eWOW4XSqjTFKC_KB1L56A"},body:JSON.stringify(o)});if(!c.ok){const h=await c.json().catch(()=>({}));throw new Error(`Edge function error: ${c.status} ${h.message||"Unknown error"}`)}const x=await c.json();if(!x.success)throw new Error(`Redis operation failed: ${x.error}`);return x.result}async get(t,a=!0){try{if(this.enabled){const r=await this.makeEdgeFunctionRequest("get",t);if(r!==null)return await super.set(t,r),a?JSON.parse(r):r}return super.get(t,a)}catch(r){return f.warn("Upstash Redis get failed, using local cache:",r),super.get(t,a)}}async set(t,a,r=300){try{if(this.enabled){const n=typeof a=="string"?a:JSON.stringify(a);await this.makeEdgeFunctionRequest("set",t,n,r)}return await super.set(t,a,r),!0}catch(n){return f.warn("Upstash Redis set failed, using local cache only:",n),super.set(t,a,r)}}async del(t){try{this.enabled&&await this.makeEdgeFunctionRequest("del",t)}catch(a){f.warn("Upstash Redis del failed:",a)}return super.del(t)}async deletePattern(t){try{this.enabled&&await this.makeEdgeFunctionRequest("keys",t)}catch(a){f.warn("Upstash Redis deletePattern failed:",a)}return super.deletePattern(t)}async clear(){try{this.enabled&&await this.makeEdgeFunctionRequest("flush")}catch(t){f.warn("Upstash Redis clear failed:",t)}return super.clear()}async healthCheck(){try{if(this.enabled)return await this.makeEdgeFunctionRequest("ping"),{status:"healthy",message:"Upstash Redis edge function is responding",mode:"upstash-edge",timestamp:new Date().toISOString()}}catch(t){f.warn("Upstash Redis health check failed:",t)}return super.healthCheck()}}let ye;Gt?ye=new Vt:ye=new Oe;const ne=ye,Bt={},Ht=60*1e3,Yt=3,Jt=1e3,oe=(Bt?.VITE_REDIS_ENABLED||"").toString().toLowerCase()==="true",Me={data:null,loading:!0,error:null,stale:!1,lastUpdated:null,retryCount:0};function Wt(s,t){switch(t.type){case"SET_LOADING":return{...s,loading:t.payload};case"SET_DATA":return{...s,data:t.payload.data,loading:!1,error:null,stale:t.payload.stale||!1,lastUpdated:t.payload.lastUpdated||new Date,retryCount:0};case"SET_ERROR":return{...s,error:t.payload,loading:!1,retryCount:s.retryCount+1};case"SET_STALE":return{...s,stale:t.payload};case"RESET":return Me;default:return s}}const Q=(s,t,a={})=>{const{ttl:r=300,dependencies:n=[],enabled:o=!0,staleTime:c=Ht,skipInitialFetch:x=!1,onSuccess:h,onError:l}=a,[d,u]=g.useReducer(Wt,Me),k=g.useRef(!0),b=g.useRef(null),y=g.useRef(!1),p=typeof s=="function"?s():s;g.useEffect(()=>()=>{k.current=!1,b.current?.abort()},[]);const E=g.useCallback(async(j=!1)=>{if(!(!p&&!j||!o)&&!y.current){y.current=!0,b.current=new AbortController;try{if(!j&&oe){let C=null;try{C=await ne.get(p)}catch(H){f.warn("Redis GET failed, continuing without cache",{key:p,error:H.message})}if(C){V.cacheHit();const H=!C.timestamp||Date.now()-new Date(C.timestamp).getTime()>c;if(k.current&&(u({type:"SET_DATA",payload:{data:C.data,stale:H,lastUpdated:C.timestamp?new Date(C.timestamp):new Date}}),u({type:"SET_LOADING",payload:!1}),!j&&!H))return C.data}else V.cacheMiss()}k.current&&u({type:"SET_LOADING",payload:!0});const _=performance.now(),m=await t(b.current.signal),D=performance.now();if(V.apiCall(D-_),!m)throw new Error("No response from server");const T={data:m,timestamp:new Date().toISOString(),metadata:{ttl:r,staleTime:c}};if(oe)try{await ne.set(p,T,r)}catch(C){f.warn("Redis SET failed, skipping cache write",{key:p,error:C.message})}return k.current&&(u({type:"SET_DATA",payload:{data:m,stale:!1,lastUpdated:new Date(T.timestamp)}}),h?.(m)),m}catch(_){if(_.name==="AbortError")return;if(V.apiError(),f.error("Error in useRedisCache",{key:p,error:_.message,stack:_.stack}),k.current)if(u({type:"SET_ERROR",payload:_}),d.retryCount<Yt){const m=Jt*Math.pow(2,d.retryCount);setTimeout(()=>{k.current&&E(!0)},m)}else l?.(_);throw _}finally{y.current=!1,b.current=null}}},[p,t,r,c,o,d.retryCount,h,l]);g.useEffect(()=>{if(!x)return E().catch(()=>{}),()=>b.current?.abort()},[p,x,E,...n]);const F=g.useCallback(async()=>{if(p){try{oe&&await ne.del(p),V.cacheDelete?.()}catch(j){f.warn("Redis DEL failed during invalidate",{key:p,error:j.message})}return E(!0)}},[p,E]),J=g.useCallback(j=>{p&&u(_=>{const m=typeof j=="function"?j(_.data):j,D={data:m,timestamp:new Date().toISOString(),metadata:{ttl:r,staleTime:c}};return oe&&(async()=>{try{await ne.set(p,D,r),V.cacheSet?.()}catch(T){f.warn("Redis SET failed during updateCache",{key:p,error:T.message})}})(),{..._,data:m,lastUpdated:new Date}})},[p,r,c]);return{data:d.data,error:d.error,loading:d.loading,stale:d.stale,lastUpdated:d.lastUpdated,refetch:()=>E(!0),invalidate:F,updateCache:J,isStale:d.stale,retryCount:d.retryCount,cacheKey:p}},Zt=()=>{const{user:s}=B(),t=g.useCallback(async()=>{if(!s?.id)return null;try{const{data:a,error:r}=await N.from("classes").select("id, class_members(count)").eq("created_by",s.id).eq("is_active",!0);if(r)throw r;const n=(a||[]).reduce((b,y)=>b+(y.class_members?.[0]?.count||0),0),c=(await N.from("activities").select("id").eq("created_by",s.id)).data?.map(b=>b.id)||[],{data:x}=await N.from("submissions").select("id",{count:"exact",head:!0}).in("activity_id",c).eq("status","submitted"),{data:h}=await N.from("submissions").select("grade").in("activity_id",c).not("grade","is",null),l=h?.length>0?h.reduce((b,y)=>b+y.grade,0)/h.length:0,d=new Date;d.setHours(0,0,0,0);const u=new Date(d);u.setDate(u.getDate()+1);const{data:k}=await N.from("submissions").select("id",{count:"exact",head:!0}).in("activity_id",c).gte("graded_at",d.toISOString()).lt("graded_at",u.toISOString());return{totalClasses:a?.length||0,totalStudents:n,totalActivities:c.length,pendingGrading:x?.length||0,avgGrade:Number(l.toFixed(1)),todayCorrections:k?.length||0}}catch(a){throw console.error("[useDashboardStats] Error:",a),a}},[s?.id]);return Q(`teacher:dashboard:stats:${s?.id}`,t,{ttl:300,enabled:!!s?.id,staleTime:120*1e3})},Xt=(s=7)=>{const{user:t}=B(),a=g.useCallback(async()=>{if(!t?.id)return{today:[],upcoming:[]};try{const r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate()),o=new Date(r.getFullYear(),r.getMonth(),r.getDate()+1),c=new Date(r.getTime()+s*24*60*60*1e3),{data:x,error:h}=await N.from("calendar_events").select(`
          *,
          class:classes(name, subject),
          activity:activities(title, type)
        `).eq("created_by",t.id).gte("start_time",n.toISOString()).lt("start_time",o.toISOString()).eq("is_cancelled",!1).order("start_time",{ascending:!0});if(h)throw h;const{data:l,error:d}=await N.from("calendar_events").select(`
          *,
          class:classes(name, subject),
          activity:activities(title, type)
        `).eq("created_by",t.id).gte("start_time",o.toISOString()).lte("start_time",c.toISOString()).eq("is_cancelled",!1).order("start_time",{ascending:!0}).limit(10);if(d)throw d;return{today:(x||[]).map(u=>({...u,class_name:u.class?.name||"Aula Geral",class_subject:u.class?.subject||"",activity_title:u.activity?.title||"",activity_type:u.activity?.type||""})),upcoming:(l||[]).map(u=>({...u,class_name:u.class?.name||"Aula Geral",class_subject:u.class?.subject||"",activity_title:u.activity?.title||"",activity_type:u.activity?.type||""}))}}catch(r){return console.error("[useDashboardEvents] Error:",r),{today:[],upcoming:[]}}},[t?.id,s]);return Q(`teacher:dashboard:events:${t?.id}:${s}`,a,{ttl:180,enabled:!!t?.id,staleTime:60*1e3})},Qt=(s=10)=>{const{user:t}=B(),a=g.useCallback(async()=>{if(!t?.id)return[];try{const{data:r}=await N.from("activities").select("id").eq("created_by",t.id),n=r?.map(y=>y.id)||[];if(n.length===0)return{submissions:[],weeklySubmissions:[0,0,0,0,0,0,0],weeklyTotal:0};const{data:o,error:c}=await N.from("submissions").select(`
          *,
          activity:activities(title),
          student:profiles!student_id(full_name)
        `).in("activity_id",n).eq("status","submitted").order("submitted_at",{ascending:!0}).limit(s);if(c)throw c;const x=new Date,h=ot(lt(x,6)),l=ct(x),{data:d}=await N.from("submissions").select("submitted_at").in("activity_id",n).gte("submitted_at",h.toISOString()).lte("submitted_at",l.toISOString()),u=[0,0,0,0,0,0,0];d?.forEach(y=>{const p=pt(bt(y.submitted_at));u[p===0?6:p-1]++});const k=d?.length||0;return{submissions:(o||[]).map(y=>({...y,student_name:y.student?.full_name||"Aluno",activity_title:y.activity?.title||"Atividade"})),weeklySubmissions:u,weeklyTotal:k}}catch(r){return console.error("[useDashboardSubmissions] Error:",r),{submissions:[],weeklySubmissions:[0,0,0,0,0,0,0],weeklyTotal:0}}},[t?.id,s]);return Q(`teacher:dashboard:submissions:${t?.id}:${s}`,a,{ttl:120,enabled:!!t?.id,staleTime:30*1e3})},Kt=(s=6)=>{const{user:t}=B(),a=g.useCallback(async()=>{if(!t?.id)return[];try{const{data:r}=await N.from("activities").select("id").eq("created_by",t.id),n=r?.map(l=>l.id)||[];if(n.length===0)return[];const{data:o,error:c}=await N.from("submissions").select(`
          student_id,
          grade,
          student:profiles!student_id(full_name)
        `).in("activity_id",n).not("grade","is",null);if(c)throw c;const x={};return(o||[]).forEach(l=>{x[l.student_id]||(x[l.student_id]={grades:[],name:l.student?.full_name||"Aluno"}),x[l.student_id].grades.push(l.grade)}),Object.entries(x).map(([l,d])=>({id:l,name:d.name,avgGrade:d.grades.reduce((u,k)=>u+k,0)/d.grades.length,totalActivities:d.grades.length})).filter(l=>l.avgGrade<s).sort((l,d)=>l.avgGrade-d.avgGrade).slice(0,10)}catch(r){return console.error("[useDashboardAlerts] Error:",r),[]}},[t?.id,s]);return Q(`teacher:dashboard:alerts:${t?.id}:${s}`,a,{ttl:600,enabled:!!t?.id,staleTime:300*1e3})},es=()=>{const{user:s}=B(),t=g.useCallback(async()=>{if(!s?.id)return{classes:[],activities:[]};try{const{data:a,error:r}=await N.from("classes").select(`
          *,
          class_members(count)
        `).eq("created_by",s.id).eq("is_active",!0).order("created_at",{ascending:!1}).limit(5);if(r)throw r;const n=(a||[]).map(h=>({...h,student_count:h.class_members?.[0]?.count||0})),{data:o,error:c}=await N.from("activities").select(`
          *,
          activity_class_assignments(class:classes(name))
        `).eq("created_by",s.id).order("created_at",{ascending:!1}).limit(5);if(c)throw c;const x=(o||[]).map(h=>({...h,class_name:h.activity_class_assignments?.[0]?.class?.name||"Sem turma"}));return{classes:n,activities:x}}catch(a){return console.error("[useDashboardRecentData] Error:",a),{classes:[],activities:[]}}},[s?.id]);return Q(`teacher:dashboard:recent:${s?.id}`,t,{ttl:300,enabled:!!s?.id,staleTime:120*1e3})},Ue=g.memo(({stats:s})=>{const t=[{label:"Corrigir atividades pendentes",subtitle:`${s?.pendingGrading||0} submissões aguardando`,icon:$,href:"/dashboard/corrections",gradient:"from-amber-500 to-orange-500",show:!0},{label:"Planejar próxima aula",subtitle:"Ver calendário e eventos",icon:L,href:"/dashboard/calendar",gradient:"from-blue-600 to-cyan-600",show:!0},{label:"Criar nova atividade",subtitle:"Gere conteúdo automaticamente",icon:Re,href:"/dashboard/activities/create",gradient:"from-purple-600 to-pink-600",show:!0}].filter(a=>a.show);return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:t.map((a,r)=>e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.1},children:e.jsx(A,{to:a.href,children:e.jsx(O,{className:"p-6 hover:shadow-lg transition-all cursor-pointer border-2 hover:border-blue-300 dark:hover:border-blue-700 group",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${a.gradient} shadow-lg group-hover:scale-110 transition-transform`,children:e.jsx(a.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-1",children:a.label}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.subtitle})]}),e.jsx(Ae,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all"})]})})})},a.label))})});Ue.displayName="PriorityActions";const oa=()=>{const{user:s,profile:t}=B(),a=Be(),[r,n]=g.useState(7),[o,c]=g.useState(!1),[x,h]=g.useState(null),[l,d]=g.useState(!1),[u,k]=g.useState(null),[b,y]=g.useState(1),p=6,E=g.useCallback(i=>{n(i),y(1)},[]),F=g.useCallback(i=>{k(i),d(!0)},[]),J=g.useCallback(i=>{a(`/dashboard/students/${i}`)},[a]),{data:j,loading:_}=Zt(),{data:m,loading:D,refetch:T}=Xt(r),{data:C,loading:H,refetch:je}=Qt(),{data:K}=Kt(),{data:Pe,loading:$e}=es(),Fe=g.useCallback(()=>{T(),je()},[T,je]),ze=g.useCallback(()=>{T()},[T]),ve=m?.upcoming?.slice((b-1)*p,b*p),le=Math.ceil(m?.upcoming?.length/p),ce=g.useCallback(i=>{y(i)},[]),{today:we=[],upcoming:Ne=[]}=m||{},{classes:ee=[],activities:te=[]}=Pe||{},se=C?.submissions||[],ke=C?.weeklySubmissions||[],Ce=C?.weeklyTotal||0;if(_&&D&&H&&$e)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(xe,{size:"lg",text:"Carregando dashboard..."})});const Ge=t?.full_name?.split(" ")[0]||"Professor",qe=[{title:"Total de Turmas",value:j?.totalClasses||0,icon:Y,gradient:"from-blue-600 to-cyan-600",bgColor:"bg-blue-50 dark:bg-blue-950/30",change:`${j?.totalStudents||0} alunos`},{title:"Total de Alunos",value:j?.totalStudents||0,icon:be,gradient:"from-cyan-500 to-blue-600",bgColor:"bg-cyan-50 dark:bg-cyan-950/30"},{title:"Média Geral",value:j?.avgGrade||0,icon:ue,gradient:"from-emerald-500 to-teal-500",bgColor:"bg-emerald-50 dark:bg-emerald-950/30",change:(j?.avgGrade||0)>=7?"Excelente":"Pode melhorar"},{title:"Aguardando Correção",value:j?.pendingGrading||0,icon:q,gradient:"from-amber-500 to-orange-500",bgColor:"bg-amber-50 dark:bg-amber-950/30",change:`${j?.todayCorrections||0} hoje`}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50/30 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-white/20 backdrop-blur-sm",children:e.jsx(Re,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Olá, ",Ge]}),e.jsx("p",{className:"text-blue-100 mt-1",children:"Vamos reduzir seu trabalho extraclasse hoje"})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[j?.totalClasses||0," turmas"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:[j?.totalStudents||0," alunos"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsxs("span",{children:[j?.pendingGrading||0," correções"]})]})]})]})}),e.jsx(Ue,{stats:j}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:qe.map((i,v)=>e.jsx(nt,{title:i.title,value:i.value,icon:i.icon,gradient:i.gradient,bgColor:i.bgColor,change:i.change,delay:v*.1},i.title))}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-500",children:e.jsx(mt,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Hoje"}),e.jsx(R,{className:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",children:P(new Date,"EEEE, d MMMM",{locale:re})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(O,{className:"p-6 border-2 border-blue-100 dark:border-blue-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(L,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Agenda de Hoje"})]}),e.jsx(A,{to:"/dashboard/calendar",children:e.jsx(w,{variant:"ghost",size:"sm",className:"text-blue-600 hover:text-blue-700",children:"Ver Calendário"})})]}),e.jsx("div",{className:"space-y-3",children:we.length>0?we.map((i,v)=>{const I=i.type==="meeting",M=i.type==="activity",U=i.type==="deadline",de=I?Se:M?$:U?ae:L,W={meeting:"border-l-purple-500 bg-purple-50/50 dark:bg-purple-950/20",activity:"border-l-orange-500 bg-orange-50/50 dark:bg-orange-950/20",deadline:"border-l-red-500 bg-red-50/50 dark:bg-red-950/20",event:"border-l-blue-500 bg-blue-50/50 dark:bg-blue-950/20"};return e.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:v*.1},onClick:()=>F(i),className:`p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-blue-400 cursor-pointer transition-all border-l-4 ${W[i.type]||W.event}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:`p-3 rounded-lg ${I?"bg-purple-100":M?"bg-orange-100":U?"bg-red-100":"bg-blue-100"}`,children:e.jsx(de,{className:`w-6 h-6 ${I?"text-purple-600":M?"text-orange-600":U?"text-red-600":"text-blue-600"}`})}),e.jsxs("div",{className:"flex-1",children:[i.class_name?e.jsx("div",{className:"mb-2",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600"}),i.class_name,i.class_subject&&e.jsx("span",{className:"text-sm bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded font-medium",children:i.class_subject})]})}):e.jsx("div",{className:"mb-2",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-gray-600"}),"Evento Geral"]})}),e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-1",children:i.title}),i.activity_title&&e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-white dark:bg-gray-800 p-2 rounded-lg border border-gray-200 dark:border-gray-700 mb-2",children:[e.jsx($,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:i.activity_title}),i.activity_type&&e.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-1 rounded font-medium",children:i.activity_type})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:P(new Date(i.start_time),"HH:mm")}),i.end_time&&e.jsxs("span",{children:["- ",P(new Date(i.end_time),"HH:mm")]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(R,{variant:"outline",className:"text-xs",children:P(new Date(i.start_time),"dd/MM",{locale:re})})})]})]},i.id)}):e.jsx(z,{icon:L,title:"Nenhum evento hoje",description:"Sua agenda está livre hoje."})})]}),e.jsxs(O,{className:"p-6 border-2 border-amber-100 dark:border-amber-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx($,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Correções Pendentes"}),se.length>0&&e.jsx(R,{className:"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300",children:se.length})]}),e.jsx(A,{to:"/dashboard/corrections",children:e.jsx(w,{variant:"ghost",size:"sm",className:"text-amber-600 hover:text-amber-700",children:"Ver Todas"})})]}),e.jsx("div",{className:"space-y-3",children:se.length>0?se.slice(0,5).map((i,v)=>e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:v*.05},className:"flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-amber-300 dark:hover:border-amber-700 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold",children:i.student_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:i.student_name}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:i.activity_title})]})]}),e.jsx(A,{to:`/dashboard/grading/${i.id}`,children:e.jsx(w,{size:"sm",className:"bg-gradient-to-r from-amber-600 to-orange-600",children:"Corrigir"})})]},i.id)):e.jsx(z,{icon:ht,title:"Nenhuma correção pendente!",description:"Parabéns! Você está em dia "})})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-500",children:e.jsx(L,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Esta Semana"})]}),e.jsxs(O,{className:"p-6 border-2 border-indigo-100 dark:border-indigo-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-100 dark:bg-indigo-900/30",children:e.jsx(L,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Próximos Eventos"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{size:"sm",variant:r===1?"default":"outline",onClick:()=>E(1),children:"Hoje"}),e.jsx(w,{size:"sm",variant:r===3?"default":"outline",onClick:()=>E(3),children:"3 dias"}),e.jsx(w,{size:"sm",variant:r===7?"default":"outline",onClick:()=>E(7),children:"7 dias"}),e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>a("/dashboard/calendar"),children:"Ver Todos"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:ve?.length>0?ve.map((i,v)=>{const I=i.type==="meeting",M=i.type==="activity",U=i.type==="deadline",de=I?Se:M?$:U?ae:L,W={meeting:"border-l-purple-500 bg-purple-50/50 dark:bg-purple-950/20",activity:"border-l-orange-500 bg-orange-50/50 dark:bg-orange-950/20",deadline:"border-l-red-500 bg-red-50/50 dark:bg-red-950/20",event:"border-l-blue-500 bg-blue-50/50 dark:bg-blue-950/20"};return e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:v*.05},onClick:()=>F(i),className:`p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-indigo-400 cursor-pointer transition-all border-l-4 ${W[i.type]||W.event}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${I?"bg-purple-100":M?"bg-orange-100":U?"bg-red-100":"bg-blue-100"}`,children:e.jsx(de,{className:`w-4 h-4 ${I?"text-purple-600":M?"text-orange-600":U?"text-red-600":"text-blue-600"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[i.class_name?e.jsx("div",{className:"mb-1",children:e.jsxs("h3",{className:"text-sm font-bold text-gray-900 dark:text-white flex items-center gap-1 truncate",children:[e.jsx(Y,{className:"w-3 h-3 text-blue-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:i.class_name}),i.class_subject&&e.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 py-0.5 rounded font-medium flex-shrink-0",children:i.class_subject})]})}):e.jsx("div",{className:"mb-1",children:e.jsxs("h3",{className:"text-sm font-bold text-gray-900 dark:text-white flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3 text-gray-600"}),"Evento Geral"]})}),e.jsx("h4",{className:"text-xs font-semibold text-gray-800 dark:text-gray-200 mb-1 truncate",children:i.title}),i.activity_title&&e.jsxs("div",{className:"flex items-center gap-1 text-xs bg-white dark:bg-gray-800 p-1 rounded border border-gray-200 dark:border-gray-700 mb-1",children:[e.jsx($,{className:"w-3 h-3 text-orange-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300 truncate",children:i.activity_title}),i.activity_type&&e.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-1 py-0.5 rounded font-medium flex-shrink-0",children:i.activity_type})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-gray-700 dark:text-gray-300",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{children:P(new Date(i.start_time),"HH:mm")}),i.end_time&&e.jsxs("span",{children:["- ",P(new Date(i.end_time),"HH:mm")]})]}),e.jsx(R,{variant:"outline",className:"text-xs px-1 py-0.5",children:P(new Date(i.start_time),"dd/MM",{locale:re})})]})]},i.id)}):e.jsx("div",{className:"col-span-2",children:e.jsx(z,{icon:L,title:"Nenhum evento próximo",description:"Seus próximos eventos aparecerão aqui."})})}),le>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Mostrando ",(b-1)*p+1,"-",Math.min(b*p,Ne?.length||0)," de ",Ne?.length||0," eventos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:"sm",variant:"outline",onClick:()=>ce(b-1),disabled:b===1,children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:le},(i,v)=>v+1).map(i=>e.jsx(w,{size:"sm",variant:b===i?"default":"outline",onClick:()=>ce(i),className:"w-8 h-8 p-0",children:i},i))}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>ce(b+1),disabled:b===le,children:"Próxima"})]})]})]})]}),K&&K.length>0&&e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-red-500 to-orange-500",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Alunos em Risco"}),e.jsxs(R,{className:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300",children:[K.length," alunos"]})]}),e.jsxs(O,{className:"p-6 border-2 border-red-100 dark:border-red-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900/30",children:e.jsx(ae,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Alunos que Precisam de Atenção"})]}),e.jsx(A,{to:"/dashboard/students",children:e.jsx(w,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",children:"Ver Todos"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:K.map((i,v)=>e.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:v*.05},className:"flex items-center gap-4 p-4 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center text-white font-bold text-xl",children:i.name?.[0]||"A"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsxs(R,{className:"bg-red-100 text-red-700 text-xs mt-1",children:["Média: ",i.avgGrade.toFixed(1)]})]}),e.jsx(w,{size:"sm",onClick:()=>J(i.id),children:"Ver Detalhes"})]},i.id))})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-green-500 to-emerald-500",children:e.jsx(Ee,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Visão Geral"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(O,{className:"p-6 border-2 border-green-100 dark:border-green-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(Y,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Turmas Recentes"})]}),e.jsx(A,{to:"/dashboard/classes",children:e.jsx(w,{variant:"ghost",size:"sm",children:"Ver Todas"})})]}),e.jsx("div",{className:"space-y-3",children:ee.length>0?ee.slice(0,3).map((i,v)=>e.jsx(A,{to:`/dashboard/classes/${i.id}`,children:e.jsx(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:v*.05},className:"p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-green-300 dark:hover:border-green-700 transition-all cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${i.color||"from-blue-500 to-indigo-500"} flex items-center justify-center text-white font-bold`,children:i.name?.[0]||"T"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i.subject," • ",i.student_count," alunos"]})]})]})})},i.id)):e.jsx(z,{icon:Y,title:"Nenhuma turma encontrada",description:"Crie sua primeira turma para começar."})})]}),e.jsxs(O,{className:"p-6 border-2 border-purple-100 dark:border-purple-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:e.jsx($,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Atividades Recentes"})]}),e.jsx(A,{to:"/dashboard/activities",children:e.jsx(w,{variant:"ghost",size:"sm",children:"Ver Todas"})})]}),e.jsx("div",{className:"space-y-3",children:te.length>0?te.slice(0,3).map((i,v)=>e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:v*.05},className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white flex-1",children:i.title}),e.jsx(R,{variant:i.is_published?"default":"secondary",className:"ml-2",children:i.is_published?"Postada":"Rascunho"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:i.class_name}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:new Date(i.due_date)<new Date?"destructive":"default",className:"text-xs",children:new Date(i.due_date)<new Date?"Encerrada":"Aberta"}),i.submission_count!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:[i.submission_count," ",i.submission_count===1?"submissão":"submissões"]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:P(new Date(i.due_date),"dd/MM",{locale:re})})]})]},i.id)):e.jsx(z,{icon:$,title:"Nenhuma atividade",description:"Suas atividades aparecerão aqui."})})]}),e.jsxs(O,{className:"p-6 border-2 border-orange-100 dark:border-orange-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30",children:e.jsx(q,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Para Postar"})]}),e.jsx(A,{to:"/dashboard/activities?filter=drafts",children:e.jsx(w,{variant:"ghost",size:"sm",children:"Ver Todas"})})]}),e.jsx("div",{className:"space-y-3",children:te.filter(i=>!i.is_published).length>0?te.filter(i=>!i.is_published).slice(0,3).map((i,v)=>e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:v*.05},className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-orange-300 dark:hover:border-orange-700 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white flex-1",children:i.title}),e.jsx(R,{variant:"secondary",className:"ml-2",children:"Rascunho"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:i.class_name}),e.jsxs(w,{size:"sm",className:"w-full",onClick:()=>{h(i),c(!0)},children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Postar Agora"]})]},i.id)):e.jsx(z,{icon:q,title:"Nenhum rascunho",description:"Atividades não postadas aparecerão aqui."})})]})]})]}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-500",children:e.jsx(Ee,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Performance Insights"}),e.jsx(R,{className:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300",children:"Últimos 7 dias"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(O,{className:"p-6 border-2 border-emerald-100 dark:border-emerald-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100 dark:bg-emerald-900/30",children:e.jsx(gt,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Atividade da Semana"})]}),e.jsx(A,{to:"/dashboard/analytics",children:e.jsx(w,{variant:"ghost",size:"sm",className:"text-emerald-600 hover:text-emerald-700",children:"Ver Analytics"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:["Seg","Ter","Qua","Qui","Sex","Sáb","Dom"].map((i,v)=>{const I=ke.length===7?ke:[0,0,0,0,0,0,0],M=Math.max(...I,1),U=I[v]/M*100;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 text-sm font-medium text-gray-600 dark:text-gray-400",children:i}),e.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-6 relative overflow-hidden",children:e.jsx(S.div,{initial:{width:0},animate:{width:`${U}%`},transition:{delay:.8+v*.1,duration:.6},className:"h-full bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full flex items-center justify-end pr-2",children:e.jsx("span",{className:"text-xs text-white font-medium",children:I[v]})})})]},i)})}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Total de submissões"}),e.jsxs("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:[Ce||0," ",Ce===1?"submissão":"submissões"]})]})})]})]}),e.jsxs(O,{className:"p-6 border-2 border-purple-100 dark:border-purple-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:e.jsx(ue,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Turmas em Destaque"})]}),e.jsx(A,{to:"/dashboard/classes",children:e.jsx(w,{variant:"ghost",size:"sm",className:"text-purple-600 hover:text-purple-700",children:"Ver Todas"})})]}),e.jsx("div",{className:"space-y-3",children:(ee?.slice(0,4)||[]).length>0?ee.slice(0,4).map((i,v)=>e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.8+v*.1},className:"flex items-center gap-4 p-3 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${i.color||"from-purple-500 to-pink-500"} flex items-center justify-center text-white font-bold`,children:i.name?.[0]||"T"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(R,{className:"bg-purple-100 text-purple-700 text-xs",children:[i.student_count," ",i.student_count===1?"aluno":"alunos"]}),e.jsx("span",{className:"text-xs text-gray-500",children:i.subject})]})]}),e.jsx(Ae,{className:"w-4 h-4 text-gray-400"})]},i.name)):e.jsx(z,{icon:ue,title:"Nenhuma turma",description:"Crie turmas para ver estatísticas."})})]})]})]}),e.jsx(xt,{open:o,onClose:()=>{c(!1),h(null)},activity:x,onSuccess:Fe}),l&&u&&e.jsx(it,{isOpen:l,onClose:()=>{d(!1),k(null)},event:u,onEdit:()=>a("/dashboard/calendar"),onDelete:ze})]})};export{oa as default};
