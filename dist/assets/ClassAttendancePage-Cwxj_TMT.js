import{c as B,k as L,u as q,r as t,j as e,i as I}from"./main-BYt0atFx.js";import{B as n,C as c}from"./card-OcUoX-wQ.js";import{I as O}from"./label-Co3Fv3aZ.js";import{D as H,g as h}from"./dropdown-menu-SP7CzJJe.js";import{S as g}from"./StatsCard-CeLbUark.js";import{C as S}from"./classService-DDEMbQ3F.js";import{A as T}from"./arrow-left-BLRXZrhk.js";import{C as w}from"./circle-x-BJ1ybjte.js";import{S as M}from"./save-biAYLgGd.js";import"./index-B8z1bzn5.js";import"./chevron-right-D-kejNpi.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],u=B("circle-check-big",z),se=()=>{const{classId:r}=L(),i=q(),[C,b]=t.useState(!0),[j,f]=t.useState(!1),[y,A]=t.useState(null),[o,P]=t.useState([]),[d,v]=t.useState({}),[p,_]=t.useState({}),[m,D]=t.useState({averageRate:0,totalPresent:0,totalAbsent:0});t.useEffect(()=>{E()},[r]);const E=async()=>{try{b(!0);const s=await S.getClassById(r);A(s);const a=await S.getClassMembers(r,{role:"student"});P(a||[]);const l={};a.forEach($=>{l[$.user_id]=!0}),v(l),D({averageRate:92.5,totalPresent:450,totalAbsent:35})}catch(s){console.error("Erro:",s)}finally{b(!1)}},F=s=>{v(a=>({...a,[s]:!a[s]}))},R=async()=>{try{f(!0);const s={classId:r,date:new Date().toISOString(),records:Object.entries(d).map(([a,l])=>({studentId:a,present:l,note:p[a]||null}))};console.log("Salvando frequência:",s),alert("Frequência salva com sucesso!"),i(`/teacher/classes/${r}`)}catch(s){console.error("Erro:",s),alert("Erro ao salvar frequência.")}finally{f(!1)}},x=Object.values(d).filter(Boolean).length,N=o.length-x;return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(I,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(n,{variant:"ghost",onClick:()=>i(`/teacher/classes/${r}`),className:"mb-4",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(H,{title:`Frequência - ${y?.name||"Turma"}`,subtitle:`Chamada de ${new Date().toLocaleDateString("pt-BR")}`,role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(g,{title:"Taxa de Presença Média",value:`${m.averageRate}%`,icon:u,gradient:h.success,format:"text",delay:0}),e.jsx(g,{title:"Presenças Totais",value:m.totalPresent,icon:u,gradient:h.success,delay:.1}),e.jsx(g,{title:"Faltas Totais",value:m.totalAbsent,icon:w,gradient:h.danger,delay:.2})]}),e.jsx(c,{className:"p-6 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800 mb-8",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:["⚠️ ",e.jsx("strong",{children:"Versão FREE:"})," Histórico limitado às últimas 30 chamadas.",e.jsx("br",{}),"💎 ",e.jsx("strong",{children:"PRO:"})," Histórico ilimitado, gráficos de presença e exportação."]})}),e.jsx(c,{className:"p-6 bg-white dark:bg-slate-900 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:"Chamada de Hoje"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[o.length," alunos • ",x," presentes • ",N," ausentes"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:x}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Presentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:N}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Ausentes"})]})]})]})}),e.jsx(c,{className:"p-6 bg-white dark:bg-slate-900 mb-6",children:e.jsx("div",{className:"space-y-4",children:o.map(s=>{const a=d[s.user_id];return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[s.user?.avatar_url?e.jsx("img",{src:s.user.avatar_url,alt:s.user.name,className:"w-12 h-12 rounded-full"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:s.user?.name?.[0]||"A"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-white",children:s.user?.name||"Sem nome"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.user?.email})]}),e.jsx(O,{placeholder:"Observação (opcional)",value:p[s.user_id]||"",onChange:l=>_(k=>({...k,[s.user_id]:l.target.value})),className:"w-48"}),e.jsx(n,{onClick:()=>F(s.user_id),className:`
                    w-32
                    ${a?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}
                  `,children:a?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Presente"]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Ausente"]})})]},s.user_id)})})}),e.jsx(c,{className:"p-6 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(n,{onClick:R,disabled:j,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Salvar Frequência"]})}),e.jsx(n,{variant:"outline",onClick:()=>i(`/teacher/classes/${r}`),children:"Cancelar"})]})})]})};export{se as default};
