import{a as Y,r as l,s as N,j as e,k as Z,L as m}from"./main-Cr4CeQqJ.js";import{m as h,B as n}from"./button-VDnOzUX8.js";import{C as d}from"./card-CvoT5xff.js";import{B as ee}from"./badge-BpFoLbJI.js";import{P as te}from"./progress-B22G_fnC.js";import{B as L}from"./book-open-Bm_7-XsZ.js";import{F as k}from"./file-text-JP6gqb3e.js";import{C as _}from"./circle-check-DWdYCGZi.js";import{C as se}from"./clock-CJn97wdf.js";import{C as M}from"./chart-column-DHMA61nx.js";import{T as ae}from"./trophy-CXP8DNan.js";import{C as F}from"./chevron-right-D9YOEkTh.js";import{C as P}from"./calendar-BfYonUFO.js";import{C as E}from"./circle-alert-B-sotHTf.js";import{I as ie}from"./info-BdSezIWa.js";import"./index-Zvo5G3yJ.js";const Ne=()=>{const{user:x}=Y(),[G,g]=l.useState(!0),[o,C]=l.useState({totalClasses:0,activeActivities:0,completedActivities:0,upcomingDeadlines:0,completionRate:0,avgGrade:0}),[V,A]=l.useState([]),[I,D]=l.useState([]),[q,$]=l.useState([]),[re,z]=l.useState([]),[U,S]=l.useState([]);l.useEffect(()=>{x?.id?O():g(!1)},[x]);const O=async()=>{try{if(g(!0),!x?.id){console.log("Usuário não autenticado"),g(!1);return}const{data:t}=await N.from("class_members").select(`
          class_id,
          class:classes(id, name, subject, color, banner_color)
        `).eq("user_id",x.id).eq("role","student"),a=t?.map(s=>s.class).filter(Boolean)||[],r=a.map(s=>s.id);if(r.length===0){C({totalClasses:0,activeActivities:0,completedActivities:0,upcomingDeadlines:0,completionRate:0,avgGrade:0}),A([]),D([]),$([]),z([]),S([{id:1,type:"info",message:"Você ainda não está em nenhuma turma",action:"Entrar"}]),g(!1);return}const{data:f}=await N.from("activity_class_assignments").select(`
          activity_id,
          activity:activities(
            id,
            title,
            due_date,
            max_score,
            type,
            is_published,
            status
          )
        `).in("class_id",r),v=(f?.map(s=>s.activity).filter(Boolean)||[]).filter(s=>s.is_published&&s.status==="active"),{data:w}=await N.from("submissions").select("id, activity_id, status, grade, submitted_at, graded_at").eq("student_id",x.id),B=new Map(w?.map(s=>[s.activity_id,s])||[]),R=new Date,u=v.filter(s=>{if(!s.due_date)return!1;const y=(new Date(s.due_date)-R)/(1e3*60*60);return y>0&&y<=48&&!B.has(s.id)}),T=w?.filter(s=>s.status==="submitted"||s.status==="graded")||[],p=w?.filter(s=>s.grade!==null)||[],Q=p.length>0?p.reduce((s,i)=>s+parseFloat(i.grade),0)/p.length:0,W=v.length>0?T.length/v.length*100:0,c=v.filter(s=>!B.has(s.id)).map(s=>({...s,dueDate:s.due_date,className:a.find(i=>i.id)?.name||"Turma"})),X=p.sort((s,i)=>new Date(i.graded_at||i.submitted_at)-new Date(s.graded_at||s.submitted_at)).slice(0,5),b=[];u.length>0&&b.push({id:1,type:"warning",message:`${u.length} atividade${u.length>1?"s":""} com prazo em 48h`,action:"Ver"}),c.length>0&&b.push({id:2,type:"info",message:`${c.length} atividade${c.length>1?"s":""} pendente${c.length>1?"s":""}`,action:"Acessar"});const j=p.filter(s=>{if(!s.graded_at)return!1;const i=new Date(s.graded_at);return(R-i)/(1e3*60*60*24)<=7});j.length>0&&b.push({id:3,type:"success",message:`${j.length} feedback${j.length>1?"s":""} recebido${j.length>1?"s":""}`,action:"Ler"}),C({totalClasses:a.length,activeActivities:c.length,completedActivities:T.length,upcomingDeadlines:u.length,completionRate:Math.round(W),avgGrade:parseFloat(Q.toFixed(1))}),A(a),D(c.slice(0,5)),$(X),z(u),S(b.length>0?b:[{id:1,type:"success",message:"Tudo em dia! Continue assim!",action:""}])}catch(t){console.error("Erro ao carregar dashboard:",t)}finally{g(!1)}},H=[{title:"Minhas Turmas",value:o.totalClasses,icon:L,gradient:"from-cyan-500 to-sky-500"},{title:"Atividades Ativas",value:o.activeActivities,icon:k,gradient:"from-sky-500 to-blue-500"},{title:"Atividades Concluídas",value:o.completedActivities,icon:_,gradient:"from-blue-500 to-indigo-500"},{title:"Prazos Próximos (48h)",value:o.upcomingDeadlines,icon:se,gradient:"from-orange-500 to-amber-500"},{title:"Taxa de Conclusão",value:`${o.completionRate}%`,icon:M,gradient:"from-cyan-500 to-blue-600"},{title:"Nota Média",value:o.avgGrade.toFixed(1),icon:ae,gradient:"from-yellow-500 to-orange-500"}],J=t=>{const a=new Date,f=(new Date(t)-a)/(1e3*60*60);return f<24?{label:"Urgente",variant:"destructive"}:f<48?{label:"Em breve",variant:"warning"}:{label:"Normal",variant:"default"}},K=t=>t>=8?"text-green-600 dark:text-green-400":t>=6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return G?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Z,{size:"lg",text:"Carregando dashboard..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 via-sky-50 to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-4 md:p-6",children:[e.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-cyan-600 focus:text-white focus:rounded-lg focus:shadow-lg",children:"Pular para o conteúdo principal"}),e.jsxs("header",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-cyan-500 via-sky-500 to-blue-600 dark:from-cyan-700 dark:via-sky-700 dark:to-blue-800 p-6 md:p-8 text-white shadow-lg",role:"banner",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]","aria-hidden":"true"}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Meu Dashboard"}),e.jsx("p",{className:"text-cyan-100 dark:text-cyan-200 text-sm md:text-base",children:"Acompanhe seu progresso, atividades e desempenho acadêmico"})]}),e.jsx("div",{className:"absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl","aria-hidden":"true"}),e.jsx("div",{className:"absolute -bottom-10 -left-10 w-40 h-40 bg-white/10 rounded-full blur-3xl","aria-hidden":"true"})]}),e.jsxs("main",{id:"main-content",role:"main","aria-label":"Estatísticas do estudante",children:[e.jsxs("section",{"aria-labelledby":"stats-heading",className:"mb-8",children:[e.jsx("h2",{id:"stats-heading",className:"sr-only",children:"Estatísticas gerais"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:H.map((t,a)=>{const r=t.icon;return e.jsx(h.article,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},"aria-label":`${t.title}: ${t.value}`,children:e.jsxs(d,{className:"p-4 md:p-6 hover:shadow-xl transition-all duration-200 bg-white dark:bg-slate-900 border-2 border-transparent hover:border-cyan-200 dark:hover:border-cyan-800 focus-within:ring-2 focus-within:ring-cyan-400 focus-within:ring-offset-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4",children:[e.jsx("div",{className:`p-2 md:p-3 rounded-xl bg-gradient-to-r ${t.gradient} shadow-md`,"aria-hidden":"true",children:e.jsx(r,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx(F,{className:"w-4 h-4 md:w-5 md:h-5 text-slate-400 dark:text-slate-500","aria-hidden":"true"})]}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-slate-900 dark:text-white mb-1",children:t.value}),e.jsx("p",{className:"text-xs md:text-sm text-slate-600 dark:text-slate-400 font-medium",children:t.title})]})},t.title)})})]}),e.jsxs(d,{className:"p-6 mb-8 bg-white dark:bg-slate-900",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Minhas Turmas"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:V.map((t,a)=>e.jsx(h.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:a*.05},children:e.jsx(m,{to:`/students/classes/${t.id}`,children:e.jsxs(d,{className:"p-4 hover:shadow-lg transition-all border-2 hover:border-blue-300 dark:hover:border-blue-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:`w-full h-2 rounded-full bg-gradient-to-r ${t.color||"from-blue-500 to-indigo-500"} mb-4`}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white mb-2",children:t.name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:t.teacher_name}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-500 dark:text-slate-500",children:[t.active_activities||0," atividades"]}),e.jsx(n,{size:"sm",variant:"ghost",className:"whitespace-nowrap",children:"Ver Turma"})]})]})})},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(d,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Atividades Pendentes"]}),e.jsx(m,{to:"/students/activities",children:e.jsxs(n,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(F,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:I.map((t,a)=>{const r=J(t.due_date);return e.jsx(h.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},children:e.jsx(m,{to:`/students/activities/${t.id}`,children:e.jsxs(d,{className:"p-4 hover:shadow-md transition-all border-2 hover:border-purple-200 dark:hover:border-purple-800 bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.class_name})]}),e.jsx(ee,{variant:r.variant,children:r.label})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),new Date(t.due_date).toLocaleDateString("pt-BR")]}),e.jsx(n,{size:"sm",variant:"ghost",className:"h-7 text-xs",children:"Fazer Atividade"})]}),t.progress>0&&e.jsx(te,{value:t.progress,className:"h-1 mt-2"})]})})},t.id)})})]}),e.jsxs(d,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Recentemente Corrigidas"]})}),e.jsx("div",{className:"space-y-3",children:q.map((t,a)=>e.jsx(h.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-emerald-300 dark:hover:border-emerald-700 transition-all bg-white dark:bg-slate-800",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-1",children:t.activity_title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:t.class_name}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl font-bold ${K(t.score)}`,children:t.score.toFixed(1)}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Corrigido em ",new Date(t.graded_at).toLocaleDateString("pt-BR")]})]})]}),e.jsx(n,{size:"sm",variant:"ghost",className:"whitespace-nowrap",children:"Ver Detalhes"})]})},t.id))})]})]}),e.jsxs(d,{className:"p-6 mb-8 bg-white dark:bg-slate-900",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Alertas e Lembretes"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:U.map((t,a)=>e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},className:`p-4 rounded-lg border-2 ${t.type==="warning"?"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-950/30":t.type==="info"?"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/30":"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/30"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[t.type==="warning"?e.jsx(E,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"}):t.type==="info"?e.jsx(ie,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}):e.jsx(_,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white",children:t.message})]}),e.jsx(n,{size:"sm",variant:"ghost",className:"whitespace-nowrap text-xs h-7",children:t.action})]})},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{to:"/students/activities",children:e.jsxs(n,{size:"lg",className:"w-full whitespace-nowrap inline-flex items-center justify-center gap-2 bg-gradient-to-r from-cyan-600 to-sky-600 hover:opacity-90 text-white h-14 shadow-lg",children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{children:"Ver Todas as Atividades"})]})}),e.jsx(m,{to:"/students/performance",children:e.jsxs(n,{size:"lg",className:"w-full whitespace-nowrap inline-flex items-center justify-center gap-2 bg-gradient-to-r from-sky-600 to-blue-600 hover:opacity-90 text-white h-14 shadow-lg",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{children:"Meu Desempenho Completo"})]})}),e.jsx(m,{to:"/students/calendar",children:e.jsxs(n,{size:"lg",className:"w-full whitespace-nowrap inline-flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:opacity-90 text-white h-14 shadow-lg",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{children:"Calendário de Prazos"})]})})]})]})]})};export{Ne as default};
