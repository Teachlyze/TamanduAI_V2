import{h as L,u as I,r as n,l as f,s as h,j as e,q as M}from"./main-BtydHokz.js";import{B as u}from"./button-pkZcz0fw.js";import{I as y}from"./input-DevW5dIO.js";import{L as m}from"./label-Do1Gcpls.js";import{C as b}from"./card-BLN8IVBT.js";import{D as B}from"./DashboardHeader-Do_OLCE8.js";import"./dropdown-menu-DQk5WS44.js";import{C as G}from"./classService-Ljb7If2H.js";import{u as $}from"./use-toast-BD7ojcJx.js";import{B as q}from"./bot-BOqS3Yen.js";import{A}from"./arrow-left-A7LEbFFM.js";import{S as z}from"./save-EZIFPJyD.js";import{A as V}from"./arrow-right-Bkl2qXtU.js";import{R as F}from"./rocket-B3f4LECE.js";import"./proxy-BKNTM3tf.js";import"./index-BRR_QA-l.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./users-CntpuLnR.js";import"./book-open-BQJiPDff.js";import"./file-text-GwBv-P3B.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./chevron-right-Bh44L5jc.js";import"./x-BtLVjj0F.js";import"./index-DsrKRt14.js";import"./check-B1zY7uXK.js";const De=()=>{const{classId:i}=L(),p=I(),{toast:g}=$(),[C,N]=n.useState(!0),[H,U]=n.useState(!1),[E,k]=n.useState(!1),[l,x]=n.useState(0),[o,w]=n.useState(1),[S,_]=n.useState(null),[j,D]=n.useState([]),[t,r]=n.useState({name:"",avatar:"ü§ñ",personality:"motivational",useEmojis:!0,useExamples:!0,encourage:!0,selectedActivities:[],selectedMaterials:[],canExplain:!0,canGiveExamples:!0,canAnswerDoubt:!0,canGiveHints:!0,canShowAnswers:!1,availability:"24/7",messagesLimit:10,language:"pt-BR",guidingMode:!0});n.useEffect(()=>{R()},[i]);const R=async()=>{try{N(!0);const s=await G.getClassById(i);if(!s){f.error("Turma n√£o encontrada:",i),g({title:"Erro",description:"Turma n√£o encontrada",variant:"destructive"}),p("/dashboard/classes");return}_(s),s&&r(d=>({...d,name:`Assistente de ${s.subject||s.name||"Turma"}`}));const{data:a}=await h.from("activity_class_assignments").select("activity:activities(*)").eq("class_id",i),v=(a?.map(d=>d.activity).filter(Boolean)||[]).filter(d=>(d?.activity_type||d?.type||"").toLowerCase()!=="project");D(v)}catch(s){f.error("Erro:",s)}finally{N(!1)}},T=s=>{r(a=>({...a,selectedActivities:a.selectedActivities.includes(s)?a.selectedActivities.filter(c=>c!==s):[...a.selectedActivities,s]}))},P=async()=>{try{k(!0),x(0),x(25);for(const a of t.selectedActivities){const c=j.find(v=>v.id===a);c&&await h.from("rag_training_sources").upsert({class_id:i,source_type:"activity",source_id:a,content:c.description||c.title,metadata:{title:c.title,due_date:c.due_date}})}x(50);const{data:s}=await h.from("classes").select("settings").eq("id",i).single();await h.from("classes").update({settings:{...s?.settings||{},chatbot_enabled:!0,chatbot_paused:!1,chatbot_config:t}}).eq("id",i),x(75),await h.from("chatbot_configurations").upsert({class_id:i,enabled:!0,keywords:[],themes:[],scope_restrictions:[],is_trained:!0,last_training:new Date().toISOString(),guiding_mode:t.guidingMode,can_show_answers:t.canShowAnswers}),x(100),setTimeout(()=>{g({title:"‚úÖ Chatbot ativado!",description:"Seu assistente virtual est√° pronto para ajudar os alunos."}),p(`/dashboard/chatbot/${i}/analytics`)},500)}catch(s){f.error("Erro ao ativar chatbot:",s),g({title:"‚ùå Erro ao ativar chatbot",description:"Tente novamente em alguns instantes.",variant:"destructive"}),k(!1)}},O=["ü§ñ","üéì","üìö","üí°","üß†","‚≠ê","üéØ","üöÄ"];return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(M,{size:"lg"})}):E?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(b,{className:"p-8 max-w-md w-full bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-16 h-16 mx-auto mb-4 text-blue-600 dark:text-blue-400 animate-pulse"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"üîÑ Treinando Assistente IA..."}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-4 mb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 h-4 rounded-full transition-all duration-300",style:{width:`${l}%`}})}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 space-y-1",children:[e.jsxs("div",{className:l>=25?"text-green-600":"",children:[l>=25?"‚úÖ":"üîÑ"," Processando atividades selecionadas"]}),e.jsxs("div",{className:l>=50?"text-green-600":"",children:[l>=50?"‚úÖ":"üîÑ"," Indexando conte√∫dos"]}),e.jsxs("div",{className:l>=75?"text-green-600":"",children:[l>=75?"‚úÖ":"üîÑ"," Gerando base de conhecimento"]}),e.jsxs("div",{className:l>=100?"text-green-600":"",children:[l>=100?"‚úÖ":"‚è≥"," Otimizando respostas"]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-4",children:"Tempo estimado: 2-3 minutos"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"‚ÑπÔ∏è Voc√™ pode sair desta p√°gina. Notificaremos quando estiver pronto!"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(u,{variant:"ghost",onClick:()=>p("/dashboard/chatbot"),className:"mb-4",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(B,{title:`Configurar Chatbot - ${S?.name}`,subtitle:`Passo ${o} de 3`,role:"teacher"}),e.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold ${o>=s?"bg-gradient-to-r from-blue-600 to-cyan-600 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-600"}`,children:s}),s<3&&e.jsx("div",{className:"w-12 h-1 bg-slate-200 dark:bg-slate-700 mx-2"})]},s))}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[o===1&&e.jsxs(b,{className:"p-8 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"üé® Personalize seu Assistente"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Nome do Bot"}),e.jsx(y,{value:t.name,onChange:s=>r(a=>({...a,name:s.target.value})),placeholder:"Ex: Assistente de Matem√°tica"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Avatar/√çcone"}),e.jsx("div",{className:"flex gap-2 mt-2",children:O.map(s=>e.jsx("button",{onClick:()=>r(a=>({...a,avatar:s})),className:`text-4xl p-3 rounded-lg border-2 transition-all ${t.avatar===s?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 scale-110":"border-slate-200 dark:border-slate-700 hover:scale-105"}`,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Personalidade"}),e.jsx("div",{className:"space-y-2 mt-2",children:[{value:"formal",label:"Formal e Acad√™mico"},{value:"friendly",label:"Amig√°vel e Casual"},{value:"motivational",label:"Encorajador e Motivacional"}].map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"personality",checked:t.personality===s.value,onChange:()=>r(a=>({...a,personality:s.value}))}),e.jsx("span",{children:s.label})]},s.value))})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Tom de Voz"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.useEmojis,onChange:s=>r(a=>({...a,useEmojis:s.target.checked}))}),e.jsx("span",{children:"Usar emojis"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.useExamples,onChange:s=>r(a=>({...a,useExamples:s.target.checked}))}),e.jsx("span",{children:"Responder com exemplos pr√°ticos"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.encourage,onChange:s=>r(a=>({...a,encourage:s.target.checked}))}),e.jsx("span",{children:"Incentivar o aluno"})]})]})]})]})]}),o===2&&e.jsxs(b,{className:"p-8 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"üìù Selecione as Atividades"}),e.jsx("div",{className:"space-y-4 mb-6",children:j.map(s=>e.jsx("label",{className:`block p-4 rounded-lg border-2 cursor-pointer transition-all ${t.selectedActivities.includes(s.id)?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.selectedActivities.includes(s.id),onChange:()=>T(s.id),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["üìÖ Prazo: ",s.due_date?new Date(s.due_date).toLocaleDateString("pt-BR"):"Sem prazo"]})]})]})},s.id))}),e.jsx("div",{className:"p-4 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:["Selecionadas: ",t.selectedActivities.length,"/",j.length," atividades",e.jsx("br",{}),"‚ö†Ô∏è Vers√£o FREE: At√© 10 atividades | üíé PRO: Atividades ilimitadas"]})})]}),o===3&&e.jsxs(b,{className:"p-8 bg-white dark:bg-slate-900",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"‚öôÔ∏è Como o Chatbot pode ajudar"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{children:"O chatbot poder√°:"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canExplain,onChange:s=>r(a=>({...a,canExplain:s.target.checked}))}),e.jsx("span",{children:"Explicar conceitos das atividades"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canGiveExamples,onChange:s=>r(a=>({...a,canGiveExamples:s.target.checked}))}),e.jsx("span",{children:"Dar exemplos similares"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canAnswerDoubt,onChange:s=>r(a=>({...a,canAnswerDoubt:s.target.checked}))}),e.jsx("span",{children:"Tirar d√∫vidas sobre o conte√∫do"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.canGiveHints,onChange:s=>r(a=>({...a,canGiveHints:s.target.checked}))}),e.jsx("span",{children:"Dar dicas sobre as quest√µes (RECOMENDADO)"})]}),e.jsxs("label",{className:"flex items-center gap-2 opacity-50 cursor-not-allowed",title:"Desabilitado: O chatbot deve guiar o aluno, n√£o dar respostas diretas",children:[e.jsx("input",{type:"checkbox",checked:t.canShowAnswers,disabled:!0}),e.jsx("span",{className:"line-through",children:"Mostrar respostas corretas (desabilitado)"})]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-semibold mb-2",children:"üéØ Modo de Orienta√ß√£o Ativo"}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["O chatbot ir√° GUIAR o aluno a chegar na resposta atrav√©s de:",e.jsx("br",{}),"‚Ä¢ Perguntas que estimulam o racioc√≠nio",e.jsx("br",{}),"‚Ä¢ Dicas progressivas (se habilitado)",e.jsx("br",{}),"‚Ä¢ Exemplos similares para analogias",e.jsx("br",{}),"‚Ä¢ Explica√ß√µes de conceitos fundamentais"]})]}),e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:["‚ö†Ô∏è O chatbot N√ÉO vai:",e.jsx("br",{}),"‚Ä¢ Fazer as atividades pelo aluno",e.jsx("br",{}),"‚Ä¢ Dar respostas diretas",e.jsx("br",{}),"‚Ä¢ Substituir o professor",e.jsx("br",{}),"‚Ä¢ Resolver exerc√≠cios completos"]})}),e.jsxs("div",{children:[e.jsx(m,{children:"Limite de mensagens por aluno"}),e.jsx(y,{type:"number",value:t.messagesLimit,onChange:s=>r(a=>({...a,messagesLimit:parseInt(s.target.value)})),min:"1",max:"50"}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:"FREE: 10 mensagens/dia | üíé PRO: Mensagens ilimitadas"})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(u,{variant:"outline",onClick:()=>w(s=>Math.max(1,s-1)),disabled:o===1,children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:()=>{},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Salvar Rascunho"]}),o<3?e.jsxs(u,{onClick:()=>w(s=>s+1),className:"bg-gradient-to-r from-blue-600 to-cyan-600",children:["Pr√≥ximo",e.jsx(V,{className:"w-4 h-4 ml-2"})]}):e.jsxs(u,{onClick:P,className:"bg-gradient-to-r from-blue-600 to-cyan-600",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Ativar Chatbot"]})]})]})]})]})};export{De as default};
