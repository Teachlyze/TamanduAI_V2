import{b as w,r as i,s as f,l as X,j as e,q as A}from"./main-BtydHokz.js";import{C as T}from"./card-BLN8IVBT.js";import{B as C}from"./badge-DpVvk9bK.js";import{S as g}from"./StatsCard-CQPBdi-L.js";import{D as L}from"./DashboardHeader-Do_OLCE8.js";import{E}from"./EmptyState-B9PjJzZx.js";import"./button-pkZcz0fw.js";import"./input-DevW5dIO.js";import{F}from"./FilterBar-o1N7uwxK.js";import{D as q}from"./DataTable-NqRs7-US.js";import"./label-Do1Gcpls.js";import{T as j}from"./trophy-D4fYfEaE.js";import{A as v}from"./award-CdIkW086.js";import"./proxy-BKNTM3tf.js";import"./chevron-right-Bh44L5jc.js";import"./dropdown-menu-DQk5WS44.js";import"./index-BRR_QA-l.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./users-CntpuLnR.js";import"./book-open-BQJiPDff.js";import"./file-text-GwBv-P3B.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./x-BtLVjj0F.js";import"./index-DsrKRt14.js";import"./check-B1zY7uXK.js";import"./funnel-CJBaT3bZ.js";import"./chevron-down-BPlSfXS4.js";import"./chevron-up-B8VCb_df.js";const Ne=()=>{const{user:o}=w(),[N,n]=i.useState(!0),[u,y]=i.useState(!0),[d,k]=i.useState([]),[p,h]=i.useState({period:"month"}),[b,_]=i.useState({totalStudents:0,totalXP:0});i.useEffect(()=>{S()},[o]);const S=async()=>{if(o)try{n(!0);const{data:r}=await f.from("classes").select("id").eq("created_by",o.id),t=r?.map(s=>s.id)||[];if(t.length===0){n(!1);return}const{data:m}=await f.from("class_members").select("user_id, user:profiles(id, full_name, avatar_url)").in("class_id",t).eq("role","student"),c=new Map;for(const s of m||[])if(!c.has(s.user_id)){const{data:l}=await f.from("gamification_profiles").select("*").eq("user_id",s.user_id).single();c.set(s.user_id,{id:s.user_id,name:s.user?.full_name,avatar:s.user?.avatar_url,xp:l?.xp_total||0,level:l?.level||1,streak:l?.current_streak||0})}const x=Array.from(c.values()).sort((s,l)=>l.xp-s.xp).map((s,l)=>({...s,rank:l+1}));k(x),_({totalStudents:x.length,totalXP:x.reduce((s,l)=>s+l.xp,0)})}catch(r){X.error("Erro:",r)}finally{n(!1),u&&y(!1)}},P=[{key:"rank",label:"Posi√ß√£o",render:(r,t)=>{const m={1:"ü•á",2:"ü•à",3:"ü•â"};return e.jsxs("div",{className:"font-bold text-lg",children:[m[t.rank]||""," ",t.rank,"¬∫"]})}},{key:"name",label:"Aluno",render:(r,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold",children:t.name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Level ",t.level]})]})]})},{key:"xp",label:"XP",render:(r,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"font-bold",children:t.xp.toLocaleString("pt-BR")})]})},{key:"streak",label:"Streak",render:(r,t)=>e.jsxs(C,{children:["üî• ",t.streak," dias"]})}],a=d.slice(0,3);return N&&u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(A,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(L,{title:"Ranking de Alunos",subtitle:"Classifica√ß√£o por XP",role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(g,{title:"Total de Alunos",value:b.totalStudents,icon:j,gradient:"from-amber-500 to-orange-500",delay:0}),e.jsx(g,{title:"XP Total",value:b.totalXP,icon:v,gradient:"from-blue-500 to-cyan-500",delay:.1})]}),e.jsx("div",{className:"mb-8",children:e.jsx(F,{filters:[{key:"period",label:"Per√≠odo",options:[{value:"week",label:"Semana"},{value:"month",label:"M√™s"},{value:"all",label:"Todo Per√≠odo"}]}],activeFilters:p,onFilterChange:(r,t)=>h({...p,[r]:t}),onClearAll:()=>h({period:"month"})})}),d.length>0?e.jsxs(e.Fragment,{children:[a.length>=3&&e.jsxs(T,{className:"p-8 bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-950/30 dark:to-orange-950/30 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"üèÜ Top 3"}),e.jsxs("div",{className:"flex items-end justify-center gap-8",children:[a[1]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-slate-400 bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white text-2xl font-bold",children:a[1].name?.[0]}),e.jsx("div",{className:"absolute -top-2 -right-2 text-4xl",children:"ü•à"})]}),e.jsx("div",{className:"font-bold",children:a[1].name}),e.jsxs("div",{className:"text-sm",children:[a[1].xp," XP"]})]}),a[0]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-amber-500 bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white text-3xl font-bold",children:a[0].name?.[0]}),e.jsx("div",{className:"absolute -top-2 -right-2 text-5xl",children:"ü•á"})]}),e.jsx("div",{className:"font-bold text-lg",children:a[0].name}),e.jsxs("div",{children:[a[0].xp," XP"]})]}),a[2]&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-orange-600 bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white text-2xl font-bold",children:a[2].name?.[0]}),e.jsx("div",{className:"absolute -top-2 -right-2 text-4xl",children:"ü•â"})]}),e.jsx("div",{className:"font-bold",children:a[2].name}),e.jsxs("div",{className:"text-sm",children:[a[2].xp," XP"]})]})]})]}),e.jsx(q,{columns:P,data:d.slice(3)})]}):e.jsx(E,{icon:j,title:"Nenhum aluno no ranking",description:"Os alunos aparecer√£o aqui conforme ganharem XP."})]})};export{Ne as default};
