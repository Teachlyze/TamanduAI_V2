import{s as h,a as ne,r as C,j as e,k as oe}from"./main-XRKQFEIr.js";import{C as F}from"./card-BEk2G2Us.js";import{A as ie,B as X}from"./SidebarPremium-BnsbfpCV.js";import{m as L,B as ce}from"./button-D4bIZ4Ty.js";import{P as le}from"./progress-DG81sUzt.js";import{S as Q}from"./StatsCard-D5ZQ3-Yq.js";import"./DashboardHeader-B78p6TYW.js";import"./input-BrWaMOrb.js";import"./dropdown-menu-DyRCHyY4.js";import"./label-_ADcUmGf.js";import{t as R}from"./use-toast-Cv69gxoh.js";import{T as K}from"./target--MqGdgEh.js";import{B as Z}from"./book-open-CAn3t7Hm.js";import{C as de}from"./chart-column-CBFsA3dh.js";import{T as me}from"./trending-up-eowzUgXK.js";import{ag as ue,ai as ge,aj as he,ak as pe,ah as fe}from"./CartesianChart-BGYHTDL6.js";import{L as xe,a as be}from"./LineChart-Buw_N2M_.js";import{U as ve}from"./users-DP4-CTtE.js";import{L as ye}from"./lightbulb-C7rSVv4-.js";import{T as je}from"./triangle-alert-Bz2ASMAl.js";import{T as we}from"./trending-down-ByV-8oYS.js";import{T as _e}from"./trophy-CtQl7iED.js";import{S as W}from"./sparkles-pthiUTeM.js";import"./bell-v36tl0On.js";import"./user-CCHLYTsx.js";import"./file-text-tq0U235S.js";import"./settings-pQ42cErW.js";import"./graduation-cap-CRbvieNe.js";import"./index-e3XtT_BD.js";import"./x-BPPDjH10.js";import"./index-ysAnX8Hi.js";import"./chevron-right-C-DpTlMS.js";import"./Combination-TYhCc4jv.js";import"./index-B_kCUa_t.js";import"./check-Cifhij8e.js";import"./index-BdXTtqAV.js";const Ne=async(o,a)=>{try{const{data:n,error:s}=await h.from("submissions").select(`
        grade,
        submitted_at,
        activities!inner(class_id)
      `).eq("student_id",o).eq("activities.class_id",a).not("grade","is",null).order("submitted_at",{ascending:!0});if(s)throw s;if(!n||n.length<3)return{prediction:null,confidence:0,trend:"insufficient_data",message:"M√≠nimo 3 atividades necess√°rias"};const t=n.map(b=>parseFloat(b.grade)),r=t.length,i=t.slice(-5),d=i.reduce((b,S)=>b+S,0)/i.length,g=t.reduce((b,S)=>b+S,0)/r,u=d>g+5?"improving":d<g-5?"declining":"stable",x=[.1,.15,.2,.25,.3];let G=0;const p=t.slice(-5);for(let b=0;b<p.length;b++)G+=p[b]*(x[b]||.2);const f=t.reduce((b,S)=>b+Math.pow(S-g,2),0)/r,A=Math.sqrt(f),_=Math.max(0,Math.min(100,100-A*2));return{prediction:Math.round(G*10)/10,confidence:Math.round(_),trend:u,avgRecent:Math.round(d*10)/10,avgTotal:Math.round(g*10)/10,totalSubmissions:r,message:u==="improving"?"Aluno em evolu√ß√£o!":u==="declining"?"Aten√ß√£o: queda de desempenho":"Desempenho est√°vel"}}catch(n){return console.error("Erro ao prever desempenho:",n),null}},Se=async o=>{try{const{data:a,error:n}=await h.from("class_members").select(`
        user_id,
        role,
        profiles:user_id(full_name, email)
      `).eq("class_id",o).eq("role","student");if(n)throw n;const s=[];for(const t of a){const{data:r}=await h.from("submissions").select("grade, submitted_at, status").eq("student_id",t.user_id).order("submitted_at",{ascending:!1}).limit(10);if(!r||r.length===0)continue;const i=r.filter(_=>_.grade!==null).map(_=>parseFloat(_.grade));if(i.length===0)continue;const d=i.reduce((_,b)=>_+b,0)/i.length,g=i.slice(0,3),u=g.reduce((_,b)=>_+b,0)/g.length,x=d<60,G=u<d-10,p=Math.max(...i)-Math.min(...i)>40;let f=0;const A=[];x&&(f+=3,A.push("M√©dia baixa")),G&&(f+=2,A.push("Queda recente")),p&&(f+=1,A.push("Inconsistente")),f>0&&s.push({studentId:t.user_id,name:t.profiles?.full_name,email:t.profiles?.email,avgGrade:Math.round(d*10)/10,avgRecent:Math.round(u*10)/10,riskLevel:f>=4?"high":f>=2?"medium":"low",reasons:A,totalSubmissions:r.length})}return s.sort((t,r)=>{const i={high:3,medium:2,low:1};return i[r.riskLevel]-i[t.riskLevel]})}catch(a){return console.error("Erro ao identificar alunos em risco:",a),[]}},Ae=async o=>{try{const{data:a}=await h.from("class_members").select(`
        student_id,
        profiles!inner(full_name)
      `).eq("class_id",o);if(!a||a.length<3)return{clusters:[],message:"M√≠nimo 3 alunos necess√°rios"};const n=[];for(const t of a){const{data:r}=await h.from("submissions").select("grade, submitted_at").eq("student_id",t.student_id).not("grade","is",null);if(!r||r.length===0)continue;const i=r.map(u=>parseFloat(u.grade)),d=i.reduce((u,x)=>u+x,0)/i.length,g=i.reduce((u,x)=>u+Math.pow(x-d,2),0)/i.length;n.push({studentId:t.student_id,name:t.profiles.full_name,avgGrade:d,consistency:100-Math.sqrt(g),totalSubmissions:r.length})}const s={excelente:n.filter(t=>t.avgGrade>=85),bom:n.filter(t=>t.avgGrade>=70&&t.avgGrade<85),regular:n.filter(t=>t.avgGrade>=60&&t.avgGrade<70),atencao:n.filter(t=>t.avgGrade<60)};return{clusters:[{name:"Excelente",color:"green",students:s.excelente,avgGrade:s.excelente.length>0?Math.round(s.excelente.reduce((t,r)=>t+r.avgGrade,0)/s.excelente.length*10)/10:0,count:s.excelente.length},{name:"Bom",color:"blue",students:s.bom,avgGrade:s.bom.length>0?Math.round(s.bom.reduce((t,r)=>t+r.avgGrade,0)/s.bom.length*10)/10:0,count:s.bom.length},{name:"Regular",color:"yellow",students:s.regular,avgGrade:s.regular.length>0?Math.round(s.regular.reduce((t,r)=>t+r.avgGrade,0)/s.regular.length*10)/10:0,count:s.regular.length},{name:"Aten√ß√£o",color:"red",students:s.atencao,avgGrade:s.atencao.length>0?Math.round(s.atencao.reduce((t,r)=>t+r.avgGrade,0)/s.atencao.length*10)/10:0,count:s.atencao.length}],totalStudents:n.length}}catch(a){return console.error("Erro ao clusterizar alunos:",a),{clusters:[],message:"Erro ao processar"}}},ke=o=>{if(!o)return{score:0,label:"neutral"};const a=o.toLowerCase(),n=["ruim","dif√≠cil","complicado","confuso","p√©ssimo","horr√≠vel","n√£o entendi","muito dif√≠cil","imposs√≠vel","frustrado"],s=["bom","√≥timo","excelente","legal","entendi","f√°cil","claro","adorei","perfeito","incr√≠vel"];let t=0;return n.forEach(r=>{a.includes(r)&&(t-=1)}),s.forEach(r=>{a.includes(r)&&(t+=1)}),{score:t,label:t<-1?"negative":t>1?"positive":"neutral",needsAttention:t<-1}},Ge=async(o,a)=>{try{const{data:n}=await h.from("submissions").select(`
        grade,
        activities!inner(
          title,
          activity_type,
          class_id
        )
      `).eq("student_id",o).eq("activities.class_id",a).not("grade","is",null);if(!n||n.length<3)return{recommendations:[],message:"Mais atividades necess√°rias para recomenda√ß√µes"};const s=n.filter(i=>parseFloat(i.grade)<70).map(i=>i.activities),t=[];return s.length>0&&t.push({type:"review",priority:"high",title:"Revis√£o Necess√°ria",description:`Revisar conceitos de ${s.length} atividade(s) com baixo desempenho`,activities:s.slice(0,3)}),n.filter(i=>i.activities.activity_type==="quiz").length<3&&t.push({type:"practice",priority:"medium",title:"Pr√°tica com Quizzes",description:"Fazer mais quizzes para fixar conte√∫do",suggestion:"Banco de Quest√µes dispon√≠vel"}),{recommendations:t,totalAnalyzed:n.length,weakAreas:s.length}}catch(n){return console.error("Erro ao gerar recomenda√ß√µes:",n),{recommendations:[],message:"Erro ao processar"}}},Ce=async o=>{try{const{data:a}=await h.from("class_members").select(`
        student_id,
        joined_at,
        profiles!inner(full_name, email)
      `).eq("class_id",o);if(!a)return[];const n=[],s=new Date;for(const t of a){const{data:r}=await h.from("submissions").select("submitted_at").eq("student_id",t.student_id).order("submitted_at",{ascending:!1}).limit(1).single();if(!r){n.push({studentId:t.student_id,name:t.profiles.full_name,email:t.profiles.email,riskLevel:"high",reason:"Nenhuma atividade realizada",daysSinceActivity:Math.floor((s-new Date(t.joined_at))/(1e3*60*60*24))});continue}const i=Math.floor((s-new Date(r.submitted_at))/(1e3*60*60*24));i>14&&n.push({studentId:t.student_id,name:t.profiles.full_name,email:t.profiles.email,riskLevel:i>30?"high":"medium",reason:`${i} dias sem atividade`,daysSinceActivity:i})}return n.sort((t,r)=>r.daysSinceActivity-t.daysSinceActivity)}catch(a){return console.error("Erro ao prever churn:",a),[]}},Y=async o=>{try{const{data:a}=await h.from("submissions").select(`
        grade,
        submitted_at,
        student_id,
        activities!inner(class_id, activity_type)
      `).eq("activities.class_id",o).not("grade","is",null);if(!a||a.length===0)return null;const{data:n}=await h.from("xp_log").select("amount, source, student_id, created_at").in("student_id",[...new Set(a.map(l=>l.student_id))]),s=a.map(l=>parseFloat(l.grade)),t=s.reduce((l,v)=>l+v,0)/s.length,r=s.reduce((l,v)=>l+Math.pow(v-t,2),0)/s.length,i=Math.sqrt(r),d=n?.reduce((l,v)=>l+v.amount,0)||0,g={};n?.forEach(l=>{g[l.source]=(g[l.source]||0)+l.amount});const u=new Date,x=new Date(u.getTime()-672*60*60*1e3),p=a.filter(l=>new Date(l.submitted_at)>x).map(l=>parseFloat(l.grade)),f=p.length>0?p.reduce((l,v)=>l+v,0)/p.length:t,A=f>t+3?"improving":f<t-3?"declining":"stable",_=Math.min(5,d/1e3),b=t*.9+_*.1,S={"0-49":0,"50-69":0,"70-84":0,"85-100":0};s.forEach(l=>{const v=Math.round(l);v<=49?S["0-49"]++:v<=69?S["50-69"]++:v<=84?S["70-84"]++:S["85-100"]++});const O=a.slice().sort((l,v)=>new Date(l.submitted_at)-new Date(v.submitted_at));let E=0,z=0;for(let l=1;l<O.length;l++){const v=(new Date(O[l].submitted_at)-new Date(O[l-1].submitted_at))/864e5;isFinite(v)&&v>=0&&(E+=v,z++)}const $=z>0?Math.round(E/z*10)/10:null,I={};a.forEach(l=>{I[l.student_id]=(I[l.student_id]||0)+1});const V=Object.keys(I).length>0?Math.round(Object.values(I).reduce((l,v)=>l+v,0)/Object.keys(I).length*10)/10:0;return{avgGrade:Math.round(t*10)/10,adjustedAvg:Math.round(b*10)/10,stdDev:Math.round(i*10)/10,trend:A,totalSubmissions:a.length,totalStudents:new Set(a.map(l=>l.student_id)).size,totalXP:d,xpSources:g,gradeBuckets:S,avgDaysBetweenSubmissions:$,submissionsPerStudentAvg:V,consistency:i<15?"high":i<25?"medium":"low",engagement:d>5e3?"high":d>2e3?"medium":"low"}}catch(a){return console.error("Erro ao analisar turma:",a),null}},ee=async o=>{try{const{data:a}=await h.from("classes").select("id, name").eq("created_by",o);if(!a||a.length===0)return null;const n=[];let s=0,t=0,r=0,i=0,d=0;for(const u of a){const x=await Y(u.id);x&&(n.push({classId:u.id,className:u.name,...x}),s+=x.totalStudents,r+=x.totalSubmissions,i+=x.totalXP,d+=x.avgGrade);const{count:G}=await h.from("activities").select("*",{count:"exact",head:!0}).eq("class_id",u.id);t+=G||0}const g=n.length>0?d/n.length:0;return{teacherId:o,totalClasses:a.length,totalStudents:s,totalActivities:t,totalSubmissions:r,totalXP:i,avgGrade:Math.round(g*10)/10,classAnalyses:n,engagementScore:i/s||0,activityRate:t/a.length||0}}catch(a){return console.error("Erro ao analisar professor:",a),null}},Te=async o=>{try{const{data:a}=await h.from("school_teachers").select("user_id, status").eq("school_id",o).eq("status","active");if(!a||a.length===0)return[];const n=a.map(t=>t.user_id),s=[];for(const t of n){const{data:r}=await h.from("profiles").select("name").eq("id",t).single(),i=await ee(t);i&&r&&s.push({teacherId:t,name:r.name,...i})}return s.sort((t,r)=>r.avgGrade-t.avgGrade)}catch(a){return console.error("Erro ao comparar professores:",a),[]}},Me=async o=>{try{const{data:a}=await h.from("school_classes").select("class_id").eq("school_id",o),n=(a||[]).map(d=>d.class_id);if(!n||n.length===0)return[];const{data:s}=await h.from("classes").select("id, name, created_by").in("id",n),t=[...new Set((s||[]).map(d=>d.created_by).filter(Boolean))];let r={};if(t.length>0){const{data:d}=await h.from("profiles").select("id, name").in("id",t);r=(d||[]).reduce((g,u)=>(g[u.id]=u.name,g),{})}const i=[];for(const d of s||[]){const g=await Y(d.id);g&&i.push({classId:d.id,className:d.name,teacherName:r[d.created_by]||"Professor",...g})}return i.sort((d,g)=>g.avgGrade-d.avgGrade)}catch(a){return console.error("Erro ao comparar turmas:",a),[]}},qe=async(o,a="student")=>{try{const{data:{user:n}}=await h.auth.getUser();if(!n)throw new Error("N√£o autenticado");let s="";if(a==="student")s=`Analise este aluno e forne√ßa insights educacionais:
      
Dados:
- M√©dia: ${o.avgGrade}
- Tend√™ncia: ${o.trend}
- Total XP: ${o.totalXP||0}
- Submiss√µes: ${o.totalSubmissions}
- Consist√™ncia: ${o.consistency||"N/A"}
 - Observa√ß√£o: XP tem peso menor (10%) em an√°lises de desempenho.

Forne√ßa em JSON:
{
  "strengths": ["for√ßa 1", "for√ßa 2"],
  "weaknesses": ["fraqueza 1", "fraqueza 2"],
  "recommendations": ["recomenda√ß√£o 1", "recomenda√ß√£o 2"],
  "motivationalMessage": "mensagem motivacional"
}`;else if(a==="class")s=`Analise esta turma e forne√ßa insights educacionais:
      
Dados:
- M√©dia: ${o.avgGrade}
- Desvio Padr√£o: ${o.stdDev}
- Tend√™ncia: ${o.trend}
- Total XP: ${o.totalXP}
- Alunos: ${o.totalStudents}
- Engajamento: ${o.engagement}
 - Fontes de XP (top 5): ${JSON.stringify(o.xpSources||{})}
 - Observa√ß√£o: XP tem peso reduzido (10%) para m√©dia ajustada.
 - Distribui√ß√£o de notas: ${JSON.stringify(o.gradeBuckets||{})}
 - Dias m√©dios entre submiss√µes: ${o.avgDaysBetweenSubmissions??"N/D"}
 - Submiss√µes por aluno (m√©dia): ${o.submissionsPerStudentAvg??"N/D"}

Forne√ßa em JSON:
{
  "strengths": ["for√ßa 1", "for√ßa 2"],
  "concerns": ["preocupa√ß√£o 1", "preocupa√ß√£o 2"],
  "recommendations": ["recomenda√ß√£o 1", "recomenda√ß√£o 2"],
  "teachingTips": ["dica 1", "dica 2"]
}`;else if(a==="teacher"){const d=o.totalClasses??(o.classAnalyses?.length||0),g=(o.classAnalyses||[]).reduce((p,f)=>(p[f.trend||"stable"]=(p[f.trend||"stable"]||0)+1,p),{}),u=(o.classAnalyses||[]).slice().sort((p,f)=>(f.avgGrade||0)-(p.avgGrade||0))[0]||null,x=(o.classAnalyses||[]).slice().sort((p,f)=>(p.avgGrade||0)-(f.avgGrade||0))[0]||null,G=(o.classAnalyses||[]).reduce((p,f)=>{const A=f.xpSources||{};return Object.keys(A).forEach(_=>{p[_]=(p[_]||0)+A[_]}),p},{});s=`Analise este professor e forne√ßa insights:
      
Dados:
- Turmas: ${o.totalClasses}
- Alunos: ${o.totalStudents}
- M√©dia Geral: ${o.avgGrade}
- Total XP gerado: ${o.totalXP}
- Taxa de atividades: ${o.activityRate}
 - Tend√™ncias por turma: ${JSON.stringify(g)}
 - Turma com melhor desempenho: ${u?`${u.className} (m√©dia ${u.avgGrade}, engajamento ${u.engagement})`:"N/D"}
 - Turma com pior desempenho: ${x?`${x.className} (m√©dia ${x.avgGrade}, engajamento ${x.engagement})`:"N/D"}
 - Fontes de XP agregadas (top 5): ${JSON.stringify(Object.fromEntries(Object.entries(G).sort((p,f)=>f[1]-p[1]).slice(0,5)))}
 - Observa√ß√£o: XP influencia apenas 10% da m√©dia ajustada.

Forne√ßa em JSON:
{
  "strengths": ["for√ßa 1", "for√ßa 2"],
  "improvements": ["melhoria 1", "melhoria 2"],
  "recommendations": ["recomenda√ß√£o 1", "recomenda√ß√£o 2"],
  "recognition": "mensagem de reconhecimento"
}`}const{data:t,error:r}=await h.functions.invoke("openai-chat",{body:{messages:[{role:"system",content:"Voc√™ √© um especialista em an√°lise educacional. Responda APENAS em JSON v√°lido."},{role:"user",content:s}],temperature:.7}});if(r)throw r;const i=t.choices?.[0]?.message?.content||"{}";return JSON.parse(i)}catch(n){return console.error("Erro ao gerar insights AI:",n),null}},Ee=async o=>{try{const{data:a}=await h.from("submissions").select("grade, activity:activities(title, type)").eq("student_id",o).not("grade","is",null).order("submitted_at",{ascending:!1}).limit(10);if(!a||a.length===0)return[];const n=a.reduce((t,r)=>t+r.grade,0)/a.length,s=[];return n<6?(s.push({text:"Revise os conceitos fundamentais da disciplina",icon:"BookOpen"}),s.push({text:"Procure ajuda do professor ou monitoria",icon:"Users"})):n<7.5?(s.push({text:"Pratique mais exerc√≠cios para fixar o conte√∫do",icon:"Target"}),s.push({text:"Fa√ßa resumos dos t√≥picos principais",icon:"FileText"})):(s.push({text:"Continue seu excelente trabalho!",icon:"Trophy"}),s.push({text:"Ajude colegas que t√™m dificuldades",icon:"Users"})),s}catch(a){return console.error("Erro ao obter sugest√µes:",a),[{text:"Continue praticando regularmente",icon:"Target"},{text:"Revise conceitos fundamentais",icon:"BookOpen"}]}},$e=async o=>{try{const{data:a}=await h.from("submissions").select(`
        grade,
        activity:activities(
          title,
          activity_class_assignments(
            class:classes(name, subject)
          )
        )
      `).eq("student_id",o).not("grade","is",null);if(!a||a.length===0)return[];const n={};a.forEach(t=>{const r=t.activity?.activity_class_assignments?.[0]?.class?.subject||"Geral";n[r]||(n[r]=[]),n[r].push(t.grade)});const s=[];return Object.entries(n).forEach(([t,r])=>{const i=r.reduce((d,g)=>d+g,0)/r.length;i<7&&s.push({subject:t,title:t,description:`M√©dia atual: ${i.toFixed(1)}. Foque mais nesta disciplina.`,avgGrade:i})}),s}catch(a){return console.error("Erro ao identificar √°reas de aten√ß√£o:",a),[]}},H={predictPerformance:Ne,identifyAtRiskStudents:Se,clusterStudents:Ae,analyzeSentiment:ke,generateRecommendations:Ge,predictChurn:Ce,analyzeClassPerformance:Y,analyzeTeacherPerformance:ee,compareTeachers:Te,compareClasses:Me,generateAIInsights:qe,getStudentGradeBuckets:Ie,getStudySuggestions:Ee,getAttentionAreas:$e};async function Ie(o,a){try{const{data:n,error:s}=await h.from("submissions").select("grade, activities!inner(class_id)").eq("student_id",o).eq("activities.class_id",a).not("grade","is",null);if(s)throw s;const t={"0-49":0,"50-69":0,"70-84":0,"85-100":0};return(n||[]).forEach(r=>{const i=Math.round(parseFloat(r.grade));i<=49?t["0-49"]++:i<=69?t["50-69"]++:i<=84?t["70-84"]++:t["85-100"]++}),t}catch(n){return console.error("Erro ao calcular buckets do aluno:",n),{"0-49":0,"50-69":0,"70-84":0,"85-100":0}}}const bt=()=>{const{user:o}=ne(),[a,n]=C.useState(!0),[s,t]=C.useState(!1),[r,i]=C.useState({avgGrade:0,totalActivities:0,completionRate:0}),[d,g]=C.useState([]),[u,x]=C.useState([]),[G,p]=C.useState([]),[f,A]=C.useState([]),[_,b]=C.useState([]),[S,O]=C.useState(null),[E,z]=C.useState(0),[$]=C.useState(3);C.useEffect(()=>{o?.id?(I(),l()):n(!1)},[o]);const I=async()=>{if(!o?.id){n(!1);return}try{n(!0);const{data:c}=await h.from("submissions").select(`
          grade,
          submitted_at,
          graded_at,
          activity:activities(
            id,
            title,
            max_score,
            activity_class_assignments(
              class_id,
              class:classes(id, name, subject)
            )
          )
        `).eq("student_id",o.id).order("submitted_at",{ascending:!0}),m=c?.filter(j=>j.grade!==null)||[],T=m.length>0?m.reduce((j,k)=>j+k.grade,0)/m.length:0;i({avgGrade:T.toFixed(1),totalActivities:c?.length||0,completionRate:85});const w=m.slice(-10).map((j,k)=>({name:`A${k+1}`,nota:Number(j.grade.toFixed(1)),date:j.submitted_at}));g(w),await V(c),O(c)}catch(c){console.error("Erro:",c)}finally{n(!1)}},V=async c=>{try{const m={};c.forEach(w=>{const j=w.activity?.activity_class_assignments?.[0]?.class;j&&(m[j.id]||(m[j.id]={classId:j.id,className:j.name,subject:j.subject,studentGrades:[],activityIds:[]}),m[j.id].studentGrades.push(w.grade),m[j.id].activityIds.push(w.activity.id))});const T=await Promise.all(Object.values(m).map(async w=>{const{data:j}=await h.from("submissions").select("grade, activity_id").in("activity_id",w.activityIds).not("grade","is",null),k=j?.map(y=>y.grade)||[],M=k.length>0?k.reduce((y,q)=>y+q,0)/k.length:0,B=w.studentGrades.reduce((y,q)=>y+q,0)/w.studentGrades.length;return{className:w.className,subject:w.subject,studentAvg:Number(B.toFixed(1)),classAvg:Number(M.toFixed(1)),difference:Number((B-M).toFixed(1))}}));x(T)}catch(m){console.error("Erro ao calcular compara√ß√£o:",m)}},l=async()=>{try{const c=await H.getStudySuggestions(o.id),m=await H.getAttentionAreas(o.id);p(c||[]),A(m||[])}catch(c){console.error("Analytics ML n√£o dispon√≠vel:",c),p([{text:"Continue praticando regularmente",icon:K},{text:"Revise conceitos fundamentais",icon:Z}])}},v=c=>{const m=[];if(c.avgGrade<60?m.push({title:"üìö Refor√ßo nos Estudos",description:"Sua m√©dia est√° abaixo do esperado. Dedique mais tempo aos estudos di√°rios.",reason:"M√©dia atual abaixo de 60%",priority:"high"}):c.avgGrade<75?m.push({title:"üìà Continue Progredindo",description:"Voc√™ est√° no caminho certo! Mantenha a consist√™ncia nos estudos.",reason:"Desempenho moderado",priority:"medium"}):m.push({title:"‚≠ê Excelente Desempenho",description:"Continue assim! Considere ajudar colegas com dificuldades.",reason:"M√©dia acima de 75%",priority:"low"}),c.classComparison&&c.classComparison.length>0){const T=c.classComparison.filter(w=>w.studentAvg<w.classAvg);T.length>0&&m.push({title:"üéØ Focar em Mat√©rias Espec√≠ficas",description:`Concentre-se em melhorar em: ${T.map(w=>w.subject).join(", ")}`,reason:"Abaixo da m√©dia da turma",priority:"high"})}return m.push({title:"‚è∞ Organize seu Tempo",description:"Crie um cronograma de estudos e reserve hor√°rios fixos para cada mat√©ria.",reason:"Boa pr√°tica de estudo",priority:"medium"}),m},te=async()=>{if(!S||S.length===0){R({title:"Sem dados suficientes",description:"Complete mais atividades para receber recomenda√ß√µes personalizadas.",variant:"destructive"});return}try{t(!0);const{data:c}=await h.from("submissions").select(`
          id,
          grade,
          submitted_at,
          activity:activities(
            id,
            title,
            max_score,
            content,
            activity_class_assignments(
              class:classes(subject)
            )
          ),
          answers(
            question_id,
            answer_json,
            points_earned
          )
        `).eq("student_id",o.id).not("grade","is",null).order("submitted_at",{ascending:!1}).limit(5);console.log("üîç Total de Submissions encontradas:",c?.length),console.log("üîç Detailed Submissions:",JSON.stringify(c,null,2));const m=(c||[]).map((y,q)=>{const N=y.activity,se=N?.activity_class_assignments?.[0]?.class?.subject||"Geral";console.log(`
üìù Activity ${q+1}/${c.length}:`,{title:N?.title,grade:y.grade,hasContent:!!N?.content,contentKeys:N?.content?Object.keys(N.content):[],questionsCount:Array.isArray(N?.content?.questions)?N.content.questions.length:0,questions:N?.content?.questions,answersCount:y.answers?.length||0,answers:y.answers});const U=[];return N?.content?.questions&&Array.isArray(N.content.questions)&&N.content.questions.forEach((D,ae)=>{const P=y.answers?.find(J=>J.question_id===D.id||J.question_id===`question_${ae}`);if(P){const J=typeof P.answer_json=="string"?P.answer_json:P.answer_json?.answer||P.answer_json?.text||"N√£o respondeu",re=D.correctAnswer||D.correct_answer||D.answer;U.push({question:D.text||D.question||D.title||"Quest√£o sem texto",studentAnswer:J,correctAnswer:re,isCorrect:(P.points_earned||0)>0})}}),{grade:y.grade,maxScore:N?.max_score||100,subject:se,activityTitle:N?.title,questions:U.length>0?U:void 0}}),T={avgGrade:r.avgGrade,totalActivities:r.totalActivities,recentGrades:m,classComparison:u.map(y=>({subject:y.subject,studentAvg:y.studentAvg,classAvg:y.classAvg}))};console.log("üìä Performance Summary:",JSON.stringify(T,null,2)),console.log("‚ùì Total de quest√µes encontradas:",m.reduce((y,q)=>y+(q.questions?.length||0),0));const{data:{session:w},error:j}=await h.auth.getSession();if(j)throw console.error("Erro ao obter sess√£o:",j),new Error("Erro de autentica√ß√£o");console.log("Session token:",w?.access_token?"Token presente":"Token ausente");const k=await fetch("https://wapbwaimkurbuihatmix.supabase.co/functions/v1/ai-study-recommendations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w?.access_token||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhcGJ3YWlta3VyYnVpaGF0bWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyODY3MjksImV4cCI6MjA3NDg2MjcyOX0.x-NQQ2TtRgaUjjBZCf6j49eWOW4XSqjTFKC_KB1L56A"}`},body:JSON.stringify({studentId:o.id,performanceData:T})});if(!k.ok){const y=await k.text();if(console.error("Erro da API:",k.status,y),k.status===429){try{const N=JSON.parse(y);R({title:"‚è∞ Limite di√°rio atingido",description:`${N.message||"Voc√™ j√° gerou 3 recomenda√ß√µes hoje. Volte amanh√£!"}`,variant:"destructive",duration:5e3})}catch{R({title:"‚è∞ Limite di√°rio atingido",description:"Voc√™ j√° gerou 3 recomenda√ß√µes hoje. Volte amanh√£!",variant:"destructive",duration:5e3})}return}const q=v(T);b(q),R({title:"Recomenda√ß√µes geradas localmente",description:"Usando an√°lise b√°sica. Configure a API OpenAI para recomenda√ß√µes avan√ßadas."});return}const M=await k.json();b(M.recommendations||[]),M.usageToday&&z(M.usageToday);const B=M.usageToday&&M.dailyLimit?` (${M.usageToday}/${M.dailyLimit} hoje)`:"";R({title:"‚úÖ Recomenda√ß√µes atualizadas!",description:`Confira suas sugest√µes personalizadas de estudo${B}.`})}catch(c){console.error("Erro ao carregar recomenda√ß√µes:",c),R({title:"Erro ao carregar recomenda√ß√µes",description:"Tente novamente mais tarde.",variant:"destructive"})}finally{t(!1)}};return a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-slate-200 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Meu Desempenho"}),e.jsx("p",{className:"text-cyan-100",children:"An√°lise completa com IA e compara√ß√£o com a turma"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(Q,{title:"M√©dia Geral",value:r.avgGrade,icon:de,gradient:"from-blue-500 to-cyan-600",delay:0}),e.jsx(Q,{title:"Atividades Conclu√≠das",value:r.totalActivities,icon:ie,gradient:"from-cyan-500 to-blue-700",delay:.1}),e.jsx(Q,{title:"Taxa de Conclus√£o",value:`${r.completionRate}%`,icon:me,gradient:"from-emerald-500 to-cyan-500",format:"text",delay:.2})]}),e.jsxs(F,{className:"p-6 bg-white dark:bg-slate-900 mb-6 border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-900 dark:text-white",children:"Evolu√ß√£o de Notas"}),e.jsx(ue,{width:"100%",height:300,children:e.jsxs(xe,{data:d,children:[e.jsx(ge,{strokeDasharray:"3 3"}),e.jsx(he,{dataKey:"name"}),e.jsx(pe,{domain:[0,10]}),e.jsx(fe,{}),e.jsx(be,{type:"monotone",dataKey:"nota",stroke:"#3B82F6",strokeWidth:2})]})})]}),u.length>0&&e.jsxs(F,{className:"p-6 bg-white dark:bg-slate-900 mb-6 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Compara√ß√£o com a Turma"})]}),e.jsx(X,{variant:"secondary",className:"text-xs",children:"Dados an√¥nimos"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Veja como voc√™ est√° em rela√ß√£o √† m√©dia da turma"}),e.jsx("div",{className:"space-y-4",children:u.map((c,m)=>e.jsxs(L.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:m*.1},className:"p-4 rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white",children:c.className}),e.jsx("p",{className:"text-xs text-slate-500",children:c.subject})]}),e.jsxs(X,{className:c.difference>0?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300":c.difference<0?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":"bg-slate-100 text-slate-700",children:[c.difference>0?"+":"",c.difference]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Sua m√©dia"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.studentAvg})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"M√©dia da turma"}),e.jsx("p",{className:"text-2xl font-bold text-slate-600 dark:text-slate-400",children:c.classAvg})]})]}),e.jsx(le,{value:c.studentAvg/10*100,className:"h-2 mt-3"})]},m))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(F,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Sugest√µes de Estudo"})]}),G.length>0?e.jsx("div",{className:"space-y-3",children:G.map((c,m)=>e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:m*.1},className:"flex items-start gap-3 p-3 bg-white dark:bg-slate-900 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40",children:e.jsx(K,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:c.text||c})})]},m))}):e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Complete mais atividades para receber sugest√µes personalizadas."})]}),e.jsxs(F,{className:"p-6 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-950/20 dark:to-orange-950/20 border border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"√Åreas de Aten√ß√£o"})]}),f.length>0?e.jsx("div",{className:"space-y-3",children:f.map((c,m)=>e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:m*.1},className:"flex items-start gap-3 p-3 bg-white dark:bg-slate-900 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900/40",children:e.jsx(we,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white",children:c.subject||c.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:c.description||c.text})]})]},m))}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(_e,{className:"w-12 h-12 mx-auto mb-2 text-yellow-600"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Excelente! N√£o h√° √°reas cr√≠ticas no momento."})]})]})]}),e.jsxs(F,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Recomenda√ß√µes Personalizadas com IA"}),e.jsxs(X,{variant:E>=$?"destructive":"secondary",className:"text-xs",children:[E,"/",$," hoje"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(ce,{onClick:te,disabled:s||E>=$,size:"sm",className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Gerando..."]}):E>=$?e.jsx(e.Fragment,{children:"‚è∞ Limite Atingido"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Gerar Recomenda√ß√µes"]})}),E>=$&&e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Reinicia √† meia-noite"})]})]}),_.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:_.map((c,m)=>e.jsx(L.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:m*.1},className:"p-4 bg-white dark:bg-slate-900 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40 flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm text-slate-900 dark:text-white mb-1",children:c.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:c.description}),c.reason&&e.jsx(X,{variant:"outline",className:"mt-2 text-xs",children:c.reason})]})]})},m))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-16 h-16 mx-auto mb-4 text-blue-400 opacity-50"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Clique no bot√£o acima para gerar recomenda√ß√µes personalizadas baseadas no seu desempenho."}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:"A IA analisar√° suas notas, compara com a turma e sugere materiais de estudo ideais para voc√™."})]})]})]})};export{bt as default};
