import{j as e,a as X,u as Y,r as d,s as c,l as Z,p as I}from"./main-Bl3iyOV8.js";import{C as ee}from"./card-SNqEFOp2.js";import{m as u,B as D}from"./button-DpOjBXor.js";import{e as L}from"./SidebarPremium-PssxZ1ou.js";import{B as h}from"./chevron-right-DU2dW0WM.js";import{U as te}from"./users-CoDMpyo4.js";import{F as ae}from"./index-CYK-_QUl.js";import{E as se}from"./EmptyState-DGamXeZ0.js";import"./dialog-C-DIWS3k.js";import{I as re}from"./input-Pzsue5kv.js";import{T as ie,a as ne,b as g}from"./tabs-96oYwlfD.js";import{S as T}from"./search-CUqb9FZE.js";import{G as le}from"./grid-3x3-CLRFCVA4.js";import{L as de}from"./list-CP3dAnSg.js";import{S as q}from"./star-C4iDH66r.js";import"./bell-BfdEdLeq.js";import"./trending-up-8L-hnT0i.js";import"./user-DM7mQE01.js";import"./settings-BAxhic8T.js";import"./house--MZ6Jz5W.js";import"./graduation-cap-D52WS1is.js";import"./index-Bb4h7Ki9.js";import"./chart-column-C0EgfbtL.js";import"./x-f7wZy2q2.js";import"./index-DZVOjynP.js";import"./index-5Sg1WP5m.js";import"./index-PwNWXBBP.js";import"./index-B53WU1tR.js";const oe=({classItem:a,onClick:p,index:v=0})=>{const m={blue:"from-blue-600 to-cyan-500",green:"from-green-600 to-emerald-500",purple:"from-purple-600 to-pink-500",orange:"from-orange-600 to-amber-500",red:"from-red-600 to-rose-500",yellow:"from-yellow-600 to-orange-500",pink:"from-pink-600 to-rose-500",indigo:"from-indigo-600 to-purple-500",cyan:"from-cyan-600 to-blue-500",teal:"from-teal-600 to-green-500"},l=m[a.color]||m.blue;return e.jsx(u.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:v*.1,type:"spring"},whileHover:{scale:1.05,y:-8},onClick:p,className:"cursor-pointer",children:e.jsxs(ee,{className:"overflow-hidden border-2 border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 hover:shadow-2xl transition-all",children:[e.jsxs("div",{className:`h-32 bg-gradient-to-br ${l} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute -right-8 -bottom-8 opacity-20",children:e.jsx(h,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(L,{className:"mb-2 bg-white/20 text-white border-white/30 backdrop-blur-sm",children:a.subject||"MatÃ©ria"}),e.jsx("h3",{className:"text-xl font-bold line-clamp-2",children:a.name})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:a.teacher_name||"Professor"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a.pendingActivities||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:a.avgGrade!==null&&a.avgGrade!==void 0?a.avgGrade.toFixed(1):"--"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"MÃ©dia"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:a.studentsCount||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Alunos"})]})]}),a.newActivities>0&&e.jsx(u.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3},children:e.jsxs(L,{className:"w-full justify-center py-2 bg-orange-100 text-orange-700 dark:bg-orange-900/40 dark:text-orange-300 border-orange-300 dark:border-orange-700",children:["ðŸ”” ",a.newActivities," nova",a.newActivities>1?"s":""," atividade",a.newActivities>1?"s":""]})}),a.nextDeadline&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),"PrÃ³ximo prazo: ",a.nextDeadline]})]})]})})},Fe=()=>{const{user:a}=X(),p=Y(),[v,m]=d.useState(!0),[l,w]=d.useState([]),[y,E]=d.useState([]),[o,M]=d.useState(""),[f,_]=d.useState("grid"),[b,P]=d.useState("name");d.useEffect(()=>{a?.id&&z()},[a]),d.useEffect(()=>{F()},[l,o,b]);const z=async()=>{try{m(!0);const{data:t}=await c.from("class_members").select("class_id, joined_at").eq("user_id",a.id).eq("role","student"),r=t?.map(s=>s.class_id)||[],{data:i}=await c.from("classes").select("id, name, subject, color, created_at, created_by").in("id",r),x=i?.map(s=>s.created_by).filter(Boolean)||[],{data:k}=await c.from("profiles").select("id, full_name, avatar_url").in("id",x),C={};if(k?.forEach(s=>{C[s.id]=s}),r.length===0){w([]),m(!1);return}const R=await Promise.all(i.map(async s=>{const V=t.find(n=>n.class_id===s.id),{data:O}=await c.from("activity_class_assignments").select("activity_id").eq("class_id",s.id),A=O?.map(n=>n.activity_id)||[],{data:S}=await c.from("submissions").select("activity_id, status, grade").eq("student_id",a.id).in("activity_id",A),G=new Set(S?.map(n=>n.activity_id)||[]),Q=A.length-G.size,j=S?.filter(n=>n.grade!==null)||[],U=j.length>0?j.reduce((n,K)=>n+parseFloat(K.grade),0)/j.length:null,{data:W}=await c.from("class_members").select("id, is_archived").eq("class_id",s.id).eq("role","student"),$=W?.filter(n=>!n.is_archived).length||0,N=new Date;N.setDate(N.getDate()-7);const{data:H}=await c.from("activity_class_assignments").select("activity_id, assigned_at").eq("class_id",s.id).gte("assigned_at",N.toISOString()),J=(H?.map(n=>n.activity_id)||[]).filter(n=>!G.has(n)).length,B=C[s.created_by];return{id:s.id,name:s.name,subject:s.subject,color:s.color||"blue",teacher_name:B?.full_name||"Professor",teacher_avatar:B?.avatar_url,pendingActivities:Q,avgGrade:U,studentsCount:$||0,newActivities:J,joined_at:V?.joined_at,created_at:s.created_at}}));w(R)}catch(t){Z.error("Erro ao carregar turmas:",t)}finally{m(!1)}},F=()=>{let t=[...l];if(o){const r=o.toLowerCase();t=t.filter(i=>i.name?.toLowerCase().includes(r)||i.subject?.toLowerCase().includes(r)||i.teacher_name?.toLowerCase().includes(r))}t.sort((r,i)=>{switch(b){case"name":return r.name.localeCompare(i.name);case"pending":return i.pendingActivities-r.pendingActivities;case"grade":const x=r.avgGrade||0;return(i.avgGrade||0)-x;case"recent":return new Date(i.joined_at)-new Date(r.joined_at);default:return 0}}),E(t)};return v?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(I,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs(u.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(h,{className:"w-8 h-8 text-blue-600"}),"Minhas Turmas"]}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[l.length," turma",l.length!==1?"s":""," ativa",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(re,{placeholder:"Buscar turmas por nome, matÃ©ria ou professor...",value:o,onChange:t=>M(t.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ie,{value:b,onValueChange:P,children:e.jsxs(ne,{children:[e.jsx(g,{value:"name",children:"Nome"}),e.jsx(g,{value:"pending",children:"Pendentes"}),e.jsx(g,{value:"grade",children:"MÃ©dia"}),e.jsx(g,{value:"recent",children:"Recentes"})]})}),e.jsxs("div",{className:"flex border rounded-lg overflow-hidden",children:[e.jsx(D,{variant:f==="grid"?"default":"ghost",size:"sm",onClick:()=>_("grid"),className:"rounded-none",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx(D,{variant:f==="list"?"default":"ghost",size:"sm",onClick:()=>_("list"),className:"rounded-none",children:e.jsx(de,{className:"w-4 h-4"})})]})]})]}),y.length>0?e.jsx("div",{className:f==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:y.map((t,r)=>e.jsx(oe,{classItem:t,onClick:()=>p(`/students/classes/${t.id}`),index:r},t.id))}):e.jsx(se,{icon:o?T:h,title:o?"Nenhuma turma encontrada":"VocÃª ainda nÃ£o estÃ¡ em nenhuma turma",description:o?"Tente ajustar sua busca para encontrar o que procura.":"Entre em contato com seu professor para ser adicionado a uma turma.",variant:"default"}),l.length>0&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-12 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(h,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Total de Turmas"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:l.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30",children:e.jsx(q,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Atividades Pendentes"})]}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:l.reduce((t,r)=>t+r.pendingActivities,0)})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(q,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"MÃ©dia Geral"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:(()=>{const t=l.filter(i=>i.avgGrade!==null);return t.length===0?"--":(t.reduce((i,x)=>i+x.avgGrade,0)/t.length).toFixed(1)})()})]})]})]})};export{Fe as default};
