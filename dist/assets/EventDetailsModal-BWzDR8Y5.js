import{c as B,r as o,s as d,l as c,j as e,q as R}from"./main-5T23t4PA.js";import{B as n}from"./button-D1pRabHc.js";import{B as x}from"./badge-CHD2ppHT.js";import{t as f}from"./use-toast-DizLYaPb.js";import{r as z}from"./redisCache-CPf_I-xA.js";import{X as I}from"./x-C8LZHbUR.js";import{C as U}from"./clock-DrcV20p-.js";import{f as g}from"./format-BdDrz3ZT.js";import{p as H}from"./pt-BR-C6XVmIDX.js";import{M as $}from"./map-pin-DKElO_ov.js";import{U as E}from"./users-BHFcZ460.js";import{B as V}from"./book-open-DbJlkSkE.js";import{U as F}from"./user--bT9oolr.js";import{V as G}from"./video-BN5dBXch.js";import{S as O}from"./square-pen-CUwW9VI9.js";import{C as K}from"./copy-CSBNcRrD.js";import{T as X}from"./trash-2-25bN939_.js";const J=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Q=B("external-link",J),pe=({isOpen:h,onClose:b,event:s,onEdit:_,onDelete:j})=>{const[u,N]=o.useState(!1),[D,v]=o.useState(!1),[p,w]=o.useState([]),[l,C]=o.useState(null),[m,M]=o.useState(null),[W,y]=o.useState(!1);o.useEffect(()=>{h&&s&&S()},[h,s]);const S=async()=>{try{if(y(!0),s.type==="meeting"||s.type==="reunião")if(Array.isArray(s.attendees)&&s.attendees.length>0){const{data:t,error:a}=await d.from("profiles").select("id, full_name, email").in("id",s.attendees);if(a)throw a;const r=(t||[]).map(i=>({user_id:i.id,status:"pending",profiles:{full_name:i.full_name,email:i.email}}));w(r)}else w([]);if(s.activity_id){const{data:t,error:a}=await d.from("activities").select("id, title, type, description, max_score").eq("id",s.activity_id).single();if(a&&a.code!=="PGRST116")throw a;C(t)}if(s.class_id){const{data:t,error:a}=await d.from("classes").select("id, name, subject").eq("id",s.class_id).single();if(a&&a.code!=="PGRST116")throw a;M(t)}}catch(t){c.error("Erro ao carregar detalhes do evento:",t)}finally{y(!1)}},q=async()=>{try{N(!0);const{data:t}=await d.auth.getUser(),a=t?.user?.id,{error:r}=await d.from("calendar_events").delete().eq("id",s.id);if(r)throw c.error("Erro ao deletar evento:",r),r;if(a)try{await z.deletePattern(`calendar:${a}:*`),c.debug("Cache de calendário invalidado após exclusão")}catch(i){c.warn("Erro ao invalidar cache:",i)}f({title:"✅ Evento excluído!",description:"O evento foi removido com sucesso."}),b(),setTimeout(()=>{j&&j()},100)}catch(t){c.error("Erro ao excluir evento:",t),f({title:"❌ Erro ao excluir",description:t.message||"Não foi possível excluir o evento.",variant:"destructive"})}finally{N(!1)}},A=()=>{f({title:"Em desenvolvimento",description:"Funcionalidade em breve."})},P=t=>({event:"Aula",activity:"Atividade",meeting:"Reunião",deadline:"Prazo"})[t]||"Evento",T=t=>({event:"bg-blue-100 text-blue-700",activity:"bg-orange-100 text-orange-700",meeting:"bg-purple-100 text-purple-700",deadline:"bg-red-100 text-red-700"})[t]||"bg-gray-100 text-gray-700",L=()=>{const t=new Date(s.start_time),r=new Date(s.end_time)-t,i=Math.floor(r/(1e3*60*60)),k=Math.floor(r%(1e3*60*60)/(1e3*60));return i>0?`${i}h ${k}min`:`${k}min`};return h?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:s.title}),e.jsx(x,{className:T(s.type),children:P(s.type)})]}),e.jsx("button",{onClick:b,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(I,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-slate-300",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:g(new Date(s.start_time),"EEEE, d 'de' MMMM",{locale:H})}),e.jsxs("div",{className:"text-sm text-slate-500",children:[g(new Date(s.start_time),"HH:mm")," - ",g(new Date(s.end_time),"HH:mm")," • ",L()]})]})]}),s.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:"Descrição"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:s.description})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:s.modality==="online"?"Online":"Presencial"}),s.modality==="online"&&s.meeting_link&&e.jsxs("a",{href:s.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-1",children:["Abrir link da reunião",e.jsx(Q,{className:"w-3 h-3"})]}),s.modality==="presential"&&s.location&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:s.location})]})]}),(m||s.class)&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/30 rounded-lg border-l-4 border-green-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-green-600"}),"Turma"]}),e.jsx("div",{className:"font-medium",children:m?.name||s.class?.name}),(m?.subject||s.class?.subject)&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:m?.subject||s.class?.subject})]}),l&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border-l-4 border-blue-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600"}),"Atividade Linkada"]}),e.jsx("div",{className:"font-medium mb-1",children:l.title}),l.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:l.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",children:l.type}),l.max_score&&e.jsxs(x,{variant:"outline",children:[l.max_score," pontos"]})]})]}),p.length>0&&e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/30 rounded-lg border-l-4 border-purple-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-purple-600"}),"Participantes (",p.length,")"]}),e.jsx("div",{className:"space-y-2",children:p.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:t.profiles?.full_name}),e.jsx("div",{className:"text-xs text-slate-500",children:t.profiles?.email})]})]}),e.jsx(x,{variant:t.status==="accepted"?"success":"secondary",className:"text-xs",children:t.status==="accepted"?"Confirmado":t.status==="declined"?"Recusado":"Pendente"})]},t.user_id))})]}),s.meeting_url&&e.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-950/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-700 dark:text-indigo-400",children:"LINK DA REUNIÃO:"})]}),e.jsx("a",{href:s.meeting_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline break-all",children:s.meeting_url})]}),D&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 mb-3",children:"Tem certeza que deseja excluir este evento? Esta ação não pode ser desfeita."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>v(!1),disabled:u,children:"Cancelar"}),e.jsx(n,{size:"sm",onClick:q,disabled:u,className:"bg-red-600 hover:bg-red-700",children:u?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:"sm",className:"mr-2"}),"Excluindo..."]}):"Confirmar Exclusão"})]})]})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(n,{variant:"outline",onClick:()=>_(s),className:"flex-1",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(n,{variant:"outline",onClick:A,className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(n,{variant:"outline",onClick:()=>v(!0),className:"flex-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})})]})}):null};export{pe as E};
