import{c as Ke,j as e,l as A,r as v,s as S,u as He,t as Xe,a as Je,p as Ze}from"./main-Bl3iyOV8.js";import{m as ie,B as N}from"./button-DpOjBXor.js";import{C as D}from"./card-SNqEFOp2.js";import{I as E}from"./input-Pzsue5kv.js";import{L as p}from"./label-Ci17ItmZ.js";import{T as se}from"./textarea-CZPWP3iF.js";import{e as F}from"./SidebarPremium-PssxZ1ou.js";import{T as qe,a as ea,b as ue}from"./tabs-96oYwlfD.js";import{D as aa,a as sa,b as ta,c as ra,d as ia,e as la}from"./dialog-C-DIWS3k.js";import{S as le,a as ne,b as ce,c as oe,d as U}from"./select-CMWU8lCm.js";import{u as na}from"./use-toast-CkGKCyMO.js";import{c as J}from"./utils-CmJ3dKRg.js";import{F as Me}from"./index-CYK-_QUl.js";import{S as de}from"./square-check-big-Q6LaTRXJ.js";import{G as Ie}from"./grid-3x3-CLRFCVA4.js";import{C as be,B as ca}from"./chevron-right-DU2dW0WM.js";import"./checkbox-CvwxyB5B.js";import{P as G}from"./plus-CQAi9MI1.js";import{T as me}from"./trash-2-MKta588f.js";import"./radio-group-C2J01tCn.js";import{S as W,A as oa}from"./ActivityPreview-lMly-kf1.js";import{S as da}from"./slider-C9yNryxz.js";import{C as ye}from"./circle-check-rNi8LCKx.js";import{C as Ne}from"./circle-x-CRLtrDcR.js";import{C as we}from"./circle-alert-LHMm3kat.js";import{A as ma}from"./arrow-left-ChZ4BBa6.js";import{E as xa}from"./eye-in92xAhq.js";import{S as ha}from"./save-DI_Svb3f.js";import{S as pa}from"./settings-BAxhic8T.js";import"./bell-BfdEdLeq.js";import"./trending-up-8L-hnT0i.js";import"./user-DM7mQE01.js";import"./house--MZ6Jz5W.js";import"./users-CoDMpyo4.js";import"./graduation-cap-D52WS1is.js";import"./index-Bb4h7Ki9.js";import"./chart-column-C0EgfbtL.js";import"./x-f7wZy2q2.js";import"./index-5Sg1WP5m.js";import"./index-PwNWXBBP.js";import"./index-B53WU1tR.js";import"./index-DZVOjynP.js";import"./index-e0g6fGDf.js";import"./chevron-down-CrZ3gR2D.js";import"./check-DWB8e_Oc.js";import"./chevron-up-CdDuPE1j.js";import"./clock-BJ9uIF0n.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Fe=Ke("grip-vertical",ua),ga=({selectedType:a,onSelectType:r})=>{const c=[{id:"open",name:"Atividade Aberta",subtitle:"Dissertativa",icon:Me,color:"from-green-500 to-emerald-600",description:"Quest√µes dissertativas com respostas textuais",features:["Respostas escritas pelos alunos","Corre√ß√£o manual com rubricas","An√°lise de antipl√°gio dispon√≠vel"],idealFor:"An√°lises, reda√ß√µes, explica√ß√µes detalhadas"},{id:"closed",name:"Atividade Fechada",subtitle:"Objetiva",icon:de,color:"from-blue-500 to-cyan-600",description:"Quest√µes de m√∫ltipla escolha",features:["Alternativas pr√©-definidas","Corre√ß√£o autom√°tica instant√¢nea","Feedback imediato para alunos"],idealFor:"Testes, quizzes, avalia√ß√µes r√°pidas"},{id:"mixed",name:"Atividade Mista",subtitle:"H√≠brida",icon:Ie,color:"from-purple-500 to-pink-600",description:"Combina quest√µes abertas e fechadas",features:["Flexibilidade m√°xima","Parte autom√°tica + parte manual","Avalia√ß√£o completa e vers√°til"],idealFor:"Provas completas, avalia√ß√µes abrangentes"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Escolha o Tipo de Atividade"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Selecione o formato que melhor se adequa √† sua avalia√ß√£o. Voc√™ n√£o poder√° mudar ap√≥s salvar."})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:c.map((l,t)=>{const u=l.icon,j=a===l.id;return e.jsx(ie.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:e.jsx(D,{className:J("p-6 cursor-pointer transition-all duration-200 hover:shadow-xl",j&&"ring-2 ring-blue-500 shadow-xl"),onClick:()=>r(l.id),children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:J("p-4 rounded-xl bg-gradient-to-br",l.color,"flex-shrink-0"),children:e.jsx(u,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:l.name}),e.jsx(F,{variant:"outline",children:l.subtitle})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:l.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Caracter√≠sticas:"}),e.jsx("ul",{className:"space-y-1",children:l.features.map((f,b)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(be,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-green-500"}),e.jsx("span",{children:f})]},b))})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:"Ideal para:"}),e.jsx("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:l.idealFor})]})]}),j&&e.jsx(ie.div,{initial:{scale:0},animate:{scale:1},className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-white"})})})]})})},l.id)})}),a&&e.jsx(ie.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx(F,{className:"bg-green-100 text-green-700 px-4 py-2",children:"‚úì Tipo selecionado! Continue preenchendo as informa√ß√µes b√°sicas."})})]})},$e=({questions:a,setQuestions:r,maxScore:c})=>{const l=()=>{r([...a,{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,image:null,attachments:[],rubric:[],expectedAnswer:""}])},t=(m,s,n)=>{r(a.map(o=>o.id===m?{...o,[s]:n}:o))},u=m=>{r(a.filter(s=>s.id!==m))},j=m=>{r(a.map(s=>s.id===m?{...s,rubric:[...s.rubric||[],{id:Date.now(),name:"",description:"",maxPoints:0}]}:s))},f=(m,s,n,o)=>{r(a.map(x=>x.id===m?{...x,rubric:x.rubric.map(d=>d.id===s?{...d,[n]:o}:d)}:x))},b=(m,s)=>{r(a.map(n=>n.id===m?{...n,rubric:n.rubric.filter(o=>o.id!==s)}:n))},$=a.reduce((m,s)=>m+(parseFloat(s.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Abertas (Dissertativas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[a.length," quest√£o(√µes) ‚Ä¢ Total: ",$.toFixed(1)," pontos",c&&Math.abs($-c)>.1&&e.jsxs(F,{variant:"destructive",className:"ml-2",children:["Meta: ",c," pontos"]})]})]}),e.jsxs(N,{onClick:l,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(N,{onClick:l,variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((m,s)=>e.jsx(D,{className:"p-6 border-l-4 border-l-green-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-gray-400 cursor-move"}),e.jsxs(F,{className:"bg-green-100 text-green-700",children:["Q",s+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Enunciado da Quest√£o *"}),e.jsx(se,{placeholder:"Digite o enunciado da quest√£o...",value:m.text,onChange:n=>t(m.id,"text",n.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Pontua√ß√£o *"}),e.jsx(E,{type:"number",step:"0.1",min:"0",value:m.points,onChange:n=>t(m.id,"points",parseFloat(n.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"M√°x. Linhas"}),e.jsx(E,{type:"number",placeholder:"Ilimitado",value:m.maxLines||"",onChange:n=>t(m.id,"maxLines",n.target.value?parseInt(n.target.value):null),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"M√°x. Caracteres"}),e.jsx(E,{type:"number",placeholder:"Ilimitado",value:m.maxCharacters||"",onChange:n=>t(m.id,"maxCharacters",n.target.value?parseInt(n.target.value):null),className:"mt-1"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(p,{children:"Rubrica de Avalia√ß√£o (Opcional)"}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>j(m.id),children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Adicionar Crit√©rio"]})]}),m.rubric&&m.rubric.length>0&&e.jsx("div",{className:"space-y-3",children:m.rubric.map(n=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(E,{placeholder:"Nome do crit√©rio",value:n.name,onChange:o=>f(m.id,n.id,"name",o.target.value)}),e.jsx(E,{placeholder:"Descri√ß√£o",value:n.description,onChange:o=>f(m.id,n.id,"description",o.target.value)}),e.jsx(E,{type:"number",step:"0.1",placeholder:"Pontos m√°ximos",value:n.maxPoints,onChange:o=>f(m.id,n.id,"maxPoints",parseFloat(o.target.value))})]}),e.jsx(N,{size:"sm",variant:"ghost",onClick:()=>b(m.id,n.id),children:e.jsx(me,{className:"w-4 h-4 text-red-500"})})]},n.id))})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Resposta Esperada (Gabarito - Opcional)"}),e.jsx(se,{placeholder:"Digite uma resposta de refer√™ncia para consulta durante corre√ß√£o...",value:m.expectedAnswer,onChange:n=>t(m.id,"expectedAnswer",n.target.value),className:"mt-1 min-h-[80px]"})]})]}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>u(m.id),children:e.jsx(me,{className:"w-5 h-5 text-red-500"})})]})},m.id))})]})})},ze=({questions:a,setQuestions:r,maxScore:c})=>{const l=()=>{r([...a,{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:"",hint:""}])},t=(s,n,o)=>{r(a.map(x=>x.id===s?{...x,[n]:o}:x))},u=s=>{r(a.filter(n=>n.id!==s))},j=s=>{r(a.map(n=>{if(n.id===s){const o=String.fromCharCode(65+n.alternatives.length);return{...n,alternatives:[...n.alternatives,{id:Date.now(),letter:o,text:"",isCorrect:!1}]}}return n}))},f=(s,n,o,x)=>{r(a.map(d=>d.id===s?{...d,alternatives:d.alternatives.map(h=>h.id===n?{...h,[o]:x}:h)}:d))},b=(s,n)=>{r(a.map(o=>{if(o.id===s&&o.alternatives.length>2){const x=o.alternatives.filter(d=>d.id!==n);return{...o,alternatives:x.map((d,h)=>({...d,letter:String.fromCharCode(65+h)}))}}return o}))},$=(s,n)=>{A.debug("[ClosedQuestions] ‚úÖ Marcando alternativa como correta:",{questionId:s,altId:n}),r(a.map(o=>{if(o.id===s){const x={...o,alternatives:o.alternatives.map(d=>({...d,isCorrect:d.id===n}))};return A.debug("[ClosedQuestions] Quest√£o atualizada:",x),x}return o}))},m=a.reduce((s,n)=>s+(parseFloat(n.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Fechadas (Objetivas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:[a.length," quest√£o(√µes) ‚Ä¢ Total: ",m.toFixed(1)," pontos"]}),c&&Math.abs(m-c)>.1&&e.jsxs(F,{variant:"destructive",className:"ml-2",children:["Meta: ",c," pontos"]})]})]}),e.jsxs(N,{onClick:l,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(N,{onClick:l,variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((s,n)=>{const o=s.alternatives?.some(x=>x.isCorrect);return e.jsx(D,{className:"p-6 border-l-4 border-l-blue-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-gray-400 cursor-move"}),e.jsxs(F,{className:"bg-blue-100 text-blue-700",children:["Q",n+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Enunciado da Quest√£o *"}),e.jsx(se,{placeholder:"Digite o enunciado da quest√£o...",value:s.text,onChange:x=>t(s.id,"text",x.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Pontua√ß√£o *"}),e.jsx(E,{type:"number",step:"0.1",min:"0",value:s.points,onChange:x=>t(s.id,"points",parseFloat(x.target.value)),className:"mt-1 w-32"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(p,{children:["Alternativas *",!o&&e.jsx(F,{variant:"destructive",className:"ml-2",children:"Marque a correta"})]}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>j(s.id),children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Adicionar Alternativa"]})]}),e.jsx("div",{className:"space-y-3",children:s.alternatives?.map(x=>e.jsxs("div",{className:"flex gap-3 items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-${s.id}`,checked:x.isCorrect,onChange:()=>$(s.id,x.id),className:"w-5 h-5 cursor-pointer",title:"Marcar como correta"}),e.jsx(F,{variant:"outline",className:"w-8 justify-center",children:x.letter})]}),e.jsx(E,{placeholder:"Texto da alternativa",value:x.text,onChange:d=>f(s.id,x.id,"text",d.target.value),className:"flex-1"}),s.alternatives.length>2&&e.jsx(N,{size:"sm",variant:"ghost",onClick:()=>b(s.id,x.id),children:e.jsx(me,{className:"w-4 h-4 text-red-500"})})]},x.id))})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Explica√ß√£o da Resposta Correta (Opcional)"}),e.jsx(se,{placeholder:"Explique por que a alternativa est√° correta...",value:s.explanation,onChange:x=>t(s.id,"explanation",x.target.value),className:"mt-1 min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Dica para Alunos (Opcional)"}),e.jsx(E,{placeholder:"Uma dica que pode ajudar...",value:s.hint,onChange:x=>t(s.id,"hint",x.target.value),className:"mt-1"})]})]}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>u(s.id),children:e.jsx(me,{className:"w-5 h-5 text-red-500"})})]})},s.id)})})]})})},va=({questions:a,setQuestions:r,maxScore:c})=>{const[l,t]=v.useState("open"),u=a.filter(s=>s.type==="open"),j=a.filter(s=>s.type==="closed"),f=s=>{const n=s==="open"?{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,rubric:[],expectedAnswer:""}:{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:""};r([...a,n])},b=a.reduce((s,n)=>s+(parseFloat(n.points)||0),0),$=u.length>0?(u.reduce((s,n)=>s+n.points,0)/b*100).toFixed(0):0,m=j.length>0?(j.reduce((s,n)=>s+n.points,0)/b*100).toFixed(0):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Mistas"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:[a.length," quest√£o(√µes) total"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[u.length," Abertas (",$,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[j.length," Fechadas (",m,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:["Total: ",b.toFixed(1)," pontos"]}),c&&Math.abs(b-c)>.1&&e.jsxs(F,{variant:"destructive",className:"ml-2",children:["Meta: ",c," pontos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{onClick:()=>f("open"),variant:"outline",className:"bg-green-50",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Quest√£o Aberta"]}),e.jsxs(N,{onClick:()=>f("closed"),variant:"outline",className:"bg-blue-50",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Quest√£o Fechada"]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsx("p",{className:"mb-6",children:"Comece adicionando quest√µes abertas ou fechadas."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(N,{onClick:()=>f("open"),variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Aberta"]}),e.jsxs(N,{onClick:()=>f("closed"),variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Fechada"]})]})]}):e.jsxs(qe,{defaultValue:"all",className:"w-full",children:[e.jsxs(ea,{className:"grid w-full grid-cols-3",children:[e.jsxs(ue,{value:"all",children:["Todas (",a.length,")"]}),e.jsxs(ue,{value:"open",children:["Abertas (",u.length,")"]}),e.jsxs(ue,{value:"closed",children:["Fechadas (",j.length,")"]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:a.map((s,n)=>e.jsxs(D,{className:`p-4 border-l-4 ${s.type==="open"?"border-l-green-500":"border-l-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(F,{className:s.type==="open"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700",children:["Q",n+1," - ",s.type==="open"?"Aberta":"Fechada"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.points," pontos"]})]}),e.jsx("p",{className:"text-sm text-gray-700 truncate",children:s.text||"Sem enunciado"})]},s.id))})})]})]}),u.length>0&&e.jsx($e,{questions:u,setQuestions:s=>{r([...s,...j])},maxScore:c*($/100)}),j.length>0&&e.jsx(ze,{questions:j,setQuestions:s=>{r([...u,...s])},maxScore:c*(m/100)})]})},ja=({settings:a,setSettings:r,activityType:c})=>{const l=(t,u)=>{r({...a,[t]:u})};return e.jsxs(D,{className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Configura√ß√µes Avan√ßadas"}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Envio Atrasado"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Permitir Envio Atrasado"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos poder√£o submeter ap√≥s o prazo"})]}),e.jsx(W,{checked:a.allowLateSubmission,onCheckedChange:t=>l("allowLateSubmission",t)})]}),a.allowLateSubmission&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Tipo de Penalidade"}),e.jsxs(le,{value:a.latePenaltyType,onValueChange:t=>l("latePenaltyType",t),children:[e.jsx(ne,{className:"mt-1",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(U,{value:"percentage",children:"Percentual"}),e.jsx(U,{value:"points",children:"Pontos Fixos"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Valor da Penalidade"}),e.jsx(E,{type:"number",value:a.latePenaltyValue,onChange:t=>l("latePenaltyValue",parseFloat(t.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"M√°ximo de Dias Atrasados"}),e.jsx(E,{type:"number",value:a.maxLateDays,onChange:t=>l("maxLateDays",parseInt(t.target.value)),className:"mt-1"})]})]})]}),(c==="closed"||c==="quiz"||c==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"M√∫ltiplas Tentativas"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Permitir M√∫ltiplas Tentativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos podem refazer a atividade"})]}),e.jsx(W,{checked:a.allowMultipleAttempts,onCheckedChange:t=>l("allowMultipleAttempts",t)})]}),a.allowMultipleAttempts&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(p,{children:"M√°ximo de Tentativas"}),e.jsx(E,{type:"number",min:"1",value:a.maxAttempts,onChange:t=>l("maxAttempts",parseInt(t.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Considerar"}),e.jsxs(le,{value:a.attemptScoring,onValueChange:t=>l("attemptScoring",t),children:[e.jsx(ne,{className:"mt-1",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(U,{value:"best",children:"Melhor Nota"}),e.jsx(U,{value:"last",children:"√öltima Nota"}),e.jsx(U,{value:"average",children:"M√©dia"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Tempo Limite"}),e.jsxs("div",{children:[e.jsx(p,{children:"Tempo M√°ximo (minutos)"}),e.jsx(E,{type:"number",placeholder:"Ilimitado",value:a.timeLimit||"",onChange:t=>l("timeLimit",t.target.value?parseInt(t.target.value):null),className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Deixe vazio para sem limite"})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Feedback e Gabarito"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Mostrar nota imediatamente"}),e.jsx(W,{checked:a.showScoreImmediately,onCheckedChange:t=>l("showScoreImmediately",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Mostrar gabarito ap√≥s submiss√£o"}),e.jsx(W,{checked:a.showAnswerKey,onCheckedChange:t=>l("showAnswerKey",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Liberar gabarito ap√≥s prazo"}),e.jsx(W,{checked:a.releaseAnswerAfterDeadline,onCheckedChange:t=>l("releaseAnswerAfterDeadline",t)})]})]})]}),(c==="open"||c==="assignment"||c==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Antipl√°gio"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Ativar Detec√ß√£o de Antipl√°gio"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verificar originalidade das respostas"})]}),e.jsx(W,{checked:a.plagiarismEnabled,onCheckedChange:t=>l("plagiarismEnabled",t)})]}),a.plagiarismEnabled&&e.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Sensibilidade"}),e.jsxs(le,{value:a.plagiarismSensitivity,onValueChange:t=>l("plagiarismSensitivity",t),children:[e.jsx(ne,{className:"mt-1",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(U,{value:"low",children:"Baixa"}),e.jsx(U,{value:"medium",children:"M√©dia"}),e.jsx(U,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{children:[e.jsxs(p,{children:["Originalidade M√≠nima: ",a.plagiarismMinOriginality,"%"]}),e.jsx(da,{value:[a.plagiarismMinOriginality],onValueChange:t=>l("plagiarismMinOriginality",t[0]),min:0,max:100,step:5,className:"mt-2"})]})]})]}),(c==="closed"||c==="quiz"||c==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Randomiza√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Embaralhar Quest√µes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cada aluno v√™ ordem diferente"})]}),e.jsx(W,{checked:a.shuffleQuestions,onCheckedChange:t=>l("shuffleQuestions",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Embaralhar Alternativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ordem aleat√≥ria das op√ß√µes"})]}),e.jsx(W,{checked:a.shuffleAlternatives,onCheckedChange:t=>l("shuffleAlternatives",t)})]})]})]})]})},fa=({errors:a,warnings:r,onValidate:c,onNavigateToError:l})=>e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Valida√ß√£o da Atividade"}),e.jsx("p",{className:"text-gray-600",children:"Verifique se sua atividade est√° pronta para ser publicada"})]}),e.jsx(N,{onClick:c,className:"w-full",children:"Executar Valida√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(D,{className:"p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ye,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"V√°lido"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.length===0?"‚úì":"‚Äî"})]}),e.jsxs(D,{className:"p-4 bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Erros"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.length})]}),e.jsxs(D,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Avisos"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:r.length})]})]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-600"}),e.jsxs("h3",{className:"font-semibold text-red-600",children:["Erros Cr√≠ticos (",a.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:a.map((t,u)=>e.jsx(D,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-l-red-500 cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>l(t.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(F,{variant:"destructive",className:"mb-2",children:t.field}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:t.message})]}),e.jsx(be,{className:"w-5 h-5 text-red-600 flex-shrink-0"})]})},u))}),e.jsx("p",{className:"text-sm text-red-600 mt-3",children:"‚ùå Corrija todos os erros antes de publicar a atividade."})]}),r.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("h3",{className:"font-semibold text-yellow-600",children:["Avisos (",r.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:r.map((t,u)=>e.jsx(D,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-l-yellow-500 cursor-pointer hover:bg-yellow-100 transition-colors",onClick:()=>l(t.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(F,{variant:"outline",className:"mb-2 border-yellow-600 text-yellow-700",children:t.field}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:t.message})]}),e.jsx(be,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"})]})},u))}),e.jsx("p",{className:"text-sm text-yellow-600 mt-3",children:"‚ö†Ô∏è Avisos n√£o impedem a publica√ß√£o, mas √© recomendado corrigi-los."})]}),a.length===0&&r.length===0&&e.jsx(D,{className:"p-6 bg-green-50 dark:bg-green-900/20 border-2 border-green-500",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800 dark:text-green-200",children:"Atividade Pronta!"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Sua atividade est√° v√°lida e pronta para ser publicada."})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Checklist Geral"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{checked:a.filter(t=>t.field==="title").length===0,label:"T√≠tulo v√°lido"}),e.jsx(Z,{checked:a.filter(t=>t.field==="description").length===0,label:"Descri√ß√£o v√°lida"}),e.jsx(Z,{checked:a.filter(t=>t.field==="questions").length===0,label:"Pelo menos uma quest√£o"}),e.jsx(Z,{checked:a.filter(t=>t.field.startsWith("question")).length===0,label:"Todas as quest√µes v√°lidas"}),e.jsx(Z,{checked:r.filter(t=>t.field==="tags").length===0,label:"Tags adicionadas",warning:!0}),e.jsx(Z,{checked:r.filter(t=>t.field==="score").length===0,label:"Pontua√ß√£o consistente",warning:!0})]})]})]})}),Z=({checked:a,label:r,warning:c=!1})=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800",children:[a?e.jsx(ye,{className:`w-5 h-5 ${c?"text-yellow-600":"text-green-600"}`}):e.jsx(Ne,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:`text-sm ${a?"text-gray-900 dark:text-gray-100":"text-gray-500"}`,children:r})]}),T=[];for(let a=0;a<256;++a)T.push((a+256).toString(16).slice(1));function ba(a,r=0){return(T[a[r+0]]+T[a[r+1]]+T[a[r+2]]+T[a[r+3]]+"-"+T[a[r+4]]+T[a[r+5]]+"-"+T[a[r+6]]+T[a[r+7]]+"-"+T[a[r+8]]+T[a[r+9]]+"-"+T[a[r+10]]+T[a[r+11]]+T[a[r+12]]+T[a[r+13]]+T[a[r+14]]+T[a[r+15]]).toLowerCase()}let ge;const ya=new Uint8Array(16);function Na(){if(!ge){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ge=crypto.getRandomValues.bind(crypto)}return ge(ya)}const wa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Te={randomUUID:wa};function Ca(a,r,c){a=a||{};const l=a.random??a.rng?.()??Na();if(l.length<16)throw new Error("Random bytes length must be >= 16");return l[6]=l[6]&15|64,l[8]=l[8]&63|128,ba(l)}function ve(a,r,c){return Te.randomUUID&&!a?Te.randomUUID():Ca(a)}const ae={DRAFTS:"drafts",ACTIVITIES:"activities",SUBMISSIONS:"submissions"},Aa=async(a,r,c="")=>{try{const l=a.name.split(".").pop(),t=`${Math.random().toString(36).substring(2,15)}-${Date.now()}.${l}`,u=c?`${c}/${t}`:t,{data:j,error:f}=await S.storage.from(r).upload(u,a,{cacheControl:"3600",upsert:!1});if(f)throw f;const{data:{publicUrl:b}}=S.storage.from(r).getPublicUrl(u);return{data:{path:j.path,publicUrl:b,fileName:a.name,fileType:a.type,size:a.size},error:null}}catch(l){return A.error("Error uploading file:",l),{data:null,error:l}}},Qe=async(a,r)=>{try{const{data:c,error:l}=await S.storage.from(a).remove([r]);if(l)throw l;return{data:c,error:null}}catch(c){return A.error("Error removing file:",c),{data:null,error:c}}},Sa=(a,r)=>{const{data:c}=S.storage.from(a).getPublicUrl(r);return c.publicUrl},ka=async(a,r,c,l)=>{try{const{data:t,error:u}=await S.storage.from(a).download(r);if(u)throw u;const{data:j,error:f}=await Aa(new File([t],l.split("/").pop(),{type:t.type}),c,l.split("/").slice(0,-1).join("/"));if(f)throw f;return await Qe(a,r),{data:j,error:null}}catch(t){return A.error("Error moving file:",t),{data:null,error:t}}},De=a=>a&&a.startsWith("image/"),je=(a,r,c={})=>{const{width:l=300,height:t=300,quality:u=80,resize:j="cover"}=c,{data:f}=S.storage.from(a).getPublicUrl(r,{transform:{width:l,height:t,resize:j,quality:u}});return f.publicUrl},Pe=(a,r)=>({small:je(a,r,{width:150,height:150}),medium:je(a,r,{width:300,height:300}),large:je(a,r,{width:600,height:600}),original:Sa(a,r)}),Ea=(a,r,c=!1)=>{const[l,t]=v.useState(!1),[u,j]=v.useState(0),[f,b]=v.useState(null),$=v.useCallback(()=>c?ae.DRAFTS:ae.ACTIVITIES,[c]),m=v.useCallback(d=>{const h=Date.now(),y=d.split(".").pop(),V=ve();return`${r}/${a}/${h}-${V}.${y}`},[a,r]),s=v.useCallback(async d=>{if(!d)return null;t(!0),b(null);try{const h=$(),y=m(d.name),V={cacheControl:"3600",upsert:!1,onProgress:w=>{const R=Math.round(w.loaded/w.total*100);j(R)}},{data:P,error:O}=await S.storage.from(h).upload(y,d,V);if(O)throw O;const{data:{publicUrl:Q}}=S.storage.from(h).getPublicUrl(y),L={id:ve(),name:d.name,url:Q,path:P.path,size:d.size,type:d.type,isNew:!0,isImage:De(d.type)};return L.isImage&&(L.thumbnails=Pe(h,P.path)),L}catch(h){throw A.error("Erro ao fazer upload do arquivo:",h),b(h.message||"Erro ao fazer upload do arquivo"),h}finally{t(!1),j(0)}},[$,m]),n=v.useCallback(async d=>{if(!d)return!1;try{const h=$(),{error:y}=await Qe(h,d);if(y)throw y;return!0}catch(h){throw A.error("Erro ao remover arquivo:",h),b(h.message||"Erro ao remover o arquivo"),h}},[$]),o=v.useCallback(async(d=null)=>{try{if(!c)throw new Error("Apenas rascunhos podem ser publicados");const h=ae.DRAFTS,y=ae.ACTIVITIES,V=`${r}/${a||"temp"}`,P=`${r}/${d||a}`,{data:O,error:Q}=await S.storage.from(h).list(V);if(Q)throw Q;const L=[];for(const w of O){const R=`${V}/${w.name}`,M=`${P}/${w.name}`,{error:q}=await ka(h,R,y,M);if(q){A.warn(`Falha ao mover o arquivo ${w.name}:`,q);continue}const{data:{publicUrl:z}}=S.storage.from(y).getPublicUrl(M);L.push({originalPath:R,newPath:M,url:z,name:w.name,type:w.metadata?.mimetype||"application/octet-stream",size:w.metadata?.size||0})}return L}catch(h){throw A.error("Erro ao publicar arquivos da atividade:",h),b(h.message||"Erro ao publicar os arquivos da atividade"),h}},[a,c,r]),x=v.useCallback(async(d,h)=>{if(!d||!h)throw new Error("Arquivo e ID de submiss√£o s√£o obrigat√≥rios");t(!0),b(null);try{const y=ae.SUBMISSIONS,V=`${r}/${a}/${h}/${d.name}`,P={cacheControl:"3600",upsert:!1,onProgress:R=>{const M=Math.round(R.loaded/R.total*100);j(M)}},{data:O,error:Q}=await S.storage.from(y).upload(V,d,P);if(Q)throw Q;const{data:{publicUrl:L}}=S.storage.from(y).getPublicUrl(V),w={id:ve(),name:d.name,url:L,path:O.path,size:d.size,type:d.type,isNew:!0,isImage:De(d.type)};return w.isImage&&(w.thumbnails=Pe(y,O.path)),w}catch(y){throw A.error("Erro ao fazer upload da submiss√£o:",y),b(y.message||"Erro ao fazer upload da submiss√£o"),y}finally{t(!1),j(0)}},[a,r]);return{isUploading:l,uploadProgress:u,error:f,uploadActivityFile:s,removeActivityFile:n,publishActivityFiles:o,uploadSubmission:x,resetError:()=>b(null)}},K={OPEN:"open",CLOSED:"closed",MIXED:"mixed"},Y={ASSIGNMENT:"assignment",QUIZ:"quiz",ESSAY:"essay",PROJECT:"project"},Ta={[K.OPEN]:Y.ASSIGNMENT,[K.CLOSED]:Y.QUIZ,[K.MIXED]:Y.ASSIGNMENT},Da={[Y.ASSIGNMENT]:K.OPEN,[Y.QUIZ]:K.CLOSED,[Y.ESSAY]:K.OPEN,[Y.PROJECT]:K.MIXED};function fe(a){const r=Ta[a];return r||(console.warn(`[Activity Type Mapping] Tipo desconhecido: ${a}, usando 'assignment' como fallback`),Y.ASSIGNMENT)}function Pa(a){const r=Da[a];return r||(console.warn(`[Activity Type Mapping] Tipo do banco desconhecido: ${a}, usando 'open' como fallback`),K.OPEN)}function Ma(a){return Object.values(Y).includes(a)}const Ss=()=>{const a=He(),{id:r}=Xe(),{user:c}=Je(),{toast:l}=na(),t=!!r,[u,j]=v.useState(t),[f,b]=v.useState(!1),[$,m]=v.useState(null),[s,n]=v.useState(null),[o,x]=v.useState(""),[d,h]=v.useState(""),[y,V]=v.useState(""),[P,O]=v.useState([]),[Q,L]=v.useState("medium"),[w,R]=v.useState(""),[M,q]=v.useState(10),[z,ee]=v.useState([]),[xe,Ce]=v.useState([]),[H,Ae]=v.useState({allowLateSubmission:!1,latePenaltyType:"percentage",latePenaltyValue:10,maxLateDays:7,allowMultipleAttempts:!1,maxAttempts:1,attemptScoring:"best",timeLimit:null,showScoreImmediately:!0,showAnswerKey:!1,releaseAnswerAfterDeadline:!0,plagiarismEnabled:!1,plagiarismSensitivity:"medium",plagiarismMinOriginality:70,shuffleQuestions:!1,shuffleAlternatives:!1}),[_,B]=v.useState(t?"basics":"type"),[Ve,Se]=v.useState(!1),[he,Ue]=v.useState([]),[te,Oe]=v.useState([]),[Le,re]=v.useState(!1),{publishActivityFiles:_e}=Ea(r||"temp",c?.id,!t);v.useEffect(()=>{if(!s)return;const i=setInterval(()=>{Ge()},6e4);return()=>clearInterval(i)},[s,o,d,z,H]),v.useEffect(()=>{t?Be():Re()},[r]);const Re=()=>{try{const i=sessionStorage.getItem("importedActivity");if(i){const g=JSON.parse(i);n(g.activityType||"mixed"),x(g.title||""),h(g.description||""),g.content&&ee([{id:Date.now().toString(),type:"open",prompt:g.content,maxScore:10,rubric:""}]),l({title:"üì• Atividade importada",description:`Conte√∫do de "${g.importedFrom}" carregado. Revise e edite conforme necess√°rio.`}),sessionStorage.removeItem("importedActivity"),B("questions")}}catch(i){A.error("Erro ao carregar dados importados:",i)}},Be=async()=>{try{j(!0);const{data:i,error:g}=await S.from("activities").select("*").eq("id",r).single();if(g)throw g;const C=Pa(i.type);A.debug("[Activity Load] Convertendo tipo:",{databaseType:i.type,frontendType:C}),n(C),x(i.title),h(i.description||""),V(i.content?.subject||""),O(i.content?.tags||[]),L(i.content?.difficulty||"medium"),R(i.content?.estimated_time||""),q(i.max_score||10),ee(i.content?.questions||[]),Ce(i.content?.attachments||[]),i.content?.advanced_settings&&Ae(i.content.advanced_settings),l({title:"Atividade carregada",description:"Voc√™ pode editar e salvar as altera√ß√µes."})}catch(i){A.error("Erro ao carregar atividade:",i),l({title:"Erro",description:"N√£o foi poss√≠vel carregar a atividade.",variant:"destructive"}),a("/dashboard/activities")}finally{j(!1)}},Ge=async()=>{if(!(!o||!s))try{const i=fe(s),g={title:o,description:d,type:i,max_score:M,status:"draft",content:{subject:y,tags:P,difficulty:Q,estimated_time:w,questions:z,attachments:xe,advanced_settings:H},created_by:c.id,updated_at:new Date().toISOString()};if(t){const{error:C}=await S.from("activities").update(g).eq("id",r);if(C)throw C}m(new Date)}catch(i){A.error("Erro no auto-save:",i)}},ke=()=>{const i=[],g=[];(!o||o.trim().length<3)&&i.push({field:"title",message:"T√≠tulo deve ter pelo menos 3 caracteres"}),(!d||d.trim().length<10)&&i.push({field:"description",message:"Descri√ß√£o deve ter pelo menos 10 caracteres"}),z.length===0&&i.push({field:"questions",message:"Adicione pelo menos uma quest√£o"}),z.forEach((k,I)=>{(!k.text||k.text.trim().length<5)&&i.push({field:`question-${I}`,message:`Quest√£o ${I+1}: enunciado muito curto`}),(!k.points||k.points<=0)&&i.push({field:`question-${I}`,message:`Quest√£o ${I+1}: pontua√ß√£o inv√°lida`}),(s==="closed"||s==="quiz")&&k.type==="closed"&&((!k.alternatives||k.alternatives.length<2)&&i.push({field:`question-${I}`,message:`Quest√£o ${I+1}: deve ter pelo menos 2 alternativas`}),(k.alternatives?.filter(X=>X.isCorrect)||[]).length===0&&i.push({field:`question-${I}`,message:`Quest√£o ${I+1}: marque pelo menos uma alternativa correta`}))}),P.length===0&&g.push({field:"tags",message:"Considere adicionar tags para facilitar a organiza√ß√£o"}),w||g.push({field:"time",message:"Tempo estimado n√£o definido"});const C=z.reduce((k,I)=>k+(I.points||0),0);return Math.abs(C-M)>.1&&g.push({field:"score",message:`Soma das quest√µes (${C}) difere da pontua√ß√£o m√°xima (${M})`}),Ue(i),Oe(g),i.length===0},Ye=async()=>{if(!o||o.trim().length<3){l({title:"T√≠tulo obrigat√≥rio",description:"Defina um t√≠tulo para salvar o rascunho.",variant:"destructive"});return}if(!s){l({title:"Tipo obrigat√≥rio",description:"Selecione o tipo de atividade.",variant:"destructive"});return}try{b(!0);const i=fe(s);A.debug("[Activity Draft] Mapeando tipo:",{frontendType:s,databaseType:i});const g={title:o.trim(),description:d?.trim()||"",type:i,max_score:M,status:"draft",content:{subject:y,tags:P,difficulty:Q,estimated_time:w,questions:z,attachments:xe,advanced_settings:H},created_by:c.id,updated_at:new Date().toISOString()};if(console.log("[TeacherActivityCreatePage] üíæ Salvando atividade:",{title:o,type:s,questionsCount:z.length,advancedSettings:H}),t){const{error:C}=await S.from("activities").update(g).eq("id",r);if(C)throw C;l({title:"Rascunho salvo",description:"Suas altera√ß√µes foram salvas."})}else{const{data:C,error:k}=await S.from("activities").insert(g).select().single();if(k)throw k;l({title:"‚úÖ Rascunho salvo!",description:"Atividade salva como rascunho. Aparecer√° na sua lista de atividades."}),a(`/teacher/activities/${C.id}/edit`,{replace:!0})}m(new Date)}catch(i){A.error("Erro ao salvar rascunho:",i),l({title:"Erro",description:"N√£o foi poss√≠vel salvar o rascunho.",variant:"destructive"})}finally{b(!1)}},We=async()=>{if(!ke()){l({title:"Valida√ß√£o falhou",description:"Corrija os erros antes de publicar.",variant:"destructive"});return}if(te.length>0){re(!0);return}await Ee()},Ee=async()=>{re(!1);try{b(!0);const i=fe(s);A.debug("[Activity Create] Mapeando tipo:",{frontendType:s,databaseType:i,isValid:Ma(i)});let g={title:o,description:d,type:i,max_score:M,status:"published",is_published:!0,content:{subject:y,tags:P,difficulty:Q,estimated_time:w,questions:z,attachments:xe,advanced_settings:H},created_by:c.id,updated_at:new Date().toISOString()};if(t){const{error:C}=await S.from("activities").update(g).eq("id",r);if(C)throw C}else{const{data:C,error:k}=await S.from("activities").insert(g).select().single();if(k)throw k;try{const I=await _e(C.id);if(I&&I.length>0){const pe=I.map(X=>({name:X.name,url:X.url,path:X.newPath,size:X.size,type:X.type}));g={...g,content:{...g.content,attachments:pe}},await S.from("activities").update(g).eq("id",C.id),Ce(pe)}}catch(I){A.warn("Falha ao mover anexos de rascunho ao publicar:",I)}}l({title:"Atividade publicada!",description:"Agora voc√™ pode postar em suas turmas."}),a("/dashboard/activities")}catch(i){A.error("Erro ao publicar:",i),l({title:"Erro",description:"N√£o foi poss√≠vel publicar a atividade.",variant:"destructive"})}finally{b(!1)}};return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ze,{size:"lg",text:"Carregando atividade..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>a("/dashboard/activities"),children:e.jsx(ma,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:t?`Editar: ${o||"Atividade"}`:"Criar Nova Atividade"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(F,{variant:s?"default":"secondary",children:s||"Tipo n√£o definido"}),e.jsx(F,{variant:"outline",children:t?"Editando":"Nova"}),$&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Salvo ",Math.floor((new Date-$)/1e3),"s atr√°s"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(N,{variant:"outline",onClick:()=>Se(!0),disabled:!s,children:[e.jsx(xa,{className:"w-5 h-5 mr-2"}),"Pr√©via"]}),e.jsxs(N,{variant:"outline",onClick:Ye,disabled:f||!s||!o||o.trim().length<3,children:[e.jsx(ha,{className:"w-5 h-5 mr-2"}),f?"Salvando...":"Salvar"]}),e.jsxs(N,{onClick:We,disabled:f||!s,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(de,{className:"w-5 h-5 mr-2"}),t?"Publicar Altera√ß√µes":"Publicar Atividade"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(D,{className:"p-4 sticky top-6",children:e.jsxs("nav",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>B("type"),className:J("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="type"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:t,children:[e.jsx(Ie,{className:"w-4 h-4 inline mr-2"}),"Tipo de Atividade"]}),e.jsxs("button",{onClick:()=>B("basics"),className:J("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="basics"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(ca,{className:"w-4 h-4 inline mr-2"}),"Informa√ß√µes B√°sicas"]}),e.jsxs("button",{onClick:()=>B("questions"),className:J("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="questions"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:!s,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"Quest√µes (",z.length,")"]}),e.jsxs("button",{onClick:()=>B("advanced"),className:J("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="advanced"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(pa,{className:"w-4 h-4 inline mr-2"}),"Configura√ß√µes"]}),e.jsxs("button",{onClick:()=>B("validation"),className:J("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="validation"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(de,{className:"w-4 h-4 inline mr-2"}),"Valida√ß√£o",he.length>0&&e.jsx(F,{variant:"destructive",className:"ml-2",children:he.length})]})]})})}),e.jsx("div",{className:"col-span-9",children:e.jsxs(ie.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[_==="type"&&!t&&e.jsx(ga,{selectedType:s,onSelectType:i=>{n(i),B("basics")}}),_==="basics"&&e.jsxs(D,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Informa√ß√µes B√°sicas"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",children:"T√≠tulo da Atividade *"}),e.jsx(E,{id:"title",placeholder:"Ex: Avalia√ß√£o de √Ålgebra Linear - Unidade 2",value:o,onChange:i=>x(i.target.value),className:"mt-1",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[o.length,"/200 caracteres"]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"description",children:"Descri√ß√£o *"}),e.jsx(se,{id:"description",placeholder:"Descreva o objetivo e instru√ß√µes gerais da atividade...",value:d,onChange:i=>h(i.target.value),className:"mt-1 min-h-[120px]",maxLength:2e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[d.length,"/2000 caracteres"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"subject",children:"Disciplina/Mat√©ria *"}),e.jsx(E,{id:"subject",placeholder:"Ex: Matem√°tica",value:y,onChange:i=>V(i.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"difficulty",children:"Dificuldade"}),e.jsxs(le,{value:Q,onValueChange:L,children:[e.jsx(ne,{className:"mt-1",children:e.jsx(ce,{})}),e.jsxs(oe,{children:[e.jsx(U,{value:"easy",children:"F√°cil"}),e.jsx(U,{value:"medium",children:"M√©dia"}),e.jsx(U,{value:"hard",children:"Dif√≠cil"}),e.jsx(U,{value:"very_hard",children:"Muito Dif√≠cil"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"time",children:"Tempo Estimado (minutos)"}),e.jsx(E,{id:"time",type:"number",placeholder:"45",value:w,onChange:i=>R(i.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"maxScore",children:"Pontua√ß√£o M√°xima Total *"}),e.jsx(E,{id:"maxScore",type:"number",step:"0.1",min:"0.1",max:"100",value:M,onChange:i=>q(parseFloat(i.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"tags",children:"T√≥picos/Tags"}),e.jsx(E,{id:"tags",placeholder:"Pressione Enter para adicionar (Ex: √Ålgebra, Matrizes)",onKeyDown:i=>{i.key==="Enter"&&i.target.value.trim()&&(i.preventDefault(),P.includes(i.target.value.trim())||(O([...P,i.target.value.trim()]),i.target.value=""))},className:"mt-1"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:P.map((i,g)=>e.jsxs(F,{variant:"secondary",className:"cursor-pointer hover:bg-red-100",onClick:()=>O(P.filter((C,k)=>k!==g)),children:["#",i," √ó"]},g))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{onClick:()=>B("questions"),disabled:!o||!d||!y,children:"Pr√≥ximo: Adicionar Quest√µes"})})]})]}),_==="questions"&&s&&e.jsxs(e.Fragment,{children:[(s==="open"||s==="assignment")&&e.jsx($e,{questions:z,setQuestions:ee,maxScore:M}),(s==="closed"||s==="quiz")&&e.jsx(ze,{questions:z,setQuestions:ee,maxScore:M}),(s==="mixed"||s==="project")&&e.jsx(va,{questions:z,setQuestions:ee,maxScore:M})]}),_==="advanced"&&e.jsx(ja,{settings:H,setSettings:Ae,activityType:s}),_==="validation"&&e.jsx(fa,{errors:he,warnings:te,onValidate:ke,onNavigateToError:i=>{i.startsWith("question")?B("questions"):["title","description","subject"].includes(i)&&B("basics")}})]},_)})]}),Ve&&e.jsx(oa,{activity:{title:o,description:d,type:s,subject:y,tags:P,difficulty:Q,estimatedTime:w,maxScore:M,questions:z,advancedSettings:H},onClose:()=>Se(!1)}),e.jsx(aa,{open:Le,onOpenChange:re,children:e.jsxs(sa,{children:[e.jsxs(ta,{children:[e.jsxs(ra,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-6 h-6 text-orange-600"}),"Avisos Detectados"]}),e.jsxs(ia,{children:["H√° ",te.length," aviso(s) na atividade. Deseja publicar mesmo assim?"]})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"space-y-2",children:te.map((i,g)=>e.jsx("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:["‚ö†Ô∏è ",i.message]})},g))})}),e.jsxs(la,{children:[e.jsx(N,{variant:"outline",onClick:()=>re(!1),children:"Cancelar"}),e.jsx(N,{onClick:Ee,className:"bg-orange-600 hover:bg-orange-700",children:"Publicar Mesmo Assim"})]})]})})]})};export{Ss as default};
