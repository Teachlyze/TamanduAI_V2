import{c as B,r as i,s as o,l as d,j as e,p as R}from"./main-CulyknMy.js";import{B as c}from"./button-Dfu2yMjN.js";import{B as x}from"./badge-hAm5RhEJ.js";import{t as f}from"./use-toast-D1WbEInh.js";import{r as z}from"./redisCache-BoSohuzZ.js";import{X as I}from"./x-C2dkvfPv.js";import{C as U}from"./clock-CPzPBM7h.js";import{f as g}from"./format-BcFT9btV.js";import{p as H}from"./pt-BR-CuGSKEGQ.js";import{M as $}from"./map-pin-CFoz_cxX.js";import{U as k}from"./users-CLb1Ind1.js";import{B as V}from"./book-open-L6K6GApD.js";import{U as F}from"./user-BGYzkTxO.js";import{V as G}from"./video-CRvRVJwF.js";import{S as O}from"./square-pen-D2vz0pY4.js";import{C as K}from"./copy-st_KPjxf.js";import{T as X}from"./trash-2-BIgCFaej.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Q=B("external-link",J),pe=({isOpen:h,onClose:b,event:s,onEdit:E,onDelete:j})=>{const[u,N]=i.useState(!1),[_,v]=i.useState(!1),[p,D]=i.useState([]),[r,C]=i.useState(null),[n,M]=i.useState(null),[W,w]=i.useState(!1);i.useEffect(()=>{h&&s&&S()},[h,s]);const S=async()=>{try{if(w(!0),s.type==="meeting"||s.type==="reunião"){const{data:t,error:a}=await o.from("meeting_attendees").select(`
            user_id,
            status,
            profiles:profiles!meeting_attendees_user_id_fkey(id, full_name, email)
          `).eq("meeting_id",s.id);if(a)throw a;D(t||[])}if(s.activity_id){const{data:t,error:a}=await o.from("activities").select("id, title, type, description, max_score").eq("id",s.activity_id).single();if(a&&a.code!=="PGRST116")throw a;C(t)}if(s.class_id){const{data:t,error:a}=await o.from("classes").select("id, name, subject").eq("id",s.class_id).single();if(a&&a.code!=="PGRST116")throw a;M(t)}}catch(t){d.error("Erro ao carregar detalhes do evento:",t)}finally{w(!1)}},q=async()=>{try{N(!0);const{data:t}=await o.auth.getUser(),a=t?.user?.id,{error:l}=await o.from("calendar_events").delete().eq("id",s.id);if(l)throw d.error("Erro ao deletar evento:",l),l;if(a)try{await z.deletePattern(`calendar:${a}:*`),d.debug("Cache de calendário invalidado após exclusão")}catch(m){d.warn("Erro ao invalidar cache:",m)}f({title:"✅ Evento excluído!",description:"O evento foi removido com sucesso."}),b(),setTimeout(()=>{j&&j()},100)}catch(t){d.error("Erro ao excluir evento:",t),f({title:"❌ Erro ao excluir",description:t.message||"Não foi possível excluir o evento.",variant:"destructive"})}finally{N(!1)}},P=()=>{f({title:"Em desenvolvimento",description:"Funcionalidade em breve."})},T=t=>({event:"Aula",activity:"Atividade",meeting:"Reunião",deadline:"Prazo"})[t]||"Evento",L=t=>({event:"bg-blue-100 text-blue-700",activity:"bg-orange-100 text-orange-700",meeting:"bg-purple-100 text-purple-700",deadline:"bg-red-100 text-red-700"})[t]||"bg-gray-100 text-gray-700",A=()=>{const t=new Date(s.start_time),l=new Date(s.end_time)-t,m=Math.floor(l/(1e3*60*60)),y=Math.floor(l%(1e3*60*60)/(1e3*60));return m>0?`${m}h ${y}min`:`${y}min`};return h?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:s.title}),e.jsx(x,{className:L(s.type),children:T(s.type)})]}),e.jsx("button",{onClick:b,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(I,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-slate-300",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:g(new Date(s.start_time),"EEEE, d 'de' MMMM",{locale:H})}),e.jsxs("div",{className:"text-sm text-slate-500",children:[g(new Date(s.start_time),"HH:mm")," - ",g(new Date(s.end_time),"HH:mm")," • ",A()]})]})]}),s.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:"Descrição"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:s.description})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:s.modality==="online"?"Online":"Presencial"}),s.modality==="online"&&s.meeting_link&&e.jsxs("a",{href:s.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-1",children:["Abrir link da reunião",e.jsx(Q,{className:"w-3 h-3"})]}),s.modality==="presential"&&s.location&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:s.location})]})]}),(n||s.class)&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/30 rounded-lg border-l-4 border-green-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-green-600"}),"Turma"]}),e.jsx("div",{className:"font-medium",children:n?.name||s.class?.name}),(n?.subject||s.class?.subject)&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:n?.subject||s.class?.subject})]}),r&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border-l-4 border-blue-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600"}),"Atividade Linkada"]}),e.jsx("div",{className:"font-medium mb-1",children:r.title}),r.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:r.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",children:r.type}),r.max_score&&e.jsxs(x,{variant:"outline",children:[r.max_score," pontos"]})]})]}),p.length>0&&e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/30 rounded-lg border-l-4 border-purple-500",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-purple-600"}),"Participantes (",p.length,")"]}),e.jsx("div",{className:"space-y-2",children:p.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:t.profiles?.full_name}),e.jsx("div",{className:"text-xs text-slate-500",children:t.profiles?.email})]})]}),e.jsx(x,{variant:t.status==="accepted"?"success":"secondary",className:"text-xs",children:t.status==="accepted"?"Confirmado":t.status==="declined"?"Recusado":"Pendente"})]},t.user_id))})]}),s.meeting_url&&e.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-950/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-700 dark:text-indigo-400",children:"LINK DA REUNIÃO:"})]}),e.jsx("a",{href:s.meeting_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline break-all",children:s.meeting_url})]}),_&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 mb-3",children:"Tem certeza que deseja excluir este evento? Esta ação não pode ser desfeita."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>v(!1),disabled:u,children:"Cancelar"}),e.jsx(c,{size:"sm",onClick:q,disabled:u,className:"bg-red-600 hover:bg-red-700",children:u?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:"sm",className:"mr-2"}),"Excluindo..."]}):"Confirmar Exclusão"})]})]})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{variant:"outline",onClick:()=>E(s),className:"flex-1",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(c,{variant:"outline",onClick:P,className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(c,{variant:"outline",onClick:()=>v(!0),className:"flex-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})})]})}):null};export{pe as E};
