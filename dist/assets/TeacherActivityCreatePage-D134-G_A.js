import{c as Oe,j as e,l as T,r as v,s as C,u as Re,o as Be,a as Ge,m as Ke}from"./main-KTzSHcut.js";import{m as ae,B as w}from"./button-Ch10pVNC.js";import{C as E}from"./card-D1C_XPb6.js";import{I as S}from"./input-CKizEs14.js";import{L as p}from"./label-BhBBP-Nu.js";import{T as ee}from"./textarea-Bz6OAfsP.js";import{B as F}from"./SidebarPremium-Bjey2152.js";import{T as We,a as He,b as me}from"./tabs-C5gSEJB4.js";import{S as se,a as te,b as re,c as ie,d as U}from"./select-CopAKCqT.js";import{u as Je}from"./use-toast-Dl4X8ZMv.js";import{c as H}from"./utils-D4V5WNQ_.js";import{F as Se}from"./file-text-DYnGBvGu.js";import{S as le}from"./square-check-big-BK5WcWjp.js";import{G as ke,S as K,A as Xe}from"./ActivityPreview-CqfOwRx8.js";import{C as ue}from"./chevron-right-DlLEuI3N.js";import"./checkbox-CilrKHh-.js";import{P as B}from"./plus-DCFQf4Ef.js";import{T as ne}from"./trash-2-CFeWlj6l.js";import{S as Ye}from"./slider-Cw6rWIj2.js";import{C as ge}from"./circle-check-DEQNaWUR.js";import{C as ve}from"./circle-x-JshNBA-O.js";import{C as Ne}from"./circle-alert-Czyt50tS.js";import{A as Ze}from"./arrow-left-C_Z1RXOs.js";import{E as qe}from"./eye-B5rNRoor.js";import{S as ea}from"./save-DLCLAimN.js";import{B as aa}from"./book-open-dxp_3U19.js";import{S as sa}from"./settings-BYjJE2lM.js";import"./bell-B4NUN7bW.js";import"./trending-up-BsXLUj7W.js";import"./user-CWyOXzMq.js";import"./users-BaZp6eLM.js";import"./graduation-cap-ArnOenSA.js";import"./index-Bp0dZcFm.js";import"./chart-column-BJvjjOHx.js";import"./x-ZCLeMxGr.js";import"./index-BpWMJgsg.js";import"./index-sBzZX1-K.js";import"./Combination-CGrYuS6N.js";import"./index-BMHZaHkZ.js";import"./index-DiimN8vU.js";import"./chevron-down-reY69kiz.js";import"./check-GWOQjZuW.js";import"./chevron-up-Bj9q73lY.js";import"./dialog-BPUI-tpC.js";import"./clock-Ca1Xubpl.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Ee=Oe("grip-vertical",ta),ra=({selectedType:a,onSelectType:r})=>{const c=[{id:"open",name:"Atividade Aberta",subtitle:"Dissertativa",icon:Se,color:"from-green-500 to-emerald-600",description:"Quest√µes dissertativas com respostas textuais",features:["Respostas escritas pelos alunos","Corre√ß√£o manual com rubricas","An√°lise de antipl√°gio dispon√≠vel"],idealFor:"An√°lises, reda√ß√µes, explica√ß√µes detalhadas"},{id:"closed",name:"Atividade Fechada",subtitle:"Objetiva",icon:le,color:"from-blue-500 to-cyan-600",description:"Quest√µes de m√∫ltipla escolha",features:["Alternativas pr√©-definidas","Corre√ß√£o autom√°tica instant√¢nea","Feedback imediato para alunos"],idealFor:"Testes, quizzes, avalia√ß√µes r√°pidas"},{id:"mixed",name:"Atividade Mista",subtitle:"H√≠brida",icon:ke,color:"from-purple-500 to-pink-600",description:"Combina quest√µes abertas e fechadas",features:["Flexibilidade m√°xima","Parte autom√°tica + parte manual","Avalia√ß√£o completa e vers√°til"],idealFor:"Provas completas, avalia√ß√µes abrangentes"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Escolha o Tipo de Atividade"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Selecione o formato que melhor se adequa √† sua avalia√ß√£o. Voc√™ n√£o poder√° mudar ap√≥s salvar."})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:c.map((l,t)=>{const u=l.icon,j=a===l.id;return e.jsx(ae.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:e.jsx(E,{className:H("p-6 cursor-pointer transition-all duration-200 hover:shadow-xl",j&&"ring-2 ring-blue-500 shadow-xl"),onClick:()=>r(l.id),children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:H("p-4 rounded-xl bg-gradient-to-br",l.color,"flex-shrink-0"),children:e.jsx(u,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:l.name}),e.jsx(F,{variant:"outline",children:l.subtitle})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:l.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Caracter√≠sticas:"}),e.jsx("ul",{className:"space-y-1",children:l.features.map((f,b)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(ue,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-green-500"}),e.jsx("span",{children:f})]},b))})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:"Ideal para:"}),e.jsx("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:l.idealFor})]})]}),j&&e.jsx(ae.div,{initial:{scale:0},animate:{scale:1},className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(le,{className:"w-5 h-5 text-white"})})})]})})},l.id)})}),a&&e.jsx(ae.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx(F,{className:"bg-green-100 text-green-700 px-4 py-2",children:"‚úì Tipo selecionado! Continue preenchendo as informa√ß√µes b√°sicas."})})]})},De=({questions:a,setQuestions:r,maxScore:c})=>{const l=()=>{r([...a,{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,image:null,attachments:[],rubric:[],expectedAnswer:""}])},t=(m,s,n)=>{r(a.map(o=>o.id===m?{...o,[s]:n}:o))},u=m=>{r(a.filter(s=>s.id!==m))},j=m=>{r(a.map(s=>s.id===m?{...s,rubric:[...s.rubric||[],{id:Date.now(),name:"",description:"",maxPoints:0}]}:s))},f=(m,s,n,o)=>{r(a.map(x=>x.id===m?{...x,rubric:x.rubric.map(d=>d.id===s?{...d,[n]:o}:d)}:x))},b=(m,s)=>{r(a.map(n=>n.id===m?{...n,rubric:n.rubric.filter(o=>o.id!==s)}:n))},M=a.reduce((m,s)=>m+(parseFloat(s.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Abertas (Dissertativas)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[a.length," quest√£o(√µes) ‚Ä¢ Total: ",M.toFixed(1)," pontos",c&&Math.abs(M-c)>.1&&e.jsxs(F,{variant:"destructive",className:"ml-2",children:["Meta: ",c," pontos"]})]})]}),e.jsxs(w,{onClick:l,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(w,{onClick:l,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((m,s)=>e.jsx(E,{className:"p-6 border-l-4 border-l-green-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 cursor-move"}),e.jsxs(F,{className:"bg-green-100 text-green-700",children:["Q",s+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Enunciado da Quest√£o *"}),e.jsx(ee,{placeholder:"Digite o enunciado da quest√£o...",value:m.text,onChange:n=>t(m.id,"text",n.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Pontua√ß√£o *"}),e.jsx(S,{type:"number",step:"0.1",min:"0",value:m.points,onChange:n=>t(m.id,"points",parseFloat(n.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"M√°x. Linhas"}),e.jsx(S,{type:"number",placeholder:"Ilimitado",value:m.maxLines||"",onChange:n=>t(m.id,"maxLines",n.target.value?parseInt(n.target.value):null),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"M√°x. Caracteres"}),e.jsx(S,{type:"number",placeholder:"Ilimitado",value:m.maxCharacters||"",onChange:n=>t(m.id,"maxCharacters",n.target.value?parseInt(n.target.value):null),className:"mt-1"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(p,{children:"Rubrica de Avalia√ß√£o (Opcional)"}),e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>j(m.id),children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Adicionar Crit√©rio"]})]}),m.rubric&&m.rubric.length>0&&e.jsx("div",{className:"space-y-3",children:m.rubric.map(n=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(S,{placeholder:"Nome do crit√©rio",value:n.name,onChange:o=>f(m.id,n.id,"name",o.target.value)}),e.jsx(S,{placeholder:"Descri√ß√£o",value:n.description,onChange:o=>f(m.id,n.id,"description",o.target.value)}),e.jsx(S,{type:"number",step:"0.1",placeholder:"Pontos m√°ximos",value:n.maxPoints,onChange:o=>f(m.id,n.id,"maxPoints",parseFloat(o.target.value))})]}),e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>b(m.id,n.id),children:e.jsx(ne,{className:"w-4 h-4 text-red-500"})})]},n.id))})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Resposta Esperada (Gabarito - Opcional)"}),e.jsx(ee,{placeholder:"Digite uma resposta de refer√™ncia para consulta durante corre√ß√£o...",value:m.expectedAnswer,onChange:n=>t(m.id,"expectedAnswer",n.target.value),className:"mt-1 min-h-[80px]"})]})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>u(m.id),children:e.jsx(ne,{className:"w-5 h-5 text-red-500"})})]})},m.id))})]})})},Pe=({questions:a,setQuestions:r,maxScore:c})=>{const l=()=>{r([...a,{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:"",hint:""}])},t=(s,n,o)=>{r(a.map(x=>x.id===s?{...x,[n]:o}:x))},u=s=>{r(a.filter(n=>n.id!==s))},j=s=>{r(a.map(n=>{if(n.id===s){const o=String.fromCharCode(65+n.alternatives.length);return{...n,alternatives:[...n.alternatives,{id:Date.now(),letter:o,text:"",isCorrect:!1}]}}return n}))},f=(s,n,o,x)=>{r(a.map(d=>d.id===s?{...d,alternatives:d.alternatives.map(h=>h.id===n?{...h,[o]:x}:h)}:d))},b=(s,n)=>{r(a.map(o=>{if(o.id===s&&o.alternatives.length>2){const x=o.alternatives.filter(d=>d.id!==n);return{...o,alternatives:x.map((d,h)=>({...d,letter:String.fromCharCode(65+h)}))}}return o}))},M=(s,n)=>{T.debug("[ClosedQuestions] ‚úÖ Marcando alternativa como correta:",{questionId:s,altId:n}),r(a.map(o=>{if(o.id===s){const x={...o,alternatives:o.alternatives.map(d=>({...d,isCorrect:d.id===n}))};return T.debug("[ClosedQuestions] Quest√£o atualizada:",x),x}return o}))},m=a.reduce((s,n)=>s+(parseFloat(n.points)||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Fechadas (Objetivas)"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:[a.length," quest√£o(√µes) ‚Ä¢ Total: ",m.toFixed(1)," pontos"]}),c&&Math.abs(m-c)>.1&&e.jsxs(F,{variant:"destructive",className:"ml-2",children:["Meta: ",c," pontos"]})]})]}),e.jsxs(w,{onClick:l,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsxs(w,{onClick:l,variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Criar Primeira Quest√£o"]})]}):e.jsx("div",{className:"space-y-6",children:a.map((s,n)=>{const o=s.alternatives?.some(x=>x.isCorrect);return e.jsx(E,{className:"p-6 border-l-4 border-l-blue-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 cursor-move"}),e.jsxs(F,{className:"bg-blue-100 text-blue-700",children:["Q",n+1]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Enunciado da Quest√£o *"}),e.jsx(ee,{placeholder:"Digite o enunciado da quest√£o...",value:s.text,onChange:x=>t(s.id,"text",x.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Pontua√ß√£o *"}),e.jsx(S,{type:"number",step:"0.1",min:"0",value:s.points,onChange:x=>t(s.id,"points",parseFloat(x.target.value)),className:"mt-1 w-32"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(p,{children:["Alternativas *",!o&&e.jsx(F,{variant:"destructive",className:"ml-2",children:"Marque a correta"})]}),e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>j(s.id),children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Adicionar Alternativa"]})]}),e.jsx("div",{className:"space-y-3",children:s.alternatives?.map(x=>e.jsxs("div",{className:"flex gap-3 items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-${s.id}`,checked:x.isCorrect,onChange:()=>M(s.id,x.id),className:"w-5 h-5 cursor-pointer",title:"Marcar como correta"}),e.jsx(F,{variant:"outline",className:"w-8 justify-center",children:x.letter})]}),e.jsx(S,{placeholder:"Texto da alternativa",value:x.text,onChange:d=>f(s.id,x.id,"text",d.target.value),className:"flex-1"}),s.alternatives.length>2&&e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>b(s.id,x.id),children:e.jsx(ne,{className:"w-4 h-4 text-red-500"})})]},x.id))})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Explica√ß√£o da Resposta Correta (Opcional)"}),e.jsx(ee,{placeholder:"Explique por que a alternativa est√° correta...",value:s.explanation,onChange:x=>t(s.id,"explanation",x.target.value),className:"mt-1 min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Dica para Alunos (Opcional)"}),e.jsx(S,{placeholder:"Uma dica que pode ajudar...",value:s.hint,onChange:x=>t(s.id,"hint",x.target.value),className:"mt-1"})]})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>u(s.id),children:e.jsx(ne,{className:"w-5 h-5 text-red-500"})})]})},s.id)})})]})})},ia=({questions:a,setQuestions:r,maxScore:c})=>{const[l,t]=v.useState("open"),u=a.filter(s=>s.type==="open"),j=a.filter(s=>s.type==="closed"),f=s=>{const n=s==="open"?{id:Date.now(),type:"open",text:"",points:1,maxLines:null,maxCharacters:null,rubric:[],expectedAnswer:""}:{id:Date.now(),type:"closed",text:"",points:1,alternatives:[{id:Date.now()+1,letter:"A",text:"",isCorrect:!1},{id:Date.now()+2,letter:"B",text:"",isCorrect:!1},{id:Date.now()+3,letter:"C",text:"",isCorrect:!1},{id:Date.now()+4,letter:"D",text:"",isCorrect:!1},{id:Date.now()+5,letter:"E",text:"",isCorrect:!1}],explanation:""};r([...a,n])},b=a.reduce((s,n)=>s+(parseFloat(n.points)||0),0),M=u.length>0?(u.reduce((s,n)=>s+n.points,0)/b*100).toFixed(0):0,m=j.length>0?(j.reduce((s,n)=>s+n.points,0)/b*100).toFixed(0):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quest√µes Mistas"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:[a.length," quest√£o(√µes) total"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[u.length," Abertas (",M,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[j.length," Fechadas (",m,"%)"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:["Total: ",b.toFixed(1)," pontos"]}),c&&Math.abs(b-c)>.1&&e.jsxs(F,{variant:"destructive",className:"ml-2",children:["Meta: ",c," pontos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{onClick:()=>f("open"),variant:"outline",className:"bg-green-50",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Quest√£o Aberta"]}),e.jsxs(w,{onClick:()=>f("closed"),variant:"outline",className:"bg-blue-50",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Quest√£o Fechada"]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"mb-4",children:"Nenhuma quest√£o adicionada ainda."}),e.jsx("p",{className:"mb-6",children:"Comece adicionando quest√µes abertas ou fechadas."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(w,{onClick:()=>f("open"),variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Aberta"]}),e.jsxs(w,{onClick:()=>f("closed"),variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Adicionar Quest√£o Fechada"]})]})]}):e.jsxs(We,{defaultValue:"all",className:"w-full",children:[e.jsxs(He,{className:"grid w-full grid-cols-3",children:[e.jsxs(me,{value:"all",children:["Todas (",a.length,")"]}),e.jsxs(me,{value:"open",children:["Abertas (",u.length,")"]}),e.jsxs(me,{value:"closed",children:["Fechadas (",j.length,")"]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:a.map((s,n)=>e.jsxs(E,{className:`p-4 border-l-4 ${s.type==="open"?"border-l-green-500":"border-l-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(F,{className:s.type==="open"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700",children:["Q",n+1," - ",s.type==="open"?"Aberta":"Fechada"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.points," pontos"]})]}),e.jsx("p",{className:"text-sm text-gray-700 truncate",children:s.text||"Sem enunciado"})]},s.id))})})]})]}),u.length>0&&e.jsx(De,{questions:u,setQuestions:s=>{r([...s,...j])},maxScore:c*(M/100)}),j.length>0&&e.jsx(Pe,{questions:j,setQuestions:s=>{r([...u,...s])},maxScore:c*(m/100)})]})},la=({settings:a,setSettings:r,activityType:c})=>{const l=(t,u)=>{r({...a,[t]:u})};return e.jsxs(E,{className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Configura√ß√µes Avan√ßadas"}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Envio Atrasado"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Permitir Envio Atrasado"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos poder√£o submeter ap√≥s o prazo"})]}),e.jsx(K,{checked:a.allowLateSubmission,onCheckedChange:t=>l("allowLateSubmission",t)})]}),a.allowLateSubmission&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Tipo de Penalidade"}),e.jsxs(se,{value:a.latePenaltyType,onValueChange:t=>l("latePenaltyType",t),children:[e.jsx(te,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(ie,{children:[e.jsx(U,{value:"percentage",children:"Percentual"}),e.jsx(U,{value:"points",children:"Pontos Fixos"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Valor da Penalidade"}),e.jsx(S,{type:"number",value:a.latePenaltyValue,onChange:t=>l("latePenaltyValue",parseFloat(t.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"M√°ximo de Dias Atrasados"}),e.jsx(S,{type:"number",value:a.maxLateDays,onChange:t=>l("maxLateDays",parseInt(t.target.value)),className:"mt-1"})]})]})]}),(c==="closed"||c==="quiz"||c==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"M√∫ltiplas Tentativas"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Permitir M√∫ltiplas Tentativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos podem refazer a atividade"})]}),e.jsx(K,{checked:a.allowMultipleAttempts,onCheckedChange:t=>l("allowMultipleAttempts",t)})]}),a.allowMultipleAttempts&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(p,{children:"M√°ximo de Tentativas"}),e.jsx(S,{type:"number",min:"1",value:a.maxAttempts,onChange:t=>l("maxAttempts",parseInt(t.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Considerar"}),e.jsxs(se,{value:a.attemptScoring,onValueChange:t=>l("attemptScoring",t),children:[e.jsx(te,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(ie,{children:[e.jsx(U,{value:"best",children:"Melhor Nota"}),e.jsx(U,{value:"last",children:"√öltima Nota"}),e.jsx(U,{value:"average",children:"M√©dia"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Tempo Limite"}),e.jsxs("div",{children:[e.jsx(p,{children:"Tempo M√°ximo (minutos)"}),e.jsx(S,{type:"number",placeholder:"Ilimitado",value:a.timeLimit||"",onChange:t=>l("timeLimit",t.target.value?parseInt(t.target.value):null),className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Deixe vazio para sem limite"})]})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Feedback e Gabarito"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Mostrar nota imediatamente"}),e.jsx(K,{checked:a.showScoreImmediately,onCheckedChange:t=>l("showScoreImmediately",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Mostrar gabarito ap√≥s submiss√£o"}),e.jsx(K,{checked:a.showAnswerKey,onCheckedChange:t=>l("showAnswerKey",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Liberar gabarito ap√≥s prazo"}),e.jsx(K,{checked:a.releaseAnswerAfterDeadline,onCheckedChange:t=>l("releaseAnswerAfterDeadline",t)})]})]})]}),(c==="open"||c==="assignment"||c==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Antipl√°gio"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Ativar Detec√ß√£o de Antipl√°gio"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verificar originalidade das respostas"})]}),e.jsx(K,{checked:a.plagiarismEnabled,onCheckedChange:t=>l("plagiarismEnabled",t)})]}),a.plagiarismEnabled&&e.jsxs("div",{className:"space-y-4 pl-4 border-l-2 border-gray-300",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Sensibilidade"}),e.jsxs(se,{value:a.plagiarismSensitivity,onValueChange:t=>l("plagiarismSensitivity",t),children:[e.jsx(te,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(ie,{children:[e.jsx(U,{value:"low",children:"Baixa"}),e.jsx(U,{value:"medium",children:"M√©dia"}),e.jsx(U,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{children:[e.jsxs(p,{children:["Originalidade M√≠nima: ",a.plagiarismMinOriginality,"%"]}),e.jsx(Ye,{value:[a.plagiarismMinOriginality],onValueChange:t=>l("plagiarismMinOriginality",t[0]),min:0,max:100,step:5,className:"mt-2"})]})]})]}),(c==="closed"||c==="quiz"||c==="mixed")&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h3",{className:"font-semibold",children:"Randomiza√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Embaralhar Quest√µes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cada aluno v√™ ordem diferente"})]}),e.jsx(K,{checked:a.shuffleQuestions,onCheckedChange:t=>l("shuffleQuestions",t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Embaralhar Alternativas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ordem aleat√≥ria das op√ß√µes"})]}),e.jsx(K,{checked:a.shuffleAlternatives,onCheckedChange:t=>l("shuffleAlternatives",t)})]})]})]})]})},na=({errors:a,warnings:r,onValidate:c,onNavigateToError:l})=>e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Valida√ß√£o da Atividade"}),e.jsx("p",{className:"text-gray-600",children:"Verifique se sua atividade est√° pronta para ser publicada"})]}),e.jsx(w,{onClick:c,className:"w-full",children:"Executar Valida√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(E,{className:"p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ge,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"V√°lido"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.length===0?"‚úì":"‚Äî"})]}),e.jsxs(E,{className:"p-4 bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ve,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Erros"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.length})]}),e.jsxs(E,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ne,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"Avisos"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:r.length})]})]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"w-5 h-5 text-red-600"}),e.jsxs("h3",{className:"font-semibold text-red-600",children:["Erros Cr√≠ticos (",a.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:a.map((t,u)=>e.jsx(E,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-l-red-500 cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>l(t.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(F,{variant:"destructive",className:"mb-2",children:t.field}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:t.message})]}),e.jsx(ue,{className:"w-5 h-5 text-red-600 flex-shrink-0"})]})},u))}),e.jsx("p",{className:"text-sm text-red-600 mt-3",children:"‚ùå Corrija todos os erros antes de publicar a atividade."})]}),r.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("h3",{className:"font-semibold text-yellow-600",children:["Avisos (",r.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:r.map((t,u)=>e.jsx(E,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-l-yellow-500 cursor-pointer hover:bg-yellow-100 transition-colors",onClick:()=>l(t.field),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(F,{variant:"outline",className:"mb-2 border-yellow-600 text-yellow-700",children:t.field}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:t.message})]}),e.jsx(ue,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"})]})},u))}),e.jsx("p",{className:"text-sm text-yellow-600 mt-3",children:"‚ö†Ô∏è Avisos n√£o impedem a publica√ß√£o, mas √© recomendado corrigi-los."})]}),a.length===0&&r.length===0&&e.jsx(E,{className:"p-6 bg-green-50 dark:bg-green-900/20 border-2 border-green-500",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800 dark:text-green-200",children:"Atividade Pronta!"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Sua atividade est√° v√°lida e pronta para ser publicada."})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Checklist Geral"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{checked:a.filter(t=>t.field==="title").length===0,label:"T√≠tulo v√°lido"}),e.jsx(X,{checked:a.filter(t=>t.field==="description").length===0,label:"Descri√ß√£o v√°lida"}),e.jsx(X,{checked:a.filter(t=>t.field==="questions").length===0,label:"Pelo menos uma quest√£o"}),e.jsx(X,{checked:a.filter(t=>t.field.startsWith("question")).length===0,label:"Todas as quest√µes v√°lidas"}),e.jsx(X,{checked:r.filter(t=>t.field==="tags").length===0,label:"Tags adicionadas",warning:!0}),e.jsx(X,{checked:r.filter(t=>t.field==="score").length===0,label:"Pontua√ß√£o consistente",warning:!0})]})]})]})}),X=({checked:a,label:r,warning:c=!1})=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800",children:[a?e.jsx(ge,{className:`w-5 h-5 ${c?"text-yellow-600":"text-green-600"}`}):e.jsx(ve,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:`text-sm ${a?"text-gray-900 dark:text-gray-100":"text-gray-500"}`,children:r})]}),k=[];for(let a=0;a<256;++a)k.push((a+256).toString(16).slice(1));function ca(a,r=0){return(k[a[r+0]]+k[a[r+1]]+k[a[r+2]]+k[a[r+3]]+"-"+k[a[r+4]]+k[a[r+5]]+"-"+k[a[r+6]]+k[a[r+7]]+"-"+k[a[r+8]]+k[a[r+9]]+"-"+k[a[r+10]]+k[a[r+11]]+k[a[r+12]]+k[a[r+13]]+k[a[r+14]]+k[a[r+15]]).toLowerCase()}let xe;const oa=new Uint8Array(16);function da(){if(!xe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");xe=crypto.getRandomValues.bind(crypto)}return xe(oa)}const ma=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),we={randomUUID:ma};function xa(a,r,c){a=a||{};const l=a.random??a.rng?.()??da();if(l.length<16)throw new Error("Random bytes length must be >= 16");return l[6]=l[6]&15|64,l[8]=l[8]&63|128,ca(l)}function he(a,r,c){return we.randomUUID&&!a?we.randomUUID():xa(a)}const q={DRAFTS:"drafts",ACTIVITIES:"activities",SUBMISSIONS:"submissions"},ha=async(a,r,c="")=>{try{const l=a.name.split(".").pop(),t=`${Math.random().toString(36).substring(2,15)}-${Date.now()}.${l}`,u=c?`${c}/${t}`:t,{data:j,error:f}=await C.storage.from(r).upload(u,a,{cacheControl:"3600",upsert:!1});if(f)throw f;const{data:{publicUrl:b}}=C.storage.from(r).getPublicUrl(u);return{data:{path:j.path,publicUrl:b,fileName:a.name,fileType:a.type,size:a.size},error:null}}catch(l){return T.error("Error uploading file:",l),{data:null,error:l}}},Te=async(a,r)=>{try{const{data:c,error:l}=await C.storage.from(a).remove([r]);if(l)throw l;return{data:c,error:null}}catch(c){return T.error("Error removing file:",c),{data:null,error:c}}},pa=(a,r)=>{const{data:c}=C.storage.from(a).getPublicUrl(r);return c.publicUrl},ua=async(a,r,c,l)=>{try{const{data:t,error:u}=await C.storage.from(a).download(r);if(u)throw u;const{data:j,error:f}=await ha(new File([t],l.split("/").pop(),{type:t.type}),c,l.split("/").slice(0,-1).join("/"));if(f)throw f;return await Te(a,r),{data:j,error:null}}catch(t){return T.error("Error moving file:",t),{data:null,error:t}}},Ce=a=>a&&a.startsWith("image/"),pe=(a,r,c={})=>{const{width:l=300,height:t=300,quality:u=80,resize:j="cover"}=c,{data:f}=C.storage.from(a).getPublicUrl(r,{transform:{width:l,height:t,resize:j,quality:u}});return f.publicUrl},Ae=(a,r)=>({small:pe(a,r,{width:150,height:150}),medium:pe(a,r,{width:300,height:300}),large:pe(a,r,{width:600,height:600}),original:pa(a,r)}),ga=(a,r,c=!1)=>{const[l,t]=v.useState(!1),[u,j]=v.useState(0),[f,b]=v.useState(null),M=v.useCallback(()=>c?q.DRAFTS:q.ACTIVITIES,[c]),m=v.useCallback(d=>{const h=Date.now(),y=d.split(".").pop(),Q=he();return`${r}/${a}/${h}-${Q}.${y}`},[a,r]),s=v.useCallback(async d=>{if(!d)return null;t(!0),b(null);try{const h=M(),y=m(d.name),Q={cacheControl:"3600",upsert:!1,onProgress:N=>{const O=Math.round(N.loaded/N.total*100);j(O)}},{data:D,error:V}=await C.storage.from(h).upload(y,d,Q);if(V)throw V;const{data:{publicUrl:I}}=C.storage.from(h).getPublicUrl(y),L={id:he(),name:d.name,url:I,path:D.path,size:d.size,type:d.type,isNew:!0,isImage:Ce(d.type)};return L.isImage&&(L.thumbnails=Ae(h,D.path)),L}catch(h){throw T.error("Erro ao fazer upload do arquivo:",h),b(h.message||"Erro ao fazer upload do arquivo"),h}finally{t(!1),j(0)}},[M,m]),n=v.useCallback(async d=>{if(!d)return!1;try{const h=M(),{error:y}=await Te(h,d);if(y)throw y;return!0}catch(h){throw T.error("Erro ao remover arquivo:",h),b(h.message||"Erro ao remover o arquivo"),h}},[M]),o=v.useCallback(async(d=null)=>{try{if(!c)throw new Error("Apenas rascunhos podem ser publicados");const h=q.DRAFTS,y=q.ACTIVITIES,Q=`${r}/${a||"temp"}`,D=`${r}/${d||a}`,{data:V,error:I}=await C.storage.from(h).list(Q);if(I)throw I;const L=[];for(const N of V){const O=`${Q}/${N.name}`,P=`${D}/${N.name}`,{error:Y}=await ua(h,O,y,P);if(Y){T.warn(`Falha ao mover o arquivo ${N.name}:`,Y);continue}const{data:{publicUrl:$}}=C.storage.from(y).getPublicUrl(P);L.push({originalPath:O,newPath:P,url:$,name:N.name,type:N.metadata?.mimetype||"application/octet-stream",size:N.metadata?.size||0})}return L}catch(h){throw T.error("Erro ao publicar arquivos da atividade:",h),b(h.message||"Erro ao publicar os arquivos da atividade"),h}},[a,c,r]),x=v.useCallback(async(d,h)=>{if(!d||!h)throw new Error("Arquivo e ID de submiss√£o s√£o obrigat√≥rios");t(!0),b(null);try{const y=q.SUBMISSIONS,Q=`${r}/${a}/${h}/${d.name}`,D={cacheControl:"3600",upsert:!1,onProgress:O=>{const P=Math.round(O.loaded/O.total*100);j(P)}},{data:V,error:I}=await C.storage.from(y).upload(Q,d,D);if(I)throw I;const{data:{publicUrl:L}}=C.storage.from(y).getPublicUrl(Q),N={id:he(),name:d.name,url:L,path:V.path,size:d.size,type:d.type,isNew:!0,isImage:Ce(d.type)};return N.isImage&&(N.thumbnails=Ae(y,V.path)),N}catch(y){throw T.error("Erro ao fazer upload da submiss√£o:",y),b(y.message||"Erro ao fazer upload da submiss√£o"),y}finally{t(!1),j(0)}},[a,r]);return{isUploading:l,uploadProgress:u,error:f,uploadActivityFile:s,removeActivityFile:n,publishActivityFiles:o,uploadSubmission:x,resetError:()=>b(null)}},cs=()=>{const a=Re(),{id:r}=Be(),{user:c}=Ge(),{toast:l}=Je(),t=!!r,[u,j]=v.useState(t),[f,b]=v.useState(!1),[M,m]=v.useState(null),[s,n]=v.useState(null),[o,x]=v.useState(""),[d,h]=v.useState(""),[y,Q]=v.useState(""),[D,V]=v.useState([]),[I,L]=v.useState("medium"),[N,O]=v.useState(""),[P,Y]=v.useState(10),[$,Z]=v.useState([]),[ce,je]=v.useState([]),[W,fe]=v.useState({allowLateSubmission:!1,latePenaltyType:"percentage",latePenaltyValue:10,maxLateDays:7,allowMultipleAttempts:!1,maxAttempts:1,attemptScoring:"best",timeLimit:null,showScoreImmediately:!0,showAnswerKey:!1,releaseAnswerAfterDeadline:!0,plagiarismEnabled:!1,plagiarismSensitivity:"medium",plagiarismMinOriginality:70,shuffleQuestions:!1,shuffleAlternatives:!1}),[_,R]=v.useState(t?"basics":"type"),[Fe,be]=v.useState(!1),[oe,Me]=v.useState([]),[de,$e]=v.useState([]),{publishActivityFiles:Ie}=ga(r||"temp",c?.id,!t);v.useEffect(()=>{if(!s)return;const i=setInterval(()=>{Ue()},6e4);return()=>clearInterval(i)},[s,o,d,$,W]),v.useEffect(()=>{t?Qe():ze()},[r]);const ze=()=>{try{const i=sessionStorage.getItem("importedActivity");if(i){const g=JSON.parse(i);x(g.title||""),h(g.description||""),n("open"),g.content&&Z([{id:Date.now().toString(),type:"open",prompt:g.content,maxScore:10,rubric:""}]),l({title:"üì• Atividade importada",description:`Conte√∫do de "${g.importedFrom}" carregado. Revise e edite conforme necess√°rio.`}),sessionStorage.removeItem("importedActivity"),R("questions")}}catch(i){T.error("Erro ao carregar dados importados:",i)}},Qe=async()=>{try{j(!0);const{data:i,error:g}=await C.from("activities").select("*").eq("id",r).single();if(g)throw g;n(i.type),x(i.title),h(i.description||""),Q(i.content?.subject||""),V(i.content?.tags||[]),L(i.content?.difficulty||"medium"),O(i.content?.estimated_time||""),Y(i.max_score||10),Z(i.content?.questions||[]),je(i.content?.attachments||[]),i.content?.advanced_settings&&fe(i.content.advanced_settings),l({title:"Atividade carregada",description:"Voc√™ pode editar e salvar as altera√ß√µes."})}catch(i){T.error("Erro ao carregar atividade:",i),l({title:"Erro",description:"N√£o foi poss√≠vel carregar a atividade.",variant:"destructive"}),a("/dashboard/activities")}finally{j(!1)}},Ue=async()=>{if(!(!o||!s))try{const i={title:o,description:d,type:s,max_score:P,status:"draft",content:{subject:y,tags:D,difficulty:I,estimated_time:N,questions:$,attachments:ce,advanced_settings:W},created_by:c.id,updated_at:new Date().toISOString()};if(t){const{error:g}=await C.from("activities").update(i).eq("id",r);if(g)throw g}m(new Date)}catch(i){T.error("Erro no auto-save:",i)}},ye=()=>{const i=[],g=[];(!o||o.trim().length<3)&&i.push({field:"title",message:"T√≠tulo deve ter pelo menos 3 caracteres"}),(!d||d.trim().length<10)&&i.push({field:"description",message:"Descri√ß√£o deve ter pelo menos 10 caracteres"}),$.length===0&&i.push({field:"questions",message:"Adicione pelo menos uma quest√£o"}),$.forEach((A,z)=>{(!A.text||A.text.trim().length<5)&&i.push({field:`question-${z}`,message:`Quest√£o ${z+1}: enunciado muito curto`}),(!A.points||A.points<=0)&&i.push({field:`question-${z}`,message:`Quest√£o ${z+1}: pontua√ß√£o inv√°lida`}),(s==="closed"||s==="quiz")&&A.type==="closed"&&((!A.alternatives||A.alternatives.length<2)&&i.push({field:`question-${z}`,message:`Quest√£o ${z+1}: deve ter pelo menos 2 alternativas`}),(A.alternatives?.filter(_e=>_e.isCorrect)||[]).length===0&&i.push({field:`question-${z}`,message:`Quest√£o ${z+1}: marque pelo menos uma alternativa correta`}))}),D.length===0&&g.push({field:"tags",message:"Considere adicionar tags para facilitar a organiza√ß√£o"}),N||g.push({field:"time",message:"Tempo estimado n√£o definido"});const G=$.reduce((A,z)=>A+(z.points||0),0);return Math.abs(G-P)>.1&&g.push({field:"score",message:`Soma das quest√µes (${G}) difere da pontua√ß√£o m√°xima (${P})`}),Me(i),$e(g),i.length===0},Ve=async()=>{if(!o||o.trim().length<3){l({title:"T√≠tulo obrigat√≥rio",description:"Defina um t√≠tulo para salvar o rascunho.",variant:"destructive"});return}if(!s){l({title:"Tipo obrigat√≥rio",description:"Selecione o tipo de atividade.",variant:"destructive"});return}try{b(!0);const i={title:o.trim(),description:d?.trim()||"",type:s,max_score:P,status:"draft",content:{subject:y,tags:D,difficulty:I,estimated_time:N,questions:$,attachments:ce,advanced_settings:W},created_by:c.id,updated_at:new Date().toISOString()};if(console.log("[TeacherActivityCreatePage] üíæ Salvando atividade:",{title:o,type:s,questionsCount:$.length,advancedSettings:W}),t){const{error:g}=await C.from("activities").update(i).eq("id",r);if(g)throw g;l({title:"Rascunho salvo",description:"Suas altera√ß√µes foram salvas."})}else{const{data:g,error:G}=await C.from("activities").insert(i).select().single();if(G)throw G;l({title:"‚úÖ Rascunho salvo!",description:"Atividade salva como rascunho. Aparecer√° na sua lista de atividades."}),a(`/teacher/activities/${g.id}/edit`,{replace:!0})}m(new Date)}catch(i){T.error("Erro ao salvar rascunho:",i),l({title:"Erro",description:"N√£o foi poss√≠vel salvar o rascunho.",variant:"destructive"})}finally{b(!1)}},Le=async()=>{if(!ye()){l({title:"Valida√ß√£o falhou",description:"Corrija os erros antes de publicar.",variant:"destructive"});return}if(!(de.length>0&&!window.confirm(`H√° ${de.length} aviso(s). Deseja publicar mesmo assim?`)))try{b(!0);let i={title:o,description:d,type:s,max_score:P,status:"published",is_published:!0,content:{subject:y,tags:D,difficulty:I,estimated_time:N,questions:$,attachments:ce,advanced_settings:W},created_by:c.id,updated_at:new Date().toISOString()};if(t){const{error:g}=await C.from("activities").update(i).eq("id",r);if(g)throw g}else{const{data:g,error:G}=await C.from("activities").insert(i).select().single();if(G)throw G;try{const A=await Ie(g.id);if(A&&A.length>0){const z=A.map(J=>({name:J.name,url:J.url,path:J.newPath,size:J.size,type:J.type}));i={...i,content:{...i.content,attachments:z}},await C.from("activities").update(i).eq("id",g.id),je(z)}}catch(A){T.warn("Falha ao mover anexos de rascunho ao publicar:",A)}}l({title:"Atividade publicada!",description:"Agora voc√™ pode postar em suas turmas."}),a("/dashboard/activities")}catch(i){T.error("Erro ao publicar:",i),l({title:"Erro",description:"N√£o foi poss√≠vel publicar a atividade.",variant:"destructive"})}finally{b(!1)}};return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ke,{size:"lg",text:"Carregando atividade..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>a("/dashboard/activities"),children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:t?`Editar: ${o||"Atividade"}`:"Criar Nova Atividade"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(F,{variant:s?"default":"secondary",children:s||"Tipo n√£o definido"}),e.jsx(F,{variant:"outline",children:t?"Editando":"Nova"}),M&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Salvo ",Math.floor((new Date-M)/1e3),"s atr√°s"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(w,{variant:"outline",onClick:()=>be(!0),disabled:!s,children:[e.jsx(qe,{className:"w-5 h-5 mr-2"}),"Pr√©via"]}),e.jsxs(w,{variant:"outline",onClick:Ve,disabled:f||!s||!o||o.trim().length<3,children:[e.jsx(ea,{className:"w-5 h-5 mr-2"}),f?"Salvando...":"Salvar"]}),e.jsxs(w,{onClick:Le,disabled:f||!s,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(le,{className:"w-5 h-5 mr-2"}),t?"Publicar Altera√ß√µes":"Publicar Atividade"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(E,{className:"p-4 sticky top-6",children:e.jsxs("nav",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>R("type"),className:H("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="type"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:t,children:[e.jsx(ke,{className:"w-4 h-4 inline mr-2"}),"Tipo de Atividade"]}),e.jsxs("button",{onClick:()=>R("basics"),className:H("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="basics"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(aa,{className:"w-4 h-4 inline mr-2"}),"Informa√ß√µes B√°sicas"]}),e.jsxs("button",{onClick:()=>R("questions"),className:H("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="questions"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),disabled:!s,children:[e.jsx(Se,{className:"w-4 h-4 inline mr-2"}),"Quest√µes (",$.length,")"]}),e.jsxs("button",{onClick:()=>R("advanced"),className:H("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="advanced"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(sa,{className:"w-4 h-4 inline mr-2"}),"Configura√ß√µes"]}),e.jsxs("button",{onClick:()=>R("validation"),className:H("w-full text-left px-4 py-2 rounded-lg transition-colors",_==="validation"?"bg-blue-100 text-blue-700 font-semibold":"hover:bg-gray-100"),children:[e.jsx(le,{className:"w-4 h-4 inline mr-2"}),"Valida√ß√£o",oe.length>0&&e.jsx(F,{variant:"destructive",className:"ml-2",children:oe.length})]})]})})}),e.jsx("div",{className:"col-span-9",children:e.jsxs(ae.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[_==="type"&&!t&&e.jsx(ra,{selectedType:s,onSelectType:i=>{n(i),R("basics")}}),_==="basics"&&e.jsxs(E,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Informa√ß√µes B√°sicas"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",children:"T√≠tulo da Atividade *"}),e.jsx(S,{id:"title",placeholder:"Ex: Avalia√ß√£o de √Ålgebra Linear - Unidade 2",value:o,onChange:i=>x(i.target.value),className:"mt-1",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[o.length,"/200 caracteres"]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"description",children:"Descri√ß√£o *"}),e.jsx(ee,{id:"description",placeholder:"Descreva o objetivo e instru√ß√µes gerais da atividade...",value:d,onChange:i=>h(i.target.value),className:"mt-1 min-h-[120px]",maxLength:2e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[d.length,"/2000 caracteres"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"subject",children:"Disciplina/Mat√©ria *"}),e.jsx(S,{id:"subject",placeholder:"Ex: Matem√°tica",value:y,onChange:i=>Q(i.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"difficulty",children:"Dificuldade"}),e.jsxs(se,{value:I,onValueChange:L,children:[e.jsx(te,{className:"mt-1",children:e.jsx(re,{})}),e.jsxs(ie,{children:[e.jsx(U,{value:"easy",children:"F√°cil"}),e.jsx(U,{value:"medium",children:"M√©dia"}),e.jsx(U,{value:"hard",children:"Dif√≠cil"}),e.jsx(U,{value:"very_hard",children:"Muito Dif√≠cil"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"time",children:"Tempo Estimado (minutos)"}),e.jsx(S,{id:"time",type:"number",placeholder:"45",value:N,onChange:i=>O(i.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"maxScore",children:"Pontua√ß√£o M√°xima Total *"}),e.jsx(S,{id:"maxScore",type:"number",step:"0.1",min:"0.1",max:"100",value:P,onChange:i=>Y(parseFloat(i.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"tags",children:"T√≥picos/Tags"}),e.jsx(S,{id:"tags",placeholder:"Pressione Enter para adicionar (Ex: √Ålgebra, Matrizes)",onKeyDown:i=>{i.key==="Enter"&&i.target.value.trim()&&(i.preventDefault(),D.includes(i.target.value.trim())||(V([...D,i.target.value.trim()]),i.target.value=""))},className:"mt-1"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:D.map((i,g)=>e.jsxs(F,{variant:"secondary",className:"cursor-pointer hover:bg-red-100",onClick:()=>V(D.filter((G,A)=>A!==g)),children:["#",i," √ó"]},g))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{onClick:()=>R("questions"),disabled:!o||!d||!y,children:"Pr√≥ximo: Adicionar Quest√µes"})})]})]}),_==="questions"&&s&&e.jsxs(e.Fragment,{children:[(s==="open"||s==="assignment")&&e.jsx(De,{questions:$,setQuestions:Z,maxScore:P}),(s==="closed"||s==="quiz")&&e.jsx(Pe,{questions:$,setQuestions:Z,maxScore:P}),(s==="mixed"||s==="project")&&e.jsx(ia,{questions:$,setQuestions:Z,maxScore:P})]}),_==="advanced"&&e.jsx(la,{settings:W,setSettings:fe,activityType:s}),_==="validation"&&e.jsx(na,{errors:oe,warnings:de,onValidate:ye,onNavigateToError:i=>{i.startsWith("question")?R("questions"):["title","description","subject"].includes(i)&&R("basics")}})]},_)})]}),Fe&&e.jsx(Xe,{activity:{title:o,description:d,type:s,subject:y,tags:D,difficulty:I,estimatedTime:N,maxScore:P,questions:$,advancedSettings:W},onClose:()=>be(!1)})]})};export{cs as default};
