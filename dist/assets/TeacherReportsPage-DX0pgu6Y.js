import{c as ae,r as o,d as de,f as ot,s as P,j as s,a as lt,l as I}from"./main-xLo6udtn.js";import{C as G}from"./card-Dx7Jgzpa.js";import{B as _,m as ct}from"./button-kJAiAr98.js";import{e as _e}from"./SidebarPremium-DR7y_WVE.js";import{L as se}from"./label-DyvOCM21.js";import{T as dt,a as ut,b as Re,c as Te}from"./tabs-CKi2t175.js";import{S as ie,a as ne,b as oe,c as le,d as B}from"./select-3dEQnqpZ.js";import{D as mt}from"./DashboardHeader-Fk4YpPE0.js";import"./input-DgX5viI9.js";import"./dropdown-menu-DnU0Q9ro.js";import{u as Je}from"./use-toast-vskN8pxt.js";import{D as pt}from"./download-Nm2BlV1O.js";import{S as ht}from"./share-2-B9udQeJe.js";import{X as Ze}from"./x-TovB2v9O.js";import{a as Ye,S as ft,u as ue,s as vt,i as be,b as gt,c as bt,d as xt,e as yt,f as jt,g as Xe,h as wt,j as De,k as Nt,l as me,m as Y,n as Qe,o as Pt,p as Et,r as et,q as tt,R as At,t as St,G as Ot,v as at,w as kt,L as Q,x as Ct,y as _t,J as Rt,z as Tt,A as Le,B as ce,C as xe,P as Dt,D as Lt,E as $t,F as It,H as Mt,I as Ft,K as te,M as $e,N as Bt,T as zt,O as qt,Q as fe,U as ve,V as Ut,W as Ie,X as Me,Y as Fe,Z as Gt}from"./LineChart-xL2S320q.js";import{s as Vt,P as Kt}from"./PolarChart-OPZBFlqh.js";import{S as Ht,C as Ne,u as Wt,a as Jt,b as Zt,c as Yt,B as Xt,d as Qt}from"./BarChart-DuyXZ8NI.js";import{H as Be}from"./history-U_1G2gXW.js";import{S as ea}from"./settings-DOhJboSP.js";import{P as ge}from"./plus-6e-N7h4j.js";import{F as ta}from"./funnel-BhpZgD0i.js";import{U as aa}from"./user-CPO161me.js";import{U as ra}from"./users-DCtnf_zM.js";import{C as sa}from"./clipboard-list-DnDQPy22.js";import{F as ye}from"./index-B011I92U.js";import{S as ia}from"./star-ChkSBp_0.js";import{E as na}from"./eye-BwLjAouB.js";import"./bell-BOqEGMh0.js";import"./chevron-right-DPHp2bZu.js";import"./trending-up-C7AKYn4D.js";import"./house-J__Uznqs.js";import"./graduation-cap-2hF78yH2.js";import"./index-CQo-NcO2.js";import"./chart-column-bkS3L9w7.js";import"./index-U6BCfgX1.js";import"./index-CSUB1fH-.js";import"./index-C_3Lq57v.js";import"./index-DGEpRYgg.js";import"./index-BOXlNAp7.js";import"./chevron-down-BADIEq5f.js";import"./check-mlCLJg9E.js";import"./chevron-up-BloFXwR0.js";import"./index-BOEIzAt_.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],la=ae("chart-no-axes-column-increasing",oa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],da=ae("file-image",ca);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],ma=ae("file-spreadsheet",ua);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],ha=ae("git-compare",pa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],va=ae("printer",fa);function je(){return je=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},je.apply(null,arguments)}function ze(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function ga(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?ze(Object(a),!0).forEach(function(r){Pe(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ze(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Pe(t,e,a){return(e=ba(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function ba(t){var e=xa(t,"string");return typeof e=="symbol"?e:e+""}function xa(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var L=32;class Ee extends o.PureComponent{renderIcon(e,a){var{inactiveColor:r}=this.props,i=L/2,n=L/6,u=L/3,c=e.inactive?r:e.color,p=a??e.type;if(p==="none")return null;if(p==="plainline")return o.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:e.payload.strokeDasharray,x1:0,y1:i,x2:L,y2:i,className:"recharts-legend-icon"});if(p==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(i,"h").concat(u,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(2*u,",").concat(i,`
            H`).concat(L,"M").concat(2*u,",").concat(i,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(u,",").concat(i),className:"recharts-legend-icon"});if(p==="rect")return o.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(L/8,"h").concat(L,"v").concat(L*3/4,"h").concat(-L,"z"),className:"recharts-legend-icon"});if(o.isValidElement(e.legendIcon)){var f=ga({},e);return delete f.legendIcon,o.cloneElement(e.legendIcon,f)}return o.createElement(Ht,{fill:c,cx:i,cy:i,size:L,sizeType:"diameter",type:p})}renderItems(){var{payload:e,iconSize:a,layout:r,formatter:i,inactiveColor:n,iconType:u}=this.props,c={x:0,y:0,width:L,height:L},p={display:r==="horizontal"?"inline-block":"block",marginRight:10},f={display:"inline-block",verticalAlign:"middle",marginRight:4};return e.map((m,g)=>{var d=m.formatter||i,h=de({"recharts-legend-item":!0,["legend-item-".concat(g)]:!0,inactive:m.inactive});if(m.type==="none")return null;var v=m.inactive?n:m.color,j=d?d(m.value,m,g):m.value;return o.createElement("li",je({className:h,style:p,key:"legend-item-".concat(g)},Ye(this.props,m,g)),o.createElement(ft,{width:a,height:a,viewBox:c,style:f,"aria-label":"".concat(j," legend icon")},this.renderIcon(m,u)),o.createElement("span",{className:"recharts-legend-item-text",style:{color:v}},j))})}render(){var{payload:e,layout:a,align:r}=this.props;if(!e||!e.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?r:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}Pe(Ee,"displayName","Legend");Pe(Ee,"defaultProps",{align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"});function ya(){return ue(vt)}var ja=["contextPayload"];function we(){return we=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},we.apply(null,arguments)}function qe(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function ee(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?qe(Object(a),!0).forEach(function(r){Ae(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):qe(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ae(t,e,a){return(e=wa(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function wa(t){var e=Na(t,"string");return typeof e=="symbol"?e:e+""}function Na(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Pa(t,e){if(t==null)return{};var a,r,i=Ea(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function Ea(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function Aa(t){return t.value}function Sa(t){var{contextPayload:e}=t,a=Pa(t,ja),r=Nt(e,t.payloadUniqBy,Aa),i=ee(ee({},a),{},{payload:r});return o.isValidElement(t.content)?o.cloneElement(t.content,i):typeof t.content=="function"?o.createElement(t.content,i):o.createElement(Ee,i)}function Oa(t,e,a,r,i,n){var{layout:u,align:c,verticalAlign:p}=e,f,m;return(!t||(t.left===void 0||t.left===null)&&(t.right===void 0||t.right===null))&&(c==="center"&&u==="vertical"?f={left:((r||0)-n.width)/2}:f=c==="right"?{right:a&&a.right||0}:{left:a&&a.left||0}),(!t||(t.top===void 0||t.top===null)&&(t.bottom===void 0||t.bottom===null))&&(p==="middle"?m={top:((i||0)-n.height)/2}:m=p==="bottom"?{bottom:a&&a.bottom||0}:{top:a&&a.top||0}),ee(ee({},f),m)}function ka(t){var e=Xe();return o.useEffect(()=>{e(wt(t))},[e,t]),null}function Ca(t){var e=Xe();return o.useEffect(()=>(e(De(t)),()=>{e(De({width:0,height:0}))}),[e,t]),null}function _a(t){var e=ya(),a=gt(),r=bt(),{width:i,height:n,wrapperStyle:u,portal:c}=t,[p,f]=xt([e]),m=yt(),g=jt();if(m==null||g==null)return null;var d=m-(r.left||0)-(r.right||0),h=X.getWidthOrHeight(t.layout,n,i,d),v=c?u:ee(ee({position:"absolute",width:h?.width||i||"auto",height:h?.height||n||"auto"},Oa(u,t,r,m,g,p)),u),j=c??a;if(j==null)return null;var S=o.createElement("div",{className:"recharts-legend-wrapper",style:v,ref:f},o.createElement(ka,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),o.createElement(Ca,{width:p.width,height:p.height}),o.createElement(Sa,we({},t,h,{margin:r,chartWidth:m,chartHeight:g,contextPayload:e})));return ot.createPortal(S,j)}class X extends o.PureComponent{static getWidthOrHeight(e,a,r,i){return e==="vertical"&&be(a)?{height:a}:e==="horizontal"?{width:r||i}:null}render(){return o.createElement(_a,this.props)}}Ae(X,"displayName","Legend");Ae(X,"defaultProps",{align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"});function Ue(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function Ge(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Ue(Object(a),!0).forEach(function(r){Ra(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ue(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ra(t,e,a){return(e=Ta(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Ta(t){var e=Da(t,"string");return typeof e=="symbol"?e:e+""}function Da(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var La=(t,e)=>e,Se=me([Vt,La],(t,e)=>t.filter(a=>a.type==="pie").find(a=>a.id===e)),$a=[],Oe=(t,e,a)=>a?.length===0?$a:a,rt=me([Et,Se,Oe],(t,e,a)=>{var{chartData:r}=t;if(e!=null){var i;if(e?.data!=null&&e.data.length>0?i=e.data:i=r,(!i||!i.length)&&a!=null&&(i=a.map(n=>Ge(Ge({},e.presentationProps),n.props))),i!=null)return i}}),Ia=me([rt,Se,Oe],(t,e,a)=>{if(!(t==null||e==null))return t.map((r,i)=>{var n,u=Y(r,e.nameKey,e.name),c;return a!=null&&(n=a[i])!==null&&n!==void 0&&(n=n.props)!==null&&n!==void 0&&n.fill?c=a[i].props.fill:typeof r=="object"&&r!=null&&"fill"in r?c=r.fill:c=e.fill,{value:Qe(u,e.dataKey),color:c,payload:r,type:e.legendType}})}),Ma=me([rt,Se,Oe,Pt],(t,e,a,r)=>{if(!(e==null||t==null))return sr({offset:r,pieSettings:e,displayedData:t,cells:a})}),Fa=["onMouseEnter","onClick","onMouseLeave"],Ba=["id"],za=["id"];function ke(t,e){if(t==null)return{};var a,r,i=qa(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function qa(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function Ve(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function N(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Ve(Object(a),!0).forEach(function(r){Ua(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ve(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ua(t,e,a){return(e=Ga(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Ga(t){var e=Va(t,"string");return typeof e=="symbol"?e:e+""}function Va(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function K(){return K=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},K.apply(null,arguments)}function Ka(t){var e=o.useMemo(()=>at(t.children,Ne),[t.children]),a=ue(r=>Ia(r,t.id,e));return a==null?null:o.createElement(kt,{legendPayload:a})}function Ha(t){var{dataKey:e,nameKey:a,sectors:r,stroke:i,strokeWidth:n,fill:u,name:c,hide:p,tooltipType:f}=t;return{dataDefinedOnItem:r.map(m=>m.tooltipPayload),positions:r.map(m=>m.tooltipPosition),settings:{stroke:i,strokeWidth:n,fill:u,dataKey:e,nameKey:a,name:Qe(c,e),hide:p,type:f,color:u,unit:""}}}var Wa=(t,e)=>t>e?"start":t<e?"end":"middle",Ja=(t,e,a)=>typeof e=="function"?te(e(t),a,a*.8):te(e,a,a*.8),Za=(t,e,a)=>{var{top:r,left:i,width:n,height:u}=e,c=Ft(n,u),p=i+te(t.cx,n,n/2),f=r+te(t.cy,u,u/2),m=te(t.innerRadius,c,0),g=Ja(a,t.outerRadius,c),d=t.maxRadius||Math.sqrt(n*n+u*u)/2;return{cx:p,cy:f,innerRadius:m,outerRadius:g,maxRadius:d}},Ya=(t,e)=>{var a=ce(e-t),r=Math.min(Math.abs(e-t),360);return a*r};function Xa(t){return t&&typeof t=="object"&&"className"in t&&typeof t.className=="string"?t.className:""}var Qa=(t,e)=>{if(o.isValidElement(t))return o.cloneElement(t,e);if(typeof t=="function")return t(e);var a=de("recharts-pie-label-line",typeof t!="boolean"?t.className:"");return o.createElement(Bt,K({},e,{type:"linear",className:a}))},er=(t,e,a)=>{if(o.isValidElement(t))return o.cloneElement(t,e);var r=a;if(typeof t=="function"&&(r=t(e),o.isValidElement(r)))return r;var i=de("recharts-pie-label-text",Xa(t));return o.createElement(zt,K({},e,{alignmentBaseline:"middle",className:i}),r)};function tr(t){var{sectors:e,props:a,showLabels:r}=t,{label:i,labelLine:n,dataKey:u}=a;if(!r||!i||!e)return null;var c=tt(a),p=$e(i),f=$e(n),m=typeof i=="object"&&"offsetRadius"in i&&typeof i.offsetRadius=="number"&&i.offsetRadius||20,g=e.map((d,h)=>{var v=(d.startAngle+d.endAngle)/2,j=xe(d.cx,d.cy,d.outerRadius+m,v),S=N(N(N(N({},c),d),{},{stroke:"none"},p),{},{index:h,textAnchor:Wa(j.x,d.cx)},j),M=N(N(N(N({},c),d),{},{fill:"none",stroke:d.fill},f),{},{index:h,points:[xe(d.cx,d.cy,d.outerRadius,v),j],key:"line"});return o.createElement(Q,{key:"label-".concat(d.startAngle,"-").concat(d.endAngle,"-").concat(d.midAngle,"-").concat(h)},n&&Qa(n,M),er(i,S,Y(d,u)))});return o.createElement(Q,{className:"recharts-pie-labels"},g)}function ar(t){var{sectors:e,props:a,showLabels:r}=t,{label:i}=a;return typeof i=="object"&&i!=null&&"position"in i?o.createElement(Mt,{label:i}):o.createElement(tr,{sectors:e,props:a,showLabels:r})}function rr(t){var{sectors:e,activeShape:a,inactiveShape:r,allOtherPieProps:i}=t,n=ue(Lt),{onMouseEnter:u,onClick:c,onMouseLeave:p}=i,f=ke(i,Fa),m=Wt(u,i.dataKey),g=Jt(p),d=Zt(c,i.dataKey);return e==null||e.length===0?null:o.createElement(o.Fragment,null,e.map((h,v)=>{if(h?.startAngle===0&&h?.endAngle===0&&e.length!==1)return null;var j=a&&String(v)===n,S=n?r:null,M=j?a:S,C=N(N({},h),{},{stroke:h.stroke,tabIndex:-1,[It]:v,[$t]:i.dataKey});return o.createElement(Q,K({key:"sector-".concat(h?.startAngle,"-").concat(h?.endAngle,"-").concat(h.midAngle,"-").concat(v),tabIndex:-1,className:"recharts-pie-sector"},Ye(f,h,v),{onMouseEnter:m(h,v),onMouseLeave:g(h,v),onClick:d(h,v)}),o.createElement(Yt,K({option:M,isActive:j,shapeType:"sector"},C)))}))}function sr(t){var e,{pieSettings:a,displayedData:r,cells:i,offset:n}=t,{cornerRadius:u,startAngle:c,endAngle:p,dataKey:f,nameKey:m,tooltipType:g}=a,d=Math.abs(a.minAngle),h=Ya(c,p),v=Math.abs(h),j=r.length<=1?0:(e=a.paddingAngle)!==null&&e!==void 0?e:0,S=r.filter(E=>Y(E,f,0)!==0).length,M=(v>=360?S:S-1)*j,C=v-S*d-M,R=r.reduce((E,D)=>{var b=Y(D,f,0);return E+(be(b)?b:0)},0),z;if(R>0){var T;z=r.map((E,D)=>{var b=Y(E,f,0),F=Y(E,m,D),V=Za(a,n,E),q=(be(b)?b:0)/R,U,H=N(N({},E),i&&i[D]&&i[D].props);D?U=T.endAngle+ce(h)*j*(b!==0?1:0):U=c;var J=U+ce(h)*((b!==0?d:0)+q*C),W=(U+J)/2,re=(V.innerRadius+V.outerRadius)/2,pe=[{name:F,value:b,payload:H,dataKey:f,type:g}],he=xe(V.cx,V.cy,re,W);return T=N(N(N(N({},a.presentationProps),{},{percent:q,cornerRadius:u,name:F,tooltipPayload:pe,midAngle:W,middleRadius:re,tooltipPosition:he},H),V),{},{value:b,startAngle:U,endAngle:J,payload:H,paddingAngle:ce(h)*j}),T})}return z}function ir(t){var{showLabels:e,sectors:a,children:r}=t,i=o.useMemo(()=>!e||!a?[]:a.map(n=>({value:n.value,payload:n.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:n.cx,cy:n.cy,innerRadius:n.innerRadius,outerRadius:n.outerRadius,startAngle:n.startAngle,endAngle:n.endAngle,clockWise:!1},fill:n.fill})),[a,e]);return o.createElement(Dt,{value:e?i:void 0},r)}function nr(t){var{props:e,previousSectorsRef:a}=t,{sectors:r,isAnimationActive:i,animationBegin:n,animationDuration:u,animationEasing:c,activeShape:p,inactiveShape:f,onAnimationStart:m,onAnimationEnd:g}=e,d=_t(e,"recharts-pie-"),h=a.current,[v,j]=o.useState(!1),S=o.useCallback(()=>{typeof g=="function"&&g(),j(!1)},[g]),M=o.useCallback(()=>{typeof m=="function"&&m(),j(!0)},[m]);return o.createElement(ir,{showLabels:!v,sectors:r},o.createElement(Rt,{animationId:d,begin:n,duration:u,isActive:i,easing:c,onAnimationStart:M,onAnimationEnd:S,key:d},C=>{var R=[],z=r&&r[0],T=z?.startAngle;return r?.forEach((E,D)=>{var b=h&&h[D],F=D>0?Tt(E,"paddingAngle",0):0;if(b){var V=Le(b.endAngle-b.startAngle,E.endAngle-E.startAngle,C),q=N(N({},E),{},{startAngle:T+F,endAngle:T+V+F});R.push(q),T=q.endAngle}else{var{endAngle:U,startAngle:H}=E,J=Le(0,U-H,C),W=N(N({},E),{},{startAngle:T+F,endAngle:T+J+F});R.push(W),T=W.endAngle}}),a.current=R,o.createElement(Q,null,o.createElement(rr,{sectors:R,activeShape:p,inactiveShape:f,allOtherPieProps:e}))}),o.createElement(ar,{showLabels:!v,sectors:r,props:e}),e.children)}var or={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!Ot.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff"};function lr(t){var{id:e}=t,a=ke(t,Ba),{hide:r,className:i,rootTabIndex:n}=t,u=o.useMemo(()=>at(t.children,Ne),[t.children]),c=ue(m=>Ma(m,e,u)),p=o.useRef(null),f=de("recharts-pie",i);return r||c==null?(p.current=null,o.createElement(Q,{tabIndex:n,className:f})):o.createElement(o.Fragment,null,o.createElement(Ct,{fn:Ha,args:N(N({},t),{},{sectors:c})}),o.createElement(Q,{tabIndex:n,className:f},o.createElement(nr,{props:N(N({},a),{},{sectors:c}),previousSectorsRef:p})))}function st(t){var e=et(t,or),{id:a}=e,r=ke(e,za),i=tt(r);return o.createElement(At,{id:a,type:"pie"},n=>o.createElement(o.Fragment,null,o.createElement(St,{type:"pie",id:n,data:r.data,dataKey:r.dataKey,hide:r.hide,angleAxisId:0,radiusAxisId:0,name:r.name,nameKey:r.nameKey,tooltipType:r.tooltipType,legendType:r.legendType,fill:r.fill,cx:r.cx,cy:r.cy,startAngle:r.startAngle,endAngle:r.endAngle,paddingAngle:r.paddingAngle,minAngle:r.minAngle,innerRadius:r.innerRadius,outerRadius:r.outerRadius,cornerRadius:r.cornerRadius,presentationProps:i,maxRadius:e.maxRadius}),o.createElement(Ka,K({},r,{id:n})),o.createElement(lr,K({},r,{id:n}))))}st.displayName="Pie";var cr=["item"],dr={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},ur=o.forwardRef((t,e)=>{var a=et(t,dr);return o.createElement(Kt,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:cr,tooltipPayloadSearcher:qt,categoricalChartProps:a,ref:e})});class mr{async generateStudentReport(e,a=30){const r=new Date;r.setDate(r.getDate()-a);const{data:i}=await P.from("profiles").select("full_name, email").eq("id",e).single(),{data:n}=await P.from("class_members").select("class:classes(id, name, subject)").eq("user_id",e).eq("role","student"),{data:u}=await P.from("submissions").select(`
        grade,
        submitted_at,
        activity:activities(title, max_score, type)
      `).eq("student_id",e).gte("submitted_at",r.toISOString()).not("grade","is",null),c=u?.map(d=>d.grade)||[],p=c.length>0?c.reduce((d,h)=>d+h,0)/c.length:0,f=c.length>0?Math.max(...c):0,m=c.length>0?Math.min(...c):0,g=u?.map(d=>({name:d.activity.title.substring(0,20),value:d.grade}))||[];return{title:`RelatÃ³rio de Desempenho - ${i?.full_name||"Aluno"}`,templateName:"Desempenho Individual (Aluno)",generatedAt:new Date().toISOString(),studentId:e,summary:{totalActivities:u?.length||0,avgGrade:p.toFixed(1),maxGrade:f.toFixed(1),minGrade:m.toFixed(1),totalClasses:n?.length||0},charts:[{title:"Notas por Atividade",type:"bar",data:g},{title:"EvoluÃ§Ã£o do Desempenho",type:"line",data:g}],tables:[{title:"Turmas Inscritas",headers:["Nome","MatÃ©ria"],rows:n?.map(d=>[d.class.name,d.class.subject||"-"])||[]}],details:`RelatÃ³rio gerado para o perÃ­odo de ${a} dias. Total de ${u?.length||0} atividades avaliadas.`}}async generateClassReport(e,a=30){const{data:r}=await P.from("classes").select("name, subject, created_by").eq("id",e).single(),{data:i}=await P.from("class_members").select("user_id, profiles:user_id(full_name)").eq("class_id",e).eq("role","student"),{data:n}=await P.from("activity_class_assignments").select("activity_id, activity:activities(id, title)").eq("class_id",e),u=n?.map(d=>d.activity_id)||[],{data:c}=await P.from("submissions").select("grade, student_id, activity_id").in("activity_id",u).not("grade","is",null),p=c?.map(d=>d.grade)||[],f=p.length>0?p.reduce((d,h)=>d+h,0)/p.length:0,m={"Excelente (90-100)":0,"Bom (70-89)":0,"Regular (50-69)":0,"Insuficiente (0-49)":0};p.forEach(d=>{d>=90?m["Excelente (90-100)"]++:d>=70?m["Bom (70-89)"]++:d>=50?m["Regular (50-69)"]++:m["Insuficiente (0-49)"]++});const g=Object.entries(m).map(([d,h])=>({name:d,value:h}));return{title:`RelatÃ³rio de Turma - ${r?.name||"Turma"}`,templateName:"RelatÃ³rio de Turma",generatedAt:new Date().toISOString(),classId:e,summary:{totalStudents:i?.length||0,totalActivities:n?.length||0,avgGrade:f.toFixed(1),submissionsCount:c?.length||0},charts:[{title:"DistribuiÃ§Ã£o de Notas",type:"pie",data:g}],tables:[{title:"Lista de Alunos",headers:["Nome","SubmissÃµes"],rows:i?.map(d=>{const h=c?.filter(v=>v.student_id===d.user_id).length||0;return[d.profiles.full_name,h]})||[]}],details:`Turma: ${r?.name}
MatÃ©ria: ${r?.subject||"NÃ£o especificada"}
PerÃ­odo: Ãºltimos ${a} dias`}}async generateComparativeReport(e){const{data:a}=await P.from("classes").select("id, name, subject").eq("created_by",e).eq("is_active",!0);a?.map(i=>i.id);const r=await Promise.all(a?.map(async i=>{const{data:n}=await P.from("activity_class_assignments").select("activity_id").eq("class_id",i.id),u=n?.map(m=>m.activity_id)||[],{data:c}=await P.from("submissions").select("grade").in("activity_id",u).not("grade","is",null),p=c?.map(m=>m.grade)||[],f=p.length>0?p.reduce((m,g)=>m+g,0)/p.length:0;return{name:i.name,value:f}})||[]);return{title:"RelatÃ³rio Comparativo de Turmas",templateName:"Comparativo de Desempenho",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,avgGrade:(r.reduce((i,n)=>i+n.value,0)/(r.length||1)).toFixed(1)},charts:[{title:"MÃ©dia por Turma",type:"bar",data:r}],tables:[{title:"Detalhamento por Turma",headers:["Turma","MatÃ©ria","MÃ©dia"],rows:a?.map((i,n)=>[i.name,i.subject||"-",r[n]?.value.toFixed(1)||"0"])||[]}]}}async generateTeacherReport(e){const{data:a}=await P.from("classes").select("id").eq("created_by",e).eq("is_active",!0),{count:r}=await P.from("class_members").select("id",{count:"exact",head:!0}).in("class_id",a?.map(p=>p.id)||[]).eq("role","student"),{data:i}=await P.from("activities").select("id").eq("created_by",e),{data:n}=await P.from("submissions").select("grade").in("activity_id",i?.map(p=>p.id)||[]).not("grade","is",null),u=n?.map(p=>p.grade)||[],c=u.length>0?u.reduce((p,f)=>p+f,0)/u.length:0;return{title:"RelatÃ³rio de Desempenho do Professor",templateName:"Desempenho (Professor)",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,totalStudents:r||0,totalActivities:i?.length||0,avgGrade:c.toFixed(1)},details:"RelatÃ³rio consolidado de todas as turmas e atividades criadas."}}async generateReport(e,a,r={}){switch(e){case"individual-student":return await this.generateStudentReport(a,r.period);case"class-report":return await this.generateClassReport(a,r.period);case"comparative":return await this.generateComparativeReport(a);case"teacher-performance":return await this.generateTeacherReport(a);case"activity-report":return{title:"RelatÃ³rio de Atividade",templateName:"RelatÃ³rio de Atividade",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};case"bulletin":return{title:"Boletim Geral",templateName:"Boletim Geral",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};default:throw new Error("Template de relatÃ³rio nÃ£o encontrado")}}}const pr=new mr,Ke=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],hr=({report:t,onClose:e})=>{const{toast:a}=Je();if(!t)return null;const r=(i,n)=>{const u=(c,p=16)=>c?.length>p?c.slice(0,p)+"â€¦":c;switch(i){case"bar":return s.jsx(fe,{width:"100%",height:300,children:s.jsxs(Xt,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Ie,{strokeDasharray:"3 3"}),s.jsx(Me,{dataKey:"name",tickFormatter:c=>u(c),interval:"preserveEnd"}),s.jsx(Fe,{}),s.jsx(ve,{}),s.jsx(X,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Qt,{dataKey:"value",fill:"#3B82F6"})]})});case"line":return s.jsx(fe,{width:"100%",height:300,children:s.jsxs(Ut,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Ie,{strokeDasharray:"3 3"}),s.jsx(Me,{dataKey:"name",tickFormatter:c=>u(c),interval:"preserveEnd"}),s.jsx(Fe,{}),s.jsx(ve,{}),s.jsx(X,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Gt,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2})]})});case"pie":return s.jsx(fe,{width:"100%",height:300,children:s.jsxs(ur,{children:[s.jsx(st,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:c=>`${u(c.name)}: ${c.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((c,p)=>s.jsx(Ne,{fill:Ke[p%Ke.length]},`cell-${p}`))}),s.jsx(ve,{}),s.jsx(X,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}})]})});default:return null}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 overflow-auto",children:s.jsxs(G,{className:"w-full max-w-6xl max-h-[90vh] overflow-auto bg-white dark:bg-slate-900",children:[s.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between z-10",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t.title||t.templateName}),s.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Gerado em ",new Date(t.generatedAt).toLocaleString("pt-BR")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(_,{variant:"outline",size:"sm",onClick:()=>{try{if(t.tables&&t.tables.length>0){const p=t.tables[0],m=[(p.headers||[]).join(",")];(p.rows||[]).forEach(S=>{const M=S.map(C=>{const R=typeof C=="object"?JSON.stringify(C):String(C??"");return/[",\n]/.test(R)?'"'+R.replace(/"/g,'""')+'"':R}).join(",");m.push(M)});const g=m.join(`
`),d=new Blob([g],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(d),v=document.createElement("a"),j=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");v.href=h,v.download=`${j}-${Date.now()}.csv`,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(h),a({title:"Exportado (CSV)",description:"Arquivo CSV baixado com sucesso."});return}const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),u=document.createElement("a"),c=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");u.href=n,u.download=`${c}-${Date.now()}.json`,document.body.appendChild(u),u.click(),u.remove(),URL.revokeObjectURL(n),a({title:"Exportado (JSON)",description:"Arquivo JSON baixado com sucesso."})}catch{a({variant:"destructive",title:"Falha na exportaÃ§Ã£o",description:"Tente novamente."})}},children:[s.jsx(pt,{className:"w-4 h-4 mr-2"}),"Exportar"]}),s.jsxs(_,{variant:"outline",size:"sm",onClick:()=>{try{window.print()}catch{a({variant:"destructive",title:"Falha ao imprimir",description:"Tente novamente."})}},children:[s.jsx(va,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),s.jsxs(_,{variant:"outline",size:"sm",onClick:async()=>{try{const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),u=t.title||t.templateName||"RelatÃ³rio";navigator.share?await navigator.share({title:u,text:u,url:n}):(await navigator.clipboard.writeText(n),a({title:"Link copiado",description:"Link do relatÃ³rio copiado para a Ã¡rea de transferÃªncia."}))}catch{a({variant:"destructive",title:"Falha ao compartilhar",description:"Tente novamente."})}},children:[s.jsx(ht,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),s.jsx(_,{variant:"ghost",size:"sm",onClick:e,children:s.jsx(Ze,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[t.summary&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(t.summary).map(([i,n])=>s.jsxs(G,{className:"p-4",children:[s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:i.replace(/([A-Z])/g," $1").trim()}),s.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white mt-1",children:typeof n=="number"?n.toFixed(1):n})]},i))}),t.charts&&t.charts.map((i,n)=>s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),r(i.type,i.data)]},n)),t.tables&&t.tables.map((i,n)=>s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:i.headers.map((u,c)=>s.jsx("th",{className:"text-left p-2 font-semibold",children:u},c))})}),s.jsx("tbody",{children:i.rows.map((u,c)=>s.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:u.map((p,f)=>s.jsx("td",{className:"p-2",children:p},f))},c))})]})})]},n)),t.details&&s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detalhes"}),s.jsx("div",{className:"prose dark:prose-invert max-w-none",children:t.details})]})]})]})})};class fr{constructor(){this.enabled=!1,this.url="https://comic-mudfish-15106.upstash.io",this.token="ATsCAAIncDIxMzViNjFkMDQ0Zjk0NGU3YTljYjlhNTM2YTRhZDM1NXAyMTUxMDY",this.url&&this.token?(this.enabled=!0,console.log("[Cache] âœ… Upstash Redis configurado")):(console.warn("[Cache] âš ï¸  Upstash Redis nÃ£o configurado - cache desabilitado"),console.warn("[Cache] Configure VITE_UPSTASH_REDIS_REST_URL e VITE_UPSTASH_REDIS_REST_TOKEN"))}async get(e){if(!this.enabled)return null;try{const a=await fetch(`${this.url}/get/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(r.result===null)return console.log(`[Cache] âŒ Miss: ${e}`),null;console.log(`[Cache] âœ… Hit: ${e}`);try{return JSON.parse(r.result)}catch{return r.result}}catch(a){return console.error(`[Cache] Erro ao buscar ${e}:`,a),null}}async set(e,a,r=300){if(!this.enabled)return!1;try{const i=typeof a=="string"?a:JSON.stringify(a),n=await fetch(`${this.url}/set/${encodeURIComponent(e)}/${encodeURIComponent(i)}?EX=${r}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return console.log(`[Cache] ðŸ’¾ Saved: ${e} (TTL: ${r}s)`),!0}catch(i){return console.error(`[Cache] Erro ao salvar ${e}:`,i),!1}}async del(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/del/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return console.log(`[Cache] ðŸ—‘ï¸  Deleted: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao deletar ${e}:`,a),!1}}async invalidatePattern(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/keys/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=(await a.json()).result||[];if(i.length===0)return console.log(`[Cache] ðŸ” No keys found for pattern: ${e}`),!0;const n=i.map(u=>this.del(u));return await Promise.all(n),console.log(`[Cache] ðŸ§¹ Invalidated ${i.length} keys matching: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao invalidar padrÃ£o ${e}:`,a),!1}}async remember(e,a,r=300){const i=await this.get(e);if(i!==null)return i;const n=await a();return await this.set(e,n,r),n}async flush(){if(!this.enabled)return!1;try{const e=await fetch(`${this.url}/flushdb`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return console.log("[Cache] ðŸš¨ Cache completamente limpo (FLUSH)"),!0}catch(e){return console.error("[Cache] Erro ao limpar cache:",e),!1}}getStatus(){return{enabled:this.enabled,hasCredentials:!!(this.url&&this.token),url:this.url?this.url.replace(/https?:\/\//,"").split(".")[0]+"...":"nÃ£o configurado"}}}const He=new fr,We=[{id:"individual-student",name:"RelatÃ³rio Individual de Aluno",description:"RelatÃ³rio completo de um aluno especÃ­fico",icon:aa,color:"from-blue-500 to-cyan-500",includes:["Dados pessoais","HistÃ³rico de notas","FrequÃªncia","Feedbacks recebidos","GrÃ¡ficos de evoluÃ§Ã£o","AnÃ¡lise de desempenho"],usage:"ReuniÃ£o com pais, coordenaÃ§Ã£o",popular:!0},{id:"class-report",name:"RelatÃ³rio de Turma",description:"AnÃ¡lise completa de uma turma",icon:ra,color:"from-purple-500 to-pink-500",includes:["EstatÃ­sticas gerais","DistribuiÃ§Ã£o de notas","Taxa de aprovaÃ§Ã£o/reprovaÃ§Ã£o","MÃ©dia da turma","Alunos em destaque","Ãreas de atenÃ§Ã£o"],usage:"Fechamento de semestre, relatÃ³rios institucionais",popular:!0},{id:"comparative",name:"RelatÃ³rio Comparativo",description:"ComparaÃ§Ã£o entre mÃºltiplas turmas",icon:ha,color:"from-orange-500 to-red-500",includes:["Tabela comparativa","GrÃ¡ficos lado a lado","AnÃ¡lise de diferenÃ§as","Melhores prÃ¡ticas identificadas"],usage:"AnÃ¡lise pedagÃ³gica, ajustes metodolÃ³gicos"},{id:"activity-report",name:"RelatÃ³rio de Atividade",description:"AnÃ¡lise de uma atividade especÃ­fica",icon:sa,color:"from-green-500 to-teal-500",includes:["EstatÃ­sticas de submissÃ£o","DistribuiÃ§Ã£o de notas","QuestÃµes mais erradas","Tempo mÃ©dio de resoluÃ§Ã£o","Lista de notas por aluno"],usage:"ValidaÃ§Ã£o de atividade, ajustes"},{id:"bulletin",name:"Boletim (PerÃ­odo)",description:"Boletim formal por perÃ­odo",icon:ye,color:"from-indigo-500 to-purple-500",includes:["Notas por disciplina","MÃ©dias parciais e finais","FrequÃªncia","ObservaÃ§Ãµes do professor","Assinatura"],usage:"Entrega oficial para instituiÃ§Ã£o/pais",popular:!0},{id:"teacher-performance",name:"RelatÃ³rio de Desempenho (Professor)",description:"Auto-avaliaÃ§Ã£o do professor",icon:la,color:"from-yellow-500 to-orange-500",includes:["Atividades postadas","CorreÃ§Ãµes realizadas","Tempo mÃ©dio de feedback","SatisfaÃ§Ã£o dos alunos","EvoluÃ§Ã£o das turmas"],usage:"AvaliaÃ§Ã£o institucional, portfÃ³lio"}],is=()=>{const{user:t}=lt(),{toast:e}=Je(),[a,r]=o.useState(!1),[i,n]=o.useState("templates"),[u,c]=o.useState([]),[p,f]=o.useState(!1),[m,g]=o.useState(null),[d,h]=o.useState(null),[v,j]=o.useState(null),[S,M]=o.useState(null),[C,R]=o.useState("30"),[z,T]=o.useState([]),[E,D]=o.useState([]),[b,F]=o.useState(""),[V,q]=o.useState(!1);o.useEffect(()=>{U(),H()},[t]);const U=async()=>{if(t)try{const{data:l,error:x}=await P.from("report_history").select(`
          id,
          template_id,
          template_name,
          filter_type,
          student_id,
          class_id,
          activity_id,
          period,
          created_at,
          report_data
        `).eq("teacher_id",t.id).order("created_at",{ascending:!1}).limit(20);if(x)throw x;c(l||[]),console.log(`âœ… [Reports] ${l?.length||0} relatÃ³rios carregados do histÃ³rico`)}catch(l){I.error("Erro ao carregar histÃ³rico:",l),c([])}},H=async()=>{if(t)try{q(!0);const l=`teacher:reports:data:${t.id}:${C}`,x=await He.get(l);if(x){console.log("âœ… [Reports] Dados carregados do cache"),D(x.classes||[]),T(x.students||[]),q(!1);return}console.log("ðŸ”„ [Reports] Buscando dados do banco...");const{data:A,error:k}=await P.from("classes").select("id, name, subject").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(k)throw k;D(A||[]);const{data:y,error:w}=await P.from("class_members").select(`
          user_id,
          profile:profiles!class_members_user_id_fkey(id, full_name, email),
          class:classes!class_members_class_id_fkey(id, name)
        `).in("class_id",A?.map($=>$.id)||[]).eq("role","student");if(w)throw w;const O=[],Z=new Set;y?.forEach($=>{$.profile&&!Z.has($.profile.id)&&(Z.add($.profile.id),O.push({id:$.profile.id,name:$.profile.full_name,email:$.profile.email,className:$.class?.name}))}),T(O),await He.set(l,{classes:A||[],students:O},300),console.log("ðŸ’¾ [Reports] Dados salvos no cache (TTL: 5min)")}catch(l){I.error("Erro ao carregar dados:",l),e({title:"Erro ao carregar dados",description:l.message,variant:"destructive"})}finally{q(!1)}},J=l=>l==="comparative"?!1:!!(b==="student"&&["class-report"].includes(l)||b==="class"&&["individual-student"].includes(l)||S&&l!=="activity-report"),W=async l=>{if(l!=="comparative"){if(!b){e({title:"Selecione o escopo do relatÃ³rio",description:"Escolha se deseja gerar para um aluno, turma ou todos os alunos.",variant:"destructive"});return}if(b==="student"&&!d){e({title:"Selecione um aluno",description:"Escolha qual aluno vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}if(b==="class"&&!v){e({title:"Selecione uma turma",description:"Escolha qual turma vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}}f(!0),g(null);try{let x=t?.id;const A=We.find(y=>y.id===l);if(e({title:`ðŸ“Š Gerando ${A?.name||"RelatÃ³rio"}`,description:"Processando dados... Aguarde."}),b==="student"&&d)x=d;else if(b==="class"&&v)x=v;else if(l==="class-report")if(v)x=v;else{const{data:y}=await P.from("classes").select("id, is_active").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(!y||y.length===0)throw new Error("Nenhuma turma ativa encontrada para gerar o relatÃ³rio.");x=y[0].id}const k=await pr.generateReport(l,x,{period:parseInt(C),includeArchived:!1,filterType:b,studentId:d,classId:v,activityId:S});g(k),e({title:"âœ… RelatÃ³rio Gerado",description:`${k.templateName} gerado com sucesso!`});try{const{error:y}=await P.from("report_history").insert({teacher_id:t.id,template_id:l,template_name:A?.name||"RelatÃ³rio",filter_type:b||null,student_id:d||null,class_id:v||null,activity_id:S||null,period:parseInt(C),report_data:k});y?I.error("Erro ao salvar histÃ³rico:",y):console.log("âœ… RelatÃ³rio salvo no histÃ³rico")}catch(y){I.error("Erro ao salvar histÃ³rico:",y)}c(y=>[{id:Date.now(),templateId:l,templateName:A?.name,generatedAt:new Date().toISOString(),cached:!1,filterType:b,studentId:d,classId:v},...y.slice(0,9)])}catch(x){I.error("Erro ao gerar relatÃ³rio:",x),e({title:"Erro",description:x.message||"NÃ£o foi possÃ­vel gerar o relatÃ³rio",variant:"destructive"})}finally{f(!1)}},re=()=>{n("history")},pe=()=>{e({title:"Em desenvolvimento",description:"Gerenciamento de templates serÃ¡ implementado em breve"})},he=l=>{if(!l)return null;if(Array.isArray(l))return l;if(Array.isArray(l?.rows))return l.rows;if(Array.isArray(l?.data))return l.data;if(Array.isArray(l?.items))return l.items;const x=Object.values(l).find(A=>Array.isArray(A));return Array.isArray(x)?x:[l]},it=l=>{if(!l||l.length===0)return"";const x=Array.from(l.reduce((w,O)=>(Object.keys(O||{}).forEach(Z=>w.add(Z)),w),new Set)),A=w=>{if(w==null)return"";const O=typeof w=="object"?JSON.stringify(w):String(w);return/[",\n]/.test(O)?'"'+O.replace(/"/g,'""')+'"':O},k=x.map(A).join(","),y=l.map(w=>x.map(O=>A(w?.[O])).join(","));return[k,...y].join(`
`)},Ce=(l,x,A)=>{const k=new Blob([l],{type:A}),y=URL.createObjectURL(k),w=document.createElement("a");w.href=y,w.download=x,document.body.appendChild(w),w.click(),w.remove(),URL.revokeObjectURL(y)},nt=()=>{if(!m){e({title:"Nenhum relatÃ³rio para exportar",description:"Gere um relatÃ³rio primeiro.",variant:"destructive"});return}try{const l=he(m).map(k=>{const y={};return Object.entries(k||{}).forEach(([w,O])=>{O&&typeof O=="object"&&!Array.isArray(O)?Object.entries(O).forEach(([Z,$])=>{y[`${w}.${Z}`]=$}):y[w]=O}),y}),x=it(l);if(!x)throw new Error("NÃ£o hÃ¡ dados tabulares para exportar");const A=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ce(x,`${A}-${Date.now()}.csv`,"text/csv;charset=utf-8;"),e({title:"Exportado com sucesso",description:"Arquivo CSV baixado."})}catch(l){I.warn("CSV export fallback to JSON:",l);const x=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ce(JSON.stringify(m,null,2),`${x}-${Date.now()}.json`,"application/json"),e({title:"Exportado como JSON",description:"NÃ£o foi possÃ­vel gerar CSV. Baixamos o JSON.",variant:"destructive"})}};return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[s.jsx(mt,{title:"RelatÃ³rios",subtitle:"Gere relatÃ³rios formais e exportÃ¡veis",role:"teacher",actions:s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(_,{variant:"outline",onClick:re,children:[s.jsx(Be,{className:"w-4 h-4 mr-2"}),"HistÃ³rico"]}),s.jsxs(_,{variant:"outline",onClick:pe,children:[s.jsx(ea,{className:"w-4 h-4 mr-2"}),"Templates"]}),s.jsxs(_,{onClick:()=>e({title:"Selecione um template abaixo"}),children:[s.jsx(ge,{className:"w-4 h-4 mr-2"}),"Novo RelatÃ³rio"]})]})}),s.jsx(G,{className:"mt-6 p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:s.jsx(ta,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-900 dark:text-blue-100",children:"Selecione o Escopo do RelatÃ³rio"}),s.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Escolha para quem deseja gerar o relatÃ³rio antes de selecionar um template"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(se,{className:"text-sm font-medium mb-2 block",children:"Tipo de RelatÃ³rio"}),s.jsxs(ie,{value:b,onValueChange:F,children:[s.jsx(ne,{className:"bg-white dark:bg-slate-900",children:s.jsx(oe,{placeholder:"Selecione o tipo..."})}),s.jsxs(le,{children:[s.jsx(B,{value:"student",children:"Aluno EspecÃ­fico"}),s.jsx(B,{value:"class",children:"Turma Completa"}),s.jsx(B,{value:"all",children:"Todos os Alunos"})]})]})]}),b==="student"&&s.jsxs("div",{children:[s.jsx(se,{className:"text-sm font-medium mb-2 block",children:"Selecionar Aluno"}),s.jsxs(ie,{value:d||"",onValueChange:h,children:[s.jsx(ne,{className:"bg-white dark:bg-slate-900",children:s.jsx(oe,{placeholder:"Escolha um aluno..."})}),s.jsx(le,{children:z.map(l=>s.jsxs(B,{value:l.id,children:[l.name," ",l.className&&`(${l.className})`]},l.id))})]})]}),b==="class"&&s.jsxs("div",{children:[s.jsx(se,{className:"text-sm font-medium mb-2 block",children:"Selecionar Turma"}),s.jsxs(ie,{value:v||"",onValueChange:j,children:[s.jsx(ne,{className:"bg-white dark:bg-slate-900",children:s.jsx(oe,{placeholder:"Escolha uma turma..."})}),s.jsx(le,{children:E.map(l=>s.jsxs(B,{value:l.id,children:[l.name," ",l.subject&&`- ${l.subject}`]},l.id))})]})]}),s.jsxs("div",{children:[s.jsx(se,{className:"text-sm font-medium mb-2 block",children:"PerÃ­odo"}),s.jsxs(ie,{value:C,onValueChange:R,children:[s.jsx(ne,{className:"bg-white dark:bg-slate-900",children:s.jsx(oe,{})}),s.jsxs(le,{children:[s.jsx(B,{value:"7",children:"Ãšltimos 7 dias"}),s.jsx(B,{value:"30",children:"Ãšltimos 30 dias"}),s.jsx(B,{value:"90",children:"Ãšltimos 90 dias"}),s.jsx(B,{value:"180",children:"Ãšltimos 6 meses"}),s.jsx(B,{value:"365",children:"Ãšltimo ano"})]})]})]})]}),b&&s.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[s.jsx("strong",{children:"Filtro ativo:"})," ",b==="student"?`Aluno - ${z.find(l=>l.id===d)?.name||"Selecione"}`:b==="class"?`Turma - ${E.find(l=>l.id===v)?.name||"Selecione"}`:"Todos os alunos"]}),s.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>{F(""),h(null),j(null)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[s.jsx(Ze,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]})]})}),s.jsxs(dt,{value:i,onValueChange:n,className:"mt-6",children:[s.jsxs(ut,{className:"grid w-full max-w-md grid-cols-2",children:[s.jsx(Re,{value:"templates",children:"Templates"}),s.jsx(Re,{value:"history",children:"HistÃ³rico"})]}),s.jsxs(Te,{value:"templates",className:"mt-6",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:We.map((l,x)=>{const A=l.icon,k=J(l.id);return s.jsx(ct.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},style:{pointerEvents:"auto"},children:s.jsxs(G,{className:`p-6 h-full flex flex-col hover:shadow-lg transition-shadow relative ${k?"opacity-50":""}`,style:{pointerEvents:"auto"},children:[s.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${l.color} opacity-5 group-hover:opacity-10 transition-opacity`}),l.popular&&s.jsxs(_e,{className:"absolute top-4 right-4 bg-yellow-500 text-white",children:[s.jsx(ia,{className:"w-3 h-3 mr-1"}),"Popular"]}),s.jsx("div",{className:"mb-4 relative z-10",children:s.jsx("div",{className:`inline-flex p-3 rounded-xl bg-gradient-to-r ${l.color}`,children:s.jsx(A,{className:"w-6 h-6 text-white"})})}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:l.name}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:l.description}),s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-2",children:"Inclui:"}),s.jsxs("ul",{className:"space-y-1",children:[l.includes.slice(0,3).map((y,w)=>s.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-center",children:[s.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mr-2"}),y]},w)),l.includes.length>3&&s.jsxs("li",{className:"text-xs text-blue-600 dark:text-blue-400",children:["+",l.includes.length-3," mais..."]})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx(_e,{variant:"outline",className:"text-xs",children:l.usage})}),s.jsxs("div",{className:"flex gap-2 mt-auto pt-4 relative z-50",children:[s.jsxs(_,{className:`flex-1 bg-gradient-to-r ${l.color} text-white hover:opacity-90`,onClick:()=>{if(k){e({title:"Template incompatÃ­vel",description:"Este template nÃ£o Ã© compatÃ­vel com os filtros selecionados.",variant:"destructive"});return}I.debug("BotÃ£o Gerar clicado:",l.id),W(l.id)},disabled:k,children:[s.jsx(ge,{className:"w-4 h-4 mr-2"}),"Gerar"]}),s.jsx(_,{variant:"outline",size:"icon",onClick:()=>{I.debug("BotÃ£o Preview clicado"),e({title:"Preview",description:"VisualizaÃ§Ã£o serÃ¡ implementada"})},children:s.jsx(na,{className:"w-4 h-4"})})]})]})},l.id)})}),s.jsxs(G,{className:"mt-8 p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Formatos de ExportaÃ§Ã£o"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs(_,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-red-50 hover:border-red-300 dark:hover:bg-red-950/20",onClick:()=>{I.debug("Exportar PDF clicado"),e({title:"Exportar PDF",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(ye,{className:"w-8 h-8 mb-2 text-red-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PDF"})]}),s.jsxs(_,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-green-50 hover:border-green-300 dark:hover:bg-green-950/20",onClick:nt,children:[s.jsx(ma,{className:"w-8 h-8 mb-2 text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Excel"})]}),s.jsxs(_,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20",onClick:()=>{I.debug("Exportar Word clicado"),e({title:"Exportar Word",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(ye,{className:"w-8 h-8 mb-2 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Word"})]}),s.jsxs(_,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-purple-50 hover:border-purple-300 dark:hover:bg-purple-950/20",onClick:()=>{I.debug("Exportar PNG clicado"),e({title:"Exportar PNG",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(da,{className:"w-8 h-8 mb-2 text-purple-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PNG"})]})]})]})]}),s.jsx(Te,{value:"history",className:"mt-6",children:s.jsx(G,{className:"p-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx(Be,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:"Nenhum relatÃ³rio gerado ainda"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"RelatÃ³rios que vocÃª gerar aparecerÃ£o aqui para fÃ¡cil acesso"}),s.jsxs(_,{onClick:()=>n("templates"),children:[s.jsx(ge,{className:"w-4 h-4 mr-2"}),"Gerar Primeiro RelatÃ³rio"]})]})})})]}),m&&s.jsx(hr,{report:m,onClose:()=>g(null)})]})};export{is as default};
