import{c as q,h as z,u as P,r,s as S,l as V,j as e,q as $}from"./main-BtydHokz.js";import{B as Q}from"./button-pkZcz0fw.js";import{C as R}from"./card-BLN8IVBT.js";import{D as U,g}from"./DashboardHeader-Do_OLCE8.js";import{S as p}from"./StatsCard-CQPBdi-L.js";import{E as H}from"./EmptyState-B9PjJzZx.js";import{S as O}from"./SearchInput-CmmTqmy8.js";import"./dropdown-menu-DQk5WS44.js";import{D as W}from"./DataTable-NqRs7-US.js";import"./input-DevW5dIO.js";import"./label-Do1Gcpls.js";import{C as _}from"./classService-Ljb7If2H.js";import{A as J}from"./arrow-left-A7LEbFFM.js";import{T as c}from"./trending-up-C5ypBnjG.js";import{T as C}from"./trending-down-xfbtfH6Z.js";import"./proxy-BKNTM3tf.js";import"./chevron-right-Bh44L5jc.js";import"./search-B-7BMQB5.js";import"./x-BtLVjj0F.js";import"./index-BRR_QA-l.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./users-CntpuLnR.js";import"./book-open-BQJiPDff.js";import"./file-text-GwBv-P3B.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./index-DsrKRt14.js";import"./check-B1zY7uXK.js";import"./badge-DpVvk9bK.js";import"./chevron-up-B8VCb_df.js";import"./chevron-down-BPlSfXS4.js";const K=[["path",{d:"M5 12h14",key:"1ays0h"}]],X=q("minus",K),ze=()=>{const{classId:l}=z(),k=P(),[w,b]=r.useState(!0),[E,D]=r.useState(null),[x,F]=r.useState([]),[j,y]=r.useState([]),[u,L]=r.useState(""),[d,M]=r.useState({average:0,highest:0,lowest:0,totalGrades:0});r.useEffect(()=>{I()},[l]),r.useEffect(()=>{T()},[x,u]);const I=async()=>{try{b(!0);const s=await _.getClassById(l);D(s);const t=await _.getClassMembers(l,{role:"student"}),{data:o}=await S.from("activity_class_assignments").select("activity_id").eq("class_id",l),h=o?.map(a=>a.activity_id)||[],m=await Promise.all(t.map(async a=>{const{data:n}=await S.from("submissions").select("grade, activity_id").eq("student_id",a.user_id).in("activity_id",h).not("grade","is",null),f=n?.map(v=>v.grade)||[],N=f.length>0?f.reduce((v,G)=>v+G,0)/f.length:null;return{id:a.user_id,name:a.user?.name||"Sem nome",email:a.user?.email,avatar:a.user?.avatar_url,grades:n||[],average:N?Number(N.toFixed(2)):null}}));F(m);const i=m.map(a=>a.average).filter(a=>a!==null),B=i.length>0?i.reduce((a,n)=>a+n,0)/i.length:0;M({average:Number(B.toFixed(2)),highest:i.length>0?Math.max(...i):0,lowest:i.length>0?Math.min(...i):0,totalGrades:m.reduce((a,n)=>a+n.grades.length,0)})}catch(s){V.error("Erro:",s)}finally{b(!1)}},T=()=>{if(!u){y(x);return}const s=u.toLowerCase();y(x.filter(t=>t.name?.toLowerCase().includes(s)||t.email?.toLowerCase().includes(s)))},A=[{key:"name",label:"Aluno",sortable:!0,render:(s,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:t.name[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.email})]})]})},{key:"gradesCount",label:"Notas Lançadas",sortable:!0,render:(s,t)=>t.grades.length},{key:"average",label:"Média",sortable:!0,render:(s,t)=>{if(t.average===null)return"-";const o=t.average-d.average,h=o>0?c:o<0?C:X,m=o>0?"text-green-600":o<0?"text-red-600":"text-slate-600";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg",children:t.average.toFixed(2)}),e.jsx(h,{className:`w-4 h-4 ${m}`})]})}}];return w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx($,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(Q,{variant:"ghost",onClick:()=>k(`/dashboard/classes/${l}`),className:"mb-4",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(U,{title:`Notas - ${E?.name||"Turma"}`,subtitle:"Visualização de notas dos alunos",role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(p,{title:"Média da Turma",value:d.average.toFixed(2),icon:c,gradient:g.primary,format:"text",delay:0}),e.jsx(p,{title:"Maior Nota",value:d.highest.toFixed(2),icon:c,gradient:g.success,format:"text",delay:.1}),e.jsx(p,{title:"Menor Nota",value:d.lowest.toFixed(2),icon:C,gradient:g.danger,format:"text",delay:.2}),e.jsx(p,{title:"Notas Lançadas",value:d.totalGrades,icon:c,gradient:g.stats.activities,delay:.3})]}),e.jsx(R,{className:"p-6 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800 mb-8",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:["⚠️ ",e.jsx("strong",{children:"Versão FREE:"})," Upgrade para visualização em matriz interativa e exportação em Excel/PDF."]})}),e.jsx("div",{className:"mb-8",children:e.jsx(O,{placeholder:"Buscar aluno...",value:u,onChange:L})}),j.length>0?e.jsx(W,{columns:A,data:j,sortBy:"name",sortOrder:"asc"}):e.jsx(H,{icon:c,title:"Nenhum aluno encontrado",description:"Aguardando notas dos alunos."})]})};export{ze as default};
