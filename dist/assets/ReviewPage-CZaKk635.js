import{h as te,b as se,u as ae,r,l as z,j as e,q as re}from"./main-CI5_MmIm.js";import{B as k}from"./button-D7H9d9Gd.js";import{C as oe}from"./card-DpcnMbcE.js";import{B as E}from"./badge-BOI6M_d9.js";import{P as ie}from"./progress-PFHL2xMu.js";import{u as ne}from"./use-toast-D7N2H9RC.js";import{f,a as le,b as de}from"./flashcardService-DaDHhMrj.js";import{C as ce}from"./ConfirmDialog-YuBKBIXX.js";import{A as me}from"./arrow-left-AtIy0G9L.js";import{P as R}from"./pause-Da1hE848.js";import{S as xe}from"./square-pen-6UHqJ7PH.js";import{A as P}from"./index-RHGs5twt.js";import{m as N}from"./proxy-CT7Xtxle.js";import{C as M}from"./check-GhIpAKm1.js";import{S as ue}from"./sparkles-D6AqXP1n.js";import{C as he}from"./circle-check-big-KDmohnfK.js";import{C as ge}from"./circle-alert-X86u08ZX.js";import{X as pe}from"./x-DGmYUGM5.js";import"./triangle-alert-ta0gV1VM.js";const Me=()=>{const{deckId:o}=te(),{user:x}=se(),{toast:c}=ne(),h=ae(),[y,v]=r.useState(!0),[_,C]=r.useState(null),[m,L]=r.useState([]),[d,q]=r.useState(0),[u,D]=r.useState(!1),[p,Q]=r.useState(null),[i,A]=r.useState({total:0,reviewed:0,correct:0,startTime:Date.now()}),[w,F]=r.useState(!1),[K,I]=r.useState(!1);r.useEffect(()=>{x?.id&&o&&O()},[x,o]),r.useEffect(()=>{const t=a=>{if(!w){if(!u&&a.code==="Space")a.preventDefault(),T();else if(u)switch(a.key){case"1":g(0);break;case"2":g(1);break;case"3":g(2);break;case"4":g(3);break;case"5":g(4);break}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[u,w,d]);const O=async()=>{try{v(!0);const{data:t,error:a}=await f.getDeckById(o);if(a)throw a;C(t);const{data:n,error:l}=await f.getUserSettings(x.id);if(l)throw l;Q(n);const{data:Y,error:B}=await f.getDueCardsForReview(o,x.id,{include_new:!0,include_learning:!0,include_review:!0,max_new:n.new_cards_per_day||20,max_reviews:n.max_reviews_per_day||200,order:n.review_order||"random"});if(B)throw B;let j=Y||[];if(!j.length){const{data:S,error:$}=await f.getCardsInDeck(o);if($)throw $;if(!S||S.length===0){c({title:"Deck vazio",description:"Adicione cards ao deck primeiro.",variant:"destructive"}),h(`/students/flashcards/decks/${o}`);return}j=S.map(b=>{const Z=Array.isArray(b.card_stats)?b.card_stats[0]:b.card_stats,ee=b.id;return{...b,...Z,id:ee}}),c({title:"Estudo livre",description:"Nenhum card estÃ¡ pendente hoje, entÃ£o vamos estudar o deck completo."})}L(j),A({total:j.length,reviewed:0,correct:0,startTime:Date.now()})}catch(t){z.error("Error loading review session:",t),c({title:"Erro ao carregar",description:"NÃ£o foi possÃ­vel carregar os cards para revisÃ£o.",variant:"destructive"}),h("/students/flashcards")}finally{v(!1)}},T=r.useCallback(()=>{D(!0)},[]),g=async t=>{const a=m[d],n=Date.now()-i.startTime;try{await f.submitReview(a.id,x.id,t,n,p),A(l=>({...l,reviewed:l.reviewed+1,correct:l.correct+(t>=2?1:0)})),d<m.length-1?(q(d+1),D(!1)):U()}catch(l){z.error("Error submitting review:",l),c({title:"Erro ao salvar",description:"NÃ£o foi possÃ­vel salvar sua resposta.",variant:"destructive"})}},U=()=>{const t=Math.floor((Date.now()-i.startTime)/1e3),a=Math.floor(t/60),n=t%60,l=Math.round(i.correct/i.total*100);c({title:"ğŸ‰ SessÃ£o concluÃ­da!",description:`${i.reviewed} cards revisados em ${a}m ${n}s. Taxa de acerto: ${l}%`,duration:5e3}),h(`/students/flashcards/decks/${o}`)},X=()=>{F(!w)},G=()=>{c({title:"Em desenvolvimento",description:"EdiÃ§Ã£o durante revisÃ£o serÃ¡ implementada em breve."})},H=()=>{I(!0)};if(y)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:e.jsx(re,{size:"lg",text:"Preparando cards..."})});if(!m||m.length===0)return null;const s=m[d],J=(d+1)/m.length*100,V=m.length-d-1,W=u?le(s,p):[];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-b border-slate-200 dark:border-slate-800 p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:H,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Sair"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:_?.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Card ",d+1," de ",m.length]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p?.show_remaining_count&&e.jsxs(E,{variant:"secondary",children:[V," restantes"]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:X,children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:G,children:e.jsx(xe,{className:"w-4 h-4"})})]})]}),e.jsx(ie,{value:J,className:"mt-4"})]}),e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(P,{mode:"wait",children:w?e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center py-20",children:[e.jsx(R,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:"Pausado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Clique no botÃ£o acima para continuar"})]},"paused"):e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs(oe,{className:"mb-6 overflow-hidden border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"px-6 pt-6 pb-2 flex items-center justify-between border-b border-slate-100 dark:border-slate-800",children:[e.jsx(E,{className:s.card_status==="new"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":s.card_status==="learning"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:s.card_status==="new"?"Novo":s.card_status==="learning"?"Aprendendo":"RevisÃ£o"}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex gap-2",children:s.tags.slice(0,3).map((t,a)=>e.jsx(E,{variant:"outline",className:"text-xs",children:t},a))})]}),e.jsx("div",{className:"p-8 min-h-[300px] flex items-center justify-center bg-gradient-to-br from-white to-slate-50 dark:from-slate-900 dark:to-slate-800",children:e.jsxs("div",{className:"text-center max-w-2xl w-full space-y-4",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:"Card visual",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-md"}),e.jsx("p",{className:"text-2xl font-medium text-slate-900 dark:text-white leading-relaxed",children:s.front}),s.audio_url&&e.jsx("audio",{src:s.audio_url,controls:!0,autoPlay:!!p?.auto_play_audio,className:"mx-auto mt-4"})]})}),e.jsx(P,{children:u&&e.jsx(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:e.jsx("div",{className:"p-8 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900",children:e.jsxs("div",{className:"text-left max-w-2xl mx-auto space-y-4",children:[s.back_image_url&&e.jsx("img",{src:s.back_image_url,alt:"Card back visual",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-md"}),e.jsx("div",{className:"text-lg text-slate-700 dark:text-slate-300 leading-relaxed space-y-2",children:String(s.back||"").split(`
`).filter(t=>t.trim().length>0).map((t,a)=>e.jsx("p",{children:t},a))}),(s.back_audio_url||s.audio_url)&&e.jsx("audio",{src:s.back_audio_url||s.audio_url,controls:!0,className:"mx-auto mt-4"})]})})})}),!u&&e.jsx("div",{className:"p-6 flex justify-center border-t border-slate-100 dark:border-slate-800",children:e.jsxs(k,{size:"lg",onClick:T,className:"bg-blue-600 hover:bg-blue-700 text-white px-12",children:["Mostrar Resposta",e.jsx("span",{className:"ml-2 text-xs opacity-75",children:"(EspaÃ§o)"})]})})]}),e.jsx(P,{children:u&&e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsx("div",{className:"grid grid-cols-5 gap-3",children:W.map(t=>{const a=de(t.value),n=fe(t.value);return e.jsx(be,{quality:t.value,label:t.label,interval:p?.show_next_intervals?t.formatted_interval:null,color:t.color,icon:n,onClick:()=>g(t.value),shortcut:a.shortcut},t.value)})}),e.jsx("div",{className:"mt-6 p-4 bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"flex items-center justify-center gap-8 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Progresso"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:[i.reviewed,"/",i.total]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Acertos"}),e.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:i.correct})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Taxa"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:[i.reviewed>0?Math.round(i.correct/i.reviewed*100):0,"%"]})]})]})})]})})]},d)})}),e.jsx(ce,{isOpen:K,onClose:()=>I(!1),onConfirm:()=>{h(`/students/flashcards/decks/${o}`)},title:"Sair da revisÃ£o?",message:"Deseja realmente sair da sessÃ£o de revisÃ£o agora? Seu progresso atÃ© este card serÃ¡ mantido.",confirmText:"Sair",cancelText:"Continuar estudando",variant:"warning"})]})},be=({quality:o,label:x,interval:c,color:h,icon:y,onClick:v,shortcut:_})=>{const C={red:"bg-red-500 hover:bg-red-600 border-red-600",orange:"bg-orange-500 hover:bg-orange-600 border-orange-600",blue:"bg-blue-500 hover:bg-blue-600 border-blue-600",green:"bg-green-500 hover:bg-green-600 border-green-600",emerald:"bg-emerald-500 hover:bg-emerald-600 border-emerald-600"};return e.jsxs("button",{onClick:v,className:`${C[h]} text-white border-2 rounded-xl p-4 transition-all hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 group`,children:[e.jsx(y,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold text-sm",children:x}),e.jsx("span",{className:"text-xs opacity-90",children:c}),e.jsx("span",{className:"text-xs opacity-75 bg-white/20 px-2 py-0.5 rounded",children:_})]})},fe=o=>{switch(o){case 0:return pe;case 1:return ge;case 2:return M;case 3:return he;case 4:return ue;default:return M}};export{Me as default};
