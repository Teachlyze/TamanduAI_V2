import{c as me,j as e,b as xe,u as ue,r as o,s as d,l as L}from"./main-CI5_MmIm.js";import{u as ge}from"./use-toast-D7N2H9RC.js";import{C as Q}from"./card-DpcnMbcE.js";import{B as b}from"./button-D7H9d9Gd.js";import{B as O}from"./badge-BOI6M_d9.js";import{m as v}from"./proxy-CT7Xtxle.js";import{B as y}from"./book-open-DlGI5eOy.js";import{U as he}from"./users-ChR7WEeh.js";import{F as pe}from"./file-text-CtozP3gh.js";import{E as fe}from"./EmptyState-ExwS4ndS.js";import"./dialog-DzyprNmz.js";import{I as R}from"./input-BJMmyirp.js";import{T as be,a as ve,b as N}from"./tabs-ZdS4mBpd.js";import{S as $}from"./search-C3Ws2_PV.js";import{G as je}from"./grid-3x3-1gNJO0_u.js";import{L as we}from"./list-kKCq2Cej.js";import{S as H}from"./star-6E86D7gV.js";import{X as Ne}from"./x-DGmYUGM5.js";import"./index-D4BuPd_i.js";import"./index-DHrdJ99Z.js";import"./Combination-BfETjw1A.js";import"./SidebarPremium-0_wHXPj0.js";import"./house-B6Hparzo.js";import"./graduation-cap-mPfDCRgT.js";import"./calendar-Dbm_7POQ.js";import"./chart-column-G5dLAdkQ.js";import"./message-circle-CRpVuYq9.js";import"./settings-BWUwUKXK.js";import"./brain-DVBX4Id_.js";import"./index-RHGs5twt.js";import"./chevron-right-CHSrP1xQ.js";import"./index-jkBwDHc_.js";import"./index-CRRraFTu.js";import"./index-CtvfaZbL.js";const ye=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],ke=me("log-in",ye),_e=({classItem:s,onClick:k,index:j=0})=>{const _={blue:"from-blue-600 to-cyan-500",green:"from-green-600 to-emerald-500",purple:"from-purple-600 to-pink-500",orange:"from-orange-600 to-amber-500",red:"from-red-600 to-rose-500",yellow:"from-yellow-600 to-orange-500",pink:"from-pink-600 to-rose-500",indigo:"from-indigo-600 to-purple-500",cyan:"from-cyan-600 to-blue-500",teal:"from-teal-600 to-green-500"},g=_[s.color]||_.blue;return e.jsx(v.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:j*.1,type:"spring"},whileHover:{scale:1.05,y:-8},onClick:k,className:"cursor-pointer",children:e.jsxs(Q,{className:"overflow-hidden border-2 border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 hover:shadow-2xl transition-all",children:[e.jsxs("div",{className:`h-28 sm:h-32 bg-gradient-to-br ${g} p-4 sm:p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute -right-8 -bottom-8 opacity-20",children:e.jsx(y,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(O,{className:"mb-2 bg-white/20 text-white border-white/30 backdrop-blur-sm",children:s.subject||"MatÃ©ria"}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold line-clamp-2",children:s.name})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:s.teacher_name||"Professor"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400",children:s.pendingActivities||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600 dark:text-green-400",children:s.avgGrade!==null&&s.avgGrade!==void 0?s.avgGrade.toFixed(1):"--"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"MÃ©dia"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-orange-600 dark:text-orange-400",children:s.studentsCount||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Alunos"})]})]}),s.newActivities>0&&e.jsx(v.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3},children:e.jsxs(O,{className:"w-full justify-center py-2 bg-orange-100 text-orange-700 dark:bg-orange-900/40 dark:text-orange-300 border-orange-300 dark:border-orange-700",children:["ðŸ”” ",s.newActivities," nova",s.newActivities>1?"s":""," atividade",s.newActivities>1?"s":""]})}),s.nextDeadline&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),"PrÃ³ximo prazo: ",s.nextDeadline]})]})]})})},ot=()=>{const{user:s}=xe(),k=ue(),{toast:j}=ge(),[_,g]=o.useState(!0),[W,K]=o.useState(!0),[c,T]=o.useState([]),[M,X]=o.useState([]),[m,Y]=o.useState(""),[C,B]=o.useState("grid"),[S,Z]=o.useState("name"),[I,u]=o.useState(!1),[A,h]=o.useState(""),[w,G]=o.useState(!1),[q,l]=o.useState("");o.useEffect(()=>{s?.id&&P()},[s]),o.useEffect(()=>{ee()},[c,m,S]);const P=async()=>{try{g(!0);const{data:t}=await d.from("class_members").select("class_id, joined_at").eq("user_id",s.id).eq("role","student"),a=t?.map(i=>i.class_id)||[],{data:r}=await d.from("classes").select("id, name, subject, color, created_at, created_by").in("id",a),x=r?.map(i=>i.created_by).filter(Boolean)||[],{data:p}=await d.from("profiles").select("id, full_name, avatar_url").in("id",x),f={};if(p?.forEach(i=>{f[i.id]=i}),a.length===0){T([]),g(!1);return}const te=await Promise.all(r.map(async i=>{const ae=t.find(n=>n.class_id===i.id),{data:se}=await d.from("activity_class_assignments").select("activity_id").eq("class_id",i.id),V=se?.map(n=>n.activity_id)||[],{data:z}=await d.from("submissions").select("activity_id, status, grade").eq("student_id",s.id).in("activity_id",V),J=new Set(z?.map(n=>n.activity_id)||[]),re=V.length-J.size,E=z?.filter(n=>n.grade!==null)||[],ie=E.length>0?E.reduce((n,ce)=>n+parseFloat(ce.grade),0)/E.length:null,{data:ne}=await d.from("class_members").select("id, is_archived").eq("class_id",i.id).eq("role","student"),oe=ne?.filter(n=>!n.is_archived).length||0,D=new Date;D.setDate(D.getDate()-7);const{data:le}=await d.from("activity_class_assignments").select("activity_id, assigned_at").eq("class_id",i.id).gte("assigned_at",D.toISOString()),de=(le?.map(n=>n.activity_id)||[]).filter(n=>!J.has(n)).length,U=f[i.created_by];return{id:i.id,name:i.name,subject:i.subject,color:i.color||"blue",teacher_name:U?.full_name||"Professor",teacher_avatar:U?.avatar_url,pendingActivities:re,avgGrade:ie,studentsCount:oe||0,newActivities:de,joined_at:ae?.joined_at,created_at:i.created_at}}));T(te)}catch(t){L.error("Erro ao carregar turmas:",t),j({title:"Erro ao carregar turmas",description:"NÃ£o foi possÃ­vel carregar suas turmas. Tente novamente em instantes.",variant:"destructive"})}finally{g(!1),W&&K(!1)}},ee=()=>{let t=[...c];if(m){const a=m.toLowerCase();t=t.filter(r=>r.name?.toLowerCase().includes(a)||r.subject?.toLowerCase().includes(a)||r.teacher_name?.toLowerCase().includes(a))}t.sort((a,r)=>{switch(S){case"name":return a.name.localeCompare(r.name);case"pending":return r.pendingActivities-a.pendingActivities;case"grade":const x=a.avgGrade||0;return(r.avgGrade||0)-x;case"recent":return new Date(r.joined_at)-new Date(a.joined_at);default:return 0}}),X(t)},F=async()=>{const t=A.replace(/\s/g,"").trim().toUpperCase();if(!t){l("Digite o cÃ³digo da turma");return}if(t.length!==8){l("O cÃ³digo deve ter 8 caracteres");return}if(!s?.id){l("VocÃª precisa estar autenticado para entrar em uma turma.");return}try{G(!0),l("");const{data:a,error:r}=await d.from("classes").select("id, name").ilike("invite_code",t).maybeSingle();if(r||!a){L.error("Erro ao buscar turma:",r),l("CÃ³digo invÃ¡lido! Verifique se digitou corretamente.");return}const{data:x}=await d.from("class_members").select("id").eq("class_id",a.id).eq("user_id",s.id).single();if(x){l("VocÃª jÃ¡ estÃ¡ nesta turma!");return}const{data:p,error:f}=await d.from("class_members").insert({class_id:a.id,user_id:s.id,role:"student",joined_at:new Date().toISOString()}).select();if(f)throw f;if(!p||p.length===0)throw new Error("Falha ao adicionar vocÃª Ã  turma");u(!1),h(""),l(""),await P(),j({title:"ðŸŽ‰ Bem-vindo(a)!",description:`VocÃª entrou na turma "${a.name}" com sucesso!`})}catch(a){L.error("Erro ao entrar na turma:",a),l("Erro ao entrar na turma. Tente novamente.")}finally{G(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs(v.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(y,{className:"w-8 h-8 text-blue-600"}),"Minhas Turmas"]}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[c.length," turma",c.length!==1?"s":""," ativa",c.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(R,{placeholder:"Buscar turmas por nome, matÃ©ria ou professor...",value:m,onChange:t=>Y(t.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center",children:[e.jsx(be,{value:S,onValueChange:Z,children:e.jsxs(ve,{children:[e.jsx(N,{value:"name",children:"Nome"}),e.jsx(N,{value:"pending",children:"Pendentes"}),e.jsx(N,{value:"grade",children:"MÃ©dia"}),e.jsx(N,{value:"recent",children:"Recentes"})]})}),e.jsxs("div",{className:"flex border rounded-lg overflow-hidden",children:[e.jsx(b,{variant:C==="grid"?"default":"ghost",size:"sm",onClick:()=>B("grid"),className:"rounded-none",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(b,{variant:C==="list"?"default":"ghost",size:"sm",onClick:()=>B("list"),className:"rounded-none",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsxs(b,{type:"button",onClick:()=>u(!0),className:"sm:ml-2 bg-blue-600 hover:bg-blue-700 text-white whitespace-nowrap",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Entrar com cÃ³digo"]})]})]}),M.length>0?e.jsx("div",{className:C==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6":"space-y-3 sm:space-y-4",children:M.map((t,a)=>e.jsx(_e,{classItem:t,onClick:()=>k(`/students/classes/${t.id}`),index:a},t.id))}):e.jsx(fe,{icon:m?$:y,title:m?"Nenhuma turma encontrada":"VocÃª ainda nÃ£o estÃ¡ em nenhuma turma",description:m?"Tente ajustar sua busca para encontrar o que procura.":"Use o cÃ³digo fornecido pelo seu professor para entrar em uma turma.",action:m?void 0:()=>u(!0),actionLabel:m?void 0:"Entrar com cÃ³digo da turma",variant:"default"}),c.length>0&&e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-8 sm:mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(y,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Total de Turmas"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-blue-600",children:c.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30",children:e.jsx(H,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Atividades Pendentes"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-orange-600",children:c.reduce((t,a)=>t+a.pendingActivities,0)})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(H,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"MÃ©dia Geral"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-green-600",children:(()=>{const t=c.filter(r=>r.avgGrade!==null);return t.length===0?"--":(t.reduce((r,x)=>r+x.avgGrade,0)/t.length).toFixed(1)})()})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{u(!1),h(""),l("")},children:e.jsx(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:t=>t.stopPropagation(),children:e.jsxs(Q,{className:"p-8 max-w-md w-full bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Entrar em uma Turma"}),e.jsx("button",{type:"button",onClick:()=>{u(!1),h(""),l("")},className:"p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Digite o cÃ³digo fornecido pelo professor"}),e.jsxs("div",{className:"mb-6",children:[e.jsx(R,{value:A,onChange:t=>{const a=t.target.value.toUpperCase();a.length<=8&&(h(a),l(""))},onKeyPress:t=>{t.key==="Enter"&&F()},placeholder:"CÃ“DIGO DA TURMA",maxLength:8,className:"text-center text-2xl font-mono tracking-widest uppercase h-14 border-2 focus:border-blue-500",autoFocus:!0,disabled:w}),q&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 text-center",children:q})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{variant:"outline",onClick:()=>{u(!1),h(""),l("")},className:"flex-1 border-slate-300 dark:border-slate-700",disabled:w,children:"Cancelar"}),e.jsx(b,{onClick:F,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",disabled:w||!A.trim(),children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Entrando..."]}):"Entrar"})]})]})})})]})};export{ot as default};
