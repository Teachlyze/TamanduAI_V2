import{a as Ne,u as ye,r as i,l as E,s as n,j as e,m as ke,L as m}from"./main-BXI8jImK.js";import{B as l,m as g}from"./button-DhJSXayK.js";import{C as x}from"./card-Dts-jKab.js";import{B as T}from"./SidebarPremium-CqhK_O_u.js";import{S as _e}from"./StatsCard-BvzfNeJ2.js";import{D as Se}from"./DashboardHeader-BC80IxDW.js";import{E as w}from"./EmptyState-BgA-VgrI.js";import"./input-YtE9-IyT.js";import"./dropdown-menu-7nHS86TP.js";import"./label-DZTyMoK9.js";import{a as Ce}from"./addDays-C1DLUp4S.js";import{i as Ae}from"./isToday-DelRzLgz.js";import{B as G}from"./book-open-BMCImb8A.js";import{U as De}from"./users-1MVt23UL.js";import{T as Ee}from"./trending-up-C_AGH9Be.js";import{C as q}from"./clock-Ic71-9yN.js";import{C as z}from"./index-Cyt6Mlq7.js";import{C as N}from"./chevron-right-DFiBXpQq.js";import{f as y}from"./format-D0LVKLFA.js";import{T as Te}from"./target-Dg-9Hmp2.js";import{P}from"./plus-CjBUib9U.js";import{F as Z}from"./file-text-B1_cTV9D.js";import{T as Ge}from"./triangle-alert-fhQdnZTc.js";import{C as qe}from"./circle-check-Fi_I5OIJ.js";import{C as ze}from"./chart-column-D6pi1FRc.js";import{p as Pe}from"./pt-BR-zMqltMoH.js";import"./bell-De3gaLfU.js";import"./user-XMBxPeUS.js";import"./settings-Dn83Owos.js";import"./graduation-cap-BVXXkz0b.js";import"./x-DhRNfShw.js";import"./index-laUz9pSU.js";import"./index-D63a-v4Z.js";import"./Combination-7NRWB7dp.js";import"./index-PCXR_M5s.js";import"./check-P2w7Pyl_.js";import"./en-US-Bd7_-tVp.js";import"./constructNow-Da1hFwc5.js";import"./isSameDay-BnIh4eio.js";const kt=()=>{const{user:h}=Ne(),B=ye(),[ee,k]=i.useState(!0),[Be,I]=i.useState(null),[b,_]=i.useState(7),[Ie,Oe]=i.useState("all"),[c,te]=i.useState({totalClasses:0,totalStudents:0,totalActivities:0,pendingGrading:0,avgGrade:0,todayCorrections:0}),[O,ae]=i.useState([]),[R,se]=i.useState([]),[F,re]=i.useState([]),[$,H]=i.useState([]),[V,ie]=i.useState([]),[u,le]=i.useState([]),[L,de]=i.useState([]);i.useEffect(()=>{p()},[]);const p=async()=>{if(!h?.id){k(!1);return}try{k(!0),I(null),E.debug("[TeacherDashboard] Carregando dados...");const{data:t,error:s}=await n.from("classes").select(`
          *,
          class_members(count)
        `).eq("created_by",h.id).eq("is_active",!0);if(s)throw s;const S=t?.map(a=>({...a,student_count:a.class_members?.[0]?.count||0}))||[],{data:C,error:M}=await n.from("activities").select(`
          *,
          activity_class_assignments(class:classes(name))
        `).eq("created_by",h.id).order("created_at",{ascending:!1}).limit(10);if(M)throw M;const ce=C?.map(a=>({...a,class_name:a.activity_class_assignments?.[0]?.class?.name||"Sem turma"}))||[],f=C?.map(a=>a.id)||[],{data:U,error:W}=await n.from("submissions").select(`
          *,
          activity:activities(title),
          student:profiles!student_id(full_name)
        `).in("activity_id",f).eq("status","submitted").order("submitted_at",{ascending:!0}).limit(10);if(W)throw W;const me=U?.map(a=>({...a,student_name:a.student?.full_name||"Aluno",activity_title:a.activity?.title||"Atividade"}))||[],{data:A,error:J}=await n.from("submissions").select("grade").in("activity_id",f).not("grade","is",null);if(J)throw J;const xe=A?.length>0?A.reduce((a,d)=>a+d.grade,0)/A.length:0,j=new Date;j.setHours(0,0,0,0);const v=new Date(j);v.setDate(v.getDate()+1);const{data:he,error:K}=await n.from("submissions").select("id").in("activity_id",f).gte("graded_at",j.toISOString()).lt("graded_at",v.toISOString());if(K)throw K;const Q=Ce(new Date,b),{data:D,error:ge}=await n.from("calendar_events").select("*").eq("created_by",h.id).gte("start_time",new Date().toISOString()).lte("start_time",Q.toISOString()).order("start_time",{ascending:!0}).limit(4);!ge&&D&&(H(D),ie(D.filter(a=>Ae(new Date(a.start_time)))));const{data:X,error:be}=await n.from("meetings").select("*").eq("created_by",h.id).gte("start_time",new Date().toISOString()).lte("start_time",Q.toISOString()).order("start_time",{ascending:!0}).limit(4);if(!be&&X){const a=X.map(d=>({...d,title:d.title,start_time:d.start_time,type:"meeting"}));H(d=>[...d,...a].sort((r,o)=>new Date(r.start_time)-new Date(o.start_time)).slice(0,4))}const{data:Y,error:ue}=await n.from("submissions").select(`
          student_id,
          grade,
          student:profiles!student_id(full_name)
        `).in("activity_id",f).not("grade","is",null);if(!ue&&Y){const a={};Y.forEach(r=>{a[r.student_id]||(a[r.student_id]={grades:[],name:r.student?.full_name||"Aluno"}),a[r.student_id].grades.push(r.grade)});const d=Object.entries(a).map(([r,o])=>({id:r,name:o.name,avgGrade:o.grades.reduce((ve,we)=>ve+we,0)/o.grades.length,totalActivities:o.grades.length})).filter(r=>r.avgGrade<6).sort((r,o)=>r.avgGrade-o.avgGrade).slice(0,10);le(d)}const{data:pe,error:fe}=await n.from("activities").select("*").eq("created_by",h.id).eq("status","draft").gte("created_at",j.toISOString()).lt("created_at",v.toISOString());fe||de(pe||[]);const je=S.reduce((a,d)=>a+(d.student_count||0),0);te({totalClasses:S.length,totalStudents:je,totalActivities:C?.length||0,pendingGrading:U?.length||0,avgGrade:Number(xe.toFixed(1)),todayCorrections:he?.length||0}),ae(S.slice(0,5)),se(ce.slice(0,5)),re(me),E.debug("[TeacherDashboard] Dados carregados com sucesso")}catch(t){E.error("Erro ao carregar dashboard:",t),I("Erro ao carregar dados do dashboard. Tente novamente.")}finally{k(!1)}},ne=[{title:"Total de Turmas",value:c.totalClasses,icon:G,gradient:"from-blue-600 to-cyan-600",bgColor:"bg-blue-50 dark:bg-blue-950/30",change:`${c.totalStudents} alunos`},{title:"Total de Alunos",value:c.totalStudents,icon:De,gradient:"from-cyan-500 to-blue-600",bgColor:"bg-cyan-50 dark:bg-cyan-950/30"},{title:"MÃ©dia Geral",value:c.avgGrade,icon:Ee,gradient:"from-emerald-500 to-teal-500",bgColor:"bg-emerald-50 dark:bg-emerald-950/30",change:c.avgGrade>=7?"Excelente":"Pode melhorar"},{title:"Aguardando CorreÃ§Ã£o",value:c.pendingGrading,icon:q,gradient:"from-amber-500 to-orange-500",bgColor:"bg-amber-50 dark:bg-amber-950/30",change:`${c.todayCorrections} hoje`}],oe=[{label:"Nova Turma",icon:P,href:"/dashboard/classes/new",gradient:"from-blue-600 to-indigo-600"},{label:"Nova Atividade",icon:P,href:"/dashboard/activities/new",gradient:"from-blue-600 to-cyan-600"},{label:"Ver Analytics",icon:ze,href:"/dashboard/analytics",gradient:"from-emerald-600 to-teal-600"}];return ee?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ke,{size:"lg",text:"Carregando dashboard..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(Se,{title:"Dashboard do Professor",subtitle:"Bem-vindo de volta! Aqui estÃ¡ um resumo das suas turmas e atividades.",role:"teacher"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:ne.map((t,s)=>e.jsx(_e,{title:t.title,value:t.value,icon:t.icon,gradient:t.gradient,bgColor:t.bgColor,change:t.change,delay:s*.1},t.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"PrÃ³ximos Eventos"})]}),e.jsx(m,{to:"/dashboard/calendar",children:e.jsxs(l,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todos"}),e.jsx(N,{className:"w-4 h-4"})]})})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(l,{size:"sm",variant:b===1?"default":"outline",onClick:()=>{_(1),p()},children:"Hoje"}),e.jsx(l,{size:"sm",variant:b===3?"default":"outline",onClick:()=>{_(3),p()},children:"3 dias"}),e.jsx(l,{size:"sm",variant:b===7?"default":"outline",onClick:()=>{_(7),p()},children:"7 dias"})]}),e.jsx("div",{className:"space-y-3",children:$.length>0?$.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-center gap-3 p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:[e.jsxs("div",{className:"flex-shrink-0 w-16 h-16 bg-gradient-to-br from-blue-600 to-cyan-500 rounded-lg flex flex-col items-center justify-center text-white",children:[e.jsx("div",{className:"text-2xl font-bold",children:y(new Date(t.start_time),"d")}),e.jsx("div",{className:"text-xs uppercase",children:y(new Date(t.start_time),"MMM",{locale:Pe})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white truncate",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:y(new Date(t.start_time),"HH:mm")}),e.jsx(T,{className:`mt-1 ${t.type==="meeting"?"bg-purple-100 text-purple-700":t.type==="activity"?"bg-orange-100 text-orange-700":t.type==="deadline"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:t.type==="event"?"Aula":t.type==="activity"?"Atividade":t.type==="meeting"?"ReuniÃ£o":t.type==="deadline"?"Prazo":"Evento"})]})]},t.id)):e.jsx(w,{icon:z,title:"Nenhum evento prÃ³ximo",description:"Seus prÃ³ximos eventos aparecerÃ£o aqui."})})]}),e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Te,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Agenda de Hoje"})]}),e.jsxs("div",{className:"space-y-4",children:[V.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Eventos"}),V.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800",children:[e.jsx(q,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:y(new Date(t.start_time),"HH:mm")})]})]},t.id))]}):e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Nenhum evento hoje"}),L.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Atividades para Postar"}),L.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-slate-900 dark:text-white text-sm",children:t.title})}),e.jsx(l,{size:"sm",className:"bg-gradient-to-r from-blue-600 to-cyan-600",onClick:()=>B(`/dashboard/activities/${t.id}`),children:"Publicar"})]},t.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Turmas Recentes"]}),e.jsx(m,{to:"/dashboard/classes",children:e.jsxs(l,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(N,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:O.length>0?O.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},children:e.jsx(m,{to:`/dashboard/classes/${t.id}`,children:e.jsx(x,{className:"p-4 hover:shadow-md transition-all border-2 hover:border-blue-200 dark:hover:border-blue-800 bg-white dark:bg-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${t.color||"from-blue-500 to-indigo-500"} flex items-center justify-center text-white font-bold`,children:t.name?.[0]||"T"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.subject||"Sem matÃ©ria"," â€¢ ",t.student_count||0," alunos"]})]})]}),e.jsx(l,{size:"sm",variant:"ghost",className:"whitespace-nowrap",children:"Ver Turma"})]})})})},t.id)):e.jsx(w,{icon:G,title:"Nenhuma turma encontrada",description:"Crie sua primeira turma para comeÃ§ar a gerenciar suas aulas e atividades.",actionLabel:"Criar Primeira Turma",actionIcon:P,action:()=>window.location.href="/dashboard/classes/new"})})]}),e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Atividades Recentes"]}),e.jsx(m,{to:"/dashboard/activities",children:e.jsxs(l,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(N,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:R.length>0?R.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700 transition-all bg-white dark:bg-slate-800",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:t.class_name}),e.jsx("div",{className:"flex items-center gap-3 text-xs text-slate-500 dark:text-slate-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),new Date(t.due_date).toLocaleDateString("pt-BR")]})})]}),e.jsx(T,{variant:t.status==="archived"?"secondary":new Date(t.due_date)<new Date?"destructive":"default",className:"whitespace-nowrap",children:t.status==="archived"?"Arquivada":new Date(t.due_date)<new Date?"Encerrada":"Aberta"})]})},t.id)):e.jsx(w,{icon:Z,title:"Nenhuma atividade encontrada",description:"Suas atividades recentes aparecerÃ£o aqui."})})]})]}),u.length>0&&e.jsxs(x,{className:"p-6 mb-8 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-950/20 dark:to-orange-950/20 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100 dark:bg-yellow-900/40",children:e.jsx(Ge,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Alunos que Precisam de AtenÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[u.length," aluno",u.length>1?"s":""," com desempenho abaixo de 6.0"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:u.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:s*.05},className:"flex items-center gap-4 p-4 rounded-lg bg-white dark:bg-slate-900 border-2 border-yellow-200 dark:border-yellow-800 hover:shadow-md transition-all",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center text-white font-bold text-lg",children:t.name?.[0]||"A"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(T,{className:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300 text-xs",children:["MÃ©dia: ",t.avgGrade.toFixed(1)]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[t.totalActivities," atividade",t.totalActivities>1?"s":""]})]})]}),e.jsx(l,{size:"sm",variant:"outline",className:"whitespace-nowrap border-yellow-600 text-yellow-700 hover:bg-yellow-50",onClick:()=>B(`/dashboard/students/${t.id}`),children:"Ver Detalhes"})]},t.id))})]}),e.jsxs(x,{className:"p-6 mb-8 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"SubmissÃµes Pendentes de CorreÃ§Ã£o"]}),e.jsx(m,{to:"/dashboard/grading",children:e.jsxs(l,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(N,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:F.length>0?F.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-center justify-between p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-amber-300 dark:hover:border-amber-700 transition-all bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold",children:t.student_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.student_name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.activity_title}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Enviado em ",new Date(t.submitted_at).toLocaleDateString("pt-BR")]})]})]}),e.jsx(m,{to:`/dashboard/grading/${t.id}`,children:e.jsx(l,{size:"sm",className:"whitespace-nowrap bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white",children:"Corrigir Agora"})})]},t.id)):e.jsx(w,{icon:qe,title:"Nenhuma correÃ§Ã£o pendente!",description:"ParabÃ©ns! VocÃª estÃ¡ em dia com as correÃ§Ãµes. ðŸŽ‰"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:oe.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},children:e.jsx(m,{to:t.href,children:e.jsxs(l,{size:"lg",className:`w-full whitespace-nowrap inline-flex items-center justify-center gap-2 bg-gradient-to-r ${t.gradient} hover:opacity-90 text-white h-16 text-lg`,children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsx("span",{children:t.label})]})})},t.label))})]})};export{kt as default};
