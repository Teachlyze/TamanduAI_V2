import{c as me,j as e,b as ge,u as ue,r as d,s as c,l as p}from"./main-BtydHokz.js";import{u as xe}from"./use-toast-BD7ojcJx.js";import{C as Z}from"./card-BLN8IVBT.js";import{B as C}from"./button-pkZcz0fw.js";import{B as Q}from"./badge-DpVvk9bK.js";import{m as b}from"./proxy-BKNTM3tf.js";import{B as M}from"./book-open-BQJiPDff.js";import{U as he}from"./users-CntpuLnR.js";import{F as pe}from"./file-text-GwBv-P3B.js";import{E as be}from"./EmptyState-Dl2p8Yg2.js";import"./dialog-BI66C03T.js";import{I as W}from"./input-DevW5dIO.js";import{T as fe,a as ve,b as q}from"./tabs-CcynQOeo.js";import{S as K}from"./search-B-7BMQB5.js";import{G as je}from"./grid-3x3-uJ7kq_mu.js";import{L as we}from"./list-bE65Ss75.js";import{S as X}from"./star-C-keNCTw.js";import{X as Ne}from"./x-BtLVjj0F.js";import"./index-BRR_QA-l.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./chevron-right-Bh44L5jc.js";import"./index-DsrKRt14.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";const ye=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],_e=me("log-in",ye),ke=({classItem:a,onClick:S,index:E=0})=>{const T={blue:"from-blue-600 to-cyan-500",green:"from-green-600 to-emerald-500",purple:"from-purple-600 to-pink-500",orange:"from-orange-600 to-amber-500",red:"from-red-600 to-rose-500",yellow:"from-yellow-600 to-orange-500",pink:"from-pink-600 to-rose-500",indigo:"from-indigo-600 to-purple-500",cyan:"from-cyan-600 to-blue-500",teal:"from-teal-600 to-green-500"},w=T[a.color]||T.blue;return e.jsx(b.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:E*.1,type:"spring"},whileHover:{scale:1.05,y:-8},onClick:S,className:"cursor-pointer",children:e.jsxs(Z,{className:"overflow-hidden border-2 border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 hover:shadow-2xl transition-all",children:[e.jsxs("div",{className:`h-28 sm:h-32 bg-gradient-to-br ${w} p-4 sm:p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute -right-8 -bottom-8 opacity-20",children:e.jsx(M,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(Q,{className:"mb-2 bg-white/20 text-white border-white/30 backdrop-blur-sm",children:a.subject||"MatÃ©ria"}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold line-clamp-2",children:a.name})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:a.teacher_name||"Professor"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400",children:a.pendingActivities||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600 dark:text-green-400",children:a.avgGrade!==null&&a.avgGrade!==void 0?a.avgGrade.toFixed(1):"--"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"MÃ©dia"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-orange-600 dark:text-orange-400",children:a.studentsCount||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Alunos"})]})]}),a.newActivities>0&&e.jsx(b.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3},children:e.jsxs(Q,{className:"w-full justify-center py-2 bg-orange-100 text-orange-700 dark:bg-orange-900/40 dark:text-orange-300 border-orange-300 dark:border-orange-700",children:["ðŸ”” ",a.newActivities," nova",a.newActivities>1?"s":""," atividade",a.newActivities>1?"s":""]})}),a.nextDeadline&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),"PrÃ³ximo prazo: ",a.nextDeadline]})]})]})})},nt=()=>{const{user:a}=ge(),S=ue(),{toast:E}=xe(),[T,w]=d.useState(!0),[Y,I]=d.useState(!0),[m,F]=d.useState([]),[z,ee]=d.useState([]),[g,te]=d.useState(""),[D,O]=d.useState("grid"),[G,se]=d.useState("name"),[ae,f]=d.useState(!1),[x,N]=d.useState(""),[v,J]=d.useState(!1),[A,l]=d.useState("");d.useEffect(()=>{a?.id&&U()},[a]),d.useEffect(()=>{re()},[m,g,G]);const U=async()=>{try{w(!0);const{data:t}=await c.from("class_members").select("class_id, joined_at").eq("user_id",a.id).eq("role","student"),s=t?.map(i=>i.class_id)||[],{data:r}=await c.from("classes").select("id, name, subject, color, created_at, created_by").in("id",s),u=r?.map(i=>i.created_by).filter(Boolean)||[],{data:n}=await c.from("profiles").select("id, full_name, avatar_url").in("id",u),L={};if(n?.forEach(i=>{L[i.id]=i}),s.length===0){F([]),w(!1);return}const P=await Promise.all(r.map(async i=>{const R=t.find(o=>o.class_id===i.id),{data:y}=await c.from("activity_class_assignments").select("activity_id").eq("class_id",i.id),j=y?.map(o=>o.activity_id)||[],{data:h}=await c.from("submissions").select("activity_id, status, grade").eq("student_id",a.id).in("activity_id",j),_=new Set(h?.map(o=>o.activity_id)||[]),k=j.length-_.size,B=h?.filter(o=>o.grade!==null)||[],ie=B.length>0?B.reduce((o,ce)=>o+parseFloat(ce.grade),0)/B.length:null,{data:oe}=await c.from("class_members").select("id, is_archived").eq("class_id",i.id).eq("role","student"),ne=oe?.filter(o=>!o.is_archived).length||0,V=new Date;V.setDate(V.getDate()-7);const{data:de}=await c.from("activity_class_assignments").select("activity_id, assigned_at").eq("class_id",i.id).gte("assigned_at",V.toISOString()),le=(de?.map(o=>o.activity_id)||[]).filter(o=>!_.has(o)).length,H=L[i.created_by];return{id:i.id,name:i.name,subject:i.subject,color:i.color||"blue",teacher_name:H?.full_name||"Professor",teacher_avatar:H?.avatar_url,pendingActivities:k,avgGrade:ie,studentsCount:ne||0,newActivities:le,joined_at:R?.joined_at,created_at:i.created_at}}));F(P)}catch(t){p.error("Erro ao carregar turmas:",t),E({title:"Erro ao carregar turmas",description:"NÃ£o foi possÃ­vel carregar suas turmas. Tente novamente em instantes.",variant:"destructive"})}finally{w(!1),Y&&I(!1)}},re=()=>{let t=[...m];if(g){const s=g.toLowerCase();t=t.filter(r=>r.name?.toLowerCase().includes(s)||r.subject?.toLowerCase().includes(s)||r.teacher_name?.toLowerCase().includes(s))}t.sort((s,r)=>{switch(G){case"name":return s.name.localeCompare(r.name);case"pending":return r.pendingActivities-s.pendingActivities;case"grade":const u=s.avgGrade||0;return(r.avgGrade||0)-u;case"recent":return new Date(r.joined_at)-new Date(s.joined_at);default:return 0}}),ee(t)},$=async()=>{const t=x.replace(/\s/g,"").trim().toUpperCase();if(!t){l("Digite o cÃ³digo da turma");return}if(t.length!==8){l("O cÃ³digo deve ter exatamente 8 caracteres");return}if(!a?.id){l("VocÃª precisa estar autenticado para entrar em uma turma.");return}try{J(!0),l("");const s=t,{data:r,error:u}=await c.from("classes").select("id, name, is_active").eq("invite_code",s).maybeSingle();if(console.log("[StudentClassesPageRedesigned] Resultado busca por cÃ³digo:",{normalizedCode:s,classData:r,classError:u}),u)throw p.error("[StudentClassesPageRedesigned] Erro ao buscar turma por cÃ³digo:",u),new Error("CÃ³digo de turma invÃ¡lido ou turma nÃ£o encontrada");let n=r;if(!n){const{data:j,error:h}=await c.from("class_settings").select("class_id, is_join_code_active").eq("join_code",s).eq("is_join_code_active",!0).maybeSingle();if(console.log("[StudentClassesPageRedesigned] Resultado busca em class_settings.join_code:",{normalizedCode:s,settingsMatch:j,settingsError:h}),h&&h.code!=="PGRST116")throw p.error("[StudentClassesPageRedesigned] Erro ao buscar cÃ³digo em class_settings:",h),new Error("CÃ³digo de turma invÃ¡lido ou turma nÃ£o encontrada");if(j?.class_id){const{data:_,error:k}=await c.from("classes").select("id, name, is_active").eq("id",j.class_id).maybeSingle();if(console.log("[StudentClassesPageRedesigned] Resultado busca turma via class_settings:",{classFromSettings:_,classFromSettingsError:k}),k)throw p.error("[StudentClassesPageRedesigned] Erro ao buscar turma a partir de class_settings:",k),new Error("CÃ³digo de turma invÃ¡lido ou turma nÃ£o encontrada");n=_}}if(!!!(n&&Object.keys(n).length>0)||n.is_active===!1)throw new Error("CÃ³digo de turma invÃ¡lido ou turma nÃ£o encontrada");const{data:P,error:i}=await c.from("class_members").select("id").eq("class_id",n.id).eq("user_id",a.id).maybeSingle();if(console.log("[StudentClassesPageRedesigned] VerificaÃ§Ã£o de membro existente:",{classId:n.id,userId:a.id,existingMember:P,memberCheckError:i}),i&&i.code!=="PGRST116")throw p.error("[StudentClassesPageRedesigned] Erro ao verificar participaÃ§Ã£o na turma:",i),new Error("NÃ£o foi possÃ­vel verificar sua participaÃ§Ã£o na turma");if(P)throw new Error("VocÃª jÃ¡ Ã© membro desta turma");const{data:R,error:y}=await c.from("class_members").insert({class_id:n.id,user_id:a.id,role:"student",joined_at:new Date().toISOString()}).select().single();if(console.log("[StudentClassesPageRedesigned] Resultado insert em class_members:",{newMember:R,joinError:y}),y)throw p.error("[StudentClassesPageRedesigned] Erro ao inserir aluno na turma:",y),new Error("Erro ao entrar na turma");if(!R)throw new Error("Erro ao entrar na turma");f(!1),N(""),l(""),await U(),E({title:"ðŸŽ‰ Bem-vindo(a)!",description:`VocÃª entrou na turma "${n.name}" com sucesso!`}),S(`/students/classes/${n.id}`)}catch(s){p.error("Erro ao entrar na turma:",s);const r=s?.message||"";r.includes("jÃ¡ Ã© membro")?l("VocÃª jÃ¡ faz parte desta turma!"):r.includes("invÃ¡lido")||r.includes("nÃ£o encontrada")?l("CÃ³digo invÃ¡lido! Verifique se digitou corretamente e tente novamente."):l("NÃ£o foi possÃ­vel entrar na turma. Tente novamente ou contate o professor.")}finally{J(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs(b.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(M,{className:"w-8 h-8 text-blue-600"}),"Minhas Turmas"]}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[m.length," turma",m.length!==1?"s":""," ativa",m.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(W,{placeholder:"Buscar turmas por nome, matÃ©ria ou professor...",value:g,onChange:t=>te(t.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center",children:[e.jsx(fe,{value:G,onValueChange:se,children:e.jsxs(ve,{children:[e.jsx(q,{value:"name",children:"Nome"}),e.jsx(q,{value:"pending",children:"Pendentes"}),e.jsx(q,{value:"grade",children:"MÃ©dia"}),e.jsx(q,{value:"recent",children:"Recentes"})]})}),e.jsxs("div",{className:"flex border rounded-lg overflow-hidden",children:[e.jsx(C,{variant:D==="grid"?"default":"ghost",size:"sm",onClick:()=>O("grid"),className:"rounded-none",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(C,{variant:D==="list"?"default":"ghost",size:"sm",onClick:()=>O("list"),className:"rounded-none",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsxs(C,{type:"button",onClick:()=>f(!0),className:"sm:ml-2 bg-blue-600 hover:bg-blue-700 text-white whitespace-nowrap",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Entrar com cÃ³digo"]})]})]}),z.length>0?e.jsx("div",{className:D==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6":"space-y-3 sm:space-y-4",children:z.map((t,s)=>e.jsx(ke,{classItem:t,onClick:()=>S(`/students/classes/${t.id}`),index:s},t.id))}):e.jsx(be,{icon:g?K:M,title:g?"Nenhuma turma encontrada":"VocÃª ainda nÃ£o estÃ¡ em nenhuma turma",description:g?"Tente ajustar sua busca para encontrar o que procura.":"Use o cÃ³digo fornecido pelo seu professor para entrar em uma turma.",action:g?void 0:()=>f(!0),actionLabel:g?void 0:"Entrar com cÃ³digo da turma",variant:"default"}),m.length>0&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-8 sm:mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(M,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Total de Turmas"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-blue-600",children:m.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30",children:e.jsx(X,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Atividades Pendentes"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-orange-600",children:m.reduce((t,s)=>t+s.pendingActivities,0)})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(X,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"MÃ©dia Geral"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-green-600",children:(()=>{const t=m.filter(r=>r.avgGrade!==null);return t.length===0?"--":(t.reduce((r,u)=>r+u.avgGrade,0)/t.length).toFixed(1)})()})]})]}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{f(!1),N(""),l("")},children:e.jsx(b.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:t=>t.stopPropagation(),children:e.jsxs(Z,{className:"p-8 max-w-md w-full bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Entrar em uma Turma"}),e.jsx("button",{type:"button",onClick:()=>{f(!1),N(""),l("")},className:"p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(Ne,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Digite o cÃ³digo fornecido pelo professor"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:"O cÃ³digo tem 8 caracteres (letras e nÃºmeros)"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(W,{value:x,onChange:t=>{const s=t.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"");s.length<=8&&(N(s),l(""))},onKeyPress:t=>{t.key==="Enter"&&x.trim().length===8&&!v&&$()},placeholder:"CÃ“DIGO DA TURMA",maxLength:8,className:`text-center text-2xl font-mono tracking-widest uppercase h-14 border-2 transition-colors ${A?"border-red-500 focus:border-red-600 dark:border-red-600 dark:focus:border-red-500":x.length===8?"border-green-500 focus:border-green-600 dark:border-green-600 dark:focus:border-green-500":"border-slate-300 focus:border-blue-500 dark:border-slate-700 dark:focus:border-blue-500"}`,autoFocus:!0,disabled:v}),e.jsxs("div",{className:"absolute -bottom-6 right-0 text-xs text-slate-500",children:[x.length,"/8"]})]}),A&&e.jsx(b.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-8 p-3 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400 font-medium text-center",children:A})}),!A&&x.length===8&&!v&&e.jsx(b.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-8 p-3 bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400 font-medium text-center",children:'âœ“ CÃ³digo completo! Clique em "Entrar" ou pressione Enter'})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(C,{variant:"outline",onClick:()=>{f(!1),N(""),l("")},className:"flex-1 border-slate-300 dark:border-slate-700",disabled:v,children:"Cancelar"}),e.jsx(C,{onClick:$,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",disabled:v||!x.trim(),children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Entrando..."]}):"Entrar"})]})]})})})]})};export{nt as default};
