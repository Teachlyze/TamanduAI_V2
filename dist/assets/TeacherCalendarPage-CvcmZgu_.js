import{r as l,s as A,l as M,j as e,q as V,b as ae,R as le}from"./main-BSajwT7t.js";import{C as I}from"./card-Bocxgg1Q.js";import{B as C}from"./button-49_9eRW2.js";import{t as z}from"./use-toast-CI7Qu0JR.js";import{r as R}from"./redisCache-CYYpuKE4.js";import{X as ee}from"./x-Wvu9FBm3.js";import{B as re}from"./book-open-BqVBcqQl.js";import{F as ie}from"./file-text-Bwu_iaa-.js";import{U as oe}from"./users-De1bkoUV.js";import{C as te}from"./calendar-DetO6w5d.js";import{S as ne}from"./save-DigPTmhI.js";import{f as m}from"./format-B5colFmK.js";import{E as de}from"./EventDetailsModal-Bth84Ell.js";import{F as ce}from"./funnel-CmU7gkfH.js";import{s as W,a as me,i as ue}from"./isSameMonth-DXWacbVA.js";import{e as Y}from"./endOfMonth-B3jF8fTW.js";import{s as xe,e as pe}from"./subMonths-CcPB7G76.js";import{m as X}from"./proxy-Bb-A2TUD.js";import{P as Z}from"./plus-DBp3h9bh.js";import{C as be}from"./index-D0BS1fLY.js";import{C as he}from"./chevron-right-DUVlURpD.js";import{A as ge}from"./index-DV-1B3c4.js";import{i as ye}from"./isToday-Cwn90TaQ.js";import{p as K}from"./pt-BR-D0BJ_iDf.js";import"./en-US-DaE-csDX.js";import"./badge-CfC7p-Az.js";import"./clock-DUfJelbJ.js";import"./map-pin-Ed5qSEFg.js";import"./user-C_KdkjIX.js";import"./video-GMK5YjAg.js";import"./square-pen-BMgVe-EP.js";import"./copy-DlSUrt5X.js";import"./trash-2-BUy2_VOi.js";import"./index-BSMAqeIB.js";import"./constructNow-BZVcxkR5.js";import"./isSameDay-D48s9Jab.js";const ve=({isOpen:r,onClose:o,onSuccess:b,selectedDate:v,teacherId:g,editEvent:n=null})=>{const[x,S]=l.useState(!1),[D,q]=l.useState([]),[f,i]=l.useState([]),[j,_]=l.useState([]),[E,$]=l.useState(!1),k=!!n,[t,c]=l.useState({title:"",description:"",type:"event",start_date:v?m(v,"yyyy-MM-dd"):m(new Date,"yyyy-MM-dd"),start_time:"08:00",end_time:"09:00",modality:"online",meeting_link:"",location:"",selected_classes:[],selected_students:[],invite_type:"all",color:"#3B82F6",activity_id:null});l.useEffect(()=>{P(),T()},[g]),l.useEffect(()=>{if(k&&n&&r){const s=new Date(n.start_time),d=new Date(n.end_time);c({title:n.title||"",description:n.description||"",type:n.type||"event",start_date:m(s,"yyyy-MM-dd"),start_time:m(s,"HH:mm"),end_time:m(d,"HH:mm"),modality:n.modality||"online",meeting_link:n.meeting_link||"",location:n.location||"",selected_classes:n.class_id?[n.class_id]:[],selected_students:n.attendees||[],invite_type:n.attendees?.length>0?"individuals":n.class_id?"classes":"all",color:n.color||"#3B82F6",activity_id:n.activity_id||null})}else!k&&r&&c({title:"",description:"",type:"event",start_date:v?m(v,"yyyy-MM-dd"):m(new Date,"yyyy-MM-dd"),start_time:"08:00",end_time:"09:00",modality:"online",meeting_link:"",location:"",selected_classes:[],selected_students:[],invite_type:"all",color:"#3B82F6",activity_id:null})},[k,n,r,v]),l.useEffect(()=>{t.selected_classes.length>0&&t.invite_type==="individuals"?N():i([])},[t.selected_classes,t.invite_type]);const P=async()=>{try{const{data:s}=await A.from("classes").select("id, name").eq("created_by",g).eq("is_active",!0).order("name");q(s||[])}catch(s){M.error("Erro ao carregar turmas:",s)}},T=async()=>{try{const{data:s}=await A.from("activities").select("id, title, type, status").eq("created_by",g).neq("status","archived").order("created_at",{ascending:!1}).limit(50);_(s||[])}catch(s){M.error("Erro ao carregar atividades:",s)}},N=async()=>{try{$(!0);const{data:s,error:d}=await A.from("class_members").select(`
          user_id,
          class_id,
          profile:profiles!class_members_user_id_fkey(
            id,
            full_name,
            email,
            avatar_url
          )
        `).in("class_id",t.selected_classes).eq("role","student");if(d)throw d;const p=(s||[]).map(h=>({id:h.profile.id,name:h.profile.full_name||h.profile.email,email:h.profile.email,avatar:h.profile.avatar_url,classId:h.class_id})),y=Array.from(new Map(p.map(h=>[h.id,h])).values());i(y)}catch(s){M.error("Erro ao carregar alunos:",s),z({title:"Erro ao carregar alunos",description:s.message,variant:"destructive"})}finally{$(!1)}},L=async s=>{if(s.preventDefault(),!t.title.trim()){z({title:"Erro de validaÃ§Ã£o",description:"O tÃ­tulo Ã© obrigatÃ³rio.",variant:"destructive"});return}if(t.modality==="online"&&!t.meeting_link.trim()){z({title:"Erro de validaÃ§Ã£o",description:"Link da reuniÃ£o Ã© obrigatÃ³rio para eventos online.",variant:"destructive"});return}try{if(S(!0),k&&n){const H=new Date(`${t.start_date}T${t.start_time}`),a=new Date(`${t.start_date}T${t.end_time}`),u={title:t.title,description:t.description,type:t.type,start_time:H.toISOString(),end_time:a.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,attendees:t.invite_type==="individuals"?t.selected_students:null,color:t.color,activity_id:t.activity_id||null,updated_at:new Date().toISOString()},{error:w}=await A.from("calendar_events").update(u).eq("id",n.id);if(w)throw M.error("Erro ao atualizar evento:",w),new Error(w.message||"Erro ao atualizar evento");await R.deletePattern(`calendar:${g}:*`),z({title:"âœ… Evento atualizado!",description:`${t.title} foi atualizado com sucesso`}),b&&b(),o();return}const d=new Date(`${t.start_date}T${t.start_time}`),p=new Date(`${t.start_date}T${t.end_time}`);let y=null;t.type==="meeting"&&t.invite_type==="individuals"&&(y=t.selected_students);const h=t.selected_classes.length>0?t.selected_classes.map(H=>({title:t.title,description:t.description,type:t.type,start_time:d.toISOString(),end_time:p.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,class_id:H,attendees:y,color:t.color,activity_id:t.activity_id||null})):[{title:t.title,description:t.description,type:t.type,start_time:d.toISOString(),end_time:p.toISOString(),modality:t.modality,meeting_link:t.modality==="online"?t.meeting_link:null,location:t.modality==="presential"?t.location:null,created_by:g,attendees:y,color:t.color,activity_id:t.activity_id||null}],{error:O}=await A.from("calendar_events").insert(h);if(O)throw M.error("Erro ao criar evento:",O),new Error(O.message||"Erro ao criar evento no banco de dados");const Q=m(d,"yyyy-MM");await R.deletePattern(`calendar:${g}:*`);const B=h.length;z({title:"âœ… Evento criado com sucesso!",description:B>1?`${B} eventos criados para diferentes turmas`:`${t.title} foi adicionado ao calendÃ¡rio`}),b&&b(),o()}catch(d){M.error("Erro ao criar evento:",d),z({title:"âŒ Erro ao criar evento",description:d.message||"NÃ£o foi possÃ­vel criar o evento. Tente novamente.",variant:"destructive"})}finally{S(!1)}},F=[{value:"event",label:"Aula",icon:re,color:"blue"},{value:"activity",label:"Atividade",icon:ie,color:"orange"},{value:"meeting",label:"ReuniÃ£o",icon:oe,color:"purple"},{value:"deadline",label:"Prazo",icon:te,color:"red"}];return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:k?"Editar Evento":"Novo Evento"}),e.jsx("button",{onClick:o,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",children:e.jsx(ee,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:L,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Tipo de Evento"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:F.map(s=>{const d=s.icon,p=t.type===s.value;return e.jsxs("button",{type:"button",onClick:()=>c({...t,type:s.value}),className:`p-4 rounded-lg border-2 transition-all ${p?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:[e.jsx(d,{className:`w-6 h-6 mx-auto mb-2 ${p?"text-blue-600":"text-slate-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.value)})})]}),t.type==="activity"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Vincular Atividade"}),e.jsxs("select",{value:t.activity_id||"",onChange:s=>{const d=s.target.value||null,p=j.find(y=>y.id===d);c({...t,activity_id:d,title:p?p.title:t.title})},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Nenhuma atividade vinculada"}),j.map(s=>e.jsxs("option",{value:s.id,children:[s.title," (",s.type,")"]},s.id))]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Vincule uma atividade existente a este evento de agenda"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"TÃ­tulo *"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>c({...t,title:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Aula de MatemÃ¡tica",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:t.description,onChange:s=>c({...t,description:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Detalhes do evento..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Data *"}),e.jsx("input",{type:"date",value:t.start_date,onChange:s=>c({...t,start_date:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"InÃ­cio *"}),e.jsx("input",{type:"time",value:t.start_time,onChange:s=>c({...t,start_time:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Fim *"}),e.jsx("input",{type:"time",value:t.end_time,onChange:s=>c({...t,end_time:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",required:!0})]})]}),t.type==="meeting"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Convidar"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>c({...t,invite_type:"all",selected_classes:[],selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="all"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"Todos"}),e.jsx("button",{type:"button",onClick:()=>c({...t,invite_type:"classes",selected_students:[]}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="classes"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"Por Turma"}),e.jsx("button",{type:"button",onClick:()=>c({...t,invite_type:"individuals"}),className:`p-3 rounded-lg border-2 transition-all text-sm ${t.invite_type==="individuals"?"border-blue-600 bg-blue-50 dark:bg-blue-950/30 text-blue-700":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:"Individual"})]})]}),(t.type==="event"||t.type==="activity"||t.type==="meeting"&&(t.invite_type==="classes"||t.invite_type==="individuals"))&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Turmas ",t.invite_type==="individuals"&&"(selecione para filtrar alunos)"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:D.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhuma turma encontrada"}):D.map(s=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_classes.includes(s.id),onChange:d=>{const p=d.target.checked?[...t.selected_classes,s.id]:t.selected_classes.filter(y=>y!==s.id);c({...t,selected_classes:p})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))})]}),t.type==="meeting"&&t.invite_type==="individuals"&&t.selected_classes.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Selecionar Alunos (",t.selected_students.length," selecionados)"]}),E?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(V,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-slate-500",children:"Carregando alunos..."})]}):e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 border border-slate-200 dark:border-slate-700 rounded-lg",children:f.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhum aluno encontrado nas turmas selecionadas"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-slate-900 pb-2 border-b border-slate-200 dark:border-slate-700",children:e.jsx("button",{type:"button",onClick:()=>{const s=f.every(d=>t.selected_students.includes(d.id));c({...t,selected_students:s?[]:f.map(d=>d.id)})},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:f.every(s=>t.selected_students.includes(s.id))?"Desmarcar todos":"Selecionar todos"})}),f.map(s=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.selected_students.includes(s.id),onChange:d=>{const p=d.target.checked?[...t.selected_students,s.id]:t.selected_students.filter(y=>y!==s.id);c({...t,selected_students:p})},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.email})]})]})]},s.id))]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Modalidade"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"online",checked:t.modality==="online",onChange:s=>c({...t,modality:s.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Online"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"presential",checked:t.modality==="presential",onChange:s=>c({...t,modality:s.target.value}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Presencial"})]})]})]}),t.modality==="online"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Link da ReuniÃ£o *"}),e.jsx("input",{type:"url",value:t.meeting_link,onChange:s=>c({...t,meeting_link:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"https://meet.google.com/...",required:!0})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Local"}),e.jsx("textarea",{value:t.location,onChange:s=>c({...t,location:s.target.value}),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Ex: Sala 203, Bloco B"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(C,{type:"button",variant:"outline",onClick:o,disabled:x,className:"flex-1",children:"Cancelar"}),e.jsx(C,{type:"submit",disabled:x,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:x?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:"sm",className:"mr-2"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),k?"Salvar AlteraÃ§Ãµes":"Criar Evento"]})})]})]})]})}):null},fe=({filters:r,setFilters:o,teacherId:b})=>{const[v,g]=l.useState([]);l.useEffect(()=>{n()},[b]);const n=async()=>{try{const{data:i}=await A.from("classes").select("id, name").eq("created_by",b).eq("is_active",!0).order("name");g(i||[])}catch(i){M.error("Erro ao carregar turmas:",i)}},x=[{value:"class",label:"Aulas",color:"blue"},{value:"exam",label:"Provas",color:"red"},{value:"meeting",label:"ReuniÃµes",color:"purple"},{value:"personal",label:"Pessoal",color:"gray"}],S=i=>{const j=r.types.includes(i)?r.types.filter(_=>_!==i):[...r.types,i];o({...r,types:j})},D=i=>{const j=r.classes.includes(i)?r.classes.filter(_=>_!==i):[...r.classes,i];o({...r,classes:j})},q=()=>{o({types:[],classes:[],modality:"all"})},f=r.types.length>0||r.classes.length>0||r.modality!=="all";return e.jsxs(I,{className:"p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Filtros"]}),f&&e.jsx(C,{variant:"ghost",size:"sm",onClick:q,children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Tipo de Evento"}),e.jsx("div",{className:"space-y-2",children:x.map(i=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.types.includes(i.value),onChange:()=>S(i.value),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:i.label})]},i.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Turmas"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:v.map(i=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.classes.includes(i.id),onChange:()=>D(i.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:i.name})]},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Modalidade"}),e.jsxs("select",{value:r.modality,onChange:i=>o({...r,modality:i.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 text-sm",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"presential",children:"Presencial"})]})]})]})},se=le.memo(({day:r,dayEvents:o,isCurrentDay:b,isSameMonthDay:v,onClick:g,onEventClick:n})=>e.jsxs(X.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},onClick:g,className:`
        min-h-[70px] sm:min-h-[100px] md:min-h-[120px] p-1.5 sm:p-2 md:p-3 border rounded-lg sm:rounded-xl cursor-pointer transition-all hover:shadow-lg group relative
        ${b?"border-2 border-blue-600 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 shadow-md":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}
        ${!v&&"opacity-40"}
        hover:bg-gradient-to-br hover:from-slate-50 hover:to-blue-50 dark:hover:from-slate-800 dark:hover:to-blue-950/30
      `,children:[e.jsxs("div",{className:`
        text-xs sm:text-sm font-bold mb-1 sm:mb-2 flex items-center justify-between
        ${b?"text-blue-600":"text-slate-900 dark:text-white"}
      `,children:[e.jsx("span",{children:m(r,"d")}),o.length>0&&e.jsx("span",{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 rounded-full bg-blue-600 text-white text-[8px] sm:text-[10px] md:text-xs flex items-center justify-center",children:o.length})]}),e.jsxs("div",{className:"space-y-1 sm:space-y-1.5 hidden sm:block",children:[o.slice(0,2).map(x=>e.jsx("div",{onClick:S=>{S.stopPropagation(),n(x)},className:`
              text-xs px-2 py-1.5 rounded-lg truncate font-medium shadow-sm transition-all
              ${x.type==="event"&&"bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 dark:from-blue-900 dark:to-blue-800 dark:text-blue-200 hover:shadow-md"}
              ${x.type==="activity"&&"bg-gradient-to-r from-orange-100 to-orange-200 text-orange-800 dark:from-orange-900 dark:to-orange-800 dark:text-orange-200 hover:shadow-md"}
              ${x.type==="meeting"&&"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 dark:from-purple-900 dark:to-purple-800 dark:text-purple-200 hover:shadow-md"}
              ${x.type==="deadline"&&"bg-gradient-to-r from-red-100 to-red-200 text-red-800 dark:from-red-900 dark:to-red-800 dark:text-red-200 hover:shadow-md"}
              hover:scale-105
            `,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:m(new Date(x.start_time),"HH:mm")}),e.jsx("span",{className:"truncate",children:x.title})]})},x.id)),o.length>2&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 px-2 py-1 bg-blue-50 dark:bg-blue-950/30 rounded-lg font-medium",children:["+",o.length-2," evento",o.length-2>1?"s":""]})]})]}));se.displayName="CalendarDay";const at=()=>{const{user:r}=ae(),[o,b]=l.useState(new Date),[v,g]=l.useState([]),[n,x]=l.useState([]),[S,D]=l.useState(!0),[q,f]=l.useState(!1),[i,j]=l.useState(!1),[_,E]=l.useState(null),[$,k]=l.useState(null),[t,c]=l.useState([]),[P,T]=l.useState(!1),[N,L]=l.useState({types:[],classes:[],modality:"all"}),F=l.useCallback(async()=>{try{D(!0);const a=W(o),u=Y(o),w=R.generateKey("calendar",r.id,m(o,"yyyy-MM")),U=await R.cacheQuery(w,async()=>{const{data:G,error:J}=await A.from("calendar_events").select(`
              *,
              class:classes(id, name)
            `).eq("created_by",r.id).gte("start_time",a.toISOString()).lte("start_time",u.toISOString()).order("start_time");if(J)throw J;return G||[]},300);g(U)}catch(a){M.error("Erro ao carregar eventos:",a),z({title:"Erro ao carregar eventos",description:"NÃ£o foi possÃ­vel carregar seus eventos.",variant:"destructive"})}finally{D(!1)}},[o,r?.id]),s=l.useCallback(()=>{let a=[...v];N.types.length>0&&(a=a.filter(u=>N.types.includes(u.type))),N.classes.length>0&&(a=a.filter(u=>u.class_id&&N.classes.includes(u.class_id))),N.modality!=="all"&&(a=a.filter(u=>u.modality===N.modality)),x(a)},[v,N]);l.useEffect(()=>{r?.id&&F()},[r?.id,F]),l.useEffect(()=>{s()},[s]);const d=l.useCallback(()=>{b(a=>xe(a)),T(!1)},[]),p=l.useCallback(()=>{b(a=>me(a,1)),T(!1)},[]),y=l.useCallback(()=>{b(new Date),T(!1)},[]),h=a=>{k(a);const u=Q(a);c(u),T(!0)},O=a=>{E(a),j(!0)},Q=a=>n.filter(u=>{const w=new Date(u.start_time);return m(w,"yyyy-MM-dd")===m(a,"yyyy-MM-dd")}),B=l.useMemo(()=>{const a=W(o),u=Y(o);return pe({start:a,end:u})},[o]),H=l.useMemo(()=>["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"],[]);return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(V,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"relative mb-4 sm:mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-4 sm:p-6 md:p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-4 md:gap-0",children:[e.jsxs("div",{className:"w-full md:w-auto",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Minha Agenda"}),e.jsx("p",{className:"text-sm sm:text-base text-cyan-100",children:"Gerencie aulas, reuniÃµes e eventos"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 w-full md:w-auto",children:[e.jsx(C,{onClick:y,variant:"outline",className:"bg-white/10 hover:bg-white/20 border-white/20 text-white justify-center",children:"Hoje"}),e.jsxs(C,{onClick:()=>{k(new Date),f(!0)},className:"bg-white text-blue-600 hover:bg-white/90 justify-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Novo Evento"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-6",children:[e.jsx("div",{className:P?"lg:col-span-8 transition-all duration-300":"lg:col-span-9 transition-all duration-300",children:e.jsxs(I,{className:"p-3 sm:p-4 md:p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx(C,{variant:"ghost",size:"sm",onClick:d,children:e.jsx(be,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 dark:text-white capitalize",children:m(o,"MMMM yyyy",{locale:K})}),e.jsx(C,{variant:"ghost",size:"sm",onClick:p,children:e.jsx(he,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:[H.map(a=>e.jsx("div",{className:"text-center text-[10px] sm:text-xs md:text-sm font-semibold text-slate-600 dark:text-slate-400 py-1 sm:py-2",children:a},a)),e.jsx(ge,{children:B.map((a,u)=>{const w=Q(a),U=ye(a),G=ue(a,o);return e.jsx(se,{day:a,dayEvents:w,isCurrentDay:U,isSameMonthDay:G,onClick:()=>h(a),onEventClick:O},`${m(a,"yyyy-MM-dd")}-${u}`)})})]})]})}),!P&&e.jsx("div",{className:"lg:col-span-3 space-y-4",children:e.jsx(fe,{filters:N,setFilters:L,teacherId:r?.id})}),P&&$&&e.jsx("div",{className:"lg:col-span-4",children:e.jsxs(I,{className:"p-6 bg-white dark:bg-slate-900 border-2 border-blue-200 dark:border-blue-800 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:m($,"d 'de' MMMM",{locale:K})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:m($,"EEEE",{locale:K})})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>T(!1),className:"text-slate-500 hover:text-slate-700",children:"âœ•"})]}),e.jsxs(C,{onClick:()=>f(!0),className:"w-full mb-4 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white shadow-lg",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Novo Evento"]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-24rem)] overflow-y-auto",children:t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 mx-auto text-slate-300 dark:text-slate-700 mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nenhum evento neste dia"}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:'Clique em "Novo Evento" para adicionar'})]}):t.map(a=>e.jsx(X.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onClick:()=>O(a),className:`
                        p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md group
                        ${a.type==="event"?"border-blue-300 bg-blue-50 dark:bg-blue-950/30":""}
                        ${a.type==="activity"?"border-orange-300 bg-orange-50 dark:bg-orange-950/30":""}
                        ${a.type==="meeting"?"border-purple-300 bg-purple-50 dark:bg-purple-950/30":""}
                        ${a.type==="deadline"?"border-red-300 bg-red-50 dark:bg-red-950/30":""}
                      `,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:`
                              text-xs font-semibold px-2 py-1 rounded-full
                              ${a.type==="event"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":""}
                              ${a.type==="activity"?"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300":""}
                              ${a.type==="meeting"?"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300":""}
                              ${a.type==="deadline"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":""}
                            `,children:a.type==="event"?"ðŸ“š Aula":a.type==="activity"?"ðŸ“ Atividade":a.type==="meeting"?"ðŸ‘¥ ReuniÃ£o":"ðŸ“… Prazo"})}),e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white mb-1 group-hover:text-blue-600",children:a.title}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:[m(new Date(a.start_time),"HH:mm")," - ",m(new Date(a.end_time),"HH:mm")]}),a.class?.name&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:a.class.name}),a.location&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:a.location})]})})},a.id))})]})})]}),q&&e.jsx(ve,{isOpen:q,onClose:()=>{f(!1),k(null),E(null)},onSuccess:()=>{F(),E(null)},selectedDate:$,teacherId:r?.id,editEvent:_}),i&&_&&e.jsx(de,{isOpen:i,onClose:()=>{j(!1),E(null)},event:_,onEdit:a=>{j(!1),E(a),f(!0)},onDelete:F})]})};export{at as default};
