import{b as he,u as ge,r as d,s as o,l as y,j as e,q as fe}from"./main-DuZ82yZp.js";import{C as _}from"./card-Y5GuAOBh.js";import{B as ue}from"./badge-CYDBAKPn.js";import{B as N}from"./button-Bb_PT1Zw.js";import{E as z}from"./EventCard-zx3S0H7Z.js";import{E as $}from"./EmptyState-DR14wTcJ.js";import"./dialog-COr0e4MO.js";import{m as k}from"./proxy-CHWBjvZ-.js";import{C as E}from"./calendar-D_hx0NAw.js";import{C as ve}from"./index-BxUCIcQa.js";import{C as be}from"./chevron-right-CEvqiGs0.js";import{C as P}from"./clock-BK9prlxy.js";import{F as B}from"./file-text-Ds7d3BVP.js";import{M as je}from"./map-pin-Ba8EgeF7.js";import{V as H}from"./video-Dwjb5weD.js";import{s as L,i as ye,a as _e}from"./isSameMonth-DsEUhuTc.js";import{e as R}from"./endOfMonth-rhMYNEE8.js";import{s as T,c as Ne,f as x}from"./format-BdDrz3ZT.js";import{e as F}from"./endOfDay-B-zzKHwV.js";import{e as we}from"./endOfWeek-mkYP87Lk.js";import{e as ke,s as Ee}from"./subMonths-nlIguGb7.js";import{i as Se}from"./isSameDay-COhndXI7.js";import{i as A}from"./isToday-BkEk_Hig.js";import{i as Me}from"./isPast-GalRXxSk.js";import{p as u}from"./pt-BR-C6XVmIDX.js";import"./index-D_uLVLL-.js";import"./Combination-C8JUOhgz.js";import"./SidebarPremium-DYZaD6CT.js";import"./house-CFiJxlWl.js";import"./users-BE0uReGI.js";import"./book-open-eUF-sl3F.js";import"./graduation-cap-CgmDIIy4.js";import"./chart-column-sFA7nJXK.js";import"./message-circle-EiX5rzcs.js";import"./settings-CD03lnZ4.js";import"./brain-DGA-WCwF.js";import"./index-Uqsq8EqP.js";import"./x-BmzKUBis.js";import"./en-US-ChNhCS9W.js";import"./constructNow-DqwG0NnQ.js";const ut=()=>{const{user:p}=he(),q=ge(),[Q,S]=d.useState(!0),[M,V]=d.useState(!0),[r,w]=d.useState(new Date),[h,C]=d.useState(new Date),[g,W]=d.useState([]),[D,G]=d.useState([]),[Ce,De]=d.useState("all"),[a,v]=d.useState(null);d.useEffect(()=>{p?.id&&J()},[p,r]),d.useEffect(()=>{K(h)},[h,g]);const J=async()=>{try{S(!0);const{data:t}=await o.from("class_members").select("class_id").eq("user_id",p.id).eq("role","student"),i=t?.map(s=>s.class_id)||[],l=L(r),n=R(r),{data:m}=await o.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, class_id, activity_id").in("class_id",i).gte("start_time",l.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0});y.debug("[Calendar] Buscando eventos como participante:",{userId:p.id});const{data:c,error:f}=await o.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, attendees, class_id, created_by, activity_id").contains("attendees",[p.id]).gte("start_time",l.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0});f?y.error("[Calendar] Erro ao buscar eventos como participante:",f):y.debug("[Calendar] Eventos encontrados como participante:",{count:c?.length||0,events:c});const{data:b}=await o.from("activity_class_assignments").select("activity_id, class_id").in("class_id",i),ne=b?.map(s=>s.activity_id)||[],{data:de}=await o.from("activities").select("id, title, due_date").in("id",ne).gte("due_date",l.toISOString()).lte("due_date",n.toISOString()),{data:me}=await o.from("classes").select("id, name").in("id",i),j={};me?.forEach(s=>{j[s.id]=s});const I=new Set,ce=[...(m||[]).map(s=>({...s,class_name:j[s.class_id]?.name,event_type:"class_event"})),...(c||[]).map(s=>({...s,class_name:j[s.class_id]?.name,event_type:"meeting"}))].filter(s=>I.has(s.id)?!1:(I.add(s.id),!0)),oe=(de||[]).map(s=>{const xe=b.find(pe=>pe.activity_id===s.id);return{id:`activity-${s.id}`,title:s.title,start_time:s.due_date,end_time:s.due_date,type:"deadline",class_name:j[xe?.class_id]?.name,event_type:"activity_deadline",activity_id:s.id}});W([...ce,...oe])}catch(t){y.error("Erro ao carregar eventos:",t)}finally{S(!1),M&&V(!1)}},K=t=>{const i=T(t),l=F(t),n=g.filter(m=>{const c=new Date(m.start_time);return c>=i&&c<=l});G(n)},U=t=>{const i=T(t),l=F(t);return g.filter(n=>{const m=new Date(n.start_time);return m>=i&&m<=l})},O=t=>{v(t)},X=()=>{w(Ee(r))},Y=()=>{w(_e(r,1))},Z=()=>{const t=new Date;w(t),C(t)},ee=L(r),te=R(r),se=Ne(ee,{weekStartsOn:0}),ae=we(te,{weekStartsOn:0}),ie=ke({start:se,end:ae}),re=["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"],le=t=>t?t.activity_id||t.type==="activity"?"Atividade":t.event_type==="activity_deadline"||t.type==="deadline"?"Prazo de atividade":t.event_type==="meeting"||t.type==="meeting"?"Reuni√£o":t.event_type==="class_event"?"Evento da turma":"Evento":"Evento";return Q&&M?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(fe,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-3 sm:p-4 md:p-6",children:[e.jsxs(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 md:mb-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-2 sm:gap-3",children:[e.jsx(E,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-600"}),"Minha Agenda"]}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-400",children:"Eventos, reuni√µes e prazos de atividades"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-0 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-between sm:justify-start",children:[e.jsx(N,{onClick:X,variant:"outline",size:"sm",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 dark:text-white text-center capitalize",children:x(r,"MMMM yyyy",{locale:u})}),e.jsx(N,{onClick:Y,variant:"outline",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsx(N,{onClick:Z,variant:"default",size:"sm",className:"w-full sm:w-auto",children:"Hoje"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs(_,{className:"p-3 sm:p-4 md:p-6 lg:col-span-2",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-2 sm:mb-4",children:re.map(t=>e.jsx("div",{className:"text-center font-bold text-slate-600 dark:text-slate-400 text-[10px] sm:text-xs md:text-sm py-1 sm:py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:ie.map(t=>{const i=U(t),l=ye(t,r),n=Se(t,h),m=A(t),c=Me(t)&&!m;return e.jsxs(k.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>C(t),className:`
                    w-full h-14 sm:h-20 md:h-24 p-2 sm:p-3 rounded-lg border sm:border-2 transition-all flex flex-col items-center justify-center
                    ${l?"bg-white dark:bg-slate-800":"bg-slate-100 dark:bg-slate-900"}
                    ${n?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-transparent"}
                    ${m?"ring-1 sm:ring-2 ring-blue-500":""}
                    ${c?"opacity-50":""}
                    hover:border-blue-300 dark:hover:border-blue-700
                  `,children:[e.jsx("div",{className:`
                    text-xs sm:text-sm font-semibold mb-0.5 sm:mb-1
                    ${n?"text-blue-600":"text-slate-900 dark:text-white"}
                    ${l?"":"text-slate-400"}
                  `,children:x(t,"d")}),i.length>0&&e.jsxs("div",{className:"hidden sm:flex flex-wrap gap-0.5 justify-center",children:[i.slice(0,3).map((f,b)=>e.jsx("div",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${f.type==="deadline"?"bg-red-500":f.type==="meeting"?"bg-purple-500":"bg-blue-500"}`},b)),i.length>3&&e.jsxs("div",{className:"text-[10px] text-slate-500",children:["+",i.length-3]})]})]},t.toString())})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-6 mt-4 sm:mt-6 pt-4 sm:pt-6 border-t",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Eventos"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-purple-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Reuni√µes"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Prazos"})]})]})]}),e.jsxs(_,{className:"p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600"}),A(h)?"Hoje":x(h,"dd 'de' MMMM",{locale:u})]}),D.length>0?e.jsx("div",{className:"space-y-3",children:D.map((t,i)=>e.jsx(z,{event:t,onClick:()=>O(t),index:i},t.id))}):e.jsx($,{icon:E,title:"Nenhum evento",description:"Nenhum evento agendado para este dia.",variant:"info"})]})]}),e.jsxs(_,{className:"p-4 sm:p-6 mt-4 sm:mt-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 dark:text-white mb-4 sm:mb-6 capitalize",children:["üìÖ Eventos de ",x(r,"MMMM",{locale:u})]}),g.length>0?e.jsx("div",{className:"space-y-4",children:g.sort((t,i)=>new Date(t.start_time)-new Date(i.start_time)).map((t,i)=>e.jsx(z,{event:t,onClick:()=>O(t),index:i},t.id))}):e.jsx($,{icon:E,title:"Nenhum evento este m√™s",description:"N√£o h√° eventos, reuni√µes ou prazos agendados para este m√™s."})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>v(null),children:e.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:t=>t.stopPropagation(),children:e.jsx(_,{className:"p-6 sm:p-8 max-w-xl sm:max-w-2xl w-full bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 shadow-2xl",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{children:le(a)}),e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white",children:a.title}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400",children:x(new Date(a.start_time),"EEEE, d 'de' MMMM '√†s' HH:mm",{locale:u})})]}),e.jsx("button",{onClick:()=>v(null),className:"text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:"Fechar"})]}),a.description&&e.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-300",children:a.description}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 text-sm sm:text-base",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(P,{className:"w-4 h-4"}),x(new Date(a.start_time),"d 'de' MMMM '√†s' HH:mm",{locale:u})]}),a.class_name&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(B,{className:"w-4 h-4"}),a.class_name]}),a.location&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(je,{className:"w-4 h-4"}),a.location]})]}),e.jsx("div",{className:"space-y-2",children:a.meeting_link&&e.jsxs("a",{href:a.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white text-sm sm:text-base",children:[e.jsx(H,{className:"w-4 h-4"}),"Entrar na reuni√£o"]})})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-800 flex flex-wrap gap-3 justify-end",children:[a.activity_id&&e.jsxs(N,{onClick:()=>{v(null),q(`/students/activities/${a.activity_id}`)},className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Ir para atividade"]}),a.meeting_link&&!a.activity_id&&e.jsxs("a",{href:a.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-200 text-sm sm:text-base hover:bg-slate-50 dark:hover:bg-slate-800",children:[e.jsx(H,{className:"w-4 h-4"}),"Abrir reuni√£o"]})]})]})})})})]})};export{ut as default};
