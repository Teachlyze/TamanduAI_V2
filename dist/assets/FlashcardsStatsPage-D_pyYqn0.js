import{b as z,u as Y,r as i,l as G,j as e,q as J}from"./main-BtydHokz.js";import{B as N}from"./button-pkZcz0fw.js";import{C as o}from"./card-BLN8IVBT.js";import{u as V}from"./use-toast-BD7ojcJx.js";import{D as X}from"./DashboardHeader-Do_OLCE8.js";import"./input-DevW5dIO.js";import"./dropdown-menu-DQk5WS44.js";import"./label-Do1Gcpls.js";import{f as p,c as Q,p as U}from"./flashcardService-CK0ttocm.js";import{A as Z}from"./arrow-left-A7LEbFFM.js";import{Y as u,_ as w,$ as y,a0 as S,a1 as h}from"./CartesianChart-B4b88xjZ.js";import{L as ee,a as _}from"./LineChart-Zy-lH0MG.js";import{L as C}from"./Legend-DgRrTzF2.js";import{P as te,a as se}from"./PieChart-ChZ3ZSv7.js";import{C as ae,B as re,a as D}from"./BarChart-D0_ywCL3.js";import"./proxy-BKNTM3tf.js";import"./index-BRR_QA-l.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./users-CntpuLnR.js";import"./book-open-BQJiPDff.js";import"./file-text-GwBv-P3B.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./chevron-right-Bh44L5jc.js";import"./x-BtLVjj0F.js";import"./index-DsrKRt14.js";import"./check-B1zY7uXK.js";import"./index-B1zfdoK7.js";import"./PolarChart-CUzkXeS7.js";const l={primary:"#8B5CF6",success:"#10B981",warning:"#F59E0B",info:"#3B82F6"},ze=()=>{const{user:d}=z(),{toast:E}=V(),L=Y(),[R,f]=i.useState(!0),[n,B]=i.useState("week"),[a,T]=i.useState(null),[oe,M]=i.useState([]),[m,P]=i.useState([]),[g,A]=i.useState([]);i.useEffect(()=>{d?.id&&K()},[d,n]);const K=async()=>{try{f(!0);const t=$(n),{data:s,error:r}=await p.getReviewHistory(d.id,{from_date:t,limit:1e3});if(r)throw r;M(s||[]);const x=Q(s||[],n);T(x);const{data:j}=await p.getDecks(d.id);P(j||[]);const b=[];for(const q of j||[]){const{data:v}=await p.getCardsInDeck(q.id);v&&v.forEach(k=>{k.card_stats?.[0]&&b.push(k.card_stats[0])})}const H=U(b,7);A(H)}catch(t){G.error("Error loading statistics:",t),E({title:"Erro ao carregar",description:"Não foi possível carregar as estatísticas.",variant:"destructive"})}finally{f(!1)}},$=t=>{const s=new Date;switch(t){case"today":return s.setHours(0,0,0,0),s.toISOString();case"week":return s.setDate(s.getDate()-7),s.toISOString();case"month":return s.setDate(s.getDate()-30),s.toISOString();default:return new Date(0).toISOString()}},O=()=>{const t={new:0,learning:0,young:0,mature:0};return m.forEach(s=>{const r=s.deck_stats?.[0];r&&(t.new+=r.new_cards||0,t.learning+=r.learning_cards||0,t.young+=r.young_cards||0,t.mature+=r.mature_cards||0)}),[{name:"Novos",value:t.new,color:l.info},{name:"Aprendendo",value:t.learning,color:l.warning},{name:"Jovens",value:t.young,color:l.success},{name:"Maduros",value:t.mature,color:l.primary}].filter(s=>s.value>0)},F=t=>{const s=Math.floor(t/6e4);if(s<60)return`${s}min`;const r=Math.floor(s/60),x=s%60;return`${r}h ${x}min`};if(R&&!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(J,{size:"lg",text:"Carregando estatísticas..."})});const c=O(),I=c.reduce((t,s)=>t+s.value,0),W=g?.some(t=>(t.new_cards||0)>0||(t.review_cards||0)>0);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-4 sm:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(N,{variant:"ghost",onClick:()=>L("/students/flashcards"),className:"mb-4 hover:bg-slate-200 dark:hover:bg-slate-800",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(X,{title:"Estatísticas de Estudo",subtitle:"Análise detalhada do seu progresso com flashcards"})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:[{value:"today",label:"Hoje"},{value:"week",label:"Semana"},{value:"month",label:"Mês"},{value:"all",label:"Tudo"}].map(t=>e.jsx(N,{variant:n===t.value?"default":"outline",size:"sm",onClick:()=>B(t.value),children:t.label},t.value))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400 mb-2",children:"Total de Revisões"}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:a?.total_reviews||0})]})}),e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400 mb-2",children:"Taxa de Retenção"}),e.jsxs("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:[a?.retention_rate||0,"%"]})]})}),e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400 mb-2",children:"Tempo de Estudo"}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:F(a?.total_time_ms||0)})]})}),e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400 mb-2",children:"Tempo Médio/Card"}),e.jsxs("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:[Math.round((a?.average_time_ms||0)/1e3),"s"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(o,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4",children:"Revisões ao Longo do Tempo"}),e.jsx(u,{width:"100%",height:300,children:e.jsxs(ee,{data:a?.chart_data||[],children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"date"}),e.jsx(S,{}),e.jsx(h,{}),e.jsx(C,{}),e.jsx(_,{type:"monotone",dataKey:"reviews",stroke:l.primary,strokeWidth:2,name:"Revisões"}),e.jsx(_,{type:"monotone",dataKey:"correct",stroke:l.success,strokeWidth:2,name:"Corretas"})]})})]}),e.jsxs(o,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4",children:"Distribuição de Cards"}),e.jsx(u,{width:"100%",height:300,children:e.jsxs(te,{children:[e.jsx(se,{data:c,cx:"50%",cy:"50%",labelLine:!1,label:t=>`${t.name}: ${t.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:c.map((t,s)=>e.jsx(ae,{fill:t.color},`cell-${s}`))}),e.jsx(h,{})]})}),e.jsx("div",{className:"flex justify-center gap-4 mt-4",children:c.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.name," (",t.value,")"]})]},s))})]})]}),e.jsxs(o,{className:"p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4",children:"Previsão de Carga (Próximos 7 Dias)"}),W?e.jsx(u,{width:"100%",height:300,children:e.jsxs(re,{data:g,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"date"}),e.jsx(S,{}),e.jsx(h,{}),e.jsx(C,{}),e.jsx(D,{dataKey:"new_cards",fill:l.info,name:"Novos"}),e.jsx(D,{dataKey:"review_cards",fill:l.success,name:"Revisões"})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-sm text-slate-500 dark:text-slate-400",children:"Nenhuma revisão prevista nos próximos 7 dias. Estude alguns cards para ver a previsão aqui."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(o,{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20 border-green-200 dark:border-green-800",children:[e.jsx("h4",{className:"font-bold text-green-900 dark:text-green-100 mb-2",children:"Melhor Dia"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300 mb-1",children:a?.chart_data?.reduce((t,s)=>s.reviews>(t?.reviews||0)?s:t,{})?.date||"-"}),e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:[a?.chart_data?.reduce((t,s)=>s.reviews>(t?.reviews||0)?s:t,{})?.reviews||0," revisões"]})]}),e.jsxs(o,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-bold text-blue-900 dark:text-blue-100 mb-2",children:"Desempenho Médio"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300 mb-1",children:[a?.retention_rate||0,"%"]}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:a?.retention_rate>=80?"Excelente!":a?.retention_rate>=60?"Bom!":"Continue praticando"})]}),e.jsxs(o,{className:"p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-950/20 dark:to-pink-950/20 border-purple-200 dark:border-purple-800",children:[e.jsx("h4",{className:"font-bold text-purple-900 dark:text-purple-100 mb-2",children:"Total de Cards"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300 mb-1",children:I}),e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:["Distribuídos em ",m.length," deck",m.length!==1?"s":""]})]})]})]})})};export{ze as default};
