import{h as z,u as F,r as i,l as r,s as f,j as t,q as V}from"./main-BtydHokz.js";import{B as $}from"./button-pkZcz0fw.js";import{u as G}from"./use-toast-BD7ojcJx.js";import{D as Q,g as b}from"./DashboardHeader-Do_OLCE8.js";import{S as v}from"./StatsCard-CQPBdi-L.js";import{E as R}from"./EmptyState-B9PjJzZx.js";import"./card-BLN8IVBT.js";import{S as H}from"./SearchInput-CmmTqmy8.js";import"./dropdown-menu-DQk5WS44.js";import{S as O}from"./SubmissionCard-DNu1povx.js";import"./input-DevW5dIO.js";import"./label-Do1Gcpls.js";import{B as W}from"./Breadcrumb-BaVmLvd0.js";import{A as J}from"./arrow-left-A7LEbFFM.js";import{F as K}from"./file-text-GwBv-P3B.js";import{C as M}from"./circle-check-D34UQm6h.js";import{C as U}from"./clock-cyyJEg8O.js";import{m as X}from"./proxy-BKNTM3tf.js";import{C as Y}from"./circle-alert-COBXyI8K.js";import"./chevron-right-Bh44L5jc.js";import"./search-B-7BMQB5.js";import"./x-BtLVjj0F.js";import"./index-BRR_QA-l.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./users-CntpuLnR.js";import"./book-open-BQJiPDff.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./index-DsrKRt14.js";import"./check-B1zY7uXK.js";import"./badge-DpVvk9bK.js";const $e=()=>{const{activityId:o}=z(),m=F(),{toast:w}=G(),[_,h]=i.useState(!0),[l,E]=i.useState(null),[c,A]=i.useState([]),[S,y]=i.useState([]),[d,D]=i.useState(""),[u,N]=i.useState({total:0,graded:0,pending:0});i.useEffect(()=>{k()},[o]),i.useEffect(()=>{L()},[c,d]);const k=async()=>{try{if(h(!0),r.debug("üîç ActivitySubmissionsPage - activityId:",o),!o)throw r.error("‚ùå activityId √© undefined!"),new Error("ID da atividade n√£o fornecido");const{data:e,error:s}=await f.from("activities").select("*").eq("id",o).single();if(s)throw r.error("Erro ao carregar atividade:",s),s;E(e),r.debug("Atividade carregada:",e?.title),r.debug("Carregando submiss√µes para activity_id:",o);const{data:a,error:g}=await f.from("submissions").select("*").eq("activity_id",o).order("submitted_at",{ascending:!1});if(g)throw r.error("Erro ao carregar submiss√µes:",g),g;r.debug("Submiss√µes carregadas:",a?.length||0);let x=a||[];if(a&&a.length>0){const n=a.map(p=>p.student_id).filter(Boolean);if(n.length>0){const{data:p,error:C}=await f.from("profiles").select("id, full_name, email, avatar_url").in("id",n);C?r.error("Erro ao carregar perfis:",C):x=a.map(j=>({...j,profiles:p.find(q=>q.id===j.student_id)}))}}A(x);const I=a?.filter(n=>n.status==="graded").length||0,T=a?.filter(n=>n.status==="pending").length||0;N({total:a?.length||0,graded:I,pending:T})}catch(e){r.error("Erro ao carregar submiss√µes:",e),w({title:"Erro ao carregar submiss√µes",description:e?.message||"Tente novamente.",variant:"destructive"})}finally{r.debug("ActivitySubmissionsPage: setLoading(false)"),h(!1)}},L=()=>{if(!d){y(c);return}const e=d.toLowerCase(),s=c.filter(a=>a.profiles?.full_name?.toLowerCase().includes(e)||a.profiles?.email?.toLowerCase().includes(e));y(s)},B=e=>{m(`/dashboard/grading/${e.id}`)},P=e=>{m(`/dashboard/grading/${e.id}`)};return _?t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx(V,{size:"lg",text:"Carregando submiss√µes..."})}):t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[t.jsxs($,{variant:"outline",onClick:()=>m(-1),className:"mb-4",children:[t.jsx(J,{className:"w-4 h-4 mr-2"}),"Voltar"]}),t.jsx(W,{items:[{label:"Atividades",path:"/dashboard/activities"},{label:l?.title||"Atividade"}],className:"mb-4"}),t.jsx(Q,{title:l?.title||"Atividade",subtitle:`Submiss√µes dos alunos ‚Ä¢ Prazo: ${l?.due_date?new Date(l.due_date).toLocaleDateString("pt-BR"):"Sem prazo"}`,role:"teacher"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[t.jsx(v,{title:"Total de Submiss√µes",value:u.total,icon:K,gradient:b.stats.activities,bgColor:"bg-blue-50 dark:bg-blue-950/30",delay:0}),t.jsx(v,{title:"Corrigidas",value:u.graded,icon:M,gradient:b.success,bgColor:"bg-green-50 dark:bg-green-950/30",delay:.1}),t.jsx(v,{title:"Pendentes",value:u.pending,icon:U,gradient:b.warning,bgColor:"bg-amber-50 dark:bg-amber-950/30",delay:.2})]}),t.jsx("div",{className:"mb-8",children:t.jsx(H,{placeholder:"Buscar por nome ou email do aluno...",value:d,onChange:D})}),S.length>0?t.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map((e,s)=>t.jsx(O,{submission:{id:e.id,student:{name:e.profiles?.full_name||"Aluno",avatar:e.profiles?.avatar_url},activity:{title:l?.title},submittedAt:e.submitted_at,status:e.status||"pending",grade:e.grade,feedback:e.feedback,isLate:e.due_date&&new Date(e.submitted_at)>new Date(e.due_date)},onView:B,onGrade:P,delay:s*.05},e.id))}):t.jsx(R,{icon:Y,title:d?"Nenhuma submiss√£o encontrada":"Nenhuma submiss√£o ainda",description:d?"Tente buscar por outro termo.":"Os alunos ainda n√£o enviaram suas respostas para esta atividade."})]})};export{$e as default};
