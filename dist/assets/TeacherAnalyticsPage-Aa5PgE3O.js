import{c as kt,r as l,e as _t,b as wt,u as At,s as T,l as G,j as e,q as Ct}from"./main-CI5_MmIm.js";import{C as J}from"./card-DpcnMbcE.js";import{B as ce}from"./button-D7H9d9Gd.js";import{B as Oe}from"./badge-BOI6M_d9.js";import{D as St,a as Et,b as Dt,e as Me}from"./dropdown-menu-dTrFNQHD.js";import{S as Le,a as ze,b as Re,c as Ge,d as Z}from"./select-DSQCR6Pt.js";import{C as Be}from"./checkbox-BZl8Vl57.js";import"./tabs-ZdS4mBpd.js";import{P as Pt}from"./progress-PFHL2xMu.js";import{D as It,g as Q}from"./DashboardHeader-CYuk3ql1.js";import{S as ie}from"./StatsCard-C6i8pjlS.js";import"./input-BJMmyirp.js";import"./label-Nf4YzbUq.js";import{u as Tt}from"./use-toast-D7N2H9RC.js";import{a as Ft}from"./exportService-DENT3wj8.js";import{B as Ot}from"./bell-BWLfMLva.js";import{D as Mt}from"./download-Crb5Tmz4.js";import{C as Lt}from"./calendar-Dbm_7POQ.js";import{U as _e}from"./users-ChR7WEeh.js";import{F as $e}from"./funnel-XFXxK7Il.js";import{C as zt}from"./clipboard-list-BzDJZ0ih.js";import{C as Rt}from"./clock-3X7dheFj.js";import{C as Gt}from"./circle-alert-X86u08ZX.js";import{T as Bt}from"./trending-up-1zEvTPQM.js";import{C as $t}from"./circle-check-big-KDmohnfK.js";import{c as Ce,s as Se,a as Je,b as Qe,d as Kt,e as Wt,f as Ke,g as Vt,i as et,h as We,j as qt,r as tt,D as Ut,u as at,R as Xt,S as Yt,k as Zt,l as Ht,m as Jt,G as Qt,n as st,o as ea,p as ta,q as aa,t as sa,v as ia,w as ra,x as na,Z as la,L as fe,y as oa,A as Ve,z as qe,B as Ue,C as oe,E as ca,J as da,F as re,H as ma,I as ua,K as pa,M as ha,N as it,O as xa,P as we,Q as ga,T as be,U as va,V as fa,W as me,X as ue,Y as pe,_ as he,$ as xe}from"./CartesianChart-DKXpiVYO.js";import{C as Xe}from"./chart-column-G5dLAdkQ.js";import{B as Ae,a as ge,C as Ye}from"./BarChart-BUl8ULUy.js";import{L as ba}from"./Legend-pt7fNQR1.js";import{C as ya}from"./chart-pie-XqrP7yGY.js";import{S as ja}from"./shield-Cghu_EeU.js";import{A as Na}from"./award-CvYEvQ9U.js";import{T as ka}from"./trending-down-D9iNAUDh.js";import{Z as _a}from"./zap-Bln0MeGH.js";import{f as ve}from"./format-BdDrz3ZT.js";import{s as ne}from"./subDays-C76KfxB7.js";import"./index-D4BuPd_i.js";import"./index-CRRraFTu.js";import"./index-CtvfaZbL.js";import"./index-DHrdJ99Z.js";import"./Combination-BfETjw1A.js";import"./SidebarPremium-0_wHXPj0.js";import"./house-B6Hparzo.js";import"./book-open-DlGI5eOy.js";import"./file-text-CtozP3gh.js";import"./graduation-cap-mPfDCRgT.js";import"./message-circle-CRpVuYq9.js";import"./settings-BWUwUKXK.js";import"./brain-DVBX4Id_.js";import"./index-RHGs5twt.js";import"./proxy-CT7Xtxle.js";import"./chevron-right-CHSrP1xQ.js";import"./x-DGmYUGM5.js";import"./index-jkBwDHc_.js";import"./check-GhIpAKm1.js";import"./index-DrPD6SFW.js";import"./chevron-down-DXVEpPD6.js";import"./chevron-up-CrZ13wWo.js";import"./jspdf.plugin.autotable-3LNuint4.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./index-BhuNWwGV.js";import"./en-US-ChNhCS9W.js";import"./addDays-jaRQZo3H.js";const wa=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Aa=kt("chart-line",wa);var rt=(s,a,i,r)=>Je(s,"xAxis",a,r),nt=(s,a,i,r)=>Qe(s,"xAxis",a,r),lt=(s,a,i,r)=>Je(s,"yAxis",i,r),ot=(s,a,i,r)=>Qe(s,"yAxis",i,r),Ca=Ce([Se,rt,lt,nt,ot],(s,a,i,r,u)=>et(s,"xAxis")?We(a,r,!1):We(i,u,!1)),Sa=(s,a,i,r,u)=>u,ct=Ce([qt,Sa],(s,a)=>s.filter(i=>i.type==="area").find(i=>i.id===a)),Ea=(s,a,i,r,u)=>{var o,c=ct(s,a,i,r,u);if(c!=null){var m=Se(s),n=et(m,"xAxis"),v;if(n?v=Ke(s,"yAxis",i,r):v=Ke(s,"xAxis",a,r),v!=null){var{stackId:P}=c,I=Vt(c);if(!(P==null||I==null)){var C=(o=v[P])===null||o===void 0?void 0:o.stackedData;return C?.find(A=>A.key===I)}}}},Da=Ce([Se,rt,lt,nt,ot,Ea,Kt,Ca,ct,Wt],(s,a,i,r,u,o,c,m,n,v)=>{var{chartData:P,dataStartIndex:I,dataEndIndex:C}=c;if(!(n==null||s!=="horizontal"&&s!=="vertical"||a==null||i==null||r==null||u==null||r.length===0||u.length===0||m==null)){var{data:A}=n,S;if(A&&A.length>0?S=A:S=P?.slice(I,C+1),S!=null)return Ya({layout:s,xAxis:a,yAxis:i,xAxisTicks:r,yAxisTicks:u,dataStartIndex:I,areaSettings:n,stackedData:o,displayedData:S,chartBaseValue:v,bandSize:m})}}),Pa=["id"],Ia=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function ee(){return ee=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)({}).hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},ee.apply(null,arguments)}function dt(s,a){if(s==null)return{};var i,r,u=Ta(s,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);for(r=0;r<o.length;r++)i=o[r],a.indexOf(i)===-1&&{}.propertyIsEnumerable.call(s,i)&&(u[i]=s[i])}return u}function Ta(s,a){if(s==null)return{};var i={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(a.indexOf(r)!==-1)continue;i[r]=s[r]}return i}function Ze(s,a){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);a&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(s,u).enumerable})),i.push.apply(i,r)}return i}function le(s){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?Ze(Object(i),!0).forEach(function(r){Fa(s,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):Ze(Object(i)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(i,r))})}return s}function Fa(s,a,i){return(a=Oa(a))in s?Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[a]=i,s}function Oa(s){var a=Ma(s,"string");return typeof a=="symbol"?a:a+""}function Ma(s,a){if(typeof s!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var r=i.call(s,a);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function ye(s,a){return s&&s!=="none"?s:a}var La=s=>{var{dataKey:a,name:i,stroke:r,fill:u,legendType:o,hide:c}=s;return[{inactive:c,dataKey:a,type:o,color:ye(r,u),value:st(i,a),payload:s}]};function za(s){var{dataKey:a,data:i,stroke:r,strokeWidth:u,fill:o,name:c,hide:m,unit:n}=s;return{dataDefinedOnItem:i,positions:void 0,settings:{stroke:r,strokeWidth:u,fill:o,dataKey:a,nameKey:void 0,name:st(c,a),hide:m,type:s.tooltipType,color:ye(r,o),unit:n}}}function Ra(s){var{clipPathId:a,points:i,props:r}=s,{needClip:u,dot:o,dataKey:c}=r,m=it(r);return l.createElement(ga,{points:i,dot:o,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:c,baseProps:m,needClip:u,clipPathId:a})}function Ga(s){var{showLabels:a,children:i,points:r}=s,u=r.map(o=>{var c,m,n={x:(c=o.x)!==null&&c!==void 0?c:0,y:(m=o.y)!==null&&m!==void 0?m:0,width:0,lowerWidth:0,upperWidth:0,height:0};return le(le({},n),{},{value:o.value,payload:o.payload,parentViewBox:void 0,viewBox:n,fill:void 0})});return l.createElement(ha,{value:a?u:void 0},i)}function He(s){var{points:a,baseLine:i,needClip:r,clipPathId:u,props:o}=s,{layout:c,type:m,stroke:n,connectNulls:v,isRange:P}=o,{id:I}=o,C=dt(o,Pa),A=it(C),S=xa(C);return l.createElement(l.Fragment,null,a?.length>1&&l.createElement(fe,{clipPath:r?"url(#clipPath-".concat(u,")"):void 0},l.createElement(we,ee({},S,{id:I,points:a,connectNulls:v,type:m,baseLine:i,layout:c,stroke:"none",className:"recharts-area-area"})),n!=="none"&&l.createElement(we,ee({},A,{className:"recharts-area-curve",layout:c,type:m,connectNulls:v,fill:"none",points:a})),n!=="none"&&P&&l.createElement(we,ee({},A,{className:"recharts-area-curve",layout:c,type:m,connectNulls:v,fill:"none",points:i}))),l.createElement(Ra,{points:a,props:C,clipPathId:u}))}function Ba(s){var{alpha:a,baseLine:i,points:r,strokeWidth:u}=s,o=r[0].y,c=r[r.length-1].y;if(!be(o)||!be(c))return null;var m=a*Math.abs(o-c),n=Math.max(...r.map(v=>v.x||0));return oe(i)?n=Math.max(i,n):i&&Array.isArray(i)&&i.length&&(n=Math.max(...i.map(v=>v.x||0),n)),oe(n)?l.createElement("rect",{x:0,y:o<c?o:o-m,width:n+(u?parseInt("".concat(u),10):1),height:Math.floor(m)}):null}function $a(s){var{alpha:a,baseLine:i,points:r,strokeWidth:u}=s,o=r[0].x,c=r[r.length-1].x;if(!be(o)||!be(c))return null;var m=a*Math.abs(o-c),n=Math.max(...r.map(v=>v.y||0));return oe(i)?n=Math.max(i,n):i&&Array.isArray(i)&&i.length&&(n=Math.max(...i.map(v=>v.y||0),n)),oe(n)?l.createElement("rect",{x:o<c?o:o-m,y:0,width:m,height:Math.floor(n+(u?parseInt("".concat(u),10):1))}):null}function Ka(s){var{alpha:a,layout:i,points:r,baseLine:u,strokeWidth:o}=s;return i==="vertical"?l.createElement(Ba,{alpha:a,points:r,baseLine:u,strokeWidth:o}):l.createElement($a,{alpha:a,points:r,baseLine:u,strokeWidth:o})}function Wa(s){var{needClip:a,clipPathId:i,props:r,previousPointsRef:u,previousBaselineRef:o}=s,{points:c,baseLine:m,isAnimationActive:n,animationBegin:v,animationDuration:P,animationEasing:I,onAnimationStart:C,onAnimationEnd:A}=r,S=ca(r,"recharts-area-"),[M,F]=l.useState(!1),V=!M,w=l.useCallback(()=>{typeof A=="function"&&A(),F(!1)},[A]),L=l.useCallback(()=>{typeof C=="function"&&C(),F(!0)},[C]),h=u.current,E=o.current;return l.createElement(Ga,{showLabels:V,points:c},r.children,l.createElement(da,{animationId:S,begin:v,duration:P,isActive:n,easing:I,onAnimationEnd:w,onAnimationStart:L,key:S},y=>{if(h){var B=h.length/c.length,$=y===1?c:c.map((O,X)=>{var K=Math.floor(X*B);if(h[K]){var W=h[K];return le(le({},O),{},{x:re(W.x,O.x,y),y:re(W.y,O.y,y)})}return O}),R;return oe(m)?R=re(E,m,y):ma(m)||ua(m)?R=re(E,0,y):R=m.map((O,X)=>{var K=Math.floor(X*B);if(Array.isArray(E)&&E[K]){var W=E[K];return le(le({},O),{},{x:re(W.x,O.x,y),y:re(W.y,O.y,y)})}return O}),y>0&&(u.current=$,o.current=R),l.createElement(He,{points:$,baseLine:R,needClip:a,clipPathId:i,props:r})}return y>0&&(u.current=c,o.current=m),l.createElement(fe,null,n&&l.createElement("defs",null,l.createElement("clipPath",{id:"animationClipPath-".concat(i)},l.createElement(Ka,{alpha:y,points:c,baseLine:m,layout:r.layout,strokeWidth:r.strokeWidth}))),l.createElement(fe,{clipPath:"url(#animationClipPath-".concat(i,")")},l.createElement(He,{points:c,baseLine:m,needClip:a,clipPathId:i,props:r})))}),l.createElement(pa,{label:r.label}))}function Va(s){var{needClip:a,clipPathId:i,props:r}=s,u=l.useRef(null),o=l.useRef();return l.createElement(Wa,{needClip:a,clipPathId:i,props:r,previousPointsRef:u,previousBaselineRef:o})}class qa extends l.PureComponent{render(){var{hide:a,dot:i,points:r,className:u,top:o,left:c,needClip:m,xAxisId:n,yAxisId:v,width:P,height:I,id:C,baseLine:A,zIndex:S}=this.props;if(a)return null;var M=_t("recharts-area",u),F=C,{r:V,strokeWidth:w}=ra(i),L=na(i),h=V*2+w;return l.createElement(la,{zIndex:S},l.createElement(fe,{className:M},m&&l.createElement("defs",null,l.createElement(oa,{clipPathId:F,xAxisId:n,yAxisId:v}),!L&&l.createElement("clipPath",{id:"clipPath-dots-".concat(F)},l.createElement("rect",{x:c-h/2,y:o-h/2,width:P+h,height:I+h}))),l.createElement(Va,{needClip:m,clipPathId:F,props:this.props})),l.createElement(Ve,{points:r,mainColor:ye(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}),this.props.isRange&&Array.isArray(A)&&l.createElement(Ve,{points:A,mainColor:ye(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}))}}var mt={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:!Qt.isSsr,legendType:"line",stroke:"#3182bd",xAxisId:0,yAxisId:0,zIndex:Ut.area};function Ua(s){var a,i=tt(s,mt),{activeDot:r,animationBegin:u,animationDuration:o,animationEasing:c,connectNulls:m,dot:n,fill:v,fillOpacity:P,hide:I,isAnimationActive:C,legendType:A,stroke:S,xAxisId:M,yAxisId:F}=i,V=dt(i,Ia),w=ea(),L=ta(),{needClip:h}=aa(M,F),E=at(),{points:y,isRange:B,baseLine:$}=(a=sa(te=>Da(te,M,F,E,s.id)))!==null&&a!==void 0?a:{},R=ia();if(w!=="horizontal"&&w!=="vertical"||R==null||L!=="AreaChart"&&L!=="ComposedChart")return null;var{height:O,width:X,x:K,y:W}=R;return!y||!y.length?null:l.createElement(qa,ee({},V,{activeDot:r,animationBegin:u,animationDuration:o,animationEasing:c,baseLine:$,connectNulls:m,dot:n,fill:v,fillOpacity:P,height:O,hide:I,layout:w,isAnimationActive:C,isRange:B,legendType:A,needClip:h,points:y,stroke:S,width:X,left:K,top:W,xAxisId:M,yAxisId:F}))}var Xa=(s,a,i,r,u)=>{var o=i??a;if(oe(o))return o;var c=s==="horizontal"?u:r,m=c.scale.domain();if(c.type==="number"){var n=Math.max(m[0],m[1]),v=Math.min(m[0],m[1]);return o==="dataMin"?v:o==="dataMax"||n<0?n:Math.max(Math.min(m[0],m[1]),0)}return o==="dataMin"?m[0]:o==="dataMax"?m[1]:m[0]};function Ya(s){var{areaSettings:{connectNulls:a,baseValue:i,dataKey:r},stackedData:u,layout:o,chartBaseValue:c,xAxis:m,yAxis:n,displayedData:v,dataStartIndex:P,xAxisTicks:I,yAxisTicks:C,bandSize:A}=s,S=u&&u.length,M=Xa(o,c,i,m,n),F=o==="horizontal",V=!1,w=v.map((h,E)=>{var y;S?y=u[P+E]:(y=qe(h,r),Array.isArray(y)?V=!0:y=[M,y]);var B=y[1]==null||S&&!a&&qe(h,r)==null;return F?{x:Ue({axis:m,ticks:I,bandSize:A,entry:h,index:E}),y:B?null:n.scale(y[1]),value:y,payload:h}:{x:B?null:m.scale(y[1]),y:Ue({axis:n,ticks:C,bandSize:A,entry:h,index:E}),value:y,payload:h}}),L;return S||V?L=w.map(h=>{var E=Array.isArray(h.value)?h.value[0]:null;return F?{x:h.x,y:E!=null&&h.y!=null?n.scale(E):null,payload:h.payload}:{x:E!=null?m.scale(E):null,y:h.y,payload:h.payload}}):L=F?n.scale(M):m.scale(M),{points:w,baseLine:L,isRange:V}}function Za(s){var a=tt(s,mt),i=at();return l.createElement(Xt,{id:a.id,type:"area"},r=>l.createElement(l.Fragment,null,l.createElement(Yt,{legendPayload:La(a)}),l.createElement(Zt,{fn:za,args:a}),l.createElement(Ht,{type:"area",id:r,data:a.data,dataKey:a.dataKey,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,stackId:Jt(a.stackId),hide:a.hide,barSize:void 0,baseValue:a.baseValue,isPanorama:i,connectNulls:a.connectNulls}),l.createElement(Ua,ee({},a,{id:r}))))}var ut=l.memo(Za);ut.displayName="Area";var Ha=["axis"],Ja=l.forwardRef((s,a)=>l.createElement(va,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Ha,tooltipPayloadSearcher:fa,categoricalChartProps:s,ref:a}));const ci=()=>{const{user:s}=wt(),{toast:a}=Tt();At();const[i,r]=l.useState(!0),[u,o]=l.useState(!0),[c,m]=l.useState("30"),[n,v]=l.useState([]),[P,I]=l.useState(["all"]),[C,A]=l.useState(["graded"]),[S,M]=l.useState(!1),[F,V]=l.useState(!0),[w,L]=l.useState([]),[h,E]=l.useState({totalStudents:0,totalActivities:0,pendingCorrections:0,avgGrade:0,onTimeRate:0,openActivities:0}),[y,B]=l.useState([]),[$,R]=l.useState([]),[O,X]=l.useState([]),[K,W]=l.useState([]),[te,de]=l.useState([]),[je,Ne]=l.useState([]),[ae,se]=l.useState(null),[Qa,pt]=l.useState(null);l.useEffect(()=>{ke()},[s,c,n,P,C]),l.useEffect(()=>{let t;return S&&(t=setInterval(ke,300*1e3)),()=>clearInterval(t)},[S]);const ke=async()=>{if(s?.id){r(!0);try{if(await ht(),F){const{data:t}=await T.auth.getSession(),x=t?.session?.access_token,f=await fetch("https://wapbwaimkurbuihatmix.supabase.co/functions/v1/get-teacher-analytics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({period:c,selectedClasses:n.length>0?n:w.map(j=>j.id)})});if(!f.ok)throw new Error("Erro ao carregar analytics");const N=await f.json(),b=N.data;E(b.kpis),de(b.topStudents||[]),await Promise.all([Ee(),De(),Pe(),Ie(),Te(),Fe()]),N.cached&&a({title:"‚ö° Cache",description:"Dados carregados do cache (5min)",duration:2e3})}else await Promise.all([xt(),Ee(),De(),Pe(),Ie(),gt(),Te(),Fe()])}catch(t){G.error("Erro ao carregar analytics:",t),a({title:"Erro",description:"N√£o foi poss√≠vel carregar os dados de analytics",variant:"destructive"})}finally{r(!1),u&&o(!1)}}},ht=async()=>{try{const{data:t,error:x}=await T.from("classes").select("id, name, subject, color").eq("created_by",s.id).eq("is_active",!0).order("name",{ascending:!0});if(x)throw x;const f=t||[];L(f),n.length===0&&f.length>0&&v(f.map(N=>N.id))}catch(t){G.error("Erro ao carregar turmas:",t),L([])}},xt=async()=>{if(n.length===0){E({totalStudents:0,totalActivities:0,pendingCorrections:0,avgGrade:0,onTimeRate:0,openActivities:0});return}const t=c==="all"?null:ve(ne(new Date,parseInt(c)),"yyyy-MM-dd"),{data:x}=await T.from("class_members").select("user_id").in("class_id",n).eq("role","student"),f=new Set(x?.map(U=>U.user_id)||[]).size;let N=T.from("activity_class_assignments").select("activity_id, activities!inner(id, created_at, status)").in("class_id",n);t&&(N=N.gte("activities.created_at",t));const{data:b}=await N,j=new Set(b?.map(U=>U.activity_id)||[]).size,{data:k}=await T.from("submissions").select("id, activity_id, activities!inner(id, activity_class_assignments!inner(class_id))").eq("status","submitted").in("activities.activity_class_assignments.class_id",n),d=k?.length||0;let g=T.from("submissions").select("grade, activity_id, activities!inner(id, activity_class_assignments!inner(class_id))").not("grade","is",null).in("activities.activity_class_assignments.class_id",n);t&&(g=g.gte("graded_at",t));const{data:D}=await g,p=D?.length>0?(D.reduce((U,Nt)=>U+(Nt.grade||0),0)/D.length).toFixed(1):0,{data:_}=await T.from("submissions").select("submitted_at, activity_id, activities!inner(due_date, activity_class_assignments!inner(class_id))").eq("status","submitted").in("activities.activity_class_assignments.class_id",n).not("submitted_at","is",null).not("activities.due_date","is",null),z=_?.filter(U=>new Date(U.submitted_at)<=new Date(U.activities.due_date)).length||0,Y=_?.length>0?Math.round(z/_.length*100):0,{data:q}=await T.from("activity_class_assignments").select("activity_id, activities!inner(status, due_date)").in("class_id",n).eq("activities.status","active").gte("activities.due_date",new Date().toISOString()),H=q?.length||0;E({totalStudents:f,totalActivities:j,pendingCorrections:d,avgGrade:parseFloat(p),onTimeRate:Y,openActivities:H})},Ee=async()=>{if(n.length===0){B([]);return}const t=c==="all"?90:Number.parseInt(c,10)||30,x=ne(new Date,t),{data:f,error:N}=await T.from("submissions").select("grade, graded_at, activity_id, activities!inner(activity_class_assignments!inner(class_id))").not("grade","is",null).in("activities.activity_class_assignments.class_id",n).gte("graded_at",x.toISOString()).order("graded_at",{ascending:!0}).limit(1e3);if(N){G.error("Erro ao carregar evolu√ß√£o de notas:",N),B([]);return}const b={};(f||[]).forEach(k=>{if(!k||k.grade==null||!k.graded_at)return;const d=parseFloat(k.grade);if(Number.isNaN(d))return;const g=new Date(k.graded_at);if(Number.isNaN(g.getTime()))return;const D=ve(g,"dd/MM");b[D]||(b[D]=[]),b[D].push(d)});const j=Object.entries(b).map(([k,d])=>{const g=d.length>0?d.reduce((D,p)=>D+p,0)/d.length:0;return{date:k,media:parseFloat(g.toFixed(2)),submissoes:d.length}});B(j.slice(-30))},De=async()=>{if(n.length===0){R([]);return}try{const{data:t,error:x}=await T.from("submissions").select(`
          grade,
          activity_id,
          activities!inner(
            activity_class_assignments!inner(class_id)
          )
        `).not("grade","is",null).in("activities.activity_class_assignments.class_id",n).limit(2e3);if(x)throw x;const{data:f,error:N}=await T.from("class_members").select("class_id, user_id").in("class_id",n).eq("role","student");if(N)throw N;const{data:b,error:j}=await T.from("activity_class_assignments").select("class_id, activity_id").in("class_id",n);if(j)throw j;const k=[],d={},g={};(f||[]).forEach(p=>{p.class_id&&(d[p.class_id]=(d[p.class_id]||0)+1)}),(b||[]).forEach(p=>{p.class_id&&(g[p.class_id]=(g[p.class_id]||0)+1)});const D=w.reduce((p,_)=>(p[_.id]=_,p),{});for(const p of n){const _=D[p];if(!_)continue;const z=(t||[]).filter(q=>q.activities?.activity_class_assignments?.some(H=>H.class_id===p)),Y=z.length>0?z.reduce((q,H)=>q+(H.grade||0),0)/z.length:0;k.push({name:_.name,media:parseFloat(Y.toFixed(2)),alunos:d[p]||0,atividades:g[p]||0,color:_.color||"#3B82F6"})}R(k.sort((p,_)=>_.media-p.media))}catch(t){G.error("Erro ao carregar compara√ß√£o entre turmas:",t),R([])}},Pe=async()=>{if(n.length===0){X([]);return}const{data:t,error:x}=await T.from("submissions").select("grade, activity_id, activities!inner(max_score, activity_class_assignments!inner(class_id))").not("grade","is",null).in("activities.activity_class_assignments.class_id",n).limit(1e3);if(x){G.error("Erro ao carregar distribui√ß√£o de notas:",x),X([]);return}const f=[{range:"0-2",count:0,color:"#EF4444"},{range:"2-4",count:0,color:"#F97316"},{range:"4-6",count:0,color:"#F59E0B"},{range:"6-8",count:0,color:"#3B82F6"},{range:"8-10",count:0,color:"#10B981"}];t?.forEach(({grade:N,activities:b})=>{const j=parseFloat(N),k=parseFloat(b?.max_score||10);if(isNaN(j))return;let d=j;k>0&&k!==10&&(d=j/k*10),d=Math.max(0,Math.min(10,d)),d<2?f[0].count++:d<4?f[1].count++:d<6?f[2].count++:d<8?f[3].count++:f[4].count++}),X(f)},Ie=async()=>{if(n.length===0){W([]);return}const t=ve(ne(new Date,84),"yyyy-MM-dd"),{data:x,error:f}=await T.from("submissions").select("submitted_at, status, activity_id, activities!inner(due_date, activity_class_assignments!inner(class_id))").in("status",["submitted","graded"]).in("activities.activity_class_assignments.class_id",n).gte("submitted_at",t).limit(1e3);if(f){G.error("Erro ao carregar tend√™ncia semanal de entregas:",f),W([]);return}const N=[];for(let b=0;b<12;b++){const j=ne(new Date,(12-b)*7),k=ne(new Date,(11-b)*7),d=x?.filter(p=>{const _=new Date(p.submitted_at);return _>=j&&_<=k})||[],g=d.filter(p=>p.activities?.due_date&&new Date(p.submitted_at)<=new Date(p.activities.due_date)).length,D=d.filter(p=>p.activities?.due_date&&new Date(p.submitted_at)>new Date(p.activities.due_date)).length;N.push({week:`S${12-b}`,noPrazo:g,atrasadas:D,total:d.length})}W(N)},gt=async()=>{if(n.length===0){de([]),Ne([]);return}const{data:t,error:x}=await T.from("submissions").select(`
        grade,
        status,
        submitted_at,
        student_id,
        student:profiles!submissions_student_id_fkey(id, full_name, avatar_url),
        activity_id,
        activities!inner(max_score, due_date, activity_class_assignments!inner(class_id))
      `).not("grade","is",null).in("activities.activity_class_assignments.class_id",n).limit(500);if(x){G.error("Erro ao carregar top/bottom students:",x),de([]),Ne([]);return}const f=w.reduce((d,g)=>(d[g.id]=g,d),{}),N={};t?.forEach(d=>{N[d.student_id]||(N[d.student_id]={student:d.student,grades:[],total:0,onTime:0,classes:new Set});const g=N[d.student_id],D=parseFloat(d.grade)||0;g.grades.push(D),g.total++;const p=d.submitted_at?new Date(d.submitted_at):null,_=d.activities?.due_date?new Date(d.activities.due_date):null;p&&_&&p<=_&&g.onTime++,(d.activities?.activity_class_assignments||[]).forEach(Y=>{const q=f[Y.class_id];q&&g.classes.add(q.name)})});const b=Object.entries(N).map(([d,g])=>{const D=g.grades.length>0?g.grades.reduce((_,z)=>_+z,0)/g.grades.length:0,p=g.total>0?Math.round(g.onTime/g.total*100):0;return{id:d,name:g.student?.full_name||"Sem nome",avatar:g.student?.avatar_url,avgGrade:D,activities:g.total,onTimeRate:p,classes:Array.from(g.classes).slice(0,3)}}).sort((d,g)=>g.avgGrade-d.avgGrade),j=b.slice(0,10),k=b.filter(d=>d.activities>=3).slice(-10).sort((d,g)=>d.avgGrade-g.avgGrade);de(j),Ne(k)},Te=async()=>{if(n.length===0){se(null);return}const t=c==="all"?90:Number.parseInt(c,10)||30,x=ne(new Date,t);try{const{data:f,error:N}=await T.from("plagiarism_checks_v2").select(`
          similarity_percentage,
          plagiarism_severity,
          checked_at,
          activity_id,
          submission_id,
          activities!inner(activity_class_assignments!inner(class_id))
        `).in("activities.activity_class_assignments.class_id",n).gte("checked_at",x.toISOString()).limit(1e3);N&&G.error("Erro ao carregar estat√≠sticas de pl√°gio (v2):",N);const b=(f||[]).filter(p=>p.similarity_percentage!=null);if(b.length>0){const p=b.reduce((Y,q)=>{const H=Number.parseFloat(q.similarity_percentage),U=Number.isNaN(H)?0:H;return Y+(100-U)},0)/b.length,_=["high","critical"],z=b.filter(Y=>_.includes((Y.plagiarism_severity||"").toLowerCase())).length;se({avgOriginality:Math.round(p),totalChecks:b.length,casesDetected:z,aiDetected:0});return}const{data:j,error:k}=await T.from("plagiarism_checks").select(`
          plagiarism_percentage,
          ai_generated,
          submission_id,
          submissions!inner(activity_id, activities!inner(activity_class_assignments!inner(class_id)))
        `).in("submissions.activities.activity_class_assignments.class_id",n).gte("checked_at",x.toISOString()).limit(1e3);if(k){G.error("Erro ao carregar estat√≠sticas de pl√°gio (legacy):",k),se(null);return}const d=(j||[]).filter(p=>p.plagiarism_percentage!=null);if(d.length===0){se(null);return}const g=d.reduce((p,_)=>{const z=_.plagiarism_percentage||0;return p+(100-z)},0)/d.length,D=d.filter(p=>100-(p.plagiarism_percentage||0)<70).length;se({avgOriginality:Math.round(g),totalChecks:d.length,casesDetected:D,aiDetected:d.filter(p=>p.ai_generated).length})}catch(f){G.error("Erro ao carregar estat√≠sticas de pl√°gio:",f),se(null)}},Fe=async()=>{pt({uniqueAccess:0,avgSessionTime:0,returnRate:0,interactions:0})},vt=async()=>{try{const t=[];t.push("TamanduAI - Analytics Dashboard"),t.push(`Per√≠odo: √öltimos ${c} dias`),t.push(`Data de Exporta√ß√£o: ${new Date().toLocaleString("pt-BR")}`),t.push(""),t.push("KPIs Principais"),t.push("Indicador,Valor"),t.push(`Total de Alunos,${h.totalStudents}`),t.push(`Total de Atividades,${h.totalActivities}`),t.push(`Corre√ß√µes Pendentes,${h.pendingCorrections}`),t.push(`M√©dia Geral,${h.avgGrade.toFixed(2)}`),t.push(`Taxa de Entrega no Prazo,${h.onTimeRate.toFixed(1)}%`),t.push(""),t.push("Evolu√ß√£o de Notas"),t.push("Dia,M√©dia"),y.forEach(j=>{t.push(`${j.date},${j.media}`)}),t.push(""),t.push("Compara√ß√£o de Turmas"),t.push("Turma,M√©dia"),$.forEach(j=>{t.push(`${j.name},${j.media}`)}),t.push(""),t.push("Top 10 Alunos"),t.push("Posi√ß√£o,Nome,M√©dia,Atividades,Entregas no Prazo (%),Turmas"),te.forEach((j,k)=>{const d=(j.classes||[]).join(" | ");t.push(`${k+1},${j.name},${j.avgGrade.toFixed(2)},${j.activities},${j.onTimeRate},${d}`)});const x=t.join(`
`),f=new Blob([x],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(f),b=document.createElement("a");b.setAttribute("href",N),b.setAttribute("download",`analytics-dashboard-${ve(new Date,"yyyy-MM-dd")}.csv`),document.body.appendChild(b),b.click(),document.body.removeChild(b),a({title:"‚úÖ Dashboard exportado!",description:"Arquivo CSV baixado com sucesso"})}catch(t){G.error("Erro ao exportar:",t),a({title:"‚ùå Erro ao exportar",description:t.message,variant:"destructive"})}},ft=async()=>{try{await Ft({period:c,kpis:h,gradeEvolution:y,classComparison:$,gradeDistribution:O,weeklyTrends:K,topStudents:te,bottomStudents:je}),a({title:"‚úÖ Dashboard exportado!",description:"PDF gerado com sucesso"})}catch(t){G.error("Erro ao exportar PDF:",t),a({title:"‚ùå Erro ao exportar PDF",description:t.message,variant:"destructive"})}},bt=()=>{const t=[];h.avgGrade<6&&t.push("‚ö†Ô∏è M√©dia da turma est√° abaixo de 6.0"),h.pendingCorrections>10&&t.push(`‚ö†Ô∏è ${h.pendingCorrections} corre√ß√µes pendentes`),h.onTimeRate<70&&t.push(`‚ö†Ô∏è Taxa de entrega no prazo est√° em ${h.onTimeRate.toFixed(1)}%`),t.length>0?a({title:"üîî Alertas Ativos",description:t.join(" ‚Ä¢ "),duration:5e3}):a({title:"‚úÖ Tudo certo!",description:"Nenhum alerta ativo no momento"})},yt=()=>{ke(),a({title:"Filtros aplicados"})},jt=()=>{m("30"),v(w.map(t=>t.id)),I(["all"]),A(["graded"]),a({title:"Filtros limpos"})};return i&&u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ct,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(It,{title:"Analytics e Insights",subtitle:"An√°lise completa de desempenho e tend√™ncias",role:"teacher",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{variant:"outline",onClick:bt,children:[e.jsx(Ot,{className:"w-4 h-4 mr-2"}),"Configurar Alertas"]}),e.jsxs(St,{children:[e.jsx(Et,{asChild:!0,children:e.jsxs(ce,{variant:"outline",children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Exportar"]})}),e.jsxs(Dt,{align:"end",children:[e.jsx(Me,{onClick:vt,children:"Exportar CSV"}),e.jsx(Me,{onClick:ft,children:"Exportar PDF"})]})]})]})}),e.jsxs(J,{className:"p-6 mb-6 sticky top-0 z-10 bg-white dark:bg-slate-900 shadow-lg",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[e.jsx(Lt,{className:"w-4 h-4 inline mr-2"}),"Per√≠odo"]}),e.jsxs(Le,{value:c,onValueChange:m,children:[e.jsx(ze,{children:e.jsx(Re,{})}),e.jsxs(Ge,{children:[e.jsx(Z,{value:"7",children:"√öltimos 7 dias"}),e.jsx(Z,{value:"15",children:"√öltimos 15 dias"}),e.jsx(Z,{value:"30",children:"√öltimos 30 dias"}),e.jsx(Z,{value:"60",children:"√öltimos 60 dias"}),e.jsx(Z,{value:"90",children:"√öltimos 90 dias"}),e.jsx(Z,{value:"180",children:"√öltimos 180 dias"}),e.jsx(Z,{value:"all",children:"Todo o Per√≠odo"})]})]})]}),e.jsxs("div",{className:"flex-1 min-w-[250px]",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[e.jsx(_e,{className:"w-4 h-4 inline mr-2"}),"Turmas"]}),e.jsxs("div",{className:"relative",children:[e.jsxs(Le,{value:n.length===w.length?"all":"custom",onValueChange:t=>{t==="all"?v(w.map(x=>x.id)):n.length===w.length&&v([])},children:[e.jsx(ze,{children:e.jsx(Re,{children:n.length===w.length?"Todas as turmas":n.length===0?"Selecione turmas":`${n.length} turma(s)`})}),e.jsxs(Ge,{children:[e.jsx(Z,{value:"all",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Todas as turmas"]})}),e.jsx(Z,{value:"custom",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Selecionar turmas espec√≠ficas"]})})]})]}),n.length<w.length&&n.length>0&&e.jsx("div",{className:"absolute top-full mt-1 w-full z-50 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg p-2",children:e.jsx("div",{className:"max-h-40 overflow-y-auto",children:w.map(t=>e.jsxs("div",{className:"flex items-center p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded",children:[e.jsx(Be,{id:`class-${t.id}`,checked:n.includes(t.id),onCheckedChange:x=>{v(x?[...n,t.id]:n.filter(f=>f!==t.id))}}),e.jsxs("label",{htmlFor:`class-${t.id}`,className:"ml-2 text-sm cursor-pointer flex-1",children:[t.name," ",t.subject&&`- ${t.subject}`]})]},t.id))})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{onClick:yt,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Aplicar Filtros"]}),e.jsx(ce,{variant:"outline",onClick:jt,children:"Limpar"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{checked:S,onCheckedChange:M,id:"auto-refresh"}),e.jsx("label",{htmlFor:"auto-refresh",className:"text-sm cursor-pointer",children:"Auto-atualizar (5min)"})]})]}),n.length>0&&n.length<w.length&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.map(t=>{const x=w.find(f=>f.id===t);return x?e.jsxs(Oe,{variant:"secondary",className:"text-xs",children:[x.name,e.jsx("button",{onClick:()=>v(n.filter(f=>f!==t)),className:"ml-1 hover:text-red-500",children:"√ó"})]},t):null})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-8",children:[e.jsx(ie,{title:"Total de Alunos",value:h.totalStudents,icon:_e,gradient:Q.primary,bgColor:"bg-blue-50 dark:bg-blue-950/30"}),e.jsx(ie,{title:"Atividades Postadas",value:h.totalActivities,icon:zt,gradient:Q.info,bgColor:"bg-cyan-50 dark:bg-cyan-950/30"}),e.jsx(ie,{title:"Atividades Abertas",value:h.openActivities,icon:Rt,gradient:Q.warning,bgColor:"bg-yellow-50 dark:bg-yellow-950/30"}),e.jsx(ie,{title:"Aguardando Corre√ß√£o",value:h.pendingCorrections,icon:Gt,gradient:Q.danger,bgColor:"bg-red-50 dark:bg-red-950/30"}),e.jsx(ie,{title:"Nota M√©dia Geral",value:h.avgGrade.toFixed(1),icon:Bt,gradient:h.avgGrade>=7?Q.success:h.avgGrade>=5?Q.warning:Q.danger,bgColor:h.avgGrade>=7?"bg-green-50 dark:bg-green-950/30":"bg-yellow-50 dark:bg-yellow-950/30"}),e.jsx(ie,{title:"Taxa Entrega no Prazo",value:`${h.onTimeRate}%`,icon:$t,gradient:Q.success,bgColor:"bg-green-50 dark:bg-green-950/30"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40",children:e.jsx(Aa,{className:"w-5 h-5 text-blue-600 dark:text-blue-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Evolu√ß√£o das notas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"M√©dia por dia de corre√ß√£o no per√≠odo selecionado"})]})]})}),y.length>0?e.jsx("div",{className:"h-64",children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(Ja,{data:y,margin:{left:-20,right:10},children:[e.jsx(ue,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(pe,{dataKey:"date",tick:{fontSize:10}}),e.jsx(he,{domain:[0,10],tick:{fontSize:10}}),e.jsx(xe,{labelFormatter:t=>`Dia ${t}`,formatter:t=>[`M√©dia ${t.toFixed(2)}`,"Nota"]}),e.jsx(ut,{type:"monotone",dataKey:"media",stroke:"#2563EB",fillOpacity:.15,fill:"#60A5FA"})]})})}):e.jsx("p",{className:"text-xs text-slate-500",children:"Ainda n√£o h√° notas suficientes para calcular a evolu√ß√£o."})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100 dark:bg-emerald-900/40",children:e.jsx(Xe,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Tend√™ncia semanal de entregas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Entregues no prazo x atrasadas (√∫ltimas 12 semanas)"})]})]})}),K.length>0?e.jsx("div",{className:"h-64",children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(Ae,{data:K,margin:{left:-20,right:10},children:[e.jsx(ue,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(pe,{dataKey:"week",tick:{fontSize:10}}),e.jsx(he,{tick:{fontSize:10}}),e.jsx(xe,{}),e.jsx(ba,{}),e.jsx(ge,{dataKey:"noPrazo",name:"No prazo",stackId:"a",fill:"#22C55E"}),e.jsx(ge,{dataKey:"atrasadas",name:"Atrasadas",stackId:"a",fill:"#F97316"})]})})}):e.jsx("p",{className:"text-xs text-slate-500",children:"Nenhuma entrega registrada neste per√≠odo."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8",children:[e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-100 dark:bg-indigo-900/40",children:e.jsx(ya,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Distribui√ß√£o de notas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Faixas de desempenho das avalia√ß√µes"})]})]})}),O.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-56",children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(Ae,{data:O,children:[e.jsx(ue,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(pe,{dataKey:"range",tick:{fontSize:10}}),e.jsx(he,{tick:{fontSize:10}}),e.jsx(xe,{}),e.jsx(ge,{dataKey:"count",children:O.map((t,x)=>e.jsx(Ye,{fill:t.color},x))})]})})}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2",children:[e.jsx(Oe,{variant:"outline",className:"text-[10px]",children:"‚úì Notas normalizadas para escala 0-10"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"As notas s√£o exibidas em faixas de 0 a 10 apenas para visualiza√ß√£o."})]})]}):e.jsx("p",{className:"text-xs text-slate-500",children:"Nenhuma nota registrada ainda para montar a distribui√ß√£o."})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/40",children:e.jsx(Xe,{className:"w-5 h-5 text-purple-600 dark:text-purple-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Compara√ß√£o entre turmas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"M√©dia geral por turma"})]})]})}),$.length>0?e.jsx("div",{className:"h-56 overflow-x-auto",children:e.jsx("div",{className:$.length>6?"min-w-[640px]":"min-w-full",children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(Ae,{data:$,children:[e.jsx(ue,{strokeDasharray:"3 3",className:"stroke-slate-200 dark:stroke-slate-800"}),e.jsx(pe,{dataKey:"name",tick:{fontSize:10}}),e.jsx(he,{domain:[0,10],tick:{fontSize:10}}),e.jsx(xe,{}),e.jsx(ge,{dataKey:"media",name:"M√©dia",children:$.map((t,x)=>e.jsx(Ye,{fill:t.color||"#3B82F6"},x))})]})})})}):e.jsx("p",{className:"text-xs text-slate-500",children:"Selecione pelo menos uma turma para ver a compara√ß√£o."})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100 dark:bg-emerald-900/40",children:e.jsx(ja,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Originalidade e pl√°gio"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Resumo das verifica√ß√µes de pl√°gio"})]})]})}),ae?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 text-xs",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Originalidade m√©dia"}),e.jsxs("span",{className:"font-semibold text-emerald-600 dark:text-emerald-300",children:[ae.avgOriginality,"%"]})]}),e.jsx(Pt,{value:ae.avgOriginality,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Verifica√ß√µes realizadas"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:ae.totalChecks})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/40",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Casos cr√≠ticos"}),e.jsx("p",{className:"text-lg font-semibold text-amber-700 dark:text-amber-300",children:ae.casesDetected})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/40",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Poss√≠vel IA"}),e.jsx("p",{className:"text-lg font-semibold text-purple-700 dark:text-purple-300",children:ae.aiDetected})]})]})]}):e.jsx("p",{className:"text-xs text-slate-500",children:"Nenhuma verifica√ß√£o de pl√°gio registrada neste per√≠odo."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12",children:[e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40",children:e.jsx(Na,{className:"w-5 h-5 text-blue-600 dark:text-blue-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Top alunos"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Desempenho m√©dio dos alunos mais ativos"})]})]})}),te.length>0?e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto pr-1",children:te.map((t,x)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-900/60",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:(t.name||"?").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-900 dark:text-slate-50",children:[x+1,". ",t.name]}),e.jsxs("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:[t.activities," atividades ‚Ä¢ ",t.onTimeRate,"% no prazo"]}),t.classes&&t.classes.length>0&&e.jsxs("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-0.5",children:["Turmas: ",t.classes.join(", ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:t.avgGrade.toFixed(1)}),e.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"nota m√©dia"})]})]},t.id))}):e.jsx("p",{className:"text-xs text-slate-500",children:"Ainda n√£o h√° dados suficientes para ranquear os alunos."}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h3",{className:"text-sm font-semibold text-slate-900 dark:text-slate-50 flex items-center gap-1",children:[e.jsx(ka,{className:"w-4 h-4 text-amber-500"}),"Alunos que precisam de aten√ß√£o"]})}),je.length>0?e.jsx("div",{className:"space-y-2 max-h-56 overflow-y-auto pr-1",children:je.map((t,x)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-amber-50/60 dark:bg-amber-900/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center text-white text-[11px] font-bold",children:(t.name||"?").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-semibold text-slate-900 dark:text-slate-50",children:[x+1,". ",t.name]}),e.jsxs("p",{className:"text-[10px] text-slate-600 dark:text-slate-400",children:[t.activities," atividades ‚Ä¢ ",t.onTimeRate,"% no prazo"]}),t.classes&&t.classes.length>0&&e.jsxs("p",{className:"text-[10px] text-slate-500 dark:text-slate-500 mt-0.5",children:["Turmas: ",t.classes.join(", ")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-amber-700 dark:text-amber-300",children:t.avgGrade.toFixed(1)}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"nota m√©dia"}),e.jsx(ce,{size:"sm",variant:"outline",className:"mt-1 text-xs h-6 px-2",onClick:()=>{window.location.href=`/dashboard/students/${t.id}`},children:"Ver Detalhes"})]})]},t.id))}):e.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"Nenhum aluno em destaque negativo neste per√≠odo."})]})]}),e.jsxs(J,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-sky-100 dark:bg-sky-900/40",children:e.jsx(_a,{className:"w-5 h-5 text-sky-600 dark:text-sky-300"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"Engajamento (beta)"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Vis√£o geral do engajamento dos alunos"})]})]})}),e.jsxs("div",{className:"space-y-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("p",{children:"Estes indicadores ser√£o enriquecidos com dados de uso da plataforma (acessos, tempo de sess√£o, intera√ß√µes). Por enquanto, use as demais m√©tricas para monitorar participa√ß√£o e desempenho."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Acessos √∫nicos (em breve)"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Tempo m√©dio de estudo"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Taxa de retorno"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-slate-50 dark:bg-slate-900/60",children:[e.jsx("p",{children:"Intera√ß√µes na plataforma"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-400 dark:text-slate-500",children:"‚Äî"})]})]})]})]})]})]})};export{ci as default};
