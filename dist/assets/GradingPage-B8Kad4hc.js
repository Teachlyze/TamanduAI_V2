import{c as F,r as n,j as e,k as I,u as A,s as y,i as D}from"./main-B-DuDfC3.js";import{C as p,B as h}from"./card-D9y6cEbK.js";import{B as L}from"./badge-D_5Pz7Pp.js";import{a as _,D as B}from"./dropdown-menu-S8hb-z0t.js";import{L as C,I as q}from"./label-CQXNCxhD.js";import{X as M}from"./x-5mMV-IBm.js";import{A as O}from"./arrow-left-br2hRIKT.js";import{U as P}from"./user-CjDGgQos.js";import{F as z}from"./file-text-Vxms5le2.js";import{C as H}from"./chevron-right-BFR20X-e.js";import"./index-BvwGeBdQ.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],V=F("chevron-left",R);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],U=F("save",T),J=({maxGrade:a=10,initialGrade:x=null,initialFeedback:v="",onSave:g,onCancel:b,loading:m=!1})=>{const[s,j]=n.useState(x?.toString()||""),[d,N]=n.useState(v),[r,f]=n.useState({}),l=()=>{const t={};if(!s||s.trim()==="")t.grade="Nota é obrigatória";else{const i=parseFloat(s);isNaN(i)?t.grade="Nota deve ser um número":i<0?t.grade="Nota não pode ser negativa":i>a&&(t.grade=`Nota não pode ser maior que ${a}`)}return f(t),Object.keys(t).length===0},k=t=>{if(t.preventDefault(),!l())return;const i=parseFloat(s);g({grade:i,feedback:d})},w=t=>{const i=t.target.value;(i===""||/^\d*\.?\d*$/.test(i))&&(j(i),r.grade&&f({...r,grade:null}))};return e.jsx(p,{className:"p-6 bg-white dark:bg-slate-900",children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"grade",className:"text-sm font-semibold mb-2 block",children:["Nota (0 - ",a,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{id:"grade",type:"text",value:s,onChange:w,placeholder:`Ex: ${(a/2).toFixed(1)}`,className:`text-lg font-semibold ${r.grade?"border-red-500 focus:ring-red-500":""}`,disabled:m}),e.jsxs("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-slate-500",children:["/ ",a]})]}),r.grade&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:r.grade}),s&&!isNaN(parseFloat(s))&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${parseFloat(s)>=a*.7?"bg-green-500":parseFloat(s)>=a*.5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(parseFloat(s)/a*100,100)}%`}})})})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"feedback",className:"text-sm font-semibold mb-2 block",children:"Feedback (opcional)"}),e.jsx("textarea",{id:"feedback",value:d,onChange:t=>N(t.target.value),placeholder:"Escreva um feedback para o aluno...",rows:6,disabled:m,className:`
              w-full px-3 py-2 rounded-lg border ${_.border.default}
              bg-white dark:bg-slate-900 ${_.text.primary}
              focus:ring-2 focus:ring-blue-500 focus:border-blue-500
              resize-none transition-all
            `}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-500",children:[d.length," caracteres"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{type:"submit",disabled:m,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Salvar Nota"]})}),b&&e.jsxs(h,{type:"button",variant:"outline",onClick:b,disabled:m,children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Cancelar"]})]})]})})},re=()=>{const{submissionId:a}=I(),x=A(),[v,g]=n.useState(!0),[b,m]=n.useState(!1),[s,j]=n.useState(null),[d,N]=n.useState(null),[r,f]=n.useState([]),[l,k]=n.useState(0);n.useEffect(()=>{w()},[a]);const w=async()=>{try{g(!0);const{data:o,error:u}=await y.from("submissions").select(`
          *,
          student:profiles!submissions_user_id_fkey(id, name, email, avatar_url),
          activity:activities(id, title, max_grade, due_date)
        `).eq("id",a).single();if(u)throw u;j(o),N(o.activity);const{data:c,error:S}=await y.from("submissions").select("id, user_id, status").eq("activity_id",o.activity_id).order("submitted_at",{ascending:!0});if(!S){f(c||[]);const $=c?.findIndex(E=>E.id===a)??0;k($)}}catch(o){console.error("Erro ao carregar submissão:",o)}finally{g(!1)}},t=async({grade:o,feedback:u})=>{try{m(!0);const{error:c}=await y.from("submissions").update({grade:o,feedback:u,status:"graded",graded_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",a);if(c)throw c;if(alert("Nota salva com sucesso!"),l<r.length-1){const S=r[l+1];x(`/teacher/grading/${S.id}`)}else x(`/teacher/activities/${d?.id}/submissions`)}catch(c){console.error("Erro ao salvar nota:",c),alert("Erro ao salvar nota. Tente novamente.")}finally{m(!1)}},i=o=>{const u=o==="prev"?l-1:l+1;if(u>=0&&u<r.length){const c=r[u];x(`/teacher/grading/${c.id}`)}};return v?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(D,{size:"lg",text:"Carregando submissão..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(h,{variant:"ghost",onClick:()=>x(`/teacher/activities/${d?.id}/submissions`),className:"mb-4",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Voltar para Submissões"]}),e.jsx(B,{title:"Corrigir Submissão",subtitle:`${d?.title||"Atividade"} • ${l+1} de ${r.length}`,role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Informações do Aluno"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[s?.student?.avatar_url?e.jsx("img",{src:s.student.avatar_url,alt:s.student.name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-2xl font-bold",children:s?.student?.name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white text-lg",children:s?.student?.name||"Aluno"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s?.student?.email||"Sem email"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Data de Envio:"}),e.jsx("p",{className:"font-semibold text-slate-900 dark:text-white",children:s?.submitted_at?new Date(s.submitted_at).toLocaleString("pt-BR"):"Não enviada"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Status:"}),e.jsx("div",{className:"mt-1",children:e.jsx(L,{className:s?.status==="graded"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",children:s?.status==="graded"?"Corrigida":"Pendente"})})]})]})]}),e.jsxs(p,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Conteúdo da Submissão"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:s?.content?e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-950 rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2)})}):e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Nenhum conteúdo enviado."})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{maxGrade:d?.max_grade||10,initialGrade:s?.grade,initialFeedback:s?.feedback||"",onSave:t,onCancel:()=>x(`/teacher/activities/${d?.id}/submissions`),loading:b}),e.jsx(p,{className:"p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{variant:"outline",onClick:()=>i("prev"),disabled:l===0,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:[l+1," de ",r.length]}),e.jsxs(h,{variant:"outline",onClick:()=>i("next"),disabled:l>=r.length-1,children:["Próxima",e.jsx(H,{className:"w-4 h-4 ml-2"})]})]})})]})]})]})};export{re as default};
