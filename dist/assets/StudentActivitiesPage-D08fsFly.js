import{c as te,u as se,a as ae,r as d,s as L,j as e,k as le}from"./main-PnoWv5mu.js";import{C as M}from"./card-DNyDBtwZ.js";import{B as $}from"./SidebarPremium-DbDmcmQG.js";import{B as V}from"./button-B1az96ai.js";import{T as re,a as ie,b as N,c as k}from"./tabs-DLBf_pPV.js";import{S as _,a as S,b as C,c as D,d as l}from"./select-BMuuhZ5E.js";import{S as z}from"./StatsCard-rzGomFX8.js";import{D as de}from"./DashboardHeader-CjwFRF49.js";import{E as ne}from"./EmptyState-6R7lfM6O.js";import"./input-BGWMq9XA.js";import"./dropdown-menu-BDAIvG1Q.js";import"./label-DSOeyQ5r.js";import{F as ce}from"./funnel-dX1gPUGZ.js";import{C as F}from"./clock-Dkzb1QSl.js";import{C as oe}from"./circle-check-big-DeprgibN.js";import{C as me}from"./circle-alert-BGRUIVYu.js";import{F as G}from"./file-text-WNEYLkuB.js";import{E as ue}from"./eye-DRJaLhZW.js";import"./bell-jlu-i0nu.js";import"./book-open-BN8GTFXN.js";import"./trending-up-BnoBnv7_.js";import"./user-IPdw0V9z.js";import"./settings-BAc4VZJo.js";import"./users-CZvcSbj_.js";import"./graduation-cap-BTPeK0uK.js";import"./index-DvZMkTcl.js";import"./chart-column-Ba9dXnEb.js";import"./x-7WqOwCJm.js";import"./index-CWQpaRb1.js";import"./chevron-down-DfhVRSRG.js";import"./check-8UqrO2_7.js";import"./chevron-up-CxbLRzQ4.js";import"./tokens-BPdvztvj.js";import"./chevron-right-5LVKKztM.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],H=te("circle-play",xe),Je=()=>{const O=se(),{user:x}=ae(),[Y,g]=d.useState(!0),[h,J]=d.useState([]),[y,K]=d.useState([]),[Q,W]=d.useState([]),[m,X]=d.useState({pending:0,completed:0,late:0}),[u,A]=d.useState("all"),[p,T]=d.useState("all"),[f,B]=d.useState("all"),[b,I]=d.useState("deadline-asc");d.useEffect(()=>{x?.id?Z():g(!1)},[x]);const Z=async()=>{if(!x?.id){g(!1);return}try{g(!0);const{data:t}=await L.from("class_members").select("class_id, class:classes(id, name, subject, color)").eq("user_id",x.id).eq("role","student"),s=t?.map(i=>i.class_id)||[];if(W(t?.map(i=>i.class).filter(Boolean)||[]),s.length===0){g(!1);return}const{data:a}=await L.from("activity_class_assignments").select(`
          activity_id,
          class_id,
          class:classes (id, name, subject, color),
          activity:activities (
            id,
            title,
            description,
            due_date,
            max_score,
            type,
            status,
            created_at
          )
        `).in("class_id",s),r=(a||[]).map(i=>({...i.activity,class:i.class})).filter(Boolean);J(r);const n=r.map(i=>i.id),{data:c}=await L.from("submissions").select("*").eq("student_id",x.id).in("activity_id",n);K(c||[]);const q=new Date;let o=0,v=0,w=0;r.forEach(i=>{const U=c?.find(ee=>ee.activity_id===i.id);U?U.grade!==null&&v++:i.due_date&&new Date(i.due_date)<q?w++:o++}),X({pending:o,completed:v,late:w})}catch(t){console.error("Erro:",t)}finally{g(!1)}},E=t=>{const s=y.find(n=>n.activity_id===t.id),a=new Date,r=t.due_date?new Date(t.due_date):null;return s?s.grade!==null?{status:"completed",label:"Concluída",color:"bg-green-100 text-green-700"}:{status:"submitted",label:"Enviada",color:"bg-blue-100 text-blue-700"}:r&&r<a?{status:"late",label:"Atrasada",color:"bg-red-100 text-red-700"}:{status:"pending",label:"Pendente",color:"bg-amber-100 text-amber-700"}},P=t=>h.filter(s=>E(s).status===t),R=d.useMemo(()=>{let t=[...h];if(u!=="all"){const s=new Date,a={"7days":7,"30days":30,thisMonth:new Date(s.getFullYear(),s.getMonth()+1,0).getDate()};if(a[u]){const r=new Date;r.setDate(r.getDate()+a[u]),t=t.filter(n=>{if(!n.due_date)return!1;const c=new Date(n.due_date);return c>=s&&c<=r})}}return p!=="all"&&(t=t.filter(s=>s.class?.id===p)),f!=="all"&&(t=t.filter(s=>E(s).status===f)),t.sort((s,a)=>{switch(b){case"deadline-asc":return s.due_date?a.due_date?new Date(s.due_date)-new Date(a.due_date):-1:1;case"deadline-desc":return s.due_date?a.due_date?new Date(a.due_date)-new Date(s.due_date):-1:1;case"newest":return new Date(a.created_at)-new Date(s.created_at);case"score-high":return(a.max_score||0)-(s.max_score||0);case"score-low":return(s.max_score||0)-(a.max_score||0);default:return 0}}),t},[h,u,p,f,b,y]),j=({activity:t})=>{const s=E(t),a=y.find(w=>w.activity_id===t.id),r=new Date,n=t.due_date?new Date(t.due_date):null,c=n&&(n-r)/(1e3*60*60*24)<3&&s.status==="pending",o=a?.grade!==null?{text:"Ver Correção",icon:ue,variant:"outline",disabled:!1}:a?.status==="submitted"?{text:"Aguardando Correção",icon:F,variant:"outline",disabled:!0}:a?.status==="draft"?{text:"Continuar Rascunho",icon:H,variant:"default",disabled:!1}:{text:"Iniciar",icon:H,variant:"default",disabled:!1},v=o.icon;return e.jsxs(M,{className:"p-4 hover:shadow-lg transition-all border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white line-clamp-2",children:t.title}),c&&e.jsx($,{className:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300 text-xs",children:"Urgente!"})]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.class?.name," • ",t.class?.subject]})]}),e.jsx($,{className:`px-3 py-1 rounded-full text-xs font-semibold flex-shrink-0 ${s.color}`,children:s.label})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),t.due_date?e.jsx("span",{className:c?"text-red-600 font-semibold":"",children:new Date(t.due_date).toLocaleDateString("pt-BR")}):"Sem prazo"]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[t.max_score," pts"]})]}),a?.grade!==null&&e.jsx("div",{className:"mb-3 p-2 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["Nota: ",a.grade,"/",t.max_score]})}),e.jsxs(V,{onClick:()=>O(`/student/activities/${t.id}`),variant:o.variant,disabled:o.disabled,className:"w-full",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),o.text]})]})};return Y?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(le,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-slate-200 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-6",children:[e.jsx(de,{title:"Minhas Atividades",subtitle:"Gerencie suas tarefas e entregas",role:"student"}),e.jsxs(M,{className:"p-4 mb-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Período"}),e.jsxs(_,{value:u,onValueChange:A,children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Todas"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todas"}),e.jsx(l,{value:"7days",children:"Próximos 7 dias"}),e.jsx(l,{value:"30days",children:"Próximos 30 dias"}),e.jsx(l,{value:"thisMonth",children:"Este mês"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Turma"}),e.jsxs(_,{value:p,onValueChange:T,children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Todas as turmas"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todas as turmas"}),Q.map(t=>e.jsx(l,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Status"}),e.jsxs(_,{value:f,onValueChange:B,children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Todos"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todos"}),e.jsx(l,{value:"pending",children:"Não iniciadas"}),e.jsx(l,{value:"submitted",children:"Enviadas"}),e.jsx(l,{value:"completed",children:"Corrigidas"}),e.jsx(l,{value:"late",children:"Atrasadas"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 block",children:"Ordenar por"}),e.jsxs(_,{value:b,onValueChange:I,children:[e.jsx(S,{children:e.jsx(C,{})}),e.jsxs(D,{children:[e.jsx(l,{value:"deadline-asc",children:"Prazo mais próximo"}),e.jsx(l,{value:"deadline-desc",children:"Prazo mais distante"}),e.jsx(l,{value:"newest",children:"Recém adicionadas"}),e.jsx(l,{value:"score-high",children:"Maior pontuação"}),e.jsx(l,{value:"score-low",children:"Menor pontuação"})]})]})]})]}),(u!=="all"||p!=="all"||f!=="all"||b!=="deadline-asc")&&e.jsx(V,{variant:"outline",size:"sm",onClick:()=>{A("all"),T("all"),B("all"),I("deadline-asc")},className:"mt-4",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(z,{title:"Pendentes",value:m.pending,icon:F,gradient:"from-sky-500 to-blue-600",delay:0}),e.jsx(z,{title:"Concluídas",value:m.completed,icon:oe,gradient:"from-cyan-500 to-slate-600",delay:.1}),e.jsx(z,{title:"Atrasadas",value:m.late,icon:me,gradient:"from-slate-600 to-slate-800",delay:.2})]}),e.jsxs(re,{defaultValue:"all",className:"w-full",children:[e.jsxs(ie,{className:"mb-6 bg-slate-100/60 dark:bg-slate-800/60 border border-slate-200 dark:border-slate-700",children:[e.jsxs(N,{value:"all",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Todas (",h.length,")"]}),e.jsxs(N,{value:"pending",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Pendentes (",m.pending,")"]}),e.jsxs(N,{value:"completed",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Concluídas (",m.completed,")"]}),e.jsxs(N,{value:"late",className:"data-[state=active]:bg-white data-[state=active]:text-slate-900 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white",children:["Atrasadas (",m.late,")"]})]}),e.jsx(k,{value:"all",children:R.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:R.map(t=>e.jsx(j,{activity:t},t.id))}):e.jsxs(M,{className:"p-12 text-center bg-white dark:bg-slate-900",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Nenhuma atividade encontrada com esses filtros"}),e.jsx(V,{variant:"outline",onClick:()=>{A("all"),T("all"),B("all")},children:"Limpar filtros"})]})}),e.jsx(k,{value:"pending",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P("pending").map(t=>e.jsx(j,{activity:t},t.id))})}),e.jsx(k,{value:"completed",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P("completed").map(t=>e.jsx(j,{activity:t},t.id))})}),e.jsx(k,{value:"late",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P("late").map(t=>e.jsx(j,{activity:t},t.id))})})]}),h.length===0&&e.jsx(ne,{icon:G,title:"Nenhuma atividade encontrada",description:"Entre em uma turma para ver atividades"})]})};export{Je as default};
