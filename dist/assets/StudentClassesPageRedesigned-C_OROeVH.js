import{j as e,b as Z,u as I,r as d,s as c,l as ee,q as te}from"./main-C5n3kzXQ.js";import{C as se}from"./card-CjtJprPz.js";import{B as q}from"./button-CXfsJEZz.js";import{B as D}from"./badge-DIjZdJB4.js";import{m as p}from"./proxy-C-9wZx5L.js";import{B as u}from"./book-open-BP8V__Hw.js";import{U as ae}from"./users-Boys-rM5.js";import{F as re}from"./file-text-0s37oUXW.js";import{E as ie}from"./EmptyState-cekabAEp.js";import"./dialog-D4cdgt_6.js";import{I as ne}from"./input-Bec_LEaF.js";import{T as le,a as de,b as h}from"./tabs-Bmzwt0Jl.js";import{S as T}from"./search-bvx9xJte.js";import{G as oe}from"./grid-3x3-BDh1-CgI.js";import{L as ce}from"./list-DqZHgYxN.js";import{S as E}from"./star-DcZ05FcA.js";import"./index-B6XryYCt.js";import"./index-CsW3l1Gu.js";import"./Combination-Chdg_-Wh.js";import"./SidebarPremium-D25G1dNT.js";import"./house-ZJXziqlE.js";import"./graduation-cap-DHgx-smk.js";import"./calendar-BkZi9bLz.js";import"./chart-column-5ubExldJ.js";import"./message-circle-oS8o50gZ.js";import"./settings-BnI-Y10b.js";import"./brain-Bn2z760B.js";import"./index-DJGNkgSL.js";import"./chevron-right-avg7mug8.js";import"./x-3ab3q3Ef.js";import"./index-W2DwLdmL.js";import"./index-C2-paRPo.js";import"./index-CJbM7HGD.js";const me=({classItem:s,onClick:v,index:f=0})=>{const m={blue:"from-blue-600 to-cyan-500",green:"from-green-600 to-emerald-500",purple:"from-purple-600 to-pink-500",orange:"from-orange-600 to-amber-500",red:"from-red-600 to-rose-500",yellow:"from-yellow-600 to-orange-500",pink:"from-pink-600 to-rose-500",indigo:"from-indigo-600 to-purple-500",cyan:"from-cyan-600 to-blue-500",teal:"from-teal-600 to-green-500"},g=m[s.color]||m.blue;return e.jsx(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:f*.1,type:"spring"},whileHover:{scale:1.05,y:-8},onClick:v,className:"cursor-pointer",children:e.jsxs(se,{className:"overflow-hidden border-2 border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 hover:shadow-2xl transition-all",children:[e.jsxs("div",{className:`h-28 sm:h-32 bg-gradient-to-br ${g} p-4 sm:p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute -right-8 -bottom-8 opacity-20",children:e.jsx(u,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(D,{className:"mb-2 bg-white/20 text-white border-white/30 backdrop-blur-sm",children:s.subject||"MatÃ©ria"}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold line-clamp-2",children:s.name})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:s.teacher_name||"Professor"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400",children:s.pendingActivities||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600 dark:text-green-400",children:s.avgGrade!==null&&s.avgGrade!==void 0?s.avgGrade.toFixed(1):"--"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"MÃ©dia"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-orange-600 dark:text-orange-400",children:s.studentsCount||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Alunos"})]})]}),s.newActivities>0&&e.jsx(p.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3},children:e.jsxs(D,{className:"w-full justify-center py-2 bg-orange-100 text-orange-700 dark:bg-orange-900/40 dark:text-orange-300 border-orange-300 dark:border-orange-700",children:["ðŸ”” ",s.newActivities," nova",s.newActivities>1?"s":""," atividade",s.newActivities>1?"s":""]})}),s.nextDeadline&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),"PrÃ³ximo prazo: ",s.nextDeadline]})]})]})})},$e=()=>{const{user:s}=Z(),v=I(),[f,m]=d.useState(!0),[g,M]=d.useState(!0),[l,y]=d.useState([]),[_,P]=d.useState([]),[o,z]=d.useState(""),[b,k]=d.useState("grid"),[j,F]=d.useState("name");d.useEffect(()=>{s?.id&&R()},[s]),d.useEffect(()=>{V()},[l,o,j]);const R=async()=>{try{m(!0);const{data:t}=await c.from("class_members").select("class_id, joined_at").eq("user_id",s.id).eq("role","student"),r=t?.map(a=>a.class_id)||[],{data:i}=await c.from("classes").select("id, name, subject, color, created_at, created_by").in("id",r),x=i?.map(a=>a.created_by).filter(Boolean)||[],{data:C}=await c.from("profiles").select("id, full_name, avatar_url").in("id",x),A={};if(C?.forEach(a=>{A[a.id]=a}),r.length===0){y([]),m(!1);return}const O=await Promise.all(i.map(async a=>{const Q=t.find(n=>n.class_id===a.id),{data:U}=await c.from("activity_class_assignments").select("activity_id").eq("class_id",a.id),S=U?.map(n=>n.activity_id)||[],{data:B}=await c.from("submissions").select("activity_id, status, grade").eq("student_id",s.id).in("activity_id",S),G=new Set(B?.map(n=>n.activity_id)||[]),W=S.length-G.size,N=B?.filter(n=>n.grade!==null)||[],$=N.length>0?N.reduce((n,Y)=>n+parseFloat(Y.grade),0)/N.length:null,{data:H}=await c.from("class_members").select("id, is_archived").eq("class_id",a.id).eq("role","student"),J=H?.filter(n=>!n.is_archived).length||0,w=new Date;w.setDate(w.getDate()-7);const{data:K}=await c.from("activity_class_assignments").select("activity_id, assigned_at").eq("class_id",a.id).gte("assigned_at",w.toISOString()),X=(K?.map(n=>n.activity_id)||[]).filter(n=>!G.has(n)).length,L=A[a.created_by];return{id:a.id,name:a.name,subject:a.subject,color:a.color||"blue",teacher_name:L?.full_name||"Professor",teacher_avatar:L?.avatar_url,pendingActivities:W,avgGrade:$,studentsCount:J||0,newActivities:X,joined_at:Q?.joined_at,created_at:a.created_at}}));y(O)}catch(t){ee.error("Erro ao carregar turmas:",t)}finally{m(!1),g&&M(!1)}},V=()=>{let t=[...l];if(o){const r=o.toLowerCase();t=t.filter(i=>i.name?.toLowerCase().includes(r)||i.subject?.toLowerCase().includes(r)||i.teacher_name?.toLowerCase().includes(r))}t.sort((r,i)=>{switch(j){case"name":return r.name.localeCompare(i.name);case"pending":return i.pendingActivities-r.pendingActivities;case"grade":const x=r.avgGrade||0;return(i.avgGrade||0)-x;case"recent":return new Date(i.joined_at)-new Date(r.joined_at);default:return 0}}),P(t)};return f&&g?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(te,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(u,{className:"w-8 h-8 text-blue-600"}),"Minhas Turmas"]}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[l.length," turma",l.length!==1?"s":""," ativa",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(ne,{placeholder:"Buscar turmas por nome, matÃ©ria ou professor...",value:o,onChange:t=>z(t.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{value:j,onValueChange:F,children:e.jsxs(de,{children:[e.jsx(h,{value:"name",children:"Nome"}),e.jsx(h,{value:"pending",children:"Pendentes"}),e.jsx(h,{value:"grade",children:"MÃ©dia"}),e.jsx(h,{value:"recent",children:"Recentes"})]})}),e.jsxs("div",{className:"flex border rounded-lg overflow-hidden",children:[e.jsx(q,{variant:b==="grid"?"default":"ghost",size:"sm",onClick:()=>k("grid"),className:"rounded-none",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(q,{variant:b==="list"?"default":"ghost",size:"sm",onClick:()=>k("list"),className:"rounded-none",children:e.jsx(ce,{className:"w-4 h-4"})})]})]})]}),_.length>0?e.jsx("div",{className:b==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6":"space-y-3 sm:space-y-4",children:_.map((t,r)=>e.jsx(me,{classItem:t,onClick:()=>v(`/students/classes/${t.id}`),index:r},t.id))}):e.jsx(ie,{icon:o?T:u,title:o?"Nenhuma turma encontrada":"VocÃª ainda nÃ£o estÃ¡ em nenhuma turma",description:o?"Tente ajustar sua busca para encontrar o que procura.":"Entre em contato com seu professor para ser adicionado a uma turma.",variant:"default"}),l.length>0&&e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-8 sm:mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(u,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Total de Turmas"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-blue-600",children:l.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30",children:e.jsx(E,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Atividades Pendentes"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-orange-600",children:l.reduce((t,r)=>t+r.pendingActivities,0)})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 sm:p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(E,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"MÃ©dia Geral"})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-green-600",children:(()=>{const t=l.filter(i=>i.avgGrade!==null);return t.length===0?"--":(t.reduce((i,x)=>i+x.avgGrade,0)/t.length).toFixed(1)})()})]})]})]})};export{$e as default};
