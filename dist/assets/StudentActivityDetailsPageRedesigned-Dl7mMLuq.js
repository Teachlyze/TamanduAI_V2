import{j as e,r as m,t as le,u as de,s as c,l as R,p as ne}from"./main-CQL62Pt9.js";import{B as _}from"./button-CXd9Ydu2.js";import{C as y}from"./card-CeKCmDnl.js";import{T as oe}from"./textarea-CfrhvR3N.js";import{D as ce,a as me,b as xe,c as be,d as ue,e as he}from"./dialog-B9c0IAUh.js";import{R as ge,a as pe}from"./radio-group-BSIIb3nr.js";import{C as fe}from"./checkbox-CJNQ-LTf.js";import{L}from"./label-C6FIu0Ui.js";import{c as g}from"./utils-i_gXi2Wi.js";import{C as Q}from"./circle-alert-CH6dYqHM.js";import{C as W}from"./circle-check-big-DSidtrtL.js";import{S as z}from"./send-BaqO2JPh.js";import{C as je}from"./clock-sqyMS1RB.js";import{A as J}from"./SidebarPremium--x3DStDs.js";import{U as ve}from"./users-BtfqzUVv.js";import{T as Ne}from"./trending-up-CC7Upw_D.js";import{u as ke}from"./use-toast-Djw8A-a9.js";import{A as we}from"./arrow-left-wPKKrOj9.js";import{C as ye}from"./index-zZOcwNkD.js";import{F as B}from"./file-text-0rRUQINA.js";import{S as Ce}from"./save-sETwFI3G.js";import{d as G}from"./differenceInHours-DzWJNcba.js";import{f as D}from"./format-BcFT9btV.js";import{i as Se}from"./isPast-CeQjbKRK.js";import{p as E}from"./pt-BR-CuGSKEGQ.js";import"./index-DFnaGz4y.js";import"./x-Q__6dFVj.js";import"./index-DINBhsjz.js";import"./check-sjd9Yckd.js";import"./bell-CU7gBYYE.js";import"./chevron-right-CC_eXMfz.js";import"./user-DAj5MP6f.js";import"./settings-Dvldtua5.js";import"./house-Dxla3ep4.js";import"./graduation-cap-BjoHLR7H.js";import"./chart-column-BKLyUAC0.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-B6HbAA6N.js";const I={pending:{label:"Pendente",icon:je,bg:"bg-amber-100 dark:bg-amber-900/30",text:"text-amber-700 dark:text-amber-400",border:"border-amber-300 dark:border-amber-700",emoji:"üü°"},submitted:{label:"Enviada",icon:z,bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-700 dark:text-blue-400",border:"border-blue-300 dark:border-blue-700",emoji:"üîµ"},graded:{label:"Corrigida",icon:W,bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-400",border:"border-green-300 dark:border-green-700",emoji:"üü¢"},late:{label:"Atrasada",icon:Q,bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-400",border:"border-red-300 dark:border-red-700",emoji:"üî¥"}},_e={sm:{container:"px-2 py-0.5 text-xs gap-1",icon:"w-3 h-3"},md:{container:"px-3 py-1 text-sm gap-1.5",icon:"w-4 h-4"},lg:{container:"px-4 py-2 text-base gap-2",icon:"w-5 h-5"}},K=({status:i="pending",size:p="md",score:d,className:C,showEmoji:b=!0})=>{const n=I[i]||I.pending,j=_e[p],s=n.icon;return e.jsxs("div",{className:g("inline-flex items-center rounded-full font-semibold border-2 transition-all",n.bg,n.text,n.border,j.container,C),children:[b&&e.jsx("span",{children:n.emoji}),e.jsx(s,{className:j.icon}),e.jsx("span",{children:n.label}),i==="graded"&&d!==void 0&&e.jsxs("span",{className:"ml-1 font-bold",children:["‚Ä¢ ",d,"/100"]})]})},X=m.memo(({studentGrade:i,classAverage:p,maxGrade:d=100,className:C})=>{const b=i/d*100,n=p/d*100,s=(o=>o>=90?"bg-green-500":o>=70?"bg-blue-500":o>=60?"bg-yellow-500":"bg-red-500")(b),F="bg-slate-400",r=i-p,u=r>0;return e.jsxs("div",{className:g("space-y-4",C),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 p-4 rounded-xl border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Sua Nota"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-700 dark:text-blue-400",children:i.toFixed(1)}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:["de ",d," pontos"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 p-4 rounded-xl border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ve,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"M√©dia da Turma"})]}),e.jsx("p",{className:"text-3xl font-bold text-slate-700 dark:text-slate-400",children:p.toFixed(1)}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:["de ",d," pontos"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Comparativo Visual"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"Voc√™"}),e.jsxs("span",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:[b.toFixed(0),"%"]})]}),e.jsx("div",{className:"h-8 bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden relative",children:e.jsx("div",{className:g("h-full rounded-full transition-all duration-1000 ease-out",s,"flex items-center justify-end pr-3"),style:{width:`${b}%`},children:e.jsx("span",{className:"text-xs font-bold text-white drop-shadow-lg",children:i})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"Turma"}),e.jsxs("span",{className:"text-xs font-bold text-slate-600 dark:text-slate-400",children:[n.toFixed(0),"%"]})]}),e.jsx("div",{className:"h-6 bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden relative",children:e.jsx("div",{className:g("h-full rounded-full transition-all duration-1000 ease-out",F,"flex items-center justify-end pr-3"),style:{width:`${n}%`},children:e.jsx("span",{className:"text-xs font-bold text-white drop-shadow-lg",children:p.toFixed(1)})})})]})]}),e.jsx("div",{className:g("p-4 rounded-xl border-2",u?"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-950/20 border-amber-200 dark:border-amber-800"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg",u?"bg-green-100 dark:bg-green-900/30":"bg-amber-100 dark:bg-amber-900/30"),children:e.jsx(Ne,{className:g("w-5 h-5",u?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400",!u&&"rotate-180")})}),e.jsxs("div",{children:[e.jsx("p",{className:g("text-sm font-semibold",u?"text-green-700 dark:text-green-400":"text-amber-700 dark:text-amber-400"),children:u?e.jsxs(e.Fragment,{children:["Voc√™ est√° ",Math.abs(r).toFixed(1)," pontos acima da m√©dia! üéâ"]}):r===0?e.jsx(e.Fragment,{children:"Voc√™ est√° na m√©dia da turma"}):e.jsxs(e.Fragment,{children:["Voc√™ est√° ",Math.abs(r).toFixed(1)," pontos abaixo da m√©dia"]})}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-0.5",children:u?"Parab√©ns! Continue assim!":"Continue se esfor√ßando, voc√™ consegue!"})]})]})}),e.jsx("div",{className:"flex items-center justify-center gap-1 pt-2",children:[...Array(5)].map((o,S)=>{const P=(S+1)*20,$=b>=P;return e.jsx("span",{className:g("text-2xl transition-all duration-300",$?"opacity-100 scale-110":"opacity-30 scale-100"),children:"‚≠ê"},S)})})]})});X.displayName="GradeChart";const bs=()=>{const{activityId:i}=le(),p=de(),{toast:d}=ke(),[C,b]=m.useState(!0),[n,j]=m.useState(!1),[s,F]=m.useState(null),[r,u]=m.useState(null),[o,S]=m.useState(""),[P,$]=m.useState([]),[Y,A]=m.useState(!1),[v,H]=m.useState({}),[U,Z]=m.useState(null);m.useEffect(()=>{O()},[i]);const O=async()=>{try{b(!0);const{data:t}=await c.auth.getUser(),{data:a,error:l}=await c.from("activities").select("*").eq("id",i).single();if(l)throw l;const{data:x}=await c.from("activity_class_assignments").select("class_id").eq("activity_id",i).single();let N=null;if(x){const{data:w}=await c.from("classes").select("id, name, color").eq("id",x.class_id).single();N=w}const{data:k}=await c.from("submissions").select("*").eq("activity_id",i).eq("student_id",t.user.id).single();if(k?.status==="graded"){const{data:w}=await c.from("submissions").select("grade").eq("activity_id",i).eq("status","graded").not("grade","is",null);if(w&&w.length>0){const q=w.map(M=>parseFloat(M.grade)),ae=q.reduce((M,ie)=>M+ie,0)/q.length,re=Math.max(...q);Z({average:ae,maxGrade:re,totalSubmissions:w.length})}}const T={...a,class_name:N?.name,class_color:N?.color,class_id:N?.id};F(T),u(k),S(k?.content?.answer||"")}catch(t){R.error("Erro ao carregar atividade:",t),d({title:"‚ùå Erro ao carregar",description:t.message,variant:"destructive"})}finally{b(!1)}},ee=async()=>{try{const{data:t}=await c.auth.getUser(),a={activity_id:i,student_id:t.user.id,content:{answer:o},status:"draft"};r?await c.from("submissions").update(a).eq("id",r.id):await c.from("submissions").insert(a),d({title:"‚úì Rascunho salvo",description:"Suas altera√ß√µes foram salvas"})}catch(t){R.error("Erro ao salvar rascunho:",t),d({title:"‚ùå Erro ao salvar",description:t.message,variant:"destructive"})}},se=async()=>{if(!o.trim()){d({title:"‚ö†Ô∏è Resposta vazia",description:"Digite sua resposta antes de enviar",variant:"destructive"});return}A(!0)},te=async()=>{A(!1);try{j(!0);let t={answer:o};(s?.type==="quiz"||s?.type==="multiple_choice")&&(t.selectedAnswers=v);const{data:a}=await c.auth.getUser(),l={activity_id:i,student_id:a.user.id,content:t,status:"submitted",submitted_at:new Date().toISOString()};r?await c.from("submissions").update(l).eq("id",r.id):await c.from("submissions").insert(l),d({title:"‚úì Atividade enviada!",description:"Aguarde a corre√ß√£o do professor"}),O()}catch(t){R.error("Erro ao enviar:",t),d({title:"‚ùå Erro ao enviar",description:t.message,variant:"destructive"})}finally{j(!1)}},f=s?r?.status==="graded"?"graded":r?.status==="submitted"?"submitted":s?.due_date&&Se(new Date(s.due_date))?"late":"pending":"pending",h=s?.due_date?new Date(s.due_date):null,V=h&&G(h,new Date)<24&&f==="pending";return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ne,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 p-8 shadow-xl",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs(_,{variant:"ghost",onClick:()=>p(-1),className:"text-white hover:bg-white/20 mb-4",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Voltar √† Turma"]}),e.jsx("div",{className:"flex items-start justify-between flex-wrap gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:s?.title}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(K,{status:f,size:"lg",score:r?.grade}),h&&e.jsxs("div",{className:"flex items-center gap-2 text-white/90",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Prazo: ",D(h,"dd/MM/yyyy '√†s' HH:mm",{locale:E})]})]})]})]})}),V&&e.jsx("div",{className:"mt-4 bg-red-500 text-white px-4 py-2 rounded-lg animate-pulse",children:"‚è∞ ATEN√á√ÉO: Menos de 24 horas para o prazo!"})]})}),e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(y,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-blue-600"}),"Descri√ß√£o"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:s?.description||"Sem descri√ß√£o"}})]}),s?.content?.rubric&&e.jsxs(y,{className:"p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-blue-600"}),"Crit√©rios de Avalia√ß√£o"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-sm",children:s.content.rubric})]}),(s?.type==="quiz"||s?.type==="multiple_choice")&&s?.content?.questions&&f!=="graded"&&e.jsxs(y,{className:"p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-blue-600"}),"Quest√µes"]}),s.content.questions.map((t,a)=>e.jsxs("div",{className:"mb-6 p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold mb-3",children:[a+1,". ",t.question]}),t.type==="multiple_choice"&&e.jsx(ge,{value:v[a],onValueChange:l=>H({...v,[a]:l}),children:t.options?.map((l,x)=>e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(pe,{value:l,id:`q${a}-${x}`}),e.jsx(L,{htmlFor:`q${a}-${x}`,children:l})]},x))}),t.type==="checkbox"&&e.jsx("div",{className:"space-y-2",children:t.options?.map((l,x)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{id:`q${a}-${x}`,checked:v[a]?.includes(l),onCheckedChange:N=>{const k=v[a]||[];H({...v,[a]:N?[...k,l]:k.filter(T=>T!==l)})}}),e.jsx(L,{htmlFor:`q${a}-${x}`,children:l})]},x))})]},a))]}),f!=="graded"&&e.jsxs(y,{className:"p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-green-600"}),f==="submitted"?"Sua Resposta (Enviada)":"Sua Resposta"]}),f==="submitted"?e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400 mb-2",children:["‚úì Atividade enviada em ",D(new Date(r.submitted_at),"dd/MM/yyyy '√†s' HH:mm",{locale:E})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:o})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{value:o,onChange:t=>S(t.target.value),placeholder:"Digite sua resposta aqui...",rows:10,className:"mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(_,{variant:"outline",onClick:ee,disabled:!o.trim(),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Salvar Rascunho"]}),e.jsxs(_,{onClick:se,disabled:!o.trim()||n,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),n?"Enviando...":"Enviar Atividade"]})]})]})]}),f==="graded"&&e.jsxs(y,{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold flex items-center gap-2",children:"üéØ RESULTADO"}),s?.class_name&&e.jsx("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900 rounded-full",children:e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:s.class_name})})]}),U&&e.jsx(X,{studentGrade:r.grade,classAverage:U.average,maxGrade:s.max_score||100,className:"mb-6"}),r.feedback&&e.jsxs("div",{className:"mt-6 p-4 bg-white dark:bg-slate-900 rounded-xl border-2 border-slate-200 dark:border-slate-700",children:[e.jsx("h4",{className:"font-bold mb-2 flex items-center gap-2",children:"üí¨ FEEDBACK DO PROFESSOR"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:r.feedback})]}),e.jsxs("div",{className:"mt-6 p-4 bg-white dark:bg-slate-900 rounded-xl border-2 border-slate-200 dark:border-slate-700",children:[e.jsx("h4",{className:"font-bold mb-2",children:"üìù SUA RESPOSTA"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:o})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(y,{className:"p-6 sticky top-6",children:[e.jsx("h3",{className:"font-bold mb-4 flex items-center gap-2",children:"üìã Informa√ß√µes"}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Prazo de Entrega"}),e.jsx("p",{className:"font-semibold text-lg",children:D(h,"dd/MM/yyyy",{locale:E})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:D(h,"HH:mm",{locale:E})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Nota M√°xima"}),e.jsxs("p",{className:"font-semibold text-2xl text-blue-600",children:[s?.max_score||100," pontos"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-2",children:"Status Atual"}),e.jsx(K,{status:f,size:"md",score:r?.grade})]}),s?.class_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Turma"}),e.jsx("p",{className:"font-semibold",children:s.class_name})]})]}),V&&h&&e.jsx("div",{className:"mt-6 p-4 bg-red-50 dark:bg-red-950/20 border-2 border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:["‚è∞ ",Math.floor(G(h,new Date))," horas restantes!"]})})]})})]})}),e.jsx(ce,{open:Y,onOpenChange:A,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-6 h-6 text-orange-600"}),"Confirmar Envio"]}),e.jsxs(ue,{children:["Tem certeza que deseja enviar esta atividade?",e.jsx("br",{}),e.jsx("strong",{children:"Voc√™ n√£o poder√° editar depois do envio."})]})]}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"‚ÑπÔ∏è Ap√≥s o envio, o professor ser√° notificado e poder√° avaliar sua atividade."})})}),e.jsxs(he,{children:[e.jsx(_,{variant:"outline",onClick:()=>A(!1),children:"Cancelar"}),e.jsxs(_,{onClick:te,className:"bg-green-600 hover:bg-green-700",disabled:n,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),n?"Enviando...":"Confirmar Envio"]})]})]})})]})};export{bs as default};
