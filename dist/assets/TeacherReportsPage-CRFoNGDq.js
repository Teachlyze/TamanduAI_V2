import{c as se,r as o,d as pe,f as gt,s as E,j as s,a as bt,l as M}from"./main-BSMlxxlZ.js";import{C as V}from"./card-DMraIbJz.js";import{B as R,m as yt}from"./button-CKV5JkoH.js";import{h as Me}from"./SidebarPremium-Bf98hnme.js";import{L as oe}from"./label-BUfKwcD5.js";import{T as xt,a as jt,b as Be,c as Fe}from"./tabs-COryJLg7.js";import{S as le,a as ce,b as de,c as ue,d as z}from"./select-Y5bYU8BP.js";import{D as wt}from"./DashboardHeader-D4CeRMFl.js";import"./input-D5v1eFNU.js";import"./dropdown-menu-CuQbPzbo.js";import{u as rt}from"./use-toast-DU85wOBR.js";import{D as Pt}from"./download-BxwFDvRG.js";import{S as Et}from"./share-2-Dn6u-T5M.js";import{X as st}from"./x-rSiybgWV.js";import{a as it,S as At,u as he,s as Nt,i as we,b as St,c as Ot,d as kt,e as Ct,f as Rt,g as Oe,h as _t,j as ze,k as Tt,l as _,p as ie,m as Dt,n as $t,o as J,q as Lt,r as It,t as nt,v as Mt,w as Bt,x as W,y as Ft,z as zt,A as Gt,B as qt,C as ot,D as Kt,E as Vt,F as Ut,G as Wt,H as Ht,I as Jt,J as lt,K as Zt,L as ke,M as ct,R as Xt,N as Yt,O as Qt,P as dt,Q as ea,T as te,U as ta,V as aa,W as ra,X as sa,Y as Ge,Z as me,_ as Pe,$ as ia,a0 as na,a1 as oa,a2 as la,a3 as ca,a4 as da,a5 as re,a6 as qe,a7 as ua,a8 as ma,a9 as pa,aa as ha,ab as fa,ac as va,ad as ga,ae as ba,af as ya,ag as ye,ah as xe,ai as xa,aj as Ke,ak as Ve,al as Ue,am as ja}from"./LineChart-D48X98-n.js";import{S as wa,C as Ce,u as Pa,a as Ea,b as Aa,c as Na,B as Sa,d as Oa}from"./BarChart--dZ3Fcds.js";import{H as We}from"./history-BYJqLYBP.js";import{S as ka}from"./settings-Ce4vc5Vl.js";import{P as je}from"./plus-v2nik42B.js";import{F as Ca}from"./funnel-DHANno4o.js";import{U as Ra}from"./user-C2we2FXy.js";import{U as _a}from"./users-BNOTPuIE.js";import{C as Ta}from"./clipboard-list-Cixm1l63.js";import{F as Ee}from"./file-text-BP6UKDNn.js";import{S as Da}from"./star-DKU9KxO3.js";import{E as $a}from"./eye-CDqlTRJI.js";import"./bell-C38I9ebQ.js";import"./chevron-right-D_FKfY1S.js";import"./trending-up-6aD5U3kC.js";import"./house-BiazGQzC.js";import"./graduation-cap-CzbYlLlS.js";import"./index-CpTBUXYw.js";import"./chart-column-CNsjJ5jU.js";import"./index-Cwkg_cGm.js";import"./index-BwDK55Mp.js";import"./index-CB9Ufca0.js";import"./index-DrqYlGSU.js";import"./index-CtuxL-Fj.js";import"./chevron-down-Bk5F_mLz.js";import"./check-iGKxEgx2.js";import"./chevron-up-C0F5446Y.js";import"./index-D6vFAzWj.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],Ia=se("chart-no-axes-column-increasing",La);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Ba=se("file-image",Ma);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],za=se("file-spreadsheet",Fa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],qa=se("git-compare",Ga);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],Va=se("printer",Ka);function Ae(){return Ae=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},Ae.apply(null,arguments)}function He(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function Ua(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?He(Object(a),!0).forEach(function(r){Re(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):He(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Re(t,e,a){return(e=Wa(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Wa(t){var e=Ha(t,"string");return typeof e=="symbol"?e:e+""}function Ha(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var L=32;class _e extends o.PureComponent{renderIcon(e,a){var{inactiveColor:r}=this.props,i=L/2,n=L/6,d=L/3,l=e.inactive?r:e.color,p=a??e.type;if(p==="none")return null;if(p==="plainline")return o.createElement("line",{strokeWidth:4,fill:"none",stroke:l,strokeDasharray:e.payload.strokeDasharray,x1:0,y1:i,x2:L,y2:i,className:"recharts-legend-icon"});if(p==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:l,d:"M0,".concat(i,"h").concat(d,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(2*d,",").concat(i,`
            H`).concat(L,"M").concat(2*d,",").concat(i,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(d,",").concat(i),className:"recharts-legend-icon"});if(p==="rect")return o.createElement("path",{stroke:"none",fill:l,d:"M0,".concat(L/8,"h").concat(L,"v").concat(L*3/4,"h").concat(-L,"z"),className:"recharts-legend-icon"});if(o.isValidElement(e.legendIcon)){var f=Ua({},e);return delete f.legendIcon,o.cloneElement(e.legendIcon,f)}return o.createElement(wa,{fill:l,cx:i,cy:i,size:L,sizeType:"diameter",type:p})}renderItems(){var{payload:e,iconSize:a,layout:r,formatter:i,inactiveColor:n,iconType:d}=this.props,l={x:0,y:0,width:L,height:L},p={display:r==="horizontal"?"inline-block":"block",marginRight:10},f={display:"inline-block",verticalAlign:"middle",marginRight:4};return e.map((m,g)=>{var u=m.formatter||i,h=pe({"recharts-legend-item":!0,["legend-item-".concat(g)]:!0,inactive:m.inactive});if(m.type==="none")return null;var v=m.inactive?n:m.color,j=u?u(m.value,m,g):m.value;return o.createElement("li",Ae({className:h,style:p,key:"legend-item-".concat(g)},it(this.props,m,g)),o.createElement(At,{width:a,height:a,viewBox:l,style:f,"aria-label":"".concat(j," legend icon")},this.renderIcon(m,d)),o.createElement("span",{className:"recharts-legend-item-text",style:{color:v}},j))})}render(){var{payload:e,layout:a,align:r}=this.props;if(!e||!e.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?r:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}Re(_e,"displayName","Legend");Re(_e,"defaultProps",{align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"});function Ja(){return he(Nt)}var Za=["contextPayload"];function Ne(){return Ne=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},Ne.apply(null,arguments)}function Je(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function ae(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Je(Object(a),!0).forEach(function(r){Te(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Je(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Te(t,e,a){return(e=Xa(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Xa(t){var e=Ya(t,"string");return typeof e=="symbol"?e:e+""}function Ya(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Qa(t,e){if(t==null)return{};var a,r,i=er(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function er(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function tr(t){return t.value}function ar(t){var{contextPayload:e}=t,a=Qa(t,Za),r=Tt(e,t.payloadUniqBy,tr),i=ae(ae({},a),{},{payload:r});return o.isValidElement(t.content)?o.cloneElement(t.content,i):typeof t.content=="function"?o.createElement(t.content,i):o.createElement(_e,i)}function rr(t,e,a,r,i,n){var{layout:d,align:l,verticalAlign:p}=e,f,m;return(!t||(t.left===void 0||t.left===null)&&(t.right===void 0||t.right===null))&&(l==="center"&&d==="vertical"?f={left:((r||0)-n.width)/2}:f=l==="right"?{right:a&&a.right||0}:{left:a&&a.left||0}),(!t||(t.top===void 0||t.top===null)&&(t.bottom===void 0||t.bottom===null))&&(p==="middle"?m={top:((i||0)-n.height)/2}:m=p==="bottom"?{bottom:a&&a.bottom||0}:{top:a&&a.top||0}),ae(ae({},f),m)}function sr(t){var e=Oe();return o.useEffect(()=>{e(_t(t))},[e,t]),null}function ir(t){var e=Oe();return o.useEffect(()=>(e(ze(t)),()=>{e(ze({width:0,height:0}))}),[e,t]),null}function nr(t){var e=Ja(),a=St(),r=Ot(),{width:i,height:n,wrapperStyle:d,portal:l}=t,[p,f]=kt([e]),m=Ct(),g=Rt();if(m==null||g==null)return null;var u=m-(r.left||0)-(r.right||0),h=ee.getWidthOrHeight(t.layout,n,i,u),v=l?d:ae(ae({position:"absolute",width:h?.width||i||"auto",height:h?.height||n||"auto"},rr(d,t,r,m,g,p)),d),j=l??a;if(j==null)return null;var S=o.createElement("div",{className:"recharts-legend-wrapper",style:v,ref:f},o.createElement(sr,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),o.createElement(ir,{width:p.width,height:p.height}),o.createElement(ar,Ne({},t,h,{margin:r,chartWidth:m,chartHeight:g,contextPayload:e})));return gt.createPortal(S,j)}class ee extends o.PureComponent{static getWidthOrHeight(e,a,r,i){return e==="vertical"&&we(a)?{height:a}:e==="horizontal"?{width:r||i}:null}render(){return o.createElement(nr,this.props)}}Te(ee,"displayName","Legend");Te(ee,"defaultProps",{align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"});var ut=t=>t.graphicalItems.polarItems,or=_([ie,Dt],$t),fe=_([ut,J,or],Lt),lr=_([fe],It),ve=_([lr,nt],Mt),cr=_([ve,J,fe],Bt);_([ve,J,fe],(t,e,a)=>a.length>0?t.flatMap(r=>a.flatMap(i=>{var n,d=W(r,(n=e.dataKey)!==null&&n!==void 0?n:i.dataKey);return{value:d,errorDomain:[]}})).filter(Boolean):e?.dataKey!=null?t.map(r=>({value:W(r,e.dataKey),errorDomain:[]})):t.map(r=>({value:r,errorDomain:[]})));var Ze=()=>{},dr=_([ve,J,fe,Ft,ie],zt),ur=_([J,Gt,qt,Ze,dr,Ze,ot,ie],Kt),mt=_([J,ot,ve,cr,Vt,ie,ur],Ut),mr=_([mt,J,Wt],Ht);_([J,mt,mr,ie],Jt);function Xe(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function Ye(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Xe(Object(a),!0).forEach(function(r){pr(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Xe(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function pr(t,e,a){return(e=hr(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function hr(t){var e=fr(t,"string");return typeof e=="symbol"?e:e+""}function fr(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var vr=(t,e)=>e,De=_([ut,vr],(t,e)=>t.filter(a=>a.type==="pie").find(a=>a.id===e)),gr=[],$e=(t,e,a)=>a?.length===0?gr:a,pt=_([nt,De,$e],(t,e,a)=>{var{chartData:r}=t;if(e!=null){var i;if(e?.data!=null&&e.data.length>0?i=e.data:i=r,(!i||!i.length)&&a!=null&&(i=a.map(n=>Ye(Ye({},e.presentationProps),n.props))),i!=null)return i}}),br=_([pt,De,$e],(t,e,a)=>{if(!(t==null||e==null))return t.map((r,i)=>{var n,d=W(r,e.nameKey,e.name),l;return a!=null&&(n=a[i])!==null&&n!==void 0&&(n=n.props)!==null&&n!==void 0&&n.fill?l=a[i].props.fill:typeof r=="object"&&r!=null&&"fill"in r?l=r.fill:l=e.fill,{value:lt(d,e.dataKey),color:l,payload:r,type:e.legendType}})}),yr=_([pt,De,$e,Zt],(t,e,a,r)=>{if(!(e==null||t==null))return Br({offset:r,pieSettings:e,displayedData:t,cells:a})}),xr=["onMouseEnter","onClick","onMouseLeave"],jr=["id"],wr=["id"];function Le(t,e){if(t==null)return{};var a,r,i=Pr(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function Pr(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function Qe(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function P(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Qe(Object(a),!0).forEach(function(r){Er(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Qe(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Er(t,e,a){return(e=Ar(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Ar(t){var e=Nr(t,"string");return typeof e=="symbol"?e:e+""}function Nr(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function H(){return H=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},H.apply(null,arguments)}function Sr(t){var e=o.useMemo(()=>dt(t.children,Ce),[t.children]),a=he(r=>br(r,t.id,e));return a==null?null:o.createElement(ea,{legendPayload:a})}function Or(t){var{dataKey:e,nameKey:a,sectors:r,stroke:i,strokeWidth:n,fill:d,name:l,hide:p,tooltipType:f}=t;return{dataDefinedOnItem:r.map(m=>m.tooltipPayload),positions:r.map(m=>m.tooltipPosition),settings:{stroke:i,strokeWidth:n,fill:d,dataKey:e,nameKey:a,name:lt(l,e),hide:p,type:f,color:d,unit:""}}}var kr=(t,e)=>t>e?"start":t<e?"end":"middle",Cr=(t,e,a)=>typeof e=="function"?re(e(t),a,a*.8):re(e,a,a*.8),Rr=(t,e,a)=>{var{top:r,left:i,width:n,height:d}=e,l=da(n,d),p=i+re(t.cx,n,n/2),f=r+re(t.cy,d,d/2),m=re(t.innerRadius,l,0),g=Cr(a,t.outerRadius,l),u=t.maxRadius||Math.sqrt(n*n+d*d)/2;return{cx:p,cy:f,innerRadius:m,outerRadius:g,maxRadius:u}},_r=(t,e)=>{var a=me(e-t),r=Math.min(Math.abs(e-t),360);return a*r};function Tr(t){return t&&typeof t=="object"&&"className"in t&&typeof t.className=="string"?t.className:""}var Dr=(t,e)=>{if(o.isValidElement(t))return o.cloneElement(t,e);if(typeof t=="function")return t(e);var a=pe("recharts-pie-label-line",typeof t!="boolean"?t.className:"");return o.createElement(ua,H({},e,{type:"linear",className:a}))},$r=(t,e,a)=>{if(o.isValidElement(t))return o.cloneElement(t,e);var r=a;if(typeof t=="function"&&(r=t(e),o.isValidElement(r)))return r;var i=pe("recharts-pie-label-text",Tr(t));return o.createElement(ma,H({},e,{alignmentBaseline:"middle",className:i}),r)};function Lr(t){var{sectors:e,props:a,showLabels:r}=t,{label:i,labelLine:n,dataKey:d}=a;if(!r||!i||!e)return null;var l=ct(a),p=qe(i),f=qe(n),m=typeof i=="object"&&"offsetRadius"in i&&typeof i.offsetRadius=="number"&&i.offsetRadius||20,g=e.map((u,h)=>{var v=(u.startAngle+u.endAngle)/2,j=Pe(u.cx,u.cy,u.outerRadius+m,v),S=P(P(P(P({},l),u),{},{stroke:"none"},p),{},{index:h,textAnchor:kr(j.x,u.cx)},j),B=P(P(P(P({},l),u),{},{fill:"none",stroke:u.fill},f),{},{index:h,points:[Pe(u.cx,u.cy,u.outerRadius,v),j],key:"line"});return o.createElement(te,{key:"label-".concat(u.startAngle,"-").concat(u.endAngle,"-").concat(u.midAngle,"-").concat(h)},n&&Dr(n,B),$r(i,S,W(u,d)))});return o.createElement(te,{className:"recharts-pie-labels"},g)}function Ir(t){var{sectors:e,props:a,showLabels:r}=t,{label:i}=a;return typeof i=="object"&&i!=null&&"position"in i?o.createElement(ca,{label:i}):o.createElement(Lr,{sectors:e,props:a,showLabels:r})}function Mr(t){var{sectors:e,activeShape:a,inactiveShape:r,allOtherPieProps:i}=t,n=he(na),{onMouseEnter:d,onClick:l,onMouseLeave:p}=i,f=Le(i,xr),m=Pa(d,i.dataKey),g=Ea(p),u=Aa(l,i.dataKey);return e==null||e.length===0?null:o.createElement(o.Fragment,null,e.map((h,v)=>{if(h?.startAngle===0&&h?.endAngle===0&&e.length!==1)return null;var j=a&&String(v)===n,S=n?r:null,B=j?a:S,C=P(P({},h),{},{stroke:h.stroke,tabIndex:-1,[la]:v,[oa]:i.dataKey});return o.createElement(te,H({key:"sector-".concat(h?.startAngle,"-").concat(h?.endAngle,"-").concat(h.midAngle,"-").concat(v),tabIndex:-1,className:"recharts-pie-sector"},it(f,h,v),{onMouseEnter:m(h,v),onMouseLeave:g(h,v),onClick:u(h,v)}),o.createElement(Na,H({option:B,isActive:j,shapeType:"sector"},C)))}))}function Br(t){var e,{pieSettings:a,displayedData:r,cells:i,offset:n}=t,{cornerRadius:d,startAngle:l,endAngle:p,dataKey:f,nameKey:m,tooltipType:g}=a,u=Math.abs(a.minAngle),h=_r(l,p),v=Math.abs(h),j=r.length<=1?0:(e=a.paddingAngle)!==null&&e!==void 0?e:0,S=r.filter(A=>W(A,f,0)!==0).length,B=(v>=360?S:S-1)*j,C=v-S*u-B,T=r.reduce((A,$)=>{var b=W($,f,0);return A+(we(b)?b:0)},0),G;if(T>0){var D;G=r.map((A,$)=>{var b=W(A,f,0),F=W(A,m,$),U=Rr(a,n,A),q=(we(b)?b:0)/T,K,Z=P(P({},A),i&&i[$]&&i[$].props);$?K=D.endAngle+me(h)*j*(b!==0?1:0):K=l;var Y=K+me(h)*((b!==0?u:0)+q*C),X=(K+Y)/2,ne=(U.innerRadius+U.outerRadius)/2,ge=[{name:F,value:b,payload:Z,dataKey:f,type:g}],be=Pe(U.cx,U.cy,ne,X);return D=P(P(P(P({},a.presentationProps),{},{percent:q,cornerRadius:d,name:F,tooltipPayload:ge,midAngle:X,middleRadius:ne,tooltipPosition:be},Z),U),{},{value:b,startAngle:K,endAngle:Y,payload:Z,paddingAngle:me(h)*j}),D})}return G}function Fr(t){var{showLabels:e,sectors:a,children:r}=t,i=o.useMemo(()=>!e||!a?[]:a.map(n=>({value:n.value,payload:n.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:n.cx,cy:n.cy,innerRadius:n.innerRadius,outerRadius:n.outerRadius,startAngle:n.startAngle,endAngle:n.endAngle,clockWise:!1},fill:n.fill})),[a,e]);return o.createElement(ia,{value:e?i:void 0},r)}function zr(t){var{props:e,previousSectorsRef:a}=t,{sectors:r,isAnimationActive:i,animationBegin:n,animationDuration:d,animationEasing:l,activeShape:p,inactiveShape:f,onAnimationStart:m,onAnimationEnd:g}=e,u=aa(e,"recharts-pie-"),h=a.current,[v,j]=o.useState(!1),S=o.useCallback(()=>{typeof g=="function"&&g(),j(!1)},[g]),B=o.useCallback(()=>{typeof m=="function"&&m(),j(!0)},[m]);return o.createElement(Fr,{showLabels:!v,sectors:r},o.createElement(ra,{animationId:u,begin:n,duration:d,isActive:i,easing:l,onAnimationStart:B,onAnimationEnd:S,key:u},C=>{var T=[],G=r&&r[0],D=G?.startAngle;return r?.forEach((A,$)=>{var b=h&&h[$],F=$>0?sa(A,"paddingAngle",0):0;if(b){var U=Ge(b.endAngle-b.startAngle,A.endAngle-A.startAngle,C),q=P(P({},A),{},{startAngle:D+F,endAngle:D+U+F});T.push(q),D=q.endAngle}else{var{endAngle:K,startAngle:Z}=A,Y=Ge(0,K-Z,C),X=P(P({},A),{},{startAngle:D+F,endAngle:D+Y+F});T.push(X),D=X.endAngle}}),a.current=T,o.createElement(te,null,o.createElement(Mr,{sectors:T,activeShape:p,inactiveShape:f,allOtherPieProps:e}))}),o.createElement(Ir,{showLabels:!v,sectors:r,props:e}),e.children)}var Gr={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!Qt.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff"};function qr(t){var{id:e}=t,a=Le(t,jr),{hide:r,className:i,rootTabIndex:n}=t,d=o.useMemo(()=>dt(t.children,Ce),[t.children]),l=he(m=>yr(m,e,d)),p=o.useRef(null),f=pe("recharts-pie",i);return r||l==null?(p.current=null,o.createElement(te,{tabIndex:n,className:f})):o.createElement(o.Fragment,null,o.createElement(ta,{fn:Or,args:P(P({},t),{},{sectors:l})}),o.createElement(te,{tabIndex:n,className:f},o.createElement(zr,{props:P(P({},a),{},{sectors:l}),previousSectorsRef:p})))}function ht(t){var e=ke(t,Gr),{id:a}=e,r=Le(e,wr),i=ct(r);return o.createElement(Xt,{id:a,type:"pie"},n=>o.createElement(o.Fragment,null,o.createElement(Yt,{type:"pie",id:n,data:r.data,dataKey:r.dataKey,hide:r.hide,angleAxisId:0,radiusAxisId:0,name:r.name,nameKey:r.nameKey,tooltipType:r.tooltipType,legendType:r.legendType,fill:r.fill,cx:r.cx,cy:r.cy,startAngle:r.startAngle,endAngle:r.endAngle,paddingAngle:r.paddingAngle,minAngle:r.minAngle,innerRadius:r.innerRadius,outerRadius:r.outerRadius,cornerRadius:r.cornerRadius,presentationProps:i,maxRadius:e.maxRadius}),o.createElement(Sr,H({},r,{id:n})),o.createElement(qr,H({},r,{id:n}))))}ht.displayName="Pie";function Kr(t){var e=Oe();return o.useEffect(()=>{e(pa(t))},[e,t]),null}var Vr=["layout"];function Se(){return Se=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},Se.apply(null,arguments)}function Ur(t,e){if(t==null)return{};var a,r,i=Wr(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function Wr(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}var Hr={top:5,right:5,bottom:5,left:5},Jr={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:Hr,reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1},Zr=o.forwardRef(function(e,a){var r,i=ke(e.categoricalChartProps,Jr),{layout:n}=i,d=Ur(i,Vr),{chartName:l,defaultTooltipEventType:p,validateTooltipEventTypes:f,tooltipPayloadSearcher:m}=e,g={chartName:l,defaultTooltipEventType:p,validateTooltipEventTypes:f,tooltipPayloadSearcher:m,eventEmitter:void 0};return o.createElement(ha,{preloadedState:{options:g},reduxStoreName:(r=i.id)!==null&&r!==void 0?r:l},o.createElement(fa,{chartData:i.data}),o.createElement(va,{layout:n,margin:i.margin}),o.createElement(ga,{accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),o.createElement(Kr,{cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius}),o.createElement(ba,Se({},d,{ref:a})))}),Xr=["item"],Yr={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},Qr=o.forwardRef((t,e)=>{var a=ke(t,Yr);return o.createElement(Zr,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:Xr,tooltipPayloadSearcher:ya,categoricalChartProps:a,ref:e})});class es{async generateStudentReport(e,a=30){const r=new Date;r.setDate(r.getDate()-a);const{data:i}=await E.from("profiles").select("full_name, email").eq("id",e).single(),{data:n}=await E.from("class_members").select("class:classes(id, name, subject)").eq("user_id",e).eq("role","student"),{data:d}=await E.from("submissions").select(`
        grade,
        submitted_at,
        activity:activities(title, max_score, type)
      `).eq("student_id",e).gte("submitted_at",r.toISOString()).not("grade","is",null),l=d?.map(u=>u.grade)||[],p=l.length>0?l.reduce((u,h)=>u+h,0)/l.length:0,f=l.length>0?Math.max(...l):0,m=l.length>0?Math.min(...l):0,g=d?.map(u=>({name:u.activity.title.substring(0,20),value:u.grade}))||[];return{title:`RelatÃ³rio de Desempenho - ${i?.full_name||"Aluno"}`,templateName:"Desempenho Individual (Aluno)",generatedAt:new Date().toISOString(),studentId:e,summary:{totalActivities:d?.length||0,avgGrade:p.toFixed(1),maxGrade:f.toFixed(1),minGrade:m.toFixed(1),totalClasses:n?.length||0},charts:[{title:"Notas por Atividade",type:"bar",data:g},{title:"EvoluÃ§Ã£o do Desempenho",type:"line",data:g}],tables:[{title:"Turmas Inscritas",headers:["Nome","MatÃ©ria"],rows:n?.map(u=>[u.class.name,u.class.subject||"-"])||[]}],details:`RelatÃ³rio gerado para o perÃ­odo de ${a} dias. Total de ${d?.length||0} atividades avaliadas.`}}async generateClassReport(e,a=30){const{data:r}=await E.from("classes").select("name, subject, created_by").eq("id",e).single(),{data:i}=await E.from("class_members").select("user_id, profiles:user_id(full_name)").eq("class_id",e).eq("role","student"),{data:n}=await E.from("activity_class_assignments").select("activity_id, activity:activities(id, title)").eq("class_id",e),d=n?.map(u=>u.activity_id)||[],{data:l}=await E.from("submissions").select("grade, student_id, activity_id").in("activity_id",d).not("grade","is",null),p=l?.map(u=>u.grade)||[],f=p.length>0?p.reduce((u,h)=>u+h,0)/p.length:0,m={"Excelente (90-100)":0,"Bom (70-89)":0,"Regular (50-69)":0,"Insuficiente (0-49)":0};p.forEach(u=>{u>=90?m["Excelente (90-100)"]++:u>=70?m["Bom (70-89)"]++:u>=50?m["Regular (50-69)"]++:m["Insuficiente (0-49)"]++});const g=Object.entries(m).map(([u,h])=>({name:u,value:h}));return{title:`RelatÃ³rio de Turma - ${r?.name||"Turma"}`,templateName:"RelatÃ³rio de Turma",generatedAt:new Date().toISOString(),classId:e,summary:{totalStudents:i?.length||0,totalActivities:n?.length||0,avgGrade:f.toFixed(1),submissionsCount:l?.length||0},charts:[{title:"DistribuiÃ§Ã£o de Notas",type:"pie",data:g}],tables:[{title:"Lista de Alunos",headers:["Nome","SubmissÃµes"],rows:i?.map(u=>{const h=l?.filter(v=>v.student_id===u.user_id).length||0;return[u.profiles.full_name,h]})||[]}],details:`Turma: ${r?.name}
MatÃ©ria: ${r?.subject||"NÃ£o especificada"}
PerÃ­odo: Ãºltimos ${a} dias`}}async generateComparativeReport(e){const{data:a}=await E.from("classes").select("id, name, subject").eq("created_by",e).eq("is_active",!0);a?.map(i=>i.id);const r=await Promise.all(a?.map(async i=>{const{data:n}=await E.from("activity_class_assignments").select("activity_id").eq("class_id",i.id),d=n?.map(m=>m.activity_id)||[],{data:l}=await E.from("submissions").select("grade").in("activity_id",d).not("grade","is",null),p=l?.map(m=>m.grade)||[],f=p.length>0?p.reduce((m,g)=>m+g,0)/p.length:0;return{name:i.name,value:f}})||[]);return{title:"RelatÃ³rio Comparativo de Turmas",templateName:"Comparativo de Desempenho",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,avgGrade:(r.reduce((i,n)=>i+n.value,0)/(r.length||1)).toFixed(1)},charts:[{title:"MÃ©dia por Turma",type:"bar",data:r}],tables:[{title:"Detalhamento por Turma",headers:["Turma","MatÃ©ria","MÃ©dia"],rows:a?.map((i,n)=>[i.name,i.subject||"-",r[n]?.value.toFixed(1)||"0"])||[]}]}}async generateTeacherReport(e){const{data:a}=await E.from("classes").select("id").eq("created_by",e).eq("is_active",!0),{count:r}=await E.from("class_members").select("id",{count:"exact",head:!0}).in("class_id",a?.map(p=>p.id)||[]).eq("role","student"),{data:i}=await E.from("activities").select("id").eq("created_by",e),{data:n}=await E.from("submissions").select("grade").in("activity_id",i?.map(p=>p.id)||[]).not("grade","is",null),d=n?.map(p=>p.grade)||[],l=d.length>0?d.reduce((p,f)=>p+f,0)/d.length:0;return{title:"RelatÃ³rio de Desempenho do Professor",templateName:"Desempenho (Professor)",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,totalStudents:r||0,totalActivities:i?.length||0,avgGrade:l.toFixed(1)},details:"RelatÃ³rio consolidado de todas as turmas e atividades criadas."}}async generateReport(e,a,r={}){switch(e){case"individual-student":return await this.generateStudentReport(a,r.period);case"class-report":return await this.generateClassReport(a,r.period);case"comparative":return await this.generateComparativeReport(a);case"teacher-performance":return await this.generateTeacherReport(a);case"activity-report":return{title:"RelatÃ³rio de Atividade",templateName:"RelatÃ³rio de Atividade",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};case"bulletin":return{title:"Boletim Geral",templateName:"Boletim Geral",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};default:throw new Error("Template de relatÃ³rio nÃ£o encontrado")}}}const ts=new es,et=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],as=({report:t,onClose:e})=>{const{toast:a}=rt();if(!t)return null;const r=(i,n)=>{const d=(l,p=16)=>l?.length>p?l.slice(0,p)+"â€¦":l;switch(i){case"bar":return s.jsx(ye,{width:"100%",height:300,children:s.jsxs(Sa,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Ke,{strokeDasharray:"3 3"}),s.jsx(Ve,{dataKey:"name",tickFormatter:l=>d(l),interval:"preserveEnd"}),s.jsx(Ue,{}),s.jsx(xe,{}),s.jsx(ee,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Oa,{dataKey:"value",fill:"#3B82F6"})]})});case"line":return s.jsx(ye,{width:"100%",height:300,children:s.jsxs(xa,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Ke,{strokeDasharray:"3 3"}),s.jsx(Ve,{dataKey:"name",tickFormatter:l=>d(l),interval:"preserveEnd"}),s.jsx(Ue,{}),s.jsx(xe,{}),s.jsx(ee,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(ja,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2})]})});case"pie":return s.jsx(ye,{width:"100%",height:300,children:s.jsxs(Qr,{children:[s.jsx(ht,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:l=>`${d(l.name)}: ${l.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((l,p)=>s.jsx(Ce,{fill:et[p%et.length]},`cell-${p}`))}),s.jsx(xe,{}),s.jsx(ee,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}})]})});default:return null}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 overflow-auto",children:s.jsxs(V,{className:"w-full max-w-6xl max-h-[90vh] overflow-auto bg-white dark:bg-slate-900",children:[s.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between z-10",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t.title||t.templateName}),s.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Gerado em ",new Date(t.generatedAt).toLocaleString("pt-BR")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{try{if(t.tables&&t.tables.length>0){const p=t.tables[0],m=[(p.headers||[]).join(",")];(p.rows||[]).forEach(S=>{const B=S.map(C=>{const T=typeof C=="object"?JSON.stringify(C):String(C??"");return/[",\n]/.test(T)?'"'+T.replace(/"/g,'""')+'"':T}).join(",");m.push(B)});const g=m.join(`
`),u=new Blob([g],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(u),v=document.createElement("a"),j=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");v.href=h,v.download=`${j}-${Date.now()}.csv`,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(h),a({title:"Exportado (CSV)",description:"Arquivo CSV baixado com sucesso."});return}const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),d=document.createElement("a"),l=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");d.href=n,d.download=`${l}-${Date.now()}.json`,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(n),a({title:"Exportado (JSON)",description:"Arquivo JSON baixado com sucesso."})}catch{a({variant:"destructive",title:"Falha na exportaÃ§Ã£o",description:"Tente novamente."})}},children:[s.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Exportar"]}),s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{try{window.print()}catch{a({variant:"destructive",title:"Falha ao imprimir",description:"Tente novamente."})}},children:[s.jsx(Va,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),s.jsxs(R,{variant:"outline",size:"sm",onClick:async()=>{try{const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),d=t.title||t.templateName||"RelatÃ³rio";navigator.share?await navigator.share({title:d,text:d,url:n}):(await navigator.clipboard.writeText(n),a({title:"Link copiado",description:"Link do relatÃ³rio copiado para a Ã¡rea de transferÃªncia."}))}catch{a({variant:"destructive",title:"Falha ao compartilhar",description:"Tente novamente."})}},children:[s.jsx(Et,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),s.jsx(R,{variant:"ghost",size:"sm",onClick:e,children:s.jsx(st,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[t.summary&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(t.summary).map(([i,n])=>s.jsxs(V,{className:"p-4",children:[s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:i.replace(/([A-Z])/g," $1").trim()}),s.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white mt-1",children:typeof n=="number"?n.toFixed(1):n})]},i))}),t.charts&&t.charts.map((i,n)=>s.jsxs(V,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),r(i.type,i.data)]},n)),t.tables&&t.tables.map((i,n)=>s.jsxs(V,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:i.headers.map((d,l)=>s.jsx("th",{className:"text-left p-2 font-semibold",children:d},l))})}),s.jsx("tbody",{children:i.rows.map((d,l)=>s.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:d.map((p,f)=>s.jsx("td",{className:"p-2",children:p},f))},l))})]})})]},n)),t.details&&s.jsxs(V,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detalhes"}),s.jsx("div",{className:"prose dark:prose-invert max-w-none",children:t.details})]})]})]})})};class rs{constructor(){this.enabled=!1,this.url=void 0,this.token=void 0,this.url&&this.token?(this.enabled=!0,console.log("[Cache] âœ… Upstash Redis configurado")):(console.warn("[Cache] âš ï¸  Upstash Redis nÃ£o configurado - cache desabilitado"),console.warn("[Cache] Configure VITE_UPSTASH_REDIS_REST_URL e VITE_UPSTASH_REDIS_REST_TOKEN"))}async get(e){if(!this.enabled)return null;try{const a=await fetch(`${this.url}/get/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(r.result===null)return console.log(`[Cache] âŒ Miss: ${e}`),null;console.log(`[Cache] âœ… Hit: ${e}`);try{return JSON.parse(r.result)}catch{return r.result}}catch(a){return console.error(`[Cache] Erro ao buscar ${e}:`,a),null}}async set(e,a,r=300){if(!this.enabled)return!1;try{const i=typeof a=="string"?a:JSON.stringify(a),n=await fetch(`${this.url}/set/${encodeURIComponent(e)}/${encodeURIComponent(i)}?EX=${r}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return console.log(`[Cache] ðŸ’¾ Saved: ${e} (TTL: ${r}s)`),!0}catch(i){return console.error(`[Cache] Erro ao salvar ${e}:`,i),!1}}async del(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/del/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return console.log(`[Cache] ðŸ—‘ï¸  Deleted: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao deletar ${e}:`,a),!1}}async invalidatePattern(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/keys/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=(await a.json()).result||[];if(i.length===0)return console.log(`[Cache] ðŸ” No keys found for pattern: ${e}`),!0;const n=i.map(d=>this.del(d));return await Promise.all(n),console.log(`[Cache] ðŸ§¹ Invalidated ${i.length} keys matching: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao invalidar padrÃ£o ${e}:`,a),!1}}async remember(e,a,r=300){const i=await this.get(e);if(i!==null)return i;const n=await a();return await this.set(e,n,r),n}async flush(){if(!this.enabled)return!1;try{const e=await fetch(`${this.url}/flushdb`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return console.log("[Cache] ðŸš¨ Cache completamente limpo (FLUSH)"),!0}catch(e){return console.error("[Cache] Erro ao limpar cache:",e),!1}}getStatus(){return{enabled:this.enabled,hasCredentials:!!(this.url&&this.token),url:this.url?this.url.replace(/https?:\/\//,"").split(".")[0]+"...":"nÃ£o configurado"}}}const tt=new rs,at=[{id:"individual-student",name:"RelatÃ³rio Individual de Aluno",description:"RelatÃ³rio completo de um aluno especÃ­fico",icon:Ra,color:"from-blue-500 to-cyan-500",includes:["Dados pessoais","HistÃ³rico de notas","FrequÃªncia","Feedbacks recebidos","GrÃ¡ficos de evoluÃ§Ã£o","AnÃ¡lise de desempenho"],usage:"ReuniÃ£o com pais, coordenaÃ§Ã£o",popular:!0},{id:"class-report",name:"RelatÃ³rio de Turma",description:"AnÃ¡lise completa de uma turma",icon:_a,color:"from-purple-500 to-pink-500",includes:["EstatÃ­sticas gerais","DistribuiÃ§Ã£o de notas","Taxa de aprovaÃ§Ã£o/reprovaÃ§Ã£o","MÃ©dia da turma","Alunos em destaque","Ãreas de atenÃ§Ã£o"],usage:"Fechamento de semestre, relatÃ³rios institucionais",popular:!0},{id:"comparative",name:"RelatÃ³rio Comparativo",description:"ComparaÃ§Ã£o entre mÃºltiplas turmas",icon:qa,color:"from-orange-500 to-red-500",includes:["Tabela comparativa","GrÃ¡ficos lado a lado","AnÃ¡lise de diferenÃ§as","Melhores prÃ¡ticas identificadas"],usage:"AnÃ¡lise pedagÃ³gica, ajustes metodolÃ³gicos"},{id:"activity-report",name:"RelatÃ³rio de Atividade",description:"AnÃ¡lise de uma atividade especÃ­fica",icon:Ta,color:"from-green-500 to-teal-500",includes:["EstatÃ­sticas de submissÃ£o","DistribuiÃ§Ã£o de notas","QuestÃµes mais erradas","Tempo mÃ©dio de resoluÃ§Ã£o","Lista de notas por aluno"],usage:"ValidaÃ§Ã£o de atividade, ajustes"},{id:"bulletin",name:"Boletim (PerÃ­odo)",description:"Boletim formal por perÃ­odo",icon:Ee,color:"from-indigo-500 to-purple-500",includes:["Notas por disciplina","MÃ©dias parciais e finais","FrequÃªncia","ObservaÃ§Ãµes do professor","Assinatura"],usage:"Entrega oficial para instituiÃ§Ã£o/pais",popular:!0},{id:"teacher-performance",name:"RelatÃ³rio de Desempenho (Professor)",description:"Auto-avaliaÃ§Ã£o do professor",icon:Ia,color:"from-yellow-500 to-orange-500",includes:["Atividades postadas","CorreÃ§Ãµes realizadas","Tempo mÃ©dio de feedback","SatisfaÃ§Ã£o dos alunos","EvoluÃ§Ã£o das turmas"],usage:"AvaliaÃ§Ã£o institucional, portfÃ³lio"}],Us=()=>{const{user:t}=bt(),{toast:e}=rt(),[a,r]=o.useState(!1),[i,n]=o.useState("templates"),[d,l]=o.useState([]),[p,f]=o.useState(!1),[m,g]=o.useState(null),[u,h]=o.useState(null),[v,j]=o.useState(null),[S,B]=o.useState(null),[C,T]=o.useState("30"),[G,D]=o.useState([]),[A,$]=o.useState([]),[b,F]=o.useState(""),[U,q]=o.useState(!1);o.useEffect(()=>{K(),Z()},[t]);const K=async()=>{if(t)try{const{data:c,error:y}=await E.from("report_history").select(`
          id,
          template_id,
          template_name,
          filter_type,
          student_id,
          class_id,
          activity_id,
          period,
          created_at,
          report_data
        `).eq("teacher_id",t.id).order("created_at",{ascending:!1}).limit(20);if(y)throw y;l(c||[]),console.log(`âœ… [Reports] ${c?.length||0} relatÃ³rios carregados do histÃ³rico`)}catch(c){M.error("Erro ao carregar histÃ³rico:",c),l([])}},Z=async()=>{if(t)try{q(!0);const c=`teacher:reports:data:${t.id}:${C}`,y=await tt.get(c);if(y){console.log("âœ… [Reports] Dados carregados do cache"),$(y.classes||[]),D(y.students||[]),q(!1);return}console.log("ðŸ”„ [Reports] Buscando dados do banco...");const{data:N,error:k}=await E.from("classes").select("id, name, subject").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(k)throw k;$(N||[]);const{data:x,error:w}=await E.from("class_members").select(`
          user_id,
          profile:profiles!class_members_user_id_fkey(id, full_name, email),
          class:classes!class_members_class_id_fkey(id, name)
        `).in("class_id",N?.map(I=>I.id)||[]).eq("role","student");if(w)throw w;const O=[],Q=new Set;x?.forEach(I=>{I.profile&&!Q.has(I.profile.id)&&(Q.add(I.profile.id),O.push({id:I.profile.id,name:I.profile.full_name,email:I.profile.email,className:I.class?.name}))}),D(O),await tt.set(c,{classes:N||[],students:O},300),console.log("ðŸ’¾ [Reports] Dados salvos no cache (TTL: 5min)")}catch(c){M.error("Erro ao carregar dados:",c),e({title:"Erro ao carregar dados",description:c.message,variant:"destructive"})}finally{q(!1)}},Y=c=>c==="comparative"?!1:!!(b==="student"&&["class-report"].includes(c)||b==="class"&&["individual-student"].includes(c)||S&&c!=="activity-report"),X=async c=>{if(c!=="comparative"){if(!b){e({title:"Selecione o escopo do relatÃ³rio",description:"Escolha se deseja gerar para um aluno, turma ou todos os alunos.",variant:"destructive"});return}if(b==="student"&&!u){e({title:"Selecione um aluno",description:"Escolha qual aluno vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}if(b==="class"&&!v){e({title:"Selecione uma turma",description:"Escolha qual turma vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}}f(!0),g(null);try{let y=t?.id;const N=at.find(x=>x.id===c);if(e({title:`ðŸ“Š Gerando ${N?.name||"RelatÃ³rio"}`,description:"Processando dados... Aguarde."}),b==="student"&&u)y=u;else if(b==="class"&&v)y=v;else if(c==="class-report")if(v)y=v;else{const{data:x}=await E.from("classes").select("id, is_active").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(!x||x.length===0)throw new Error("Nenhuma turma ativa encontrada para gerar o relatÃ³rio.");y=x[0].id}const k=await ts.generateReport(c,y,{period:parseInt(C),includeArchived:!1,filterType:b,studentId:u,classId:v,activityId:S});g(k),e({title:"âœ… RelatÃ³rio Gerado",description:`${k.templateName} gerado com sucesso!`});try{const{error:x}=await E.from("report_history").insert({teacher_id:t.id,template_id:c,template_name:N?.name||"RelatÃ³rio",filter_type:b||null,student_id:u||null,class_id:v||null,activity_id:S||null,period:parseInt(C),report_data:k});x?M.error("Erro ao salvar histÃ³rico:",x):console.log("âœ… RelatÃ³rio salvo no histÃ³rico")}catch(x){M.error("Erro ao salvar histÃ³rico:",x)}l(x=>[{id:Date.now(),templateId:c,templateName:N?.name,generatedAt:new Date().toISOString(),cached:!1,filterType:b,studentId:u,classId:v},...x.slice(0,9)])}catch(y){M.error("Erro ao gerar relatÃ³rio:",y),e({title:"Erro",description:y.message||"NÃ£o foi possÃ­vel gerar o relatÃ³rio",variant:"destructive"})}finally{f(!1)}},ne=()=>{n("history")},ge=()=>{e({title:"Em desenvolvimento",description:"Gerenciamento de templates serÃ¡ implementado em breve"})},be=c=>{if(!c)return null;if(Array.isArray(c))return c;if(Array.isArray(c?.rows))return c.rows;if(Array.isArray(c?.data))return c.data;if(Array.isArray(c?.items))return c.items;const y=Object.values(c).find(N=>Array.isArray(N));return Array.isArray(y)?y:[c]},ft=c=>{if(!c||c.length===0)return"";const y=Array.from(c.reduce((w,O)=>(Object.keys(O||{}).forEach(Q=>w.add(Q)),w),new Set)),N=w=>{if(w==null)return"";const O=typeof w=="object"?JSON.stringify(w):String(w);return/[",\n]/.test(O)?'"'+O.replace(/"/g,'""')+'"':O},k=y.map(N).join(","),x=c.map(w=>y.map(O=>N(w?.[O])).join(","));return[k,...x].join(`
`)},Ie=(c,y,N)=>{const k=new Blob([c],{type:N}),x=URL.createObjectURL(k),w=document.createElement("a");w.href=x,w.download=y,document.body.appendChild(w),w.click(),w.remove(),URL.revokeObjectURL(x)},vt=()=>{if(!m){e({title:"Nenhum relatÃ³rio para exportar",description:"Gere um relatÃ³rio primeiro.",variant:"destructive"});return}try{const c=be(m).map(k=>{const x={};return Object.entries(k||{}).forEach(([w,O])=>{O&&typeof O=="object"&&!Array.isArray(O)?Object.entries(O).forEach(([Q,I])=>{x[`${w}.${Q}`]=I}):x[w]=O}),x}),y=ft(c);if(!y)throw new Error("NÃ£o hÃ¡ dados tabulares para exportar");const N=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ie(y,`${N}-${Date.now()}.csv`,"text/csv;charset=utf-8;"),e({title:"Exportado com sucesso",description:"Arquivo CSV baixado."})}catch(c){M.warn("CSV export fallback to JSON:",c);const y=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ie(JSON.stringify(m,null,2),`${y}-${Date.now()}.json`,"application/json"),e({title:"Exportado como JSON",description:"NÃ£o foi possÃ­vel gerar CSV. Baixamos o JSON.",variant:"destructive"})}};return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[s.jsx(wt,{title:"RelatÃ³rios",subtitle:"Gere relatÃ³rios formais e exportÃ¡veis",role:"teacher",actions:s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(R,{variant:"outline",onClick:ne,children:[s.jsx(We,{className:"w-4 h-4 mr-2"}),"HistÃ³rico"]}),s.jsxs(R,{variant:"outline",onClick:ge,children:[s.jsx(ka,{className:"w-4 h-4 mr-2"}),"Templates"]}),s.jsxs(R,{onClick:()=>e({title:"Selecione um template abaixo"}),children:[s.jsx(je,{className:"w-4 h-4 mr-2"}),"Novo RelatÃ³rio"]})]})}),s.jsx(V,{className:"mt-6 p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:s.jsx(Ca,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-900 dark:text-blue-100",children:"Selecione o Escopo do RelatÃ³rio"}),s.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Escolha para quem deseja gerar o relatÃ³rio antes de selecionar um template"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(oe,{className:"text-sm font-medium mb-2 block",children:"Tipo de RelatÃ³rio"}),s.jsxs(le,{value:b,onValueChange:F,children:[s.jsx(ce,{className:"bg-white dark:bg-slate-900",children:s.jsx(de,{placeholder:"Selecione o tipo..."})}),s.jsxs(ue,{children:[s.jsx(z,{value:"student",children:"Aluno EspecÃ­fico"}),s.jsx(z,{value:"class",children:"Turma Completa"}),s.jsx(z,{value:"all",children:"Todos os Alunos"})]})]})]}),b==="student"&&s.jsxs("div",{children:[s.jsx(oe,{className:"text-sm font-medium mb-2 block",children:"Selecionar Aluno"}),s.jsxs(le,{value:u||"",onValueChange:h,children:[s.jsx(ce,{className:"bg-white dark:bg-slate-900",children:s.jsx(de,{placeholder:"Escolha um aluno..."})}),s.jsx(ue,{children:G.map(c=>s.jsxs(z,{value:c.id,children:[c.name," ",c.className&&`(${c.className})`]},c.id))})]})]}),b==="class"&&s.jsxs("div",{children:[s.jsx(oe,{className:"text-sm font-medium mb-2 block",children:"Selecionar Turma"}),s.jsxs(le,{value:v||"",onValueChange:j,children:[s.jsx(ce,{className:"bg-white dark:bg-slate-900",children:s.jsx(de,{placeholder:"Escolha uma turma..."})}),s.jsx(ue,{children:A.map(c=>s.jsxs(z,{value:c.id,children:[c.name," ",c.subject&&`- ${c.subject}`]},c.id))})]})]}),s.jsxs("div",{children:[s.jsx(oe,{className:"text-sm font-medium mb-2 block",children:"PerÃ­odo"}),s.jsxs(le,{value:C,onValueChange:T,children:[s.jsx(ce,{className:"bg-white dark:bg-slate-900",children:s.jsx(de,{})}),s.jsxs(ue,{children:[s.jsx(z,{value:"7",children:"Ãšltimos 7 dias"}),s.jsx(z,{value:"30",children:"Ãšltimos 30 dias"}),s.jsx(z,{value:"90",children:"Ãšltimos 90 dias"}),s.jsx(z,{value:"180",children:"Ãšltimos 6 meses"}),s.jsx(z,{value:"365",children:"Ãšltimo ano"})]})]})]})]}),b&&s.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[s.jsx("strong",{children:"Filtro ativo:"})," ",b==="student"?`Aluno - ${G.find(c=>c.id===u)?.name||"Selecione"}`:b==="class"?`Turma - ${A.find(c=>c.id===v)?.name||"Selecione"}`:"Todos os alunos"]}),s.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>{F(""),h(null),j(null)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[s.jsx(st,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]})]})}),s.jsxs(xt,{value:i,onValueChange:n,className:"mt-6",children:[s.jsxs(jt,{className:"grid w-full max-w-md grid-cols-2",children:[s.jsx(Be,{value:"templates",children:"Templates"}),s.jsx(Be,{value:"history",children:"HistÃ³rico"})]}),s.jsxs(Fe,{value:"templates",className:"mt-6",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:at.map((c,y)=>{const N=c.icon,k=Y(c.id);return s.jsx(yt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:y*.1},style:{pointerEvents:"auto"},children:s.jsxs(V,{className:`p-6 h-full flex flex-col hover:shadow-lg transition-shadow relative ${k?"opacity-50":""}`,style:{pointerEvents:"auto"},children:[s.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${c.color} opacity-5 group-hover:opacity-10 transition-opacity`}),c.popular&&s.jsxs(Me,{className:"absolute top-4 right-4 bg-yellow-500 text-white",children:[s.jsx(Da,{className:"w-3 h-3 mr-1"}),"Popular"]}),s.jsx("div",{className:"mb-4 relative z-10",children:s.jsx("div",{className:`inline-flex p-3 rounded-xl bg-gradient-to-r ${c.color}`,children:s.jsx(N,{className:"w-6 h-6 text-white"})})}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:c.name}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:c.description}),s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-2",children:"Inclui:"}),s.jsxs("ul",{className:"space-y-1",children:[c.includes.slice(0,3).map((x,w)=>s.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-center",children:[s.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mr-2"}),x]},w)),c.includes.length>3&&s.jsxs("li",{className:"text-xs text-blue-600 dark:text-blue-400",children:["+",c.includes.length-3," mais..."]})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx(Me,{variant:"outline",className:"text-xs",children:c.usage})}),s.jsxs("div",{className:"flex gap-2 mt-auto pt-4 relative z-50",children:[s.jsxs(R,{className:`flex-1 bg-gradient-to-r ${c.color} text-white hover:opacity-90`,onClick:()=>{if(k){e({title:"Template incompatÃ­vel",description:"Este template nÃ£o Ã© compatÃ­vel com os filtros selecionados.",variant:"destructive"});return}M.debug("BotÃ£o Gerar clicado:",c.id),X(c.id)},disabled:k,children:[s.jsx(je,{className:"w-4 h-4 mr-2"}),"Gerar"]}),s.jsx(R,{variant:"outline",size:"icon",onClick:()=>{M.debug("BotÃ£o Preview clicado"),e({title:"Preview",description:"VisualizaÃ§Ã£o serÃ¡ implementada"})},children:s.jsx($a,{className:"w-4 h-4"})})]})]})},c.id)})}),s.jsxs(V,{className:"mt-8 p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Formatos de ExportaÃ§Ã£o"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-red-50 hover:border-red-300 dark:hover:bg-red-950/20",onClick:()=>{M.debug("Exportar PDF clicado"),e({title:"Exportar PDF",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(Ee,{className:"w-8 h-8 mb-2 text-red-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PDF"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-green-50 hover:border-green-300 dark:hover:bg-green-950/20",onClick:vt,children:[s.jsx(za,{className:"w-8 h-8 mb-2 text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Excel"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20",onClick:()=>{M.debug("Exportar Word clicado"),e({title:"Exportar Word",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(Ee,{className:"w-8 h-8 mb-2 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Word"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-purple-50 hover:border-purple-300 dark:hover:bg-purple-950/20",onClick:()=>{M.debug("Exportar PNG clicado"),e({title:"Exportar PNG",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(Ba,{className:"w-8 h-8 mb-2 text-purple-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PNG"})]})]})]})]}),s.jsx(Fe,{value:"history",className:"mt-6",children:s.jsx(V,{className:"p-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx(We,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:"Nenhum relatÃ³rio gerado ainda"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"RelatÃ³rios que vocÃª gerar aparecerÃ£o aqui para fÃ¡cil acesso"}),s.jsxs(R,{onClick:()=>n("templates"),children:[s.jsx(je,{className:"w-4 h-4 mr-2"}),"Gerar Primeiro RelatÃ³rio"]})]})})})]}),m&&s.jsx(as,{report:m,onClose:()=>g(null)})]})};export{Us as default};
