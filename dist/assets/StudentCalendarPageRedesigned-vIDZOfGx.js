import{a as re,u as le,r as o,s as d,l as g,j as e,p as oe}from"./main-Bl3iyOV8.js";import{C as b}from"./card-SNqEFOp2.js";import{m as M,B as j}from"./button-DpOjBXor.js";import{E as O}from"./EventCard-4saBstvH.js";import{E as I}from"./EmptyState-DGamXeZ0.js";import"./dialog-C-DIWS3k.js";import{C as N}from"./index-Bb4h7Ki9.js";import{C as ce}from"./SidebarPremium-PssxZ1ou.js";import{C as de}from"./chevron-right-DU2dW0WM.js";import{C as me}from"./clock-BJ9uIF0n.js";import{s as $,i as pe,a as xe}from"./isSameMonth-CK0W24Ro.js";import{e as z}from"./endOfMonth-BD-g1yyK.js";import{s as A,c as ue,f as v}from"./format-BcFT9btV.js";import{e as B}from"./endOfDay-mJ-5sjFp.js";import{e as he}from"./endOfWeek-BRNs0S5s.js";import{e as fe,s as ge}from"./subMonths-CphOl_Aj.js";import{i as ve}from"./isSameDay-D5LInQhv.js";import{i as P}from"./isToday-By0hfvNN.js";import{i as ye}from"./isPast-CeQjbKRK.js";import{p as w}from"./pt-BR-CuGSKEGQ.js";import"./video-9oLsbzTZ.js";import"./index-CYK-_QUl.js";import"./map-pin-DioqZzjM.js";import"./index-DZVOjynP.js";import"./x-f7wZy2q2.js";import"./bell-BfdEdLeq.js";import"./trending-up-8L-hnT0i.js";import"./user-DM7mQE01.js";import"./settings-BAxhic8T.js";import"./house--MZ6Jz5W.js";import"./users-CoDMpyo4.js";import"./graduation-cap-D52WS1is.js";import"./chart-column-C0EgfbtL.js";import"./en-US-B6HbAA6N.js";import"./constructNow-re94FRT2.js";const at=()=>{const{user:m}=re(),y=le(),[R,S]=o.useState(!0),[i,_]=o.useState(new Date),[p,E]=o.useState(new Date),[x,T]=o.useState([]),[k,q]=o.useState([]),[_e,be]=o.useState("all");o.useEffect(()=>{m?.id&&H()},[m,i]),o.useEffect(()=>{L(p)},[p,x]);const H=async()=>{try{S(!0);const{data:t}=await d.from("class_members").select("class_id").eq("user_id",m.id).eq("role","student"),a=t?.map(s=>s.class_id)||[],n=$(i),r=z(i),{data:l}=await d.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, class_id").in("class_id",a).gte("start_time",n.toISOString()).lte("start_time",r.toISOString()).order("start_time",{ascending:!0});g.debug("[Calendar] Buscando eventos como participante:",{userId:m.id});const{data:c,error:u}=await d.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, participants, class_id, created_by").not("participants","is",null).gte("start_time",n.toISOString()).lte("start_time",r.toISOString()).order("start_time",{ascending:!0}),h=c?.filter(s=>s.participants&&Array.isArray(s.participants)&&s.participants.includes(m.id))||[];u?g.error("[Calendar] Erro ao buscar eventos como participante:",u):g.debug("[Calendar] Eventos encontrados como participante:",{count:h?.length||0,events:h});const{data:D}=await d.from("activity_class_assignments").select("activity_id, class_id").in("class_id",a),Z=D?.map(s=>s.activity_id)||[],{data:ee}=await d.from("activities").select("id, title, due_date").in("id",Z).gte("due_date",n.toISOString()).lte("due_date",r.toISOString()),{data:te}=await d.from("classes").select("id, name").in("id",a),f={};te?.forEach(s=>{f[s.id]=s});const C=new Set,se=[...(l||[]).map(s=>({...s,class_name:f[s.class_id]?.name,event_type:"class_event"})),...(h||[]).map(s=>({...s,class_name:f[s.class_id]?.name,event_type:"meeting"}))].filter(s=>C.has(s.id)?!1:(C.add(s.id),!0)),ae=(ee||[]).map(s=>{const ie=D.find(ne=>ne.activity_id===s.id);return{id:`activity-${s.id}`,title:s.title,start_time:s.due_date,end_time:s.due_date,type:"deadline",class_name:f[ie?.class_id]?.name,event_type:"activity_deadline",activity_id:s.id}});T([...se,...ae])}catch(t){g.error("Erro ao carregar eventos:",t)}finally{S(!1)}},L=t=>{const a=A(t),n=B(t),r=x.filter(l=>{const c=new Date(l.start_time);return c>=a&&c<=n});q(r)},F=t=>{const a=A(t),n=B(t);return x.filter(r=>{const l=new Date(r.start_time);return l>=a&&l<=n})},Q=()=>{_(ge(i))},W=()=>{_(xe(i,1))},G=()=>{const t=new Date;_(t),E(t)},J=$(i),K=z(i),U=ue(J,{weekStartsOn:0}),V=he(K,{weekStartsOn:0}),X=fe({start:U,end:V}),Y=["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"];return R?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs(M.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8 text-blue-600"}),"Minha Agenda"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Eventos, reuniÃµes e prazos de atividades"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{onClick:Q,variant:"outline",size:"sm",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white min-w-[200px] text-center",children:v(i,"MMMM yyyy",{locale:w})}),e.jsx(j,{onClick:W,variant:"outline",size:"sm",children:e.jsx(de,{className:"w-4 h-4"})})]}),e.jsx(j,{onClick:G,variant:"default",children:"Hoje"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(b,{className:"p-6 lg:col-span-2",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:Y.map(t=>e.jsx("div",{className:"text-center font-bold text-slate-600 dark:text-slate-400 text-sm py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:X.map(t=>{const a=F(t),n=pe(t,i),r=ve(t,p),l=P(t),c=ye(t)&&!l;return e.jsxs(M.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>E(t),className:`
                    aspect-square p-2 rounded-lg border-2 transition-all
                    ${n?"bg-white dark:bg-slate-800":"bg-slate-100 dark:bg-slate-900"}
                    ${r?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-transparent"}
                    ${l?"ring-2 ring-blue-500":""}
                    ${c?"opacity-50":""}
                    hover:border-blue-300 dark:hover:border-blue-700
                  `,children:[e.jsx("div",{className:`
                    text-sm font-semibold mb-1
                    ${r?"text-blue-600":"text-slate-900 dark:text-white"}
                    ${n?"":"text-slate-400"}
                  `,children:v(t,"d")}),a.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-0.5 justify-center",children:[a.slice(0,3).map((u,h)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${u.type==="deadline"?"bg-red-500":u.type==="meeting"?"bg-purple-500":"bg-blue-500"}`},h)),a.length>3&&e.jsxs("div",{className:"text-[10px] text-slate-500",children:["+",a.length-3]})]})]},t.toString())})}),e.jsxs("div",{className:"flex items-center gap-6 mt-6 pt-6 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Eventos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"ReuniÃµes"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Prazos"})]})]})]}),e.jsxs(b,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-blue-600"}),P(p)?"Hoje":v(p,"dd 'de' MMMM",{locale:w})]}),k.length>0?e.jsx("div",{className:"space-y-3",children:k.map((t,a)=>e.jsx(O,{event:t,onClick:()=>{t.event_type==="activity_deadline"?y(`/students/activities/${t.activity_id}`):y("/students/calendar")},index:a},t.id))}):e.jsx(I,{icon:N,title:"Nenhum evento",description:"Nenhum evento agendado para este dia.",variant:"info"})]})]}),e.jsxs(b,{className:"p-6 mt-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:["ğŸ“… Eventos de ",v(i,"MMMM",{locale:w})]}),x.length>0?e.jsx("div",{className:"space-y-4",children:x.sort((t,a)=>new Date(t.start_time)-new Date(a.start_time)).map((t,a)=>e.jsx(O,{event:t,onClick:()=>{t.event_type==="activity_deadline"&&y(`/students/activities/${t.activity_id}`)},index:a},t.id))}):e.jsx(I,{icon:N,title:"Nenhum evento este mÃªs",description:"NÃ£o hÃ¡ eventos, reuniÃµes ou prazos agendados para este mÃªs."})]})]})};export{at as default};
