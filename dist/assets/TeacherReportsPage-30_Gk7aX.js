import{c as Z,s as v,r as T,j as e,f as ke,b as Se,l as D}from"./main-5T23t4PA.js";import{C as F}from"./card-DPEV4PIe.js";import{B as $}from"./button-D1pRabHc.js";import{B as ae}from"./badge-CHD2ppHT.js";import{L as M}from"./label-CaEiuH7k.js";import{T as Ae,a as Re,b as se,c as re}from"./tabs-BxEDXXe9.js";import{S as z,a as I,b as U,c as V,d as q}from"./select-HrlLxAIu.js";import{D as Te}from"./DashboardHeader-DpjdxJig.js";import"./input-CtDVRTm_.js";import"./dropdown-menu-DW8ZoiSE.js";import{u as ue}from"./use-toast-DizLYaPb.js";import{R as Ce,T as $e,C as he}from"./SidebarPremium-b8AcD6aG.js";import{D as Ee}from"./download-aE9qC_yh.js";import{P as De,F as Fe}from"./printer-BhDMTsdx.js";import{S as Ge}from"./share-2-D6ifPo4P.js";import{X as pe}from"./x-C8LZHbUR.js";import{W as J,$ as K,X as ie,Y as oe,_ as le}from"./CartesianChart-DD1q50QC.js";import{P as qe,a as Be}from"./PieChart-CiQb7t3f.js";import{C as Le,B as Pe,a as Oe}from"./BarChart-C9s0GytU.js";import{L as W}from"./Legend-BpUhHeDW.js";import{L as Me,a as ze}from"./LineChart-BpFpAQQB.js";import{H as ne}from"./history-Ccmr1vnz.js";import{S as Ie}from"./settings-CA-HrSVc.js";import{P as Y}from"./plus-C_3t0Ugn.js";import{F as Ue}from"./funnel-BCEbMUzy.js";import{U as Ve}from"./user--bT9oolr.js";import{U as He}from"./users-BHFcZ460.js";import{C as Je}from"./clipboard-list-Bq8RUal4.js";import{F as X}from"./file-text-D1pM-cGT.js";import{m as Ke}from"./proxy-CTHD_aal.js";import{S as We}from"./star-BhZKBNOp.js";import{E as Ye}from"./eye-CPBHLKl6.js";import"./index-BSvf8Gkf.js";import"./index-WTFzhl0e.js";import"./index-BYh_3E0O.js";import"./index-BEPDIlbQ.js";import"./index-Hrv3wGwr.js";import"./Combination-CK754xyO.js";import"./index-D8pw72a5.js";import"./chevron-down-C0ABIcLs.js";import"./check-BGvYUlN_.js";import"./chevron-up-B5cmfjQz.js";import"./chevron-right-BZvTPqku.js";import"./house-C21pZqGK.js";import"./book-open-DbJlkSkE.js";import"./graduation-cap-CGvbZ17f.js";import"./calendar-BTZ9lOjb.js";import"./chart-column-CiTHaPgQ.js";import"./message-circle-Bm4-2rso.js";import"./brain-dpI-w2IQ.js";import"./index-CcRuMwBB.js";import"./index-B7VwQr8s.js";import"./PolarChart-CzP6VSzP.js";const Xe=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],Ze=Z("chart-no-axes-column-increasing",Xe);const Qe=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],et=Z("file-image",Qe);const tt=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],at=Z("git-compare",tt);class st{async generateStudentReport(t,o=30){const n=new Date;n.setDate(n.getDate()-o);const{data:u}=await v.from("profiles").select("full_name, email").eq("id",t).single(),{data:h}=await v.from("class_members").select("class:classes(id, name, subject)").eq("user_id",t).eq("role","student"),{data:x}=await v.from("submissions").select(`
        grade,
        submitted_at,
        activity:activities(title, max_score, type)
      `).eq("student_id",t).gte("submitted_at",n.toISOString()).not("grade","is",null),g=x?.map(s=>s.grade)||[],a=g.length>0?g.reduce((s,p)=>s+p,0)/g.length:0,m=g.length>0?Math.max(...g):0,i=g.length>0?Math.min(...g):0,d=x?.map(s=>({name:s.activity.title.substring(0,20),value:s.grade}))||[];return{title:`RelatÃ³rio de Desempenho - ${u?.full_name||"Aluno"}`,templateName:"Desempenho Individual (Aluno)",generatedAt:new Date().toISOString(),studentId:t,summary:{totalActivities:x?.length||0,avgGrade:a.toFixed(1),maxGrade:m.toFixed(1),minGrade:i.toFixed(1),totalClasses:h?.length||0},charts:[{title:"Notas por Atividade",type:"bar",data:d},{title:"EvoluÃ§Ã£o do Desempenho",type:"line",data:d}],tables:[{title:"Turmas Inscritas",headers:["Nome","MatÃ©ria"],rows:h?.map(s=>[s.class.name,s.class.subject||"-"])||[]}],details:`RelatÃ³rio gerado para o perÃ­odo de ${o} dias. Total de ${x?.length||0} atividades avaliadas.`}}async generateClassReport(t,o=30){const{data:n}=await v.from("classes").select("name, subject, created_by").eq("id",t).single(),{data:u}=await v.from("class_members").select("user_id, profiles:user_id(full_name)").eq("class_id",t).eq("role","student"),{data:h}=await v.from("activity_class_assignments").select("activity_id, activity:activities(id, title)").eq("class_id",t),x=h?.map(s=>s.activity_id)||[],{data:g}=await v.from("submissions").select("grade, student_id, activity_id").in("activity_id",x).not("grade","is",null),a=g?.map(s=>s.grade)||[],m=a.length>0?a.reduce((s,p)=>s+p,0)/a.length:0,i={"Excelente (90-100)":0,"Bom (70-89)":0,"Regular (50-69)":0,"Insuficiente (0-49)":0};a.forEach(s=>{s>=90?i["Excelente (90-100)"]++:s>=70?i["Bom (70-89)"]++:s>=50?i["Regular (50-69)"]++:i["Insuficiente (0-49)"]++});const d=Object.entries(i).map(([s,p])=>({name:s,value:p}));return{title:`RelatÃ³rio de Turma - ${n?.name||"Turma"}`,templateName:"RelatÃ³rio de Turma",generatedAt:new Date().toISOString(),classId:t,summary:{totalStudents:u?.length||0,totalActivities:h?.length||0,avgGrade:m.toFixed(1),submissionsCount:g?.length||0},charts:[{title:"DistribuiÃ§Ã£o de Notas",type:"pie",data:d}],tables:[{title:"Lista de Alunos",headers:["Nome","SubmissÃµes"],rows:u?.map(s=>{const p=g?.filter(c=>c.student_id===s.user_id).length||0;return[s.profiles.full_name,p]})||[]}],details:`Turma: ${n?.name}
MatÃ©ria: ${n?.subject||"NÃ£o especificada"}
PerÃ­odo: Ãºltimos ${o} dias`}}async generateComparativeReport(t){const{data:o}=await v.from("classes").select("id, name, subject").eq("created_by",t).eq("is_active",!0);o?.map(u=>u.id);const n=await Promise.all(o?.map(async u=>{const{data:h}=await v.from("activity_class_assignments").select("activity_id").eq("class_id",u.id),x=h?.map(i=>i.activity_id)||[],{data:g}=await v.from("submissions").select("grade").in("activity_id",x).not("grade","is",null),a=g?.map(i=>i.grade)||[],m=a.length>0?a.reduce((i,d)=>i+d,0)/a.length:0;return{name:u.name,value:m}})||[]);return{title:"RelatÃ³rio Comparativo de Turmas",templateName:"Comparativo de Desempenho",generatedAt:new Date().toISOString(),teacherId:t,summary:{totalClasses:o?.length||0,avgGrade:(n.reduce((u,h)=>u+h.value,0)/(n.length||1)).toFixed(1)},charts:[{title:"MÃ©dia por Turma",type:"bar",data:n}],tables:[{title:"Detalhamento por Turma",headers:["Turma","MatÃ©ria","MÃ©dia"],rows:o?.map((u,h)=>[u.name,u.subject||"-",n[h]?.value.toFixed(1)||"0"])||[]}]}}async generateTeacherReport(t){const{data:o}=await v.from("classes").select("id").eq("created_by",t).eq("is_active",!0),{count:n}=await v.from("class_members").select("id",{count:"exact",head:!0}).in("class_id",o?.map(a=>a.id)||[]).eq("role","student"),{data:u}=await v.from("activities").select("id").eq("created_by",t),{data:h}=await v.from("submissions").select("grade").in("activity_id",u?.map(a=>a.id)||[]).not("grade","is",null),x=h?.map(a=>a.grade)||[],g=x.length>0?x.reduce((a,m)=>a+m,0)/x.length:0;return{title:"RelatÃ³rio de Desempenho do Professor",templateName:"Desempenho (Professor)",generatedAt:new Date().toISOString(),teacherId:t,summary:{totalClasses:o?.length||0,totalStudents:n||0,totalActivities:u?.length||0,avgGrade:g.toFixed(1)},details:"RelatÃ³rio consolidado de todas as turmas e atividades criadas."}}async generateBulletinReport(t,o={}){const{period:n=30,classId:u,studentId:h}=o,x=new Date;return x.setDate(x.getDate()-n),h?await this.generateStudentBulletin(h,n):u?await this.generateClassBulletin(u,n):await this.generateTeacherBulletin(t,n)}async generateStudentBulletin(t,o=30){const n=new Date;n.setDate(n.getDate()-o);const{data:u}=await v.from("profiles").select("full_name, email").eq("id",t).single(),{data:h}=await v.from("class_members").select(`
        class:classes(id, name, subject, created_by),
        joined_at
      `).eq("user_id",t).eq("role","student"),{data:x}=await v.from("submissions").select(`
        grade,
        submitted_at,
        graded_at,
        status,
        activity:activities(
          id,
          title,
          type,
          max_score,
          due_date,
          activity_class_assignments!inner(class_id)
        )
      `).eq("student_id",t).gte("submitted_at",n.toISOString()).eq("status","graded");h?.map(i=>i.class.id);const g=[];for(const i of h||[]){const d=x?.filter(b=>b.activity?.activity_class_assignments?.[0]?.class_id===i.class.id)||[],s=d.map(b=>b.grade).filter(b=>b!==null),p=s.length>0?s.reduce((b,G)=>b+G,0)/s.length:0,c=d.length,j=d.filter(b=>b.submitted_at&&b.activity?.due_date&&new Date(b.submitted_at)<=new Date(b.activity.due_date)).length,C=c>0?j/c*100:0;g.push({className:i.class.name,subject:i.class.subject||"-",activities:c,avgGrade:p.toFixed(1),attendanceRate:C.toFixed(1),maxGrade:s.length>0?Math.max(...s).toFixed(1):"-",minGrade:s.length>0?Math.min(...s).toFixed(1):"-",details:d.map(b=>({activityName:b.activity.title,grade:b.grade,maxGrade:b.activity.max_score||100,date:new Date(b.graded_at).toLocaleDateString("pt-BR"),status:b.submitted_at<=b.activity.due_date?"No prazo":"Atrasado"}))})}const a=x?.map(i=>i.grade).filter(i=>i!==null)||[],m=a.length>0?a.reduce((i,d)=>i+d,0)/a.length:0;return{title:`Boletim Escolar - ${u?.full_name||"Aluno"}`,templateName:"Boletim Individual",generatedAt:new Date().toISOString(),studentId:t,period:o,summary:{studentName:u?.full_name||"-",email:u?.email||"-",period:`${o} dias`,totalClasses:h?.length||0,totalActivities:x?.length||0,generalAvg:m.toFixed(1)},tables:[{title:"Resumo por Turma",headers:["Turma","MatÃ©ria","Atividades","MÃ©dia","FrequÃªncia","Maior Nota","Menor Nota"],rows:g.map(i=>[i.className,i.subject,i.activities,i.avgGrade,`${i.attendanceRate}%`,i.maxGrade,i.minGrade])}],details:g,observations:`Boletim gerado automaticamente para o perÃ­odo de ${o} dias. Total de ${x?.length||0} atividades avaliadas. MÃ©dia geral: ${m.toFixed(1)}.`}}async generateClassBulletin(t,o=30){const{data:n}=await v.from("classes").select("name, subject, created_by").eq("id",t).single(),{data:u}=await v.from("class_members").select(`
        user_id,
        profile:profiles!class_members_user_id_fkey(full_name, email)
      `).eq("class_id",t).eq("role","student"),{data:h}=await v.from("activity_class_assignments").select(`
        activity_id,
        activity:activities(id, title, type, max_score, due_date)
      `).eq("class_id",t),x=h?.map(c=>c.activity_id)||[],{data:g}=await v.from("submissions").select(`
        grade,
        student_id,
        submitted_at,
        activity_id,
        activity:activities(title, max_score)
      `).in("activity_id",x).eq("status","graded"),a=[];for(const c of u||[]){const j=g?.filter(_=>_.student_id===c.user_id)||[],C=j.map(_=>_.grade).filter(_=>_!==null),b=C.length>0?C.reduce((_,O)=>_+O,0)/C.length:0,G=j.filter(_=>_.submitted_at&&_.activity?.due_date&&new Date(_.submitted_at)<=new Date(_.activity.due_date)).length,w=j.length>0?G/j.length*100:0;let B="Aprovado";b<6?B="Reprovado":b<7&&(B="RecuperaÃ§Ã£o"),a.push({studentName:c.profile?.full_name||"-",email:c.profile?.email||"-",activities:j.length,avgGrade:b.toFixed(1),attendanceRate:w.toFixed(1),status:B,details:j.map(_=>({activityName:_.activity.title,grade:_.grade,maxGrade:_.activity.max_score}))})}const m=g?.map(c=>c.grade).filter(c=>c!==null)||[],i=m.length>0?m.reduce((c,j)=>c+j,0)/m.length:0,d=a.filter(c=>c.status==="Aprovado").length,s=a.filter(c=>c.status==="RecuperaÃ§Ã£o").length,p=a.filter(c=>c.status==="Reprovado").length;return{title:`Boletim da Turma - ${n?.name||"Turma"}`,templateName:"Boletim da Turma",generatedAt:new Date().toISOString(),classId:t,period:o,summary:{className:n?.name||"-",subject:n?.subject||"-",period:`${o} dias`,totalStudents:u?.length||0,totalActivities:h?.length||0,classAvg:i.toFixed(1),approved:d,recovery:s,failed:p},tables:[{title:"Boletim dos Alunos",headers:["Aluno","Email","Atividades","MÃ©dia","FrequÃªncia","Status"],rows:a.map(c=>[c.studentName,c.email,c.activities,c.avgGrade,`${c.attendanceRate}%`,c.status])}],details:a,observations:`Boletim gerado para a turma ${n?.name}. Total de ${u?.length||0} alunos. MÃ©dia da turma: ${i.toFixed(1)}. Aprovados: ${d}, RecuperaÃ§Ã£o: ${s}, Reprovados: ${p}.`}}async generateTeacherBulletin(t,o=30){const{data:n}=await v.from("classes").select("id, name, subject").eq("created_by",t).eq("is_active",!0),u=n?.map(s=>s.id)||[],{data:h}=await v.from("class_members").select(`
        user_id,
        class_id,
        profile:profiles!class_members_user_id_fkey(full_name, email)
      `).in("class_id",u).eq("role","student"),{data:x}=await v.from("activity_class_assignments").select("activity_id, class_id").in("class_id",u),g=x?.map(s=>s.activity_id)||[],{data:a}=await v.from("submissions").select(`
        grade,
        student_id,
        activity_id,
        activity:activities(title, max_score, due_date),
        activity_class_assignments!inner(class_id)
      `).in("activity_id",g).eq("status","graded"),m=[];for(const s of n||[]){const p=h?.filter(w=>w.class_id===s.id)||[],c=a?.filter(w=>w.activity_class_assignments?.[0]?.class_id===s.id)||[],j=c.map(w=>w.grade).filter(w=>w!==null),C=j.length>0?j.reduce((w,B)=>w+B,0)/j.length:0,b=c.filter(w=>w.submitted_at&&w.activity?.due_date&&new Date(w.submitted_at)<=new Date(w.activity.due_date)).length,G=c.length>0?b/c.length*100:0;m.push({className:s.name,subject:s.subject||"-",students:p.length,activities:x?.filter(w=>w.class_id===s.id).length||0,submissions:c.length,avgGrade:C.toFixed(1),attendanceRate:G.toFixed(1)})}const i=a?.map(s=>s.grade).filter(s=>s!==null)||[],d=i.length>0?i.reduce((s,p)=>s+p,0)/i.length:0;return{title:"Boletim Geral - Todas as Turmas",templateName:"Boletim Geral",generatedAt:new Date().toISOString(),teacherId:t,period:o,summary:{period:`${o} dias`,totalClasses:n?.length||0,totalStudents:h?.length||0,totalActivities:x?.length||0,totalSubmissions:a?.length||0,generalAvg:d.toFixed(1)},tables:[{title:"Resumo por Turma",headers:["Turma","MatÃ©ria","Alunos","Atividades","SubmissÃµes","MÃ©dia","FrequÃªncia"],rows:m.map(s=>[s.className,s.subject,s.students,s.activities,s.submissions,s.avgGrade,`${s.attendanceRate}%`])}],details:m,observations:`Boletim geral gerado para ${n?.length||0} turmas. Total de ${h?.length||0} alunos e ${a?.length||0} submissÃµes. MÃ©dia geral: ${d.toFixed(1)}.`}}async generateReport(t,o,n={}){switch(t){case"individual-student":return await this.generateStudentReport(o,n.period);case"class-report":return await this.generateClassReport(o,n.period);case"comparative":return await this.generateComparativeReport(o);case"teacher-performance":return await this.generateTeacherReport(o);case"activity-report":return{title:"RelatÃ³rio de Atividade",templateName:"RelatÃ³rio de Atividade",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};case"bulletin":return await this.generateBulletinReport(o,n);default:throw new Error("Template de relatÃ³rio nÃ£o encontrado")}}}const rt=new st,it=Ce,ot=$e,xe=T.forwardRef(({className:l,sideOffset:t=4,...o},n)=>e.jsx(he,{ref:n,sideOffset:t,className:ke("z-50 overflow-hidden rounded-md border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-1.5 text-sm font-medium text-gray-900 dark:text-white shadow-lg shadow-black/10 animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l),...o}));xe.displayName=he.displayName;const ce=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],P=({text:l,maxLength:t=30})=>!l||l.length<=t?e.jsx("span",{children:l}):e.jsxs(it,{children:[e.jsx(ot,{children:e.jsxs("span",{className:"cursor-help",children:[l.slice(0,t),"â€¦"]})}),e.jsx(xe,{children:e.jsx("p",{className:"max-w-xs",children:l})})]}),lt=({report:l,onClose:t})=>{const{toast:o}=ue(),[n,u]=T.useState(!1);if(!l)return null;const h=(a,m)=>{const i=(d,s=16)=>d?.length>s?d.slice(0,s)+"â€¦":d;switch(a){case"bar":return e.jsx(J,{width:"100%",height:300,children:e.jsxs(Pe,{data:m,margin:{top:8,right:16,bottom:32,left:8},children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",tickFormatter:d=>i(d),interval:"preserveEnd"}),e.jsx(le,{}),e.jsx(K,{}),e.jsx(W,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),e.jsx(Oe,{dataKey:"value",fill:"#3B82F6"})]})});case"line":return e.jsx(J,{width:"100%",height:300,children:e.jsxs(Me,{data:m,margin:{top:8,right:16,bottom:32,left:8},children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",tickFormatter:d=>i(d),interval:"preserveEnd"}),e.jsx(le,{}),e.jsx(K,{}),e.jsx(W,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),e.jsx(ze,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2})]})});case"pie":return e.jsx(J,{width:"100%",height:300,children:e.jsxs(qe,{children:[e.jsx(Be,{data:m,cx:"50%",cy:"50%",labelLine:!1,label:d=>`${i(d.name)}: ${d.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:m.map((d,s)=>e.jsx(Le,{fill:ce[s%ce.length]},`cell-${s}`))}),e.jsx(K,{}),e.jsx(W,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}})]})});default:return null}},x=()=>{try{let a="";a+=`${l.title||l.templateName}
`,a+=`Gerado em: ${new Date(l.generatedAt).toLocaleString("pt-BR")}

`,l.summary&&(a+=`RESUMO
`,Object.entries(l.summary).forEach(([p,c])=>{a+=`"${p}","${c}"
`}),a+=`
`),l.tables&&l.tables.length>0&&l.tables.forEach((p,c)=>{a+=`${p.title}
`,a+=p.headers.join(",")+`
`,p.rows.forEach(j=>{a+=j.map(C=>{const b=typeof C=="object"?JSON.stringify(C):String(C??"");return/[",\n]/.test(b)?'"'+b.replace(/"/g,'""')+'"':b}).join(","),a+=`
`}),a+=`
`}),l.details&&Array.isArray(l.details)&&(a+=`DETALHES
`,l.details.forEach((p,c)=>{a+=`
${p.className} - ${p.subject}
`,a+=`Atividades: ${p.activities}, MÃ©dia: ${p.avgGrade}, FrequÃªncia: ${p.attendanceRate}%
`,p.details&&p.details.length>0&&(a+=`Atividade,Nota,Valor,Data,Status
`,p.details.forEach(j=>{a+=`"${j.activityName}","${j.grade}","${j.maxGrade}","${j.date}","${j.status}"
`}))}));const m=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(m),d=document.createElement("a"),s=(l.title||l.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");d.href=i,d.download=`${s}-${Date.now()}.csv`,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(i),o({title:"Exportado (CSV)",description:"Arquivo CSV baixado com sucesso."})}catch{o({variant:"destructive",title:"Falha na exportaÃ§Ã£o",description:"Tente novamente."})}},g=()=>{u(!0),setTimeout(()=>{window.print(),setTimeout(()=>u(!1),100)},100)};return e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:!0,global:!0,children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .print-content, .print-content * {
            visibility: visible;
          }
          .print-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white !important;
            color: black !important;
          }
          .print-content .dark\\:bg-slate-900 {
            background: white !important;
          }
          .print-content .dark\\:text-white {
            color: black !important;
          }
          .print-content .dark\\:text-slate-200 {
            color: black !important;
          }
          .print-content .dark\\:border-slate-700 {
            border-color: #e2e8f0 !important;
          }
          .no-print {
            display: none !important;
          }
          .print-break {
            page-break-after: always;
          }
          .avoid-break {
            page-break-inside: avoid;
          }
        }
      `}),e.jsx("div",{className:`fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 overflow-auto no-print ${n?"opacity-0 pointer-events-none":""}`,children:e.jsxs(F,{className:"w-full max-w-6xl max-h-[90vh] overflow-auto bg-white dark:bg-slate-900 print-content",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between z-10 no-print",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white break-words pr-4",children:e.jsx(P,{text:l.title||l.templateName,maxLength:50})}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Gerado em ",new Date(l.generatedAt).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:async()=>{try{const a=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),m=URL.createObjectURL(a),i=l.title||l.templateName||"RelatÃ³rio";navigator.share?await navigator.share({title:i,text:i,url:m}):(await navigator.clipboard.writeText(m),o({title:"Link copiado",description:"Link do relatÃ³rio copiado para a Ã¡rea de transferÃªncia."}))}catch{o({variant:"destructive",title:"Falha ao compartilhar",description:"Tente novamente."})}},children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),e.jsx($,{variant:"ghost",size:"sm",onClick:t,children:e.jsx(pe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[l.summary&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 avoid-break",children:Object.entries(l.summary).map(([a,m])=>e.jsxs(F,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:a.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-white mt-1 break-words",children:typeof m=="string"&&m.length>20?e.jsx(P,{text:m,maxLength:20}):typeof m=="number"?m.toFixed(1):m})]},a))}),l.charts&&l.charts.map((a,m)=>e.jsxs(F,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:a.title}),h(a.type,a.data)]},m)),l.tables&&l.tables.map((a,m)=>e.jsxs(F,{className:"p-6 avoid-break",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:a.title}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:a.headers.map((i,d)=>e.jsx("th",{className:"text-left p-2 font-semibold",children:i},d))})}),e.jsx("tbody",{children:a.rows.map((i,d)=>e.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:i.map((s,p)=>e.jsx("td",{className:"p-2 max-w-xs",children:typeof s=="string"&&s.length>30?e.jsx(P,{text:s,maxLength:30}):s},p))},d))})]})})]},m)),l.details&&Array.isArray(l.details)&&l.templateName==="Boletim Individual"&&e.jsx("div",{className:"space-y-6 avoid-break",children:l.details.map((a,m)=>e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200",children:e.jsx(P,{text:a.className,maxLength:40})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:a.subject})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Atividades"}),e.jsx("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-300",children:a.activities})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"MÃ©dia"}),e.jsx("p",{className:"text-lg font-bold text-green-800 dark:text-green-300",children:a.avgGrade})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:"FrequÃªncia"}),e.jsxs("p",{className:"text-lg font-bold text-purple-800 dark:text-purple-300",children:[a.attendanceRate,"%"]})]}),e.jsxs("div",{className:"text-center p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Maior Nota"}),e.jsx("p",{className:"text-lg font-bold text-amber-800 dark:text-amber-300",children:a.maxGrade})]})]}),a.details&&a.details.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2 text-slate-800 dark:text-slate-200",children:"Atividades Avaliadas:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left p-2",children:"Atividade"}),e.jsx("th",{className:"text-left p-2",children:"Nota"}),e.jsx("th",{className:"text-left p-2",children:"Valor"}),e.jsx("th",{className:"text-left p-2",children:"Data"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:a.details.map((i,d)=>e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:[e.jsx("td",{className:"p-2 max-w-xs",children:e.jsx(P,{text:i.activityName,maxLength:30})}),e.jsx("td",{className:"p-2 font-semibold",children:i.grade}),e.jsx("td",{className:"p-2 text-slate-600 dark:text-slate-400",children:i.maxGrade}),e.jsx("td",{className:"p-2",children:i.date}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${i.status==="No prazo"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300"}`,children:i.status})})]},d))})]})})]})]},m))}),l.details&&Array.isArray(l.details)&&l.templateName!=="Boletim Individual"&&e.jsxs(F,{className:"p-6 avoid-break",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detalhes"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:Object.keys(l.details[0]||{}).map((a,m)=>e.jsx("th",{className:"text-left p-2 font-semibold capitalize",children:a.replace(/([A-Z])/g," $1").trim()},m))})}),e.jsx("tbody",{children:l.details.map((a,m)=>e.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:Object.values(a).map((i,d)=>e.jsx("td",{className:"p-2 max-w-xs",children:typeof i=="string"&&i.length>30?e.jsx(P,{text:i,maxLength:30}):i},d))},m))})]})})]}),l.observations&&e.jsxs(F,{className:"p-6 avoid-break",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:l.observations})]})]})]})})]})};class nt{constructor(){this.enabled=!1,this.url="https://comic-mudfish-15106.upstash.io",this.token="ATsCAAIncDIxMzViNjFkMDQ0Zjk0NGU3YTljYjlhNTM2YTRhZDM1NXAyMTUxMDY",this.url&&this.token?(this.enabled=!0,console.log("[Cache] âœ… Upstash Redis configurado")):(console.warn("[Cache] âš ï¸  Upstash Redis nÃ£o configurado - cache desabilitado"),console.warn("[Cache] Configure VITE_UPSTASH_REDIS_REST_URL e VITE_UPSTASH_REDIS_REST_TOKEN"))}async get(t){if(!this.enabled)return null;try{const o=await fetch(`${this.url}/get/${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();if(n.result===null)return console.log(`[Cache] âŒ Miss: ${t}`),null;console.log(`[Cache] âœ… Hit: ${t}`);try{return JSON.parse(n.result)}catch{return n.result}}catch(o){return console.error(`[Cache] Erro ao buscar ${t}:`,o),null}}async set(t,o,n=300){if(!this.enabled)return!1;try{const u=typeof o=="string"?o:JSON.stringify(o),h=await fetch(`${this.url}/set/${encodeURIComponent(t)}/${encodeURIComponent(u)}?EX=${n}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return console.log(`[Cache] ðŸ’¾ Saved: ${t} (TTL: ${n}s)`),!0}catch(u){return console.error(`[Cache] Erro ao salvar ${t}:`,u),!1}}async del(t){if(!this.enabled)return!1;try{const o=await fetch(`${this.url}/del/${encodeURIComponent(t)}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return console.log(`[Cache] ðŸ—‘ï¸  Deleted: ${t}`),!0}catch(o){return console.error(`[Cache] Erro ao deletar ${t}:`,o),!1}}async invalidatePattern(t){if(!this.enabled)return!1;try{const o=await fetch(`${this.url}/keys/${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const u=(await o.json()).result||[];if(u.length===0)return console.log(`[Cache] ðŸ” No keys found for pattern: ${t}`),!0;const h=u.map(x=>this.del(x));return await Promise.all(h),console.log(`[Cache] ðŸ§¹ Invalidated ${u.length} keys matching: ${t}`),!0}catch(o){return console.error(`[Cache] Erro ao invalidar padrÃ£o ${t}:`,o),!1}}async remember(t,o,n=300){const u=await this.get(t);if(u!==null)return u;const h=await o();return await this.set(t,h,n),h}async flush(){if(!this.enabled)return!1;try{const t=await fetch(`${this.url}/flushdb`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return console.log("[Cache] ðŸš¨ Cache completamente limpo (FLUSH)"),!0}catch(t){return console.error("[Cache] Erro ao limpar cache:",t),!1}}getStatus(){return{enabled:this.enabled,hasCredentials:!!(this.url&&this.token),url:this.url?this.url.replace(/https?:\/\//,"").split(".")[0]+"...":"nÃ£o configurado"}}}const de=new nt,me=[{id:"individual-student",name:"RelatÃ³rio Individual de Aluno",description:"RelatÃ³rio completo de um aluno especÃ­fico",icon:Ve,color:"from-blue-500 to-cyan-500",includes:["Dados pessoais","HistÃ³rico de notas","FrequÃªncia","Feedbacks recebidos","GrÃ¡ficos de evoluÃ§Ã£o","AnÃ¡lise de desempenho"],usage:"ReuniÃ£o com pais, coordenaÃ§Ã£o",popular:!0},{id:"class-report",name:"RelatÃ³rio de Turma",description:"AnÃ¡lise completa de uma turma",icon:He,color:"from-purple-500 to-pink-500",includes:["EstatÃ­sticas gerais","DistribuiÃ§Ã£o de notas","Taxa de aprovaÃ§Ã£o/reprovaÃ§Ã£o","MÃ©dia da turma","Alunos em destaque","Ãreas de atenÃ§Ã£o"],usage:"Fechamento de semestre, relatÃ³rios institucionais",popular:!0},{id:"comparative",name:"RelatÃ³rio Comparativo",description:"ComparaÃ§Ã£o entre mÃºltiplas turmas",icon:at,color:"from-orange-500 to-red-500",includes:["Tabela comparativa","GrÃ¡ficos lado a lado","AnÃ¡lise de diferenÃ§as","Melhores prÃ¡ticas identificadas"],usage:"AnÃ¡lise pedagÃ³gica, ajustes metodolÃ³gicos"},{id:"activity-report",name:"RelatÃ³rio de Atividade",description:"AnÃ¡lise de uma atividade especÃ­fica",icon:Je,color:"from-green-500 to-teal-500",includes:["EstatÃ­sticas de submissÃ£o","DistribuiÃ§Ã£o de notas","QuestÃµes mais erradas","Tempo mÃ©dio de resoluÃ§Ã£o","Lista de notas por aluno"],usage:"ValidaÃ§Ã£o de atividade, ajustes"},{id:"bulletin",name:"Boletim (PerÃ­odo)",description:"Boletim formal por perÃ­odo",icon:X,color:"from-indigo-500 to-purple-500",includes:["Notas por disciplina","MÃ©dias parciais e finais","FrequÃªncia","ObservaÃ§Ãµes do professor","Assinatura"],usage:"Entrega oficial para instituiÃ§Ã£o/pais",popular:!0},{id:"teacher-performance",name:"RelatÃ³rio de Desempenho (Professor)",description:"Auto-avaliaÃ§Ã£o do professor",icon:Ze,color:"from-yellow-500 to-orange-500",includes:["Atividades postadas","CorreÃ§Ãµes realizadas","Tempo mÃ©dio de feedback","SatisfaÃ§Ã£o dos alunos","EvoluÃ§Ã£o das turmas"],usage:"AvaliaÃ§Ã£o institucional, portfÃ³lio"}],ca=()=>{const{user:l}=Se(),{toast:t}=ue(),[o,n]=T.useState(!1),[u,h]=T.useState("templates"),[x,g]=T.useState([]),[a,m]=T.useState(!1),[i,d]=T.useState(null),[s,p]=T.useState(null),[c,j]=T.useState(null),[C,b]=T.useState(null),[G,w]=T.useState("30"),[B,_]=T.useState([]),[O,Q]=T.useState([]),[A,ee]=T.useState(""),[ct,H]=T.useState(!1);T.useEffect(()=>{ge(),be()},[l]);const ge=async()=>{if(l)try{const{data:r,error:f}=await v.from("report_history").select(`
          id,
          template_id,
          template_name,
          filter_type,
          student_id,
          class_id,
          activity_id,
          period,
          created_at,
          report_data
        `).eq("teacher_id",l.id).order("created_at",{ascending:!1}).limit(20);if(f)throw f;g(r||[]),console.log(`âœ… [Reports] ${r?.length||0} relatÃ³rios carregados do histÃ³rico`)}catch(r){D.error("Erro ao carregar histÃ³rico:",r),g([])}},be=async()=>{if(l)try{H(!0);const r=`teacher:reports:data:${l.id}:${G}`,f=await de.get(r);if(f){console.log("âœ… [Reports] Dados carregados do cache"),Q(f.classes||[]),_(f.students||[]),H(!1);return}console.log("ðŸ”„ [Reports] Buscando dados do banco...");const{data:k,error:R}=await v.from("classes").select("id, name, subject").eq("created_by",l.id).eq("is_active",!0).order("name",{ascending:!0});if(R)throw R;Q(k||[]);const{data:y,error:N}=await v.from("class_members").select(`
          user_id,
          profile:profiles!class_members_user_id_fkey(id, full_name, email),
          class:classes!class_members_class_id_fkey(id, name)
        `).in("class_id",k?.map(E=>E.id)||[]).eq("role","student");if(N)throw N;const S=[],L=new Set;y?.forEach(E=>{E.profile&&!L.has(E.profile.id)&&(L.add(E.profile.id),S.push({id:E.profile.id,name:E.profile.full_name,email:E.profile.email,className:E.class?.name}))}),_(S),await de.set(r,{classes:k||[],students:S},300),console.log("ðŸ’¾ [Reports] Dados salvos no cache (TTL: 5min)")}catch(r){D.error("Erro ao carregar dados:",r),t({title:"Erro ao carregar dados",description:r.message,variant:"destructive"})}finally{H(!1)}},fe=r=>r==="comparative"?!1:!!(A==="student"&&["class-report"].includes(r)||A==="class"&&["individual-student"].includes(r)||C&&r!=="activity-report"),ve=async r=>{if(r!=="comparative"){if(!A){t({title:"Selecione o escopo do relatÃ³rio",description:"Escolha se deseja gerar para um aluno, turma ou todos os alunos.",variant:"destructive"});return}if(A==="student"&&!s){t({title:"Selecione um aluno",description:"Escolha qual aluno vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}if(A==="class"&&!c){t({title:"Selecione uma turma",description:"Escolha qual turma vocÃª deseja incluir no relatÃ³rio.",variant:"destructive"});return}}m(!0),d(null);try{let f=l?.id;const k=me.find(y=>y.id===r);if(t({title:`ðŸ“Š Gerando ${k?.name||"RelatÃ³rio"}`,description:"Processando dados... Aguarde."}),A==="student"&&s)f=s;else if(A==="class"&&c)f=c;else if(r==="class-report")if(c)f=c;else{const{data:y}=await v.from("classes").select("id, is_active").eq("created_by",l.id).eq("is_active",!0).order("name",{ascending:!0});if(!y||y.length===0)throw new Error("Nenhuma turma ativa encontrada para gerar o relatÃ³rio.");f=y[0].id}const R=await rt.generateReport(r,f,{period:parseInt(G),includeArchived:!1,filterType:A,studentId:s,classId:c,activityId:C});d(R),t({title:"âœ… RelatÃ³rio Gerado",description:`${R.templateName} gerado com sucesso!`});try{const{error:y}=await v.from("report_history").insert({teacher_id:l.id,template_id:r,template_name:k?.name||"RelatÃ³rio",filter_type:A||null,student_id:s||null,class_id:c||null,activity_id:C||null,period:parseInt(G),report_data:R});y?D.error("Erro ao salvar histÃ³rico:",y):console.log("âœ… RelatÃ³rio salvo no histÃ³rico")}catch(y){D.error("Erro ao salvar histÃ³rico:",y)}g(y=>[{id:Date.now(),templateId:r,templateName:k?.name,generatedAt:new Date().toISOString(),cached:!1,filterType:A,studentId:s,classId:c},...y.slice(0,9)])}catch(f){D.error("Erro ao gerar relatÃ³rio:",f),t({title:"Erro",description:f.message||"NÃ£o foi possÃ­vel gerar o relatÃ³rio",variant:"destructive"})}finally{m(!1)}},je=()=>{h("history")},ye=()=>{t({title:"Em desenvolvimento",description:"Gerenciamento de templates serÃ¡ implementado em breve"})},Ne=r=>{if(!r)return null;if(Array.isArray(r))return r;if(Array.isArray(r?.rows))return r.rows;if(Array.isArray(r?.data))return r.data;if(Array.isArray(r?.items))return r.items;const f=Object.values(r).find(k=>Array.isArray(k));return Array.isArray(f)?f:[r]},we=r=>{if(!r||r.length===0)return"";const f=Array.from(r.reduce((N,S)=>(Object.keys(S||{}).forEach(L=>N.add(L)),N),new Set)),k=N=>{if(N==null)return"";const S=typeof N=="object"?JSON.stringify(N):String(N);return/[",\n]/.test(S)?'"'+S.replace(/"/g,'""')+'"':S},R=f.map(k).join(","),y=r.map(N=>f.map(S=>k(N?.[S])).join(","));return[R,...y].join(`
`)},te=(r,f,k)=>{const R=new Blob([r],{type:k}),y=URL.createObjectURL(R),N=document.createElement("a");N.href=y,N.download=f,document.body.appendChild(N),N.click(),N.remove(),URL.revokeObjectURL(y)},_e=()=>{if(!i){t({title:"Nenhum relatÃ³rio para exportar",description:"Gere um relatÃ³rio primeiro.",variant:"destructive"});return}try{const r=Ne(i).map(R=>{const y={};return Object.entries(R||{}).forEach(([N,S])=>{S&&typeof S=="object"&&!Array.isArray(S)?Object.entries(S).forEach(([L,E])=>{y[`${N}.${L}`]=E}):y[N]=S}),y}),f=we(r);if(!f)throw new Error("NÃ£o hÃ¡ dados tabulares para exportar");const k=(i?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");te(f,`${k}-${Date.now()}.csv`,"text/csv;charset=utf-8;"),t({title:"Exportado com sucesso",description:"Arquivo CSV baixado."})}catch(r){D.warn("CSV export fallback to JSON:",r);const f=(i?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");te(JSON.stringify(i,null,2),`${f}-${Date.now()}.json`,"application/json"),t({title:"Exportado como JSON",description:"NÃ£o foi possÃ­vel gerar CSV. Baixamos o JSON.",variant:"destructive"})}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(Te,{title:"RelatÃ³rios",subtitle:"Gere relatÃ³rios formais e exportÃ¡veis",role:"teacher",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",onClick:je,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"HistÃ³rico"]}),e.jsxs($,{variant:"outline",onClick:ye,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Templates"]}),e.jsxs($,{onClick:()=>t({title:"Selecione um template abaixo"}),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Novo RelatÃ³rio"]})]})}),e.jsx(F,{className:"mt-4 sm:mt-6 p-4 sm:p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-3 sm:gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(Ue,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold mb-2 text-blue-900 dark:text-blue-100",children:"Selecione o Escopo do RelatÃ³rio"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Escolha para quem deseja gerar o relatÃ³rio antes de selecionar um template"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-sm font-medium mb-2 block",children:"Tipo de RelatÃ³rio"}),e.jsxs(z,{value:A,onValueChange:ee,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{placeholder:"Selecione o tipo..."})}),e.jsxs(V,{children:[e.jsx(q,{value:"student",children:"Aluno EspecÃ­fico"}),e.jsx(q,{value:"class",children:"Turma Completa"}),e.jsx(q,{value:"all",children:"Todos os Alunos"})]})]})]}),A==="student"&&e.jsxs("div",{children:[e.jsx(M,{className:"text-sm font-medium mb-2 block",children:"Selecionar Aluno"}),e.jsxs(z,{value:s||"",onValueChange:p,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{placeholder:"Escolha um aluno..."})}),e.jsx(V,{children:B.map(r=>e.jsxs(q,{value:r.id,children:[r.name," ",r.className&&`(${r.className})`]},r.id))})]})]}),A==="class"&&e.jsxs("div",{children:[e.jsx(M,{className:"text-sm font-medium mb-2 block",children:"Selecionar Turma"}),e.jsxs(z,{value:c||"",onValueChange:j,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{placeholder:"Escolha uma turma..."})}),e.jsx(V,{children:O.map(r=>e.jsxs(q,{value:r.id,children:[r.name," ",r.subject&&`- ${r.subject}`]},r.id))})]})]}),e.jsxs("div",{children:[e.jsx(M,{className:"text-sm font-medium mb-2 block",children:"PerÃ­odo"}),e.jsxs(z,{value:G,onValueChange:w,children:[e.jsx(I,{className:"bg-white dark:bg-slate-900",children:e.jsx(U,{})}),e.jsxs(V,{children:[e.jsx(q,{value:"7",children:"Ãšltimos 7 dias"}),e.jsx(q,{value:"30",children:"Ãšltimos 30 dias"}),e.jsx(q,{value:"90",children:"Ãšltimos 90 dias"}),e.jsx(q,{value:"180",children:"Ãšltimos 6 meses"}),e.jsx(q,{value:"365",children:"Ãšltimo ano"})]})]})]})]}),A&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Filtro ativo:"})," ",A==="student"?`Aluno - ${B.find(r=>r.id===s)?.name||"Selecione"}`:A==="class"?`Turma - ${O.find(r=>r.id===c)?.name||"Selecione"}`:"Todos os alunos"]}),e.jsxs($,{variant:"ghost",size:"sm",onClick:()=>{ee(""),p(null),j(null)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]})]})}),e.jsxs(Ae,{value:u,onValueChange:h,className:"mt-6",children:[e.jsxs(Re,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsx(se,{value:"templates",children:"Templates"}),e.jsx(se,{value:"history",children:"HistÃ³rico"})]}),e.jsxs(re,{value:"templates",className:"mt-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:me.map((r,f)=>{const k=r.icon,R=fe(r.id);return e.jsx(Ke.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:f*.1},style:{pointerEvents:"auto"},children:e.jsxs(F,{className:`p-6 h-full flex flex-col hover:shadow-lg transition-shadow relative ${R?"opacity-50":""}`,style:{pointerEvents:"auto"},children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${r.color} opacity-5 group-hover:opacity-10 transition-opacity`}),r.popular&&e.jsxs(ae,{className:"absolute top-4 right-4 bg-yellow-500 text-white",children:[e.jsx(We,{className:"w-3 h-3 mr-1"}),"Popular"]}),e.jsx("div",{className:"mb-4 relative z-10",children:e.jsx("div",{className:`inline-flex p-3 rounded-xl bg-gradient-to-r ${r.color}`,children:e.jsx(k,{className:"w-6 h-6 text-white"})})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:r.name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:r.description}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-2",children:"Inclui:"}),e.jsxs("ul",{className:"space-y-1",children:[r.includes.slice(0,3).map((y,N)=>e.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-center",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mr-2"}),y]},N)),r.includes.length>3&&e.jsxs("li",{className:"text-xs text-blue-600 dark:text-blue-400",children:["+",r.includes.length-3," mais..."]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ae,{variant:"outline",className:"text-xs",children:r.usage})}),e.jsxs("div",{className:"flex gap-2 mt-auto pt-4 relative z-50",children:[e.jsxs($,{className:`flex-1 bg-gradient-to-r ${r.color} text-white hover:opacity-90`,onClick:()=>{if(R){t({title:"Template incompatÃ­vel",description:"Este template nÃ£o Ã© compatÃ­vel com os filtros selecionados.",variant:"destructive"});return}D.debug("BotÃ£o Gerar clicado:",r.id),ve(r.id)},disabled:R,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Gerar"]}),e.jsx($,{variant:"outline",size:"icon",onClick:()=>{D.debug("BotÃ£o Preview clicado"),t({title:"Preview",description:"VisualizaÃ§Ã£o serÃ¡ implementada"})},children:e.jsx(Ye,{className:"w-4 h-4"})})]})]})},r.id)})}),e.jsxs(F,{className:"mt-8 p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Formatos de ExportaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs($,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-red-50 hover:border-red-300 dark:hover:bg-red-950/20",onClick:()=>{D.debug("Exportar PDF clicado"),t({title:"Exportar PDF",description:"Funcionalidade em desenvolvimento"})},children:[e.jsx(X,{className:"w-8 h-8 mb-2 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PDF"})]}),e.jsxs($,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-green-50 hover:border-green-300 dark:hover:bg-green-950/20",onClick:_e,children:[e.jsx(Fe,{className:"w-8 h-8 mb-2 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Excel"})]}),e.jsxs($,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20",onClick:()=>{D.debug("Exportar Word clicado"),t({title:"Exportar Word",description:"Funcionalidade em desenvolvimento"})},children:[e.jsx(X,{className:"w-8 h-8 mb-2 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Word"})]}),e.jsxs($,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-purple-50 hover:border-purple-300 dark:hover:bg-purple-950/20",onClick:()=>{D.debug("Exportar PNG clicado"),t({title:"Exportar PNG",description:"Funcionalidade em desenvolvimento"})},children:[e.jsx(et,{className:"w-8 h-8 mb-2 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PNG"})]})]})]})]}),e.jsx(re,{value:"history",className:"mt-6",children:e.jsx(F,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Nenhum relatÃ³rio gerado ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"RelatÃ³rios que vocÃª gerar aparecerÃ£o aqui para fÃ¡cil acesso"}),e.jsxs($,{onClick:()=>h("templates"),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Gerar Primeiro RelatÃ³rio"]})]})})})]}),i&&e.jsx(lt,{report:i,onClose:()=>d(null)})]})};export{ca as default};
