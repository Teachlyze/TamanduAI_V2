import{b as le,u as re,r as l,s as h,l as V,j as e,q as de}from"./main-CI5_MmIm.js";import{C as v}from"./card-DpcnMbcE.js";import{B as S}from"./button-D7H9d9Gd.js";import{E as oe}from"./EmptyState-ExwS4ndS.js";import{G as ce}from"./GradeCard-Cr5RpGH_.js";import"./dialog-DzyprNmz.js";import{I as ne}from"./input-BJMmyirp.js";import"./jspdf.plugin.autotable-3LNuint4.js";import{S as w,a as k,b as D,c as M,d}from"./select-DSQCR6Pt.js";import{m as B}from"./proxy-CT7Xtxle.js";import{H as I}from"./history-BZuAFu4l.js";import{D as me}from"./download-Crb5Tmz4.js";import{F as xe}from"./file-text-CtozP3gh.js";import{S as q}from"./search-C3Ws2_PV.js";import{f as b}from"./format-BdDrz3ZT.js";import{p as R}from"./pt-BR-C6XVmIDX.js";import"./badge-BOI6M_d9.js";import"./star-6E86D7gV.js";import"./calendar-Dbm_7POQ.js";import"./target-BgYs7ZJ1.js";import"./message-square-dQFvNbyh.js";import"./index-D4BuPd_i.js";import"./index-DHrdJ99Z.js";import"./Combination-BfETjw1A.js";import"./SidebarPremium-0_wHXPj0.js";import"./house-B6Hparzo.js";import"./users-ChR7WEeh.js";import"./book-open-DlGI5eOy.js";import"./graduation-cap-mPfDCRgT.js";import"./chart-column-G5dLAdkQ.js";import"./message-circle-CRpVuYq9.js";import"./settings-BWUwUKXK.js";import"./brain-DVBX4Id_.js";import"./index-RHGs5twt.js";import"./chevron-right-CHSrP1xQ.js";import"./x-DGmYUGM5.js";import"./index-CRRraFTu.js";import"./index-CtvfaZbL.js";import"./index-DrPD6SFW.js";import"./chevron-down-DXVEpPD6.js";import"./check-GhIpAKm1.js";import"./chevron-up-CrZ13wWo.js";import"./en-US-ChNhCS9W.js";const at=()=>{const{user:f}=le(),C=re(),[H,A]=l.useState(!0),[E,$]=l.useState(!0),[_,z]=l.useState([]),[y,O]=l.useState([]),[n,Q]=l.useState(""),[m,U]=l.useState("all"),[x,W]=l.useState("all"),[o,J]=l.useState("all"),[K,X]=l.useState([]),[u,Y]=l.useState({total:0,completed:0,avgGrade:0,highestGrade:0});l.useEffect(()=>{f?.id&&(ee(),Z())},[f]),l.useEffect(()=>{te()},[_,n,m,x,o]);const Z=async()=>{try{const{data:t}=await h.from("class_members").select("class_id").eq("user_id",f.id).eq("role","student"),i=t?.map(c=>c.class_id)||[],{data:s}=await h.from("classes").select("id, name, subject").in("id",i);X(s||[])}catch(t){V.error("Erro ao carregar turmas:",t)}},ee=async()=>{try{A(!0);const{data:t}=await h.from("submissions").select("id, activity_id, status, grade, feedback, submitted_at, created_at").eq("student_id",f.id).order("submitted_at",{ascending:!1}),i=t?.map(a=>a.activity_id)||[],{data:s}=await h.from("activities").select("id, title, type, max_score").in("id",i),c={};s?.forEach(a=>{c[a.id]=a});const{data:p}=await h.from("activity_class_assignments").select("activity_id, class_id").in("activity_id",i),r=p?.map(a=>a.class_id).filter(Boolean)||[],{data:se}=await h.from("classes").select("id, name").in("id",r),G={};se?.forEach(a=>{G[a.id]=a});const L={};p?.forEach(a=>{L[a.activity_id]={class_id:a.class_id,class_name:G[a.class_id]?.name}});const N=(t||[]).map(a=>{const j=c[a.activity_id],P=L[a.activity_id];return{...a,activity_title:j?.title,activity_type:j?.type,max_score:j?.max_score,class_id:P?.class_id,class_name:P?.class_name}}),F=N.filter(a=>a.grade!==null),g=F.map(a=>parseFloat(a.grade)).filter(a=>!isNaN(a)),ie={total:N.length,completed:F.length,avgGrade:g.length>0?g.reduce((a,j)=>a+j,0)/g.length:0,highestGrade:g.length>0?Math.max(...g):0};Y(ie),z(N)}catch(t){V.error("Erro ao carregar histÃ³rico:",t)}finally{A(!1),E&&$(!1)}},te=()=>{let t=[..._];if(n){const i=n.toLowerCase();t=t.filter(s=>s.activity_title?.toLowerCase().includes(i)||s.class_name?.toLowerCase().includes(i))}if(m!=="all"&&(t=t.filter(i=>i.class_id===m)),x!=="all"&&(t=t.filter(i=>i.status===x)),o!=="all"){const i=new Date;let s=new Date;o==="week"?s.setDate(i.getDate()-7):o==="month"?s.setMonth(i.getMonth()-1):o==="semester"&&s.setMonth(i.getMonth()-6),t=t.filter(c=>new Date(c.submitted_at)>=s)}O(t)},T=()=>{const t=_.map(s=>({Atividade:s.activity_title,Turma:s.class_name,Data:new Date(s.submitted_at).toLocaleDateString("pt-BR"),Nota:s.grade||"-","Nota MÃ¡xima":s.max_score,Status:s.status==="graded"?"Avaliada":s.status==="pending"?"Pendente":"Submetida"})),i=[{header:"Atividade",key:"Atividade"},{header:"Turma",key:"Turma"},{header:"Data",key:"Data"},{header:"Nota",key:"Nota"},{header:"Nota MÃ¡xima",key:"Nota MÃ¡xima"},{header:"Status",key:"Status"}];T(t,`historico-${b(new Date,"yyyy-MM-dd")}`,i,{subtitle:`Aluno: ${f?.user_metadata?.name||"Nome do Aluno"}`})},ae=()=>{const t=y.map(r=>({Data:b(new Date(r.submitted_at),"dd/MM/yyyy",{locale:R}),Atividade:r.activity_title,Turma:r.class_name,Nota:r.grade||"-","Nota MÃ¡xima":r.max_score,Status:r.status==="graded"?"Avaliada":r.status==="pending"?"Pendente":"Submetida"})),i=[Object.keys(t[0]).join(","),...t.map(r=>Object.values(r).join(","))].join(`
`),s=new Blob([i],{type:"text/csv"}),c=URL.createObjectURL(s),p=document.createElement("a");p.href=c,p.download=`historico-${b(new Date,"yyyy-MM-dd")}.csv`,p.click()};return H&&E?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(de,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsx(B.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(I,{className:"w-8 h-8 text-purple-600"}),"HistÃ³rico de Atividades"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Acompanhe todo o seu histÃ³rico acadÃªmico"})]}),e.jsxs(S,{onClick:ae,disabled:y.length===0,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:T,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Exportar PDF"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(v,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Total de SubmissÃµes"}),e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:u.total})]}),e.jsxs(v,{className:"p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Avaliadas"}),e.jsx("div",{className:"text-3xl font-bold text-green-600",children:u.completed})]}),e.jsxs(v,{className:"p-6 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"MÃ©dia Geral"}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:u.avgGrade>0?u.avgGrade.toFixed(1):"--"})]}),e.jsxs(v,{className:"p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Maior Nota"}),e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:u.highestGrade>0?u.highestGrade.toFixed(1):"--"})]})]}),e.jsx(v,{className:"p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(ne,{placeholder:"Buscar por atividade ou turma...",value:n,onChange:t=>Q(t.target.value),className:"pl-10"})]})}),e.jsxs(w,{value:m,onValueChange:U,children:[e.jsx(k,{className:"w-full md:w-48",children:e.jsx(D,{placeholder:"Todas as turmas"})}),e.jsxs(M,{children:[e.jsx(d,{value:"all",children:"Todas as turmas"}),K.map(t=>e.jsx(d,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(w,{value:x,onValueChange:W,children:[e.jsx(k,{className:"w-full md:w-48",children:e.jsx(D,{placeholder:"Todos os status"})}),e.jsxs(M,{children:[e.jsx(d,{value:"all",children:"Todos os status"}),e.jsx(d,{value:"graded",children:"âœ… Avaliadas"}),e.jsx(d,{value:"submitted",children:"ğŸ“¤ Submetidas"}),e.jsx(d,{value:"pending",children:"â³ Pendentes"})]})]}),e.jsxs(w,{value:o,onValueChange:J,children:[e.jsx(k,{className:"w-full md:w-48",children:e.jsx(D,{placeholder:"Todo o perÃ­odo"})}),e.jsxs(M,{children:[e.jsx(d,{value:"all",children:"Todo o perÃ­odo"}),e.jsx(d,{value:"week",children:"Ãšltima semana"}),e.jsx(d,{value:"month",children:"Ãšltimo mÃªs"}),e.jsx(d,{value:"semester",children:"Ãšltimo semestre"})]})]})]})}),y.length>0?e.jsx("div",{className:"space-y-4",children:y.map((t,i)=>{const s={id:t.id,activity_title:t.activity_title,class_name:t.class_name,grade:t.grade,max_score:t.max_score,feedback:t.feedback,submitted_at:t.submitted_at,activity_id:t.activity_id};return t.grade?e.jsx(ce,{grade:s,onViewDetails:()=>C(`/students/activities/${t.activity_id}`),index:i},t.id):e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.05},children:e.jsx(v,{className:"p-6 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:t.activity_title||"Atividade"}),t.class_name&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:t.class_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsxs("span",{children:["Submetido em ",b(new Date(t.submitted_at),"dd 'de' MMMM",{locale:R})]}),e.jsx("span",{className:"px-2 py-1 rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:t.status==="pending"?"â³ Aguardando correÃ§Ã£o":"ğŸ“¤ Submetida"})]})]}),e.jsx(S,{onClick:()=>C(`/students/activities/${t.activity_id}`),variant:"outline",size:"sm",children:"Ver Detalhes"})]})})},t.id)})}):e.jsx(oe,{icon:n||m!=="all"||x!=="all"||o!=="all"?q:I,title:n||m!=="all"||x!=="all"||o!=="all"?"Nenhum resultado encontrado":"Nenhuma submissÃ£o ainda",description:n||m!=="all"||x!=="all"||o!=="all"?"Tente ajustar os filtros de busca para encontrar o que procura.":"VocÃª ainda nÃ£o submeteu nenhuma atividade. Comece a responder suas atividades!",variant:"default"})]})};export{at as default};
