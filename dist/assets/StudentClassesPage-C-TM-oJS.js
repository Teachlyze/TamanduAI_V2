import{c as M,u as B,a as A,r,s as l,l as m,j as e,m as J}from"./main-BXI8jImK.js";import{B as h,m as g}from"./button-DhJSXayK.js";import{C as k}from"./card-Dts-jKab.js";import{I as U}from"./input-YtE9-IyT.js";import{D as z}from"./DashboardHeader-BC80IxDW.js";import{S as P}from"./SearchInput-B8_MbpHy.js";import"./dropdown-menu-7nHS86TP.js";import"./label-DZTyMoK9.js";import{B as _}from"./book-open-BMCImb8A.js";import{U as V}from"./users-1MVt23UL.js";import{C as F}from"./index-Cyt6Mlq7.js";import{X as O}from"./x-DhRNfShw.js";import"./search-BE_TttKm.js";import"./index-laUz9pSU.js";import"./index-D63a-v4Z.js";import"./Combination-7NRWB7dp.js";import"./index-PCXR_M5s.js";import"./chevron-right-DFiBXpQq.js";import"./check-P2w7Pyl_.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],E=M("log-in",H),de=()=>{const S=B(),{user:n}=A(),[D,j]=r.useState(!0),[L,T]=r.useState([]),[b,q]=r.useState(""),[I,i]=r.useState(!1),[f,c]=r.useState(""),[p,v]=r.useState(!1),[w,a]=r.useState("");r.useEffect(()=>{N()},[n]);const N=async()=>{if(n)try{j(!0);const{data:s}=await l.from("class_members").select(`
          class_id,
          joined_at,
          classes:class_id (
            id,
            name,
            subject,
            color,
            banner_color,
            created_by,
            teacher:created_by (
              id,
              full_name
            )
          )
        `).eq("user_id",n.id).eq("role","student").order("joined_at",{ascending:!1}),t=await Promise.all((s||[]).map(async u=>{const o=u.classes;if(!o)return null;const{count:d}=await l.from("class_members").select("id",{count:"exact",head:!0}).eq("class_id",o.id),{count:x}=await l.from("activity_class_assignments").select("id",{count:"exact",head:!0}).eq("class_id",o.id);return{...o,memberCount:d||0,activityCount:x||0}}));T(t.filter(Boolean))}catch(s){m.error("Erro:",s)}finally{j(!1)}},C=async()=>{const s=f.replace(/\s/g,"").trim().toUpperCase();if(!s){a("Digite o cÃ³digo da turma");return}if(s.length>12){a("CÃ³digo invÃ¡lido (mÃ¡ximo 12 caracteres)");return}try{v(!0),a("");const{data:t,error:u}=await l.from("classes").select("id, name").ilike("invite_code",s).maybeSingle();if(u||!t){m.error("Erro ao buscar turma:",u),a("CÃ³digo invÃ¡lido! Verifique se digitou corretamente.");return}m.debug("âœ… Turma encontrada:",t);const{data:o}=await l.from("class_members").select("id").eq("class_id",t.id).eq("user_id",n.id).single();if(o){a("VocÃª jÃ¡ estÃ¡ nesta turma!");return}const{data:d,error:x}=await l.from("class_members").insert({class_id:t.id,user_id:n.id,role:"student",joined_at:new Date().toISOString()}).select();if(x)throw x;if(!d||d.length===0)throw new Error("Falha ao adicionar vocÃª Ã  turma");m.debug("âœ… VocÃª entrou na turma:",d[0]),i(!1),c(""),a(""),await N(),alert(`ðŸŽ‰ VocÃª entrou na turma "${t.name}" com sucesso!

A turma jÃ¡ aparece na sua lista.`)}catch(t){m.error("Erro ao entrar na turma:",t),a("Erro ao entrar na turma. Tente novamente.")}finally{v(!1)}},y=L.filter(s=>s.name?.toLowerCase().includes(b.toLowerCase())||s.subject?.toLowerCase().includes(b.toLowerCase()));return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(J,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-slate-200 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-6",children:[e.jsx(z,{title:"Minhas Turmas",subtitle:"Acompanhe suas turmas e atividades",role:"student"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center justify-between gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(P,{value:b,onChange:s=>q(s.target.value),placeholder:"Buscar turmas..."})}),e.jsxs(h,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white shadow-lg flex-shrink-0",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Entrar com CÃ³digo"]})]}),y.length>0?e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map((s,t)=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsxs(k,{onClick:()=>S(`/students/classes/${s.id}`),className:"overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-200 border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-r from-blue-600 to-cyan-500 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(_,{className:"w-12 h-12 text-white opacity-90"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white line-clamp-2",children:s.name})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:s.subject||"Disciplina nÃ£o informada"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.memberCount||0," ",s.memberCount===1?"membro":"membros"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.activityCount||0," ",s.activityCount===1?"atividade":"atividades"]})]})]})]})]})},s.id))}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(_,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"Nenhuma turma ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Entre em uma turma usando um cÃ³digo de acesso"}),e.jsxs(h,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Entrar em uma Turma"]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{i(!1),c(""),a("")},children:e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:s=>s.stopPropagation(),children:e.jsxs(k,{className:"p-8 max-w-md w-full bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Entrar em uma Turma"}),e.jsx("button",{onClick:()=>{i(!1),c(""),a("")},className:"p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(O,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Digite o cÃ³digo fornecido pelo professor"}),e.jsxs("div",{className:"mb-6",children:[e.jsx(U,{value:f,onChange:s=>{const t=s.target.value.toUpperCase();t.length<=8&&(c(t),a(""))},onKeyPress:s=>{s.key==="Enter"&&C()},placeholder:"CÃ“DIGO DA TURMA",maxLength:8,className:"text-center text-2xl font-mono tracking-widest uppercase h-14 border-2 focus:border-blue-500",autoFocus:!0}),w&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 text-center",children:w})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>{i(!1),c(""),a("")},className:"flex-1 border-slate-300 dark:border-slate-700",disabled:p,children:"Cancelar"}),e.jsx(h,{onClick:C,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",disabled:p||!f.trim(),children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Entrando..."]}):"Entrar"})]})]})})})]})};export{de as default};
