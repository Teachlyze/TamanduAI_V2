import{b as he,u as fe,r as d,s as o,l as I,j as e,q as ge}from"./main-BSajwT7t.js";import{C as y}from"./card-Bocxgg1Q.js";import{B as ue}from"./badge-CfC7p-Az.js";import{B as _}from"./button-49_9eRW2.js";import{E as z}from"./EventCard-ayT1TdPw.js";import{E as $}from"./EmptyState-BIeHtL9h.js";import"./dialog-CToh4lty.js";import{m as w}from"./proxy-Bb-A2TUD.js";import{C as k}from"./calendar-DetO6w5d.js";import{C as ve}from"./index-D0BS1fLY.js";import{C as be}from"./chevron-right-DUVlURpD.js";import{C as P}from"./clock-DUfJelbJ.js";import{F as H}from"./file-text-Bwu_iaa-.js";import{M as je}from"./map-pin-Ed5qSEFg.js";import{V as B}from"./video-GMK5YjAg.js";import{s as L,i as ye,a as _e}from"./isSameMonth-DXWacbVA.js";import{e as R}from"./endOfMonth-B3jF8fTW.js";import{s as T,c as Ne,f as x}from"./format-B5colFmK.js";import{e as F}from"./endOfDay-BZ13SNr-.js";import{e as we}from"./endOfWeek-r8OyeZbF.js";import{e as ke,s as Ee}from"./subMonths-CcPB7G76.js";import{i as Se}from"./isSameDay-D48s9Jab.js";import{i as A}from"./isToday-Cwn90TaQ.js";import{i as Me}from"./isPast-DRdJRFoN.js";import{p as g}from"./pt-BR-D0BJ_iDf.js";import"./index-BSMAqeIB.js";import"./Combination-DKLEa6f3.js";import"./SidebarPremium-C1f4icTt.js";import"./house-BkBGIUz8.js";import"./users-De1bkoUV.js";import"./book-open-BqVBcqQl.js";import"./graduation-cap-pwvok64K.js";import"./chart-column-BmPD_DCR.js";import"./message-circle-DVaucFfj.js";import"./settings-Blsx5C_z.js";import"./brain-BPIciAtW.js";import"./index-DV-1B3c4.js";import"./x-Wvu9FBm3.js";import"./en-US-DaE-csDX.js";import"./constructNow-BZVcxkR5.js";const ut=()=>{const{user:u}=he(),q=fe(),[Q,E]=d.useState(!0),[S,V]=d.useState(!0),[r,N]=d.useState(new Date),[p,M]=d.useState(new Date),[h,W]=d.useState([]),[C,G]=d.useState([]),[Ce,De]=d.useState("all"),[a,v]=d.useState(null);d.useEffect(()=>{u?.id&&J()},[u,r]),d.useEffect(()=>{K(p)},[p,h]);const J=async()=>{try{E(!0);const{data:t}=await o.from("class_members").select("class_id").eq("user_id",u.id).eq("role","student"),i=t?.map(s=>s.class_id)||[],l=L(r),n=R(r),{data:m}=await o.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, class_id, activity_id").in("class_id",i).gte("start_time",l.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0}),{data:c,error:f}=await o.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, attendees, class_id, created_by, activity_id").contains("attendees",[u.id]).gte("start_time",l.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0});f&&I.error("[Calendar] Erro ao buscar eventos como participante:",f);const{data:b}=await o.from("activity_class_assignments").select("activity_id, class_id").in("class_id",i),ne=b?.map(s=>s.activity_id)||[],{data:de}=await o.from("activities").select("id, title, due_date").in("id",ne).gte("due_date",l.toISOString()).lte("due_date",n.toISOString()),{data:me}=await o.from("classes").select("id, name").in("id",i),j={};me?.forEach(s=>{j[s.id]=s});const O=new Set,ce=[...(m||[]).map(s=>({...s,class_name:j[s.class_id]?.name,event_type:"class_event"})),...(c||[]).map(s=>({...s,class_name:j[s.class_id]?.name,event_type:"meeting"}))].filter(s=>O.has(s.id)?!1:(O.add(s.id),!0)),oe=(de||[]).map(s=>{const xe=b.find(pe=>pe.activity_id===s.id);return{id:`activity-${s.id}`,title:s.title,start_time:s.due_date,end_time:s.due_date,type:"deadline",class_name:j[xe?.class_id]?.name,event_type:"activity_deadline",activity_id:s.id}});W([...ce,...oe])}catch(t){I.error("Erro ao carregar eventos:",t)}finally{E(!1),S&&V(!1)}},K=t=>{const i=T(t),l=F(t),n=h.filter(m=>{const c=new Date(m.start_time);return c>=i&&c<=l});G(n)},U=t=>{const i=T(t),l=F(t);return h.filter(n=>{const m=new Date(n.start_time);return m>=i&&m<=l})},D=t=>{v(t)},X=()=>{N(Ee(r))},Y=()=>{N(_e(r,1))},Z=()=>{const t=new Date;N(t),M(t)},ee=L(r),te=R(r),se=Ne(ee,{weekStartsOn:0}),ae=we(te,{weekStartsOn:0}),ie=ke({start:se,end:ae}),re=["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"],le=t=>t?t.activity_id||t.type==="activity"?"Atividade":t.event_type==="activity_deadline"||t.type==="deadline"?"Prazo de atividade":t.event_type==="meeting"||t.type==="meeting"?"Reuni√£o":t.event_type==="class_event"?"Evento da turma":"Evento":"Evento";return Q&&S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ge,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-3 sm:p-4 md:p-6",children:[e.jsxs(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 md:mb-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-2 sm:gap-3",children:[e.jsx(k,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-600"}),"Minha Agenda"]}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-400",children:"Eventos, reuni√µes e prazos de atividades"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-0 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-between sm:justify-start",children:[e.jsx(_,{onClick:X,variant:"outline",size:"sm",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 dark:text-white text-center capitalize",children:x(r,"MMMM yyyy",{locale:g})}),e.jsx(_,{onClick:Y,variant:"outline",size:"sm",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsx(_,{onClick:Z,variant:"default",size:"sm",className:"w-full sm:w-auto",children:"Hoje"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs(y,{className:"p-3 sm:p-4 md:p-6 lg:col-span-2",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-2 sm:mb-4",children:re.map(t=>e.jsx("div",{className:"text-center font-bold text-slate-600 dark:text-slate-400 text-[10px] sm:text-xs md:text-sm py-1 sm:py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:ie.map(t=>{const i=U(t),l=ye(t,r),n=Se(t,p),m=A(t),c=Me(t)&&!m;return e.jsxs(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>M(t),className:`
                    w-full h-14 sm:h-20 md:h-24 p-2 sm:p-3 rounded-lg border sm:border-2 transition-all flex flex-col items-center justify-center
                    ${l?"bg-white dark:bg-slate-800":"bg-slate-100 dark:bg-slate-900"}
                    ${n?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-transparent"}
                    ${m?"ring-1 sm:ring-2 ring-blue-500":""}
                    ${c?"opacity-50":""}
                    hover:border-blue-300 dark:hover:border-blue-700
                  `,children:[e.jsx("div",{className:`
                    text-xs sm:text-sm font-semibold mb-0.5 sm:mb-1
                    ${n?"text-blue-600":"text-slate-900 dark:text-white"}
                    ${l?"":"text-slate-400"}
                  `,children:x(t,"d")}),i.length>0&&e.jsxs("div",{className:"hidden sm:flex flex-wrap gap-0.5 justify-center",children:[i.slice(0,3).map((f,b)=>e.jsx("div",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${f.type==="deadline"?"bg-red-500":f.type==="meeting"?"bg-purple-500":"bg-blue-500"}`},b)),i.length>3&&e.jsxs("div",{className:"text-[10px] text-slate-500",children:["+",i.length-3]})]})]},t.toString())})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-6 mt-4 sm:mt-6 pt-4 sm:pt-6 border-t",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Eventos"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-purple-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Reuni√µes"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Prazos"})]})]})]}),e.jsxs(y,{className:"p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600"}),A(p)?"Hoje":x(p,"dd 'de' MMMM",{locale:g})]}),C.length>0?e.jsx("div",{className:"space-y-3",children:C.map((t,i)=>e.jsx(z,{event:t,onClick:()=>D(t),index:i},t.id))}):e.jsx($,{icon:k,title:"Nenhum evento",description:"Nenhum evento agendado para este dia.",variant:"info"})]})]}),e.jsxs(y,{className:"p-4 sm:p-6 mt-4 sm:mt-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-slate-900 dark:text-white mb-4 sm:mb-6 capitalize",children:["üìÖ Eventos de ",x(r,"MMMM",{locale:g})]}),h.length>0?e.jsx("div",{className:"space-y-4",children:h.sort((t,i)=>new Date(t.start_time)-new Date(i.start_time)).map((t,i)=>e.jsx(z,{event:t,onClick:()=>D(t),index:i},t.id))}):e.jsx($,{icon:k,title:"Nenhum evento este m√™s",description:"N√£o h√° eventos, reuni√µes ou prazos agendados para este m√™s."})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>v(null),children:e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:t=>t.stopPropagation(),children:e.jsx(y,{className:"p-6 sm:p-8 max-w-xl sm:max-w-2xl w-full bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 shadow-2xl",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{children:le(a)}),e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white",children:a.title}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400",children:x(new Date(a.start_time),"EEEE, d 'de' MMMM '√†s' HH:mm",{locale:g})})]}),e.jsx("button",{onClick:()=>v(null),className:"text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:"Fechar"})]}),a.description&&e.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-300",children:a.description}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 text-sm sm:text-base",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(P,{className:"w-4 h-4"}),x(new Date(a.start_time),"d 'de' MMMM '√†s' HH:mm",{locale:g})]}),a.class_name&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(H,{className:"w-4 h-4"}),a.class_name]}),a.location&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(je,{className:"w-4 h-4"}),a.location]})]}),e.jsx("div",{className:"space-y-2",children:a.meeting_link&&e.jsxs("a",{href:a.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white text-sm sm:text-base",children:[e.jsx(B,{className:"w-4 h-4"}),"Entrar na reuni√£o"]})})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-800 flex flex-wrap gap-3 justify-end",children:[a.activity_id&&e.jsxs(_,{onClick:()=>{v(null),q(`/students/activities/${a.activity_id}`)},className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Ir para atividade"]}),a.meeting_link&&!a.activity_id&&e.jsxs("a",{href:a.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-200 text-sm sm:text-base hover:bg-slate-50 dark:hover:bg-slate-800",children:[e.jsx(B,{className:"w-4 h-4"}),"Abrir reuni√£o"]})]})]})})})})]})};export{ut as default};
