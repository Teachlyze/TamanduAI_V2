import{b as ie,u as le,r as l,s as h,l as V,j as e,q as re}from"./main-5T23t4PA.js";import{C as v}from"./card-DPEV4PIe.js";import{B as I}from"./button-D1pRabHc.js";import{E as de}from"./EmptyState-DzyWHHQF.js";import{G as ce}from"./GradeCard-FgAGatlh.js";import"./dialog--d34PTGN.js";import{I as oe}from"./input-CtDVRTm_.js";import{S as _,a as N,b as S,c as w,d}from"./select-HrlLxAIu.js";import{m as q}from"./proxy-CTHD_aal.js";import{H as B}from"./history-Ccmr1vnz.js";import{D as ne}from"./download-aE9qC_yh.js";import{S as H}from"./search-CYzgShV8.js";import{f as k}from"./format-BdDrz3ZT.js";import{p as P}from"./pt-BR-C6XVmIDX.js";import"./badge-CHD2ppHT.js";import"./star-BhZKBNOp.js";import"./calendar-BTZ9lOjb.js";import"./target-DSPO5wl1.js";import"./message-square-DDbXWZKq.js";import"./index-BSvf8Gkf.js";import"./index-BEPDIlbQ.js";import"./Combination-CK754xyO.js";import"./SidebarPremium-b8AcD6aG.js";import"./house-C21pZqGK.js";import"./users-BHFcZ460.js";import"./book-open-DbJlkSkE.js";import"./file-text-D1pM-cGT.js";import"./graduation-cap-CGvbZ17f.js";import"./chart-column-CiTHaPgQ.js";import"./message-circle-Bm4-2rso.js";import"./settings-CA-HrSVc.js";import"./brain-dpI-w2IQ.js";import"./index-CcRuMwBB.js";import"./chevron-right-BZvTPqku.js";import"./x-C8LZHbUR.js";import"./index-BYh_3E0O.js";import"./index-Hrv3wGwr.js";import"./index-D8pw72a5.js";import"./chevron-down-C0ABIcLs.js";import"./check-BGvYUlN_.js";import"./chevron-up-B5cmfjQz.js";import"./en-US-ChNhCS9W.js";const Ze=()=>{const{user:j}=ie(),C=le(),[R,M]=l.useState(!0),[D,F]=l.useState(!0),[E,O]=l.useState([]),[b,$]=l.useState([]),[n,z]=l.useState(""),[m,Q]=l.useState("all"),[x,U]=l.useState("all"),[c,W]=l.useState("all"),[J,K]=l.useState([]),[p,X]=l.useState({total:0,completed:0,avgGrade:0,highestGrade:0});l.useEffect(()=>{j?.id&&(Z(),Y())},[j]),l.useEffect(()=>{ee()},[E,n,m,x,c]);const Y=async()=>{try{const{data:t}=await h.from("class_members").select("class_id").eq("user_id",j.id).eq("role","student"),s=t?.map(o=>o.class_id)||[],{data:i}=await h.from("classes").select("id, name, subject").in("id",s);K(i||[])}catch(t){V.error("Erro ao carregar turmas:",t)}},Z=async()=>{try{M(!0);const{data:t}=await h.from("submissions").select("id, activity_id, status, grade, feedback, submitted_at, created_at").eq("student_id",j.id).order("submitted_at",{ascending:!1}),s=t?.map(a=>a.activity_id)||[],{data:i}=await h.from("activities").select("id, title, type, max_score").in("id",s),o={};i?.forEach(a=>{o[a.id]=a});const{data:u}=await h.from("activity_class_assignments").select("activity_id, class_id").in("activity_id",s),r=u?.map(a=>a.class_id).filter(Boolean)||[],{data:ae}=await h.from("classes").select("id, name").in("id",r),G={};ae?.forEach(a=>{G[a.id]=a});const L={};u?.forEach(a=>{L[a.activity_id]={class_id:a.class_id,class_name:G[a.class_id]?.name}});const y=(t||[]).map(a=>{const g=o[a.activity_id],A=L[a.activity_id];return{...a,activity_title:g?.title,activity_type:g?.type,max_score:g?.max_score,class_id:A?.class_id,class_name:A?.class_name}}),T=y.filter(a=>a.grade!==null),f=T.map(a=>parseFloat(a.grade)).filter(a=>!isNaN(a)),se={total:y.length,completed:T.length,avgGrade:f.length>0?f.reduce((a,g)=>a+g,0)/f.length:0,highestGrade:f.length>0?Math.max(...f):0};X(se),O(y)}catch(t){V.error("Erro ao carregar histÃ³rico:",t)}finally{M(!1),D&&F(!1)}},ee=()=>{let t=[...E];if(n){const s=n.toLowerCase();t=t.filter(i=>i.activity_title?.toLowerCase().includes(s)||i.class_name?.toLowerCase().includes(s))}if(m!=="all"&&(t=t.filter(s=>s.class_id===m)),x!=="all"&&(t=t.filter(s=>s.status===x)),c!=="all"){const s=new Date;let i=new Date;c==="week"?i.setDate(s.getDate()-7):c==="month"?i.setMonth(s.getMonth()-1):c==="semester"&&i.setMonth(s.getMonth()-6),t=t.filter(o=>new Date(o.submitted_at)>=i)}$(t)},te=()=>{const t=b.map(r=>({Data:k(new Date(r.submitted_at),"dd/MM/yyyy",{locale:P}),Atividade:r.activity_title,Turma:r.class_name,Nota:r.grade||"-","Nota MÃ¡xima":r.max_score,Status:r.status==="graded"?"Avaliada":r.status==="pending"?"Pendente":"Submetida"})),s=[Object.keys(t[0]).join(","),...t.map(r=>Object.values(r).join(","))].join(`
`),i=new Blob([s],{type:"text/csv"}),o=URL.createObjectURL(i),u=document.createElement("a");u.href=o,u.download=`historico-${k(new Date,"yyyy-MM-dd")}.csv`,u.click()};return R&&D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(re,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsx(q.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(B,{className:"w-8 h-8 text-purple-600"}),"HistÃ³rico de Atividades"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Acompanhe todo o seu histÃ³rico acadÃªmico"})]}),e.jsxs(I,{onClick:te,disabled:b.length===0,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(v,{className:"p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Total de SubmissÃµes"}),e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:p.total})]}),e.jsxs(v,{className:"p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Avaliadas"}),e.jsx("div",{className:"text-3xl font-bold text-green-600",children:p.completed})]}),e.jsxs(v,{className:"p-6 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"MÃ©dia Geral"}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:p.avgGrade>0?p.avgGrade.toFixed(1):"--"})]}),e.jsxs(v,{className:"p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Maior Nota"}),e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:p.highestGrade>0?p.highestGrade.toFixed(1):"--"})]})]}),e.jsx(v,{className:"p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(oe,{placeholder:"Buscar por atividade ou turma...",value:n,onChange:t=>z(t.target.value),className:"pl-10"})]})}),e.jsxs(_,{value:m,onValueChange:Q,children:[e.jsx(N,{className:"w-full md:w-48",children:e.jsx(S,{placeholder:"Todas as turmas"})}),e.jsxs(w,{children:[e.jsx(d,{value:"all",children:"Todas as turmas"}),J.map(t=>e.jsx(d,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(_,{value:x,onValueChange:U,children:[e.jsx(N,{className:"w-full md:w-48",children:e.jsx(S,{placeholder:"Todos os status"})}),e.jsxs(w,{children:[e.jsx(d,{value:"all",children:"Todos os status"}),e.jsx(d,{value:"graded",children:"âœ… Avaliadas"}),e.jsx(d,{value:"submitted",children:"ğŸ“¤ Submetidas"}),e.jsx(d,{value:"pending",children:"â³ Pendentes"})]})]}),e.jsxs(_,{value:c,onValueChange:W,children:[e.jsx(N,{className:"w-full md:w-48",children:e.jsx(S,{placeholder:"Todo o perÃ­odo"})}),e.jsxs(w,{children:[e.jsx(d,{value:"all",children:"Todo o perÃ­odo"}),e.jsx(d,{value:"week",children:"Ãšltima semana"}),e.jsx(d,{value:"month",children:"Ãšltimo mÃªs"}),e.jsx(d,{value:"semester",children:"Ãšltimo semestre"})]})]})]})}),b.length>0?e.jsx("div",{className:"space-y-4",children:b.map((t,s)=>{const i={id:t.id,activity_title:t.activity_title,class_name:t.class_name,grade:t.grade,max_score:t.max_score,feedback:t.feedback,submitted_at:t.submitted_at,activity_id:t.activity_id};return t.grade?e.jsx(ce,{grade:i,onViewDetails:()=>C(`/students/activities/${t.activity_id}`),index:s},t.id):e.jsx(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},children:e.jsx(v,{className:"p-6 border-2 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:t.activity_title||"Atividade"}),t.class_name&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:t.class_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsxs("span",{children:["Submetido em ",k(new Date(t.submitted_at),"dd 'de' MMMM",{locale:P})]}),e.jsx("span",{className:"px-2 py-1 rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:t.status==="pending"?"â³ Aguardando correÃ§Ã£o":"ğŸ“¤ Submetida"})]})]}),e.jsx(I,{onClick:()=>C(`/students/activities/${t.activity_id}`),variant:"outline",size:"sm",children:"Ver Detalhes"})]})})},t.id)})}):e.jsx(de,{icon:n||m!=="all"||x!=="all"||c!=="all"?H:B,title:n||m!=="all"||x!=="all"||c!=="all"?"Nenhum resultado encontrado":"Nenhuma submissÃ£o ainda",description:n||m!=="all"||x!=="all"||c!=="all"?"Tente ajustar os filtros de busca para encontrar o que procura.":"VocÃª ainda nÃ£o submeteu nenhuma atividade. Comece a responder suas atividades!",variant:"default"})]})};export{Ze as default};
