import{a as rt,u as lt,r as o,s as d,l as g,j as t,p as ot}from"./main-CulyknMy.js";import{C as b}from"./card-0IW715z3.js";import{m as M,B as j}from"./button-Dfu2yMjN.js";import{E as O}from"./EventCard-CMI7x7ZE.js";import{E as I}from"./EmptyState-8OOiKc2J.js";import"./dialog-DJOLU-fT.js";import{C as N}from"./calendar-CAuJuRcm.js";import{C as ct}from"./SidebarPremium-D7ISy0In.js";import{C as dt}from"./chevron-right-f5dsdMUG.js";import{C as mt}from"./clock-CPzPBM7h.js";import{s as $,i as pt,a as xt}from"./isSameMonth-CK0W24Ro.js";import{e as z}from"./endOfMonth-BD-g1yyK.js";import{s as A,c as ut,f as v}from"./format-BcFT9btV.js";import{e as B}from"./endOfDay-mJ-5sjFp.js";import{e as ht}from"./endOfWeek-BRNs0S5s.js";import{e as ft,s as gt}from"./subMonths-CphOl_Aj.js";import{i as vt}from"./isSameDay-D5LInQhv.js";import{i as P}from"./isToday-By0hfvNN.js";import{i as yt}from"./isPast-CeQjbKRK.js";import{p as w}from"./pt-BR-CuGSKEGQ.js";import"./badge-hAm5RhEJ.js";import"./video-CRvRVJwF.js";import"./file-text-76dwq0ip.js";import"./map-pin-CFoz_cxX.js";import"./index-Bqe-gmK6.js";import"./index-qba7jVBc.js";import"./x-C2dkvfPv.js";import"./house-DSNk2C5T.js";import"./users-CLb1Ind1.js";import"./book-open-L6K6GApD.js";import"./graduation-cap-DGMUxzM9.js";import"./chart-column-Bg7XzELY.js";import"./message-circle-8Z2L2EEy.js";import"./settings-Bqthy2dX.js";import"./index-BZWQ4euU.js";import"./en-US-B6HbAA6N.js";import"./constructNow-re94FRT2.js";const ne=()=>{const{user:m}=rt(),y=lt(),[R,S]=o.useState(!0),[i,_]=o.useState(new Date),[p,E]=o.useState(new Date),[x,T]=o.useState([]),[k,q]=o.useState([]),[_t,bt]=o.useState("all");o.useEffect(()=>{m?.id&&H()},[m,i]),o.useEffect(()=>{L(p)},[p,x]);const H=async()=>{try{S(!0);const{data:e}=await d.from("class_members").select("class_id").eq("user_id",m.id).eq("role","student"),a=e?.map(s=>s.class_id)||[],n=$(i),r=z(i),{data:l}=await d.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, class_id").in("class_id",a).gte("start_time",n.toISOString()).lte("start_time",r.toISOString()).order("start_time",{ascending:!0});g.debug("[Calendar] Buscando eventos como participante:",{userId:m.id});const{data:c,error:u}=await d.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, participants, class_id, created_by").not("participants","is",null).gte("start_time",n.toISOString()).lte("start_time",r.toISOString()).order("start_time",{ascending:!0}),h=c?.filter(s=>s.participants&&Array.isArray(s.participants)&&s.participants.includes(m.id))||[];u?g.error("[Calendar] Erro ao buscar eventos como participante:",u):g.debug("[Calendar] Eventos encontrados como participante:",{count:h?.length||0,events:h});const{data:D}=await d.from("activity_class_assignments").select("activity_id, class_id").in("class_id",a),Z=D?.map(s=>s.activity_id)||[],{data:tt}=await d.from("activities").select("id, title, due_date").in("id",Z).gte("due_date",n.toISOString()).lte("due_date",r.toISOString()),{data:et}=await d.from("classes").select("id, name").in("id",a),f={};et?.forEach(s=>{f[s.id]=s});const C=new Set,st=[...(l||[]).map(s=>({...s,class_name:f[s.class_id]?.name,event_type:"class_event"})),...(h||[]).map(s=>({...s,class_name:f[s.class_id]?.name,event_type:"meeting"}))].filter(s=>C.has(s.id)?!1:(C.add(s.id),!0)),at=(tt||[]).map(s=>{const it=D.find(nt=>nt.activity_id===s.id);return{id:`activity-${s.id}`,title:s.title,start_time:s.due_date,end_time:s.due_date,type:"deadline",class_name:f[it?.class_id]?.name,event_type:"activity_deadline",activity_id:s.id}});T([...st,...at])}catch(e){g.error("Erro ao carregar eventos:",e)}finally{S(!1)}},L=e=>{const a=A(e),n=B(e),r=x.filter(l=>{const c=new Date(l.start_time);return c>=a&&c<=n});q(r)},F=e=>{const a=A(e),n=B(e);return x.filter(r=>{const l=new Date(r.start_time);return l>=a&&l<=n})},Q=()=>{_(gt(i))},W=()=>{_(xt(i,1))},G=()=>{const e=new Date;_(e),E(e)},J=$(i),K=z(i),U=ut(J,{weekStartsOn:0}),V=ht(K,{weekStartsOn:0}),X=ft({start:U,end:V}),Y=["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"];return R?t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx(ot,{size:"lg"})}):t.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[t.jsxs(M.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[t.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[t.jsx(N,{className:"w-8 h-8 text-blue-600"}),"Minha Agenda"]}),t.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Eventos, reuniÃµes e prazos de atividades"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(j,{onClick:Q,variant:"outline",size:"sm",children:t.jsx(ct,{className:"w-4 h-4"})}),t.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white min-w-[200px] text-center",children:v(i,"MMMM yyyy",{locale:w})}),t.jsx(j,{onClick:W,variant:"outline",size:"sm",children:t.jsx(dt,{className:"w-4 h-4"})})]}),t.jsx(j,{onClick:G,variant:"default",children:"Hoje"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs(b,{className:"p-6 lg:col-span-2",children:[t.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:Y.map(e=>t.jsx("div",{className:"text-center font-bold text-slate-600 dark:text-slate-400 text-sm py-2",children:e},e))}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:X.map(e=>{const a=F(e),n=pt(e,i),r=vt(e,p),l=P(e),c=yt(e)&&!l;return t.jsxs(M.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>E(e),className:`
                    aspect-square p-2 rounded-lg border-2 transition-all
                    ${n?"bg-white dark:bg-slate-800":"bg-slate-100 dark:bg-slate-900"}
                    ${r?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-transparent"}
                    ${l?"ring-2 ring-blue-500":""}
                    ${c?"opacity-50":""}
                    hover:border-blue-300 dark:hover:border-blue-700
                  `,children:[t.jsx("div",{className:`
                    text-sm font-semibold mb-1
                    ${r?"text-blue-600":"text-slate-900 dark:text-white"}
                    ${n?"":"text-slate-400"}
                  `,children:v(e,"d")}),a.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-0.5 justify-center",children:[a.slice(0,3).map((u,h)=>t.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${u.type==="deadline"?"bg-red-500":u.type==="meeting"?"bg-purple-500":"bg-blue-500"}`},h)),a.length>3&&t.jsxs("div",{className:"text-[10px] text-slate-500",children:["+",a.length-3]})]})]},e.toString())})}),t.jsxs("div",{className:"flex items-center gap-6 mt-6 pt-6 border-t",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),t.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Eventos"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),t.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"ReuniÃµes"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),t.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Prazos"})]})]})]}),t.jsxs(b,{className:"p-6",children:[t.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(mt,{className:"w-5 h-5 text-blue-600"}),P(p)?"Hoje":v(p,"dd 'de' MMMM",{locale:w})]}),k.length>0?t.jsx("div",{className:"space-y-3",children:k.map((e,a)=>t.jsx(O,{event:e,onClick:()=>{e.event_type==="activity_deadline"?y(`/students/activities/${e.activity_id}`):y("/students/calendar")},index:a},e.id))}):t.jsx(I,{icon:N,title:"Nenhum evento",description:"Nenhum evento agendado para este dia.",variant:"info"})]})]}),t.jsxs(b,{className:"p-6 mt-6",children:[t.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:["ğŸ“… Eventos de ",v(i,"MMMM",{locale:w})]}),x.length>0?t.jsx("div",{className:"space-y-4",children:x.sort((e,a)=>new Date(e.start_time)-new Date(a.start_time)).map((e,a)=>t.jsx(O,{event:e,onClick:()=>{e.event_type==="activity_deadline"&&y(`/students/activities/${e.activity_id}`)},index:a},e.id))}):t.jsx(I,{icon:N,title:"Nenhum evento este mÃªs",description:"NÃ£o hÃ¡ eventos, reuniÃµes ou prazos agendados para este mÃªs."})]})]})};export{ne as default};
