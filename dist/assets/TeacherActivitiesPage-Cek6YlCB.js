import{c as de,j as e,r,s as w,u as Qe,a as Ze,k as We}from"./main-XRKQFEIr.js";import{B as n,m as Q}from"./button-D4bIZ4Ty.js";import{C as me}from"./card-BEk2G2Us.js";import{I as X}from"./input-BrWaMOrb.js";import{L as b}from"./label-_ADcUmGf.js";import{S as ae,a as ie,b as re,c as oe,d as j}from"./select-BDOb0ZK1.js";import{D as Ae,a as ke,b as Se,c as Te,d as _e,e as Pe}from"./dialog-B2ShbSiF.js";import{T as Xe,a as Je,b as U}from"./tabs-D66ljSV7.js";import{D as Ke,g as Z}from"./DashboardHeader-B78p6TYW.js";import{S as W}from"./StatsCard-D5ZQ3-Yq.js";import{E as Ye}from"./EmptyState-D0gyH3nl.js";import{D as Ee,a as De,b as Me,c as N,d as Ne}from"./dropdown-menu-DyRCHyY4.js";import{u as K}from"./use-toast-Cv69gxoh.js";import{c as B}from"./utils-gX3u9bFQ.js";import{B as V}from"./SidebarPremium-BnsbfpCV.js";import{C as Fe}from"./checkbox-DMTpvyPR.js";import{S as he}from"./star-Cb-Ahs20.js";import{F as es}from"./file-text-tq0U235S.js";import{U as xe}from"./users-DP4-CTtE.js";import{C as ss}from"./circle-check-big-CiCoaZWN.js";import{S as J}from"./square-pen-DxgcZK8Y.js";import{E as ze}from"./ellipsis-vertical-ByxKyld5.js";import{C as qe}from"./copy-M4T8qqHL.js";import{E as ce}from"./eye-DrCLqRJv.js";import{D as Le}from"./download-DAXH3RrD.js";import{S as Ue}from"./share-2-BCWFODPt.js";import{A as Be}from"./archive-BOEsudUe.js";import{T as ts}from"./trash-2-BFBmoqwg.js";import{f as as}from"./format-CxHpq9RK.js";import{p as is}from"./pt-BR-CXWZr0Zs.js";import{T as Ie}from"./trending-up-eowzUgXK.js";import{T as rs}from"./textarea-wXaf8p7F.js";import{S as le,G as os}from"./switch-F5JHdijQ.js";import{C as ls}from"./circle-alert-CmSW_OAP.js";import{C as $e}from"./index-e3XtT_BD.js";import{P as ne}from"./plus-DVhNLwZX.js";import{U as ns}from"./upload-D5cMxgen.js";import{C as we}from"./clipboard-list-zqwBk92M.js";import{S as cs}from"./search-bwbDgZQN.js";import{C as ds}from"./chevron-up-Bc2ZkTy5.js";import{C as ms}from"./chevron-down--5IVxs-k.js";import{X as Ce}from"./x-BPPDjH10.js";import"./Combination-TYhCc4jv.js";import"./index-ysAnX8Hi.js";import"./index-B_kCUa_t.js";import"./check-Cifhij8e.js";import"./chevron-right-C-DpTlMS.js";import"./bell-v36tl0On.js";import"./book-open-CAn3t7Hm.js";import"./user-CCHLYTsx.js";import"./settings-pQ42cErW.js";import"./graduation-cap-CRbvieNe.js";import"./chart-column-CBFsA3dh.js";import"./en-US-azV9x4mt.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],xs=de("layout-grid",hs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],gs=de("list",ps);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],vs=de("sliders-horizontal",us),js=({activity:a,selected:x,onSelect:m,onEdit:C,onDuplicate:f,onToggleFavorite:p,onArchive:P,onDelete:y,getTypeBadge:c})=>{const{toast:l}=K(),I=h=>{const u={open:"bg-green-500 text-white",assignment:"bg-green-500 text-white",closed:"bg-blue-500 text-white",quiz:"bg-blue-500 text-white",mixed:"bg-purple-500 text-white",project:"bg-purple-500 text-white"};return u[a.type]||u.open},g=h=>{const u={published:{label:"Publicada",color:"bg-emerald-500 text-white"},draft:{label:"Rascunho",color:"bg-gray-400 text-white"},archived:{label:"Arquivada",color:"bg-slate-400 text-white"}},E=u[h]||u.draft;return e.jsx(V,{className:B("text-xs font-medium",E.color),children:E.label})};return e.jsx(me,{className:B("p-5 hover:shadow-lg transition-all duration-200 bg-white dark:bg-slate-800 border-l-4",x?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-950/30 border-l-blue-500":"border-l-transparent hover:border-l-blue-400"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Fe,{checked:x,onCheckedChange:()=>m(a.id),className:"flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 line-clamp-1 flex-1",children:a.title}),e.jsx("button",{onClick:()=>{console.log("[ActivityListItem] â­ BotÃ£o Favorito clicado"),console.log("[ActivityListItem] Activity ID:",a.id),p(a.id)},className:"flex-shrink-0 text-gray-400 hover:text-yellow-500 transition-colors",children:e.jsx(he,{className:B("w-4 h-4",a.is_favorite&&"fill-yellow-500 text-yellow-500")})})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex items-center gap-5 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"p-1.5 rounded-md bg-blue-100 dark:bg-blue-900/30",children:e.jsx(es,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("span",{className:"font-medium",children:[a.content?.questions?.length||0," questÃµes"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"p-1.5 rounded-md bg-purple-100 dark:bg-purple-900/30",children:e.jsx(xe,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"})}),e.jsxs("span",{className:"font-medium",children:[a.timesUsed||0," turma(s)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"p-1.5 rounded-md bg-green-100 dark:bg-green-900/30",children:e.jsx(ss,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsxs("span",{className:"font-medium",children:[a.submittedCount||0," envios"]})]}),a.created_at&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 ml-auto",children:as(new Date(a.created_at),"dd/MM/yyyy",{locale:is})})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 px-4 border-l border-r border-gray-200 dark:border-gray-700",children:[e.jsx(V,{className:B("text-xs font-bold px-4 py-1.5 shadow-sm",I(a.type)),children:c(a.type)}),g(a.status)]}),e.jsxs("div",{className:"flex flex-col items-center justify-center px-6",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 border border-amber-200 dark:border-amber-700",children:e.jsx("span",{className:"text-3xl font-black text-amber-600 dark:text-amber-400",children:a.max_score||100})}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mt-1",children:"pontos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{size:"sm",onClick:()=>{console.log("[ActivityListItem] âœï¸ BotÃ£o Editar Principal clicado"),console.log("[ActivityListItem] Activity:",a),C(a)},className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 shadow-md hover:shadow-lg",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(Ee,{children:[e.jsx(De,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"icon",className:"flex-shrink-0",children:e.jsx(ze,{className:"w-5 h-5"})})}),e.jsxs(Me,{align:"end",className:"w-48",children:[e.jsxs(N,{onClick:()=>{console.log('[ActivityListItem] âœï¸ Dropdown "Editar" clicado'),console.log("[ActivityListItem] Activity:",a),C(a)},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(N,{onClick:()=>{console.log('[ActivityListItem] ðŸ“‹ Dropdown "Duplicar" clicado'),console.log("[ActivityListItem] Activity:",a),f(a)},children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(N,{onClick:h=>{h.stopPropagation(),l({title:"Em breve",description:"FunÃ§Ã£o de prÃ©via serÃ¡ implementada em breve."})},children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Ver PrÃ©via"]}),e.jsx(Ne,{}),e.jsxs(N,{onClick:h=>{h.stopPropagation(),l({title:"Em breve",description:"FunÃ§Ã£o de exportaÃ§Ã£o serÃ¡ implementada em breve."})},children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(N,{onClick:h=>{h.stopPropagation(),l({title:"Em breve",description:"FunÃ§Ã£o de compartilhamento serÃ¡ implementada em breve."})},children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),e.jsx(Ne,{}),e.jsxs(N,{onClick:h=>{h.stopPropagation(),P(a.id)},children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Arquivar"]}),e.jsxs(N,{onClick:h=>{h.stopPropagation(),y(a)},className:"text-red-600 focus:text-red-600 dark:text-red-400",children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})]})]})]})})},fs=({activity:a,onEdit:x,onToggleFavorite:m,onDuplicate:C,getTypeBadge:f,navigate:p})=>{const{toast:P}=K(),y=c=>{const l={open:"bg-green-100 text-green-700",assignment:"bg-green-100 text-green-700",closed:"bg-blue-100 text-blue-700",quiz:"bg-blue-100 text-blue-700",mixed:"bg-purple-100 text-purple-700",project:"bg-purple-100 text-purple-700"};return l[a.type]||l.open};return e.jsxs(me,{className:"group h-full hover:shadow-xl transition-all duration-300 overflow-hidden border-t-4 border-t-blue-500",children:[e.jsx("div",{className:"relative p-5 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(V,{className:y(a.type),children:f(a.type)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),m(a.id)},className:"text-gray-400 hover:text-yellow-500 transition-colors",children:e.jsx(he,{className:B("w-5 h-5",a.is_favorite&&"fill-yellow-500 text-yellow-500")})}),e.jsxs(Ee,{children:[e.jsx(De,{asChild:!0,onClick:c=>c.stopPropagation(),children:e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ze,{className:"w-4 h-4"})})}),e.jsxs(Me,{align:"end",children:[e.jsxs(N,{onClick:c=>{c.stopPropagation(),x(a)},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(N,{onClick:c=>{c.stopPropagation(),C&&C(a)},children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(N,{onClick:c=>{c.stopPropagation(),P({title:"Em breve",description:"PrÃ©via em desenvolvimento."})},children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"PrÃ©via"]})]})]})]})]})}),e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 line-clamp-2 mb-3 min-h-[56px]",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-3 mb-4 min-h-[60px]",children:a.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[a.content?.tags?.slice(0,2).map((c,l)=>e.jsxs(V,{variant:"secondary",className:"text-xs",children:["#",c]},l)),a.content?.tags?.length>2&&e.jsxs(V,{variant:"secondary",className:"text-xs",children:["+",a.content.tags.length-2]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",title:"QuestÃµes",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:a.content?.questions?.length||0})]}),e.jsxs("div",{className:"flex items-center gap-1",title:"Pontos",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{children:a.max_score})]}),e.jsxs("div",{className:"flex items-center gap-1",title:"Usos",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.timesUsed,"x"]})]})]}),e.jsxs(n,{size:"sm",className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 shadow-md hover:shadow-lg transition-all",onClick:()=>p(`/dashboard/activities/${a.id}/edit`),children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Editar"]})]})]})]})},bs=({activities:a,classes:x,onClose:m,onSuccess:C})=>{const{toast:f}=K(),[p,P]=r.useState([]),[y,c]=r.useState(""),[l,I]=r.useState(a[0]?.max_score||10),[g,h]=r.useState(1),[u,E]=r.useState(""),[A,G]=r.useState(!1),[k,Y]=r.useState(!1),[F,ee]=r.useState(!0),[D,H]=r.useState(!1),T=i=>{P(v=>v.includes(i)?v.filter(q=>q!==i):[...v,i])},z=async()=>{if(p.length===0){f({title:"Erro",description:"Selecione pelo menos uma turma.",variant:"destructive"});return}if(!y){f({title:"Erro",description:"Defina uma data de entrega.",variant:"destructive"});return}try{H(!0);for(const i of a)for(const v of p){const{error:q}=await w.from("activities").update({due_date:y,max_score:l,weight:g,instructions:u||i.instructions,plagiarism_enabled:k,status:"published"}).eq("id",i.id);if(q)throw q;const{data:$}=await w.from("activity_class_assignments").select("id").eq("activity_id",i.id).eq("class_id",v).single();if(!$){const{error:S}=await w.from("activity_class_assignments").insert({activity_id:i.id,class_id:v});if(S)throw S}if(F){const{data:S}=await w.from("class_members").select("user_id").eq("class_id",v).eq("role","student");if(S){const se=S.map(pe=>({user_id:pe.user_id,title:"Nova Atividade Postada",message:`A atividade "${i.title}" foi postada e estÃ¡ disponÃ­vel.`,type:"activity_posted",data:{activity_id:i.id,class_id:v,due_date:y}}));await w.from("notifications").insert(se)}}}f({title:"Sucesso!",description:`Atividade${a.length>1?"s":""} postada${a.length>1?"s":""} em ${p.length} turma${p.length>1?"s":""}.`}),C()}catch(i){console.error("Erro ao postar atividade:",i),f({title:"Erro",description:"NÃ£o foi possÃ­vel postar a atividade.",variant:"destructive"})}finally{H(!1)}};return e.jsx(Ae,{open:!0,onOpenChange:m,children:e.jsxs(ke,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsxs(Te,{children:["Postar Atividade",a.length>1?"s":"",": ",a[0]?.title,a.length>1&&` (+${a.length-1})`]}),e.jsx(_e,{children:"Configure as opÃ§Ãµes de postagem e selecione as turmas"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsxs(b,{className:"text-base font-semibold mb-3 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Selecionar Turmas"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border rounded-lg p-3",children:x.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ls,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"VocÃª nÃ£o tem turmas ativas."}),e.jsx("p",{className:"text-sm",children:"Crie uma turma primeiro."})]}):x.map(i=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded",children:[e.jsx(Fe,{id:i.id,checked:p.includes(i.id),onCheckedChange:()=>T(i.id)}),e.jsx(b,{htmlFor:i.id,className:"flex-1 cursor-pointer",children:i.name})]},i.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"dueDate",className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Prazo de Entrega *"]}),e.jsx(X,{id:"dueDate",type:"datetime-local",value:y,onChange:i=>c(i.target.value),className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"maxScore",children:"PontuaÃ§Ã£o Total *"}),e.jsx(X,{id:"maxScore",type:"number",min:"0",step:"0.1",value:l,onChange:i=>I(parseFloat(i.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"weight",children:"Peso na MÃ©dia"}),e.jsx(X,{id:"weight",type:"number",min:"0",step:"0.1",value:g,onChange:i=>h(parseFloat(i.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"instructions",children:"InstruÃ§Ãµes Adicionais (Opcional)"}),e.jsx(rs,{id:"instructions",placeholder:"Adicione instruÃ§Ãµes especÃ­ficas para esta postagem...",value:u,onChange:i=>E(i.target.value),className:"mt-1 min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"ConfiguraÃ§Ãµes AvanÃ§adas"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(b,{htmlFor:"allowLate",className:"cursor-pointer",children:"Permitir Envio Atrasado"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos poderÃ£o submeter apÃ³s o prazo"})]}),e.jsx(le,{id:"allowLate",checked:A,onCheckedChange:G})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(b,{htmlFor:"plagiarism",className:"cursor-pointer",children:"Ativar AntiplÃ¡gio"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Verificar originalidade das respostas"})]}),e.jsx(le,{id:"plagiarism",checked:k,onCheckedChange:Y})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(b,{htmlFor:"notify",className:"cursor-pointer",children:"Notificar Alunos"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enviar notificaÃ§Ã£o sobre nova atividade"})]}),e.jsx(le,{id:"notify",checked:F,onCheckedChange:ee})]})]})]}),e.jsxs(Pe,{children:[e.jsx(n,{variant:"outline",onClick:m,disabled:D,children:"Cancelar"}),e.jsx(n,{onClick:z,disabled:D||p.length===0,children:D?"Postando...":"Postar Agora"})]})]})})},Nt=()=>{const a=Qe(),{user:x}=Ze(),{toast:m}=K();console.log("[TeacherActivitiesPage] Componente montado"),console.log("[TeacherActivitiesPage] User:",x),console.log("[TeacherActivitiesPage] Current URL:",window.location.pathname);const[C,f]=r.useState(!0),[p,P]=r.useState([]),[y,c]=r.useState([]),[l,I]=r.useState({total:0,byType:{open:0,closed:0,mixed:0},mostUsed:null,recentCount:0}),[g,h]=r.useState("all"),[u,E]=r.useState("list"),[A,G]=r.useState(""),[k,Y]=r.useState({type:[],status:[]}),[F,ee]=r.useState(!1),[D,H]=r.useState("created_desc"),[T,z]=r.useState([]),[i,v]=r.useState(!1),[q,$]=r.useState(!1),[S,se]=r.useState(null),[pe,ys]=r.useState(null);r.useEffect(()=>{console.log("[TeacherActivitiesPage] useEffect triggered, user:",x),x?(console.log("[TeacherActivitiesPage] Loading activities and classes..."),R(),Re()):console.warn("[TeacherActivitiesPage] âš ï¸ User not found!")},[x]);const R=async()=>{try{f(!0);const{data:s,error:t}=await w.from("activities").select(`
          *,
          assignments:activity_class_assignments(
            id, class_id, assigned_at,
            class:classes(id, name)
          ),
          submissions:submissions(id, status, grade)
        `).eq("created_by",x.id).is("deleted_at",null).order("created_at",{ascending:!1});if(t)throw t;const d=(s||[]).map(_=>{const M=_.submissions?.filter(o=>o.status==="submitted"||o.status==="graded").length||0,O=_.submissions?.filter(o=>o.grade!==null).reduce((o,L)=>o+parseFloat(L.grade),0)/M||0;return{..._,timesUsed:_.assignments?.length||0,submittedCount:M,avgGrade:O.toFixed(2),classNames:_.assignments?.map(o=>o.class?.name).filter(Boolean)||[]}});P(d),Ve(d)}catch(s){console.error("Erro ao carregar atividades:",s),m({title:"Erro",description:"NÃ£o foi possÃ­vel carregar as atividades.",variant:"destructive"})}finally{f(!1)}},Re=async()=>{try{const{data:s,error:t}=await w.from("classes").select("id, name").eq("created_by",x.id).eq("is_active",!0);if(t)throw t;c(s||[])}catch(s){console.error("Erro ao carregar turmas:",s)}},Ve=s=>{const t=s.length,d={open:s.filter(o=>o.type==="open"||o.type==="assignment").length,closed:s.filter(o=>o.type==="closed"||o.type==="quiz").length,mixed:s.filter(o=>o.type==="mixed"||o.type==="project").length},_=s.reduce((o,L)=>L.timesUsed>(o?.timesUsed||0)?L:o,null),M=new Date;M.setMonth(M.getMonth()-1);const O=s.filter(o=>new Date(o.created_at)>M).length;I({total:t,byType:d,mostUsed:_,recentCount:O})},te=r.useMemo(()=>{let s=[...p];if(g==="open"?s=s.filter(t=>t.type==="open"||t.type==="assignment"):g==="closed"?s=s.filter(t=>t.type==="closed"||t.type==="quiz"):g==="mixed"?s=s.filter(t=>t.type==="mixed"||t.type==="project"):g==="drafts"?s=s.filter(t=>t.status==="draft"):g==="favorites"?s=s.filter(t=>t.is_favorite):g==="archived"&&(s=s.filter(t=>t.status==="archived")),A){const t=A.toLowerCase();s=s.filter(d=>d.title?.toLowerCase().includes(t)||d.description?.toLowerCase().includes(t)||d.instructions?.toLowerCase().includes(t))}return k.type.length>0&&(s=s.filter(t=>k.type.includes(t.type))),k.status.length>0&&(s=s.filter(t=>k.status.includes(t.status))),s.sort((t,d)=>{switch(D){case"created_desc":return new Date(d.created_at)-new Date(t.created_at);case"created_asc":return new Date(t.created_at)-new Date(d.created_at);case"name_asc":return t.title.localeCompare(d.title);case"name_desc":return d.title.localeCompare(t.title);case"most_used":return d.timesUsed-t.timesUsed;case"highest_score":return d.max_score-t.max_score;default:return 0}}),s},[p,g,A,k,D]),Ge=s=>{z(t=>t.includes(s)?t.filter(d=>d!==s):[...t,s])},ge=s=>{console.log("[TeacherActivitiesPage] ðŸŽ¯ handleEdit chamado"),console.log("[TeacherActivitiesPage] Activity:",s),console.log("[TeacherActivitiesPage] Navegando para:",`/dashboard/activities/${s.id}/edit`),a(`/dashboard/activities/${s.id}/edit`)},ue=async s=>{console.log("[TeacherActivitiesPage] ðŸ“‹ handleDuplicate chamado"),console.log("[TeacherActivitiesPage] Activity:",s);try{const{assignments:t,submissions:d,submittedCount:_,avgGrade:M,timesUsed:O,classNames:o,...L}=s,{data:be,error:ye}=await w.from("activities").insert({...L,id:void 0,title:`${s.title} - CÃ³pia`,status:"draft",is_published:!1,created_at:void 0,updated_at:void 0,deleted_at:null}).select().single();if(ye)throw ye;m({title:"Sucesso",description:"Atividade duplicada com sucesso!"}),R(),console.log("[TeacherActivitiesPage] Navegando apÃ³s duplicar para:",`/dashboard/activities/${be.id}/edit`),a(`/dashboard/activities/${be.id}/edit`)}catch(t){console.error("Erro ao duplicar:",t),m({title:"Erro",description:"NÃ£o foi possÃ­vel duplicar a atividade.",variant:"destructive"})}},ve=async s=>{console.log("[TeacherActivitiesPage] â­ handleToggleFavorite chamado"),console.log("[TeacherActivitiesPage] Activity ID:",s),m({title:"Funcionalidade em desenvolvimento",description:"Sistema de favoritos serÃ¡ implementado em breve."})},je=async s=>{console.log("[TeacherActivitiesPage] ðŸ“¦ handleArchive chamado"),console.log("[TeacherActivitiesPage] Activity ID:",s);try{const{error:t}=await w.from("activities").update({status:"archived"}).eq("id",s);if(t)throw t;m({title:"Atividade arquivada"}),R()}catch(t){console.error("Erro ao arquivar:",t)}},He=async s=>{console.log("[TeacherActivitiesPage] ðŸ—‘ï¸ handleDelete chamado"),console.log("[TeacherActivitiesPage] Activity ID:",s);try{const{error:t}=await w.from("activities").update({deleted_at:new Date().toISOString()}).eq("id",s);if(t)throw t;m({title:"Atividade excluÃ­da"}),v(!1),R()}catch(t){console.error("Erro ao excluir:",t)}},Oe=()=>{Y({type:[],status:[]}),G("")},fe=s=>({open:"Aberta",assignment:"Aberta",closed:"Fechada",quiz:"Fechada",mixed:"Mista",project:"Mista"})[s]||"Aberta";return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(We,{size:"lg",text:"Carregando banco de atividades..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Ke,{title:"Banco de Atividades",subtitle:"Crie, organize e reutilize suas atividades",role:"teacher"}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[e.jsxs(n,{size:"lg",onClick:()=>{console.log('[TeacherActivitiesPage] âž• BotÃ£o "Nova Atividade" clicado'),console.log("[TeacherActivitiesPage] Navegando para: /dashboard/activities/create"),console.log("[TeacherActivitiesPage] URL atual:",window.location.pathname),a("/dashboard/activities/create")},className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800",children:[e.jsx(ne,{className:"w-5 h-5 mr-2"}),"Nova Atividade"]}),e.jsxs(n,{variant:"outline",size:"lg",onClick:()=>{m({title:"Em breve",description:"FunÃ§Ã£o de importaÃ§Ã£o de atividades serÃ¡ implementada em breve."})},children:[e.jsx(ns,{className:"w-5 h-5 mr-2"}),"Importar"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(W,{title:"Total",value:l.total,icon:we,gradient:Z.primary,bgColor:"bg-blue-50"}),e.jsx(W,{title:"Por Tipo",value:`${l.byType.open}/${l.byType.closed}/${l.byType.mixed}`,icon:os,gradient:Z.success,bgColor:"bg-emerald-50",subtitle:"Abertas/Fechadas/Mistas"}),e.jsx(W,{title:"Mais Usada",value:l.mostUsed?.timesUsed||0,icon:Ie,gradient:Z.warning,bgColor:"bg-amber-50",subtitle:l.mostUsed?l.mostUsed.title.substring(0,20)+"...":"Nenhuma"}),e.jsx(W,{title:"Recentes",value:l.recentCount,icon:$e,gradient:Z.info,bgColor:"bg-cyan-50",subtitle:"Ãšltimo mÃªs"})]}),e.jsx(Xe,{value:g,onValueChange:h,className:"mb-6",children:e.jsxs(Je,{className:"grid w-full grid-cols-6",children:[e.jsx(U,{value:"all",children:"Todas"}),e.jsx(U,{value:"open",children:"Abertas"}),e.jsx(U,{value:"closed",children:"Fechadas"}),e.jsx(U,{value:"mixed",children:"Mistas"}),e.jsx(U,{value:"drafts",children:"Rascunhos"}),e.jsxs(U,{value:"favorites",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"Favoritas"]})]})}),e.jsx(me,{className:"p-6 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(X,{placeholder:"Buscar atividade...",value:A,onChange:s=>G(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ae,{value:D,onValueChange:H,children:[e.jsx(ie,{className:"w-[200px]",children:e.jsx(re,{})}),e.jsxs(oe,{children:[e.jsx(j,{value:"created_desc",children:"Mais Recentes"}),e.jsx(j,{value:"created_asc",children:"Mais Antigas"}),e.jsx(j,{value:"name_asc",children:"Nome (A-Z)"}),e.jsx(j,{value:"name_desc",children:"Nome (Z-A)"}),e.jsx(j,{value:"most_used",children:"Mais Usadas"}),e.jsx(j,{value:"highest_score",children:"Maior PontuaÃ§Ã£o"})]})]}),e.jsx(n,{variant:u==="list"?"default":"outline",size:"icon",onClick:()=>E("list"),children:e.jsx(gs,{className:"w-5 h-5"})}),e.jsx(n,{variant:u==="grid"?"default":"outline",size:"icon",onClick:()=>E("grid"),children:e.jsx(xs,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>ee(!F),children:[e.jsx(vs,{className:"w-4 h-4 mr-2"}),"Filtros AvanÃ§ados",F?e.jsx(ds,{className:"w-4 h-4 ml-2"}):e.jsx(ms,{className:"w-4 h-4 ml-2"})]}),(A||k.type.length>0)&&e.jsxs(n,{variant:"ghost",size:"sm",onClick:Oe,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Limpar"]})]}),F&&e.jsxs(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Tipo"}),e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsx(re,{placeholder:"Todos"})}),e.jsxs(oe,{children:[e.jsx(j,{value:"open",children:"Abertas"}),e.jsx(j,{value:"closed",children:"Fechadas"}),e.jsx(j,{value:"mixed",children:"Mistas"})]})]})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Status"}),e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsx(re,{placeholder:"Todos"})}),e.jsxs(oe,{children:[e.jsx(j,{value:"published",children:"Publicadas"}),e.jsx(j,{value:"draft",children:"Rascunhos"}),e.jsx(j,{value:"archived",children:"Arquivadas"})]})]})]})]})]})}),T.length>0&&e.jsxs(Q.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-blue-600 text-white px-6 py-4 rounded-lg shadow-2xl flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold",children:[T.length," selecionada(s)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{size:"sm",variant:"secondary",onClick:()=>$(!0),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Postar"]}),e.jsxs(n,{size:"sm",variant:"secondary",onClick:()=>{m({title:"Em breve",description:"FunÃ§Ã£o de exportaÃ§Ã£o em massa serÃ¡ implementada em breve."})},children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(n,{size:"sm",variant:"secondary",onClick:async()=>{try{for(const s of T)await je(s);z([]),m({title:"Sucesso",description:`${T.length} atividade(s) arquivada(s).`})}catch(s){console.error("Erro ao arquivar:",s),m({title:"Erro",description:"NÃ£o foi possÃ­vel arquivar as atividades.",variant:"destructive"})}},children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Arquivar"]}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>z([]),children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),te.length>0?e.jsx("div",{className:B(u==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4"),children:te.map((s,t)=>e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:u==="list"?e.jsx(js,{activity:s,selected:T.includes(s.id),onSelect:Ge,onEdit:ge,onDuplicate:ue,onToggleFavorite:ve,onArchive:je,onDelete:()=>{se(s),v(!0)},getTypeBadge:fe}):e.jsx(fs,{activity:s,onEdit:ge,onToggleFavorite:ve,onDuplicate:ue,getTypeBadge:fe,navigate:a})},s.id))}):e.jsx(Ye,{icon:we,title:A?"Nenhuma atividade encontrada":"VocÃª ainda nÃ£o criou nenhuma atividade",description:A?"Tente ajustar os filtros.":"Comece criando sua primeira atividade.",actionLabel:"Criar Primeira Atividade",actionIcon:ne,action:()=>{console.log('[TeacherActivitiesPage] âž• EmptyState "Criar Primeira Atividade" clicado'),console.log("[TeacherActivitiesPage] Navegando para: /dashboard/activities/create"),a("/dashboard/activities/create")}}),te.length>0&&e.jsx(Q.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.5},className:"fixed bottom-8 right-8 z-40",children:e.jsx(n,{size:"lg",onClick:()=>{console.log("[TeacherActivitiesPage] ðŸŽ¯ FAB (Floating Action Button) clicado"),console.log("[TeacherActivitiesPage] Navegando para: /dashboard/activities/create"),a("/dashboard/activities/create")},className:"w-16 h-16 rounded-full shadow-2xl bg-gradient-to-r from-blue-600 to-blue-700",children:e.jsx(ne,{className:"w-8 h-8"})})}),e.jsx(Ae,{open:i,onOpenChange:v,children:e.jsxs(ke,{children:[e.jsxs(Se,{children:[e.jsx(Te,{children:"Excluir Atividade"}),e.jsx(_e,{asChild:!0,children:S?.timesUsed>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-yellow-600 font-semibold",children:"âš ï¸ AtenÃ§Ã£o!"}),e.jsxs("div",{children:["Esta atividade foi usada ",S.timesUsed," vez(es)."]}),e.jsx("div",{children:"As submissÃµes existentes nÃ£o serÃ£o afetadas."})]}):e.jsx("div",{children:"Tem certeza? Esta aÃ§Ã£o nÃ£o pode ser desfeita."})})]}),e.jsxs(Pe,{children:[e.jsx(n,{variant:"outline",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(n,{variant:"destructive",onClick:()=>He(S?.id),children:"Excluir"})]})]})}),q&&e.jsx(bs,{activities:T.map(s=>p.find(t=>t.id===s)),classes:y,onClose:()=>$(!1),onSuccess:()=>{$(!1),R(),z([])}})]})};export{Nt as default};
