import{h as q,u as O,r as a,l as h,j as e,q as H}from"./main-BtydHokz.js";import{B as i}from"./button-pkZcz0fw.js";import{C as o}from"./card-BLN8IVBT.js";import{I}from"./input-DevW5dIO.js";import{D as L,g}from"./DashboardHeader-Do_OLCE8.js";import{S as p}from"./StatsCard-CQPBdi-L.js";import"./dropdown-menu-DQk5WS44.js";import"./label-Do1Gcpls.js";import{C}from"./classService-Ljb7If2H.js";import{u as M}from"./use-toast-BD7ojcJx.js";import{A as V}from"./arrow-left-A7LEbFFM.js";import{C as u}from"./circle-check-big-odCM7i_Y.js";import{C as y}from"./circle-x-BqIQYXj5.js";import{S as z}from"./save-EZIFPJyD.js";import"./proxy-BKNTM3tf.js";import"./chevron-right-Bh44L5jc.js";import"./index-BRR_QA-l.js";import"./index-DOzlJ45Y.js";import"./index-sWFH3d_M.js";import"./index-C0ZNntAv.js";import"./Combination-DK-gSie6.js";import"./SidebarPremium-BEHUuQck.js";import"./house-dUPObbYn.js";import"./users-CntpuLnR.js";import"./book-open-BQJiPDff.js";import"./file-text-GwBv-P3B.js";import"./graduation-cap-Bm5psu3Q.js";import"./calendar-xkfkZRmm.js";import"./chart-column-B3n9ZMAW.js";import"./message-circle-DTeSrK_w.js";import"./settings-BNGXdjmZ.js";import"./brain-DIkHdpFj.js";import"./index-BpBd5wiB.js";import"./x-BtLVjj0F.js";import"./index-DsrKRt14.js";import"./check-B1zY7uXK.js";const Ae=()=>{const{classId:r}=q(),n=O(),{toast:b}=M(),[A,j]=a.useState(!0),[v,f]=a.useState(!1),[P,D]=a.useState(null),[c,E]=a.useState([]),[d,N]=a.useState({}),[S,F]=a.useState({}),[m,_]=a.useState({averageRate:0,totalPresent:0,totalAbsent:0});a.useEffect(()=>{R()},[r]);const R=async()=>{try{j(!0);const s=await C.getClassById(r);D(s);const t=await C.getClassMembers(r,{role:"student"});E(t||[]);const l={};t.forEach(T=>{l[T.user_id]=!0}),N(l),_({averageRate:92.5,totalPresent:450,totalAbsent:35})}catch(s){h.error("Erro:",s)}finally{j(!1)}},$=s=>{N(t=>({...t,[s]:!t[s]}))},B=async()=>{try{f(!0);const s={classId:r,date:new Date().toISOString(),records:Object.entries(d).map(([t,l])=>({studentId:t,present:l,note:S[t]||null}))};h.debug("Salvando frequÃªncia:",s),b({title:"âœ… FrequÃªncia salva!",description:"As presenÃ§as foram registradas com sucesso."}),n(`/dashboard/classes/${r}`)}catch(s){h.error("Erro:",s),b({title:"âŒ Erro ao salvar",description:"Tente novamente.",variant:"destructive"})}finally{f(!1)}},x=Object.values(d).filter(Boolean).length,k=c.length-x;return A?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(H,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(i,{variant:"ghost",onClick:()=>n(`/dashboard/classes/${r}`),className:"mb-4",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(L,{title:`FrequÃªncia - ${P?.name||"Turma"}`,subtitle:`Chamada de ${new Date().toLocaleDateString("pt-BR")}`,role:"teacher"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(p,{title:"Taxa de PresenÃ§a MÃ©dia",value:`${m.averageRate}%`,icon:u,gradient:g.success,format:"text",delay:0}),e.jsx(p,{title:"PresenÃ§as Totais",value:m.totalPresent,icon:u,gradient:g.success,delay:.1}),e.jsx(p,{title:"Faltas Totais",value:m.totalAbsent,icon:y,gradient:g.danger,delay:.2})]}),e.jsx(o,{className:"p-6 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800 mb-8",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:["âš ï¸ ",e.jsx("strong",{children:"VersÃ£o FREE:"})," HistÃ³rico limitado Ã s Ãºltimas 30 chamadas.",e.jsx("br",{}),"ðŸ’Ž ",e.jsx("strong",{children:"PRO:"})," HistÃ³rico ilimitado, grÃ¡ficos de presenÃ§a e exportaÃ§Ã£o."]})}),e.jsx(o,{className:"p-6 bg-white dark:bg-slate-900 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:"Chamada de Hoje"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[c.length," alunos â€¢ ",x," presentes â€¢ ",k," ausentes"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:x}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Presentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:k}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Ausentes"})]})]})]})}),e.jsx(o,{className:"p-6 bg-white dark:bg-slate-900 mb-6",children:e.jsx("div",{className:"space-y-4",children:c.map(s=>{const t=d[s.user_id];return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[s.user?.avatar_url?e.jsx("img",{src:s.user.avatar_url,alt:s.user.name,className:"w-12 h-12 rounded-full"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:s.user?.name?.[0]||"A"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-white",children:s.user?.name||"Sem nome"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.user?.email})]}),e.jsx(I,{placeholder:"ObservaÃ§Ã£o (opcional)",value:S[s.user_id]||"",onChange:l=>F(w=>({...w,[s.user_id]:l.target.value})),className:"w-48"}),e.jsx(i,{onClick:()=>$(s.user_id),className:`
                    w-32
                    ${t?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}
                  `,children:t?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Presente"]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Ausente"]})})]},s.user_id)})})}),e.jsx(o,{className:"p-6 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(i,{onClick:B,disabled:v,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Salvar FrequÃªncia"]})}),e.jsx(i,{variant:"outline",onClick:()=>n(`/dashboard/classes/${r}`),children:"Cancelar"})]})})]})};export{Ae as default};
