import{j as e,r as p,b as Ae,s as h,l as d,h as _e,u as Ce,q as Ee}from"./main-BSajwT7t.js";import{B as D}from"./button-49_9eRW2.js";import{C as O}from"./card-Bocxgg1Q.js";import{I as qe}from"./input-xqPBO_Zl.js";import{T as De}from"./textarea-C5Z8yeqo.js";import{D as Me,a as Fe,b as ze,c as Re,d as Te,e as $e}from"./dialog-CToh4lty.js";import{R as Oe,a as Ue}from"./radio-group-BM2XqfaW.js";import"./checkbox-Doc_5V3r.js";import{L as ie}from"./label-Dd1EhhTc.js";import{c as B}from"./utils-3IzWRrVe.js";import{C as Z}from"./circle-alert-DnNDG1se.js";import{C as se}from"./circle-check-big-DQlvzzB6.js";import{S as Y}from"./send-D2LPRPSI.js";import{C as Ie}from"./clock-DUfJelbJ.js";import{U as xe}from"./user-C_KdkjIX.js";import{U as Be}from"./users-De1bkoUV.js";import{C as Pe}from"./chart-column-BmPD_DCR.js";import{T as Ve}from"./trending-up-hgXaA--6.js";import{u as He}from"./use-toast-CI7Qu0JR.js";import{c as Le,s as Ge,a as Qe,g as Xe}from"./autoGradingService-DyGXQBXU.js";import{u as Ze}from"./useActivityFiles-t5OMiK2E.js";import{u as Ye}from"./useRedisCache-Bcf7HeY8.js";import{A as Je}from"./arrow-left-CkMJQCbx.js";import{C as ne}from"./calendar-DetO6w5d.js";import{F as le}from"./file-text-Bwu_iaa-.js";import{D as de}from"./download-ykT1hpdM.js";import{A as Ke}from"./award-FA0zJ_Ca.js";import{S as We}from"./save-DigPTmhI.js";import{d as oe}from"./differenceInHours-DYlE495b.js";import{f as U}from"./format-B5colFmK.js";import{i as et}from"./isPast-DRdJRFoN.js";import{p as I}from"./pt-BR-D0BJ_iDf.js";import"./index-BSMAqeIB.js";import"./index-D0BS1fLY.js";import"./Combination-DKLEa6f3.js";import"./SidebarPremium-C1f4icTt.js";import"./house-BkBGIUz8.js";import"./book-open-BqVBcqQl.js";import"./graduation-cap-pwvok64K.js";import"./message-circle-DVaucFfj.js";import"./settings-Blsx5C_z.js";import"./brain-BPIciAtW.js";import"./index-DV-1B3c4.js";import"./proxy-Bb-A2TUD.js";import"./chevron-right-DUVlURpD.js";import"./x-Wvu9FBm3.js";import"./index-4Tq-pSUS.js";import"./check-BLcdb3Nz.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-DaE-csDX.js";const ce={pending:{label:"Pendente",icon:Ie,bg:"bg-amber-100 dark:bg-amber-900/30",text:"text-amber-700 dark:text-amber-400",border:"border-amber-300 dark:border-amber-700",emoji:"ðŸŸ¡"},submitted:{label:"Enviada",icon:Y,bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-700 dark:text-blue-400",border:"border-blue-300 dark:border-blue-700",emoji:"ðŸ”µ"},graded:{label:"Corrigida",icon:se,bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-400",border:"border-green-300 dark:border-green-700",emoji:"ðŸŸ¢"},late:{label:"Atrasada",icon:Z,bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-400",border:"border-red-300 dark:border-red-700",emoji:"ðŸ”´"}},tt={sm:{container:"px-2 py-0.5 text-xs gap-1",icon:"w-3 h-3"},md:{container:"px-3 py-1 text-sm gap-1.5",icon:"w-4 h-4"},lg:{container:"px-4 py-2 text-base gap-2",icon:"w-5 h-5"}},me=({status:x="pending",size:v="md",score:o,maxScore:g=10,className:j,showEmoji:s=!0})=>{const u=ce[x]||ce.pending,i=tt[v],C=u.icon;return e.jsxs("div",{className:B("inline-flex items-center rounded-full font-semibold border-2 transition-all",u.bg,u.text,u.border,i.container,j),children:[s&&e.jsx("span",{children:u.emoji}),e.jsx(C,{className:i.icon}),e.jsx("span",{children:u.label}),x==="graded"&&o!==void 0&&e.jsxs("span",{className:"ml-1 font-bold",children:["â€¢ ",Number(o).toFixed(1),"/",g]})]})},ue=p.memo(({studentGrade:x,classAverage:v,maxGrade:o=100,className:g})=>{const j=x/o*100,s=v/o*100,u=x-v,i=u>0,k=(N=>N>=90?"bg-emerald-500":N>=70?"bg-blue-500":N>=60?"bg-amber-500":"bg-red-500")(j);return e.jsxs("div",{className:B("space-y-6",g),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(xe,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Sua Nota"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-4xl font-bold text-slate-900 dark:text-white",children:x.toFixed(1)}),e.jsxs("span",{className:"text-lg text-slate-500 dark:text-slate-400",children:["/ ",o]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Be,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"MÃ©dia da Turma"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-4xl font-bold text-slate-900 dark:text-white",children:v.toFixed(1)}),e.jsxs("span",{className:"text-lg text-slate-500 dark:text-slate-400",children:["/ ",o]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Pe,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"ComparaÃ§Ã£o de Notas"})]}),e.jsxs("div",{className:"flex items-end justify-center gap-12 pt-4 pb-4",children:[e.jsxs("div",{className:"flex flex-col items-center w-32",children:[e.jsx("div",{className:"relative w-full h-56 mb-4",children:e.jsx("div",{className:B("absolute bottom-0 w-full rounded-t-lg transition-all duration-1000 flex items-end justify-center pb-3",k),style:{height:`${Math.max(j,8)}%`},children:e.jsx("span",{className:"text-white font-bold text-lg drop-shadow-lg",children:x.toFixed(1)})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"VocÃª"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[j.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"flex flex-col items-center w-32",children:[e.jsx("div",{className:"relative w-full h-56 mb-4",children:e.jsx("div",{className:"absolute bottom-0 w-full bg-slate-400 dark:bg-slate-600 rounded-t-lg transition-all duration-1000 flex items-end justify-center pb-3",style:{height:`${Math.max(s,8)}%`},children:e.jsx("span",{className:"text-white font-bold text-lg drop-shadow-lg",children:v.toFixed(1)})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"Turma"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[s.toFixed(0),"%"]})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:B("p-2.5 rounded-lg",i?"bg-emerald-100 dark:bg-emerald-900/30":u===0?"bg-blue-100 dark:bg-blue-900/30":"bg-amber-100 dark:bg-amber-900/30"),children:e.jsx(Ve,{className:B("w-6 h-6",i?"text-emerald-600 dark:text-emerald-400":u===0?"text-blue-600 dark:text-blue-400":"text-amber-600 dark:text-amber-400",!i&&u!==0&&"rotate-180")})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:B("text-base font-semibold mb-1",i?"text-emerald-700 dark:text-emerald-400":u===0?"text-blue-700 dark:text-blue-400":"text-amber-700 dark:text-amber-400"),children:i?e.jsxs(e.Fragment,{children:["VocÃª estÃ¡ ",Math.abs(u).toFixed(1)," pontos acima da mÃ©dia"]}):u===0?e.jsx(e.Fragment,{children:"VocÃª estÃ¡ na mÃ©dia da turma"}):e.jsxs(e.Fragment,{children:["VocÃª estÃ¡ ",Math.abs(u).toFixed(1)," pontos abaixo da mÃ©dia"]})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:i?"ParabÃ©ns! Continue assim!":u===0?"Continue estudando para superar a mÃ©dia!":"Continue se esforÃ§ando!"})]})]})})]})});ue.displayName="GradeChart";const st=x=>{const{user:v}=Ae(),o=p.useCallback(async()=>{if(!x||!v?.id)return null;try{const{data:j,error:s}=await h.auth.getUser();if(s)throw s;const u=j?.user;if(!u?.id)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{data:i,error:C}=await h.from("activities").select("*").eq("id",x).single();if(C)throw C;const{data:k}=await h.from("activity_class_assignments").select("class_id").eq("activity_id",x).single();let N=null;if(k){const{data:q}=await h.from("classes").select("id, name, color").eq("id",k.class_id).single();N=q}let S=null;if(i?.created_by){const{data:q}=await h.from("profiles").select("id, full_name, email").eq("id",i.created_by).maybeSingle();S=q}const{data:P,error:G}=await h.from("submissions").select("*").eq("activity_id",x).eq("student_id",u.id).order("submitted_at",{ascending:!1}).limit(1);if(G)throw G;const E=P?.[0]||null,b=E?typeof E.content?.attemptNumber=="number"?E.content.attemptNumber:1:0;let M=null;if(E?.status==="graded"){const{data:q,error:R}=await h.from("submissions").select("grade").eq("activity_id",x).eq("status","graded").not("grade","is",null);if(R)throw R;if(q&&q.length>0){const V=q.map(T=>parseFloat(T.grade)),F=V.reduce((T,J)=>T+J,0)/V.length,X=Math.max(...V);M={average:F,maxGrade:X,totalSubmissions:q.length}}}const Q={...i,class_name:N?.name,class_color:N?.color,class_id:N?.id,teacher_name:S?.full_name||S?.name||S?.email||null};return{currentUser:u,activity:Q,submission:E,classStats:M,submissionAttempts:b}}catch(j){throw d.error("[useStudentActivityDetails] Erro geral:",j),j}},[x,v?.id]),g=x&&v?.id?`student:activity-details:${v.id}:${x}`:null;return Ye(g,o,{ttl:300,enabled:!!g,staleTime:60*1e3})},ts=()=>{const{activityId:x}=_e(),v=Ce(),{toast:o}=He(),[g,j]=p.useState(!1),[s,u]=p.useState(null),[i,C]=p.useState(null),[k,N]=p.useState(""),[S,P]=p.useState([]),[G,E]=p.useState(!1),[b,M]=p.useState({}),[Q,q]=p.useState(null),[R,V]=p.useState(0),[F,X]=p.useState(!1),[T,J]=p.useState(null),[ae,K]=p.useState(null),{uploadSubmission:be,isUploading:W,uploadProgress:he,removeSubmissionFile:pe}=Ze(x,T?.id,!1),{data:ee,loading:ge,refetch:fe}=st(x);p.useEffect(()=>{if(!ee)return;const{currentUser:t,activity:r,submission:n,classStats:a,submissionAttempts:l}=ee;J(t),u(r),C(n),q(a),V(l);const c=n?.content||{};N(c.answer||""),M(c.selectedAnswers||{}),P(Array.isArray(c.attachments)?c.attachments:[]),X(!1)},[ee]);const ve=async()=>{try{const{data:t}=await h.auth.getUser(),r={activity_id:x,student_id:t.user.id,content:{answer:k},status:"draft"};i?await h.from("submissions").update(r).eq("id",i.id):await h.from("submissions").insert(r),o({title:"Rascunho salvo",description:"Suas alteraÃ§Ãµes foram salvas"})}catch(t){d.error("Erro ao salvar rascunho:",t),o({title:"âŒ Erro ao salvar",description:t.message,variant:"destructive"})}},je=async()=>{if(d.debug("[handleSubmit] BotÃ£o clicado!",{activityType:s?.type,selectedAnswersCount:Object.keys(b).length,selectedAnswers:b,activityStatus:w}),$){const t=s.content?.questions||[];if(d.debug("[handleSubmit] Validando questÃµes:",{totalQuestions:t.length,answeredQuestions:Object.keys(b).length}),!t.every((n,a)=>{const l=n.id||a,c=b[l]!==void 0&&b[l]!==null;return d.debug("[handleSubmit] QuestÃ£o:",{questionId:l,hasAnswer:c,answer:b[l]}),c})){d.warn("[handleSubmit] Nem todas questÃµes respondidas"),o({title:"QuestÃµes nÃ£o respondidas",description:"Responda todas as questÃµes antes de enviar",variant:"destructive"});return}}else if(H){if(!S||S.length===0){d.warn("[handleSubmit] Nenhum arquivo anexado para atividade project"),o({title:"Nenhum arquivo anexado",description:"Envie pelo menos um arquivo com sua resposta antes de enviar a atividade.",variant:"destructive"});return}}else if(!k.trim()){d.warn("[handleSubmit] Resposta dissertativa vazia"),o({title:"Resposta vazia",description:"Digite sua resposta antes de enviar",variant:"destructive"});return}d.debug("[handleSubmit] ValidaÃ§Ã£o passou! Abrindo modal..."),E(!0)},Ne=async()=>{E(!1);try{j(!0);let t;H?t={attachments:S}:(t={answer:k},$&&(t.selectedAnswers=b));let r=1;if(i){const m=i.content?.attemptNumber;typeof m=="number"&&m>0?r=m+1:r=2}t.attemptNumber=r;const{data:n}=await h.auth.getUser();let a=null,l="submitted",c=null,z=null;if(Le(s)&&Ge(s)){const m=s?.content?.questions||[];a=Qe(m,b,s.max_score),a&&(l="graded",c=a.grade,z=Xe(a),d.debug("[Submission] CorreÃ§Ã£o automÃ¡tica aplicada:",a))}const y={activity_id:x,student_id:n.user.id,content:t,status:l,submitted_at:new Date().toISOString()};if(c!=null){const m=parseFloat(c),_=parseFloat(s?.max_score||10);let f=m;_!==10&&_>0&&(f=m/_*10),f=Math.max(0,Math.min(10,f)),f=Math.round(f*100)/100,d.debug("[confirmSubmit] Validando grade:",{autoGrade:c,gradeValue:m,maxScore:_,normalizedGrade:f,isValid:!isNaN(m)&&m>=0&&m<=_}),!isNaN(f)&&f>=0&&f<=10?(y.grade=f,y.graded_at=new Date().toISOString(),y.feedback=z):d.warn("[confirmSubmit] Grade invÃ¡lida, nÃ£o serÃ¡ enviada:",{normalizedGrade:f})}if(d.debug("[confirmSubmit] Dados finais para envio:",y),i){const{error:m}=await h.from("submissions").update(y).eq("id",i.id);if(m)throw m;d.debug("[confirmSubmit] SubmissÃ£o atualizada (tentativa mÃºltipla)")}else{const{error:m}=await h.from("submissions").insert(y);if(m)throw m;d.debug("[confirmSubmit] Nova submissÃ£o criada (primeira tentativa)")}o(c!==null?{title:"Atividade corrigida!",description:`Sua nota: ${c}/${s.max_score} (${a.percentage}%)`}:{title:"Atividade enviada!",description:"Aguarde a correÃ§Ã£o do professor"}),await fe()}catch(t){d.error("Erro ao enviar:",t),d.error("[confirmSubmit] Detalhes do erro:",{message:t.message,code:t.code,details:t.details,hint:t.hint,fullError:JSON.stringify(t,null,2)}),o({title:"âŒ Erro ao enviar",description:t.message||"Erro desconhecido ao enviar atividade",variant:"destructive"})}finally{j(!1)}},w=s?i?.status==="graded"?"graded":i?.status==="submitted"?"submitted":s?.due_date&&et(new Date(s.due_date))?"late":"pending":"pending",A=s?.due_date?new Date(s.due_date):null,re=A&&oe(A,new Date)<24&&w==="pending",$=s?.type==="quiz"||s?.type==="multiple_choice"||s?.type==="closed",H=s?.type==="project"||s?.content?.advanced_settings?.submissionMode==="file_upload",te=s?.content?.advanced_settings?.maxAttempts||1,we=te>1&&R<te,L=!F&&(w==="submitted"||w==="graded");d.debug("[StudentActivityDetails] Estado atual:",{activityStatus:w,hasActivity:!!s,activityType:s?.type,questionsCount:s?.content?.questions?.length,selectedAnswersCount:Object.keys(b).length,selectedAnswers:b,hasSubmission:!!i,submissionStatus:i?.status,advancedSettings:s?.content?.advanced_settings});const ye=async t=>{const r=t.target.files?.[0];if(!(!r||!s||!T))try{if(r.size>52428800){const m=(r.size/1048576).toFixed(1),_=(52428800/(1024*1024)).toFixed(0),f=`O tamanho maximo permitido e de ${_} MB por arquivo. Seu arquivo tem ${m} MB.`;d.warn("[handleUploadAttachment] Arquivo acima do limite",{sizeMb:m,limitMb:_,fileName:r.name}),K(f),o({title:"Arquivo muito grande",description:f,variant:"destructive"}),t.target.value="";return}K(null);let a=i;if(!a){const{data:m,error:_}=await h.from("submissions").insert({activity_id:x,student_id:T.id,content:{attachments:[]},status:"draft",created_at:new Date().toISOString()}).select().single();if(_)throw _;a=m,C(m)}const l=await be(r,a.id),c=[...Array.isArray(a.content?.attachments)?a.content.attachments:[],{name:l.name,url:l.url,path:l.path,size:l.size,type:l.type}],{data:z,error:y}=await h.from("submissions").update({content:{...a.content||{},attachments:c},status:a.status||"draft",updated_at:new Date().toISOString()}).eq("id",a.id).select().single();if(y)throw y;C(z),P(c),o({title:"Arquivo anexado",description:"Seu arquivo foi enviado com sucesso."})}catch(n){d.error("Erro ao enviar anexo da atividade:",n),K(n.message||"Erro ao enviar o arquivo. Tente novamente em instantes."),o({title:"Erro ao enviar arquivo",description:n.message||"Tente novamente em instantes.",variant:"destructive"})}finally{t.target.value=""}},ke=async t=>{if(t)try{if(t.path){const{data:r,error:n}=await h.storage.from("submissions").download(t.path);if(n)throw n;const a=URL.createObjectURL(r);window.open(a,"_blank","noopener,noreferrer")}else t.url&&window.open(t.url,"_blank","noopener,noreferrer")}catch(r){d.error("Erro ao abrir anexo da submiss\0e3o:",r),o({title:"Erro ao abrir arquivo",description:r.message||"N\0e3o foi poss\0edvel abrir o arquivo. Tente novamente.",variant:"destructive"})}},Se=async t=>{if(t)try{t.path&&await pe(t.path);const r=i,a=(Array.isArray(r?.content?.attachments)?r.content.attachments:S).filter(l=>l.path!==t.path||l.name!==t.name);if(r){const l=a.length===0?"draft":r.status||"draft",c=a.length===0?null:r.submitted_at,{data:z,error:y}=await h.from("submissions").update({content:{...r.content||{},attachments:a},status:l,submitted_at:c,updated_at:new Date().toISOString()}).eq("id",r.id).select().single();if(y)throw y;C(z)}P(a),o({title:"Envio cancelado",description:"O arquivo foi removido. Voc\0ea pode enviar outro arquivo."})}catch(r){d.error("Erro ao remover anexo da submiss\0e3o:",r),o({title:"Erro ao cancelar envio",description:r.message||"N\0e3o foi poss\0edvel remover o arquivo. Tente novamente.",variant:"destructive"})}};return ge?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ee,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 p-6 shadow-md",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs(D,{variant:"ghost",onClick:()=>v(-1),className:"text-white hover:bg-white/15 mb-4",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Voltar Ã  Turma"]}),e.jsx("div",{className:"flex items-start justify-between flex-wrap gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white mb-2",children:s?.title}),(s?.class_name||s?.teacher_name)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3 text-xs sm:text-sm text-white/90",children:[s?.class_name&&e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsx("span",{children:s.class_name})]}),s?.teacher_name&&e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{children:["Professor(a) ",s.teacher_name]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(me,{status:w,size:"lg",score:i?.grade,maxScore:s?.max_score||10}),A&&e.jsxs("div",{className:"flex items-center gap-2 text-white/90",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Prazo: ",U(A,"dd/MM/yyyy 'Ã s' HH:mm",{locale:I})]})]})]})]})}),re&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 max-w-xl px-4 py-3 rounded-lg border border-red-200 bg-red-50/90 text-red-700 dark:bg-red-950/30 dark:border-red-800 dark:text-red-200 text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"ATENÃ‡ÃƒO: menos de 24 horas para o prazo desta atividade."})]})]})}),e.jsx("div",{className:"container mx-auto p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs(O,{className:"p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),"DescriÃ§Ã£o"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:s?.description||"Sem descriÃ§Ã£o"}}),Array.isArray(s?.content?.attachments)&&s.content.attachments.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600"}),"Arquivos da Atividade"]}),e.jsx("ul",{className:"space-y-2",children:s.content.attachments.map((t,r)=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate mr-2",children:t.name}),t.url&&e.jsxs(D,{size:"sm",variant:"outline",className:"h-8 px-3",onClick:()=>window.open(t.url,"_blank","noopener,noreferrer"),children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Baixar"]})]},t.path||t.url||r))})]})]}),s?.content?.rubric&&e.jsxs(O,{className:"p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-600"}),"CritÃ©rios de AvaliaÃ§Ã£o"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-sm",children:s.content.rubric})]}),$&&s?.content?.questions&&(w!=="graded"||F)&&e.jsxs(O,{className:"p-4 sm:p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),"QuestÃµes"]}),s.content.questions.map((t,r)=>{const n=t.id||r;return e.jsxs("div",{className:"mb-6 p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold mb-3",children:[r+1,". ",t.text||t.question]}),t.alternatives&&t.alternatives.length>0&&e.jsx("div",{className:"space-y-2",children:t.alternatives.map(a=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors cursor-pointer",onClick:()=>{L||(d.debug("[Alternativa] Clicada:",{questionId:n,altId:a.id,letter:a.letter}),M({...b,[n]:String(a.id)}))},children:[e.jsx("input",{type:"radio",name:`question-${n}`,id:`q${n}-${a.id}`,value:String(a.id),checked:String(b[n])===String(a.id),onChange:l=>{d.debug("[Radio] Changed:",{questionId:n,value:l.target.value}),L||M({...b,[n]:l.target.value})},disabled:L,className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500 focus:ring-2 cursor-pointer"}),e.jsxs(ie,{htmlFor:`q${n}-${a.id}`,className:"flex-1 cursor-pointer",children:[e.jsxs("span",{className:"font-semibold mr-2",children:[a.letter,")"]}),a.text]})]},a.id))}),!t.alternatives&&t.options&&t.options.length>0&&e.jsx(Oe,{value:b[n],onValueChange:a=>{L||M({...b,[n]:a})},children:t.options.map((a,l)=>e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ue,{value:a,id:`q${n}-${l}`,disabled:L}),e.jsx(ie,{htmlFor:`q${n}-${l}`,children:a})]},l))})]},n)})]}),(w!=="graded"||F)&&e.jsxs(O,{className:"p-4 sm:p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-green-600"}),w==="submitted"&&!F?"Status da SubmissÃ£o":"Enviar Atividade"]}),w==="submitted"&&!F?e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400 mb-2",children:["Atividade enviada em ",U(new Date(i.submitted_at),"dd/MM/yyyy 'Ã s' HH:mm",{locale:I})]}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300",children:"Aguardando correÃ§Ã£o do professor..."})]}):e.jsxs(e.Fragment,{children:[!$&&!H&&e.jsx(De,{value:k,onChange:t=>N(t.target.value),placeholder:"Digite sua resposta aqui...",rows:10,className:"mb-4"}),(s?.type==="closed"||s?.type==="quiz"||s?.type==="multiple_choice")&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["Revise suas respostas antes de enviar.",s?.content?.advanced_settings?.showScoreImmediately&&e.jsx("span",{className:"font-semibold",children:" Sua nota serÃ¡ calculada automaticamente!"})]})}),H&&e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["Envie sua resposta como arquivo (PDF, DOC, DOCX, ODT, TXT, ZIP, RAR ou 7Z).",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Tamanho maximo por arquivo: 50 MB."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{type:"file",accept:".pdf,.doc,.docx,.odt,.txt,.zip,.rar,.7z",onChange:ye,disabled:W||g}),W&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Enviando... ",he,"%"]})]}),ae&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:ae}),S.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Arquivos enviados:"}),S.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between text-xs border rounded px-3 py-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mr-2 min-w-0 flex-1",children:[e.jsx("span",{className:"truncate",children:t.name}),typeof t.size=="number"&&e.jsxs("span",{className:"text-[11px] text-slate-500 flex-shrink-0",children:[(t.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2 text-blue-600 hover:text-blue-700",onClick:()=>ke(t),children:"Abrir"}),e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2 text-red-600 hover:text-red-700",onClick:()=>Se(t),disabled:W||g,children:"Cancelar envio"})]})]},t.path||t.url||r))]})]}),e.jsxs("div",{className:"flex gap-3",children:[!$&&!H&&e.jsxs(D,{variant:"outline",onClick:ve,disabled:!k.trim(),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Salvar Rascunho"]}),e.jsxs(D,{onClick:je,disabled:g,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),g?"Enviando...":"Enviar Atividade"]})]})]})]}),w==="graded"&&e.jsxs(O,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Resultado"}),s?.class_name&&e.jsx("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900 rounded-full",children:e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:s.class_name})})]}),Q&&e.jsx(ue,{studentGrade:i.grade,classAverage:Q.average,maxGrade:s.max_score||10,className:"mb-6"}),i.feedback&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold mb-2 text-slate-900 dark:text-white",children:"Feedback do Professor"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:i.feedback})]}),$&&s?.content?.questions&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold mb-2 text-slate-900 dark:text-white",children:"Suas Respostas"}),e.jsx("div",{className:"space-y-3",children:s.content.questions.map((t,r)=>{const n=t.id||r,a=b[n];let l="";if(t.alternatives&&a!==void 0&&a!==null){const c=t.alternatives.find(z=>String(z.id)===String(a));c&&(l=`${c.letter}) ${c.text}`)}else t.options&&a!==void 0&&a!==null&&(l=String(a));return e.jsxs("div",{className:"p-3 rounded-lg bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700",children:[e.jsxs("p",{className:"text-sm font-semibold mb-1",children:[r+1,". ",t.text||t.question]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:l||"NÃ£o respondida"})]},n)})})]}),!$&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold mb-2 text-slate-900 dark:text-white",children:"Sua Resposta"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:k})]}),we&&!F&&e.jsxs("div",{className:"mt-6 p-4 bg-amber-50 dark:bg-amber-950/20 rounded-xl border border-amber-200 dark:border-amber-800",children:[e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200 mb-2",children:`Esta atividade permite mÃºltiplas tentativas (${R}/${te} jÃ¡ realizadas).`}),e.jsx(D,{variant:"outline",onClick:()=>{X(!0),N(""),M({})},children:"Nova tentativa"})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(O,{className:"p-6 sticky top-6",children:[e.jsx("h3",{className:"font-bold mb-4 flex items-center gap-2",children:"InformaÃ§Ãµes"}),e.jsxs("div",{className:"space-y-4",children:[A&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Prazo de Entrega"}),e.jsx("p",{className:"font-semibold text-lg",children:U(A,"dd/MM/yyyy",{locale:I})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:U(A,"HH:mm",{locale:I})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Nota MÃ¡xima"}),e.jsxs("p",{className:"font-semibold text-2xl text-blue-600",children:[s?.max_score||10," pontos"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-2",children:"Status Atual"}),e.jsx(me,{status:w,size:"md",score:i?.grade,maxScore:s?.max_score||10})]}),s?.class_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Turma"}),e.jsx("p",{className:"font-semibold",children:s.class_name})]})]}),re&&A&&e.jsx("div",{className:"mt-6 p-4 bg-red-50 dark:bg-red-950/20 border-2 border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:[Math.floor(oe(A,new Date))," horas restantes!"]})})]})})]})}),e.jsx(Me,{open:G,onOpenChange:E,children:e.jsxs(Fe,{className:"max-w-md",children:[e.jsxs(ze,{children:[e.jsxs(Re,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600"}),"Confirmar Envio da Atividade"]}),e.jsx(Te,{children:"Revise os detalhes antes de enviar sua atividade."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Data de Envio:"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:U(new Date,"dd/MM/yyyy 'Ã s' HH:mm",{locale:I})})]}),A&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Prazo:"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:U(A,"dd/MM/yyyy 'Ã s' HH:mm",{locale:I})})]}),(()=>{const t=s?.content?.advanced_settings?.maxAttempts||1;return t>1?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Tentativas:"}),e.jsxs("span",{className:`text-sm font-semibold ${R<t?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[R+1,"/",t]})]}):null})(),(s?.type==="closed"||s?.type==="quiz"||s?.type==="multiple_choice"||s?.type==="checkbox")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"QuestÃµes Respondidas:"}),e.jsxs("span",{className:`text-sm font-semibold ${Object.keys(b).length===(s?.content?.questions||[]).length?"text-green-600 dark:text-green-400":"text-orange-600 dark:text-orange-400"}`,children:[Object.keys(b).length,"/",(s?.content?.questions||[]).length]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"ðŸŽ¯ Nota MÃ¡xima:"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400",children:[s?.max_score||10," pontos"]})]})]}),s?.content?.advanced_settings?.showScoreImmediately&&(s?.type==="closed"||s?.type==="quiz")&&e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"CorreÃ§Ã£o automÃ¡tica ativada! VocÃª verÃ¡ sua nota imediatamente."]})}),(()=>{const t=s?.content?.advanced_settings?.maxAttempts||1,r=s?.content?.advanced_settings?.keepBestGrade;return d.debug("[Modal] ConfiguraÃ§Ãµes:",{maxAttempts:t,keepBestGrade:r}),t>1?e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("span",{children:["VocÃª pode enviar atÃ© ",e.jsxs("strong",{children:[t,"x"]}),".",r===!0&&" SerÃ¡ considerada a maior nota.",r===!1&&" SerÃ¡ considerada a Ãºltima nota.",r===void 0&&" SerÃ¡ considerada a Ãºltima nota."]})]})}):e.jsx("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("strong",{children:"AtenÃ§Ã£o:"})," ApÃ³s o envio, vocÃª nÃ£o poderÃ¡ editar suas respostas."]})})})()]}),e.jsxs($e,{className:"gap-2",children:[e.jsx(D,{variant:"outline",onClick:()=>E(!1),disabled:g,children:"Revisar Respostas"}),e.jsx(D,{onClick:Ne,className:"bg-green-600 hover:bg-green-700",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Confirmar Envio"]})})]})]})})]})};export{ts as default};
