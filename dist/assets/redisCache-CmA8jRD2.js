import{l as i}from"./main-CzXMpjXe.js";const c="https://wapbwaimkurbuihatmix.supabase.co/functions/v1/redis-cache",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhcGJ3YWlta3VyYnVpaGF0bWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyODY3MjksImV4cCI6MjA3NDg2MjcyOX0.x-NQQ2TtRgaUjjBZCf6j49eWOW4XSqjTFKC_KB1L56A",n={classStats:300,students:600,activities:300,materials:900,posts:180,default:300};class u{constructor(){this.enabled=!0}async invalidatePattern(t){return await this.deletePattern(t)}async request(t,e={}){if(!this.enabled)return null;try{const s=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({action:t,...e})});if(!s.ok)return s.status===500&&(this.enabled=!1),null;const a=await s.json();return a.success?a.result:null}catch{return this.enabled=!1,null}}async get(t){const e=await this.request("get",{key:t});if(e)try{return JSON.parse(e)}catch{return e}return null}async set(t,e,s=null){const a=typeof e=="string"?e:JSON.stringify(e),r=s||n.default;return await this.request("set",{key:t,value:a,ttl:r})}async delete(t){return await this.request("del",{key:t})}async deletePattern(t){try{const e=await this.request("keys",{pattern:t});if(e&&e.length>0){const s=e.map(a=>({command:"DEL",args:[a]}));return await this.request("batch",{operations:s})}}catch(e){i.warn("Error deleting pattern:",e)}return null}async cacheQuery(t,e,s=null){const a=await this.get(t);if(a!==null)return a;const r=await e();return r!=null&&await this.set(t,r,s),r}generateKey(t,...e){return`${t}:${e.join(":")}`}async invalidateClass(t){await this.deletePattern(`class:${t}:*`),await this.deletePattern(`stats:${t}:*`)}async invalidateUser(t){await this.deletePattern(`user:${t}:*`)}async getClassStats(t,e){const s=this.generateKey("stats",t,"overview");return await this.cacheQuery(s,e,n.classStats)}async getClassStudents(t,e){const s=this.generateKey("class",t,"students");return await this.cacheQuery(s,e,n.students)}async getClassActivities(t,e){const s=this.generateKey("class",t,"activities");return await this.cacheQuery(s,e,n.activities)}async getClassMaterials(t,e){const s=this.generateKey("class",t,"materials");return await this.cacheQuery(s,e,n.materials)}async getClassPosts(t,e){const s=this.generateKey("class",t,"posts");return await this.cacheQuery(s,e,n.posts)}async ping(){try{return await this.request("ping")==="PONG"}catch{return!1}}disable(){this.enabled=!1,i.warn("[Cache] Disabled")}enable(){this.enabled=!0}}const y=new u;export{y as r};
