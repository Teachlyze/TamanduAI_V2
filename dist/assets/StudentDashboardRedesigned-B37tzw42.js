import{b as ht,u as vt,r as f,l as y,s as r,j as t}from"./main-CI5_MmIm.js";import{u as xt}from"./use-toast-D7N2H9RC.js";import{S as k}from"./StatCard-DuAvUi6b.js";import{A as ft}from"./ActivityCard-DMGqr3ev.js";import{E as yt}from"./EventCard-Wkt7ZUwM.js";import{C as _}from"./card-DpcnMbcE.js";import{E as V}from"./EmptyState-ExwS4ndS.js";import{B as b}from"./button-D7H9d9Gd.js";import"./dialog-DzyprNmz.js";import{m as F}from"./proxy-CT7Xtxle.js";import{C as _t}from"./circle-alert-X86u08ZX.js";import{B as $}from"./book-open-DlGI5eOy.js";import{F as L}from"./file-text-CtozP3gh.js";import{S as K}from"./star-6E86D7gV.js";import{T as bt}from"./target-BgYs7ZJ1.js";import{C as jt}from"./circle-check-aCTblfpW.js";import{T as wt}from"./trending-up-1zEvTPQM.js";import{W,X,Y,_ as H,$ as U}from"./CartesianChart-DKXpiVYO.js";import{L as Nt,a as St}from"./LineChart-1TJYCqND.js";import{B as kt,a as Ct}from"./BarChart-BUl8ULUy.js";import{C as A}from"./calendar-Dbm_7POQ.js";import{s as At,f as Et}from"./format-BdDrz3ZT.js";import{e as Dt}from"./endOfDay-B-zzKHwV.js";import{p as Tt}from"./pt-BR-C6XVmIDX.js";import"./differenceInHours-CxKvrqrP.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-ChNhCS9W.js";import"./formatDistanceToNow-CR6k5j2z.js";import"./constructNow-DqwG0NnQ.js";import"./differenceInCalendarMonths-ka4FvHlb.js";import"./endOfMonth-rhMYNEE8.js";import"./badge-BOI6M_d9.js";import"./video-Ou893xhQ.js";import"./clock-3X7dheFj.js";import"./map-pin-NlcbbFzM.js";import"./index-D4BuPd_i.js";import"./index-DHrdJ99Z.js";import"./Combination-BfETjw1A.js";import"./SidebarPremium-0_wHXPj0.js";import"./house-B6Hparzo.js";import"./users-ChR7WEeh.js";import"./graduation-cap-mPfDCRgT.js";import"./chart-column-G5dLAdkQ.js";import"./message-circle-CRpVuYq9.js";import"./settings-BWUwUKXK.js";import"./brain-DVBX4Id_.js";import"./index-RHGs5twt.js";import"./chevron-right-CHSrP1xQ.js";import"./x-DGmYUGM5.js";import"./index-BhuNWwGV.js";const Ee=()=>{const{user:d}=ht(),v=vt(),{toast:J}=xt(),[It,E]=f.useState(!0),[Q,Z]=f.useState(!0),[x,D]=f.useState({totalClasses:0,pendingActivities:0,completedActivities:0,avgGrade:0,completionRate:0,gradeTrend:null}),[T,I]=f.useState([]),[M,tt]=f.useState([]),[q,et]=f.useState([]),[G,B]=f.useState([]),[R,st]=f.useState([]);f.useEffect(()=>{d?.id&&at()},[d]);const at=async()=>{try{E(!0),await Promise.all([it(),rt(),ot(),nt(),ct(),dt()])}catch(e){y.error("Erro ao carregar dashboard:",e),J({title:"Erro ao carregar informaÃ§Ãµes",description:"NÃ£o foi possÃ­vel carregar seu painel. Tente novamente em instantes.",variant:"destructive"})}finally{E(!1),Q&&Z(!1)}},it=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(c=>c.class_id)||[],n=a.length;if(a.length===0){D({totalClasses:0,pendingActivities:0,completedActivities:0,avgGrade:0,completionRate:0,gradeTrend:null});return}const{data:u}=await r.from("activity_class_assignments").select("activity_id, activity:activities(id, title, due_date, max_score)").in("class_id",a),o=u?.map(c=>c.activity_id).filter(Boolean)||[],{data:m}=await r.from("submissions").select("activity_id, status, grade, submitted_at").eq("student_id",d.id).in("activity_id",o),l=new Set(m?.map(c=>c.activity_id)||[]),g=o.length-l.size,i=l.size,p=m?.filter(c=>c.grade!==null)||[],h=p.length>0?p.reduce((c,N)=>c+parseFloat(N.grade),0)/p.length:0;let s=null;if(p.length>=2){const c=[...p].sort((S,j)=>new Date(S.submitted_at)-new Date(j.submitted_at)),N=5,C=c.length,P=Math.max(C-N,0),lt=Math.max(C-2*N,0),mt=c.slice(P,C),z=c.slice(lt,P);if(z.length>0){const S=O=>O.reduce((ut,gt)=>ut+parseFloat(gt.grade),0)/O.length,j=S(z),pt=S(mt);j>0?s=Math.round((pt-j)/j*100):s=0}else s=0}const w=o.length>0?Math.round(i/o.length*100):0;D({totalClasses:n,pendingActivities:g,completedActivities:i,avgGrade:h,completionRate:w,gradeTrend:s})}catch(e){y.error("Erro ao carregar stats:",e)}},rt=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(s=>s.class_id)||[];if(a.length===0){I([]);return}const{data:n}=await r.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",a),u=n?.map(s=>s.activity_id).filter(Boolean)||[],{data:o}=await r.from("activities").select("id, title, description, type, due_date, max_score").in("id",u),{data:m}=await r.from("classes").select("id, name, subject").in("id",a),l={};o?.forEach(s=>{l[s.id]=s});const g={};m?.forEach(s=>{g[s.id]=s});const{data:i}=await r.from("submissions").select("activity_id, status, grade").eq("student_id",d.id).in("activity_id",u),p=new Set(i?.map(s=>s.activity_id)||[]),h=(n||[]).filter(s=>l[s.activity_id]&&!p.has(s.activity_id)).map(s=>{const w=l[s.activity_id],c=g[s.class_id];return{...w,class_name:c?.name,class_subject:c?.subject,status:new Date(w.due_date)<new Date?"late":"pending"}}).slice(0,5);I(h)}catch(e){y.error("Erro ao carregar atividades pendentes:",e)}},ot=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(s=>s.class_id)||[],n=new Date,u=At(n),o=Dt(n),{data:m}=await r.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, class_id").in("class_id",a).gte("start_time",u.toISOString()).lte("start_time",o.toISOString()).order("start_time",{ascending:!0}),{data:l}=await r.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, attendees, class_id").contains("attendees",[d.id]).gte("start_time",u.toISOString()).lte("start_time",o.toISOString()).order("start_time",{ascending:!0}),{data:g}=await r.from("classes").select("id, name").in("id",a),i={};g?.forEach(s=>{i[s.id]=s.name});const p=new Set,h=[...m||[],...l||[]].filter(s=>p.has(s.id)?!1:(p.add(s.id),!0)).map(s=>({...s,class_name:i[s.class_id]}));tt(h)}catch(e){y.error("Erro ao carregar eventos de hoje:",e)}},nt=async()=>{try{const{data:e}=await r.from("submissions").select(`
          id, grade, submitted_at,
          activity:activities(title, max_score)
        `).eq("student_id",d.id).not("grade","is",null).order("submitted_at",{ascending:!0}).limit(10),a=(e||[]).map(n=>({date:Et(new Date(n.submitted_at),"dd/MM",{locale:Tt}),avgGrade:parseFloat(n.grade)||0,activity:n.activity?.title}));et(a)}catch(e){y.error("Erro ao carregar dados de desempenho:",e)}},ct=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(o=>o.class_id)||[];if(a.length===0){B([]);return}const{data:n}=await r.from("classes").select("id, name, subject").in("id",a),u=await Promise.all((n||[]).map(async o=>{const{data:m}=await r.from("activity_class_assignments").select("activity_id").eq("class_id",o.id),l=m?.map(h=>h.activity_id)||[],{data:g}=await r.from("submissions").select("grade").eq("student_id",d.id).in("activity_id",l).not("grade","is",null),i=g?.map(h=>parseFloat(h.grade))||[],p=i.length>0?i.reduce((h,s)=>h+s,0)/i.length:0;return{name:o.name,value:p}}));B(u.sort((o,m)=>m.value-o.value).slice(0,5))}catch(e){y.error("Erro ao carregar top turmas:",e)}},dt=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),a=e?.map(i=>i.class_id)||[],{data:n}=await r.from("activity_class_assignments").select(`
          activity_id,
          activity:activities(id, title, due_date)
        `).in("class_id",a),u=n?.map(i=>i.activity_id).filter(Boolean)||[],{data:o}=await r.from("submissions").select("activity_id").eq("student_id",d.id).in("activity_id",u),m=new Set(o?.map(i=>i.activity_id)||[]),l=(n||[]).filter(i=>i.activity&&!m.has(i.activity.id)&&new Date(i.activity.due_date)<new Date),g=[];l.length>0&&g.push({type:"warning",message:`VocÃª tem ${l.length} atividade${l.length>1?"s":""} atrasada${l.length>1?"s":""}!`}),st(g)}catch(e){y.error("Erro ao carregar alertas:",e)}};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-blue-50/30 to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-6",children:[t.jsxs(F.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-600 via-blue-600 to-cyan-600 rounded-2xl p-8 mb-8 text-white shadow-xl",children:[t.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["OlÃ¡, ",d?.user_metadata?.name||d?.email?.split("@")[0]||"Estudante","!"]}),t.jsx("p",{className:"text-blue-100 text-lg",children:x.avgGrade>=8?"ðŸŽ‰ Seu desempenho estÃ¡ Ã³timo! Continue assim!":x.avgGrade>=6?"ðŸ‘ VocÃª estÃ¡ indo bem! Mantenha o foco!":x.avgGrade>0?"Vamos melhorar juntos! VocÃª consegue!":"ðŸ“š Comece suas atividades e acompanhe seu progresso!"})]}),R.length>0&&t.jsx(F.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8",children:R.map((e,a)=>t.jsx(_,{className:"p-4 bg-orange-50 dark:bg-orange-950/20 border-orange-300 dark:border-orange-800",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(_t,{className:"w-5 h-5 text-orange-600"}),t.jsx("p",{className:"text-orange-900 dark:text-orange-200 font-medium",children:e.message}),t.jsx(b,{variant:"outline",size:"sm",onClick:()=>v("/students/activities"),className:"ml-auto",children:"Ver Atividades"})]})},a))}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8",children:[t.jsx(k,{icon:$,value:x.totalClasses,label:"Turmas Ativas",gradient:"blue"}),t.jsx(k,{icon:L,value:x.pendingActivities,label:"Atividades Pendentes",gradient:"orange"}),t.jsx(k,{icon:K,value:x.avgGrade>0?x.avgGrade.toFixed(1):"--",label:"MÃ©dia Geral",gradient:"yellow",trend:x.gradeTrend}),t.jsx(k,{icon:bt,value:`${x.completionRate}%`,label:"Taxa de ConclusÃ£o",gradient:"green"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8 mb-6 md:mb-8",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 lg:space-y-8",children:[t.jsxs(_,{className:"p-4 sm:p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0 mb-4 sm:mb-6",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white",children:"PrÃ³ximas Atividades"}),t.jsx(b,{variant:"ghost",onClick:()=>v("/students/activities"),className:"text-blue-600 hover:text-blue-700",children:"Ver todas â†’"})]}),T.length>0?t.jsx("div",{className:"space-y-4",children:T.map((e,a)=>t.jsx(ft,{activity:e,onStart:()=>v(`/students/activities/${e.id}`),onView:()=>v(`/students/activities/${e.id}`),index:a},e.id))}):t.jsx(V,{icon:jt,title:"Tudo em dia!",description:"VocÃª nÃ£o tem atividades pendentes no momento. ParabÃ©ns!",variant:"success"})]}),q.length>0&&t.jsxs(_,{className:"p-6",children:[t.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[t.jsx(wt,{className:"w-6 h-6 text-blue-600"}),"Sua EvoluÃ§Ã£o"]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(W,{width:"100%",height:300,className:"min-w-[400px]",children:t.jsxs(Nt,{data:q,margin:{top:5,right:20,left:0,bottom:5},children:[t.jsx(X,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),t.jsx(Y,{dataKey:"date",stroke:"#64748b",tick:{fontSize:12}}),t.jsx(H,{stroke:"#64748b",domain:[0,10],tick:{fontSize:12}}),t.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px"}}),t.jsx(St,{type:"monotone",dataKey:"avgGrade",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:6},activeDot:{r:8},name:"MÃ©dia"})]})})})]}),G.length>0&&t.jsxs(_,{className:"p-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:"Melhores Turmas"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(W,{width:"100%",height:250,className:"min-w-[350px]",children:t.jsxs(kt,{data:G,margin:{top:5,right:20,left:0,bottom:5},children:[t.jsx(X,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),t.jsx(Y,{dataKey:"name",stroke:"#64748b",tick:{fontSize:11},angle:-15,textAnchor:"end",height:60}),t.jsx(H,{stroke:"#64748b",domain:[0,10],tick:{fontSize:12}}),t.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px"}}),t.jsx(Ct,{dataKey:"value",fill:"#10b981",radius:[8,8,0,0],name:"MÃ©dia"})]})})})]})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs(_,{className:"p-6",children:[t.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[t.jsx(A,{className:"w-5 h-5 text-blue-600"}),"Hoje"]}),M.length>0?t.jsx("div",{className:"space-y-3",children:M.map((e,a)=>t.jsx(yt,{event:e,onClick:()=>v("/students/calendar"),index:a},e.id))}):t.jsx(V,{icon:A,title:"Nenhum evento",description:"Sua agenda estÃ¡ livre hoje!",variant:"info"})]}),t.jsxs(_,{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"Atalhos RÃ¡pidos"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/activities"),children:[t.jsx(L,{className:"w-4 h-4 mr-2"}),"Minhas Atividades"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/classes"),children:[t.jsx($,{className:"w-4 h-4 mr-2"}),"Minhas Turmas"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/calendar"),children:[t.jsx(A,{className:"w-4 h-4 mr-2"}),"Agenda"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/performance"),children:[t.jsx(K,{className:"w-4 h-4 mr-2"}),"Minhas Notas"]})]})]})]})]})]})};export{Ee as default};
