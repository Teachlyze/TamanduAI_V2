import{b as me,u as ue,r as l,s as c,l as _,j as e,q as pe}from"./main-C5n3kzXQ.js";import{C as z}from"./card-CjtJprPz.js";import{A as F}from"./ActivityCard-CXr2imJh.js";import{E as xe}from"./EmptyState-cekabAEp.js";import"./button-CXfsJEZz.js";import"./dialog-D4cdgt_6.js";import{I as fe}from"./input-Bec_LEaF.js";import{T as ge,a as he,b as w}from"./tabs-Bmzwt0Jl.js";import{S as P,a as B,b as Q,c as R,d}from"./select-DC-_g-Tu.js";import{m as G}from"./proxy-C-9wZx5L.js";import{F as H}from"./file-text-0s37oUXW.js";import{C as be}from"./clock-DACORgp8.js";import{C as O}from"./circle-check-Ct3ReQO3.js";import{T as U}from"./triangle-alert-CyxJUOlk.js";import{S as W}from"./search-bvx9xJte.js";import{d as ve}from"./differenceInHours-CxKvrqrP.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-ChNhCS9W.js";import"./formatDistanceToNow-CR6k5j2z.js";import"./constructNow-DqwG0NnQ.js";import"./differenceInCalendarMonths-ka4FvHlb.js";import"./endOfDay-B-zzKHwV.js";import"./endOfMonth-rhMYNEE8.js";import"./format-BdDrz3ZT.js";import"./pt-BR-C6XVmIDX.js";import"./index-B6XryYCt.js";import"./index-CsW3l1Gu.js";import"./Combination-Chdg_-Wh.js";import"./SidebarPremium-D25G1dNT.js";import"./house-ZJXziqlE.js";import"./users-Boys-rM5.js";import"./book-open-BP8V__Hw.js";import"./graduation-cap-DHgx-smk.js";import"./calendar-BkZi9bLz.js";import"./chart-column-5ubExldJ.js";import"./message-circle-oS8o50gZ.js";import"./settings-BnI-Y10b.js";import"./brain-Bn2z760B.js";import"./index-DJGNkgSL.js";import"./chevron-right-avg7mug8.js";import"./x-3ab3q3Ef.js";import"./index-W2DwLdmL.js";import"./index-C2-paRPo.js";import"./index-CJbM7HGD.js";import"./index-D89hHhP8.js";import"./chevron-down-CRExErKk.js";import"./check-UVwrTgdR.js";import"./chevron-up-sGMMw-J9.js";const xs=()=>{const{user:o}=me(),f=ue(),[J,N]=l.useState(!0),[A,K]=l.useState(!0),[T,k]=l.useState([]),[m,X]=l.useState([]),[r,Y]=l.useState("all"),[g,Z]=l.useState(""),[h,ee]=l.useState("all"),[b,se]=l.useState("all"),[te,ae]=l.useState([]),[v,ie]=l.useState({total:0,pending:0,completed:0,late:0,urgent:0});l.useEffect(()=>{o?.id&&(re(),le())},[o]),l.useEffect(()=>{ce()},[T,r,g,h,b]);const le=async()=>{try{const{data:s}=await c.from("class_members").select("class_id").eq("user_id",o.id).eq("role","student"),t=s?.map(p=>p.class_id)||[],{data:i}=await c.from("classes").select("id, name, subject").in("id",t);ae(i||[])}catch(s){_.error("Erro ao carregar turmas:",s)}},re=async()=>{try{N(!0);const{data:s}=await c.from("class_members").select("class_id").eq("user_id",o.id).eq("role","student"),t=s?.map(a=>a.class_id)||[];if(t.length===0){k([]),N(!1);return}const{data:i}=await c.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",t),p=i?.map(a=>a.activity_id).filter(Boolean)||[],{data:oe}=await c.from("activities").select("id, title, description, type, due_date, max_score, created_at").in("id",p),{data:ne}=await c.from("classes").select("id, name, subject, color").in("id",t),y={};oe?.forEach(a=>{y[a.id]=a});const L={};ne?.forEach(a=>{L[a.id]=a});const{data:S,error:q}=await c.from("submissions").select("activity_id, status, grade, feedback, submitted_at").eq("student_id",o.id).in("activity_id",p);q&&_.error("Erro ao buscar submissões:",q),_.debug("[Activities] Submissões encontradas:",{userId:o.id,totalActivities:p.length,submissions:S?.length||0,submissionsData:S});const I={};S?.forEach(a=>{I[a.activity_id]=a});const n=(i||[]).filter(a=>y[a.activity_id]).map(a=>{const D=y[a.activity_id],C=L[a.class_id],x=I[a.activity_id],V=new Date(D.due_date),M=new Date,$=ve(V,M);let j="pending";return x?j=x.status==="graded"?"completed":"submitted":V<M&&(j="late"),{...D,class_id:a.class_id,class_name:C?.name,class_subject:C?.subject,class_color:C?.color,status:j,grade:x?.grade,feedback:x?.feedback,submitted_at:x?.submitted_at,assigned_at:a.assigned_at,is_urgent:$<=24&&$>=0&&j==="pending"}}),de={total:n.length,pending:n.filter(a=>a.status==="pending").length,completed:n.filter(a=>a.status==="completed"||a.status==="submitted").length,late:n.filter(a=>a.status==="late").length,urgent:n.filter(a=>a.is_urgent).length};ie(de),k(n)}catch(s){_.error("Erro ao carregar atividades:",s)}finally{N(!1),A&&K(!1)}},ce=()=>{let s=[...T];if(r==="pending"?s=s.filter(t=>t.status==="pending"||t.status==="late"):r==="completed"?s=s.filter(t=>t.status==="completed"||t.status==="submitted"):r==="late"&&(s=s.filter(t=>t.status==="late")),g){const t=g.toLowerCase();s=s.filter(i=>i.title?.toLowerCase().includes(t)||i.description?.toLowerCase().includes(t)||i.class_name?.toLowerCase().includes(t))}h!=="all"&&(s=s.filter(t=>t.class_id===h)),b!=="all"&&(s=s.filter(t=>t.type===b)),s.sort((t,i)=>t.status==="late"&&i.status!=="late"?-1:t.status!=="late"&&i.status==="late"?1:t.is_urgent&&!i.is_urgent?-1:!t.is_urgent&&i.is_urgent?1:new Date(t.due_date)-new Date(i.due_date)),X(s)},u=m.filter(s=>s.is_urgent),E=m.filter(s=>!s.is_urgent);return J&&A?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(pe,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-3 sm:p-4 md:p-6",children:[e.jsxs(G.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 sm:mb-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-2 sm:gap-3",children:[e.jsx(H,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-600"}),"Minhas Atividades"]}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-400",children:"Gerencie suas atividades e acompanhe seu progresso"})]}),e.jsx(z,{className:"p-3 sm:p-4 md:p-6 mb-6 sm:mb-8",children:e.jsxs(ge,{value:r,onValueChange:Y,children:[e.jsxs(he,{className:"grid grid-cols-2 sm:grid-cols-4 w-full mb-4 sm:mb-6",children:[e.jsxs(w,{value:"all",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"Todas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.total})]}),e.jsxs(w,{value:"pending",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(be,{className:"w-4 h-4"}),"Pendentes",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.pending})]}),e.jsxs(w,{value:"completed",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),"Concluídas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.completed})]}),e.jsxs(w,{value:"late",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(U,{className:"w-4 h-4"}),"Atrasadas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.late})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(fe,{placeholder:"Buscar atividades...",value:g,onChange:s=>Z(s.target.value),className:"pl-10"})]})}),e.jsxs(P,{value:h,onValueChange:ee,children:[e.jsx(B,{className:"w-full md:w-48",children:e.jsx(Q,{placeholder:"Todas as turmas"})}),e.jsxs(R,{children:[e.jsx(d,{value:"all",children:"Todas as turmas"}),te.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(P,{value:b,onValueChange:se,children:[e.jsx(B,{className:"w-full md:w-48",children:e.jsx(Q,{placeholder:"Todos os tipos"})}),e.jsxs(R,{children:[e.jsx(d,{value:"all",children:"Todos os tipos"}),e.jsx(d,{value:"objective",children:"Objetiva"}),e.jsx(d,{value:"open",children:"Aberta"}),e.jsx(d,{value:"mixed",children:"Mista"})]})]})]})]})}),u.length>0&&e.jsx(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"mb-8",children:e.jsxs(z,{className:"p-6 border-l-4 border-amber-500 bg-white dark:bg-slate-900",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-amber-500"}),"Atividades Urgentes - Prazo nas próximas 24 horas"]}),e.jsx("div",{className:"space-y-4",children:u.map((s,t)=>e.jsx(F,{activity:s,onStart:()=>f(`/students/activities/${s.id}`),onView:()=>f(`/students/activities/${s.id}`),index:t},s.id))})]})}),E.length>0?e.jsx("div",{className:"space-y-4",children:E.map((s,t)=>e.jsx(F,{activity:s,onStart:()=>f(`/students/activities/${s.id}`),onView:()=>f(`/students/activities/${s.id}`),index:t},s.id))}):e.jsx(xe,{icon:m.length===0&&u.length===0?O:W,title:m.length===0&&u.length===0?r==="completed"?"Nenhuma atividade concluída":"Nenhuma atividade":"Nenhum resultado encontrado",description:m.length===0&&u.length===0?r==="completed"?"Comece a fazer suas atividades para vê-las aqui quando concluídas.":"Você não tem atividades nesta categoria no momento.":"Tente ajustar os filtros de busca para encontrar o que procura.",variant:r==="completed"?"success":"default"})]})};export{xs as default};
