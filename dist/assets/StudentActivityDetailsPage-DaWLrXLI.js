import{c as _,r,j as e,e as A,l as D,u as E,a as C,s as m,k as P}from"./main-Cr4CeQqJ.js";import{B as v}from"./button-VDnOzUX8.js";import{C as c}from"./card-CvoT5xff.js";import{B as x}from"./badge-BpFoLbJI.js";import{D as R}from"./dropdown-menu-W1Sf6eM2.js";import"./input-DJYxsXYr.js";import"./label-Cj0ah_CE.js";import{A as q}from"./arrow-left-CYQstS2d.js";import{M as z}from"./message-square-DpSMhNWE.js";import"./index-Zvo5G3yJ.js";import"./chevron-right-D9YOEkTh.js";import"./check-BNbB6Qjw.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],B=_("send",L),N=r.forwardRef(({className:l,...u},d)=>e.jsx("textarea",{className:A("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),ref:d,...u}));N.displayName="Textarea";const X=()=>{const{activityId:l}=D(),u=E(),{user:d}=C(),[y,b]=r.useState(!0),[h,g]=r.useState(!1),[s,w]=r.useState(null),[a,p]=r.useState(null),[o,f]=r.useState(""),[I,F]=r.useState([]);r.useEffect(()=>{j()},[l,d]);const j=async()=>{if(d)try{b(!0);const{data:t}=await m.from("activities").select(`
          *,
          created_by_user:profiles!activities_created_by_fkey (
            id,
            name
          )
        `).eq("id",l).single();w(t);const{data:n}=await m.from("submissions").select(`
          *,
          feedback:feedbacks (*)
        `).eq("activity_id",l).eq("student_id",d.id).single();n&&(p(n),f(n.content||""))}catch(t){console.error("Erro:",t)}finally{b(!1)}},k=async()=>{if(!o.trim()){alert("Por favor, escreva sua resposta");return}try{if(g(!0),a){const{error:t}=await m.from("submissions").update({content:o,submitted_at:new Date().toISOString(),status:"submitted"}).eq("id",a.id);if(t)throw t}else{const{data:t,error:n}=await m.from("submissions").insert({activity_id:l,student_id:d.id,content:o,submitted_at:new Date().toISOString(),status:"submitted"}).select().single();if(n)throw n;p(t)}alert("Atividade enviada com sucesso!"),j()}catch(t){console.error("Erro:",t),alert("Erro ao enviar atividade")}finally{g(!1)}};if(y)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(P,{size:"lg"})});const S=s?.due_date&&new Date(s.due_date)<new Date,i=a?.grade!==null;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs(v,{variant:"ghost",onClick:()=>u("/student/activities"),className:"mb-4",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(R,{title:s?.title||"Atividade",subtitle:`Por ${s?.created_by_user?.name||"Professor"}`,role:"student"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(x,{className:s?.status==="active"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700",children:s?.status==="active"?"Ativa":"Encerrada"}),S&&e.jsx(x,{className:"bg-red-100 text-red-700",children:"Atrasada"}),i&&e.jsx(x,{className:"bg-blue-100 text-blue-700",children:"Corrigida"})]}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Instruções"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 whitespace-pre-wrap",children:s?.description||"Sem descrição"})]}),!i&&s?.status==="active"?e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Sua Resposta"}),e.jsx(N,{value:o,onChange:t=>f(t.target.value),placeholder:"Digite sua resposta aqui...",className:"mb-4 min-h-[300px]",disabled:i}),e.jsx("div",{className:"flex gap-2",children:e.jsx(v,{onClick:k,disabled:h||i,className:"bg-gradient-to-r from-blue-600 to-purple-600",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),a?"Atualizar Resposta":"Enviar Resposta"]})})})]}):i?e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Sua Resposta (Corrigida)"}),e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-lg mb-4",children:e.jsx("p",{className:"whitespace-pre-wrap",children:a?.content})})]}):null,i&&e.jsxs(c,{className:"p-6 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Feedback do Professor"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:a?.feedback?.[0]?.comment||"Sem comentários"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Nota:"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[a?.grade,"/",s?.max_score]})]})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Detalhes"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Prazo:"}),e.jsx("div",{className:"font-semibold",children:s?.due_date?new Date(s.due_date).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Sem prazo"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Pontuação:"}),e.jsxs("div",{className:"font-semibold",children:[s?.max_score," pontos"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Tipo:"}),e.jsx("div",{className:"font-semibold capitalize",children:s?.type||"Tarefa"})]}),a&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Status:"}),e.jsx("div",{className:"font-semibold",children:i?"Corrigida":a.submitted_at?"Enviada":"Rascunho"})]})]})]})})]})]})};export{X as default};
