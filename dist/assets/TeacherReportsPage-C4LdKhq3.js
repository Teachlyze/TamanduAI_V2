import{c as we,r as o,d as ce,f as ot,s as N,j as s,a as lt,l as I}from"./main-CulyknMy.js";import{C as G}from"./card-0IW715z3.js";import{B as R,m as ct}from"./button-Dfu2yMjN.js";import{B as Re}from"./badge-hAm5RhEJ.js";import{L as re}from"./label-hRNGW-_n.js";import{T as dt,a as ut,b as _e,c as Te}from"./tabs-LRhITz8G.js";import{S as se,a as ie,b as ne,c as oe,d as B}from"./select-CduS4jtJ.js";import{D as mt}from"./DashboardHeader-BwYDScVc.js";import"./input-BedeDxLw.js";import"./dropdown-menu-YDjYKa0f.js";import{u as Je}from"./use-toast-D1WbEInh.js";import{D as pt}from"./download-BdELOjXY.js";import{P as ht,F as ft}from"./printer-DUE-9mgo.js";import{S as vt}from"./share-2-ChnnJxx4.js";import{X as Ye}from"./x-C2dkvfPv.js";import{a as Ze,S as gt,u as de,s as bt,i as ge,b as xt,c as yt,d as jt,e as wt,f as Pt,g as Xe,h as Nt,j as De,k as Et,l as ue,m as Z,n as Qe,o as At,p as St,r as et,q as tt,R as Ot,t as kt,G as Ct,v as at,w as Rt,L as Q,x as _t,y as Tt,J as Dt,z as Lt,A as Le,B as le,C as be,P as $t,D as It,E as Ft,F as Mt,H as Bt,I as zt,K as te,M as $e,N as qt,T as Ut,O as Gt,Q as he,U as fe,V as Kt,W as Ie,X as Fe,Y as Me,Z as Vt}from"./LineChart-Cbv7uDxU.js";import{s as Ht,P as Wt}from"./PolarChart-DF6jVe8N.js";import{S as Jt,C as Pe,u as Yt,a as Zt,b as Xt,c as Qt,B as ea,d as ta}from"./BarChart-DJHaEqv7.js";import{H as Be}from"./history-DGoO9OBv.js";import{S as aa}from"./settings-Bqthy2dX.js";import{P as ve}from"./plus-CzDwLm3J.js";import{F as ra}from"./funnel-DEzojbTG.js";import{U as sa}from"./user-BGYzkTxO.js";import{U as ia}from"./users-CLb1Ind1.js";import{C as na}from"./clipboard-list-CTXK46V-.js";import{F as xe}from"./file-text-76dwq0ip.js";import{S as oa}from"./star-2q-PLwty.js";import{E as la}from"./eye-BUHPnJub.js";import"./SidebarPremium-D7ISy0In.js";import"./index-Bqe-gmK6.js";import"./house-DSNk2C5T.js";import"./book-open-L6K6GApD.js";import"./graduation-cap-DGMUxzM9.js";import"./calendar-CAuJuRcm.js";import"./chart-column-Bg7XzELY.js";import"./message-circle-8Z2L2EEy.js";import"./index-BZWQ4euU.js";import"./chevron-right-f5dsdMUG.js";import"./index-Bce5oZaH.js";import"./index-CtoMVlCU.js";import"./index-CKE1C3tK.js";import"./index-qba7jVBc.js";import"./index-B7F4_iBu.js";import"./chevron-down-CSOkIGzc.js";import"./check-Ds-bvwXg.js";import"./chevron-up-D2dp2R44.js";import"./index-B-DTjqCv.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],da=we("chart-no-axes-column-increasing",ca);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],ma=we("file-image",ua);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],ha=we("git-compare",pa);function ye(){return ye=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},ye.apply(null,arguments)}function ze(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function fa(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?ze(Object(a),!0).forEach(function(r){Ne(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ze(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ne(t,e,a){return(e=va(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function va(t){var e=ga(t,"string");return typeof e=="symbol"?e:e+""}function ga(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var L=32;class Ee extends o.PureComponent{renderIcon(e,a){var{inactiveColor:r}=this.props,i=L/2,n=L/6,u=L/3,c=e.inactive?r:e.color,p=a??e.type;if(p==="none")return null;if(p==="plainline")return o.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:e.payload.strokeDasharray,x1:0,y1:i,x2:L,y2:i,className:"recharts-legend-icon"});if(p==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(i,"h").concat(u,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(2*u,",").concat(i,`
            H`).concat(L,"M").concat(2*u,",").concat(i,`
            A`).concat(n,",").concat(n,",0,1,1,").concat(u,",").concat(i),className:"recharts-legend-icon"});if(p==="rect")return o.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(L/8,"h").concat(L,"v").concat(L*3/4,"h").concat(-L,"z"),className:"recharts-legend-icon"});if(o.isValidElement(e.legendIcon)){var f=fa({},e);return delete f.legendIcon,o.cloneElement(e.legendIcon,f)}return o.createElement(Jt,{fill:c,cx:i,cy:i,size:L,sizeType:"diameter",type:p})}renderItems(){var{payload:e,iconSize:a,layout:r,formatter:i,inactiveColor:n,iconType:u}=this.props,c={x:0,y:0,width:L,height:L},p={display:r==="horizontal"?"inline-block":"block",marginRight:10},f={display:"inline-block",verticalAlign:"middle",marginRight:4};return e.map((m,g)=>{var d=m.formatter||i,h=ce({"recharts-legend-item":!0,["legend-item-".concat(g)]:!0,inactive:m.inactive});if(m.type==="none")return null;var v=m.inactive?n:m.color,j=d?d(m.value,m,g):m.value;return o.createElement("li",ye({className:h,style:p,key:"legend-item-".concat(g)},Ze(this.props,m,g)),o.createElement(gt,{width:a,height:a,viewBox:c,style:f,"aria-label":"".concat(j," legend icon")},this.renderIcon(m,u)),o.createElement("span",{className:"recharts-legend-item-text",style:{color:v}},j))})}render(){var{payload:e,layout:a,align:r}=this.props;if(!e||!e.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?r:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}Ne(Ee,"displayName","Legend");Ne(Ee,"defaultProps",{align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"});function ba(){return de(bt)}var xa=["contextPayload"];function je(){return je=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},je.apply(null,arguments)}function qe(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function ee(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?qe(Object(a),!0).forEach(function(r){Ae(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):qe(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ae(t,e,a){return(e=ya(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function ya(t){var e=ja(t,"string");return typeof e=="symbol"?e:e+""}function ja(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function wa(t,e){if(t==null)return{};var a,r,i=Pa(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function Pa(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function Na(t){return t.value}function Ea(t){var{contextPayload:e}=t,a=wa(t,xa),r=Et(e,t.payloadUniqBy,Na),i=ee(ee({},a),{},{payload:r});return o.isValidElement(t.content)?o.cloneElement(t.content,i):typeof t.content=="function"?o.createElement(t.content,i):o.createElement(Ee,i)}function Aa(t,e,a,r,i,n){var{layout:u,align:c,verticalAlign:p}=e,f,m;return(!t||(t.left===void 0||t.left===null)&&(t.right===void 0||t.right===null))&&(c==="center"&&u==="vertical"?f={left:((r||0)-n.width)/2}:f=c==="right"?{right:a&&a.right||0}:{left:a&&a.left||0}),(!t||(t.top===void 0||t.top===null)&&(t.bottom===void 0||t.bottom===null))&&(p==="middle"?m={top:((i||0)-n.height)/2}:m=p==="bottom"?{bottom:a&&a.bottom||0}:{top:a&&a.top||0}),ee(ee({},f),m)}function Sa(t){var e=Xe();return o.useEffect(()=>{e(Nt(t))},[e,t]),null}function Oa(t){var e=Xe();return o.useEffect(()=>(e(De(t)),()=>{e(De({width:0,height:0}))}),[e,t]),null}function ka(t){var e=ba(),a=xt(),r=yt(),{width:i,height:n,wrapperStyle:u,portal:c}=t,[p,f]=jt([e]),m=wt(),g=Pt();if(m==null||g==null)return null;var d=m-(r.left||0)-(r.right||0),h=X.getWidthOrHeight(t.layout,n,i,d),v=c?u:ee(ee({position:"absolute",width:h?.width||i||"auto",height:h?.height||n||"auto"},Aa(u,t,r,m,g,p)),u),j=c??a;if(j==null)return null;var S=o.createElement("div",{className:"recharts-legend-wrapper",style:v,ref:f},o.createElement(Sa,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),o.createElement(Oa,{width:p.width,height:p.height}),o.createElement(Ea,je({},t,h,{margin:r,chartWidth:m,chartHeight:g,contextPayload:e})));return ot.createPortal(S,j)}class X extends o.PureComponent{static getWidthOrHeight(e,a,r,i){return e==="vertical"&&ge(a)?{height:a}:e==="horizontal"?{width:r||i}:null}render(){return o.createElement(ka,this.props)}}Ae(X,"displayName","Legend");Ae(X,"defaultProps",{align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"});function Ue(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function Ge(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Ue(Object(a),!0).forEach(function(r){Ca(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ue(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ca(t,e,a){return(e=Ra(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Ra(t){var e=_a(t,"string");return typeof e=="symbol"?e:e+""}function _a(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Ta=(t,e)=>e,Se=ue([Ht,Ta],(t,e)=>t.filter(a=>a.type==="pie").find(a=>a.id===e)),Da=[],Oe=(t,e,a)=>a?.length===0?Da:a,rt=ue([St,Se,Oe],(t,e,a)=>{var{chartData:r}=t;if(e!=null){var i;if(e?.data!=null&&e.data.length>0?i=e.data:i=r,(!i||!i.length)&&a!=null&&(i=a.map(n=>Ge(Ge({},e.presentationProps),n.props))),i!=null)return i}}),La=ue([rt,Se,Oe],(t,e,a)=>{if(!(t==null||e==null))return t.map((r,i)=>{var n,u=Z(r,e.nameKey,e.name),c;return a!=null&&(n=a[i])!==null&&n!==void 0&&(n=n.props)!==null&&n!==void 0&&n.fill?c=a[i].props.fill:typeof r=="object"&&r!=null&&"fill"in r?c=r.fill:c=e.fill,{value:Qe(u,e.dataKey),color:c,payload:r,type:e.legendType}})}),$a=ue([rt,Se,Oe,At],(t,e,a,r)=>{if(!(e==null||t==null))return ar({offset:r,pieSettings:e,displayedData:t,cells:a})}),Ia=["onMouseEnter","onClick","onMouseLeave"],Fa=["id"],Ma=["id"];function ke(t,e){if(t==null)return{};var a,r,i=Ba(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)a=n[r],e.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}function Ba(t,e){if(t==null)return{};var a={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;a[r]=t[r]}return a}function Ke(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,r)}return a}function P(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?Ke(Object(a),!0).forEach(function(r){za(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ke(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function za(t,e,a){return(e=qa(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function qa(t){var e=Ua(t,"string");return typeof e=="symbol"?e:e+""}function Ua(t,e){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function V(){return V=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},V.apply(null,arguments)}function Ga(t){var e=o.useMemo(()=>at(t.children,Pe),[t.children]),a=de(r=>La(r,t.id,e));return a==null?null:o.createElement(Rt,{legendPayload:a})}function Ka(t){var{dataKey:e,nameKey:a,sectors:r,stroke:i,strokeWidth:n,fill:u,name:c,hide:p,tooltipType:f}=t;return{dataDefinedOnItem:r.map(m=>m.tooltipPayload),positions:r.map(m=>m.tooltipPosition),settings:{stroke:i,strokeWidth:n,fill:u,dataKey:e,nameKey:a,name:Qe(c,e),hide:p,type:f,color:u,unit:""}}}var Va=(t,e)=>t>e?"start":t<e?"end":"middle",Ha=(t,e,a)=>typeof e=="function"?te(e(t),a,a*.8):te(e,a,a*.8),Wa=(t,e,a)=>{var{top:r,left:i,width:n,height:u}=e,c=zt(n,u),p=i+te(t.cx,n,n/2),f=r+te(t.cy,u,u/2),m=te(t.innerRadius,c,0),g=Ha(a,t.outerRadius,c),d=t.maxRadius||Math.sqrt(n*n+u*u)/2;return{cx:p,cy:f,innerRadius:m,outerRadius:g,maxRadius:d}},Ja=(t,e)=>{var a=le(e-t),r=Math.min(Math.abs(e-t),360);return a*r};function Ya(t){return t&&typeof t=="object"&&"className"in t&&typeof t.className=="string"?t.className:""}var Za=(t,e)=>{if(o.isValidElement(t))return o.cloneElement(t,e);if(typeof t=="function")return t(e);var a=ce("recharts-pie-label-line",typeof t!="boolean"?t.className:"");return o.createElement(qt,V({},e,{type:"linear",className:a}))},Xa=(t,e,a)=>{if(o.isValidElement(t))return o.cloneElement(t,e);var r=a;if(typeof t=="function"&&(r=t(e),o.isValidElement(r)))return r;var i=ce("recharts-pie-label-text",Ya(t));return o.createElement(Ut,V({},e,{alignmentBaseline:"middle",className:i}),r)};function Qa(t){var{sectors:e,props:a,showLabels:r}=t,{label:i,labelLine:n,dataKey:u}=a;if(!r||!i||!e)return null;var c=tt(a),p=$e(i),f=$e(n),m=typeof i=="object"&&"offsetRadius"in i&&typeof i.offsetRadius=="number"&&i.offsetRadius||20,g=e.map((d,h)=>{var v=(d.startAngle+d.endAngle)/2,j=be(d.cx,d.cy,d.outerRadius+m,v),S=P(P(P(P({},c),d),{},{stroke:"none"},p),{},{index:h,textAnchor:Va(j.x,d.cx)},j),F=P(P(P(P({},c),d),{},{fill:"none",stroke:d.fill},f),{},{index:h,points:[be(d.cx,d.cy,d.outerRadius,v),j],key:"line"});return o.createElement(Q,{key:"label-".concat(d.startAngle,"-").concat(d.endAngle,"-").concat(d.midAngle,"-").concat(h)},n&&Za(n,F),Xa(i,S,Z(d,u)))});return o.createElement(Q,{className:"recharts-pie-labels"},g)}function er(t){var{sectors:e,props:a,showLabels:r}=t,{label:i}=a;return typeof i=="object"&&i!=null&&"position"in i?o.createElement(Bt,{label:i}):o.createElement(Qa,{sectors:e,props:a,showLabels:r})}function tr(t){var{sectors:e,activeShape:a,inactiveShape:r,allOtherPieProps:i}=t,n=de(It),{onMouseEnter:u,onClick:c,onMouseLeave:p}=i,f=ke(i,Ia),m=Yt(u,i.dataKey),g=Zt(p),d=Xt(c,i.dataKey);return e==null||e.length===0?null:o.createElement(o.Fragment,null,e.map((h,v)=>{if(h?.startAngle===0&&h?.endAngle===0&&e.length!==1)return null;var j=a&&String(v)===n,S=n?r:null,F=j?a:S,C=P(P({},h),{},{stroke:h.stroke,tabIndex:-1,[Mt]:v,[Ft]:i.dataKey});return o.createElement(Q,V({key:"sector-".concat(h?.startAngle,"-").concat(h?.endAngle,"-").concat(h.midAngle,"-").concat(v),tabIndex:-1,className:"recharts-pie-sector"},Ze(f,h,v),{onMouseEnter:m(h,v),onMouseLeave:g(h,v),onClick:d(h,v)}),o.createElement(Qt,V({option:F,isActive:j,shapeType:"sector"},C)))}))}function ar(t){var e,{pieSettings:a,displayedData:r,cells:i,offset:n}=t,{cornerRadius:u,startAngle:c,endAngle:p,dataKey:f,nameKey:m,tooltipType:g}=a,d=Math.abs(a.minAngle),h=Ja(c,p),v=Math.abs(h),j=r.length<=1?0:(e=a.paddingAngle)!==null&&e!==void 0?e:0,S=r.filter(E=>Z(E,f,0)!==0).length,F=(v>=360?S:S-1)*j,C=v-S*d-F,_=r.reduce((E,D)=>{var b=Z(D,f,0);return E+(ge(b)?b:0)},0),z;if(_>0){var T;z=r.map((E,D)=>{var b=Z(E,f,0),M=Z(E,m,D),K=Wa(a,n,E),q=(ge(b)?b:0)/_,U,H=P(P({},E),i&&i[D]&&i[D].props);D?U=T.endAngle+le(h)*j*(b!==0?1:0):U=c;var J=U+le(h)*((b!==0?d:0)+q*C),W=(U+J)/2,ae=(K.innerRadius+K.outerRadius)/2,me=[{name:M,value:b,payload:H,dataKey:f,type:g}],pe=be(K.cx,K.cy,ae,W);return T=P(P(P(P({},a.presentationProps),{},{percent:q,cornerRadius:u,name:M,tooltipPayload:me,midAngle:W,middleRadius:ae,tooltipPosition:pe},H),K),{},{value:b,startAngle:U,endAngle:J,payload:H,paddingAngle:le(h)*j}),T})}return z}function rr(t){var{showLabels:e,sectors:a,children:r}=t,i=o.useMemo(()=>!e||!a?[]:a.map(n=>({value:n.value,payload:n.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:n.cx,cy:n.cy,innerRadius:n.innerRadius,outerRadius:n.outerRadius,startAngle:n.startAngle,endAngle:n.endAngle,clockWise:!1},fill:n.fill})),[a,e]);return o.createElement($t,{value:e?i:void 0},r)}function sr(t){var{props:e,previousSectorsRef:a}=t,{sectors:r,isAnimationActive:i,animationBegin:n,animationDuration:u,animationEasing:c,activeShape:p,inactiveShape:f,onAnimationStart:m,onAnimationEnd:g}=e,d=Tt(e,"recharts-pie-"),h=a.current,[v,j]=o.useState(!1),S=o.useCallback(()=>{typeof g=="function"&&g(),j(!1)},[g]),F=o.useCallback(()=>{typeof m=="function"&&m(),j(!0)},[m]);return o.createElement(rr,{showLabels:!v,sectors:r},o.createElement(Dt,{animationId:d,begin:n,duration:u,isActive:i,easing:c,onAnimationStart:F,onAnimationEnd:S,key:d},C=>{var _=[],z=r&&r[0],T=z?.startAngle;return r?.forEach((E,D)=>{var b=h&&h[D],M=D>0?Lt(E,"paddingAngle",0):0;if(b){var K=Le(b.endAngle-b.startAngle,E.endAngle-E.startAngle,C),q=P(P({},E),{},{startAngle:T+M,endAngle:T+K+M});_.push(q),T=q.endAngle}else{var{endAngle:U,startAngle:H}=E,J=Le(0,U-H,C),W=P(P({},E),{},{startAngle:T+M,endAngle:T+J+M});_.push(W),T=W.endAngle}}),a.current=_,o.createElement(Q,null,o.createElement(tr,{sectors:_,activeShape:p,inactiveShape:f,allOtherPieProps:e}))}),o.createElement(er,{showLabels:!v,sectors:r,props:e}),e.children)}var ir={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!Ct.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff"};function nr(t){var{id:e}=t,a=ke(t,Fa),{hide:r,className:i,rootTabIndex:n}=t,u=o.useMemo(()=>at(t.children,Pe),[t.children]),c=de(m=>$a(m,e,u)),p=o.useRef(null),f=ce("recharts-pie",i);return r||c==null?(p.current=null,o.createElement(Q,{tabIndex:n,className:f})):o.createElement(o.Fragment,null,o.createElement(_t,{fn:Ka,args:P(P({},t),{},{sectors:c})}),o.createElement(Q,{tabIndex:n,className:f},o.createElement(sr,{props:P(P({},a),{},{sectors:c}),previousSectorsRef:p})))}function st(t){var e=et(t,ir),{id:a}=e,r=ke(e,Ma),i=tt(r);return o.createElement(Ot,{id:a,type:"pie"},n=>o.createElement(o.Fragment,null,o.createElement(kt,{type:"pie",id:n,data:r.data,dataKey:r.dataKey,hide:r.hide,angleAxisId:0,radiusAxisId:0,name:r.name,nameKey:r.nameKey,tooltipType:r.tooltipType,legendType:r.legendType,fill:r.fill,cx:r.cx,cy:r.cy,startAngle:r.startAngle,endAngle:r.endAngle,paddingAngle:r.paddingAngle,minAngle:r.minAngle,innerRadius:r.innerRadius,outerRadius:r.outerRadius,cornerRadius:r.cornerRadius,presentationProps:i,maxRadius:e.maxRadius}),o.createElement(Ga,V({},r,{id:n})),o.createElement(nr,V({},r,{id:n}))))}st.displayName="Pie";var or=["item"],lr={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},cr=o.forwardRef((t,e)=>{var a=et(t,lr);return o.createElement(Wt,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:or,tooltipPayloadSearcher:Gt,categoricalChartProps:a,ref:e})});class dr{async generateStudentReport(e,a=30){const r=new Date;r.setDate(r.getDate()-a);const{data:i}=await N.from("profiles").select("full_name, email").eq("id",e).single(),{data:n}=await N.from("class_members").select("class:classes(id, name, subject)").eq("user_id",e).eq("role","student"),{data:u}=await N.from("submissions").select(`
        grade,
        submitted_at,
        activity:activities(title, max_score, type)
      `).eq("student_id",e).gte("submitted_at",r.toISOString()).not("grade","is",null),c=u?.map(d=>d.grade)||[],p=c.length>0?c.reduce((d,h)=>d+h,0)/c.length:0,f=c.length>0?Math.max(...c):0,m=c.length>0?Math.min(...c):0,g=u?.map(d=>({name:d.activity.title.substring(0,20),value:d.grade}))||[];return{title:`Relat√≥rio de Desempenho - ${i?.full_name||"Aluno"}`,templateName:"Desempenho Individual (Aluno)",generatedAt:new Date().toISOString(),studentId:e,summary:{totalActivities:u?.length||0,avgGrade:p.toFixed(1),maxGrade:f.toFixed(1),minGrade:m.toFixed(1),totalClasses:n?.length||0},charts:[{title:"Notas por Atividade",type:"bar",data:g},{title:"Evolu√ß√£o do Desempenho",type:"line",data:g}],tables:[{title:"Turmas Inscritas",headers:["Nome","Mat√©ria"],rows:n?.map(d=>[d.class.name,d.class.subject||"-"])||[]}],details:`Relat√≥rio gerado para o per√≠odo de ${a} dias. Total de ${u?.length||0} atividades avaliadas.`}}async generateClassReport(e,a=30){const{data:r}=await N.from("classes").select("name, subject, created_by").eq("id",e).single(),{data:i}=await N.from("class_members").select("user_id, profiles:user_id(full_name)").eq("class_id",e).eq("role","student"),{data:n}=await N.from("activity_class_assignments").select("activity_id, activity:activities(id, title)").eq("class_id",e),u=n?.map(d=>d.activity_id)||[],{data:c}=await N.from("submissions").select("grade, student_id, activity_id").in("activity_id",u).not("grade","is",null),p=c?.map(d=>d.grade)||[],f=p.length>0?p.reduce((d,h)=>d+h,0)/p.length:0,m={"Excelente (90-100)":0,"Bom (70-89)":0,"Regular (50-69)":0,"Insuficiente (0-49)":0};p.forEach(d=>{d>=90?m["Excelente (90-100)"]++:d>=70?m["Bom (70-89)"]++:d>=50?m["Regular (50-69)"]++:m["Insuficiente (0-49)"]++});const g=Object.entries(m).map(([d,h])=>({name:d,value:h}));return{title:`Relat√≥rio de Turma - ${r?.name||"Turma"}`,templateName:"Relat√≥rio de Turma",generatedAt:new Date().toISOString(),classId:e,summary:{totalStudents:i?.length||0,totalActivities:n?.length||0,avgGrade:f.toFixed(1),submissionsCount:c?.length||0},charts:[{title:"Distribui√ß√£o de Notas",type:"pie",data:g}],tables:[{title:"Lista de Alunos",headers:["Nome","Submiss√µes"],rows:i?.map(d=>{const h=c?.filter(v=>v.student_id===d.user_id).length||0;return[d.profiles.full_name,h]})||[]}],details:`Turma: ${r?.name}
Mat√©ria: ${r?.subject||"N√£o especificada"}
Per√≠odo: √∫ltimos ${a} dias`}}async generateComparativeReport(e){const{data:a}=await N.from("classes").select("id, name, subject").eq("created_by",e).eq("is_active",!0);a?.map(i=>i.id);const r=await Promise.all(a?.map(async i=>{const{data:n}=await N.from("activity_class_assignments").select("activity_id").eq("class_id",i.id),u=n?.map(m=>m.activity_id)||[],{data:c}=await N.from("submissions").select("grade").in("activity_id",u).not("grade","is",null),p=c?.map(m=>m.grade)||[],f=p.length>0?p.reduce((m,g)=>m+g,0)/p.length:0;return{name:i.name,value:f}})||[]);return{title:"Relat√≥rio Comparativo de Turmas",templateName:"Comparativo de Desempenho",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,avgGrade:(r.reduce((i,n)=>i+n.value,0)/(r.length||1)).toFixed(1)},charts:[{title:"M√©dia por Turma",type:"bar",data:r}],tables:[{title:"Detalhamento por Turma",headers:["Turma","Mat√©ria","M√©dia"],rows:a?.map((i,n)=>[i.name,i.subject||"-",r[n]?.value.toFixed(1)||"0"])||[]}]}}async generateTeacherReport(e){const{data:a}=await N.from("classes").select("id").eq("created_by",e).eq("is_active",!0),{count:r}=await N.from("class_members").select("id",{count:"exact",head:!0}).in("class_id",a?.map(p=>p.id)||[]).eq("role","student"),{data:i}=await N.from("activities").select("id").eq("created_by",e),{data:n}=await N.from("submissions").select("grade").in("activity_id",i?.map(p=>p.id)||[]).not("grade","is",null),u=n?.map(p=>p.grade)||[],c=u.length>0?u.reduce((p,f)=>p+f,0)/u.length:0;return{title:"Relat√≥rio de Desempenho do Professor",templateName:"Desempenho (Professor)",generatedAt:new Date().toISOString(),teacherId:e,summary:{totalClasses:a?.length||0,totalStudents:r||0,totalActivities:i?.length||0,avgGrade:c.toFixed(1)},details:"Relat√≥rio consolidado de todas as turmas e atividades criadas."}}async generateReport(e,a,r={}){switch(e){case"individual-student":return await this.generateStudentReport(a,r.period);case"class-report":return await this.generateClassReport(a,r.period);case"comparative":return await this.generateComparativeReport(a);case"teacher-performance":return await this.generateTeacherReport(a);case"activity-report":return{title:"Relat√≥rio de Atividade",templateName:"Relat√≥rio de Atividade",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};case"bulletin":return{title:"Boletim Geral",templateName:"Boletim Geral",generatedAt:new Date().toISOString(),summary:{},details:"Em desenvolvimento"};default:throw new Error("Template de relat√≥rio n√£o encontrado")}}}const ur=new dr,Ve=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],mr=({report:t,onClose:e})=>{const{toast:a}=Je();if(!t)return null;const r=(i,n)=>{const u=(c,p=16)=>c?.length>p?c.slice(0,p)+"‚Ä¶":c;switch(i){case"bar":return s.jsx(he,{width:"100%",height:300,children:s.jsxs(ea,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Ie,{strokeDasharray:"3 3"}),s.jsx(Fe,{dataKey:"name",tickFormatter:c=>u(c),interval:"preserveEnd"}),s.jsx(Me,{}),s.jsx(fe,{}),s.jsx(X,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(ta,{dataKey:"value",fill:"#3B82F6"})]})});case"line":return s.jsx(he,{width:"100%",height:300,children:s.jsxs(Kt,{data:n,margin:{top:8,right:16,bottom:32,left:8},children:[s.jsx(Ie,{strokeDasharray:"3 3"}),s.jsx(Fe,{dataKey:"name",tickFormatter:c=>u(c),interval:"preserveEnd"}),s.jsx(Me,{}),s.jsx(fe,{}),s.jsx(X,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}}),s.jsx(Vt,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2})]})});case"pie":return s.jsx(he,{width:"100%",height:300,children:s.jsxs(cr,{children:[s.jsx(st,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:c=>`${u(c.name)}: ${c.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((c,p)=>s.jsx(Pe,{fill:Ve[p%Ve.length]},`cell-${p}`))}),s.jsx(fe,{}),s.jsx(X,{layout:"horizontal",verticalAlign:"bottom",wrapperStyle:{paddingTop:8}})]})});default:return null}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 overflow-auto",children:s.jsxs(G,{className:"w-full max-w-6xl max-h-[90vh] overflow-auto bg-white dark:bg-slate-900",children:[s.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between z-10",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t.title||t.templateName}),s.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Gerado em ",new Date(t.generatedAt).toLocaleString("pt-BR")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{try{if(t.tables&&t.tables.length>0){const p=t.tables[0],m=[(p.headers||[]).join(",")];(p.rows||[]).forEach(S=>{const F=S.map(C=>{const _=typeof C=="object"?JSON.stringify(C):String(C??"");return/[",\n]/.test(_)?'"'+_.replace(/"/g,'""')+'"':_}).join(",");m.push(F)});const g=m.join(`
`),d=new Blob([g],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(d),v=document.createElement("a"),j=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");v.href=h,v.download=`${j}-${Date.now()}.csv`,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(h),a({title:"Exportado (CSV)",description:"Arquivo CSV baixado com sucesso."});return}const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),u=document.createElement("a"),c=(t.title||t.templateName||"relatorio").toLowerCase().replace(/\s+/g,"-");u.href=n,u.download=`${c}-${Date.now()}.json`,document.body.appendChild(u),u.click(),u.remove(),URL.revokeObjectURL(n),a({title:"Exportado (JSON)",description:"Arquivo JSON baixado com sucesso."})}catch{a({variant:"destructive",title:"Falha na exporta√ß√£o",description:"Tente novamente."})}},children:[s.jsx(pt,{className:"w-4 h-4 mr-2"}),"Exportar"]}),s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{try{window.print()}catch{a({variant:"destructive",title:"Falha ao imprimir",description:"Tente novamente."})}},children:[s.jsx(ht,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),s.jsxs(R,{variant:"outline",size:"sm",onClick:async()=>{try{const i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),u=t.title||t.templateName||"Relat√≥rio";navigator.share?await navigator.share({title:u,text:u,url:n}):(await navigator.clipboard.writeText(n),a({title:"Link copiado",description:"Link do relat√≥rio copiado para a √°rea de transfer√™ncia."}))}catch{a({variant:"destructive",title:"Falha ao compartilhar",description:"Tente novamente."})}},children:[s.jsx(vt,{className:"w-4 h-4 mr-2"}),"Compartilhar"]}),s.jsx(R,{variant:"ghost",size:"sm",onClick:e,children:s.jsx(Ye,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[t.summary&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(t.summary).map(([i,n])=>s.jsxs(G,{className:"p-4",children:[s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 capitalize",children:i.replace(/([A-Z])/g," $1").trim()}),s.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white mt-1",children:typeof n=="number"?n.toFixed(1):n})]},i))}),t.charts&&t.charts.map((i,n)=>s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),r(i.type,i.data)]},n)),t.tables&&t.tables.map((i,n)=>s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:i.title}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsx("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:i.headers.map((u,c)=>s.jsx("th",{className:"text-left p-2 font-semibold",children:u},c))})}),s.jsx("tbody",{children:i.rows.map((u,c)=>s.jsx("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:u.map((p,f)=>s.jsx("td",{className:"p-2",children:p},f))},c))})]})})]},n)),t.details&&s.jsxs(G,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detalhes"}),s.jsx("div",{className:"prose dark:prose-invert max-w-none",children:t.details})]})]})]})})};class pr{constructor(){this.enabled=!1,this.url="https://comic-mudfish-15106.upstash.io",this.token="ATsCAAIncDIxMzViNjFkMDQ0Zjk0NGU3YTljYjlhNTM2YTRhZDM1NXAyMTUxMDY",this.url&&this.token?(this.enabled=!0,console.log("[Cache] ‚úÖ Upstash Redis configurado")):(console.warn("[Cache] ‚ö†Ô∏è  Upstash Redis n√£o configurado - cache desabilitado"),console.warn("[Cache] Configure VITE_UPSTASH_REDIS_REST_URL e VITE_UPSTASH_REDIS_REST_TOKEN"))}async get(e){if(!this.enabled)return null;try{const a=await fetch(`${this.url}/get/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(r.result===null)return console.log(`[Cache] ‚ùå Miss: ${e}`),null;console.log(`[Cache] ‚úÖ Hit: ${e}`);try{return JSON.parse(r.result)}catch{return r.result}}catch(a){return console.error(`[Cache] Erro ao buscar ${e}:`,a),null}}async set(e,a,r=300){if(!this.enabled)return!1;try{const i=typeof a=="string"?a:JSON.stringify(a),n=await fetch(`${this.url}/set/${encodeURIComponent(e)}/${encodeURIComponent(i)}?EX=${r}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return console.log(`[Cache] üíæ Saved: ${e} (TTL: ${r}s)`),!0}catch(i){return console.error(`[Cache] Erro ao salvar ${e}:`,i),!1}}async del(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/del/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return console.log(`[Cache] üóëÔ∏è  Deleted: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao deletar ${e}:`,a),!1}}async invalidatePattern(e){if(!this.enabled)return!1;try{const a=await fetch(`${this.url}/keys/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${this.token}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=(await a.json()).result||[];if(i.length===0)return console.log(`[Cache] üîç No keys found for pattern: ${e}`),!0;const n=i.map(u=>this.del(u));return await Promise.all(n),console.log(`[Cache] üßπ Invalidated ${i.length} keys matching: ${e}`),!0}catch(a){return console.error(`[Cache] Erro ao invalidar padr√£o ${e}:`,a),!1}}async remember(e,a,r=300){const i=await this.get(e);if(i!==null)return i;const n=await a();return await this.set(e,n,r),n}async flush(){if(!this.enabled)return!1;try{const e=await fetch(`${this.url}/flushdb`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return console.log("[Cache] üö® Cache completamente limpo (FLUSH)"),!0}catch(e){return console.error("[Cache] Erro ao limpar cache:",e),!1}}getStatus(){return{enabled:this.enabled,hasCredentials:!!(this.url&&this.token),url:this.url?this.url.replace(/https?:\/\//,"").split(".")[0]+"...":"n√£o configurado"}}}const He=new pr,We=[{id:"individual-student",name:"Relat√≥rio Individual de Aluno",description:"Relat√≥rio completo de um aluno espec√≠fico",icon:sa,color:"from-blue-500 to-cyan-500",includes:["Dados pessoais","Hist√≥rico de notas","Frequ√™ncia","Feedbacks recebidos","Gr√°ficos de evolu√ß√£o","An√°lise de desempenho"],usage:"Reuni√£o com pais, coordena√ß√£o",popular:!0},{id:"class-report",name:"Relat√≥rio de Turma",description:"An√°lise completa de uma turma",icon:ia,color:"from-purple-500 to-pink-500",includes:["Estat√≠sticas gerais","Distribui√ß√£o de notas","Taxa de aprova√ß√£o/reprova√ß√£o","M√©dia da turma","Alunos em destaque","√Åreas de aten√ß√£o"],usage:"Fechamento de semestre, relat√≥rios institucionais",popular:!0},{id:"comparative",name:"Relat√≥rio Comparativo",description:"Compara√ß√£o entre m√∫ltiplas turmas",icon:ha,color:"from-orange-500 to-red-500",includes:["Tabela comparativa","Gr√°ficos lado a lado","An√°lise de diferen√ßas","Melhores pr√°ticas identificadas"],usage:"An√°lise pedag√≥gica, ajustes metodol√≥gicos"},{id:"activity-report",name:"Relat√≥rio de Atividade",description:"An√°lise de uma atividade espec√≠fica",icon:na,color:"from-green-500 to-teal-500",includes:["Estat√≠sticas de submiss√£o","Distribui√ß√£o de notas","Quest√µes mais erradas","Tempo m√©dio de resolu√ß√£o","Lista de notas por aluno"],usage:"Valida√ß√£o de atividade, ajustes"},{id:"bulletin",name:"Boletim (Per√≠odo)",description:"Boletim formal por per√≠odo",icon:xe,color:"from-indigo-500 to-purple-500",includes:["Notas por disciplina","M√©dias parciais e finais","Frequ√™ncia","Observa√ß√µes do professor","Assinatura"],usage:"Entrega oficial para institui√ß√£o/pais",popular:!0},{id:"teacher-performance",name:"Relat√≥rio de Desempenho (Professor)",description:"Auto-avalia√ß√£o do professor",icon:da,color:"from-yellow-500 to-orange-500",includes:["Atividades postadas","Corre√ß√µes realizadas","Tempo m√©dio de feedback","Satisfa√ß√£o dos alunos","Evolu√ß√£o das turmas"],usage:"Avalia√ß√£o institucional, portf√≥lio"}],os=()=>{const{user:t}=lt(),{toast:e}=Je(),[a,r]=o.useState(!1),[i,n]=o.useState("templates"),[u,c]=o.useState([]),[p,f]=o.useState(!1),[m,g]=o.useState(null),[d,h]=o.useState(null),[v,j]=o.useState(null),[S,F]=o.useState(null),[C,_]=o.useState("30"),[z,T]=o.useState([]),[E,D]=o.useState([]),[b,M]=o.useState(""),[K,q]=o.useState(!1);o.useEffect(()=>{U(),H()},[t]);const U=async()=>{if(t)try{const{data:l,error:x}=await N.from("report_history").select(`
          id,
          template_id,
          template_name,
          filter_type,
          student_id,
          class_id,
          activity_id,
          period,
          created_at,
          report_data
        `).eq("teacher_id",t.id).order("created_at",{ascending:!1}).limit(20);if(x)throw x;c(l||[]),console.log(`‚úÖ [Reports] ${l?.length||0} relat√≥rios carregados do hist√≥rico`)}catch(l){I.error("Erro ao carregar hist√≥rico:",l),c([])}},H=async()=>{if(t)try{q(!0);const l=`teacher:reports:data:${t.id}:${C}`,x=await He.get(l);if(x){console.log("‚úÖ [Reports] Dados carregados do cache"),D(x.classes||[]),T(x.students||[]),q(!1);return}console.log("üîÑ [Reports] Buscando dados do banco...");const{data:A,error:k}=await N.from("classes").select("id, name, subject").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(k)throw k;D(A||[]);const{data:y,error:w}=await N.from("class_members").select(`
          user_id,
          profile:profiles!class_members_user_id_fkey(id, full_name, email),
          class:classes!class_members_class_id_fkey(id, name)
        `).in("class_id",A?.map($=>$.id)||[]).eq("role","student");if(w)throw w;const O=[],Y=new Set;y?.forEach($=>{$.profile&&!Y.has($.profile.id)&&(Y.add($.profile.id),O.push({id:$.profile.id,name:$.profile.full_name,email:$.profile.email,className:$.class?.name}))}),T(O),await He.set(l,{classes:A||[],students:O},300),console.log("üíæ [Reports] Dados salvos no cache (TTL: 5min)")}catch(l){I.error("Erro ao carregar dados:",l),e({title:"Erro ao carregar dados",description:l.message,variant:"destructive"})}finally{q(!1)}},J=l=>l==="comparative"?!1:!!(b==="student"&&["class-report"].includes(l)||b==="class"&&["individual-student"].includes(l)||S&&l!=="activity-report"),W=async l=>{if(l!=="comparative"){if(!b){e({title:"Selecione o escopo do relat√≥rio",description:"Escolha se deseja gerar para um aluno, turma ou todos os alunos.",variant:"destructive"});return}if(b==="student"&&!d){e({title:"Selecione um aluno",description:"Escolha qual aluno voc√™ deseja incluir no relat√≥rio.",variant:"destructive"});return}if(b==="class"&&!v){e({title:"Selecione uma turma",description:"Escolha qual turma voc√™ deseja incluir no relat√≥rio.",variant:"destructive"});return}}f(!0),g(null);try{let x=t?.id;const A=We.find(y=>y.id===l);if(e({title:`üìä Gerando ${A?.name||"Relat√≥rio"}`,description:"Processando dados... Aguarde."}),b==="student"&&d)x=d;else if(b==="class"&&v)x=v;else if(l==="class-report")if(v)x=v;else{const{data:y}=await N.from("classes").select("id, is_active").eq("created_by",t.id).eq("is_active",!0).order("name",{ascending:!0});if(!y||y.length===0)throw new Error("Nenhuma turma ativa encontrada para gerar o relat√≥rio.");x=y[0].id}const k=await ur.generateReport(l,x,{period:parseInt(C),includeArchived:!1,filterType:b,studentId:d,classId:v,activityId:S});g(k),e({title:"‚úÖ Relat√≥rio Gerado",description:`${k.templateName} gerado com sucesso!`});try{const{error:y}=await N.from("report_history").insert({teacher_id:t.id,template_id:l,template_name:A?.name||"Relat√≥rio",filter_type:b||null,student_id:d||null,class_id:v||null,activity_id:S||null,period:parseInt(C),report_data:k});y?I.error("Erro ao salvar hist√≥rico:",y):console.log("‚úÖ Relat√≥rio salvo no hist√≥rico")}catch(y){I.error("Erro ao salvar hist√≥rico:",y)}c(y=>[{id:Date.now(),templateId:l,templateName:A?.name,generatedAt:new Date().toISOString(),cached:!1,filterType:b,studentId:d,classId:v},...y.slice(0,9)])}catch(x){I.error("Erro ao gerar relat√≥rio:",x),e({title:"Erro",description:x.message||"N√£o foi poss√≠vel gerar o relat√≥rio",variant:"destructive"})}finally{f(!1)}},ae=()=>{n("history")},me=()=>{e({title:"Em desenvolvimento",description:"Gerenciamento de templates ser√° implementado em breve"})},pe=l=>{if(!l)return null;if(Array.isArray(l))return l;if(Array.isArray(l?.rows))return l.rows;if(Array.isArray(l?.data))return l.data;if(Array.isArray(l?.items))return l.items;const x=Object.values(l).find(A=>Array.isArray(A));return Array.isArray(x)?x:[l]},it=l=>{if(!l||l.length===0)return"";const x=Array.from(l.reduce((w,O)=>(Object.keys(O||{}).forEach(Y=>w.add(Y)),w),new Set)),A=w=>{if(w==null)return"";const O=typeof w=="object"?JSON.stringify(w):String(w);return/[",\n]/.test(O)?'"'+O.replace(/"/g,'""')+'"':O},k=x.map(A).join(","),y=l.map(w=>x.map(O=>A(w?.[O])).join(","));return[k,...y].join(`
`)},Ce=(l,x,A)=>{const k=new Blob([l],{type:A}),y=URL.createObjectURL(k),w=document.createElement("a");w.href=y,w.download=x,document.body.appendChild(w),w.click(),w.remove(),URL.revokeObjectURL(y)},nt=()=>{if(!m){e({title:"Nenhum relat√≥rio para exportar",description:"Gere um relat√≥rio primeiro.",variant:"destructive"});return}try{const l=pe(m).map(k=>{const y={};return Object.entries(k||{}).forEach(([w,O])=>{O&&typeof O=="object"&&!Array.isArray(O)?Object.entries(O).forEach(([Y,$])=>{y[`${w}.${Y}`]=$}):y[w]=O}),y}),x=it(l);if(!x)throw new Error("N√£o h√° dados tabulares para exportar");const A=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ce(x,`${A}-${Date.now()}.csv`,"text/csv;charset=utf-8;"),e({title:"Exportado com sucesso",description:"Arquivo CSV baixado."})}catch(l){I.warn("CSV export fallback to JSON:",l);const x=(m?.templateName||"relatorio").toString().toLowerCase().replace(/\s+/g,"-");Ce(JSON.stringify(m,null,2),`${x}-${Date.now()}.json`,"application/json"),e({title:"Exportado como JSON",description:"N√£o foi poss√≠vel gerar CSV. Baixamos o JSON.",variant:"destructive"})}};return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[s.jsx(mt,{title:"Relat√≥rios",subtitle:"Gere relat√≥rios formais e export√°veis",role:"teacher",actions:s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(R,{variant:"outline",onClick:ae,children:[s.jsx(Be,{className:"w-4 h-4 mr-2"}),"Hist√≥rico"]}),s.jsxs(R,{variant:"outline",onClick:me,children:[s.jsx(aa,{className:"w-4 h-4 mr-2"}),"Templates"]}),s.jsxs(R,{onClick:()=>e({title:"Selecione um template abaixo"}),children:[s.jsx(ve,{className:"w-4 h-4 mr-2"}),"Novo Relat√≥rio"]})]})}),s.jsx(G,{className:"mt-6 p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:s.jsx(ra,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-900 dark:text-blue-100",children:"Selecione o Escopo do Relat√≥rio"}),s.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Escolha para quem deseja gerar o relat√≥rio antes de selecionar um template"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(re,{className:"text-sm font-medium mb-2 block",children:"Tipo de Relat√≥rio"}),s.jsxs(se,{value:b,onValueChange:M,children:[s.jsx(ie,{className:"bg-white dark:bg-slate-900",children:s.jsx(ne,{placeholder:"Selecione o tipo..."})}),s.jsxs(oe,{children:[s.jsx(B,{value:"student",children:"Aluno Espec√≠fico"}),s.jsx(B,{value:"class",children:"Turma Completa"}),s.jsx(B,{value:"all",children:"Todos os Alunos"})]})]})]}),b==="student"&&s.jsxs("div",{children:[s.jsx(re,{className:"text-sm font-medium mb-2 block",children:"Selecionar Aluno"}),s.jsxs(se,{value:d||"",onValueChange:h,children:[s.jsx(ie,{className:"bg-white dark:bg-slate-900",children:s.jsx(ne,{placeholder:"Escolha um aluno..."})}),s.jsx(oe,{children:z.map(l=>s.jsxs(B,{value:l.id,children:[l.name," ",l.className&&`(${l.className})`]},l.id))})]})]}),b==="class"&&s.jsxs("div",{children:[s.jsx(re,{className:"text-sm font-medium mb-2 block",children:"Selecionar Turma"}),s.jsxs(se,{value:v||"",onValueChange:j,children:[s.jsx(ie,{className:"bg-white dark:bg-slate-900",children:s.jsx(ne,{placeholder:"Escolha uma turma..."})}),s.jsx(oe,{children:E.map(l=>s.jsxs(B,{value:l.id,children:[l.name," ",l.subject&&`- ${l.subject}`]},l.id))})]})]}),s.jsxs("div",{children:[s.jsx(re,{className:"text-sm font-medium mb-2 block",children:"Per√≠odo"}),s.jsxs(se,{value:C,onValueChange:_,children:[s.jsx(ie,{className:"bg-white dark:bg-slate-900",children:s.jsx(ne,{})}),s.jsxs(oe,{children:[s.jsx(B,{value:"7",children:"√öltimos 7 dias"}),s.jsx(B,{value:"30",children:"√öltimos 30 dias"}),s.jsx(B,{value:"90",children:"√öltimos 90 dias"}),s.jsx(B,{value:"180",children:"√öltimos 6 meses"}),s.jsx(B,{value:"365",children:"√öltimo ano"})]})]})]})]}),b&&s.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[s.jsx("strong",{children:"Filtro ativo:"})," ",b==="student"?`Aluno - ${z.find(l=>l.id===d)?.name||"Selecione"}`:b==="class"?`Turma - ${E.find(l=>l.id===v)?.name||"Selecione"}`:"Todos os alunos"]}),s.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>{M(""),h(null),j(null)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[s.jsx(Ye,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]})]})}),s.jsxs(dt,{value:i,onValueChange:n,className:"mt-6",children:[s.jsxs(ut,{className:"grid w-full max-w-md grid-cols-2",children:[s.jsx(_e,{value:"templates",children:"Templates"}),s.jsx(_e,{value:"history",children:"Hist√≥rico"})]}),s.jsxs(Te,{value:"templates",className:"mt-6",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:We.map((l,x)=>{const A=l.icon,k=J(l.id);return s.jsx(ct.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},style:{pointerEvents:"auto"},children:s.jsxs(G,{className:`p-6 h-full flex flex-col hover:shadow-lg transition-shadow relative ${k?"opacity-50":""}`,style:{pointerEvents:"auto"},children:[s.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${l.color} opacity-5 group-hover:opacity-10 transition-opacity`}),l.popular&&s.jsxs(Re,{className:"absolute top-4 right-4 bg-yellow-500 text-white",children:[s.jsx(oa,{className:"w-3 h-3 mr-1"}),"Popular"]}),s.jsx("div",{className:"mb-4 relative z-10",children:s.jsx("div",{className:`inline-flex p-3 rounded-xl bg-gradient-to-r ${l.color}`,children:s.jsx(A,{className:"w-6 h-6 text-white"})})}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:l.name}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:l.description}),s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-2",children:"Inclui:"}),s.jsxs("ul",{className:"space-y-1",children:[l.includes.slice(0,3).map((y,w)=>s.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-center",children:[s.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mr-2"}),y]},w)),l.includes.length>3&&s.jsxs("li",{className:"text-xs text-blue-600 dark:text-blue-400",children:["+",l.includes.length-3," mais..."]})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx(Re,{variant:"outline",className:"text-xs",children:l.usage})}),s.jsxs("div",{className:"flex gap-2 mt-auto pt-4 relative z-50",children:[s.jsxs(R,{className:`flex-1 bg-gradient-to-r ${l.color} text-white hover:opacity-90`,onClick:()=>{if(k){e({title:"Template incompat√≠vel",description:"Este template n√£o √© compat√≠vel com os filtros selecionados.",variant:"destructive"});return}I.debug("Bot√£o Gerar clicado:",l.id),W(l.id)},disabled:k,children:[s.jsx(ve,{className:"w-4 h-4 mr-2"}),"Gerar"]}),s.jsx(R,{variant:"outline",size:"icon",onClick:()=>{I.debug("Bot√£o Preview clicado"),e({title:"Preview",description:"Visualiza√ß√£o ser√° implementada"})},children:s.jsx(la,{className:"w-4 h-4"})})]})]})},l.id)})}),s.jsxs(G,{className:"mt-8 p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Formatos de Exporta√ß√£o"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-red-50 hover:border-red-300 dark:hover:bg-red-950/20",onClick:()=>{I.debug("Exportar PDF clicado"),e({title:"Exportar PDF",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(xe,{className:"w-8 h-8 mb-2 text-red-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PDF"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-green-50 hover:border-green-300 dark:hover:bg-green-950/20",onClick:nt,children:[s.jsx(ft,{className:"w-8 h-8 mb-2 text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Excel"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-blue-50 hover:border-blue-300 dark:hover:bg-blue-950/20",onClick:()=>{I.debug("Exportar Word clicado"),e({title:"Exportar Word",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(xe,{className:"w-8 h-8 mb-2 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Word"})]}),s.jsxs(R,{variant:"outline",className:"h-24 flex flex-col items-center justify-center hover:bg-purple-50 hover:border-purple-300 dark:hover:bg-purple-950/20",onClick:()=>{I.debug("Exportar PNG clicado"),e({title:"Exportar PNG",description:"Funcionalidade em desenvolvimento"})},children:[s.jsx(ma,{className:"w-8 h-8 mb-2 text-purple-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PNG"})]})]})]})]}),s.jsx(Te,{value:"history",className:"mt-6",children:s.jsx(G,{className:"p-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx(Be,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:"Nenhum relat√≥rio gerado ainda"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Relat√≥rios que voc√™ gerar aparecer√£o aqui para f√°cil acesso"}),s.jsxs(R,{onClick:()=>n("templates"),children:[s.jsx(ve,{className:"w-4 h-4 mr-2"}),"Gerar Primeiro Relat√≥rio"]})]})})})]}),m&&s.jsx(mr,{report:m,onClose:()=>g(null)})]})};export{os as default};
