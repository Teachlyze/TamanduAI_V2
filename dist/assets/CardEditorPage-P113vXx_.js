import{c as A,h as G,b as J,u as Q,r as o,l as _,j as e,q as Y}from"./main-C5n3kzXQ.js";import{B as p}from"./button-CXfsJEZz.js";import{C as x}from"./card-CjtJprPz.js";import{T as F}from"./textarea-Dh8BS5CN.js";import{I as Z}from"./input-Bec_LEaF.js";import{L as d}from"./label-B7q1QW2O.js";import{B as I}from"./badge-DIjZdJB4.js";import{u as ee}from"./use-toast-BTst2Jag.js";import{D as ae}from"./DashboardHeader-Bi7WU8Vg.js";import"./dropdown-menu-CgW1-aRc.js";import{f as v}from"./flashcardService-BJsrFoTT.js";import{C as te}from"./ConfirmDialog-vvqBdJKJ.js";import{S as se}from"./SuccessDialog-Blge1hAg.js";import{A as re}from"./arrow-left-CPZhu65i.js";import{m as z}from"./proxy-C-9wZx5L.js";import{H as oe}from"./hash-CpuNIAlR.js";import{P as ie}from"./plus-ytK2DPwm.js";import{X as ce}from"./x-3ab3q3Ef.js";import{E as L}from"./eye-DehCU-UL.js";import{S as ne}from"./save-CqffQC98.js";import"./index-B6XryYCt.js";import"./index-C2-paRPo.js";import"./index-CJbM7HGD.js";import"./index-CsW3l1Gu.js";import"./Combination-Chdg_-Wh.js";import"./SidebarPremium-D25G1dNT.js";import"./house-ZJXziqlE.js";import"./users-Boys-rM5.js";import"./book-open-BP8V__Hw.js";import"./file-text-0s37oUXW.js";import"./graduation-cap-DHgx-smk.js";import"./calendar-BkZi9bLz.js";import"./chart-column-5ubExldJ.js";import"./message-circle-oS8o50gZ.js";import"./settings-BnI-Y10b.js";import"./brain-Bn2z760B.js";import"./index-DJGNkgSL.js";import"./chevron-right-avg7mug8.js";import"./index-W2DwLdmL.js";import"./check-UVwrTgdR.js";import"./triangle-alert-CyxJUOlk.js";import"./circle-check-big-BE3XTZQj.js";const le=[["path",{d:"M21 8V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v3",key:"14bfxa"}],["path",{d:"M21 16v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3",key:"14rx03"}],["path",{d:"M4 12H2",key:"rhcxmi"}],["path",{d:"M10 12H8",key:"s88cx1"}],["path",{d:"M16 12h-2",key:"10asgb"}],["path",{d:"M22 12h-2",key:"14jgyd"}]],de=A("flip-vertical",le);const me=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],pe=A("type",me),aa=()=>{const{deckId:l,cardId:h}=G(),{user:P}=J(),{toast:f}=ee(),u=Q(),c=!!h,[$,N]=o.useState(c),[g,y]=o.useState(!1),[b,H]=o.useState(!1),[t,m]=o.useState({front:"",back:"",tags:[],card_type:"basic"}),[w,C]=o.useState(""),[n,j]=o.useState({}),[q,S]=o.useState(!1),[B,k]=o.useState(!1),[D,E]=o.useState({title:"",message:""});o.useEffect(()=>{c&&O()},[h]);const O=async()=>{try{N(!0);const{data:a,error:s}=await v.getCardsInDeck(l);if(s)throw s;const r=a.find(i=>i.id===h);if(!r)throw new Error("Card not found");m({front:r.front,back:r.back,tags:r.tags||[],card_type:r.card_type||"basic"})}catch(a){_.error("Error loading card:",a),f({title:"Erro ao carregar",description:"NÃ£o foi possÃ­vel carregar o card.",variant:"destructive"}),u(`/students/flashcards/decks/${l}`)}finally{N(!1)}},T=a=>{const{name:s,value:r}=a.target;m(i=>({...i,[s]:r})),n[s]&&j(i=>({...i,[s]:""}))},M=()=>{const a=w.trim().toLowerCase();if(a){if(t.tags.includes(a)){f({title:"Tag jÃ¡ existe",description:"Esta tag jÃ¡ foi adicionada.",variant:"destructive"});return}m(s=>({...s,tags:[...s.tags,a]})),C("")}},R=a=>{m(s=>({...s,tags:s.tags.filter(r=>r!==a)}))},K=a=>{a.key==="Enter"&&(a.preventDefault(),M())},U=()=>{const a={};return t.front.trim()?t.front.length>2e3&&(a.front="Frente muito longa (mÃ¡x. 2000 caracteres)"):a.front="Frente do card Ã© obrigatÃ³ria",t.back.trim()?t.back.length>2e3&&(a.back="Verso muito longo (mÃ¡x. 2000 caracteres)"):a.back="Verso do card Ã© obrigatÃ³rio",j(a),Object.keys(a).length===0},W=async a=>{if(a.preventDefault(),!U()){f({title:"Erro de validaÃ§Ã£o",description:"Verifique os campos e tente novamente.",variant:"destructive"});return}try{y(!0);const s={deck_id:l,user_id:P.id,front:t.front.trim(),back:t.back.trim(),card_type:t.card_type,tags:t.tags};if(c){const{error:r}=await v.updateCard(h,s);if(r)throw r;E({title:"Card atualizado!",message:"Suas alteraÃ§Ãµes foram salvas e estÃ£o prontas para revisÃ£o."}),k(!0),setTimeout(()=>{u(`/students/flashcards/decks/${l}`)},100)}else{const{data:r,error:i}=await v.createCard(s);if(i)throw i;E({title:"Card criado com sucesso!",message:`Card "${t.front.substring(0,40)}${t.front.length>40?"...":""}" foi adicionado ao deck. Continue criando mais cards ou volte ao deck.`}),k(!0),m({front:"",back:"",tags:[],card_type:"basic"}),j({}),setTimeout(()=>{document.getElementById("front")?.focus()},100)}}catch(s){_.error("Error saving card:",s);let r="Tente novamente em instantes.";s.message?.includes("duplicate")?r="Este card jÃ¡ existe no deck.":s.message?.includes("foreign key")?r="Deck nÃ£o encontrado. Volte e tente novamente.":s.message&&(r=s.message),f({title:`âŒ Erro ao ${c?"atualizar":"criar"} card`,description:r,variant:"destructive",duration:6e3})}finally{y(!1)}},V=()=>{if(t.front||t.back||t.tags.length>0){S(!0);return}u(`/students/flashcards/decks/${l}`)},X=()=>{u(`/students/flashcards/decks/${l}`)};return $?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Y,{size:"lg",text:"Carregando card..."})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-4 sm:p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(p,{variant:"ghost",onClick:V,className:"mb-4 hover:bg-slate-200 dark:hover:bg-slate-800",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(ae,{title:c?"Editar Card":"Criar Novo Card",subtitle:c?"Modifique o conteÃºdo do card":"Adicione um novo card ao deck"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(z.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:e.jsx(x,{className:"p-6",children:e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"front",className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Frente do Card *"]}),e.jsx(F,{id:"front",name:"front",value:t.front,onChange:T,placeholder:"Digite a pergunta, termo, kanji, vocabulÃ¡rio...",rows:5,className:n.front?"border-red-500":"",maxLength:2e3,autoFocus:!0}),n.front&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.front}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.front.length,"/2000 caracteres â€¢ Suporta mÃºltiplos idiomas"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"back",className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Verso do Card *"]}),e.jsx(F,{id:"back",name:"back",value:t.back,onChange:T,placeholder:"Digite a resposta, traduÃ§Ã£o, explicaÃ§Ã£o...",rows:5,className:n.back?"border-red-500":"",maxLength:2e3}),n.back&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.back}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.back.length,"/2000 caracteres"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(d,{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Tags (opcional)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{type:"text",value:w,onChange:a=>C(a.target.value),onKeyDown:K,placeholder:"Digite uma tag...",className:"flex-1"}),e.jsx(p,{type:"button",onClick:M,variant:"outline",children:e.jsx(ie,{className:"w-4 h-4"})})]}),t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((a,s)=>e.jsxs(I,{variant:"secondary",className:"flex items-center gap-1",children:[a,e.jsx("button",{type:"button",onClick:()=>R(a),className:"ml-1 hover:text-red-600",children:e.jsx(ce,{className:"w-3 h-3"})})]},s))}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Tags ajudam a organizar e filtrar seus cards"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:V,className:"flex-1",disabled:g,children:"Cancelar"}),e.jsxs(p,{type:"button",variant:"outline",onClick:()=>H(!b),disabled:g,className:"lg:hidden",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),b?"Ocultar":"Ver"," Preview"]}),e.jsx(p,{type:"submit",className:"flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white",disabled:g||!t.front.trim()||!t.back.trim(),children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),c?"Atualizar":"Criar"," Card"]})})]})]})})}),(b||window.innerWidth>=1024)&&e.jsxs(z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3,delay:.1},className:"lg:sticky lg:top-6",children:[e.jsxs(x,{className:"p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Preview do Card"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(d,{className:"text-sm text-slate-600 dark:text-slate-400 mb-2 block",children:"Frente"}),e.jsx(x,{className:"p-6 min-h-[150px] flex items-center justify-center bg-gradient-to-br from-white to-slate-50 dark:from-slate-900 dark:to-slate-800 border-2 border-purple-200 dark:border-purple-800",children:e.jsx("p",{className:"text-center text-lg text-slate-900 dark:text-white",children:t.front||"A frente do card aparecerÃ¡ aqui..."})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(d,{className:"text-sm text-slate-600 dark:text-slate-400 mb-2 block",children:"Verso"}),e.jsx(x,{className:"p-6 min-h-[150px] flex items-center justify-center bg-gradient-to-br from-purple-50 to-pink-50 dark:from-slate-800 dark:to-slate-900 border-2 border-purple-200 dark:border-purple-800",children:e.jsx("p",{className:"text-center text-lg text-slate-700 dark:text-slate-300",children:t.back||"O verso do card aparecerÃ¡ aqui..."})})]}),t.tags.length>0&&e.jsxs("div",{children:[e.jsx(d,{className:"text-sm text-slate-600 dark:text-slate-400 mb-2 block",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((a,s)=>e.jsx(I,{variant:"outline",children:a},s))})]})]}),e.jsxs(x,{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-bold text-blue-900 dark:text-blue-100 mb-2 text-sm",children:"ðŸ’¡ Dicas para criar bons cards"}),e.jsxs("ul",{className:"space-y-1 text-xs text-blue-800 dark:text-blue-200",children:[e.jsx("li",{children:"â€¢ Seja conciso e objetivo"}),e.jsx("li",{children:"â€¢ Uma pergunta por card"}),e.jsx("li",{children:"â€¢ Use linguagem simples"}),e.jsx("li",{children:"â€¢ Adicione tags para organizar"}),e.jsx("li",{children:"â€¢ Revise regularmente"})]})]})]})]}),e.jsx(te,{isOpen:q,onClose:()=>S(!1),onConfirm:X,title:"Descartar alteraÃ§Ãµes?",message:"VocÃª tem alteraÃ§Ãµes nÃ£o salvas. Tem certeza que deseja sair sem salvar?",confirmText:"Sim, descartar",cancelText:"Continuar editando",variant:"danger"}),e.jsx(se,{isOpen:B,onClose:()=>k(!1),title:D.title,message:D.message})]})})};export{aa as default};
