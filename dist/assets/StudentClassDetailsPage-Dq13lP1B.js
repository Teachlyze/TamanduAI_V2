import{A as ae,r as o,s as _,j as e,m as te,u as le,k as re,R as ie}from"./main-XRKQFEIr.js";import{m as g,B as f}from"./button-D4bIZ4Ty.js";import{C as p}from"./card-BEk2G2Us.js";import{B as R}from"./SidebarPremium-BnsbfpCV.js";import{T as de,a as ne,b as q,c as L}from"./tabs-D66ljSV7.js";import{u as ee}from"./use-toast-Cv69gxoh.js";import{T as oe}from"./textarea-wXaf8p7F.js";import{M as K}from"./message-square-Q5LnU50P.js";import{P as ce,M as se,I as me}from"./pin-BzWTKHuO.js";import{C as J}from"./clock-BXvepPh_.js";import{T as xe}from"./thumbs-up-DAx0z-bA.js";import{H as he}from"./heart-COp2_VPM.js";import{S as ue}from"./sparkles-pthiUTeM.js";import{C as fe}from"./chevron-up-Bc2ZkTy5.js";import{C as pe}from"./chevron-down--5IVxs-k.js";import{A as ge}from"./index-e3XtT_BD.js";import{S as be}from"./routes-BNEccWfs.js";import{f as U}from"./format-CxHpq9RK.js";import{p as T}from"./pt-BR-CXWZr0Zs.js";import{I as je}from"./info-DB2hCK8Q.js";import{T as ve}from"./triangle-alert-Bz2ASMAl.js";import{C as Ne}from"./circle-alert-CmSW_OAP.js";import{I as we}from"./input-BrWaMOrb.js";import{D as ke,a as ye,b as _e,c as Ce}from"./dialog-B2ShbSiF.js";import{S as Se}from"./search-bwbDgZQN.js";import{B as G}from"./book-open-CAn3t7Hm.js";import{E as De}from"./eye-DrCLqRJv.js";import{D as Q}from"./download-DAXH3RrD.js";import{X as Me}from"./x-BPPDjH10.js";import{F as W}from"./file-jXcSoJ9l.js";import{F as O}from"./file-text-tq0U235S.js";import{V as ze}from"./video-BkVf65nQ.js";import{A as Ae}from"./arrow-left-faOheEeC.js";import{U as I}from"./users-DP4-CTtE.js";import"./bell-v36tl0On.js";import"./trending-up-eowzUgXK.js";import"./user-CCHLYTsx.js";import"./settings-pQ42cErW.js";import"./graduation-cap-CRbvieNe.js";import"./chart-column-CBFsA3dh.js";import"./Combination-TYhCc4jv.js";import"./index-ysAnX8Hi.js";import"./bot-Bgah8qmE.js";import"./en-US-azV9x4mt.js";const Pe=({posts:t,loading:M})=>{const{user:l}=ae(),{toast:v}=ee(),[c,h]=o.useState({}),[d,y]=o.useState({}),[C,z]=o.useState({}),[A,B]=o.useState({}),[P,V]=o.useState({});o.useEffect(()=>{t?.length>0&&F()},[t]);const F=async()=>{if(!t)return;const s=t.map(n=>n.id),{data:m}=await _.from("discussion_reactions").select("discussion_id, reaction_type, user_id").in("discussion_id",s),i={};m?.forEach(n=>{i[n.discussion_id]||(i[n.discussion_id]={like:[],love:[],celebrate:[]}),i[n.discussion_id][n.reaction_type]&&i[n.discussion_id][n.reaction_type].push(n.user_id)}),h(i);const{data:u}=await _.from("discussion_messages").select(`
        id,
        discussion_id,
        content,
        created_at,
        user_id,
        profiles!discussion_messages_user_id_fkey (
          id,
          full_name,
          avatar_url
        )
      `).in("discussion_id",s).eq("is_deleted",!1).order("created_at",{ascending:!0}),S={};u?.forEach(n=>{S[n.discussion_id]||(S[n.discussion_id]=[]),S[n.discussion_id].push(n)}),y(S)},N=async(s,m)=>{if(!l)return;if((c[s]||{like:[],love:[],celebrate:[]})[m]?.includes(l.id)){const{error:S}=await _.from("discussion_reactions").delete().eq("discussion_id",s).eq("user_id",l.id).eq("reaction_type",m);S||h(n=>{const w=n[s]||{like:[],love:[],celebrate:[]};return{...n,[s]:{...w,[m]:(w[m]||[]).filter(r=>r!==l.id)}}})}else{const{error:S}=await _.from("discussion_reactions").insert({discussion_id:s,user_id:l.id,reaction_type:m});S||(h(n=>{const w=n[s]||{like:[],love:[],celebrate:[]};return{...n,[s]:{...w,[m]:[...w[m]||[],l.id]}}}),v({title:"ReaÃ§Ã£o adicionada!",duration:2e3}))}},a=async s=>{if(!l||!C[s]?.trim())return;const{data:m,error:i}=await _.from("discussion_messages").insert({discussion_id:s,user_id:l.id,content:C[s].trim()}).select(`
        id,
        discussion_id,
        content,
        created_at,
        user_id,
        profiles!discussion_messages_user_id_fkey (
          id,
          full_name,
          avatar_url
        )
      `).single();!i&&m?(y(u=>({...u,[s]:[...u[s]||[],m]})),z(u=>({...u,[s]:""})),v({title:"ComentÃ¡rio adicionado!",duration:2e3})):v({title:"Erro ao adicionar comentÃ¡rio",variant:"destructive"})},k=s=>{B(m=>({...m,[s]:!m[s]}))};return M?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(p,{className:"p-6 animate-pulse",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-200 dark:bg-slate-700"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-slate-200 dark:bg-slate-700 rounded"})]})]})},s))}):!t||t.length===0?e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Nenhuma publicaÃ§Ã£o ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"As publicaÃ§Ãµes do professor aparecerÃ£o aqui"})]}):e.jsx("div",{className:"space-y-4",children:t.map((s,m)=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.05},children:e.jsxs(p,{className:"p-6 hover:shadow-lg transition-shadow relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-blue-500 to-cyan-500"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-lg shadow-md flex-shrink-0",children:s.creator?.full_name?.[0]?.toUpperCase()||"P"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:s.creator?.full_name||"Professor"}),s.is_pinned&&e.jsxs(R,{className:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-300",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),"Fixado"]}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),U(new Date(s.created_at),"dd 'de' MMMM 'Ã s' HH:mm",{locale:T})]})]}),e.jsx("h3",{className:"text-lg font-bold mb-2 text-slate-900 dark:text-white",children:s.title}),e.jsx("div",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap mb-3",children:s.description}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((i,u)=>e.jsxs(R,{variant:"outline",className:"text-xs",children:["#",i]},u))}),s.file_url&&e.jsx("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",className:"mt-3 inline-flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"ðŸ“Ž Ver anexo"}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>N(s.id,"like"),className:`gap-1.5 ${c[s.id]?.like?.includes(l?.id)?"text-blue-600 bg-blue-50 dark:bg-blue-950/30":"text-slate-600 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-950/30"}`,children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:c[s.id]?.like?.length||0})]}),e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>N(s.id,"love"),className:`gap-1.5 ${c[s.id]?.love?.includes(l?.id)?"text-red-600 bg-red-50 dark:bg-red-950/30":"text-slate-600 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30"}`,children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:c[s.id]?.love?.length||0})]}),e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>N(s.id,"celebrate"),className:`gap-1.5 ${c[s.id]?.celebrate?.includes(l?.id)?"text-yellow-600 bg-yellow-50 dark:bg-yellow-950/30":"text-slate-600 hover:text-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-950/30"}`,children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:c[s.id]?.celebrate?.length||0})]}),e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>k(s.id),className:"gap-1.5 ml-auto text-slate-600 hover:text-slate-900 dark:hover:text-slate-100",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xs font-medium",children:[d[s.id]?.length||0," comentÃ¡rios"]}),A[s.id]?e.jsx(fe,{className:"w-3 h-3"}):e.jsx(pe,{className:"w-3 h-3"})]})]}),e.jsx(ge,{children:A[s.id]&&e.jsxs(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-4 space-y-3",children:[d[s.id]?.map(i=>e.jsxs("div",{className:"flex gap-3 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:i.profiles?.full_name?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:i.profiles?.full_name||"UsuÃ¡rio"}),e.jsx("span",{className:"text-xs text-slate-500",children:U(new Date(i.created_at),"dd/MM HH:mm",{locale:T})})]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:i.content})]})]},i.id)),e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:l?.user_metadata?.full_name?.[0]?.toUpperCase()||"V"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(oe,{placeholder:"Escreva um comentÃ¡rio...",value:C[s.id]||"",onChange:i=>z(u=>({...u,[s.id]:i.target.value})),className:"min-h-[60px] resize-none",onKeyDown:i=>{i.key==="Enter"&&i.ctrlKey&&a(s.id)}}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs(f,{size:"sm",onClick:()=>a(s.id),disabled:!C[s.id]?.trim(),className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),"Enviar"]})})]})]})]})})]})]})]})]})},s.id))})},Y={critical:{icon:Ne,label:"Urgente",color:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300",borderColor:"border-l-red-500"},warning:{icon:ve,label:"AtenÃ§Ã£o",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/40 dark:text-orange-300",borderColor:"border-l-orange-500"},info:{icon:je,label:"Informativo",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",borderColor:"border-l-blue-500"}},Ee=({announcements:t,loading:M})=>M?e.jsx("div",{className:"space-y-4",children:[1,2].map(l=>e.jsx(p,{className:"p-6 animate-pulse",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 bg-slate-200 dark:bg-slate-700 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-full"}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-5/6"})]})},l))}):!t||t.length===0?e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(se,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Nenhum comunicado"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Comunicados importantes aparecerÃ£o aqui"})]}):e.jsx("div",{className:"space-y-4",children:t.map((l,v)=>{const c=l.tags?.[0]||"info",h=Y[c]||Y.info,d=h.icon;return e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:v*.05},children:e.jsx(p,{className:`p-6 border-l-4 ${h.borderColor} hover:shadow-lg transition-shadow`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${h.color} flex-shrink-0`,children:e.jsx(d,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:l.title}),e.jsx(R,{className:h.color,children:h.label})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 mb-3 whitespace-pre-wrap",children:l.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),U(new Date(l.created_at),"dd/MM/yyyy 'Ã s' HH:mm",{locale:T})]}),l.creator&&e.jsxs("span",{children:["Por ",l.creator.full_name]})]}),l.file_url&&e.jsx("a",{href:l.file_url,target:"_blank",rel:"noopener noreferrer",className:"mt-3 inline-flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"ðŸ“Ž Ver anexo"})]})]})})},l.id)})}),Be=t=>t?t.includes("pdf")?O:t.includes("image")?me:t.includes("video")?ze:W:W,Fe=t=>t?t.includes("pdf")?"from-red-500 to-red-600":t.includes("image")?"from-purple-500 to-pink-500":t.includes("video")?"from-blue-500 to-cyan-500":t.includes("document")||t.includes("word")?"from-blue-600 to-indigo-600":t.includes("sheet")||t.includes("excel")?"from-green-500 to-green-600":"from-slate-500 to-slate-600":"from-slate-500 to-slate-600",Z=t=>t?t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB":"",Re=({materials:t,loading:M})=>{const[l,v]=o.useState(""),[c,h]=o.useState("all"),[d,y]=o.useState(null),[C,z]=o.useState(!1),A=a=>a?.includes("image"),B=a=>a?.includes("video"),P=a=>A(a.file_type)||B(a.file_type),V=a=>{y(a),z(!0)},F=()=>{z(!1),y(null)},N=t?.filter(a=>{const k=!l||a.title?.toLowerCase().includes(l.toLowerCase())||a.description?.toLowerCase().includes(l.toLowerCase()),s=c==="all"||a.file_type?.includes(c);return k&&s})||[];return M?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>e.jsx(p,{className:"p-6 animate-pulse",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-slate-200 dark:bg-slate-700"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-5 bg-slate-200 dark:bg-slate-700 rounded w-2/3"}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-full"}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-1/2"})]})]})},a))}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(we,{placeholder:"Buscar materiais...",value:l,onChange:a=>v(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{variant:c==="all"?"default":"outline",size:"sm",onClick:()=>h("all"),children:"Todos"}),e.jsx(f,{variant:c==="pdf"?"default":"outline",size:"sm",onClick:()=>h("pdf"),children:"PDFs"}),e.jsx(f,{variant:c==="video"?"default":"outline",size:"sm",onClick:()=>h("video"),children:"VÃ­deos"}),e.jsx(f,{variant:c==="image"?"default":"outline",size:"sm",onClick:()=>h("image"),children:"Imagens"})]})]})}),N.length===0?e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(G,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:l||c!=="all"?"Nenhum resultado encontrado":"Nenhum material disponÃ­vel"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:l||c!=="all"?"Tente ajustar os filtros":"Materiais de estudo aparecerÃ£o aqui"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map((a,k)=>{const s=Be(a.file_type),m=Fe(a.file_type);return e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:k*.05},children:e.jsxs(p,{className:"p-6 hover:shadow-xl transition-all group",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:`w-16 h-16 rounded-xl bg-gradient-to-br ${m} flex items-center justify-center flex-shrink-0 shadow-md group-hover:scale-110 transition-transform`,children:e.jsx(s,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-1 truncate",children:a.title}),a.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400 mb-3",children:[a.created_at&&e.jsx("span",{children:U(new Date(a.created_at),"dd/MM/yyyy",{locale:T})}),a.file_size&&e.jsxs("span",{children:["â€¢ ",Z(a.file_size)]}),a.creator&&e.jsxs("span",{children:["â€¢ ",a.creator.full_name]})]}),a.file_url?e.jsxs("div",{className:"flex gap-2",children:[P(a)&&e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>V(a),className:"flex-1",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Visualizar"]}),e.jsx("a",{href:a.file_url,target:"_blank",rel:"noopener noreferrer",download:!0,className:P(a)?"flex-1":"w-full",children:e.jsxs(f,{size:"sm",className:"w-full",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),P(a)?"Baixar":"Baixar Material"]})})]}):e.jsx(f,{size:"sm",variant:"outline",className:"w-full",disabled:!0,children:"IndisponÃ­vel"})]})]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:a.tags.map((i,u)=>e.jsx(R,{variant:"outline",className:"text-xs",children:i},u))})]})},a.id)})}),N.length>0&&e.jsxs("div",{className:"text-center text-sm text-slate-500 dark:text-slate-400",children:["Exibindo ",N.length," de ",t?.length||0," ",N.length===1?"material":"materiais"]}),e.jsx(ke,{open:C,onOpenChange:z,children:e.jsxs(ye,{className:"max-w-5xl max-h-[90vh] overflow-auto",children:[e.jsxs(_e,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ce,{className:"text-xl font-bold",children:d?.title}),e.jsx(f,{variant:"ghost",size:"icon",onClick:F,className:"rounded-full",children:e.jsx(Me,{className:"w-4 h-4"})})]}),d?.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-2",children:d.description})]}),e.jsxs("div",{className:"mt-4",children:[d&&A(d.file_type)&&e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative rounded-lg overflow-hidden bg-slate-100 dark:bg-slate-800",children:e.jsx("img",{src:d.file_url,alt:d.title,className:"w-full h-auto max-h-[70vh] object-contain"})}),d&&B(d.file_type)&&e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative rounded-lg overflow-hidden bg-black",children:e.jsxs("video",{controls:!0,className:"w-full h-auto max-h-[70vh]",controlsList:"nodownload",children:[e.jsx("source",{src:d.file_url,type:d.file_type}),"Seu navegador nÃ£o suporta a tag de vÃ­deo."]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:[d?.file_size&&e.jsx("span",{children:Z(d.file_size)}),d?.created_at&&e.jsxs("span",{className:"ml-3",children:["Adicionado em ",U(new Date(d.created_at),"dd 'de' MMM 'de' yyyy",{locale:T})]})]}),e.jsx("a",{href:d?.file_url,target:"_blank",rel:"noopener noreferrer",download:!0,children:e.jsxs(f,{size:"sm",className:"gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Baixar"]})})]})]})]})})]})},Ss=()=>{const{classId:t}=te(),M=le(),{toast:l}=ee(),[v,c]=o.useState(!0),[h,d]=o.useState(!1),[y,C]=o.useState(null),[z,A]=o.useState([]),[B,P]=o.useState([]),[V,F]=o.useState([]),[N,a]=o.useState([]),[k,s]=o.useState([]),[m,i]=o.useState("feed"),[u,S]=o.useState(!0),n=o.useCallback(async(r=!1)=>{try{if(r?d(!0):c(!0),u){const{data:D}=await _.auth.getSession(),E=D?.session?.access_token,$=await fetch("https://wapbwaimkurbuihatmix.supabase.co/functions/v1/get-class-data",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({classId:t})});if(!$.ok)throw new Error("Erro ao carregar dados");const H=await $.json(),x=H.data;console.log("[StudentClassDetailsPage] ðŸ“¦ Dados recebidos da Edge Function:",{classInfo:x.classInfo,posts:x.posts?.length||0,discussions:x.discussions?.length||0,announcements:x.announcements?.length||0,library:x.library?.length||0,activities:x.activities?.length||0,members:x.members?.length||0,fullData:x});const b=[...x.posts||[],...(x.discussions||[]).map(j=>({...j,title:j.title,description:j.description,creator:j.author,is_pinned:j.is_pinned,created_at:j.created_at}))];console.log("[StudentClassDetailsPage] ðŸ“ Posts combinados (materials + discussions):",b.length);const X=(x.activities||[]).filter(j=>j.status==="published");console.log("[StudentClassDetailsPage] ðŸŽ¯ Atividades filtradas:",{total:x.activities?.length||0,published:X.length,filtered:x.activities?.filter(j=>j.status!=="published").map(j=>({title:j.title,status:j.status}))}),C(x.classInfo),A(b),P(x.announcements||[]),F(x.library||[]),a(X),s(x.members||[]),r&&H.cached&&l({title:"Dados atualizados",description:"Cache atualizado com sucesso"})}else{const[D,E,$,H]=await Promise.all([_.from("classes").select("id, name, subject, description, color").eq("id",t).single(),_.from("class_materials").select(`
              id, title, description, file_url, file_type, file_size, category, tags, created_at,
              creator:profiles!class_materials_created_by_fkey(id, full_name, avatar_url)
            `).eq("class_id",t).order("created_at",{ascending:!1}),_.from("activity_class_assignments").select("activity_id, activity:activities(id, title, description, due_date, max_score, type, status)").eq("class_id",t),_.from("class_members").select("id, role, joined_at, profile:profiles!class_members_user_id_fkey(id, full_name, avatar_url, email)").eq("class_id",t).order("role",{ascending:!0})]);C(D.data);const x=E.data||[];A(x.filter(b=>!b.category||b.category==="post")),P(x.filter(b=>b.category==="announcement")),F(x.filter(b=>b.category&&b.category!=="post"&&b.category!=="announcement")),a($.data?.map(b=>b.activity).filter(Boolean)||[]),s(H.data||[])}}catch(D){console.error("Erro ao carregar dados:",D),l({title:"Erro",description:"NÃ£o foi possÃ­vel carregar os dados da turma",variant:"destructive"})}finally{c(!1),d(!1)}},[t,u,l]);o.useEffect(()=>{n()},[n]);const w=o.useMemo(()=>{if(!k.length)return{teachers:[],students:[]};const r=k.filter(E=>E.role==="teacher"),D=k.filter(E=>E.role==="student");return{teachers:r,students:D}},[k]);return v?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(re,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-slate-100 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950",children:[e.jsxs("div",{className:"relative h-72 bg-gradient-to-br from-blue-600 via-blue-500 to-cyan-500 overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",children:e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.1] bg-[size:30px_30px]"})}),e.jsx("div",{className:"absolute -top-20 -right-20 w-80 h-80 bg-white/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-20 -left-20 w-96 h-96 bg-cyan-300/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-purple-300/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"2s"}}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 md:px-6 h-full flex flex-col justify-between py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"ghost",onClick:()=>M("/students/classes"),className:"text-white hover:bg-white/20 border border-white/30 backdrop-blur-sm transition-all hover:scale-105",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx(f,{variant:"ghost",onClick:()=>n(!0),disabled:h,className:"text-white hover:bg-white/20 border border-white/30 backdrop-blur-sm transition-all hover:scale-105",children:e.jsx(ie,{className:`w-4 h-4 ${h?"animate-spin":""}`})})]}),e.jsxs(g.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-2 bg-white/20 backdrop-blur-md px-4 py-2 rounded-full border border-white/30",children:[e.jsx(I,{className:"w-4 h-4 text-white"}),e.jsxs("span",{className:"text-white font-medium",children:[k.length," membros"]})]})]}),e.jsx(g.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-white pb-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(g.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.6},className:"p-4 bg-white/20 backdrop-blur-md rounded-2xl border border-white/30 shadow-xl",children:e.jsx(G,{className:"w-10 h-10"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(g.h1,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"text-4xl md:text-5xl font-bold mb-2 drop-shadow-lg",children:y?.name||"Carregando..."}),e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"px-4 py-1.5 bg-white/20 backdrop-blur-sm rounded-full border border-white/30",children:e.jsx("p",{className:"text-base font-medium",children:y?.subject||"Disciplina"})}),y?.description&&e.jsx("p",{className:"text-white/90 text-sm max-w-2xl",children:y.description})]})]})]})})]})]}),e.jsx("div",{className:"w-full px-8 -mt-8 relative z-20",children:e.jsxs(de,{value:m,onValueChange:i,className:"w-full",children:[e.jsx(g.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:e.jsx(p,{className:"mb-8 bg-white/80 backdrop-blur-sm dark:bg-slate-900/80 border-2 border-slate-200 dark:border-slate-800 shadow-2xl rounded-2xl overflow-hidden",children:e.jsxs(ne,{className:"w-full grid grid-cols-5 p-3 bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 gap-2",children:[e.jsxs(q,{value:"feed",className:"flex items-center justify-center gap-2 px-4 py-3 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300 rounded-xl hover:scale-[1.02]",children:[e.jsx(K,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold",children:"Mural"})]}),e.jsxs(q,{value:"announcements",className:"flex items-center justify-center gap-2 px-4 py-3 data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-orange-600 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300 rounded-xl hover:scale-[1.02]",children:[e.jsx(se,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold",children:"Comunicados"})]}),e.jsxs(q,{value:"library",className:"flex items-center justify-center gap-2 px-4 py-3 data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300 rounded-xl hover:scale-[1.02]",children:[e.jsx(G,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold",children:"Biblioteca"})]}),e.jsxs(q,{value:"activities",className:"flex items-center justify-center gap-2 px-4 py-3 data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-green-600 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300 rounded-xl hover:scale-[1.02]",children:[e.jsx(O,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold",children:"Atividades"})]}),e.jsxs(q,{value:"members",className:"flex items-center justify-center gap-2 px-4 py-3 data-[state=active]:bg-gradient-to-r data-[state=active]:from-cyan-500 data-[state=active]:to-cyan-600 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300 rounded-xl hover:scale-[1.02]",children:[e.jsx(I,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold",children:"Membros"})]})]})})}),e.jsx(L,{value:"feed",children:e.jsx(Pe,{posts:z,loading:v})}),e.jsx(L,{value:"announcements",children:e.jsx(Ee,{announcements:B,loading:v})}),e.jsx(L,{value:"library",children:e.jsx(Re,{materials:V,loading:v})}),e.jsx(L,{value:"activities",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[N.map((r,D)=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:D*.1},children:e.jsxs(p,{onClick:()=>M(`/students/activities/${r.id}`),className:"group relative p-6 cursor-pointer hover:shadow-2xl transition-all duration-300 border-2 border-slate-200 dark:border-slate-800 bg-gradient-to-br from-white to-slate-50 dark:from-slate-900 dark:to-slate-800 hover:scale-105 overflow-hidden rounded-2xl",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/20 dark:to-purple-900/20 rounded-full blur-3xl opacity-50 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${r.status==="published"?"bg-gradient-to-br from-green-500 to-emerald-500":"bg-gradient-to-br from-slate-400 to-slate-500"} shadow-lg group-hover:scale-110 transition-transform`,children:e.jsx(O,{className:"w-6 h-6 text-white"})}),e.jsx(R,{className:r.status==="published"?"bg-gradient-to-r from-emerald-500 to-green-500 text-white border-0":r.status==="archived"?"bg-gradient-to-r from-rose-500 to-red-500 text-white border-0":"bg-gradient-to-r from-slate-400 to-slate-500 text-white border-0",children:r.status==="published"?"âœ“ Publicada":r.status==="archived"?"âœ• Arquivada":r.status==="draft"?"ðŸ“ Rascunho":r.status})]}),e.jsx("h3",{className:"font-bold text-lg mb-2 text-slate-900 dark:text-white line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:r.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4 line-clamp-2",children:r.description||"Sem descriÃ§Ã£o"}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:"ðŸ“…"}),e.jsx("span",{className:"font-medium",children:r.due_date?new Date(r.due_date).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}):"Sem prazo"})]}),e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-bold rounded-full shadow-md",children:[e.jsx("span",{children:r.max_score}),e.jsx("span",{className:"text-xs",children:"pts"})]})]})]})]})},r.id)),N.length===0&&e.jsx(g.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"col-span-full",children:e.jsxs(p,{className:"p-12 text-center bg-gradient-to-br from-white to-slate-50 dark:from-slate-900 dark:to-slate-800 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-2xl",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-slate-200 to-slate-300 dark:from-slate-700 dark:to-slate-800 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-10 h-10 text-slate-400 dark:text-slate-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Nenhuma atividade ainda"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"As atividades da turma aparecerÃ£o aqui"})]})})]})}),e.jsx(L,{value:"members",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),"Professores (",w.teachers.length,")"]}),w.teachers.length>0?e.jsx("div",{className:"space-y-3",children:w.teachers.map(r=>e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50/60 dark:bg-slate-900/40 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center text-white font-bold text-lg shadow-md flex-shrink-0",children:r.profile?.full_name?.[0]?.toUpperCase()||"P"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 dark:text-white",children:r.profile?.full_name||"Professor(a)"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:r.profile?.email})]}),e.jsx(R,{className:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300 flex-shrink-0",children:"Professor"})]},r.id))}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nenhum professor listado."})]}),e.jsxs(p,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),"Colegas de turma (",w.students.length,")"]}),w.students.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.students.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50/70 dark:bg-slate-900/40 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center text-white font-bold shadow-md flex-shrink-0",children:r.profile?.full_name?.[0]?.toUpperCase()||"A"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white truncate",children:r.profile?.full_name||"Colega"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 truncate",children:r.profile?.email}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Desde ",new Date(r.created_at).toLocaleDateString("pt-BR")]})]})]},r.id))}):e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nenhum colega listado no momento."})]})]})})]})})]})};export{Ss as default};
