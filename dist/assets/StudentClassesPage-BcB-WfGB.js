import{c as I,u as M,a as B,r,s as l,j as e,k as A}from"./main-XRKQFEIr.js";import{B as x,m as p}from"./button-D4bIZ4Ty.js";import{C as y}from"./card-BEk2G2Us.js";import{I as J}from"./input-BrWaMOrb.js";import{D as U}from"./DashboardHeader-B78p6TYW.js";import{S as z}from"./SearchInput-CrAl1piE.js";import"./dropdown-menu-DyRCHyY4.js";import"./label-_ADcUmGf.js";import{B as k}from"./book-open-CAn3t7Hm.js";import{U as P}from"./users-DP4-CTtE.js";import{C as V}from"./index-e3XtT_BD.js";import{X as F}from"./x-BPPDjH10.js";import"./search-bwbDgZQN.js";import"./Combination-TYhCc4jv.js";import"./index-ysAnX8Hi.js";import"./index-B_kCUa_t.js";import"./chevron-right-C-DpTlMS.js";import"./check-Cifhij8e.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],_=I("log-in",O),ne=()=>{const E=M(),{user:n}=B(),[S,g]=r.useState(!0),[D,L]=r.useState([]),[h,T]=r.useState(""),[q,i]=r.useState(!1),[b,c]=r.useState(""),[f,j]=r.useState(!1),[v,a]=r.useState("");r.useEffect(()=>{w()},[n]);const w=async()=>{if(n)try{g(!0);const{data:s}=await l.from("class_members").select(`
          class_id,
          joined_at,
          classes:class_id (
            id,
            name,
            subject,
            color,
            banner_color,
            created_by,
            teacher:created_by (
              id,
              full_name
            )
          )
        `).eq("user_id",n.id).eq("role","student").order("joined_at",{ascending:!1}),t=await Promise.all((s||[]).map(async m=>{const o=m.classes;if(!o)return null;const{count:d}=await l.from("class_members").select("id",{count:"exact",head:!0}).eq("class_id",o.id),{count:u}=await l.from("activity_class_assignments").select("id",{count:"exact",head:!0}).eq("class_id",o.id);return{...o,memberCount:d||0,activityCount:u||0}}));L(t.filter(Boolean))}catch(s){console.error("Erro:",s)}finally{g(!1)}},N=async()=>{const s=b.replace(/\s/g,"").trim().toUpperCase();if(!s){a("Digite o cÃ³digo da turma");return}if(s.length>12){a("CÃ³digo invÃ¡lido (mÃ¡ximo 12 caracteres)");return}try{j(!0),a("");const{data:t,error:m}=await l.from("classes").select("id, name").ilike("invite_code",s).maybeSingle();if(m||!t){console.error("Erro ao buscar turma:",m),a("CÃ³digo invÃ¡lido! Verifique se digitou corretamente.");return}console.log("âœ… Turma encontrada:",t);const{data:o}=await l.from("class_members").select("id").eq("class_id",t.id).eq("user_id",n.id).single();if(o){a("VocÃª jÃ¡ estÃ¡ nesta turma!");return}const{data:d,error:u}=await l.from("class_members").insert({class_id:t.id,user_id:n.id,role:"student",joined_at:new Date().toISOString()}).select();if(u)throw u;if(!d||d.length===0)throw new Error("Falha ao adicionar vocÃª Ã  turma");console.log("âœ… VocÃª entrou na turma:",d[0]),i(!1),c(""),a(""),await w(),alert(`ðŸŽ‰ VocÃª entrou na turma "${t.name}" com sucesso!

A turma jÃ¡ aparece na sua lista.`)}catch(t){console.error("Erro ao entrar na turma:",t),a("Erro ao entrar na turma. Tente novamente.")}finally{j(!1)}},C=D.filter(s=>s.name?.toLowerCase().includes(h.toLowerCase())||s.subject?.toLowerCase().includes(h.toLowerCase()));return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(A,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-slate-200 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-6",children:[e.jsx(U,{title:"Minhas Turmas",subtitle:"Acompanhe suas turmas e atividades",role:"student"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center justify-between gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(z,{value:h,onChange:s=>T(s.target.value),placeholder:"Buscar turmas..."})}),e.jsxs(x,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white shadow-lg flex-shrink-0",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Entrar com CÃ³digo"]})]}),C.length>0?e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:C.map((s,t)=>e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsxs(y,{onClick:()=>E(`/students/classes/${s.id}`),className:"overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-200 border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-r from-blue-600 to-cyan-500 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(k,{className:"w-12 h-12 text-white opacity-90"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white line-clamp-2",children:s.name})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:s.subject||"Disciplina nÃ£o informada"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.memberCount||0," ",s.memberCount===1?"membro":"membros"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.activityCount||0," ",s.activityCount===1?"atividade":"atividades"]})]})]})]})]})},s.id))}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(k,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"Nenhuma turma ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Entre em uma turma usando um cÃ³digo de acesso"}),e.jsxs(x,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"Entrar em uma Turma"]})]})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{i(!1),c(""),a("")},children:e.jsx(p.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:s=>s.stopPropagation(),children:e.jsxs(y,{className:"p-8 max-w-md w-full bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Entrar em uma Turma"}),e.jsx("button",{onClick:()=>{i(!1),c(""),a("")},className:"p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(F,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Digite o cÃ³digo fornecido pelo professor"}),e.jsxs("div",{className:"mb-6",children:[e.jsx(J,{value:b,onChange:s=>{const t=s.target.value.toUpperCase();t.length<=8&&(c(t),a(""))},onKeyPress:s=>{s.key==="Enter"&&N()},placeholder:"CÃ“DIGO DA TURMA",maxLength:8,className:"text-center text-2xl font-mono tracking-widest uppercase h-14 border-2 focus:border-blue-500",autoFocus:!0}),v&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 text-center",children:v})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{variant:"outline",onClick:()=>{i(!1),c(""),a("")},className:"flex-1 border-slate-300 dark:border-slate-700",disabled:f,children:"Cancelar"}),e.jsx(x,{onClick:N,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",disabled:f||!b.trim(),children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Entrando..."]}):"Entrar"})]})]})})})]})};export{ne as default};
