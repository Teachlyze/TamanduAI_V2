import{c as L,s as d,l as h,a as U,r as v,j as e,m as C}from"./main-BXI8jImK.js";import{C as A}from"./card-Dts-jKab.js";import{m as O,B as q}from"./button-DhJSXayK.js";import{t as p}from"./use-toast-B4cJHS9G.js";import{U as R}from"./user-XMBxPeUS.js";import{S as Y}from"./settings-Dn83Owos.js";import{S as F}from"./shield-BGqmQ9nN.js";import{S as I}from"./save-X-LtD5pM.js";import{X as H}from"./x-DhRNfShw.js";import{B as V}from"./bell-De3gaLfU.js";import{a as M,b as T}from"./SidebarPremium-CqhK_O_u.js";import{G as J}from"./globe-WgNwMY05.js";import"./book-open-BMCImb8A.js";import"./trending-up-C_AGH9Be.js";import"./file-text-B1_cTV9D.js";import"./users-1MVt23UL.js";import"./graduation-cap-BVXXkz0b.js";import"./index-Cyt6Mlq7.js";import"./chart-column-D6pi1FRc.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],X=L("camera",W),K=async i=>{try{const{data:l,error:s}=await d.from("profiles").select("*").eq("id",i).eq("role","teacher").single();if(s)throw s;return{data:l,error:null}}catch(l){return h.error("Erro ao buscar perfil do professor:",l),{data:null,error:l}}},Q=async(i,l)=>{try{const{data:s,error:m}=await d.from("profiles").update({...l,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(m)throw m;return{data:s,error:null}}catch(s){return h.error("Erro ao atualizar perfil do professor:",s),{data:null,error:s}}},B=async i=>{try{const{data:l,error:s}=await d.from("classes").select("id").eq("created_by",i).eq("is_active",!0);if(s)throw s;const m=l?.length||0,c=l?.map(a=>a.id)||[],{data:u,error:f}=await d.from("class_members").select("user_id").in("class_id",c).eq("role","student");if(f)throw f;const g=new Set(u?.map(a=>a.user_id)||[]).size,{data:P,error:N}=await d.from("activities").select("id").eq("created_by",i);if(N)throw N;const _=P?.length||0,n=P?.map(a=>a.id)||[],{data:x,error:b}=await d.from("submissions").select("id").in("activity_id",n).eq("status","submitted");if(b)throw b;const y=x?.length||0,{data:w,error:E}=await d.from("submissions").select("grade").in("activity_id",n).not("grade","is",null);if(E)throw E;const z=w?.length>0?w.reduce((a,o)=>a+o.grade,0)/w.length:0,k=new Date;k.setHours(0,0,0,0);const S=new Date(k);S.setDate(S.getDate()+1);const{data:D,error:r}=await d.from("submissions").select("id").in("activity_id",n).gte("graded_at",k.toISOString()).lt("graded_at",S.toISOString());if(r)throw r;const t=D?.length||0;return{data:{totalClasses:m,totalStudents:g,totalActivities:_,pendingGrading:y,avgGrade:Number(z.toFixed(1)),todayCorrections:t},error:null}}catch(l){return h.error("Erro ao buscar estatísticas do professor:",l),{data:null,error:l}}},Z=async i=>{try{const{data:l,error:s}=await B(i);if(s)throw s;const{data:m,error:c}=await d.from("classes").select(`
        *,
        class_members(count)
      `).eq("created_by",i).eq("is_active",!0).order("updated_at",{ascending:!1}).limit(5);if(c)throw c;const{data:u,error:f}=await d.from("activities").select(`
        *,
        activity_class_assignments(class:classes(name))
      `).eq("created_by",i).order("created_at",{ascending:!1}).limit(5);if(f)throw f;return{data:{stats:l,recentClasses:m||[],recentActivities:u||[]},error:null}}catch(l){return h.error("Erro ao buscar resumo do dashboard:",l),{data:null,error:l}}},ee=async(i,l)=>{try{const{data:s}=await d.from("profiles").select("preferences").eq("id",i).single(),c={...s?.preferences||{},...l,updated_at:new Date().toISOString()},{data:u,error:f}=await d.from("profiles").update({preferences:c}).eq("id",i).select().single();if(f)throw f;return{data:u,error:null}}catch(s){return h.error("Erro ao atualizar preferências:",s),{data:null,error:s}}},re=async(i,l)=>{try{const s=l.name.split(".").pop(),c=`avatars/${`${i}-${Date.now()}.${s}`}`,{error:u}=await d.storage.from("avatars").upload(c,l,{cacheControl:"3600",upsert:!0});if(u)throw u;const{data:f}=d.storage.from("avatars").getPublicUrl(c),j=f.publicUrl,{error:g}=await d.from("profiles").update({avatar_url:j}).eq("id",i);if(g)throw g;return{data:{avatar_url:j},error:null}}catch(s){return h.error("Erro ao fazer upload do avatar:",s),{data:null,error:s}}},$={getTeacherProfile:K,updateTeacherProfile:Q,getTeacherStats:B,getDashboardSummary:Z,updatePreferences:ee,uploadAvatar:re},we=()=>{const{user:i}=U(),[l,s]=v.useState(!0),[m,c]=v.useState(!1),[u,f]=v.useState("personal"),[j,g]=v.useState(!1),P=r=>{if(r=r.replace(/[^\d]/g,""),r.length!==11||/^(\d)\1{10}$/.test(r))return!1;let t=0;for(let o=0;o<9;o++)t+=parseInt(r.charAt(o))*(10-o);let a=11-t%11;if((a===10||a===11)&&(a=0),a!==parseInt(r.charAt(9)))return!1;t=0;for(let o=0;o<10;o++)t+=parseInt(r.charAt(o))*(11-o);return a=11-t%11,(a===10||a===11)&&(a=0),a===parseInt(r.charAt(10))},N=r=>r?(r=String(r).replace(/\D/g,""),r.length<=10?(r=r.replace(/(\d{2})(\d)/,"($1) $2"),r=r.replace(/(\d{4})(\d)/,"$1-$2")):(r=r.replace(/(\d{2})(\d)/,"($1) $2"),r=r.replace(/(\d{5})(\d)/,"$1-$2")),r):"",_=r=>r?(r=String(r).replace(/\D/g,""),r=r.replace(/(\d{3})(\d)/,"$1.$2"),r=r.replace(/(\d{3})(\d)/,"$1.$2"),r=r.replace(/(\d{3})(\d{1,2})$/,"$1-$2"),r):"",[n,x]=v.useState({full_name:"",email:"",phone:"",cpf:"",institution:""}),[b,y]=v.useState({notifications:{email:{newSubmissions:!0,studentsAlert:!0,upcomingEvents:!0,weeklyReport:!0,platform:!0},push:{newSubmissions:!0,todayEvents:!1,messages:!0},inApp:"all"},interface:{language:"pt-BR",theme:"light",fontSize:"medium"},regional:{timezone:"America/Sao_Paulo",dateFormat:"DD/MM/YYYY",timeFormat:"24h"},dashboard:{itemsPerPage:25,defaultClassOrder:"recent",showArchivedClasses:!1}});v.useEffect(()=>{i?.id&&w()},[i]);const w=async()=>{try{s(!0);const{data:r,error:t}=await $.getTeacherProfile(i.id);if(t)throw t;r&&(x({full_name:r.full_name||"",email:r.email||"",phone:N(r.phone||""),cpf:_(r.cpf||""),institution:r.institution||""}),r.preferences&&y(a=>({...a,...r.preferences})))}catch(r){h.error("Erro ao carregar perfil:",r),p({title:"Erro ao carregar perfil",description:"Não foi possível carregar seus dados.",variant:"destructive"})}finally{s(!1)}},E=async r=>{const t=r.target.files?.[0];if(t){if(!t.type.startsWith("image/")){p({title:"Arquivo inválido",description:"Por favor, selecione uma imagem.",variant:"destructive"});return}if(t.size>5*1024*1024){p({title:"Arquivo muito grande",description:"A imagem deve ter no máximo 5MB.",variant:"destructive"});return}try{g(!0);const{data:a,error:o}=await $.uploadAvatar(i.id,t);if(o)throw o;x(G=>({...G,avatar_url:a.avatar_url})),p({title:"Foto atualizada!",description:"Sua foto de perfil foi atualizada com sucesso."})}catch(a){h.error("Erro ao fazer upload:",a);const o=a.message?.includes("Bucket not found")?"Bucket de avatars não configurado. Entre em contato com o administrador.":"Não foi possível atualizar sua foto. Tente novamente.";p({title:"Erro ao fazer upload",description:o,variant:"destructive"})}finally{g(!1)}}},z=async()=>{if(!n.full_name.trim()){p({title:"Nome obrigatório",description:"Por favor, preencha seu nome completo.",variant:"destructive"});return}try{if(c(!0),n.cpf&&!P(n.cpf)){p({title:"CPF inválido",description:"Por favor, insira um CPF válido.",variant:"destructive"}),c(!1);return}const r=n.phone.replace(/\D/g,""),t=n.cpf.replace(/\D/g,""),a={};n.full_name?.trim()&&(a.full_name=n.full_name.trim()),r&&(a.phone=r),t&&(a.cpf=t),n.institution?.trim()&&(a.institution=n.institution.trim());const{error:o}=await $.updateTeacherProfile(i.id,a);if(o)throw o;p({title:"Perfil atualizado!",description:"Suas informações foram salvas com sucesso."})}catch(r){h.error("Erro ao salvar perfil:",r),p({title:"Erro ao salvar",description:"Não foi possível salvar suas alterações.",variant:"destructive"})}finally{c(!1)}},k=async()=>{try{c(!0);const{error:r}=await $.updatePreferences(i.id,b);if(r)throw r;p({title:"Preferências salvas!",description:"Suas configurações foram atualizadas."}),S(b.interface.theme)}catch(r){h.error("Erro ao salvar preferências:",r),p({title:"Erro ao salvar",description:"Não foi possível salvar suas preferências.",variant:"destructive"})}finally{c(!1)}},S=r=>{const t=document.documentElement;r==="dark"?t.classList.add("dark"):r==="light"?t.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?t.classList.add("dark"):t.classList.remove("dark")},D=[{id:"personal",label:"Dados Pessoais",icon:R},{id:"preferences",label:"Preferências",icon:Y},{id:"security",label:"Segurança",icon:F}];return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(C,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Meu Perfil"}),e.jsx("p",{className:"text-cyan-100",children:"Gerencie suas informações pessoais e preferências"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx(A,{className:"lg:col-span-1 p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 h-fit",children:e.jsx("div",{className:"space-y-2",children:D.map(r=>{const t=r.icon,a=u===r.id;return e.jsxs("button",{onClick:()=>f(r.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${a?"bg-blue-50 dark:bg-blue-950/30 text-blue-600 dark:text-blue-400 border-2 border-blue-600":"text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 border-2 border-transparent"}`,children:[e.jsx(t,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:r.label})]},r.id)})})}),e.jsxs("div",{className:"lg:col-span-3",children:[u==="personal"&&e.jsxs(A,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Dados Pessoais"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Foto de Perfil"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center text-white text-2xl font-bold overflow-hidden",children:n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:"Avatar",className:"w-full h-full object-cover"}):n.full_name?.[0]||"P"}),j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full",children:e.jsx(C,{size:"sm"})})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:E,className:"hidden",disabled:j}),e.jsxs("label",{htmlFor:"avatar-upload",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg cursor-pointer transition-colors",children:[e.jsx(X,{className:"w-4 h-4"}),"Alterar Foto"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"JPG, PNG ou GIF. Máximo 5MB."})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white",children:"Informações Básicas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:n.full_name,onChange:r=>x(t=>({...t,full_name:r.target.value})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Seu nome completo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:n.email,readOnly:!0,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg bg-slate-100 dark:bg-slate-800 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Telefone"}),e.jsx("input",{type:"tel",value:n.phone,onChange:r=>x(t=>({...t,phone:N(r.target.value)})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:n.cpf,onChange:r=>x(t=>({...t,cpf:_(r.target.value)})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"000.000.000-00"})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white",children:"Informações Profissionais"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Instituição"}),e.jsx("input",{type:"text",value:n.institution,onChange:r=>x(t=>({...t,institution:r.target.value})),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"Nome da escola/universidade"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsx(q,{onClick:z,disabled:m,className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:m?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:"sm",className:"mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Salvar Alterações"]})}),e.jsxs(q,{variant:"outline",onClick:w,disabled:m,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Cancelar"]})]})]}),u==="preferences"&&e.jsxs(A,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Preferências"}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Notificações por Email"]}),e.jsx("div",{className:"space-y-3",children:Object.entries({newSubmissions:"Novas submissões de alunos",studentsAlert:"Alunos em alerta",upcomingEvents:"Lembrete de eventos próximos",weeklyReport:"Resumo semanal de atividades",platform:"Comunicados da plataforma"}).map(([r,t])=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.notifications.email[r],onChange:a=>y(o=>({...o,notifications:{...o.notifications,email:{...o.notifications.email,[r]:a.target.checked}}})),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:t})]},r))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"font-semibold text-lg text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[b.interface.theme==="dark"?e.jsx(M,{className:"w-5 h-5"}):e.jsx(T,{className:"w-5 h-5"}),"Interface"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Tema Visual"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Claro",icon:T},{value:"dark",label:"Escuro",icon:M},{value:"auto",label:"Automático",icon:J}].map(({value:r,label:t,icon:a})=>e.jsxs("button",{onClick:()=>y(o=>({...o,interface:{...o.interface,theme:r}})),className:`flex-1 flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${b.interface.theme===r?"border-blue-600 bg-blue-50 dark:bg-blue-950/30":"border-slate-200 dark:border-slate-700 hover:border-blue-300"}`,children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:t})]},r))})]})})]}),e.jsx("div",{className:"flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-800",children:e.jsx(q,{onClick:k,disabled:m,className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:m?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:"sm",className:"mr-2"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Salvar Preferências"]})})})]}),u==="security"&&e.jsxs(A,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-slate-900 dark:text-white",children:"Segurança"}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"w-16 h-16 mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Funcionalidades de segurança em breve."})]})]})]})]})]})};export{we as default};
