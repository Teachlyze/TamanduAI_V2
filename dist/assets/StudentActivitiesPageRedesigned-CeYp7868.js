import{a as de,u as me,r,s as o,l as N,j as e,q as ue}from"./main-BSMlxxlZ.js";import{C as B}from"./card-DMraIbJz.js";import{A as R}from"./ActivityCard-C7t1TV7f.js";import{E as pe}from"./EmptyState-BSYIwJt2.js";import{m as $,B as fe}from"./button-CKV5JkoH.js";import"./dialog-DORbdWMS.js";import{I as ge}from"./input-D5v1eFNU.js";import{T as he,a as xe,b as w}from"./tabs-COryJLg7.js";import{S as z,a as O,b as P,c as U,d as m}from"./select-Y5bYU8BP.js";import{F as G}from"./file-text-BP6UKDNn.js";import{C as ve}from"./clock-2llRiqNt.js";import{C as Q}from"./circle-check-CNIrcWjw.js";import{T as be}from"./triangle-alert-Cvx9xFec.js";import{S as H}from"./search-CrNNaOb7.js";import{F as je}from"./funnel-x-XGGCQHlB.js";import{d as _e}from"./differenceInHours-DzWJNcba.js";import"./SidebarPremium-Bf98hnme.js";import"./bell-C38I9ebQ.js";import"./chevron-right-D_FKfY1S.js";import"./trending-up-6aD5U3kC.js";import"./user-C2we2FXy.js";import"./settings-Ce4vc5Vl.js";import"./house-BiazGQzC.js";import"./users-BNOTPuIE.js";import"./graduation-cap-CzbYlLlS.js";import"./index-CpTBUXYw.js";import"./chart-column-CNsjJ5jU.js";import"./x-rSiybgWV.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-B6HbAA6N.js";import"./formatDistanceToNow-CMbiJYtj.js";import"./constructNow-re94FRT2.js";import"./differenceInCalendarMonths-FFYroMBa.js";import"./endOfDay-mJ-5sjFp.js";import"./endOfMonth-BD-g1yyK.js";import"./circle-alert-EA2lUZox.js";import"./target-BWVM_5Ui.js";import"./format-BcFT9btV.js";import"./pt-BR-CuGSKEGQ.js";import"./index-DrqYlGSU.js";import"./index-Cwkg_cGm.js";import"./index-BwDK55Mp.js";import"./index-CB9Ufca0.js";import"./index-CtuxL-Fj.js";import"./chevron-down-Bk5F_mLz.js";import"./check-iGKxEgx2.js";import"./chevron-up-C0F5446Y.js";const gs=()=>{const{user:c}=de(),g=me(),[W,y]=r.useState(!0),[A,k]=r.useState([]),[u,X]=r.useState([]),[l,J]=r.useState("all"),[h,K]=r.useState(""),[x,Y]=r.useState("all"),[v,Z]=r.useState("all"),[b,ee]=r.useState(!1),[se,te]=r.useState([]),[j,ae]=r.useState({total:0,pending:0,completed:0,late:0,urgent:0});r.useEffect(()=>{c?.id&&(re(),ie())},[c]),r.useEffect(()=>{le()},[A,l,h,x,v,b]);const ie=async()=>{try{const{data:s}=await o.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),t=s?.map(f=>f.class_id)||[],{data:i}=await o.from("classes").select("id, name, subject").in("id",t);te(i||[])}catch(s){N.error("Erro ao carregar turmas:",s)}},re=async()=>{try{y(!0);const{data:s}=await o.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),t=s?.map(a=>a.class_id)||[];if(t.length===0){k([]),y(!1);return}const{data:i}=await o.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",t),f=i?.map(a=>a.activity_id).filter(Boolean)||[],{data:ne}=await o.from("activities").select("id, title, description, type, due_date, max_score, created_at").in("id",f),{data:oe}=await o.from("classes").select("id, name, subject, color").in("id",t),S={};ne?.forEach(a=>{S[a.id]=a});const q={};oe?.forEach(a=>{q[a.id]=a});const{data:C,error:I}=await o.from("submissions").select("activity_id, status, grade, feedback, submitted_at").eq("student_id",c.id).in("activity_id",f);I&&N.error("Erro ao buscar submissÃµes:",I),N.debug("[Activities] SubmissÃµes encontradas:",{userId:c.id,totalActivities:f.length,submissions:C?.length||0,submissionsData:C});const L={};C?.forEach(a=>{L[a.activity_id]=a});const d=(i||[]).filter(a=>S[a.activity_id]).map(a=>{const D=S[a.activity_id],T=q[a.class_id],n=L[a.activity_id],V=new Date(D.due_date),F=new Date,M=_e(V,F);let _="pending";return n?_=n.status==="graded"?"completed":"submitted":V<F&&(_="late"),{...D,class_id:a.class_id,class_name:T?.name,class_subject:T?.subject,class_color:T?.color,status:_,submission:n||null,hasSubmission:!!n,grade:n?.grade,feedback:n?.feedback,submitted_at:n?.submitted_at,assigned_at:a.assigned_at,is_urgent:M<=24&&M>=0&&_==="pending"}}),ce={total:d.length,pending:d.filter(a=>a.status==="pending").length,completed:d.filter(a=>a.status==="completed"||a.status==="submitted").length,late:d.filter(a=>a.status==="late").length,urgent:d.filter(a=>a.is_urgent).length};ae(ce),k(d)}catch(s){N.error("Erro ao carregar atividades:",s)}finally{y(!1)}},le=()=>{let s=[...A];if(l==="pending"?s=s.filter(t=>t.status==="pending"||t.status==="late"):l==="completed"?s=s.filter(t=>t.status==="completed"||t.status==="submitted"):l==="late"&&(s=s.filter(t=>t.status==="late")),b&&(s=s.filter(t=>t.status==="pending")),h){const t=h.toLowerCase();s=s.filter(i=>i.title?.toLowerCase().includes(t)||i.description?.toLowerCase().includes(t)||i.class_name?.toLowerCase().includes(t))}x!=="all"&&(s=s.filter(t=>t.class_id===x)),v!=="all"&&(s=s.filter(t=>t.type===v)),s.sort((t,i)=>t.status==="late"&&i.status!=="late"?-1:t.status!=="late"&&i.status==="late"?1:t.is_urgent&&!i.is_urgent?-1:!t.is_urgent&&i.is_urgent?1:new Date(t.due_date)-new Date(i.due_date)),X(s)},p=u.filter(s=>s.is_urgent),E=u.filter(s=>!s.is_urgent);return W?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ue,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs($.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(G,{className:"w-8 h-8 text-blue-600"}),"Minhas Atividades"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Gerencie suas atividades e acompanhe seu progresso"})]}),e.jsx(B,{className:"p-6 mb-8",children:e.jsxs(he,{value:l,onValueChange:J,children:[e.jsxs(xe,{className:"grid grid-cols-4 w-full mb-6",children:[e.jsxs(w,{value:"all",className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Todas",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-slate-200 dark:bg-slate-700 rounded-full text-xs",children:j.total})]}),e.jsxs(w,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Pendentes",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-orange-200 dark:bg-orange-900 rounded-full text-xs",children:j.pending})]}),e.jsxs(w,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"ConcluÃ­das",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-green-200 dark:bg-green-900 rounded-full text-xs",children:j.completed})]}),e.jsxs(w,{value:"late",className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Atrasadas",e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-red-200 dark:bg-red-900 rounded-full text-xs",children:j.late})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(ge,{placeholder:"Buscar atividades...",value:h,onChange:s=>K(s.target.value),className:"pl-10"})]})}),e.jsxs(z,{value:x,onValueChange:Y,children:[e.jsx(O,{className:"w-full md:w-48",children:e.jsx(P,{placeholder:"Todas as turmas"})}),e.jsxs(U,{children:[e.jsx(m,{value:"all",children:"Todas as turmas"}),se.map(s=>e.jsx(m,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(z,{value:v,onValueChange:Z,children:[e.jsx(O,{className:"w-full md:w-48",children:e.jsx(P,{placeholder:"Todos os tipos"})}),e.jsxs(U,{children:[e.jsx(m,{value:"all",children:"Todos os tipos"}),e.jsx(m,{value:"objective",children:"ğŸ“ Objetiva"}),e.jsx(m,{value:"open",children:"âœï¸ Aberta"}),e.jsx(m,{value:"mixed",children:"ğŸ¯ Mista"})]})]}),e.jsxs(fe,{variant:b?"default":"outline",onClick:()=>ee(!b),className:"w-full md:w-auto",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"NÃ£o Respondidas"]})]})]})}),p.length>0&&e.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"mb-8",children:e.jsxs(B,{className:"p-6 border-2 border-orange-500 bg-orange-50/50 dark:bg-orange-950/20",children:[e.jsx("h2",{className:"text-xl font-bold text-orange-900 dark:text-orange-100 mb-4 flex items-center gap-2",children:"ğŸ”¥ URGENTE - Prazo nas prÃ³ximas 24 horas!"}),e.jsx("div",{className:"space-y-4",children:p.map((s,t)=>e.jsx(R,{activity:s,onStart:()=>g(`/students/activities/${s.id}`),onView:()=>g(`/students/activities/${s.id}`),index:t},s.id))})]})}),E.length>0?e.jsx("div",{className:"space-y-4",children:E.map((s,t)=>e.jsx(R,{activity:s,onStart:()=>g(`/students/activities/${s.id}`),onView:()=>g(`/students/activities/${s.id}`),index:t},s.id))}):e.jsx(pe,{icon:u.length===0&&p.length===0?Q:H,title:u.length===0&&p.length===0?l==="completed"?"Nenhuma atividade concluÃ­da":"Nenhuma atividade":"Nenhum resultado encontrado",description:u.length===0&&p.length===0?l==="completed"?"Comece a fazer suas atividades para vÃª-las aqui quando concluÃ­das.":"VocÃª nÃ£o tem atividades nesta categoria no momento.":"Tente ajustar os filtros de busca para encontrar o que procura.",variant:l==="completed"?"success":"default"})]})};export{gs as default};
