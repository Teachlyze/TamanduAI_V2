import{s as h,l as x,a as ie,r as T,j as e,m as oe}from"./main-KTzSHcut.js";import{C as L}from"./card-D1C_XPb6.js";import{A as ce,B as V}from"./SidebarPremium-Bjey2152.js";import{m as B,B as de}from"./button-Ch10pVNC.js";import{P as le}from"./progress-CLM8R6un.js";import{S as W}from"./StatsCard-yPiQuGWm.js";import"./DashboardHeader-CqV_snk3.js";import"./input-CKizEs14.js";import"./dropdown-menu-CFKsTZzS.js";import"./label-BhBBP-Nu.js";import{t as O}from"./use-toast-Dl4X8ZMv.js";import{T as Z}from"./target-CQ0DvT5W.js";import{B as H}from"./book-open-dxp_3U19.js";import{C as me}from"./chart-column-BJvjjOHx.js";import{T as ue}from"./trending-up-BsXLUj7W.js";import{ag as ge,ai as he,aj as pe,ak as fe,ah as xe}from"./CartesianChart-CTXdyj8n.js";import{L as be,a as ve}from"./LineChart-BmfyEwuJ.js";import{U as ye}from"./users-BaZp6eLM.js";import{L as je}from"./lightbulb-ChND6e8V.js";import{T as we}from"./triangle-alert-CVkDYYk3.js";import{T as _e}from"./trending-down-CdNlKZSN.js";import{T as Ne}from"./trophy-BYtAtU4H.js";import{S as Y}from"./sparkles-C6kQgySZ.js";import"./bell-B4NUN7bW.js";import"./user-CWyOXzMq.js";import"./file-text-DYnGBvGu.js";import"./settings-BYjJE2lM.js";import"./graduation-cap-ArnOenSA.js";import"./index-Bp0dZcFm.js";import"./x-ZCLeMxGr.js";import"./index-sBzZX1-K.js";import"./chevron-right-DlLEuI3N.js";import"./index-BpWMJgsg.js";import"./Combination-CGrYuS6N.js";import"./index-BMHZaHkZ.js";import"./check-GWOQjZuW.js";import"./index-wM7q3PNH.js";const Se=async(i,a)=>{try{const{data:n,error:s}=await h.from("submissions").select(`
        grade,
        submitted_at,
        activities!inner(class_id)
      `).eq("student_id",i).eq("activities.class_id",a).not("grade","is",null).order("submitted_at",{ascending:!0});if(s)throw s;if(!n||n.length<3)return{prediction:null,confidence:0,trend:"insufficient_data",message:"M√≠nimo 3 atividades necess√°rias"};const t=n.map(v=>parseFloat(v.grade)),r=t.length,o=t.slice(-5),l=o.reduce((v,A)=>v+A,0)/o.length,g=t.reduce((v,A)=>v+A,0)/r,u=l>g+5?"improving":l<g-5?"declining":"stable",b=[.1,.15,.2,.25,.3];let C=0;const p=t.slice(-5);for(let v=0;v<p.length;v++)C+=p[v]*(b[v]||.2);const f=t.reduce((v,A)=>v+Math.pow(A-g,2),0)/r,k=Math.sqrt(f),N=Math.max(0,Math.min(100,100-k*2));return{prediction:Math.round(C*10)/10,confidence:Math.round(N),trend:u,avgRecent:Math.round(l*10)/10,avgTotal:Math.round(g*10)/10,totalSubmissions:r,message:u==="improving"?"Aluno em evolu√ß√£o!":u==="declining"?"Aten√ß√£o: queda de desempenho":"Desempenho est√°vel"}}catch(n){return x.error("Erro ao prever desempenho:",n),null}},Ae=async i=>{try{const{data:a,error:n}=await h.from("class_members").select(`
        user_id,
        role,
        profiles:user_id(full_name, email)
      `).eq("class_id",i).eq("role","student");if(n)throw n;const s=[];for(const t of a){const{data:r}=await h.from("submissions").select("grade, submitted_at, status").eq("student_id",t.user_id).order("submitted_at",{ascending:!1}).limit(10);if(!r||r.length===0)continue;const o=r.filter(N=>N.grade!==null).map(N=>parseFloat(N.grade));if(o.length===0)continue;const l=o.reduce((N,v)=>N+v,0)/o.length,g=o.slice(0,3),u=g.reduce((N,v)=>N+v,0)/g.length,b=l<60,C=u<l-10,p=Math.max(...o)-Math.min(...o)>40;let f=0;const k=[];b&&(f+=3,k.push("M√©dia baixa")),C&&(f+=2,k.push("Queda recente")),p&&(f+=1,k.push("Inconsistente")),f>0&&s.push({studentId:t.user_id,name:t.profiles?.full_name,email:t.profiles?.email,avgGrade:Math.round(l*10)/10,avgRecent:Math.round(u*10)/10,riskLevel:f>=4?"high":f>=2?"medium":"low",reasons:k,totalSubmissions:r.length})}return s.sort((t,r)=>{const o={high:3,medium:2,low:1};return o[r.riskLevel]-o[t.riskLevel]})}catch(a){return x.error("Erro ao identificar alunos em risco:",a),[]}},ke=async i=>{try{const{data:a}=await h.from("class_members").select(`
        student_id,
        profiles!inner(full_name)
      `).eq("class_id",i);if(!a||a.length<3)return{clusters:[],message:"M√≠nimo 3 alunos necess√°rios"};const n=[];for(const t of a){const{data:r}=await h.from("submissions").select("grade, submitted_at").eq("student_id",t.student_id).not("grade","is",null);if(!r||r.length===0)continue;const o=r.map(u=>parseFloat(u.grade)),l=o.reduce((u,b)=>u+b,0)/o.length,g=o.reduce((u,b)=>u+Math.pow(b-l,2),0)/o.length;n.push({studentId:t.student_id,name:t.profiles.full_name,avgGrade:l,consistency:100-Math.sqrt(g),totalSubmissions:r.length})}const s={excelente:n.filter(t=>t.avgGrade>=85),bom:n.filter(t=>t.avgGrade>=70&&t.avgGrade<85),regular:n.filter(t=>t.avgGrade>=60&&t.avgGrade<70),atencao:n.filter(t=>t.avgGrade<60)};return{clusters:[{name:"Excelente",color:"green",students:s.excelente,avgGrade:s.excelente.length>0?Math.round(s.excelente.reduce((t,r)=>t+r.avgGrade,0)/s.excelente.length*10)/10:0,count:s.excelente.length},{name:"Bom",color:"blue",students:s.bom,avgGrade:s.bom.length>0?Math.round(s.bom.reduce((t,r)=>t+r.avgGrade,0)/s.bom.length*10)/10:0,count:s.bom.length},{name:"Regular",color:"yellow",students:s.regular,avgGrade:s.regular.length>0?Math.round(s.regular.reduce((t,r)=>t+r.avgGrade,0)/s.regular.length*10)/10:0,count:s.regular.length},{name:"Aten√ß√£o",color:"red",students:s.atencao,avgGrade:s.atencao.length>0?Math.round(s.atencao.reduce((t,r)=>t+r.avgGrade,0)/s.atencao.length*10)/10:0,count:s.atencao.length}],totalStudents:n.length}}catch(a){return x.error("Erro ao clusterizar alunos:",a),{clusters:[],message:"Erro ao processar"}}},Ge=i=>{if(!i)return{score:0,label:"neutral"};const a=i.toLowerCase(),n=["ruim","dif√≠cil","complicado","confuso","p√©ssimo","horr√≠vel","n√£o entendi","muito dif√≠cil","imposs√≠vel","frustrado"],s=["bom","√≥timo","excelente","legal","entendi","f√°cil","claro","adorei","perfeito","incr√≠vel"];let t=0;return n.forEach(r=>{a.includes(r)&&(t-=1)}),s.forEach(r=>{a.includes(r)&&(t+=1)}),{score:t,label:t<-1?"negative":t>1?"positive":"neutral",needsAttention:t<-1}},Ce=async(i,a)=>{try{const{data:n}=await h.from("submissions").select(`
        grade,
        activities!inner(
          title,
          activity_type,
          class_id
        )
      `).eq("student_id",i).eq("activities.class_id",a).not("grade","is",null);if(!n||n.length<3)return{recommendations:[],message:"Mais atividades necess√°rias para recomenda√ß√µes"};const s=n.filter(o=>parseFloat(o.grade)<70).map(o=>o.activities),t=[];return s.length>0&&t.push({type:"review",priority:"high",title:"Revis√£o Necess√°ria",description:`Revisar conceitos de ${s.length} atividade(s) com baixo desempenho`,activities:s.slice(0,3)}),n.filter(o=>o.activities.activity_type==="quiz").length<3&&t.push({type:"practice",priority:"medium",title:"Pr√°tica com Quizzes",description:"Fazer mais quizzes para fixar conte√∫do",suggestion:"Banco de Quest√µes dispon√≠vel"}),{recommendations:t,totalAnalyzed:n.length,weakAreas:s.length}}catch(n){return x.error("Erro ao gerar recomenda√ß√µes:",n),{recommendations:[],message:"Erro ao processar"}}},Te=async i=>{try{const{data:a}=await h.from("class_members").select(`
        student_id,
        joined_at,
        profiles!inner(full_name, email)
      `).eq("class_id",i);if(!a)return[];const n=[],s=new Date;for(const t of a){const{data:r}=await h.from("submissions").select("submitted_at").eq("student_id",t.student_id).order("submitted_at",{ascending:!1}).limit(1).single();if(!r){n.push({studentId:t.student_id,name:t.profiles.full_name,email:t.profiles.email,riskLevel:"high",reason:"Nenhuma atividade realizada",daysSinceActivity:Math.floor((s-new Date(t.joined_at))/(1e3*60*60*24))});continue}const o=Math.floor((s-new Date(r.submitted_at))/(1e3*60*60*24));o>14&&n.push({studentId:t.student_id,name:t.profiles.full_name,email:t.profiles.email,riskLevel:o>30?"high":"medium",reason:`${o} dias sem atividade`,daysSinceActivity:o})}return n.sort((t,r)=>r.daysSinceActivity-t.daysSinceActivity)}catch(a){return x.error("Erro ao prever churn:",a),[]}},K=async i=>{try{const{data:a}=await h.from("submissions").select(`
        grade,
        submitted_at,
        student_id,
        activities!inner(class_id, activity_type)
      `).eq("activities.class_id",i).not("grade","is",null);if(!a||a.length===0)return null;const{data:n}=await h.from("xp_log").select("amount, source, student_id, created_at").in("student_id",[...new Set(a.map(d=>d.student_id))]),s=a.map(d=>parseFloat(d.grade)),t=s.reduce((d,y)=>d+y,0)/s.length,r=s.reduce((d,y)=>d+Math.pow(y-t,2),0)/s.length,o=Math.sqrt(r),l=n?.reduce((d,y)=>d+y.amount,0)||0,g={};n?.forEach(d=>{g[d.source]=(g[d.source]||0)+d.amount});const u=new Date,b=new Date(u.getTime()-672*60*60*1e3),p=a.filter(d=>new Date(d.submitted_at)>b).map(d=>parseFloat(d.grade)),f=p.length>0?p.reduce((d,y)=>d+y,0)/p.length:t,k=f>t+3?"improving":f<t-3?"declining":"stable",N=Math.min(5,l/1e3),v=t*.9+N*.1,A={"0-49":0,"50-69":0,"70-84":0,"85-100":0};s.forEach(d=>{const y=Math.round(d);y<=49?A["0-49"]++:y<=69?A["50-69"]++:y<=84?A["70-84"]++:A["85-100"]++});const z=a.slice().sort((d,y)=>new Date(d.submitted_at)-new Date(y.submitted_at));let $=0,F=0;for(let d=1;d<z.length;d++){const y=(new Date(z[d].submitted_at)-new Date(z[d-1].submitted_at))/864e5;isFinite(y)&&y>=0&&($+=y,F++)}const I=F>0?Math.round($/F*10)/10:null,D={};a.forEach(d=>{D[d.student_id]=(D[d.student_id]||0)+1});const U=Object.keys(D).length>0?Math.round(Object.values(D).reduce((d,y)=>d+y,0)/Object.keys(D).length*10)/10:0;return{avgGrade:Math.round(t*10)/10,adjustedAvg:Math.round(v*10)/10,stdDev:Math.round(o*10)/10,trend:k,totalSubmissions:a.length,totalStudents:new Set(a.map(d=>d.student_id)).size,totalXP:l,xpSources:g,gradeBuckets:A,avgDaysBetweenSubmissions:I,submissionsPerStudentAvg:U,consistency:o<15?"high":o<25?"medium":"low",engagement:l>5e3?"high":l>2e3?"medium":"low"}}catch(a){return x.error("Erro ao analisar turma:",a),null}},te=async i=>{try{const{data:a}=await h.from("classes").select("id, name").eq("created_by",i);if(!a||a.length===0)return null;const n=[];let s=0,t=0,r=0,o=0,l=0;for(const u of a){const b=await K(u.id);b&&(n.push({classId:u.id,className:u.name,...b}),s+=b.totalStudents,r+=b.totalSubmissions,o+=b.totalXP,l+=b.avgGrade);const{count:C}=await h.from("activities").select("*",{count:"exact",head:!0}).eq("class_id",u.id);t+=C||0}const g=n.length>0?l/n.length:0;return{teacherId:i,totalClasses:a.length,totalStudents:s,totalActivities:t,totalSubmissions:r,totalXP:o,avgGrade:Math.round(g*10)/10,classAnalyses:n,engagementScore:o/s||0,activityRate:t/a.length||0}}catch(a){return x.error("Erro ao analisar professor:",a),null}},Me=async i=>{try{const{data:a}=await h.from("school_teachers").select("user_id, status").eq("school_id",i).eq("status","active");if(!a||a.length===0)return[];const n=a.map(t=>t.user_id),s=[];for(const t of n){const{data:r}=await h.from("profiles").select("name").eq("id",t).single(),o=await te(t);o&&r&&s.push({teacherId:t,name:r.name,...o})}return s.sort((t,r)=>r.avgGrade-t.avgGrade)}catch(a){return x.error("Erro ao comparar professores:",a),[]}},qe=async i=>{try{const{data:a}=await h.from("school_classes").select("class_id").eq("school_id",i),n=(a||[]).map(l=>l.class_id);if(!n||n.length===0)return[];const{data:s}=await h.from("classes").select("id, name, created_by").in("id",n),t=[...new Set((s||[]).map(l=>l.created_by).filter(Boolean))];let r={};if(t.length>0){const{data:l}=await h.from("profiles").select("id, name").in("id",t);r=(l||[]).reduce((g,u)=>(g[u.id]=u.name,g),{})}const o=[];for(const l of s||[]){const g=await K(l.id);g&&o.push({classId:l.id,className:l.name,teacherName:r[l.created_by]||"Professor",...g})}return o.sort((l,g)=>g.avgGrade-l.avgGrade)}catch(a){return x.error("Erro ao comparar turmas:",a),[]}},Ee=async(i,a="student")=>{try{const{data:{user:n}}=await h.auth.getUser();if(!n)throw new Error("N√£o autenticado");let s="";if(a==="student")s=`Analise este aluno e forne√ßa insights educacionais:
      
Dados:
- M√©dia: ${i.avgGrade}
- Tend√™ncia: ${i.trend}
- Total XP: ${i.totalXP||0}
- Submiss√µes: ${i.totalSubmissions}
- Consist√™ncia: ${i.consistency||"N/A"}
 - Observa√ß√£o: XP tem peso menor (10%) em an√°lises de desempenho.

Forne√ßa em JSON:
{
  "strengths": ["for√ßa 1", "for√ßa 2"],
  "weaknesses": ["fraqueza 1", "fraqueza 2"],
  "recommendations": ["recomenda√ß√£o 1", "recomenda√ß√£o 2"],
  "motivationalMessage": "mensagem motivacional"
}`;else if(a==="class")s=`Analise esta turma e forne√ßa insights educacionais:
      
Dados:
- M√©dia: ${i.avgGrade}
- Desvio Padr√£o: ${i.stdDev}
- Tend√™ncia: ${i.trend}
- Total XP: ${i.totalXP}
- Alunos: ${i.totalStudents}
- Engajamento: ${i.engagement}
 - Fontes de XP (top 5): ${JSON.stringify(i.xpSources||{})}
 - Observa√ß√£o: XP tem peso reduzido (10%) para m√©dia ajustada.
 - Distribui√ß√£o de notas: ${JSON.stringify(i.gradeBuckets||{})}
 - Dias m√©dios entre submiss√µes: ${i.avgDaysBetweenSubmissions??"N/D"}
 - Submiss√µes por aluno (m√©dia): ${i.submissionsPerStudentAvg??"N/D"}

Forne√ßa em JSON:
{
  "strengths": ["for√ßa 1", "for√ßa 2"],
  "concerns": ["preocupa√ß√£o 1", "preocupa√ß√£o 2"],
  "recommendations": ["recomenda√ß√£o 1", "recomenda√ß√£o 2"],
  "teachingTips": ["dica 1", "dica 2"]
}`;else if(a==="teacher"){const l=i.totalClasses??(i.classAnalyses?.length||0),g=(i.classAnalyses||[]).reduce((p,f)=>(p[f.trend||"stable"]=(p[f.trend||"stable"]||0)+1,p),{}),u=(i.classAnalyses||[]).slice().sort((p,f)=>(f.avgGrade||0)-(p.avgGrade||0))[0]||null,b=(i.classAnalyses||[]).slice().sort((p,f)=>(p.avgGrade||0)-(f.avgGrade||0))[0]||null,C=(i.classAnalyses||[]).reduce((p,f)=>{const k=f.xpSources||{};return Object.keys(k).forEach(N=>{p[N]=(p[N]||0)+k[N]}),p},{});s=`Analise este professor e forne√ßa insights:
      
Dados:
- Turmas: ${i.totalClasses}
- Alunos: ${i.totalStudents}
- M√©dia Geral: ${i.avgGrade}
- Total XP gerado: ${i.totalXP}
- Taxa de atividades: ${i.activityRate}
 - Tend√™ncias por turma: ${JSON.stringify(g)}
 - Turma com melhor desempenho: ${u?`${u.className} (m√©dia ${u.avgGrade}, engajamento ${u.engagement})`:"N/D"}
 - Turma com pior desempenho: ${b?`${b.className} (m√©dia ${b.avgGrade}, engajamento ${b.engagement})`:"N/D"}
 - Fontes de XP agregadas (top 5): ${JSON.stringify(Object.fromEntries(Object.entries(C).sort((p,f)=>f[1]-p[1]).slice(0,5)))}
 - Observa√ß√£o: XP influencia apenas 10% da m√©dia ajustada.

Forne√ßa em JSON:
{
  "strengths": ["for√ßa 1", "for√ßa 2"],
  "improvements": ["melhoria 1", "melhoria 2"],
  "recommendations": ["recomenda√ß√£o 1", "recomenda√ß√£o 2"],
  "recognition": "mensagem de reconhecimento"
}`}const{data:t,error:r}=await h.functions.invoke("openai-chat",{body:{messages:[{role:"system",content:"Voc√™ √© um especialista em an√°lise educacional. Responda APENAS em JSON v√°lido."},{role:"user",content:s}],temperature:.7}});if(r)throw r;const o=t.choices?.[0]?.message?.content||"{}";return JSON.parse(o)}catch(n){return x.error("Erro ao gerar insights AI:",n),null}},$e=async i=>{try{const{data:a}=await h.from("submissions").select("grade, activity:activities(title, type)").eq("student_id",i).not("grade","is",null).order("submitted_at",{ascending:!1}).limit(10);if(!a||a.length===0)return[];const n=a.reduce((t,r)=>t+r.grade,0)/a.length,s=[];return n<6?(s.push({text:"Revise os conceitos fundamentais da disciplina",icon:"BookOpen"}),s.push({text:"Procure ajuda do professor ou monitoria",icon:"Users"})):n<7.5?(s.push({text:"Pratique mais exerc√≠cios para fixar o conte√∫do",icon:"Target"}),s.push({text:"Fa√ßa resumos dos t√≥picos principais",icon:"FileText"})):(s.push({text:"Continue seu excelente trabalho!",icon:"Trophy"}),s.push({text:"Ajude colegas que t√™m dificuldades",icon:"Users"})),s}catch(a){return x.error("Erro ao obter sugest√µes:",a),[{text:"Continue praticando regularmente",icon:"Target"},{text:"Revise conceitos fundamentais",icon:"BookOpen"}]}},Ie=async i=>{try{const{data:a}=await h.from("submissions").select(`
        grade,
        activity:activities(
          title,
          activity_class_assignments(
            class:classes(name, subject)
          )
        )
      `).eq("student_id",i).not("grade","is",null);if(!a||a.length===0)return[];const n={};a.forEach(t=>{const r=t.activity?.activity_class_assignments?.[0]?.class?.subject||"Geral";n[r]||(n[r]=[]),n[r].push(t.grade)});const s=[];return Object.entries(n).forEach(([t,r])=>{const o=r.reduce((l,g)=>l+g,0)/r.length;o<7&&s.push({subject:t,title:t,description:`M√©dia atual: ${o.toFixed(1)}. Foque mais nesta disciplina.`,avgGrade:o})}),s}catch(a){return x.error("Erro ao identificar √°reas de aten√ß√£o:",a),[]}},ee={predictPerformance:Se,identifyAtRiskStudents:Ae,clusterStudents:ke,analyzeSentiment:Ge,generateRecommendations:Ce,predictChurn:Te,analyzeClassPerformance:K,analyzeTeacherPerformance:te,compareTeachers:Me,compareClasses:qe,generateAIInsights:Ee,getStudentGradeBuckets:De,getStudySuggestions:$e,getAttentionAreas:Ie};async function De(i,a){try{const{data:n,error:s}=await h.from("submissions").select("grade, activities!inner(class_id)").eq("student_id",i).eq("activities.class_id",a).not("grade","is",null);if(s)throw s;const t={"0-49":0,"50-69":0,"70-84":0,"85-100":0};return(n||[]).forEach(r=>{const o=Math.round(parseFloat(r.grade));o<=49?t["0-49"]++:o<=69?t["50-69"]++:o<=84?t["70-84"]++:t["85-100"]++}),t}catch(n){return x.error("Erro ao calcular buckets do aluno:",n),{"0-49":0,"50-69":0,"70-84":0,"85-100":0}}}const yt=()=>{const{user:i}=ie(),[a,n]=T.useState(!0),[s,t]=T.useState(!1),[r,o]=T.useState({avgGrade:0,totalActivities:0,completionRate:0}),[l,g]=T.useState([]),[u,b]=T.useState([]),[C,p]=T.useState([]),[f,k]=T.useState([]),[N,v]=T.useState([]),[A,z]=T.useState(null),[$,F]=T.useState(0),[I]=T.useState(3);T.useEffect(()=>{i?.id?(D(),d()):n(!1)},[i]);const D=async()=>{if(!i?.id){n(!1);return}try{n(!0);const{data:c}=await h.from("submissions").select(`
          grade,
          submitted_at,
          graded_at,
          activity:activities(
            id,
            title,
            max_score,
            activity_class_assignments(
              class_id,
              class:classes(id, name, subject)
            )
          )
        `).eq("student_id",i.id).order("submitted_at",{ascending:!0}),m=c?.filter(w=>w.grade!==null)||[],M=m.length>0?m.reduce((w,G)=>w+G.grade,0)/m.length:0;o({avgGrade:M.toFixed(1),totalActivities:c?.length||0,completionRate:85});const _=m.slice(-10).map((w,G)=>({name:`A${G+1}`,nota:Number(w.grade.toFixed(1)),date:w.submitted_at}));g(_),await U(c),z(c)}catch(c){x.error("Erro:",c)}finally{n(!1)}},U=async c=>{try{const m={};c.forEach(_=>{const w=_.activity?.activity_class_assignments?.[0]?.class;w&&(m[w.id]||(m[w.id]={classId:w.id,className:w.name,subject:w.subject,studentGrades:[],activityIds:[]}),m[w.id].studentGrades.push(_.grade),m[w.id].activityIds.push(_.activity.id))});const M=await Promise.all(Object.values(m).map(async _=>{const{data:w}=await h.from("submissions").select("grade, activity_id").in("activity_id",_.activityIds).not("grade","is",null),G=w?.map(j=>j.grade)||[],q=G.length>0?G.reduce((j,E)=>j+E,0)/G.length:0,J=_.studentGrades.reduce((j,E)=>j+E,0)/_.studentGrades.length;return{className:_.className,subject:_.subject,studentAvg:Number(J.toFixed(1)),classAvg:Number(q.toFixed(1)),difference:Number((J-q).toFixed(1))}}));b(M)}catch(m){x.error("Erro ao calcular compara√ß√£o:",m)}},d=async()=>{try{const c=await ee.getStudySuggestions(i.id),m=await ee.getAttentionAreas(i.id);p(c||[]),k(m||[])}catch(c){x.error("Analytics ML n√£o dispon√≠vel:",c),p([{text:"Continue praticando regularmente",icon:Z},{text:"Revise conceitos fundamentais",icon:H}])}},y=c=>{const m=[];if(c.avgGrade<60?m.push({title:"üìö Refor√ßo nos Estudos",description:"Sua m√©dia est√° abaixo do esperado. Dedique mais tempo aos estudos di√°rios.",reason:"M√©dia atual abaixo de 60%",priority:"high"}):c.avgGrade<75?m.push({title:"üìà Continue Progredindo",description:"Voc√™ est√° no caminho certo! Mantenha a consist√™ncia nos estudos.",reason:"Desempenho moderado",priority:"medium"}):m.push({title:"‚≠ê Excelente Desempenho",description:"Continue assim! Considere ajudar colegas com dificuldades.",reason:"M√©dia acima de 75%",priority:"low"}),c.classComparison&&c.classComparison.length>0){const M=c.classComparison.filter(_=>_.studentAvg<_.classAvg);M.length>0&&m.push({title:"üéØ Focar em Mat√©rias Espec√≠ficas",description:`Concentre-se em melhorar em: ${M.map(_=>_.subject).join(", ")}`,reason:"Abaixo da m√©dia da turma",priority:"high"})}return m.push({title:"‚è∞ Organize seu Tempo",description:"Crie um cronograma de estudos e reserve hor√°rios fixos para cada mat√©ria.",reason:"Boa pr√°tica de estudo",priority:"medium"}),m},se=async()=>{if(!A||A.length===0){O({title:"Sem dados suficientes",description:"Complete mais atividades para receber recomenda√ß√µes personalizadas.",variant:"destructive"});return}try{t(!0);const{data:c}=await h.from("submissions").select(`
          id,
          grade,
          submitted_at,
          activity:activities(
            id,
            title,
            max_score,
            content,
            activity_class_assignments(
              class:classes(subject)
            )
          ),
          answers(
            question_id,
            answer_json,
            points_earned
          )
        `).eq("student_id",i.id).not("grade","is",null).order("submitted_at",{ascending:!1}).limit(5);x.debug("üîç Total de Submissions encontradas:",c?.length),x.debug("üîç Detailed Submissions:",JSON.stringify(c,null,2));const m=(c||[]).map((j,E)=>{const S=j.activity,ae=S?.activity_class_assignments?.[0]?.class?.subject||"Geral";console.log(`
üìù Activity ${E+1}/${c.length}:`,{title:S?.title,grade:j.grade,hasContent:!!S?.content,contentKeys:S?.content?Object.keys(S.content):[],questionsCount:Array.isArray(S?.content?.questions)?S.content.questions.length:0,questions:S?.content?.questions,answersCount:j.answers?.length||0,answers:j.answers});const Q=[];return S?.content?.questions&&Array.isArray(S.content.questions)&&S.content.questions.forEach((P,re)=>{const R=j.answers?.find(X=>X.question_id===P.id||X.question_id===`question_${re}`);if(R){const X=typeof R.answer_json=="string"?R.answer_json:R.answer_json?.answer||R.answer_json?.text||"N√£o respondeu",ne=P.correctAnswer||P.correct_answer||P.answer;Q.push({question:P.text||P.question||P.title||"Quest√£o sem texto",studentAnswer:X,correctAnswer:ne,isCorrect:(R.points_earned||0)>0})}}),{grade:j.grade,maxScore:S?.max_score||100,subject:ae,activityTitle:S?.title,questions:Q.length>0?Q:void 0}}),M={avgGrade:r.avgGrade,totalActivities:r.totalActivities,recentGrades:m,classComparison:u.map(j=>({subject:j.subject,studentAvg:j.studentAvg,classAvg:j.classAvg}))};x.debug("üìä Performance Summary:",JSON.stringify(M,null,2)),x.debug("‚ùì Total de quest√µes encontradas:",m.reduce((j,E)=>j+(E.questions?.length||0),0));const{data:{session:_},error:w}=await h.auth.getSession();if(w)throw x.error("Erro ao obter sess√£o:",w),new Error("Erro de autentica√ß√£o");x.debug("Session token:",_?.access_token?"Token presente":"Token ausente");const G=await fetch("https://wapbwaimkurbuihatmix.supabase.co/functions/v1/ai-study-recommendations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_?.access_token||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhcGJ3YWlta3VyYnVpaGF0bWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyODY3MjksImV4cCI6MjA3NDg2MjcyOX0.x-NQQ2TtRgaUjjBZCf6j49eWOW4XSqjTFKC_KB1L56A"}`},body:JSON.stringify({studentId:i.id,performanceData:M})});if(!G.ok){const j=await G.text();if(x.error("Erro da API:",G.status,j),G.status===429){try{const S=JSON.parse(j);O({title:"‚è∞ Limite di√°rio atingido",description:`${S.message||"Voc√™ j√° gerou 3 recomenda√ß√µes hoje. Volte amanh√£!"}`,variant:"destructive",duration:5e3})}catch{O({title:"‚è∞ Limite di√°rio atingido",description:"Voc√™ j√° gerou 3 recomenda√ß√µes hoje. Volte amanh√£!",variant:"destructive",duration:5e3})}return}const E=y(M);v(E),O({title:"Recomenda√ß√µes geradas localmente",description:"Usando an√°lise b√°sica. Configure a API OpenAI para recomenda√ß√µes avan√ßadas."});return}const q=await G.json();v(q.recommendations||[]),q.usageToday&&F(q.usageToday);const J=q.usageToday&&q.dailyLimit?` (${q.usageToday}/${q.dailyLimit} hoje)`:"";O({title:"‚úÖ Recomenda√ß√µes atualizadas!",description:`Confira suas sugest√µes personalizadas de estudo${J}.`})}catch(c){x.error("Erro ao carregar recomenda√ß√µes:",c),O({title:"Erro ao carregar recomenda√ß√µes",description:"Tente novamente mais tarde.",variant:"destructive"})}finally{t(!1)}};return a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-slate-200 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-6",children:[e.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-500 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsxs(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Meu Desempenho"}),e.jsx("p",{className:"text-cyan-100",children:"An√°lise completa com IA e compara√ß√£o com a turma"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(W,{title:"M√©dia Geral",value:r.avgGrade,icon:me,gradient:"from-blue-500 to-cyan-600",delay:0}),e.jsx(W,{title:"Atividades Conclu√≠das",value:r.totalActivities,icon:ce,gradient:"from-cyan-500 to-blue-700",delay:.1}),e.jsx(W,{title:"Taxa de Conclus√£o",value:`${r.completionRate}%`,icon:ue,gradient:"from-emerald-500 to-cyan-500",format:"text",delay:.2})]}),e.jsxs(L,{className:"p-6 bg-white dark:bg-slate-900 mb-6 border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-900 dark:text-white",children:"Evolu√ß√£o de Notas"}),e.jsx(ge,{width:"100%",height:300,children:e.jsxs(be,{data:l,children:[e.jsx(he,{strokeDasharray:"3 3"}),e.jsx(pe,{dataKey:"name"}),e.jsx(fe,{domain:[0,10]}),e.jsx(xe,{}),e.jsx(ve,{type:"monotone",dataKey:"nota",stroke:"#3B82F6",strokeWidth:2})]})})]}),u.length>0&&e.jsxs(L,{className:"p-6 bg-white dark:bg-slate-900 mb-6 border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Compara√ß√£o com a Turma"})]}),e.jsx(V,{variant:"secondary",className:"text-xs",children:"Dados an√¥nimos"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Veja como voc√™ est√° em rela√ß√£o √† m√©dia da turma"}),e.jsx("div",{className:"space-y-4",children:u.map((c,m)=>e.jsxs(B.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:m*.1},className:"p-4 rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white",children:c.className}),e.jsx("p",{className:"text-xs text-slate-500",children:c.subject})]}),e.jsxs(V,{className:c.difference>0?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300":c.difference<0?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":"bg-slate-100 text-slate-700",children:[c.difference>0?"+":"",c.difference]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Sua m√©dia"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.studentAvg})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"M√©dia da turma"}),e.jsx("p",{className:"text-2xl font-bold text-slate-600 dark:text-slate-400",children:c.classAvg})]})]}),e.jsx(le,{value:c.studentAvg/10*100,className:"h-2 mt-3"})]},m))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(L,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Sugest√µes de Estudo"})]}),C.length>0?e.jsx("div",{className:"space-y-3",children:C.map((c,m)=>e.jsxs(B.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:m*.1},className:"flex items-start gap-3 p-3 bg-white dark:bg-slate-900 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40",children:e.jsx(Z,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:c.text||c})})]},m))}):e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Complete mais atividades para receber sugest√µes personalizadas."})]}),e.jsxs(L,{className:"p-6 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-950/20 dark:to-orange-950/20 border border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"√Åreas de Aten√ß√£o"})]}),f.length>0?e.jsx("div",{className:"space-y-3",children:f.map((c,m)=>e.jsxs(B.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:m*.1},className:"flex items-start gap-3 p-3 bg-white dark:bg-slate-900 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900/40",children:e.jsx(_e,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white",children:c.subject||c.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:c.description||c.text})]})]},m))}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-2 text-yellow-600"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Excelente! N√£o h√° √°reas cr√≠ticas no momento."})]})]})]}),e.jsxs(L,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Recomenda√ß√µes Personalizadas com IA"}),e.jsxs(V,{variant:$>=I?"destructive":"secondary",className:"text-xs",children:[$,"/",I," hoje"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(de,{onClick:se,disabled:s||$>=I,size:"sm",className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Gerando..."]}):$>=I?e.jsx(e.Fragment,{children:"‚è∞ Limite Atingido"}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Gerar Recomenda√ß√µes"]})}),$>=I&&e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Reinicia √† meia-noite"})]})]}),N.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:N.map((c,m)=>e.jsx(B.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:m*.1},className:"p-4 bg-white dark:bg-slate-900 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/40 flex-shrink-0",children:e.jsx(H,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm text-slate-900 dark:text-white mb-1",children:c.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:c.description}),c.reason&&e.jsx(V,{variant:"outline",className:"mt-2 text-xs",children:c.reason})]})]})},m))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-16 h-16 mx-auto mb-4 text-blue-400 opacity-50"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Clique no bot√£o acima para gerar recomenda√ß√µes personalizadas baseadas no seu desempenho."}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:"A IA analisar√° suas notas, compara com a turma e sugere materiais de estudo ideais para voc√™."})]})]})]})};export{yt as default};
