import{a as je,r as l,s as n,j as e,k as ve,L as h}from"./main-PnoWv5mu.js";import{m as g,B as c}from"./button-B1az96ai.js";import{C as x}from"./card-DNyDBtwZ.js";import{B as D}from"./SidebarPremium-DbDmcmQG.js";import{S as we}from"./StatsCard-rzGomFX8.js";import{D as Ne}from"./DashboardHeader-CjwFRF49.js";import{E as N}from"./EmptyState-6R7lfM6O.js";import"./input-BGWMq9XA.js";import"./dropdown-menu-BDAIvG1Q.js";import"./label-DSOeyQ5r.js";import{t as ye,c as ke,p as _e}from"./pt-BR-CcyWMXEv.js";import{i as Se}from"./isToday-Dz63xp96.js";import{B as A}from"./book-open-BN8GTFXN.js";import{U as Ce}from"./users-CZvcSbj_.js";import{T as De}from"./trending-up-BnoBnv7_.js";import{C as E}from"./clock-Dkzb1QSl.js";import{C as T}from"./index-DvZMkTcl.js";import{f as y}from"./format-7pK25_6I.js";import{T as Ae}from"./target-Cbkey8_6.js";import{C as G}from"./chevron-right-5LVKKztM.js";import{P as q}from"./plus-DIEHEl2o.js";import{F as Q}from"./file-text-WNEYLkuB.js";import{C as Ee}from"./circle-check-DbX-ZXTN.js";import{C as Te}from"./chart-column-Ba9dXnEb.js";import"./bell-jlu-i0nu.js";import"./user-IPdw0V9z.js";import"./settings-BAc4VZJo.js";import"./graduation-cap-BTPeK0uK.js";import"./x-7WqOwCJm.js";import"./tokens-BPdvztvj.js";import"./index-CWQpaRb1.js";import"./check-8UqrO2_7.js";import"./constructNow-PU7y2RSz.js";function Ge(d,u,b){const p=ye(d,b?.in);return isNaN(u)?ke(d,NaN):(p.setDate(p.getDate()+u),p)}const xt=()=>{const{user:d}=je(),[u,b]=l.useState(!0),[p,P]=l.useState(null),[m,X]=l.useState({totalClasses:0,totalStudents:0,totalActivities:0,pendingGrading:0,avgGrade:0,todayCorrections:0}),[B,Y]=l.useState([]),[I,Z]=l.useState([]),[O,ee]=l.useState([]),[z,R]=l.useState([]),[F,te]=l.useState([]),[f,ae]=l.useState([]),[H,se]=l.useState([]);l.useEffect(()=>{re()},[]);const re=async()=>{if(!d?.id){b(!1);return}try{b(!0),P(null),console.log("[TeacherDashboard] Carregando dados...");const{data:t,error:s}=await n.from("classes").select(`
          *,
          class_members(count)
        `).eq("created_by",d.id).eq("is_active",!0);if(s)throw s;const k=t?.map(a=>({...a,student_count:a.class_members?.[0]?.count||0}))||[],{data:_,error:L}=await n.from("activities").select(`
          *,
          activity_class_assignments(class:classes(name))
        `).eq("created_by",d.id).order("created_at",{ascending:!1}).limit(10);if(L)throw L;const de=_?.map(a=>({...a,class_name:a.activity_class_assignments?.[0]?.class?.name||"Sem turma"}))||[],j=_?.map(a=>a.id)||[],{data:V,error:$}=await n.from("submissions").select(`
          *,
          activity:activities(title),
          student:profiles!student_id(full_name)
        `).in("activity_id",j).eq("status","submitted").order("submitted_at",{ascending:!0}).limit(10);if($)throw $;const ne=V?.map(a=>({...a,student_name:a.student?.full_name||"Aluno",activity_title:a.activity?.title||"Atividade"}))||[],{data:S,error:M}=await n.from("submissions").select("grade").in("activity_id",j).not("grade","is",null);if(M)throw M;const oe=S?.length>0?S.reduce((a,i)=>a+i.grade,0)/S.length:0,v=new Date;v.setHours(0,0,0,0);const w=new Date(v);w.setDate(w.getDate()+1);const{data:ce,error:U}=await n.from("submissions").select("id").in("activity_id",j).gte("graded_at",v.toISOString()).lt("graded_at",w.toISOString());if(U)throw U;const W=Ge(new Date,7),{data:C,error:me}=await n.from("calendar_events").select("*").eq("created_by",d.id).gte("start_time",new Date().toISOString()).lte("start_time",W.toISOString()).order("start_time",{ascending:!0}).limit(5);!me&&C&&(R(C),te(C.filter(a=>Se(new Date(a.start_time)))));const{data:J,error:xe}=await n.from("meetings").select("*").eq("created_by",d.id).gte("start_time",new Date().toISOString()).lte("start_time",W.toISOString()).order("start_time",{ascending:!0}).limit(5);if(!xe&&J){const a=J.map(i=>({...i,title:i.title,start_time:i.start_time,event_type:"meeting"}));R(i=>[...i,...a].sort((r,o)=>new Date(r.start_time)-new Date(o.start_time)).slice(0,5))}const{data:K,error:he}=await n.from("submissions").select(`
          student_id,
          grade,
          student:profiles!student_id(full_name)
        `).in("activity_id",j).not("grade","is",null);if(!he&&K){const a={};K.forEach(r=>{a[r.student_id]||(a[r.student_id]={grades:[],name:r.student?.full_name||"Aluno"}),a[r.student_id].grades.push(r.grade)});const i=Object.entries(a).map(([r,o])=>({id:r,name:o.name,avgGrade:o.grades.reduce((pe,fe)=>pe+fe,0)/o.grades.length,totalActivities:o.grades.length})).filter(r=>r.avgGrade<6).sort((r,o)=>r.avgGrade-o.avgGrade).slice(0,10);ae(i)}const{data:ge,error:be}=await n.from("activities").select("*").eq("created_by",d.id).eq("status","draft").gte("created_at",v.toISOString()).lt("created_at",w.toISOString());be||se(ge||[]);const ue=k.reduce((a,i)=>a+(i.student_count||0),0);X({totalClasses:k.length,totalStudents:ue,totalActivities:_?.length||0,pendingGrading:V?.length||0,avgGrade:Number(oe.toFixed(1)),todayCorrections:ce?.length||0}),Y(k.slice(0,5)),Z(de.slice(0,5)),ee(ne),console.log("[TeacherDashboard] Dados carregados com sucesso")}catch(t){console.error("Erro ao carregar dashboard:",t),P("Erro ao carregar dados do dashboard. Tente novamente.")}finally{b(!1)}},ie=[{title:"Total de Turmas",value:m.totalClasses,icon:A,gradient:"from-blue-600 to-cyan-600",bgColor:"bg-blue-50 dark:bg-blue-950/30",change:`${m.totalStudents} alunos`},{title:"Total de Alunos",value:m.totalStudents,icon:Ce,gradient:"from-cyan-500 to-blue-600",bgColor:"bg-cyan-50 dark:bg-cyan-950/30"},{title:"Média Geral",value:m.avgGrade,icon:De,gradient:"from-emerald-500 to-teal-500",bgColor:"bg-emerald-50 dark:bg-emerald-950/30",change:m.avgGrade>=7?"Excelente":"Pode melhorar"},{title:"Aguardando Correção",value:m.pendingGrading,icon:E,gradient:"from-amber-500 to-orange-500",bgColor:"bg-amber-50 dark:bg-amber-950/30",change:`${m.todayCorrections} hoje`}],le=[{label:"Nova Turma",icon:q,href:"/dashboard/classes/new",gradient:"from-blue-600 to-indigo-600"},{label:"Nova Atividade",icon:q,href:"/dashboard/activities/new",gradient:"from-blue-600 to-cyan-600"},{label:"Ver Analytics",icon:Te,href:"/dashboard/analytics",gradient:"from-emerald-600 to-teal-600"}];return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ve,{size:"lg",text:"Carregando dashboard..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-6",children:[e.jsx(Ne,{title:"Dashboard do Professor",subtitle:"Bem-vindo de volta! Aqui está um resumo das suas turmas e atividades.",role:"teacher"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:ie.map((t,s)=>e.jsx(we,{title:t.title,value:t.value,icon:t.icon,gradient:t.gradient,bgColor:t.bgColor,change:t.change,delay:s*.1},t.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(T,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Próximos Eventos (7 dias)"})]}),e.jsx("div",{className:"space-y-3",children:z.length>0?z.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-center gap-3 p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:[e.jsxs("div",{className:"flex-shrink-0 w-16 h-16 bg-gradient-to-br from-blue-600 to-cyan-500 rounded-lg flex flex-col items-center justify-center text-white",children:[e.jsx("div",{className:"text-2xl font-bold",children:y(new Date(t.start_time),"d")}),e.jsx("div",{className:"text-xs uppercase",children:y(new Date(t.start_time),"MMM",{locale:_e})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white truncate",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:y(new Date(t.start_time),"HH:mm")}),e.jsx(D,{className:`mt-1 ${t.event_type==="meeting"?"bg-purple-100 text-purple-700":t.event_type==="exam"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:t.event_type||"evento"})]})]},t.id)):e.jsx(N,{icon:T,title:"Nenhum evento próximo",description:"Seus próximos eventos aparecerão aqui."})})]}),e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ae,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Agenda de Hoje"})]}),e.jsxs("div",{className:"space-y-4",children:[F.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Eventos"}),F.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800",children:[e.jsx(E,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:y(new Date(t.start_time),"HH:mm")})]})]},t.id))]}):e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Nenhum evento hoje"}),H.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Atividades para Postar"}),H.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-slate-900 dark:text-white text-sm",children:t.title})}),e.jsx(c,{size:"sm",className:"bg-gradient-to-r from-blue-600 to-cyan-600",children:"Publicar"})]},t.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Turmas Recentes"]}),e.jsx(h,{to:"/dashboard/classes",children:e.jsxs(c,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(G,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:B.length>0?B.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},children:e.jsx(h,{to:`/dashboard/classes/${t.id}`,children:e.jsx(x,{className:"p-4 hover:shadow-md transition-all border-2 hover:border-blue-200 dark:hover:border-blue-800 bg-white dark:bg-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${t.color||"from-blue-500 to-indigo-500"} flex items-center justify-center text-white font-bold`,children:t.name?.[0]||"T"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.subject||"Sem matéria"," • ",t.student_count||0," alunos"]})]})]}),e.jsx(c,{size:"sm",variant:"ghost",className:"whitespace-nowrap",children:"Ver Turma"})]})})})},t.id)):e.jsx(N,{icon:A,title:"Nenhuma turma encontrada",description:"Crie sua primeira turma para começar a gerenciar suas aulas e atividades.",actionLabel:"Criar Primeira Turma",actionIcon:q,action:()=>window.location.href="/dashboard/classes/new"})})]}),e.jsxs(x,{className:"p-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Atividades Recentes"]}),e.jsx(h,{to:"/dashboard/activities",children:e.jsxs(c,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(G,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:I.length>0?I.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700 transition-all bg-white dark:bg-slate-800",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:t.class_name}),e.jsx("div",{className:"flex items-center gap-3 text-xs text-slate-500 dark:text-slate-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),new Date(t.due_date).toLocaleDateString("pt-BR")]})})]}),e.jsx(D,{variant:t.status==="active"?"default":"secondary",className:"whitespace-nowrap",children:t.status==="active"?"Ativa":"Encerrada"})]})},t.id)):e.jsx(N,{icon:Q,title:"Nenhuma atividade encontrada",description:"Suas atividades recentes aparecerão aqui."})})]})]}),f.length>0&&e.jsxs(x,{className:"p-6 mb-8 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-950/20 dark:to-orange-950/20 border-2 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100 dark:bg-yellow-900/40",children:e.jsx(AlertTriangle,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Alunos que Precisam de Atenção"}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[f.length," aluno",f.length>1?"s":""," com desempenho abaixo de 6.0"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:s*.05},className:"flex items-center gap-4 p-4 rounded-lg bg-white dark:bg-slate-900 border-2 border-yellow-200 dark:border-yellow-800 hover:shadow-md transition-all",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center text-white font-bold text-lg",children:t.name?.[0]||"A"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(D,{className:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300 text-xs",children:["Média: ",t.avgGrade.toFixed(1)]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[t.totalActivities," atividade",t.totalActivities>1?"s":""]})]})]}),e.jsx(c,{size:"sm",variant:"outline",className:"whitespace-nowrap border-yellow-600 text-yellow-700 hover:bg-yellow-50",children:"Ver Detalhes"})]},t.id))})]}),e.jsxs(x,{className:"p-6 mb-8 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Submissões Pendentes de Correção"]}),e.jsx(h,{to:"/dashboard/grading",children:e.jsxs(c,{variant:"ghost",size:"sm",className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx("span",{children:"Ver Todas"}),e.jsx(G,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-3",children:O.length>0?O.map((t,s)=>e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-center justify-between p-4 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-amber-300 dark:hover:border-amber-700 transition-all bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold",children:t.student_name?.[0]||"A"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.student_name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.activity_title}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Enviado em ",new Date(t.submitted_at).toLocaleDateString("pt-BR")]})]})]}),e.jsx(h,{to:`/dashboard/grading/${t.id}`,children:e.jsx(c,{size:"sm",className:"whitespace-nowrap bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white",children:"Corrigir Agora"})})]},t.id)):e.jsx(N,{icon:Ee,title:"Nenhuma correção pendente!",description:"Parabéns! Você está em dia com as correções. 🎉"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:le.map((t,s)=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},children:e.jsx(h,{to:t.href,children:e.jsxs(c,{size:"lg",className:`w-full whitespace-nowrap inline-flex items-center justify-center gap-2 bg-gradient-to-r ${t.gradient} hover:opacity-90 text-white h-16 text-lg`,children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsx("span",{children:t.label})]})})},t.label))})]})};export{xt as default};
