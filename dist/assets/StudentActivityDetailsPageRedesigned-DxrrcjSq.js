import{j as e,r as g,g as ge,u as fe,s as h,l as n,q as je}from"./main-5T23t4PA.js";import{B as D}from"./button-D1pRabHc.js";import{C as q}from"./card-DPEV4PIe.js";import{T as ve}from"./textarea-CnoosxqN.js";import{D as Ne,a as we,b as ke,c as ye,d as Se,e as _e}from"./dialog--d34PTGN.js";import{R as Ae,a as Ce}from"./radio-group-DZ91-LZw.js";import"./checkbox-1XgMgFvg.js";import{L as Z}from"./label-CaEiuH7k.js";import{c as F}from"./utils-D3CvWusZ.js";import{C as O}from"./circle-alert-C3Gp5cKN.js";import{C as J}from"./circle-check-big-BLcs0CRD.js";import{S as P}from"./send-CWisnArH.js";import{C as De}from"./clock-DrcV20p-.js";import{U as ie}from"./user--bT9oolr.js";import{U as qe}from"./users-BHFcZ460.js";import{C as Me}from"./chart-column-CiTHaPgQ.js";import{T as Ee}from"./trending-up-CeaM1II1.js";import{u as Fe}from"./use-toast-DizLYaPb.js";import{c as Re,s as ze,a as $e,g as Te}from"./autoGradingService-d8D8Vb77.js";import{A as Ie}from"./arrow-left-BQBULL_z.js";import{C as ee}from"./calendar-BTZ9lOjb.js";import{F as te}from"./file-text-D1pM-cGT.js";import{A as He}from"./award-BxLZOqUu.js";import{S as Ve}from"./save-B16AUgPb.js";import{d as se}from"./differenceInHours-CxKvrqrP.js";import{f as M}from"./format-BdDrz3ZT.js";import{i as Oe}from"./isPast-GalRXxSk.js";import{p as E}from"./pt-BR-C6XVmIDX.js";import"./index-BSvf8Gkf.js";import"./index-BEPDIlbQ.js";import"./Combination-CK754xyO.js";import"./SidebarPremium-b8AcD6aG.js";import"./house-C21pZqGK.js";import"./book-open-DbJlkSkE.js";import"./graduation-cap-CGvbZ17f.js";import"./message-circle-Bm4-2rso.js";import"./settings-CA-HrSVc.js";import"./brain-dpI-w2IQ.js";import"./index-CcRuMwBB.js";import"./proxy-CTHD_aal.js";import"./chevron-right-BZvTPqku.js";import"./x-C8LZHbUR.js";import"./index-D8pw72a5.js";import"./check-BGvYUlN_.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-ChNhCS9W.js";const ae={pending:{label:"Pendente",icon:De,bg:"bg-amber-100 dark:bg-amber-900/30",text:"text-amber-700 dark:text-amber-400",border:"border-amber-300 dark:border-amber-700",emoji:"ðŸŸ¡"},submitted:{label:"Enviada",icon:P,bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-700 dark:text-blue-400",border:"border-blue-300 dark:border-blue-700",emoji:"ðŸ”µ"},graded:{label:"Corrigida",icon:J,bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-400",border:"border-green-300 dark:border-green-700",emoji:"ðŸŸ¢"},late:{label:"Atrasada",icon:O,bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-400",border:"border-red-300 dark:border-red-700",emoji:"ðŸ”´"}},Pe={sm:{container:"px-2 py-0.5 text-xs gap-1",icon:"w-3 h-3"},md:{container:"px-3 py-1 text-sm gap-1.5",icon:"w-4 h-4"},lg:{container:"px-4 py-2 text-base gap-2",icon:"w-5 h-5"}},re=({status:u="pending",size:w="md",score:b,maxScore:R=10,className:k,showEmoji:v=!0})=>{const o=ae[u]||ae.pending,t=Pe[w],I=o.icon;return e.jsxs("div",{className:F("inline-flex items-center rounded-full font-semibold border-2 transition-all",o.bg,o.text,o.border,t.container,k),children:[v&&e.jsx("span",{children:o.emoji}),e.jsx(I,{className:t.icon}),e.jsx("span",{children:o.label}),u==="graded"&&b!==void 0&&e.jsxs("span",{className:"ml-1 font-bold",children:["â€¢ ",Number(b).toFixed(1),"/",R]})]})},le=g.memo(({studentGrade:u,classAverage:w,maxGrade:b=100,className:R})=>{const k=u/b*100,v=w/b*100,o=u-w,t=o>0,m=(z=>z>=90?"bg-emerald-500":z>=70?"bg-blue-500":z>=60?"bg-amber-500":"bg-red-500")(k);return e.jsxs("div",{className:F("space-y-6",R),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ie,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Sua Nota"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-4xl font-bold text-slate-900 dark:text-white",children:u.toFixed(1)}),e.jsxs("span",{className:"text-lg text-slate-500 dark:text-slate-400",children:["/ ",b]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(qe,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"MÃ©dia da Turma"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-4xl font-bold text-slate-900 dark:text-white",children:w.toFixed(1)}),e.jsxs("span",{className:"text-lg text-slate-500 dark:text-slate-400",children:["/ ",b]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Me,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"ComparaÃ§Ã£o de Notas"})]}),e.jsxs("div",{className:"flex items-end justify-center gap-12 pt-4 pb-4",children:[e.jsxs("div",{className:"flex flex-col items-center w-32",children:[e.jsx("div",{className:"relative w-full h-56 mb-4",children:e.jsx("div",{className:F("absolute bottom-0 w-full rounded-t-lg transition-all duration-1000 flex items-end justify-center pb-3",m),style:{height:`${Math.max(k,8)}%`},children:e.jsx("span",{className:"text-white font-bold text-lg drop-shadow-lg",children:u.toFixed(1)})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"VocÃª"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[k.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"flex flex-col items-center w-32",children:[e.jsx("div",{className:"relative w-full h-56 mb-4",children:e.jsx("div",{className:"absolute bottom-0 w-full bg-slate-400 dark:bg-slate-600 rounded-t-lg transition-all duration-1000 flex items-end justify-center pb-3",style:{height:`${Math.max(v,8)}%`},children:e.jsx("span",{className:"text-white font-bold text-lg drop-shadow-lg",children:w.toFixed(1)})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"Turma"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[v.toFixed(0),"%"]})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:F("p-2.5 rounded-lg",t?"bg-emerald-100 dark:bg-emerald-900/30":o===0?"bg-blue-100 dark:bg-blue-900/30":"bg-amber-100 dark:bg-amber-900/30"),children:e.jsx(Ee,{className:F("w-6 h-6",t?"text-emerald-600 dark:text-emerald-400":o===0?"text-blue-600 dark:text-blue-400":"text-amber-600 dark:text-amber-400",!t&&o!==0&&"rotate-180")})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:F("text-base font-semibold mb-1",t?"text-emerald-700 dark:text-emerald-400":o===0?"text-blue-700 dark:text-blue-400":"text-amber-700 dark:text-amber-400"),children:t?e.jsxs(e.Fragment,{children:["VocÃª estÃ¡ ",Math.abs(o).toFixed(1)," pontos acima da mÃ©dia"]}):o===0?e.jsx(e.Fragment,{children:"VocÃª estÃ¡ na mÃ©dia da turma"}):e.jsxs(e.Fragment,{children:["VocÃª estÃ¡ ",Math.abs(o).toFixed(1)," pontos abaixo da mÃ©dia"]})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t?"ParabÃ©ns! Continue assim!":o===0?"Continue estudando para superar a mÃ©dia!":"Continue se esforÃ§ando!"})]})]})})]})});le.displayName="GradeChart";const Ht=()=>{const{activityId:u}=ge(),w=fe(),{toast:b}=Fe(),[R,k]=g.useState(!0),[v,o]=g.useState(!1),[t,I]=g.useState(null),[m,z]=g.useState(null),[_,B]=g.useState(""),[Be,Ge]=g.useState([]),[de,H]=g.useState(!1),[x,$]=g.useState({}),[W,ne]=g.useState(null),[V,oe]=g.useState(0),[A,K]=g.useState(!1);g.useEffect(()=>{X()},[u]);const X=async()=>{try{k(!0);const{data:s}=await h.auth.getUser(),{data:d,error:i}=await h.from("activities").select("*").eq("id",u).single();if(i)throw i;const{data:a}=await h.from("activity_class_assignments").select("class_id").eq("activity_id",u).single();let l=null;if(a){const{data:y}=await h.from("classes").select("id, name, color").eq("id",a.class_id).single();l=y}let c=null;if(d?.created_by){const{data:y}=await h.from("profiles").select("id, full_name, name, email").eq("id",d.created_by).maybeSingle();c=y}const{data:C,error:N}=await h.from("submissions").select("*").eq("activity_id",u).eq("student_id",s.user.id).order("submitted_at",{ascending:!1}).limit(1);if(N)throw N;const r=C?.[0]||null,S=r?typeof r.content?.attemptNumber=="number"?r.content.attemptNumber:1:0;if(oe(S),r?.status==="graded"){const{data:y}=await h.from("submissions").select("grade").eq("activity_id",u).eq("status","graded").not("grade","is",null);if(y&&y.length>0){const L=y.map(Q=>parseFloat(Q.grade)),ue=L.reduce((Q,he)=>Q+he,0)/L.length,pe=Math.max(...L);ne({average:ue,maxGrade:pe,totalSubmissions:y.length})}}const p={...d,class_name:l?.name,class_color:l?.color,class_id:l?.id,teacher_name:c?.full_name||c?.name||c?.email||null};I(p),z(r),B(r?.content?.answer||""),$(r?.content?.selectedAnswers||{}),K(!1)}catch(s){n.error("Erro ao carregar atividade:",s),b({title:"âŒ Erro ao carregar",description:s.message,variant:"destructive"})}finally{k(!1)}},ce=async()=>{try{const{data:s}=await h.auth.getUser(),d={activity_id:u,student_id:s.user.id,content:{answer:_},status:"draft"};m?await h.from("submissions").update(d).eq("id",m.id):await h.from("submissions").insert(d),b({title:"Rascunho salvo",description:"Suas alteraÃ§Ãµes foram salvas"})}catch(s){n.error("Erro ao salvar rascunho:",s),b({title:"âŒ Erro ao salvar",description:s.message,variant:"destructive"})}},me=async()=>{if(n.debug("[handleSubmit] BotÃ£o clicado!",{activityType:t?.type,selectedAnswersCount:Object.keys(x).length,selectedAnswers:x,activityStatus:f}),t?.type==="closed"||t?.type==="quiz"||t?.type==="multiple_choice"){const s=t.content?.questions||[];if(n.debug("[handleSubmit] Validando questÃµes:",{totalQuestions:s.length,answeredQuestions:Object.keys(x).length}),!s.every((i,a)=>{const l=i.id||a,c=x[l]!==void 0&&x[l]!==null;return n.debug("[handleSubmit] QuestÃ£o:",{questionId:l,hasAnswer:c,answer:x[l]}),c})){n.warn("[handleSubmit] Nem todas questÃµes respondidas"),b({title:"QuestÃµes nÃ£o respondidas",description:"Responda todas as questÃµes antes de enviar",variant:"destructive"});return}}else if(!_.trim()){n.warn("[handleSubmit] Resposta dissertativa vazia"),b({title:"Resposta vazia",description:"Digite sua resposta antes de enviar",variant:"destructive"});return}n.debug("[handleSubmit] ValidaÃ§Ã£o passou! Abrindo modal..."),H(!0)},xe=async()=>{H(!1);try{o(!0);let s={answer:_};(t?.type==="quiz"||t?.type==="multiple_choice"||t?.type==="closed")&&(s.selectedAnswers=x);let d=1;if(m){const r=m.content?.attemptNumber;typeof r=="number"&&r>0?d=r+1:d=2}s.attemptNumber=d;const{data:i}=await h.auth.getUser();let a=null,l="submitted",c=null,C=null;if(Re(t)&&ze(t)){const r=t?.content?.questions||[];a=$e(r,x,t.max_score),a&&(l="graded",c=a.grade,C=Te(a),n.debug("[Submission] CorreÃ§Ã£o automÃ¡tica aplicada:",a))}const N={activity_id:u,student_id:i.user.id,content:s,status:l,submitted_at:new Date().toISOString()};if(c!=null){const r=parseFloat(c),S=parseFloat(t?.max_score||10);let p=r;S!==10&&S>0&&(p=r/S*10),p=Math.max(0,Math.min(10,p)),p=Math.round(p*100)/100,n.debug("[confirmSubmit] Validando grade:",{autoGrade:c,gradeValue:r,maxScore:S,normalizedGrade:p,isValid:!isNaN(r)&&r>=0&&r<=S}),!isNaN(p)&&p>=0&&p<=10?(N.grade=p,N.graded_at=new Date().toISOString(),N.feedback=C):n.warn("[confirmSubmit] Grade invÃ¡lida, nÃ£o serÃ¡ enviada:",{normalizedGrade:p})}if(n.debug("[confirmSubmit] Dados finais para envio:",N),m){const{error:r}=await h.from("submissions").update(N).eq("id",m.id);if(r)throw r;n.debug("[confirmSubmit] SubmissÃ£o atualizada (tentativa mÃºltipla)")}else{const{error:r}=await h.from("submissions").insert(N);if(r)throw r;n.debug("[confirmSubmit] Nova submissÃ£o criada (primeira tentativa)")}b(c!==null?{title:"Atividade corrigida!",description:`Sua nota: ${c}/${t.max_score} (${a.percentage}%)`}:{title:"Atividade enviada!",description:"Aguarde a correÃ§Ã£o do professor"}),X()}catch(s){n.error("Erro ao enviar:",s),n.error("[confirmSubmit] Detalhes do erro:",{message:s.message,code:s.code,details:s.details,hint:s.hint,fullError:JSON.stringify(s,null,2)}),b({title:"âŒ Erro ao enviar",description:s.message||"Erro desconhecido ao enviar atividade",variant:"destructive"})}finally{o(!1)}},f=t?m?.status==="graded"?"graded":m?.status==="submitted"?"submitted":t?.due_date&&Oe(new Date(t.due_date))?"late":"pending":"pending",j=t?.due_date?new Date(t.due_date):null,Y=j&&se(j,new Date)<24&&f==="pending",G=t?.type==="quiz"||t?.type==="multiple_choice"||t?.type==="closed",U=t?.content?.advanced_settings?.maxAttempts||1,be=U>1&&V<U,T=!A&&(f==="submitted"||f==="graded");return n.debug("[StudentActivityDetails] Estado atual:",{activityStatus:f,hasActivity:!!t,activityType:t?.type,questionsCount:t?.content?.questions?.length,selectedAnswersCount:Object.keys(x).length,selectedAnswers:x,hasSubmission:!!m,submissionStatus:m?.status,advancedSettings:t?.content?.advanced_settings}),R?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(je,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 p-6 shadow-md",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs(D,{variant:"ghost",onClick:()=>w(-1),className:"text-white hover:bg-white/15 mb-4",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Voltar Ã  Turma"]}),e.jsx("div",{className:"flex items-start justify-between flex-wrap gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white mb-2",children:t?.title}),(t?.class_name||t?.teacher_name)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3 text-xs sm:text-sm text-white/90",children:[t?.class_name&&e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10",children:[e.jsx(ee,{className:"w-3 h-3"}),e.jsx("span",{children:t.class_name})]}),t?.teacher_name&&e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10",children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsxs("span",{children:["Professor(a) ",t.teacher_name]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(re,{status:f,size:"lg",score:m?.grade,maxScore:t?.max_score||10}),j&&e.jsxs("div",{className:"flex items-center gap-2 text-white/90",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Prazo: ",M(j,"dd/MM/yyyy 'Ã s' HH:mm",{locale:E})]})]})]})]})}),Y&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 max-w-xl px-4 py-3 rounded-lg border border-red-200 bg-red-50/90 text-red-700 dark:bg-red-950/30 dark:border-red-800 dark:text-red-200 text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"ATENÃ‡ÃƒO: menos de 24 horas para o prazo desta atividade."})]})]})}),e.jsx("div",{className:"container mx-auto p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs(q,{className:"p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-blue-600"}),"DescriÃ§Ã£o"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:t?.description||"Sem descriÃ§Ã£o"}})]}),t?.content?.rubric&&e.jsxs(q,{className:"p-6 bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-blue-600"}),"CritÃ©rios de AvaliaÃ§Ã£o"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-sm",children:t.content.rubric})]}),G&&t?.content?.questions&&(f!=="graded"||A)&&e.jsxs(q,{className:"p-4 sm:p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-blue-600"}),"QuestÃµes"]}),t.content.questions.map((s,d)=>{const i=s.id||d;return e.jsxs("div",{className:"mb-6 p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold mb-3",children:[d+1,". ",s.text||s.question]}),s.alternatives&&s.alternatives.length>0&&e.jsx("div",{className:"space-y-2",children:s.alternatives.map(a=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors cursor-pointer",onClick:()=>{T||(n.debug("[Alternativa] Clicada:",{questionId:i,altId:a.id,letter:a.letter}),$({...x,[i]:String(a.id)}))},children:[e.jsx("input",{type:"radio",name:`question-${i}`,id:`q${i}-${a.id}`,value:String(a.id),checked:String(x[i])===String(a.id),onChange:l=>{n.debug("[Radio] Changed:",{questionId:i,value:l.target.value}),T||$({...x,[i]:l.target.value})},disabled:T,className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500 focus:ring-2 cursor-pointer"}),e.jsxs(Z,{htmlFor:`q${i}-${a.id}`,className:"flex-1 cursor-pointer",children:[e.jsxs("span",{className:"font-semibold mr-2",children:[a.letter,")"]}),a.text]})]},a.id))}),!s.alternatives&&s.options&&s.options.length>0&&e.jsx(Ae,{value:x[i],onValueChange:a=>{T||$({...x,[i]:a})},children:s.options.map((a,l)=>e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ce,{value:a,id:`q${i}-${l}`,disabled:T}),e.jsx(Z,{htmlFor:`q${i}-${l}`,children:a})]},l))})]},i)})]}),(f!=="graded"||A)&&e.jsxs(q,{className:"p-4 sm:p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-green-600"}),f==="submitted"&&!A?"Status da SubmissÃ£o":"Enviar Atividade"]}),f==="submitted"&&!A?e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400 mb-2",children:["Atividade enviada em ",M(new Date(m.submitted_at),"dd/MM/yyyy 'Ã s' HH:mm",{locale:E})]}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300",children:"Aguardando correÃ§Ã£o do professor..."})]}):e.jsxs(e.Fragment,{children:[t?.type!=="closed"&&t?.type!=="quiz"&&t?.type!=="multiple_choice"&&e.jsx(ve,{value:_,onChange:s=>B(s.target.value),placeholder:"Digite sua resposta aqui...",rows:10,className:"mb-4"}),(t?.type==="closed"||t?.type==="quiz"||t?.type==="multiple_choice")&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["Revise suas respostas antes de enviar.",t?.content?.advanced_settings?.showScoreImmediately&&e.jsx("span",{className:"font-semibold",children:" Sua nota serÃ¡ calculada automaticamente!"})]})}),e.jsxs("div",{className:"flex gap-3",children:[t?.type!=="closed"&&t?.type!=="quiz"&&t?.type!=="multiple_choice"&&e.jsxs(D,{variant:"outline",onClick:ce,disabled:!_.trim(),children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Salvar Rascunho"]}),e.jsxs(D,{onClick:me,disabled:v,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),v?"Enviando...":"Enviar Atividade"]})]})]})]}),f==="graded"&&e.jsxs(q,{className:"p-6 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Resultado"}),t?.class_name&&e.jsx("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900 rounded-full",children:e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:t.class_name})})]}),W&&e.jsx(le,{studentGrade:m.grade,classAverage:W.average,maxGrade:t.max_score||10,className:"mb-6"}),m.feedback&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold mb-2 text-slate-900 dark:text-white",children:"Feedback do Professor"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:m.feedback})]}),G&&t?.content?.questions&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold mb-2 text-slate-900 dark:text-white",children:"Suas Respostas"}),e.jsx("div",{className:"space-y-3",children:t.content.questions.map((s,d)=>{const i=s.id||d,a=x[i];let l="";if(s.alternatives&&a!==void 0&&a!==null){const c=s.alternatives.find(C=>String(C.id)===String(a));c&&(l=`${c.letter}) ${c.text}`)}else s.options&&a!==void 0&&a!==null&&(l=String(a));return e.jsxs("div",{className:"p-3 rounded-lg bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700",children:[e.jsxs("p",{className:"text-sm font-semibold mb-1",children:[d+1,". ",s.text||s.question]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:l||"NÃ£o respondida"})]},i)})})]}),!G&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold mb-2 text-slate-900 dark:text-white",children:"Sua Resposta"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:_})]}),be&&!A&&e.jsxs("div",{className:"mt-6 p-4 bg-amber-50 dark:bg-amber-950/20 rounded-xl border border-amber-200 dark:border-amber-800",children:[e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200 mb-2",children:`Esta atividade permite mÃºltiplas tentativas (${V}/${U} jÃ¡ realizadas).`}),e.jsx(D,{variant:"outline",onClick:()=>{K(!0),B(""),$({})},children:"Nova tentativa"})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(q,{className:"p-6 sticky top-6",children:[e.jsx("h3",{className:"font-bold mb-4 flex items-center gap-2",children:"InformaÃ§Ãµes"}),e.jsxs("div",{className:"space-y-4",children:[j&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Prazo de Entrega"}),e.jsx("p",{className:"font-semibold text-lg",children:M(j,"dd/MM/yyyy",{locale:E})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:M(j,"HH:mm",{locale:E})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Nota MÃ¡xima"}),e.jsxs("p",{className:"font-semibold text-2xl text-blue-600",children:[t?.max_score||10," pontos"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-2",children:"Status Atual"}),e.jsx(re,{status:f,size:"md",score:m?.grade,maxScore:t?.max_score||10})]}),t?.class_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Turma"}),e.jsx("p",{className:"font-semibold",children:t.class_name})]})]}),Y&&j&&e.jsx("div",{className:"mt-6 p-4 bg-red-50 dark:bg-red-950/20 border-2 border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:[Math.floor(se(j,new Date))," horas restantes!"]})})]})})]})}),e.jsx(Ne,{open:de,onOpenChange:H,children:e.jsxs(we,{className:"max-w-md",children:[e.jsxs(ke,{children:[e.jsxs(ye,{className:"flex items-center gap-2 text-xl",children:[e.jsx(P,{className:"w-6 h-6 text-blue-600"}),"Confirmar Envio da Atividade"]}),e.jsx(Se,{children:"Revise os detalhes antes de enviar sua atividade."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Data de Envio:"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:M(new Date,"dd/MM/yyyy 'Ã s' HH:mm",{locale:E})})]}),j&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Prazo:"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:M(j,"dd/MM/yyyy 'Ã s' HH:mm",{locale:E})})]}),(()=>{const s=t?.content?.advanced_settings?.maxAttempts||1;return s>1?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Tentativas:"}),e.jsxs("span",{className:`text-sm font-semibold ${V<s?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[V+1,"/",s]})]}):null})(),(t?.type==="closed"||t?.type==="quiz"||t?.type==="multiple_choice"||t?.type==="checkbox")&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"QuestÃµes Respondidas:"}),e.jsxs("span",{className:`text-sm font-semibold ${Object.keys(x).length===(t?.content?.questions||[]).length?"text-green-600 dark:text-green-400":"text-orange-600 dark:text-orange-400"}`,children:[Object.keys(x).length,"/",(t?.content?.questions||[]).length]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"ðŸŽ¯ Nota MÃ¡xima:"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400",children:[t?.max_score||10," pontos"]})]})]}),t?.content?.advanced_settings?.showScoreImmediately&&(t?.type==="closed"||t?.type==="quiz")&&e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"CorreÃ§Ã£o automÃ¡tica ativada! VocÃª verÃ¡ sua nota imediatamente."]})}),(()=>{const s=t?.content?.advanced_settings?.maxAttempts||1,d=t?.content?.advanced_settings?.keepBestGrade;return n.debug("[Modal] ConfiguraÃ§Ãµes:",{maxAttempts:s,keepBestGrade:d}),s>1?e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:["VocÃª pode enviar atÃ© ",e.jsxs("strong",{children:[s,"x"]}),".",d===!0&&" SerÃ¡ considerada a maior nota.",d===!1&&" SerÃ¡ considerada a Ãºltima nota.",d===void 0&&" SerÃ¡ considerada a Ãºltima nota."]})]})}):e.jsx("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("strong",{children:"AtenÃ§Ã£o:"})," ApÃ³s o envio, vocÃª nÃ£o poderÃ¡ editar suas respostas."]})})})()]}),e.jsxs(_e,{className:"gap-2",children:[e.jsx(D,{variant:"outline",onClick:()=>H(!1),disabled:v,children:"Revisar Respostas"}),e.jsx(D,{onClick:xe,className:"bg-green-600 hover:bg-green-700",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Confirmar Envio"]})})]})]})})]})};export{Ht as default};
