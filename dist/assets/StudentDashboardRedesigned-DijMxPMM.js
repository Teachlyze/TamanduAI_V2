import{b as ht,u as vt,r as f,l as y,s as r,j as t,q as xt}from"./main-C5n3kzXQ.js";import{S as k}from"./StatCard--UDugV-B.js";import{A as ft}from"./ActivityCard-CXr2imJh.js";import{E as yt}from"./EventCard-BoAW0J50.js";import{C as _}from"./card-CjtJprPz.js";import{E as F}from"./EmptyState-cekabAEp.js";import{B as b}from"./button-CXfsJEZz.js";import"./dialog-D4cdgt_6.js";import{m as L}from"./proxy-C-9wZx5L.js";import{C as _t}from"./circle-alert--zWTLTwH.js";import{B as $}from"./book-open-BP8V__Hw.js";import{F as K}from"./file-text-0s37oUXW.js";import{S as W}from"./star-DcZ05FcA.js";import{T as bt}from"./target-BLKdx6aR.js";import{C as jt}from"./circle-check-Ct3ReQO3.js";import{T as wt}from"./trending-up-DjT6oaWG.js";import{W as X,X as Y,Y as H,_ as U,$ as J}from"./CartesianChart-DFH8OPT4.js";import{L as Nt,a as St}from"./LineChart-C46_qqBR.js";import{B as kt,a as Ct}from"./BarChart-fyNDyR6o.js";import{C as A}from"./calendar-BkZi9bLz.js";import{s as At,f as Et}from"./format-BdDrz3ZT.js";import{e as Dt}from"./endOfDay-B-zzKHwV.js";import{p as It}from"./pt-BR-C6XVmIDX.js";import"./differenceInHours-CxKvrqrP.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-ChNhCS9W.js";import"./formatDistanceToNow-CR6k5j2z.js";import"./constructNow-DqwG0NnQ.js";import"./differenceInCalendarMonths-ka4FvHlb.js";import"./endOfMonth-rhMYNEE8.js";import"./badge-DIjZdJB4.js";import"./video-CCS1Gj6m.js";import"./clock-DACORgp8.js";import"./map-pin-BJStbmph.js";import"./index-B6XryYCt.js";import"./index-CsW3l1Gu.js";import"./Combination-Chdg_-Wh.js";import"./SidebarPremium-D25G1dNT.js";import"./house-ZJXziqlE.js";import"./users-Boys-rM5.js";import"./graduation-cap-DHgx-smk.js";import"./chart-column-5ubExldJ.js";import"./message-circle-oS8o50gZ.js";import"./settings-BnI-Y10b.js";import"./brain-Bn2z760B.js";import"./index-DJGNkgSL.js";import"./chevron-right-avg7mug8.js";import"./x-3ab3q3Ef.js";import"./index-CyfUhPn4.js";const Ce=()=>{const{user:c}=ht(),v=vt(),[Q,E]=f.useState(!0),[D,Z]=f.useState(!0),[x,I]=f.useState({totalClasses:0,pendingActivities:0,completedActivities:0,avgGrade:0,completionRate:0,gradeTrend:null}),[T,q]=f.useState([]),[M,tt]=f.useState([]),[G,et]=f.useState([]),[B,R]=f.useState([]),[z,st]=f.useState([]);f.useEffect(()=>{c?.id&&at()},[c]);const at=async()=>{try{E(!0),await Promise.all([it(),rt(),nt(),ot(),dt(),ct()])}catch(e){y.error("Erro ao carregar dashboard:",e)}finally{E(!1),D&&Z(!1)}},it=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),a=e?.map(d=>d.class_id)||[],o=a.length;if(a.length===0){I({totalClasses:0,pendingActivities:0,completedActivities:0,avgGrade:0,completionRate:0,gradeTrend:null});return}const{data:g}=await r.from("activity_class_assignments").select("activity_id, activity:activities(id, title, due_date, max_score)").in("class_id",a),n=g?.map(d=>d.activity_id).filter(Boolean)||[],{data:m}=await r.from("submissions").select("activity_id, status, grade, submitted_at").eq("student_id",c.id).in("activity_id",n),l=new Set(m?.map(d=>d.activity_id)||[]),u=n.length-l.size,i=l.size,p=m?.filter(d=>d.grade!==null)||[],h=p.length>0?p.reduce((d,N)=>d+parseFloat(N.grade),0)/p.length:0;let s=null;if(p.length>=2){const d=[...p].sort((S,j)=>new Date(S.submitted_at)-new Date(j.submitted_at)),N=5,C=d.length,P=Math.max(C-N,0),lt=Math.max(C-2*N,0),mt=d.slice(P,C),O=d.slice(lt,P);if(O.length>0){const S=V=>V.reduce((gt,ut)=>gt+parseFloat(ut.grade),0)/V.length,j=S(O),pt=S(mt);j>0?s=Math.round((pt-j)/j*100):s=0}else s=0}const w=n.length>0?Math.round(i/n.length*100):0;I({totalClasses:o,pendingActivities:u,completedActivities:i,avgGrade:h,completionRate:w,gradeTrend:s})}catch(e){y.error("Erro ao carregar stats:",e)}},rt=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),a=e?.map(s=>s.class_id)||[];if(a.length===0){q([]);return}const{data:o}=await r.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",a),g=o?.map(s=>s.activity_id).filter(Boolean)||[],{data:n}=await r.from("activities").select("id, title, description, type, due_date, max_score").in("id",g),{data:m}=await r.from("classes").select("id, name, subject").in("id",a),l={};n?.forEach(s=>{l[s.id]=s});const u={};m?.forEach(s=>{u[s.id]=s});const{data:i}=await r.from("submissions").select("activity_id, status, grade").eq("student_id",c.id).in("activity_id",g),p=new Set(i?.map(s=>s.activity_id)||[]),h=(o||[]).filter(s=>l[s.activity_id]&&!p.has(s.activity_id)).map(s=>{const w=l[s.activity_id],d=u[s.class_id];return{...w,class_name:d?.name,class_subject:d?.subject,status:new Date(w.due_date)<new Date?"late":"pending"}}).slice(0,5);q(h)}catch(e){y.error("Erro ao carregar atividades pendentes:",e)}},nt=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),a=e?.map(s=>s.class_id)||[],o=new Date,g=At(o),n=Dt(o),{data:m}=await r.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, class_id").in("class_id",a).gte("start_time",g.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0}),{data:l}=await r.from("calendar_events").select("id, title, description, start_time, end_time, type, modality, location, meeting_link, attendees, class_id").contains("attendees",[c.id]).gte("start_time",g.toISOString()).lte("start_time",n.toISOString()).order("start_time",{ascending:!0}),{data:u}=await r.from("classes").select("id, name").in("id",a),i={};u?.forEach(s=>{i[s.id]=s.name});const p=new Set,h=[...m||[],...l||[]].filter(s=>p.has(s.id)?!1:(p.add(s.id),!0)).map(s=>({...s,class_name:i[s.class_id]}));tt(h)}catch(e){y.error("Erro ao carregar eventos de hoje:",e)}},ot=async()=>{try{const{data:e}=await r.from("submissions").select(`
          id, grade, submitted_at,
          activity:activities(title, max_score)
        `).eq("student_id",c.id).not("grade","is",null).order("submitted_at",{ascending:!0}).limit(10),a=(e||[]).map(o=>({date:Et(new Date(o.submitted_at),"dd/MM",{locale:It}),avgGrade:parseFloat(o.grade)||0,activity:o.activity?.title}));et(a)}catch(e){y.error("Erro ao carregar dados de desempenho:",e)}},dt=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),a=e?.map(n=>n.class_id)||[];if(a.length===0){R([]);return}const{data:o}=await r.from("classes").select("id, name, subject").in("id",a),g=await Promise.all((o||[]).map(async n=>{const{data:m}=await r.from("activity_class_assignments").select("activity_id").eq("class_id",n.id),l=m?.map(h=>h.activity_id)||[],{data:u}=await r.from("submissions").select("grade").eq("student_id",c.id).in("activity_id",l).not("grade","is",null),i=u?.map(h=>parseFloat(h.grade))||[],p=i.length>0?i.reduce((h,s)=>h+s,0)/i.length:0;return{name:n.name,value:p}}));R(g.sort((n,m)=>m.value-n.value).slice(0,5))}catch(e){y.error("Erro ao carregar top turmas:",e)}},ct=async()=>{try{const{data:e}=await r.from("class_members").select("class_id").eq("user_id",c.id).eq("role","student"),a=e?.map(i=>i.class_id)||[],{data:o}=await r.from("activity_class_assignments").select(`
          activity_id,
          activity:activities(id, title, due_date)
        `).in("class_id",a),g=o?.map(i=>i.activity_id).filter(Boolean)||[],{data:n}=await r.from("submissions").select("activity_id").eq("student_id",c.id).in("activity_id",g),m=new Set(n?.map(i=>i.activity_id)||[]),l=(o||[]).filter(i=>i.activity&&!m.has(i.activity.id)&&new Date(i.activity.due_date)<new Date),u=[];l.length>0&&u.push({type:"warning",message:`VocÃª tem ${l.length} atividade${l.length>1?"s":""} atrasada${l.length>1?"s":""}!`}),st(u)}catch(e){y.error("Erro ao carregar alertas:",e)}};return Q&&D?t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx(xt,{size:"lg"})}):t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-blue-50/30 to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-6",children:[t.jsxs(L.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-600 via-blue-600 to-cyan-600 rounded-2xl p-8 mb-8 text-white shadow-xl",children:[t.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["OlÃ¡, ",c?.user_metadata?.name||c?.email?.split("@")[0]||"Estudante","!"]}),t.jsx("p",{className:"text-blue-100 text-lg",children:x.avgGrade>=8?"ðŸŽ‰ Seu desempenho estÃ¡ Ã³timo! Continue assim!":x.avgGrade>=6?"ðŸ‘ VocÃª estÃ¡ indo bem! Mantenha o foco!":x.avgGrade>0?"Vamos melhorar juntos! VocÃª consegue!":"ðŸ“š Comece suas atividades e acompanhe seu progresso!"})]}),z.length>0&&t.jsx(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8",children:z.map((e,a)=>t.jsx(_,{className:"p-4 bg-orange-50 dark:bg-orange-950/20 border-orange-300 dark:border-orange-800",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(_t,{className:"w-5 h-5 text-orange-600"}),t.jsx("p",{className:"text-orange-900 dark:text-orange-200 font-medium",children:e.message}),t.jsx(b,{variant:"outline",size:"sm",onClick:()=>v("/students/activities"),className:"ml-auto",children:"Ver Atividades"})]})},a))}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8",children:[t.jsx(k,{icon:$,value:x.totalClasses,label:"Turmas Ativas",gradient:"blue"}),t.jsx(k,{icon:K,value:x.pendingActivities,label:"Atividades Pendentes",gradient:"orange"}),t.jsx(k,{icon:W,value:x.avgGrade>0?x.avgGrade.toFixed(1):"--",label:"MÃ©dia Geral",gradient:"yellow",trend:x.gradeTrend}),t.jsx(k,{icon:bt,value:`${x.completionRate}%`,label:"Taxa de ConclusÃ£o",gradient:"green"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8 mb-6 md:mb-8",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 lg:space-y-8",children:[t.jsxs(_,{className:"p-4 sm:p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0 mb-4 sm:mb-6",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white",children:"PrÃ³ximas Atividades"}),t.jsx(b,{variant:"ghost",onClick:()=>v("/students/activities"),className:"text-blue-600 hover:text-blue-700",children:"Ver todas â†’"})]}),T.length>0?t.jsx("div",{className:"space-y-4",children:T.map((e,a)=>t.jsx(ft,{activity:e,onStart:()=>v(`/students/activities/${e.id}`),onView:()=>v(`/students/activities/${e.id}`),index:a},e.id))}):t.jsx(F,{icon:jt,title:"Tudo em dia!",description:"VocÃª nÃ£o tem atividades pendentes no momento. ParabÃ©ns!",variant:"success"})]}),G.length>0&&t.jsxs(_,{className:"p-6",children:[t.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[t.jsx(wt,{className:"w-6 h-6 text-blue-600"}),"Sua EvoluÃ§Ã£o"]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(X,{width:"100%",height:300,className:"min-w-[400px]",children:t.jsxs(Nt,{data:G,margin:{top:5,right:20,left:0,bottom:5},children:[t.jsx(Y,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),t.jsx(H,{dataKey:"date",stroke:"#64748b",tick:{fontSize:12}}),t.jsx(U,{stroke:"#64748b",domain:[0,10],tick:{fontSize:12}}),t.jsx(J,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px"}}),t.jsx(St,{type:"monotone",dataKey:"avgGrade",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:6},activeDot:{r:8},name:"MÃ©dia"})]})})})]}),B.length>0&&t.jsxs(_,{className:"p-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:"Melhores Turmas"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(X,{width:"100%",height:250,className:"min-w-[350px]",children:t.jsxs(kt,{data:B,margin:{top:5,right:20,left:0,bottom:5},children:[t.jsx(Y,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),t.jsx(H,{dataKey:"name",stroke:"#64748b",tick:{fontSize:11},angle:-15,textAnchor:"end",height:60}),t.jsx(U,{stroke:"#64748b",domain:[0,10],tick:{fontSize:12}}),t.jsx(J,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px"}}),t.jsx(Ct,{dataKey:"value",fill:"#10b981",radius:[8,8,0,0],name:"MÃ©dia"})]})})})]})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs(_,{className:"p-6",children:[t.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[t.jsx(A,{className:"w-5 h-5 text-blue-600"}),"Hoje"]}),M.length>0?t.jsx("div",{className:"space-y-3",children:M.map((e,a)=>t.jsx(yt,{event:e,onClick:()=>v("/students/calendar"),index:a},e.id))}):t.jsx(F,{icon:A,title:"Nenhum evento",description:"Sua agenda estÃ¡ livre hoje!",variant:"info"})]}),t.jsxs(_,{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"Atalhos RÃ¡pidos"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/activities"),children:[t.jsx(K,{className:"w-4 h-4 mr-2"}),"Minhas Atividades"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/classes"),children:[t.jsx($,{className:"w-4 h-4 mr-2"}),"Minhas Turmas"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/calendar"),children:[t.jsx(A,{className:"w-4 h-4 mr-2"}),"Agenda"]}),t.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>v("/students/performance"),children:[t.jsx(W,{className:"w-4 h-4 mr-2"}),"Minhas Notas"]})]})]})]})]})]})};export{Ce as default};
