import{j as e,a as Y,u as Z,r as l,s as c,l as I,q as ee}from"./main-BSMlxxlZ.js";import{C as te}from"./card-DMraIbJz.js";import{m as g,B as L}from"./button-CKV5JkoH.js";import{h as q}from"./SidebarPremium-Bf98hnme.js";import{B as h}from"./chevron-right-D_FKfY1S.js";import{U as ae}from"./users-BNOTPuIE.js";import{F as se}from"./file-text-BP6UKDNn.js";import{E as re}from"./EmptyState-BSYIwJt2.js";import"./dialog-DORbdWMS.js";import{I as ie}from"./input-D5v1eFNU.js";import{T as ne,a as de,b as u}from"./tabs-COryJLg7.js";import{S as T}from"./search-CrNNaOb7.js";import{G as le}from"./grid-3x3-CH3BtkC1.js";import{L as oe}from"./list-Bg2w8Cy7.js";import{S as D}from"./star-DKU9KxO3.js";import"./bell-C38I9ebQ.js";import"./trending-up-6aD5U3kC.js";import"./user-C2we2FXy.js";import"./settings-Ce4vc5Vl.js";import"./house-BiazGQzC.js";import"./graduation-cap-CzbYlLlS.js";import"./index-CpTBUXYw.js";import"./chart-column-CNsjJ5jU.js";import"./x-rSiybgWV.js";import"./index-DrqYlGSU.js";import"./index-Cwkg_cGm.js";import"./index-BwDK55Mp.js";import"./index-CB9Ufca0.js";const ce=({classItem:a,onClick:p,index:v=0})=>{const m={blue:"from-blue-600 to-cyan-500",green:"from-green-600 to-emerald-500",purple:"from-purple-600 to-pink-500",orange:"from-orange-600 to-amber-500",red:"from-red-600 to-rose-500",yellow:"from-yellow-600 to-orange-500",pink:"from-pink-600 to-rose-500",indigo:"from-indigo-600 to-purple-500",cyan:"from-cyan-600 to-blue-500",teal:"from-teal-600 to-green-500"},d=m[a.color]||m.blue;return e.jsx(g.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:v*.1,type:"spring"},whileHover:{scale:1.05,y:-8},onClick:p,className:"cursor-pointer",children:e.jsxs(te,{className:"overflow-hidden border-2 border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 hover:shadow-2xl transition-all",children:[e.jsxs("div",{className:`h-32 bg-gradient-to-br ${d} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute -right-8 -bottom-8 opacity-20",children:e.jsx(h,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(q,{className:"mb-2 bg-white/20 text-white border-white/30 backdrop-blur-sm",children:a.subject||"MatÃ©ria"}),e.jsx("h3",{className:"text-xl font-bold line-clamp-2",children:a.name})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:a.teacher_name||"Professor"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a.pendingActivities||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Pendentes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:a.avgGrade!==null&&a.avgGrade!==void 0?a.avgGrade.toFixed(1):"--"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"MÃ©dia"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:a.studentsCount||0}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Alunos"})]})]}),a.newActivities>0&&e.jsx(g.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3},children:e.jsxs(q,{className:"w-full justify-center py-2 bg-orange-100 text-orange-700 dark:bg-orange-900/40 dark:text-orange-300 border-orange-300 dark:border-orange-700",children:["ðŸ”” ",a.newActivities," nova",a.newActivities>1?"s":""," atividade",a.newActivities>1?"s":""]})}),a.nextDeadline&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"}),"PrÃ³ximo prazo: ",a.nextDeadline]})]})]})})},ze=()=>{const{user:a}=Y(),p=Z(),[v,m]=l.useState(!0),[d,w]=l.useState([]),[y,E]=l.useState([]),[o,M]=l.useState(""),[f,_]=l.useState("grid"),[b,P]=l.useState("name");l.useEffect(()=>{a?.id&&F()},[a]),l.useEffect(()=>{z()},[d,o,b]);const F=async()=>{try{m(!0);const{data:t}=await c.from("class_members").select("class_id, joined_at").eq("user_id",a.id).eq("role","student"),s=t?.map(r=>r.class_id)||[],{data:i}=await c.from("classes").select("id, name, subject, color, created_at, created_by").in("id",s),x=i?.map(r=>r.created_by).filter(Boolean)||[],{data:k}=await c.from("profiles").select("id, full_name, avatar_url").in("id",x),C={};if(k?.forEach(r=>{C[r.id]=r}),s.length===0){w([]),m(!1);return}const R=await Promise.all(i.map(async r=>{const V=t.find(n=>n.class_id===r.id),{data:Q}=await c.from("activity_class_assignments").select("activity_id").eq("class_id",r.id),A=Q?.map(n=>n.activity_id)||[],{data:S}=await c.from("submissions").select("activity_id, status, grade").eq("student_id",a.id).in("activity_id",A),U=new Set(S?.map(n=>n.activity_id)||[]),{data:W}=await c.from("activities").select("id, due_date, status").in("id",A).eq("status","published"),$=new Date,G=W?.filter(n=>{const N=U.has(n.id),X=n.due_date&&new Date(n.due_date)<$;return!N&&!X}).length||0,j=S?.filter(n=>n.grade!==null)||[],H=j.length>0?j.reduce((n,N)=>n+parseFloat(N.grade),0)/j.length:null,{data:O}=await c.from("class_members").select("id, is_archived").eq("class_id",r.id).eq("role","student"),J=O?.filter(n=>!n.is_archived).length||0,K=G,B=C[r.created_by];return{id:r.id,name:r.name,subject:r.subject,color:r.color||"blue",teacher_name:B?.full_name||"Professor",teacher_avatar:B?.avatar_url,pendingActivities:G,avgGrade:H,studentsCount:J||0,newActivities:K,joined_at:V?.joined_at,created_at:r.created_at}}));w(R)}catch(t){I.error("Erro ao carregar turmas:",t)}finally{m(!1)}},z=()=>{let t=[...d];if(o){const s=o.toLowerCase();t=t.filter(i=>i.name?.toLowerCase().includes(s)||i.subject?.toLowerCase().includes(s)||i.teacher_name?.toLowerCase().includes(s))}t.sort((s,i)=>{switch(b){case"name":return s.name.localeCompare(i.name);case"pending":return i.pendingActivities-s.pendingActivities;case"grade":const x=s.avgGrade||0;return(i.avgGrade||0)-x;case"recent":return new Date(i.joined_at)-new Date(s.joined_at);default:return 0}}),E(t)};return v?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ee,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs(g.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(h,{className:"w-8 h-8 text-blue-600"}),"Minhas Turmas"]}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[d.length," turma",d.length!==1?"s":""," ativa",d.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(ie,{placeholder:"Buscar turmas por nome, matÃ©ria ou professor...",value:o,onChange:t=>M(t.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ne,{value:b,onValueChange:P,children:e.jsxs(de,{children:[e.jsx(u,{value:"name",children:"Nome"}),e.jsx(u,{value:"pending",children:"Pendentes"}),e.jsx(u,{value:"grade",children:"MÃ©dia"}),e.jsx(u,{value:"recent",children:"Recentes"})]})}),e.jsxs("div",{className:"flex border rounded-lg overflow-hidden",children:[e.jsx(L,{variant:f==="grid"?"default":"ghost",size:"sm",onClick:()=>_("grid"),className:"rounded-none",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx(L,{variant:f==="list"?"default":"ghost",size:"sm",onClick:()=>_("list"),className:"rounded-none",children:e.jsx(oe,{className:"w-4 h-4"})})]})]})]}),y.length>0?e.jsx("div",{className:f==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:y.map((t,s)=>e.jsx(ce,{classItem:t,onClick:()=>p(`/students/classes/${t.id}`),index:s},t.id))}):e.jsx(re,{icon:o?T:h,title:o?"Nenhuma turma encontrada":"VocÃª ainda nÃ£o estÃ¡ em nenhuma turma",description:o?"Tente ajustar sua busca para encontrar o que procura.":"Entre em contato com seu professor para ser adicionado a uma turma.",variant:"default"}),d.length>0&&e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-12 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(h,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Total de Turmas"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:d.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/30",children:e.jsx(D,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Atividades Pendentes"})]}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:d.reduce((t,s)=>t+s.pendingActivities,0)})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(D,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"MÃ©dia Geral"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:(()=>{const t=d.filter(i=>i.avgGrade!==null);return t.length===0?"--":(t.reduce((i,x)=>i+x.avgGrade,0)/t.length).toFixed(1)})()})]})]})]})};export{ze as default};
