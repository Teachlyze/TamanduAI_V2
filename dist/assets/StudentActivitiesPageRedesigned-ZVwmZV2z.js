import{b as me,u as ue,r,s as o,l as S,j as e}from"./main-CI5_MmIm.js";import{u as pe}from"./use-toast-D7N2H9RC.js";import{C as $}from"./card-DpcnMbcE.js";import{A as F}from"./ActivityCard-DMGqr3ev.js";import{E as xe}from"./EmptyState-ExwS4ndS.js";import"./button-D7H9d9Gd.js";import"./dialog-DzyprNmz.js";import{I as fe}from"./input-BJMmyirp.js";import{T as ge,a as he,b as _}from"./tabs-ZdS4mBpd.js";import{S as P,a as z,b as B,c as Q,d as n}from"./select-DSQCR6Pt.js";import{m as R}from"./proxy-CT7Xtxle.js";import{F as G}from"./file-text-CtozP3gh.js";import{C as ve}from"./clock-3X7dheFj.js";import{C as H}from"./circle-check-aCTblfpW.js";import{T as O}from"./triangle-alert-ta0gV1VM.js";import{S as U}from"./search-C3Ws2_PV.js";import{d as be}from"./differenceInHours-CxKvrqrP.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./en-US-ChNhCS9W.js";import"./formatDistanceToNow-CR6k5j2z.js";import"./constructNow-DqwG0NnQ.js";import"./differenceInCalendarMonths-ka4FvHlb.js";import"./endOfDay-B-zzKHwV.js";import"./endOfMonth-rhMYNEE8.js";import"./format-BdDrz3ZT.js";import"./pt-BR-C6XVmIDX.js";import"./index-D4BuPd_i.js";import"./index-DHrdJ99Z.js";import"./Combination-BfETjw1A.js";import"./SidebarPremium-0_wHXPj0.js";import"./house-B6Hparzo.js";import"./users-ChR7WEeh.js";import"./book-open-DlGI5eOy.js";import"./graduation-cap-mPfDCRgT.js";import"./calendar-Dbm_7POQ.js";import"./chart-column-G5dLAdkQ.js";import"./message-circle-CRpVuYq9.js";import"./settings-BWUwUKXK.js";import"./brain-DVBX4Id_.js";import"./index-RHGs5twt.js";import"./chevron-right-CHSrP1xQ.js";import"./x-DGmYUGM5.js";import"./index-jkBwDHc_.js";import"./index-CRRraFTu.js";import"./index-CtvfaZbL.js";import"./index-DrPD6SFW.js";import"./chevron-down-DXVEpPD6.js";import"./check-GhIpAKm1.js";import"./chevron-up-CrZ13wWo.js";const gs=()=>{const{user:d}=me(),x=ue(),{toast:C}=pe(),[je,w]=r.useState(!0),[W,J]=r.useState(!0),[T,A]=r.useState([]),[m,K]=r.useState([]),[l,X]=r.useState("all"),[f,Y]=r.useState(""),[g,Z]=r.useState("all"),[h,ee]=r.useState("all"),[se,te]=r.useState([]),[v,ae]=r.useState({total:0,pending:0,completed:0,late:0,urgent:0});r.useEffect(()=>{d?.id&&(re(),ie())},[d]),r.useEffect(()=>{le()},[T,l,f,g,h]);const ie=async()=>{try{const{data:s}=await o.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),t=s?.map(b=>b.class_id)||[],{data:i}=await o.from("classes").select("id, name, subject").in("id",t);te(i||[])}catch(s){S.error("Erro ao carregar turmas:",s),C({title:"Erro ao carregar turmas",description:"Não foi possível carregar suas turmas. Tente novamente em instantes.",variant:"destructive"})}},re=async()=>{try{w(!0);const{data:s}=await o.from("class_members").select("class_id").eq("user_id",d.id).eq("role","student"),t=s?.map(a=>a.class_id)||[];if(t.length===0){A([]),w(!1);return}const{data:i}=await o.from("activity_class_assignments").select("activity_id, class_id, assigned_at").in("class_id",t),b=i?.map(a=>a.activity_id).filter(Boolean)||[],{data:oe}=await o.from("activities").select("id, title, description, type, due_date, max_score, created_at").in("id",b),{data:ce}=await o.from("classes").select("id, name, subject, color").in("id",t),N={};oe?.forEach(a=>{N[a.id]=a});const k={};ce?.forEach(a=>{k[a.id]=a});const{data:ne,error:L}=await o.from("submissions").select("activity_id, status, grade, feedback, submitted_at").eq("student_id",d.id).in("activity_id",b);L&&S.error("Erro ao buscar submissões:",L);const q={};ne?.forEach(a=>{q[a.activity_id]=a});const c=(i||[]).filter(a=>N[a.activity_id]).map(a=>{const I=N[a.activity_id],y=k[a.class_id],p=q[a.activity_id],V=new Date(I.due_date),D=new Date,M=be(V,D);let j="pending";return p?j=p.status==="graded"?"completed":"submitted":V<D&&(j="late"),{...I,class_id:a.class_id,class_name:y?.name,class_subject:y?.subject,class_color:y?.color,status:j,grade:p?.grade,feedback:p?.feedback,submitted_at:p?.submitted_at,assigned_at:a.assigned_at,is_urgent:M<=24&&M>=0&&j==="pending"}}),de={total:c.length,pending:c.filter(a=>a.status==="pending").length,completed:c.filter(a=>a.status==="completed"||a.status==="submitted").length,late:c.filter(a=>a.status==="late").length,urgent:c.filter(a=>a.is_urgent).length};ae(de),A(c)}catch(s){S.error("Erro ao carregar atividades:",s),C({title:"Erro ao carregar atividades",description:"Não foi possível carregar suas atividades. Tente novamente em instantes.",variant:"destructive"})}finally{w(!1),W&&J(!1)}},le=()=>{let s=[...T];if(l==="pending"?s=s.filter(t=>t.status==="pending"||t.status==="late"):l==="completed"?s=s.filter(t=>t.status==="completed"||t.status==="submitted"):l==="late"&&(s=s.filter(t=>t.status==="late")),f){const t=f.toLowerCase();s=s.filter(i=>i.title?.toLowerCase().includes(t)||i.description?.toLowerCase().includes(t)||i.class_name?.toLowerCase().includes(t))}g!=="all"&&(s=s.filter(t=>t.class_id===g)),h!=="all"&&(s=s.filter(t=>t.type===h)),s.sort((t,i)=>t.status==="late"&&i.status!=="late"?-1:t.status!=="late"&&i.status==="late"?1:t.is_urgent&&!i.is_urgent?-1:!t.is_urgent&&i.is_urgent?1:new Date(t.due_date)-new Date(i.due_date)),K(s)},u=m.filter(s=>s.is_urgent),E=m.filter(s=>!s.is_urgent);return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-3 sm:p-4 md:p-6",children:[e.jsxs(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 sm:mb-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-2 sm:gap-3",children:[e.jsx(G,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-600"}),"Minhas Atividades"]}),e.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-400",children:"Gerencie suas atividades e acompanhe seu progresso"})]}),e.jsx($,{className:"p-3 sm:p-4 md:p-6 mb-6 sm:mb-8",children:e.jsxs(ge,{value:l,onValueChange:X,children:[e.jsxs(he,{className:"grid grid-cols-2 sm:grid-cols-4 w-full mb-4 sm:mb-6",children:[e.jsxs(_,{value:"all",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),"Todas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.total})]}),e.jsxs(_,{value:"pending",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(ve,{className:"w-4 h-4"}),"Pendentes",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.pending})]}),e.jsxs(_,{value:"completed",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"Concluídas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.completed})]}),e.jsxs(_,{value:"late",className:"flex flex-col sm:flex-row items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),"Atrasadas",e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-xs font-medium",children:v.late})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(fe,{placeholder:"Buscar atividades...",value:f,onChange:s=>Y(s.target.value),className:"pl-10"})]})}),e.jsxs(P,{value:g,onValueChange:Z,children:[e.jsx(z,{className:"w-full md:w-48",children:e.jsx(B,{placeholder:"Todas as turmas"})}),e.jsxs(Q,{children:[e.jsx(n,{value:"all",children:"Todas as turmas"}),se.map(s=>e.jsx(n,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(P,{value:h,onValueChange:ee,children:[e.jsx(z,{className:"w-full md:w-48",children:e.jsx(B,{placeholder:"Todos os tipos"})}),e.jsxs(Q,{children:[e.jsx(n,{value:"all",children:"Todos os tipos"}),e.jsx(n,{value:"objective",children:"Objetiva"}),e.jsx(n,{value:"open",children:"Aberta"}),e.jsx(n,{value:"mixed",children:"Mista"})]})]})]})]})}),u.length>0&&e.jsx(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"mb-8",children:e.jsxs($,{className:"p-6 border-l-4 border-amber-500 bg-white dark:bg-slate-900",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-amber-500"}),"Atividades Urgentes - Prazo nas próximas 24 horas"]}),e.jsx("div",{className:"space-y-4",children:u.map((s,t)=>e.jsx(F,{activity:s,onStart:()=>x(`/students/activities/${s.id}`),onView:()=>x(`/students/activities/${s.id}`),index:t},s.id))})]})}),E.length>0?e.jsx("div",{className:"space-y-4",children:E.map((s,t)=>e.jsx(F,{activity:s,onStart:()=>x(`/students/activities/${s.id}`),onView:()=>x(`/students/activities/${s.id}`),index:t},s.id))}):e.jsx(xe,{icon:m.length===0&&u.length===0?H:U,title:m.length===0&&u.length===0?l==="completed"?"Nenhuma atividade concluída":"Nenhuma atividade":"Nenhum resultado encontrado",description:m.length===0&&u.length===0?l==="completed"?"Comece a fazer suas atividades para vê-las aqui quando concluídas.":"Você não tem atividades nesta categoria no momento.":"Tente ajustar os filtros de busca para encontrar o que procura.",variant:l==="completed"?"success":"default"})]})};export{gs as default};
