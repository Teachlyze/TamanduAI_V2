import{c as T,u as q,a as B,r,s as o,j as e,k as J}from"./main-PnoWv5mu.js";import{B as m,m as f}from"./button-B1az96ai.js";import{C}from"./card-DNyDBtwZ.js";import{I as U}from"./input-BGWMq9XA.js";import{D as z}from"./DashboardHeader-CjwFRF49.js";import{S as A}from"./SearchInput-5hcz4k89.js";import"./dropdown-menu-BDAIvG1Q.js";import"./label-DSOeyQ5r.js";import{B as k}from"./book-open-BN8GTFXN.js";import{U as P}from"./users-CZvcSbj_.js";import{C as O}from"./index-DvZMkTcl.js";import{X as F}from"./x-7WqOwCJm.js";import"./tokens-BPdvztvj.js";import"./search-CcwmVUyB.js";import"./index-CWQpaRb1.js";import"./chevron-right-5LVKKztM.js";import"./check-8UqrO2_7.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],y=T("log-in",H),oe=()=>{const _=q(),{user:n}=B(),[E,p]=r.useState(!0),[S,D]=r.useState([]),[u,L]=r.useState(""),[I,i]=r.useState(!1),[x,c]=r.useState(""),[h,g]=r.useState(!1),[j,a]=r.useState("");r.useEffect(()=>{v()},[n]);const v=async()=>{if(n)try{p(!0);const{data:s}=await o.from("class_members").select(`
          class_id,
          joined_at,
          classes:class_id (
            id,
            name,
            subject,
            color,
            banner_color,
            created_by,
            teacher:created_by (
              id,
              full_name
            )
          )
        `).eq("user_id",n.id).eq("role","student").order("joined_at",{ascending:!1}),t=await Promise.all((s||[]).map(async b=>{const l=b.classes;if(!l)return null;const{count:d}=await o.from("class_members").select("id",{count:"exact",head:!0}).eq("class_id",l.id),{count:M}=await o.from("activity_class_assignments").select("id",{count:"exact",head:!0}).eq("class_id",l.id);return{...l,memberCount:d||0,activityCount:M||0}}));D(t.filter(Boolean))}catch(s){console.error("Erro:",s)}finally{p(!1)}},w=async()=>{const s=x.trim().toUpperCase();if(!s){a("Digite o código da turma");return}if(s.length>8){a("Código inválido (máximo 8 caracteres)");return}try{g(!0),a("");const{data:t,error:b}=await o.from("classes").select("id, name").ilike("invite_code",s).single();if(b||!t){a("Código inválido!");return}const{data:l}=await o.from("class_members").select("id").eq("class_id",t.id).eq("user_id",n.id).single();if(l){a("Você já está nesta turma!");return}const{error:d}=await o.from("class_members").insert({class_id:t.id,user_id:n.id,role:"student",joined_at:new Date().toISOString()});if(d)throw d;i(!1),c(""),a(""),v(),alert(`Você entrou na turma "${t.name}" com sucesso!`)}catch(t){console.error("Erro ao entrar na turma:",t),a("Erro ao entrar na turma. Tente novamente.")}finally{g(!1)}},N=S.filter(s=>s.name?.toLowerCase().includes(u.toLowerCase())||s.subject?.toLowerCase().includes(u.toLowerCase()));return E?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(J,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-slate-200 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 p-6",children:[e.jsx(z,{title:"Minhas Turmas",subtitle:"Acompanhe suas turmas e atividades",role:"student"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center justify-between gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(A,{value:u,onChange:s=>L(s.target.value),placeholder:"Buscar turmas..."})}),e.jsxs(m,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white shadow-lg flex-shrink-0",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Entrar com Código"]})]}),N.length>0?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map((s,t)=>e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsxs(C,{onClick:()=>_(`/student/classes/${s.id}`),className:"overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-200 border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-r from-blue-600 to-cyan-500 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.05] bg-[size:20px_20px]"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(k,{className:"w-12 h-12 text-white opacity-90"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white line-clamp-2",children:s.name})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:s.subject||"Disciplina não informada"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.memberCount||0," ",s.memberCount===1?"membro":"membros"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.activityCount||0," ",s.activityCount===1?"atividade":"atividades"]})]})]})]})]})},s.id))}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(k,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"Nenhuma turma ainda"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Entre em uma turma usando um código de acesso"}),e.jsxs(m,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Entrar em uma Turma"]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{i(!1),c(""),a("")},children:e.jsx(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:s=>s.stopPropagation(),children:e.jsxs(C,{className:"p-8 max-w-md w-full bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Entrar em uma Turma"}),e.jsx("button",{onClick:()=>{i(!1),c(""),a("")},className:"p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(F,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Digite o código fornecido pelo professor"}),e.jsxs("div",{className:"mb-6",children:[e.jsx(U,{value:x,onChange:s=>{const t=s.target.value.toUpperCase();t.length<=8&&(c(t),a(""))},onKeyPress:s=>{s.key==="Enter"&&w()},placeholder:"CÓDIGO DA TURMA",maxLength:8,className:"text-center text-2xl font-mono tracking-widest uppercase h-14 border-2 focus:border-blue-500",autoFocus:!0}),j&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 text-center",children:j})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:()=>{i(!1),c(""),a("")},className:"flex-1 border-slate-300 dark:border-slate-700",disabled:h,children:"Cancelar"}),e.jsx(m,{onClick:w,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",disabled:h||!x.trim(),children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Entrando..."]}):"Entrar"})]})]})})})]})};export{oe as default};
