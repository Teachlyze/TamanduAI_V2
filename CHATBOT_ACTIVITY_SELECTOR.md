# ğŸ”„ SELETOR DE ATIVIDADES NO CHATBOT

## âœ¨ NOVA FUNCIONALIDADE

Agora vocÃª pode **trocar de atividade sem fechar o chat**!

---

## ğŸ¯ COMO FUNCIONA

### **Visual**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Assistente IA             [_] [X]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Atividade: Lista Ligada ğŸ”½       â”‚ â”‚ â† CLIQUE AQUI
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Conversas...                           â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Ao Clicar no Seletor**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Assistente IA             [_] [X]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Atividade: Lista Ligada ğŸ”¼       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ… Lista Ligada                    â”‚ â”‚ â† Atividade atual
â”‚  â”‚ Arrays e Vetores                   â”‚ â”‚
â”‚  â”‚ Ãrvores BinÃ¡rias                   â”‚ â”‚
â”‚  â”‚ Grafos e Busca                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± RECURSOS

### **1. Seletor Dropdown** ğŸ”½
- Mostra **nome da atividade atual**
- Clique para ver **todas as atividades** da turma
- Dropdown com scroll (mÃ¡x 4-5 atividades visÃ­veis)

### **2. Troca InstantÃ¢nea** âš¡
- Clique em qualquer atividade â†’ Troca imediatamente
- **Conversa reinicia** com contexto da nova atividade
- Sem precisar fechar e reabrir o chat

### **3. Indicador Visual** âœ…
- Atividade atual destacada em roxo
- TÃ­tulo e descriÃ§Ã£o de cada atividade
- AnimaÃ§Ã£o de rotaÃ§Ã£o no Ã­cone (ğŸ”½ â†’ ğŸ”¼)

---

## ğŸ¨ DESIGN

### **BotÃ£o do Seletor**:
```css
- Fundo: bg-white/10 (transparente)
- Hover: bg-white/20 (mais visÃ­vel)
- Texto: Branco (no header roxo/rosa)
- Ãcone: ChevronDown com rotaÃ§Ã£o
- Largura: 100% (full width)
```

### **Dropdown**:
```css
- Fundo: Branco / Dark slate-800
- Shadow: shadow-2xl (destaque)
- Altura mÃ¡x: 256px (max-h-64)
- Scroll: overflow-y-auto
- z-index: 50 (acima de tudo)
```

### **Item de Atividade**:
```css
- Normal: hover:bg-purple-50
- Selecionada: bg-purple-50/50
- TÃ­tulo: font-medium
- DescriÃ§Ã£o: text-xs truncate
- Borda: border-b (entre itens)
```

---

## ğŸ’» IMPLEMENTAÃ‡ÃƒO TÃ‰CNICA

### **ChatbotWidget.jsx**

**Novos Props**:
```jsx
<ChatbotWidget
  context={{...}}
  availableActivities={[...]}  // â† NOVO
  onActivityChange={(activity) => {...}}  // â† NOVO
  onClose={() => {...}}
/>
```

**Novos Estados**:
```jsx
const [showActivitySelector, setShowActivitySelector] = useState(false);
```

**LÃ³gica de Troca**:
```jsx
onClick={() => {
  onActivityChange?.(activity);  // Notificar pÃ¡gina pai
  setShowActivitySelector(false);  // Fechar dropdown
  setMessages([]);  // Limpar conversa antiga
  setConversationId(null);  // Resetar ID
}}
```

---

### **StudentClassDetailsPageRedesigned.jsx**

**Passar Atividades**:
```jsx
availableActivities={activities.map(a => ({
  id: a.id,
  title: a.title,
  description: a.description,
  content: a.content
}))}
```

**Handler de MudanÃ§a**:
```jsx
onActivityChange={(newActivity) => {
  setSelectedActivity(newActivity);  // Atualizar estado
  // Chat reinicia automaticamente
}}
```

---

## ğŸ”„ FLUXO COMPLETO

### **CenÃ¡rio 1: Abrir Chat**
1. Aluno clica em "Pedir Ajuda IA" na Atividade A
2. Chat abre com contexto da Atividade A
3. VÃª no header: "Atividade: Atividade A ğŸ”½"

### **CenÃ¡rio 2: Trocar Atividade**
1. Aluno clica no seletor "Atividade: Atividade A ğŸ”½"
2. Dropdown abre mostrando todas atividades
3. Clica em "Atividade B"
4. Dropdown fecha
5. Chat reinicia com mensagem de boas-vindas para Atividade B
6. Header atualiza: "Atividade: Atividade B ğŸ”½"
7. Pode fazer perguntas sobre Atividade B

### **CenÃ¡rio 3: Trocar MÃºltiplas Vezes**
1. Pode trocar quantas vezes quiser
2. Cada troca reinicia a conversa
3. HistÃ³rico anterior **nÃ£o Ã© mantido** (propositalmente)
4. Cada atividade tem contexto isolado

---

## ğŸ¯ BENEFÃCIOS

### **Para o Aluno**:
âœ… **NÃ£o precisa fechar e reabrir** o chat  
âœ… **Compara dÃºvidas** entre atividades facilmente  
âœ… **Workflow mais fluido** (menos cliques)  
âœ… **VÃª todas atividades** disponÃ­veis  

### **Para o Sistema**:
âœ… **Conversas separadas** por atividade (analytics correto)  
âœ… **Contexto sempre atualizado**  
âœ… **Sem confusÃ£o** de mÃºltiplas atividades  
âœ… **Mais engajamento** (fÃ¡cil explorar)  

---

## ğŸ“Š COMPORTAMENTO

| AÃ§Ã£o | Resultado |
|------|-----------|
| Abrir chat | Mostra atividade atual |
| Clicar seletor | Abre dropdown |
| Selecionar nova atividade | Troca contexto + reinicia chat |
| Minimizar chat | Seletor some (sÃ³ reaparece ao maximizar) |
| Fechar dropdown | Clique fora ou em item |

---

## ğŸš€ MELHORIAS FUTURAS (Opcional)

### **1. Manter HistÃ³rico por Atividade**
```jsx
const [chatHistoryByActivity, setChatHistoryByActivity] = useState({});

// Ao trocar atividade
const previousHistory = chatHistoryByActivity[activity.id] || [];
setMessages(previousHistory);
```

### **2. Badge de Mensagens NÃ£o Lidas**
```jsx
<span className="badge">3</span>  // 3 mensagens na Atividade B
```

### **3. Filtrar Atividades**
```jsx
<input placeholder="Buscar atividade..." />
```

### **4. OrdenaÃ§Ã£o Inteligente**
```
- Atividades pendentes primeiro
- Depois as em andamento
- Por Ãºltimo as concluÃ­das
```

### **5. Ãcones de Status**
```
ğŸŸ¡ Pendente
ğŸ”µ Em andamento  
ğŸŸ¢ ConcluÃ­da
```

---

## ğŸ› EDGE CASES TRATADOS

### **1. Sem Atividades DisponÃ­veis**
```jsx
{availableActivities.length > 0 && (
  // Seletor sÃ³ aparece se houver atividades
)}
```

### **2. Chat Minimizado**
```jsx
{!isMinimized && (
  // Seletor some quando minimizado
)}
```

### **3. Atividade Deletada**
```jsx
// Se atividade atual nÃ£o existe mais na lista
// Fallback para primeira disponÃ­vel
```

### **4. Clique Fora do Dropdown**
```jsx
// TODO: Adicionar listener para fechar ao clicar fora
useEffect(() => {
  const handleClickOutside = (e) => {
    if (dropdownRef.current && !dropdownRef.current.contains(e.target)) {
      setShowActivitySelector(false);
    }
  };
  document.addEventListener('mousedown', handleClickOutside);
  return () => document.removeEventListener('mousedown', handleClickOutside);
}, []);
```

---

## ğŸ“‚ ARQUIVOS MODIFICADOS

### **1. src/shared/components/ui/ChatbotWidget.jsx**
```diff
+ import { ChevronDown } from 'lucide-react'
+ const ChatbotWidget = ({ 
+   context, 
+   onClose, 
+   availableActivities = [],  // NOVO
+   onActivityChange  // NOVO
+ }) => {
+ const [showActivitySelector, setShowActivitySelector] = useState(false)

+ {/* Seletor de Atividade */}
+ {availableActivities.length > 0 && !isMinimized && (
+   <div className="px-4 pb-3 relative">
+     <button onClick={...}>
+       <span>{context.activityTitle}</span>
+       <ChevronDown />
+     </button>
+     {showActivitySelector && (
+       <div className="dropdown">
+         {availableActivities.map(activity => (
+           <button onClick={...}>
+             {activity.title}
+           </button>
+         ))}
+       </div>
+     )}
+   </div>
+ )}
```

### **2. src/modules/student/pages/Classes/StudentClassDetailsPageRedesigned.jsx**
```diff
  <ChatbotWidget
    context={{...}}
+   availableActivities={activities.map(a => ({
+     id: a.id,
+     title: a.title,
+     description: a.description,
+     content: a.content
+   }))}
+   onActivityChange={(newActivity) => {
+     setSelectedActivity(newActivity);
+   }}
    onClose={...}
  />
```

---

## âœ… CHECKLIST

- [x] Seletor visual no header
- [x] Dropdown com lista de atividades
- [x] Troca de atividade ao clicar
- [x] Reinicia conversa automaticamente
- [x] Indicador de atividade atual
- [x] AnimaÃ§Ã£o de abertura/fechamento
- [x] Responsivo (mobile friendly)
- [x] Dark mode suportado
- [x] Props opcionais (nÃ£o quebra pÃ¡ginas antigas)

---

## ğŸ‰ RESULTADO

Agora o aluno pode **trocar de atividade facilmente** sem perder o contexto do chat!

**Antes**: 
```
Fechar chat â†’ Selecionar nova atividade â†’ Abrir chat
```

**Depois**:
```
Clicar dropdown â†’ Selecionar nova atividade â†’ Pronto!
```

---

**Implementado em**: 05/11/2025 22:21  
**Tempo de implementaÃ§Ã£o**: 10 minutos  
**Complexidade**: MÃ©dia  
**Impacto na UX**: ALTO ğŸš€
